<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Hands-on labs for the K-Agent framework - Kubernetes-native MCP server" name="description"/><meta content="CodeWizard-IL" name="author"/><link href="https://nirgeier.github.io/AI-K8S-MCP/Lab08-Kagent/lab/" rel="canonical"/><link href="../../Lab07-MCP-Ollama/lab/" rel="prev"/><link href="../.." rel="next"/><link href="../../assets/favicon.png" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.6.16" name="generator"/><title>Lab 8: Kagent - K-Agent Labs</title><link href="../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style><link href="../../css/print-site.css" rel="stylesheet"/><link href="../../css/print-site-material.css" rel="stylesheet"/><link href="../../assets/stylesheets/codewizard.css?v=1766553928" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#lab-08-k-agent-integration"> Skip to content </a> </div> <div data-md-component="announce"> </div> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine classes --> <!-- Header --> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <!-- Link to home --> <a aria-label="K-Agent Labs" class="md-header__button md-logo" data-md-component="logo" href="../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <!-- Header title --> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> K-Agent Labs </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Lab 8: Kagent </span> </div> </div> </div> <div class="m-social__top"> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> <!-- Color palette toggle --> <form class="md-header__option" data-md-component="palette"> <input aria-hidden="true" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/> </form> <!-- User preference: color palette --> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <!-- Site language selector --> <!-- Button to open search modal --> <!-- Check if search is actually enabled - see https://t.ly/DT_0V --> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <!-- Search interface --> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> <nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../welcome/"> Welcome </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a class="md-tabs__link" href="../../labs/"> Labs </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../.."> Resources </a> </li> </ul> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="K-Agent Labs" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> K-Agent Labs </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../welcome/"> <span class="md-ellipsis"> Welcome </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex=""> <span class="md-ellipsis"> Labs </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Labs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../labs/"> <span class="md-ellipsis"> MCP Labs - Learning Series </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab00-Setup/lab/"> <span class="md-ellipsis"> Lab 0: Setup </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab01-MCP-Fundamentals/lab/"> <span class="md-ellipsis"> Lab 1: MCP Fundamentals </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab02-First-MCP-Server/lab/"> <span class="md-ellipsis"> Lab 2: First MCP Server </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab03-MCP-Tools/lab/"> <span class="md-ellipsis"> Lab 3: MCP Tools </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab04-MCP-Resources/lab/"> <span class="md-ellipsis"> Lab 4: MCP Resources </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab05-MCP-Prompts/lab/"> <span class="md-ellipsis"> Lab 5: MCP Prompts </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab06-MCP-Workflow/lab/"> <span class="md-ellipsis"> Lab 6: MCP Workflow </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab07-MCP-Ollama/lab/"> <span class="md-ellipsis"> Lab 7: MCP Ollama </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Lab 8: Kagent </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> Lab 8: Kagent </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#overview"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#learning-objectives"> <span class="md-ellipsis"> Learning Objectives </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisites"> <span class="md-ellipsis"> Prerequisites </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#what-is-a-k-agent"> <span class="md-ellipsis"> What is a K-Agent? </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#lab-architecture"> <span class="md-ellipsis"> Lab Architecture </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#hands-on-exercise"> <span class="md-ellipsis"> Hands-On Exercise </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#optional-extensions"> <span class="md-ellipsis"> Optional Extensions </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#troubleshooting"> <span class="md-ellipsis"> Troubleshooting </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#key-takeaways"> <span class="md-ellipsis"> Key Takeaways </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#whats-next"> <span class="md-ellipsis"> What’s Next? </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#additional-resources"> <span class="md-ellipsis"> Additional Resources </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab09-K8S-Event-Monitor/lab.md"> <span class="md-ellipsis"> Lab 9: K8S Event Monitor </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../.."> <span class="md-ellipsis"> Resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="lab-08-k-agent-integration">Lab 08: K-Agent Integration<a class="headerlink" href="#lab-08-k-agent-integration" title="Permanent link">¶</a></h1> <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2> <ul> <li> <p>Welcome to the advanced MCP lab!</p> </li> <li> <p>Now that you’ve mastered the fundamentals of MCP servers, tools, resources, and prompts, it’s time to apply your knowledge to a real-world scenario: <strong>building and implementing a K-Agent</strong>.</p> </li> <li> <p>A K-Agent is an MCP server specifically designed to interact with Kubernetes clusters.</p> </li> <li> <p>In this lab, you’ll build a focused K-Agent that communicates with a Kubernetes cluster and collects logs from all pods - a critical capability for monitoring, debugging, and operational intelligence.</p> </li> <li> <p>This lab bridges the gap between MCP theory and practical Kubernetes operations, showing how MCP servers can enhance DevOps workflows and provide AI-powered insights into cluster health and application behavior.</p> </li> </ul> <hr/> <h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">¶</a></h2> <p>By the end of this lab, you will:</p> <ul> <li>Understand the concept and value of K-Agents (Kubernetes MCP servers)</li> <li>Use pre-configured Kubernetes cluster access</li> <li>Build MCP tools for pod log collection</li> <li>Implement error handling for cluster operations</li> </ul> <hr/> <h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2> <ul> <li>Completed <a href="../Lab05-MCP-Prompts/">Lab 5 - MCP Prompts and Integration</a></li> <li><strong>A running Kubernetes cluster</strong> (OrbStack, Docker Desktop, Minikube, kind, or remote cluster)</li> <li><strong>kubectl installed and configured</strong> with access to your cluster (<code>kubectl cluster-info</code> should work)</li> <li>Basic understanding of Kubernetes concepts (pods, namespaces, kubectl)</li> <li>Familiarity with container orchestration principles</li> <li>Understanding of log aggregation and monitoring concepts</li> </ul> <div class="admonition debug"> <p class="admonition-title">Verify Kubernetes Setup</p> <ul> <li> <p>Before starting this lab, ensure your Kubernetes environment is ready:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1"># Check cluster access</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="c1"># Verify you can list pods</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="c1"># Check your kubeconfig</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a>kubectl<span class="w"> </span>config<span class="w"> </span>view
</span></code></pre></div> </li> </ul> </div> <hr/> <h2 id="what-is-a-k-agent">What is a K-Agent?<a class="headerlink" href="#what-is-a-k-agent" title="Permanent link">¶</a></h2> <p>A <code>**K-Agent**</code> is an <code>MCP server</code> that specializes in Kubernetes operations.</p> <p>Unlike generic MCP servers, K-Agents are designed specifically for:</p> <ul> <li><strong>Cluster Communication</strong>: Secure, authenticated access to Kubernetes APIs</li> <li><strong>Operational Intelligence</strong>: Real-time insights into cluster health and performance</li> <li><strong>Log Analytics</strong>: Collection and analysis of application and system logs</li> <li><strong>Resource Management</strong>: Monitoring and managing Kubernetes resources</li> <li><strong>Troubleshooting</strong>: Automated diagnosis of cluster and application issues</li> </ul> <hr/> <h3 id="why-k-agents-matter">Why K-Agents Matter<a class="headerlink" href="#why-k-agents-matter" title="Permanent link">¶</a></h3> <ul> <li>In modern DevOps environments, Kubernetes clusters generate enormous amounts of operational data.</li> </ul> <p>K-Agents provide:</p> <ul> <li><strong>AI-Powered Monitoring</strong>: Intelligent analysis of logs and metrics</li> <li><strong>Automated Troubleshooting</strong>: AI-assisted diagnosis of issues</li> <li><strong>Operational Insights</strong>: Pattern recognition in cluster behavior</li> <li><strong>Enhanced Observability</strong>: Structured access to distributed system data</li> <li><strong>Seamless Integration</strong>: MCP tools that interact directly with Kubernetes resources</li> <li><strong>Improved DevOps Workflows</strong>: Streamlined operations through AI-driven tools</li> <li><strong>Dashboarding and Alerts</strong>: Proactive monitoring with AI-generated alerts</li> <li><strong>Custom Tooling</strong>: Tailored MCP tools for specific Kubernetes tasks</li> </ul> <hr/> <h2 id="lab-architecture">Lab Architecture<a class="headerlink" href="#lab-architecture" title="Permanent link">¶</a></h2> <p>Your K-Agent will implement a focused set of capabilities:</p> <pre class="mermaid"><code>graph TB
    subgraph "MCP Client (AI/Inspector)"
        Client[MCP Client]
    end

    subgraph "K-Agent MCP Server"
        Server[K-Agent Server]
        Tools[MCP Tools]
        K8sClient[Kubernetes Client]

        Server --&gt; Tools
        Tools --&gt; K8sClient
    end

    subgraph "Kubernetes Cluster"
        API[Kubernetes API]
        Pods[Pods]
        Logs[Container Logs]

        API --&gt; Pods
        Pods --&gt; Logs
    end

    Client --&gt;|"stdio/JSON-RPC"| Server
    K8sClient --&gt;|"REST API"| API

    Tools -.-&gt;|"list_pods"| API
    Tools -.-&gt;|"collect_pod_logs"| Logs

    style Server fill:#4CAF50
    style Tools fill:#2196F3
    style K8sClient fill:#FF9800
    style API fill:#9C27B0</code></pre> <hr/> <h3 id="core-components">Core Components<a class="headerlink" href="#core-components" title="Permanent link">¶</a></h3> <ol> <li> <p><strong>Kubernetes Client Integration</strong></p> <ul> <li>Secure cluster authentication</li> <li>API communication handling</li> <li>Error management for cluster operations</li> </ul> </li> <li> <p><strong>Log Collection Tools</strong></p> <ul> <li>Pod discovery across namespaces</li> <li>Log retrieval from all containers</li> <li>Structured log formatting</li> </ul> </li> <li> <p><strong>Resource Management</strong></p> <ul> <li>Namespace enumeration</li> <li>Pod status monitoring</li> <li>Health check capabilities</li> </ul> </li> </ol> <hr/> <h2 id="hands-on-exercise">Hands-On Exercise<a class="headerlink" href="#hands-on-exercise" title="Permanent link">¶</a></h2> <h3 id="step-1-project-setup">Step 1: Project Setup<a class="headerlink" href="#step-1-project-setup" title="Permanent link">¶</a></h3> <p>Create a new MCP server project with Kubernetes dependencies:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1"># Create project directory and navigate to it</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>mkdir<span class="w"> </span>k-agent-logs
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>k-agent-logs
</span></code></pre></div> <p><br/></p> <ul> <li>Create a new <code>package.json</code> file inside the <code>k-agent-logs</code> directory with the following content:</li> </ul> <div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"k-agent-logs"</span><span class="p">,</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nt">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"K-Agent MCP server for Kubernetes log collection"</span><span class="p">,</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nt">"main"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dist/index.js"</span><span class="p">,</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="w">  </span><span class="nt">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a><span class="w">    </span><span class="nt">"build"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tsc"</span><span class="p">,</span>
</span><span id="__span-2-8"><a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a><span class="w">    </span><span class="nt">"dev"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tsx src/index.ts"</span><span class="p">,</span>
</span><span id="__span-2-9"><a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a><span class="w">    </span><span class="nt">"start"</span><span class="p">:</span><span class="w"> </span><span class="s2">"node dist/index.js"</span>
</span><span id="__span-2-10"><a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-11"><a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a><span class="w">  </span><span class="nt">"keywords"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"kubernetes"</span><span class="p">,</span><span class="w"> </span><span class="s2">"mcp"</span><span class="p">,</span><span class="w"> </span><span class="s2">"logs"</span><span class="p">,</span><span class="w"> </span><span class="s2">"monitoring"</span><span class="p">],</span>
</span><span id="__span-2-12"><a href="#__codelineno-2-12" id="__codelineno-2-12" name="__codelineno-2-12"></a><span class="w">  </span><span class="nt">"author"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span>
</span><span id="__span-2-13"><a href="#__codelineno-2-13" id="__codelineno-2-13" name="__codelineno-2-13"></a><span class="w">  </span><span class="nt">"license"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ISC"</span><span class="p">,</span>
</span><span id="__span-2-14"><a href="#__codelineno-2-14" id="__codelineno-2-14" name="__codelineno-2-14"></a><span class="w">  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span>
</span><span id="__span-2-15"><a href="#__codelineno-2-15" id="__codelineno-2-15" name="__codelineno-2-15"></a><span class="w">  </span><span class="nt">"dependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-16"><a href="#__codelineno-2-16" id="__codelineno-2-16" name="__codelineno-2-16"></a><span class="w">    </span><span class="nt">"@kubernetes/client-node"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.4.0"</span><span class="p">,</span>
</span><span id="__span-2-17"><a href="#__codelineno-2-17" id="__codelineno-2-17" name="__codelineno-2-17"></a><span class="w">    </span><span class="nt">"@modelcontextprotocol/sdk"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^1.25.2"</span>
</span><span id="__span-2-18"><a href="#__codelineno-2-18" id="__codelineno-2-18" name="__codelineno-2-18"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-19"><a href="#__codelineno-2-19" id="__codelineno-2-19" name="__codelineno-2-19"></a><span class="w">  </span><span class="nt">"devDependencies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-20"><a href="#__codelineno-2-20" id="__codelineno-2-20" name="__codelineno-2-20"></a><span class="w">    </span><span class="nt">"@types/node"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^25.0.3"</span><span class="p">,</span>
</span><span id="__span-2-21"><a href="#__codelineno-2-21" id="__codelineno-2-21" name="__codelineno-2-21"></a><span class="w">    </span><span class="nt">"tsx"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^4.21.0"</span><span class="p">,</span>
</span><span id="__span-2-22"><a href="#__codelineno-2-22" id="__codelineno-2-22" name="__codelineno-2-22"></a><span class="w">    </span><span class="nt">"typescript"</span><span class="p">:</span><span class="w"> </span><span class="s2">"^5.9.3"</span>
</span><span id="__span-2-23"><a href="#__codelineno-2-23" id="__codelineno-2-23" name="__codelineno-2-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-24"><a href="#__codelineno-2-24" id="__codelineno-2-24" name="__codelineno-2-24"></a><span class="p">}</span>
</span></code></pre></div> <hr/> <ul> <li>Run the following command to install the dependencies:</li> </ul> <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a>npm<span class="w"> </span>install
</span></code></pre></div> <p>This will create <code>node_modules/</code> and <code>package-lock.json</code> in your <code>k-agent-logs</code> directory.</p> <hr/> <h3 id="step-2-kubernetes-client-configuration-complete-server-setup">Step 2: Kubernetes Client Configuration &amp; Complete Server Setup<a class="headerlink" href="#step-2-kubernetes-client-configuration-complete-server-setup" title="Permanent link">¶</a></h3> <p>Create an <code>src</code> directory, inside the <code>k-agent-logs</code> directory, and an empty file named <code>index.ts</code> inside it:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>src<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><br/></p> <p>Create your complete K-Agent server by pasting the following code inside <code>src/index.ts</code>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">// Import MCP SDK components and Kubernetes client</span>
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-5-4"><a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-5"><a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-6"><a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="w">  </span><span class="nx">ErrorCode</span><span class="p">,</span>
</span><span id="__span-5-7"><a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-8"><a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-9"><a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="w">  </span><span class="nx">McpError</span><span class="p">,</span>
</span><span id="__span-5-10"><a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-11"><a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-5-12"><a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">k8s</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@kubernetes/client-node"</span><span class="p">;</span>
</span><span id="__span-5-13"><a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a>
</span><span id="__span-5-14"><a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="kd">class</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-15"><a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="w">  </span><span class="c1">// Store Kubernetes API clients (for talking to your cluster)</span>
</span><span id="__span-5-16"><a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sConfig</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.KubeConfig</span><span class="p">;</span>
</span><span id="__span-5-17"><a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sAppsApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.AppsV1Api</span><span class="p">;</span>
</span><span id="__span-5-18"><a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sCoreApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.CoreV1Api</span><span class="p">;</span>
</span><span id="__span-5-19"><a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-5-20"><a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a>
</span><span id="__span-5-21"><a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-22"><a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a><span class="w">    </span><span class="c1">// Initialize connection to your Kubernetes cluster (uses ~/.kube/config)</span>
</span><span id="__span-5-23"><a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">k8s</span><span class="p">.</span><span class="nx">KubeConfig</span><span class="p">();</span>
</span><span id="__span-5-24"><a href="#__codelineno-5-24" id="__codelineno-5-24" name="__codelineno-5-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">loadFromDefault</span><span class="p">();</span>
</span><span id="__span-5-25"><a href="#__codelineno-5-25" id="__codelineno-5-25" name="__codelineno-5-25"></a>
</span><span id="__span-5-26"><a href="#__codelineno-5-26" id="__codelineno-5-26" name="__codelineno-5-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sAppsApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">AppsV1Api</span><span class="p">);</span>
</span><span id="__span-5-27"><a href="#__codelineno-5-27" id="__codelineno-5-27" name="__codelineno-5-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">CoreV1Api</span><span class="p">);</span>
</span><span id="__span-5-28"><a href="#__codelineno-5-28" id="__codelineno-5-28" name="__codelineno-5-28"></a>
</span><span id="__span-5-29"><a href="#__codelineno-5-29" id="__codelineno-5-29" name="__codelineno-5-29"></a><span class="w">    </span><span class="c1">// Create MCP server that AI tools can connect to</span>
</span><span id="__span-5-30"><a href="#__codelineno-5-30" id="__codelineno-5-30" name="__codelineno-5-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-5-31"><a href="#__codelineno-5-31" id="__codelineno-5-31" name="__codelineno-5-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-32"><a href="#__codelineno-5-32" id="__codelineno-5-32" name="__codelineno-5-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"k-agent-logs"</span><span class="p">,</span>
</span><span id="__span-5-33"><a href="#__codelineno-5-33" id="__codelineno-5-33" name="__codelineno-5-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-5-34"><a href="#__codelineno-5-34" id="__codelineno-5-34" name="__codelineno-5-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-5-35"><a href="#__codelineno-5-35" id="__codelineno-5-35" name="__codelineno-5-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-36"><a href="#__codelineno-5-36" id="__codelineno-5-36" name="__codelineno-5-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-37"><a href="#__codelineno-5-37" id="__codelineno-5-37" name="__codelineno-5-37"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-38"><a href="#__codelineno-5-38" id="__codelineno-5-38" name="__codelineno-5-38"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-39"><a href="#__codelineno-5-39" id="__codelineno-5-39" name="__codelineno-5-39"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-40"><a href="#__codelineno-5-40" id="__codelineno-5-40" name="__codelineno-5-40"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-5-41"><a href="#__codelineno-5-41" id="__codelineno-5-41" name="__codelineno-5-41"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-5-42"><a href="#__codelineno-5-42" id="__codelineno-5-42" name="__codelineno-5-42"></a>
</span><span id="__span-5-43"><a href="#__codelineno-5-43" id="__codelineno-5-43" name="__codelineno-5-43"></a><span class="w">    </span><span class="c1">// Handle incoming MCP requests (you'll add tools here next)</span>
</span><span id="__span-5-44"><a href="#__codelineno-5-44" id="__codelineno-5-44" name="__codelineno-5-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-5-45"><a href="#__codelineno-5-45" id="__codelineno-5-45" name="__codelineno-5-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-46"><a href="#__codelineno-5-46" id="__codelineno-5-46" name="__codelineno-5-46"></a>
</span><span id="__span-5-47"><a href="#__codelineno-5-47" id="__codelineno-5-47" name="__codelineno-5-47"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-48"><a href="#__codelineno-5-48" id="__codelineno-5-48" name="__codelineno-5-48"></a><span class="w">    </span><span class="c1">// TODO: Implement MCP handlers</span>
</span><span id="__span-5-49"><a href="#__codelineno-5-49" id="__codelineno-5-49" name="__codelineno-5-49"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-50"><a href="#__codelineno-5-50" id="__codelineno-5-50" name="__codelineno-5-50"></a>
</span><span id="__span-5-51"><a href="#__codelineno-5-51" id="__codelineno-5-51" name="__codelineno-5-51"></a><span class="w">  </span><span class="c1">// Start the server and listen for connections</span>
</span><span id="__span-5-52"><a href="#__codelineno-5-52" id="__codelineno-5-52" name="__codelineno-5-52"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-53"><a href="#__codelineno-5-53" id="__codelineno-5-53" name="__codelineno-5-53"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-5-54"><a href="#__codelineno-5-54" id="__codelineno-5-54" name="__codelineno-5-54"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-5-55"><a href="#__codelineno-5-55" id="__codelineno-5-55" name="__codelineno-5-55"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"K-Agent MCP server running on stdio"</span><span class="p">);</span>
</span><span id="__span-5-56"><a href="#__codelineno-5-56" id="__codelineno-5-56" name="__codelineno-5-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-57"><a href="#__codelineno-5-57" id="__codelineno-5-57" name="__codelineno-5-57"></a><span class="p">}</span>
</span><span id="__span-5-58"><a href="#__codelineno-5-58" id="__codelineno-5-58" name="__codelineno-5-58"></a>
</span><span id="__span-5-59"><a href="#__codelineno-5-59" id="__codelineno-5-59" name="__codelineno-5-59"></a><span class="c1">// Actually run the server</span>
</span><span id="__span-5-60"><a href="#__codelineno-5-60" id="__codelineno-5-60" name="__codelineno-5-60"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="p">();</span>
</span><span id="__span-5-61"><a href="#__codelineno-5-61" id="__codelineno-5-61" name="__codelineno-5-61"></a><span class="nx">server</span><span class="p">.</span><span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div> <p><br/></p> <p>Create a file named <code>tsconfig.json</code> inside the <code>k-agent-logs</code> directory (not inside <code>src</code>):</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w">  </span><span class="c1"># Go back to k-agent-logs directory</span>
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>touch<span class="w"> </span>tsconfig.json
</span></code></pre></div> <p><br/></p> <p>Paste the following content into <code>tsconfig.json</code>:</p> <div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="w">  </span><span class="nt">"compilerOptions"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="w">    </span><span class="nt">"target"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ES2022"</span><span class="p">,</span>
</span><span id="__span-7-4"><a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="w">    </span><span class="nt">"module"</span><span class="p">:</span><span class="w"> </span><span class="s2">"commonjs"</span><span class="p">,</span>
</span><span id="__span-7-5"><a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="w">    </span><span class="nt">"lib"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ES2022"</span><span class="p">],</span>
</span><span id="__span-7-6"><a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="w">    </span><span class="nt">"outDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./dist"</span><span class="p">,</span>
</span><span id="__span-7-7"><a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="w">    </span><span class="nt">"rootDir"</span><span class="p">:</span><span class="w"> </span><span class="s2">"./src"</span><span class="p">,</span>
</span><span id="__span-7-8"><a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="w">    </span><span class="nt">"strict"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-9"><a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="w">    </span><span class="nt">"esModuleInterop"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-10"><a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="w">    </span><span class="nt">"skipLibCheck"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-11"><a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="w">    </span><span class="nt">"forceConsistentCasingInFileNames"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-12"><a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="w">    </span><span class="nt">"resolveJsonModule"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-13"><a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="w">    </span><span class="nt">"declaration"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-14"><a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a><span class="w">    </span><span class="nt">"declarationMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-15"><a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="w">    </span><span class="nt">"sourceMap"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-7-16"><a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-7-17"><a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="w">  </span><span class="nt">"include"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"src/**/*"</span><span class="p">],</span>
</span><span id="__span-7-18"><a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="w">  </span><span class="nt">"exclude"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"node_modules"</span><span class="p">,</span><span class="w"> </span><span class="s2">"dist"</span><span class="p">]</span>
</span><span id="__span-7-19"><a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Test that it works:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a>npm<span class="w"> </span>run<span class="w"> </span>dev
</span></code></pre></div> <p>You should see: <code>K-Agent MCP server running on stdio</code></p> <p><br/></p> <p>!!! warning “If you get errors:” - <code>Missing script: "dev"</code> → You didn’t update package.json (go back to step 2) - <code>Cannot find module</code> → Make sure you’re in the k-agent-logs directory - Other errors → Check that src/index.ts has the correct code</p> <hr/> <h3 id="step-3-pod-discovery-tool">Step 3: Pod Discovery Tool<a class="headerlink" href="#step-3-pod-discovery-tool" title="Permanent link">¶</a></h3> <p>Implement pod enumeration across namespaces with the <code>list_pods</code> tool.</p> <p><br/></p> <h4 id="update-setuphandlers-method">Update setupHandlers() Method<a class="headerlink" href="#update-setuphandlers-method" title="Permanent link">¶</a></h4> <p>Open your <code>src/index.ts</code> file and find the <code>setupHandlers()</code> method. Replace the entire method with the following code:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="w">  </span><span class="c1">// List available tools</span>
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"list_pods"</span><span class="p">,</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"List all pods across namespaces with their status"</span><span class="p">,</span>
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-12"><a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-13"><a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-9-14"><a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Optional: Filter by specific namespace"</span>
</span><span id="__span-9-15"><a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-9-16"><a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-17"><a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-9-18"><a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-9-19"><a href="#__codelineno-9-19" id="__codelineno-9-19" name="__codelineno-9-19"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-9-20"><a href="#__codelineno-9-20" id="__codelineno-9-20" name="__codelineno-9-20"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-9-21"><a href="#__codelineno-9-21" id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-9-22"><a href="#__codelineno-9-22" id="__codelineno-9-22" name="__codelineno-9-22"></a>
</span><span id="__span-9-23"><a href="#__codelineno-9-23" id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="w">  </span><span class="c1">// Handle tool calls</span>
</span><span id="__span-9-24"><a href="#__codelineno-9-24" id="__codelineno-9-24" name="__codelineno-9-24"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-25"><a href="#__codelineno-9-25" id="__codelineno-9-25" name="__codelineno-9-25"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-9-26"><a href="#__codelineno-9-26" id="__codelineno-9-26" name="__codelineno-9-26"></a>
</span><span id="__span-9-27"><a href="#__codelineno-9-27" id="__codelineno-9-27" name="__codelineno-9-27"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-28"><a href="#__codelineno-9-28" id="__codelineno-9-28" name="__codelineno-9-28"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-29"><a href="#__codelineno-9-29" id="__codelineno-9-29" name="__codelineno-9-29"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"list_pods"</span><span class="o">:</span>
</span><span id="__span-9-30"><a href="#__codelineno-9-30" id="__codelineno-9-30" name="__codelineno-9-30"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-9-31"><a href="#__codelineno-9-31" id="__codelineno-9-31" name="__codelineno-9-31"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-9-32"><a href="#__codelineno-9-32" id="__codelineno-9-32" name="__codelineno-9-32"></a><span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-9-33"><a href="#__codelineno-9-33" id="__codelineno-9-33" name="__codelineno-9-33"></a><span class="w">            </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span>
</span><span id="__span-9-34"><a href="#__codelineno-9-34" id="__codelineno-9-34" name="__codelineno-9-34"></a><span class="w">            </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-9-35"><a href="#__codelineno-9-35" id="__codelineno-9-35" name="__codelineno-9-35"></a><span class="w">          </span><span class="p">);</span>
</span><span id="__span-9-36"><a href="#__codelineno-9-36" id="__codelineno-9-36" name="__codelineno-9-36"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-9-37"><a href="#__codelineno-9-37" id="__codelineno-9-37" name="__codelineno-9-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-38"><a href="#__codelineno-9-38" id="__codelineno-9-38" name="__codelineno-9-38"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-9-39"><a href="#__codelineno-9-39" id="__codelineno-9-39" name="__codelineno-9-39"></a><span class="w">        </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="ne">InternalError</span><span class="p">,</span>
</span><span id="__span-9-40"><a href="#__codelineno-9-40" id="__codelineno-9-40" name="__codelineno-9-40"></a><span class="w">        </span><span class="sb">`Tool execution failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-9-41"><a href="#__codelineno-9-41" id="__codelineno-9-41" name="__codelineno-9-41"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-9-42"><a href="#__codelineno-9-42" id="__codelineno-9-42" name="__codelineno-9-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-43"><a href="#__codelineno-9-43" id="__codelineno-9-43" name="__codelineno-9-43"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-9-44"><a href="#__codelineno-9-44" id="__codelineno-9-44" name="__codelineno-9-44"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <h4 id="add-handler-methods">Add Handler Methods<a class="headerlink" href="#add-handler-methods" title="Permanent link">¶</a></h4> <p>Below the <code>setupHandlers()</code> method, <strong>before the <code>async run()</code> method</strong>, add the following new methods:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">namespace</span><span class="p">;</span>
</span><span id="__span-10-3"><a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-10-4"><a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>
</span><span id="__span-10-5"><a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-10-6"><a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-10-7"><a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a><span class="w">    </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-10-8"><a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a><span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-10-9"><a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-10-10"><a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-10-11"><a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a>
</span><span id="__span-10-12"><a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-13"><a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-14"><a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-10-15"><a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-10-16"><a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-10-17"><a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-18"><a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-10-19"><a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-10-20"><a href="#__codelineno-10-20" id="__codelineno-10-20" name="__codelineno-10-20"></a><span class="p">}</span>
</span><span id="__span-10-21"><a href="#__codelineno-10-21" id="__codelineno-10-21" name="__codelineno-10-21"></a>
</span><span id="__span-10-22"><a href="#__codelineno-10-22" id="__codelineno-10-22" name="__codelineno-10-22"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-23"><a href="#__codelineno-10-23" id="__codelineno-10-23" name="__codelineno-10-23"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-24"><a href="#__codelineno-10-24" id="__codelineno-10-24" name="__codelineno-10-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-25"><a href="#__codelineno-10-25" id="__codelineno-10-25" name="__codelineno-10-25"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-10-26"><a href="#__codelineno-10-26" id="__codelineno-10-26" name="__codelineno-10-26"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-27"><a href="#__codelineno-10-27" id="__codelineno-10-27" name="__codelineno-10-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-28"><a href="#__codelineno-10-28" id="__codelineno-10-28" name="__codelineno-10-28"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">();</span>
</span><span id="__span-10-29"><a href="#__codelineno-10-29" id="__codelineno-10-29" name="__codelineno-10-29"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-30"><a href="#__codelineno-10-30" id="__codelineno-10-30" name="__codelineno-10-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-31"><a href="#__codelineno-10-31" id="__codelineno-10-31" name="__codelineno-10-31"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-32"><a href="#__codelineno-10-32" id="__codelineno-10-32" name="__codelineno-10-32"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-33"><a href="#__codelineno-10-33" id="__codelineno-10-33" name="__codelineno-10-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-34"><a href="#__codelineno-10-34" id="__codelineno-10-34" name="__codelineno-10-34"></a><span class="p">}</span>
</span><span id="__span-10-35"><a href="#__codelineno-10-35" id="__codelineno-10-35" name="__codelineno-10-35"></a>
</span><span id="__span-10-36"><a href="#__codelineno-10-36" id="__codelineno-10-36" name="__codelineno-10-36"></a><span class="k">private</span><span class="w"> </span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-37"><a href="#__codelineno-10-37" id="__codelineno-10-37" name="__codelineno-10-37"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">403</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-38"><a href="#__codelineno-10-38" id="__codelineno-10-38" name="__codelineno-10-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Access denied: Insufficient permissions to access Kubernetes resources'</span><span class="p">);</span>
</span><span id="__span-10-39"><a href="#__codelineno-10-39" id="__codelineno-10-39" name="__codelineno-10-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-40"><a href="#__codelineno-10-40" id="__codelineno-10-40" name="__codelineno-10-40"></a>
</span><span id="__span-10-41"><a href="#__codelineno-10-41" id="__codelineno-10-41" name="__codelineno-10-41"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">404</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-42"><a href="#__codelineno-10-42" id="__codelineno-10-42" name="__codelineno-10-42"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Resource not found: The specified pod or namespace may not exist'</span><span class="p">);</span>
</span><span id="__span-10-43"><a href="#__codelineno-10-43" id="__codelineno-10-43" name="__codelineno-10-43"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-44"><a href="#__codelineno-10-44" id="__codelineno-10-44" name="__codelineno-10-44"></a>
</span><span id="__span-10-45"><a href="#__codelineno-10-45" id="__codelineno-10-45" name="__codelineno-10-45"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Kubernetes operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-46"><a href="#__codelineno-10-46" id="__codelineno-10-46" name="__codelineno-10-46"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <div class="admonition success"> <p class="admonition-title">Complete <code>src/index.ts</code> After Step 3</p> </div> <p>Here’s what your complete <code>src/index.ts</code> file should look like after completing Step 3:</p> <div class="codehilite"><pre><span></span><code><span class="err">```</span><span class="n">typescript</span>
<span class="o">//</span> <span class="n">Import</span> <span class="n">MCP</span> <span class="n">SDK</span> <span class="n">components</span> <span class="ow">and</span> <span class="n">Kubernetes</span> <span class="n">client</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span> <span class="n">Server</span> <span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span> <span class="n">StdioServerTransport</span> <span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span>
  <span class="n">CallToolRequestSchema</span><span class="p">,</span>
  <span class="n">ErrorCode</span><span class="p">,</span>
  <span class="n">ListResourcesRequestSchema</span><span class="p">,</span>
  <span class="n">ListToolsRequestSchema</span><span class="p">,</span>
  <span class="n">McpError</span><span class="p">,</span>
  <span class="n">ReadResourceRequestSchema</span><span class="p">,</span>
<span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="o">*</span> <span class="k">as</span> <span class="n">k8s</span> <span class="kn">from</span><span class="w"> </span><span class="s1">'@kubernetes/client-node'</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">KAgentServer</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">Store</span> <span class="n">Kubernetes</span> <span class="n">API</span> <span class="n">clients</span> <span class="p">(</span><span class="k">for</span> <span class="n">talking</span> <span class="n">to</span> <span class="n">your</span> <span class="n">cluster</span><span class="p">)</span>
  <span class="n">private</span> <span class="n">k8sConfig</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">KubeConfig</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">k8sAppsApi</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">AppsV1Api</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">k8sCoreApi</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">server</span><span class="p">:</span> <span class="n">Server</span><span class="p">;</span>

  <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Initialize</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">your</span> <span class="n">Kubernetes</span> <span class="n">cluster</span> <span class="p">(</span><span class="n">uses</span> <span class="o">~/.</span><span class="n">kube</span><span class="o">/</span><span class="n">config</span><span class="p">)</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span> <span class="o">=</span> <span class="n">new</span> <span class="n">k8s</span><span class="o">.</span><span class="n">KubeConfig</span><span class="p">();</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">loadFromDefault</span><span class="p">();</span>

    <span class="n">this</span><span class="o">.</span><span class="n">k8sAppsApi</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">makeApiClient</span><span class="p">(</span><span class="n">k8s</span><span class="o">.</span><span class="n">AppsV1Api</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">makeApiClient</span><span class="p">(</span><span class="n">k8s</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Create</span> <span class="n">MCP</span> <span class="n">server</span> <span class="n">that</span> <span class="n">AI</span> <span class="n">tools</span> <span class="n">can</span> <span class="n">connect</span> <span class="n">to</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Server</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">"k-agent-logs"</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="n">capabilities</span><span class="p">:</span> <span class="p">{</span>
          <span class="n">tools</span><span class="p">:</span> <span class="p">{},</span>
          <span class="n">resources</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">},</span>
      <span class="p">}</span>
    <span class="p">);</span>

    <span class="o">//</span> <span class="n">Handle</span> <span class="n">incoming</span> <span class="n">MCP</span> <span class="n">requests</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setupHandlers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="n">setupHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">List</span> <span class="n">available</span> <span class="n">tools</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">setRequestHandler</span><span class="p">(</span><span class="n">ListToolsRequestSchema</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="n">tools</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">"list_pods"</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="s2">"List all pods across namespaces with their status"</span><span class="p">,</span>
            <span class="n">inputSchema</span><span class="p">:</span> <span class="p">{</span>
              <span class="nb">type</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
              <span class="n">properties</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">namespace</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nb">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
                  <span class="n">description</span><span class="p">:</span> <span class="s2">"Optional: Filter by specific namespace"</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">};</span>
    <span class="p">});</span>

    <span class="o">//</span> <span class="n">Handle</span> <span class="n">tool</span> <span class="n">calls</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">setRequestHandler</span><span class="p">(</span><span class="n">CallToolRequestSchema</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">const</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">args</span> <span class="p">}</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s2">"list_pods"</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">handleListPods</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
          <span class="n">default</span><span class="p">:</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="n">McpError</span><span class="p">(</span>
              <span class="n">ErrorCode</span><span class="o">.</span><span class="n">MethodNotFound</span><span class="p">,</span>
              <span class="err">`</span><span class="n">Unknown</span> <span class="n">tool</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="err">`</span>
            <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">McpError</span><span class="p">(</span>
          <span class="n">ErrorCode</span><span class="o">.</span><span class="n">InternalError</span><span class="p">,</span>
          <span class="err">`</span><span class="n">Tool</span> <span class="n">execution</span> <span class="n">failed</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">error</span> <span class="n">instanceof</span> <span class="n">Error</span> <span class="err">?</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span> <span class="p">:</span> <span class="n">String</span><span class="p">(</span><span class="n">error</span><span class="p">)}</span><span class="err">`</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">handleListPods</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">args</span><span class="err">?</span><span class="o">.</span><span class="n">namespace</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">pods</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="p">);</span>

    <span class="n">const</span> <span class="n">podList</span> <span class="o">=</span> <span class="n">pods</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pod</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">name</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">namespace</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">status</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">status</span><span class="err">?</span><span class="o">.</span><span class="n">phase</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">containers</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">spec</span><span class="err">?</span><span class="o">.</span><span class="n">containers</span><span class="err">?</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">c</span> <span class="o">=&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]</span>
    <span class="p">}));</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="n">content</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nb">type</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span>
          <span class="n">text</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">podList</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="err">?</span><span class="p">:</span> <span class="n">string</span><span class="p">):</span> <span class="n">Promise</span><span class="o">&lt;</span><span class="n">k8s</span><span class="o">.</span><span class="n">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">namespace</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span><span class="o">.</span><span class="n">listNamespacedPod</span><span class="p">({</span> <span class="n">namespace</span> <span class="p">});</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span><span class="o">.</span><span class="n">listPodForAllNamespaces</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">throw</span> <span class="n">this</span><span class="o">.</span><span class="n">handleK8sError</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="n">handleK8sError</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nb">any</span><span class="p">):</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="err">?</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">===</span> <span class="mi">403</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">'Access denied: Insufficient permissions to access Kubernetes resources'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="err">?</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">===</span> <span class="mi">404</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">'Resource not found: The specified pod or namespace may not exist'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="err">`</span><span class="n">Kubernetes</span> <span class="n">operation</span> <span class="n">failed</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="o">//</span> <span class="n">Start</span> <span class="n">the</span> <span class="n">server</span> <span class="ow">and</span> <span class="n">listen</span> <span class="k">for</span> <span class="n">connections</span>
  <span class="k">async</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">transport</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StdioServerTransport</span><span class="p">();</span>
    <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="p">);</span>
    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"K-Agent MCP server running on stdio"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Actually</span> <span class="n">run</span> <span class="n">the</span> <span class="n">server</span>
<span class="n">const</span> <span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">KAgentServer</span><span class="p">();</span>
<span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">);</span>
<span class="err">```</span>
</code></pre></div> <p><br/></p> <h4 id="test-pod-discovery">Test Pod Discovery<a class="headerlink" href="#test-pod-discovery" title="Permanent link">¶</a></h4> <p>Test the pod listing functionality using the MCP Inspector by running:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p>This will start the MCP Inspector connected to your K-Agent server and open a browser window.</p> <p><strong>Inside the MCP Inspector UI browser window:</strong></p> <ol> <li>Click the <strong>“Connect”</strong> button</li> <li>Click the <strong>“Tools”</strong> tab</li> <li>Click <strong>“List Tools”</strong> - you’ll see the <code>list_pods</code> tool</li> <li>Click on <strong><code>list_pods</code></strong></li> <li>Optionally enter a namespace name</li> <li>Click <strong>“Run Tool”</strong> to test it</li> </ol> <p>You should see a JSON list of all pods with their status and container names.</p> <hr/> <h3 id="step-4-log-collection-tool">Step 4: Log Collection Tool<a class="headerlink" href="#step-4-log-collection-tool" title="Permanent link">¶</a></h3> <p>Build the core log collection functionality with the <code>collect_pod_logs</code> tool.</p> <p><br/></p> <h4 id="add-collect_pod_logs-to-tools-array">Add collect_pod_logs to Tools Array<a class="headerlink" href="#add-collect_pod_logs-to-tools-array" title="Permanent link">¶</a></h4> <p>In your <code>src/index.ts</code> file, locate the tools array inside <code>setupHandlers()</code> method.</p> <p>Add the following second tool code to the array:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a href="#__codelineno-13-2" id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="w">  </span><span class="c1">// List available tools</span>
</span><span id="__span-13-3"><a href="#__codelineno-13-3" id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><a href="#__codelineno-13-4" id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a href="#__codelineno-13-5" id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-6"><a href="#__codelineno-13-6" id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-13-7"><a href="#__codelineno-13-7" id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"list_pods"</span><span class="p">,</span>
</span><span id="__span-13-8"><a href="#__codelineno-13-8" id="__codelineno-13-8" name="__codelineno-13-8"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"List all pods across namespaces with their status"</span><span class="p">,</span>
</span><span id="__span-13-9"><a href="#__codelineno-13-9" id="__codelineno-13-9" name="__codelineno-13-9"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><a href="#__codelineno-13-10" id="__codelineno-13-10" name="__codelineno-13-10"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-13-11"><a href="#__codelineno-13-11" id="__codelineno-13-11" name="__codelineno-13-11"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-12"><a href="#__codelineno-13-12" id="__codelineno-13-12" name="__codelineno-13-12"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-13"><a href="#__codelineno-13-13" id="__codelineno-13-13" name="__codelineno-13-13"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-13-14"><a href="#__codelineno-13-14" id="__codelineno-13-14" name="__codelineno-13-14"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Optional: Filter by specific namespace"</span>
</span><span id="__span-13-15"><a href="#__codelineno-13-15" id="__codelineno-13-15" name="__codelineno-13-15"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-13-16"><a href="#__codelineno-13-16" id="__codelineno-13-16" name="__codelineno-13-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-13-17"><a href="#__codelineno-13-17" id="__codelineno-13-17" name="__codelineno-13-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-13-18"><a href="#__codelineno-13-18" id="__codelineno-13-18" name="__codelineno-13-18"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-13-19"><a href="#__codelineno-13-19" id="__codelineno-13-19" name="__codelineno-13-19"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-13-20"><a href="#__codelineno-13-20" id="__codelineno-13-20" name="__codelineno-13-20"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"collect_pod_logs"</span><span class="p">,</span>
</span><span id="__span-13-21"><a href="#__codelineno-13-21" id="__codelineno-13-21" name="__codelineno-13-21"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Collect logs from all containers in specified pods"</span><span class="p">,</span>
</span><span id="__span-13-22"><a href="#__codelineno-13-22" id="__codelineno-13-22" name="__codelineno-13-22"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-23"><a href="#__codelineno-13-23" id="__codelineno-13-23" name="__codelineno-13-23"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-13-24"><a href="#__codelineno-13-24" id="__codelineno-13-24" name="__codelineno-13-24"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-25"><a href="#__codelineno-13-25" id="__codelineno-13-25" name="__codelineno-13-25"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-26"><a href="#__codelineno-13-26" id="__codelineno-13-26" name="__codelineno-13-26"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-13-27"><a href="#__codelineno-13-27" id="__codelineno-13-27" name="__codelineno-13-27"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Namespace to collect logs from"</span>
</span><span id="__span-13-28"><a href="#__codelineno-13-28" id="__codelineno-13-28" name="__codelineno-13-28"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-13-29"><a href="#__codelineno-13-29" id="__codelineno-13-29" name="__codelineno-13-29"></a><span class="w">              </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-30"><a href="#__codelineno-13-30" id="__codelineno-13-30" name="__codelineno-13-30"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-13-31"><a href="#__codelineno-13-31" id="__codelineno-13-31" name="__codelineno-13-31"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Specific pod name (optional - collects from all if not specified)"</span>
</span><span id="__span-13-32"><a href="#__codelineno-13-32" id="__codelineno-13-32" name="__codelineno-13-32"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-13-33"><a href="#__codelineno-13-33" id="__codelineno-13-33" name="__codelineno-13-33"></a><span class="w">              </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-34"><a href="#__codelineno-13-34" id="__codelineno-13-34" name="__codelineno-13-34"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-13-35"><a href="#__codelineno-13-35" id="__codelineno-13-35" name="__codelineno-13-35"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Number of recent log lines to retrieve"</span><span class="p">,</span>
</span><span id="__span-13-36"><a href="#__codelineno-13-36" id="__codelineno-13-36" name="__codelineno-13-36"></a><span class="w">                </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-13-37"><a href="#__codelineno-13-37" id="__codelineno-13-37" name="__codelineno-13-37"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-13-38"><a href="#__codelineno-13-38" id="__codelineno-13-38" name="__codelineno-13-38"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-13-39"><a href="#__codelineno-13-39" id="__codelineno-13-39" name="__codelineno-13-39"></a><span class="w">            </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span>
</span><span id="__span-13-40"><a href="#__codelineno-13-40" id="__codelineno-13-40" name="__codelineno-13-40"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-13-41"><a href="#__codelineno-13-41" id="__codelineno-13-41" name="__codelineno-13-41"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-13-42"><a href="#__codelineno-13-42" id="__codelineno-13-42" name="__codelineno-13-42"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-13-43"><a href="#__codelineno-13-43" id="__codelineno-13-43" name="__codelineno-13-43"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-13-44"><a href="#__codelineno-13-44" id="__codelineno-13-44" name="__codelineno-13-44"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-13-45"><a href="#__codelineno-13-45" id="__codelineno-13-45" name="__codelineno-13-45"></a><span class="w">  </span><span class="c1">// ... rest of setupHandlers</span>
</span><span id="__span-13-46"><a href="#__codelineno-13-46" id="__codelineno-13-46" name="__codelineno-13-46"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <h4 id="update-tool-handler-switch">Update Tool Handler Switch<a class="headerlink" href="#update-tool-handler-switch" title="Permanent link">¶</a></h4> <p>In the same <code>setupHandlers()</code> method, locate the switch statement and add the following case for <code>collect_pod_logs</code>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">"list_pods"</span><span class="o">:</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">"collect_pod_logs"</span><span class="o">:</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">  </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">    </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span><span class="w"> </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <h4 id="implement-log-collection-methods">Implement Log Collection Methods<a class="headerlink" href="#implement-log-collection-methods" title="Permanent link">¶</a></h4> <p>Below your existing handler methods (after <code>handleK8sError()</code>), <strong>before the <code>async run()</code> method</strong>, add the following new methods:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Namespace is required"</span><span class="p">);</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">logs</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="p">}</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a>
</span><span id="__span-15-20"><a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-21"><a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">podName</span>
</span><span id="__span-15-22"><a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">pods</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">podName</span><span class="p">))</span>
</span><span id="__span-15-23"><a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-15-24"><a href="#__codelineno-15-24" id="__codelineno-15-24" name="__codelineno-15-24"></a>
</span><span id="__span-15-25"><a href="#__codelineno-15-25" id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">allLogs</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-15-26"><a href="#__codelineno-15-26" id="__codelineno-15-26" name="__codelineno-15-26"></a>
</span><span id="__span-15-27"><a href="#__codelineno-15-27" id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">pod</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-28"><a href="#__codelineno-15-28" id="__codelineno-15-28" name="__codelineno-15-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-15-29"><a href="#__codelineno-15-29" id="__codelineno-15-29" name="__codelineno-15-29"></a>
</span><span id="__span-15-30"><a href="#__codelineno-15-30" id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">containers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">spec</span><span class="o">?</span><span class="p">.</span><span class="nx">containers</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-15-31"><a href="#__codelineno-15-31" id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">containers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-32"><a href="#__codelineno-15-32" id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-33"><a href="#__codelineno-15-33" id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-15-34"><a href="#__codelineno-15-34" id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w">        </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\n</span><span class="si">${</span><span class="nx">logs</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-15-35"><a href="#__codelineno-15-35" id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-36"><a href="#__codelineno-15-36" id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">        </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\nError retrieving logs: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-15-37"><a href="#__codelineno-15-37" id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-38"><a href="#__codelineno-15-38" id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-39"><a href="#__codelineno-15-39" id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-40"><a href="#__codelineno-15-40" id="__codelineno-15-40" name="__codelineno-15-40"></a>
</span><span id="__span-15-41"><a href="#__codelineno-15-41" id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
</span><span id="__span-15-42"><a href="#__codelineno-15-42" id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="p">}</span>
</span><span id="__span-15-43"><a href="#__codelineno-15-43" id="__codelineno-15-43" name="__codelineno-15-43"></a>
</span><span id="__span-15-44"><a href="#__codelineno-15-44" id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">containerName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-45"><a href="#__codelineno-15-45" id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-46"><a href="#__codelineno-15-46" id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">readNamespacedPodLog</span><span class="p">({</span>
</span><span id="__span-15-47"><a href="#__codelineno-15-47" id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">podName</span><span class="p">,</span>
</span><span id="__span-15-48"><a href="#__codelineno-15-48" id="__codelineno-15-48" name="__codelineno-15-48"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">namespace</span><span class="p">,</span>
</span><span id="__span-15-49"><a href="#__codelineno-15-49" id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">      </span><span class="nx">container</span><span class="o">:</span><span class="w"> </span><span class="kt">containerName</span><span class="p">,</span>
</span><span id="__span-15-50"><a href="#__codelineno-15-50" id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">      </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">tailLines</span><span class="p">,</span>
</span><span id="__span-15-51"><a href="#__codelineno-15-51" id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">      </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-15-52"><a href="#__codelineno-15-52" id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-53"><a href="#__codelineno-15-53" id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
</span><span id="__span-15-54"><a href="#__codelineno-15-54" id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-55"><a href="#__codelineno-15-55" id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-56"><a href="#__codelineno-15-56" id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-57"><a href="#__codelineno-15-57" id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="p">}</span>
</span></code></pre></div> <div class="admonition success"> <p class="admonition-title">Complete <code>src/index.ts</code> After Step 4</p> </div> <p>Here’s what your complete <code>src/index.ts</code> file should look like after completing Step 4:</p> <div class="codehilite"><pre><span></span><code><span class="err">```</span><span class="n">typescript</span>
<span class="o">//</span> <span class="n">Import</span> <span class="n">MCP</span> <span class="n">SDK</span> <span class="n">components</span> <span class="ow">and</span> <span class="n">Kubernetes</span> <span class="n">client</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span> <span class="n">Server</span> <span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span> <span class="n">StdioServerTransport</span> <span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="p">{</span>
  <span class="n">CallToolRequestSchema</span><span class="p">,</span>
  <span class="n">ErrorCode</span><span class="p">,</span>
  <span class="n">ListResourcesRequestSchema</span><span class="p">,</span>
  <span class="n">ListToolsRequestSchema</span><span class="p">,</span>
  <span class="n">McpError</span><span class="p">,</span>
  <span class="n">ReadResourceRequestSchema</span><span class="p">,</span>
<span class="p">}</span> <span class="kn">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
<span class="kn">import</span><span class="w"> </span><span class="o">*</span> <span class="k">as</span> <span class="n">k8s</span> <span class="kn">from</span><span class="w"> </span><span class="s1">'@kubernetes/client-node'</span><span class="p">;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">KAgentServer</span> <span class="p">{</span>
  <span class="o">//</span> <span class="n">Store</span> <span class="n">Kubernetes</span> <span class="n">API</span> <span class="n">clients</span> <span class="p">(</span><span class="k">for</span> <span class="n">talking</span> <span class="n">to</span> <span class="n">your</span> <span class="n">cluster</span><span class="p">)</span>
  <span class="n">private</span> <span class="n">k8sConfig</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">KubeConfig</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">k8sAppsApi</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">AppsV1Api</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">k8sCoreApi</span><span class="p">:</span> <span class="n">k8s</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">;</span>
  <span class="n">private</span> <span class="n">server</span><span class="p">:</span> <span class="n">Server</span><span class="p">;</span>

  <span class="n">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">Initialize</span> <span class="n">connection</span> <span class="n">to</span> <span class="n">your</span> <span class="n">Kubernetes</span> <span class="n">cluster</span> <span class="p">(</span><span class="n">uses</span> <span class="o">~/.</span><span class="n">kube</span><span class="o">/</span><span class="n">config</span><span class="p">)</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span> <span class="o">=</span> <span class="n">new</span> <span class="n">k8s</span><span class="o">.</span><span class="n">KubeConfig</span><span class="p">();</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">loadFromDefault</span><span class="p">();</span>

    <span class="n">this</span><span class="o">.</span><span class="n">k8sAppsApi</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">makeApiClient</span><span class="p">(</span><span class="n">k8s</span><span class="o">.</span><span class="n">AppsV1Api</span><span class="p">);</span>
    <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span> <span class="o">=</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sConfig</span><span class="o">.</span><span class="n">makeApiClient</span><span class="p">(</span><span class="n">k8s</span><span class="o">.</span><span class="n">CoreV1Api</span><span class="p">);</span>

    <span class="o">//</span> <span class="n">Create</span> <span class="n">MCP</span> <span class="n">server</span> <span class="n">that</span> <span class="n">AI</span> <span class="n">tools</span> <span class="n">can</span> <span class="n">connect</span> <span class="n">to</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Server</span><span class="p">(</span>
      <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s2">"k-agent-logs"</span><span class="p">,</span>
        <span class="n">version</span><span class="p">:</span> <span class="s2">"1.0.0"</span><span class="p">,</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="n">capabilities</span><span class="p">:</span> <span class="p">{</span>
          <span class="n">tools</span><span class="p">:</span> <span class="p">{},</span>
          <span class="n">resources</span><span class="p">:</span> <span class="p">{},</span>
        <span class="p">},</span>
      <span class="p">}</span>
    <span class="p">);</span>

    <span class="o">//</span> <span class="n">Handle</span> <span class="n">incoming</span> <span class="n">MCP</span> <span class="n">requests</span>
    <span class="n">this</span><span class="o">.</span><span class="n">setupHandlers</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="n">setupHandlers</span><span class="p">()</span> <span class="p">{</span>
    <span class="o">//</span> <span class="n">List</span> <span class="n">available</span> <span class="n">tools</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">setRequestHandler</span><span class="p">(</span><span class="n">ListToolsRequestSchema</span><span class="p">,</span> <span class="k">async</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">{</span>
        <span class="n">tools</span><span class="p">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">"list_pods"</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="s2">"List all pods across namespaces with their status"</span><span class="p">,</span>
            <span class="n">inputSchema</span><span class="p">:</span> <span class="p">{</span>
              <span class="nb">type</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
              <span class="n">properties</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">namespace</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nb">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
                  <span class="n">description</span><span class="p">:</span> <span class="s2">"Optional: Filter by specific namespace"</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="n">name</span><span class="p">:</span> <span class="s2">"collect_pod_logs"</span><span class="p">,</span>
            <span class="n">description</span><span class="p">:</span> <span class="s2">"Collect logs from all containers in specified pods"</span><span class="p">,</span>
            <span class="n">inputSchema</span><span class="p">:</span> <span class="p">{</span>
              <span class="nb">type</span><span class="p">:</span> <span class="s2">"object"</span><span class="p">,</span>
              <span class="n">properties</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">namespace</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nb">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
                  <span class="n">description</span><span class="p">:</span> <span class="s2">"Namespace to collect logs from"</span>
                <span class="p">},</span>
                <span class="n">podName</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nb">type</span><span class="p">:</span> <span class="s2">"string"</span><span class="p">,</span>
                  <span class="n">description</span><span class="p">:</span> <span class="s2">"Specific pod name (optional - collects from all if not specified)"</span>
                <span class="p">},</span>
                <span class="n">tailLines</span><span class="p">:</span> <span class="p">{</span>
                  <span class="nb">type</span><span class="p">:</span> <span class="s2">"number"</span><span class="p">,</span>
                  <span class="n">description</span><span class="p">:</span> <span class="s2">"Number of recent log lines to retrieve"</span><span class="p">,</span>
                  <span class="n">default</span><span class="p">:</span> <span class="mi">100</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="n">required</span><span class="p">:</span> <span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">};</span>
    <span class="p">});</span>

    <span class="o">//</span> <span class="n">Handle</span> <span class="n">tool</span> <span class="n">calls</span>
    <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">setRequestHandler</span><span class="p">(</span><span class="n">CallToolRequestSchema</span><span class="p">,</span> <span class="k">async</span> <span class="p">(</span><span class="n">request</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="n">const</span> <span class="p">{</span> <span class="n">name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">args</span> <span class="p">}</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="p">;</span>

      <span class="k">try</span> <span class="p">{</span>
        <span class="n">switch</span> <span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">case</span> <span class="s2">"list_pods"</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">handleListPods</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
          <span class="k">case</span> <span class="s2">"collect_pod_logs"</span><span class="p">:</span>
            <span class="k">return</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">handleCollectPodLogs</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
          <span class="n">default</span><span class="p">:</span>
            <span class="n">throw</span> <span class="n">new</span> <span class="n">McpError</span><span class="p">(</span>
              <span class="n">ErrorCode</span><span class="o">.</span><span class="n">MethodNotFound</span><span class="p">,</span>
              <span class="err">`</span><span class="n">Unknown</span> <span class="n">tool</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">name</span><span class="p">}</span><span class="err">`</span>
            <span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">throw</span> <span class="n">new</span> <span class="n">McpError</span><span class="p">(</span>
          <span class="n">ErrorCode</span><span class="o">.</span><span class="n">InternalError</span><span class="p">,</span>
          <span class="err">`</span><span class="n">Tool</span> <span class="n">execution</span> <span class="n">failed</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">error</span> <span class="n">instanceof</span> <span class="n">Error</span> <span class="err">?</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span> <span class="p">:</span> <span class="n">String</span><span class="p">(</span><span class="n">error</span><span class="p">)}</span><span class="err">`</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">handleListPods</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">args</span><span class="err">?</span><span class="o">.</span><span class="n">namespace</span><span class="p">;</span>
    <span class="n">const</span> <span class="n">pods</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="p">);</span>

    <span class="n">const</span> <span class="n">podList</span> <span class="o">=</span> <span class="n">pods</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">pod</span> <span class="o">=&gt;</span> <span class="p">({</span>
      <span class="n">name</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">name</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">namespace</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">namespace</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">status</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">status</span><span class="err">?</span><span class="o">.</span><span class="n">phase</span> <span class="o">||</span> <span class="s1">'unknown'</span><span class="p">,</span>
      <span class="n">containers</span><span class="p">:</span> <span class="n">pod</span><span class="o">.</span><span class="n">spec</span><span class="err">?</span><span class="o">.</span><span class="n">containers</span><span class="err">?</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">c</span> <span class="o">=&gt;</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">||</span> <span class="p">[]</span>
    <span class="p">}));</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="n">content</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nb">type</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span>
          <span class="n">text</span><span class="p">:</span> <span class="n">JSON</span><span class="o">.</span><span class="n">stringify</span><span class="p">(</span><span class="n">podList</span><span class="p">,</span> <span class="n">null</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">handleCollectPodLogs</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="nb">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">const</span> <span class="p">{</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">podName</span><span class="p">,</span> <span class="n">tailLines</span> <span class="o">=</span> <span class="mi">100</span> <span class="p">}</span> <span class="o">=</span> <span class="n">args</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">namespace</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">throw</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s2">"Namespace is required"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">const</span> <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">collectPodLogs</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">podName</span><span class="p">,</span> <span class="n">tailLines</span><span class="p">);</span>

    <span class="k">return</span> <span class="p">{</span>
      <span class="n">content</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="nb">type</span><span class="p">:</span> <span class="s2">"text"</span><span class="p">,</span>
          <span class="n">text</span><span class="p">:</span> <span class="n">logs</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">};</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">collectPodLogs</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">podName</span><span class="err">?</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">tailLines</span><span class="p">:</span> <span class="n">number</span> <span class="o">=</span> <span class="mi">100</span><span class="p">):</span> <span class="n">Promise</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">pods</span> <span class="o">=</span> <span class="n">podName</span>
      <span class="err">?</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span><span class="o">.</span><span class="n">then</span><span class="p">(</span><span class="n">pods</span> <span class="o">=&gt;</span> <span class="n">pods</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">p</span> <span class="o">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">name</span> <span class="o">===</span> <span class="n">podName</span><span class="p">))</span>
      <span class="p">:</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="p">);</span>

    <span class="n">const</span> <span class="n">allLogs</span><span class="p">:</span> <span class="n">string</span><span class="p">[]</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">pod</span> <span class="n">of</span> <span class="n">pods</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="err">!</span><span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="err">?</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>

      <span class="n">const</span> <span class="n">containers</span> <span class="o">=</span> <span class="n">pod</span><span class="o">.</span><span class="n">spec</span><span class="err">?</span><span class="o">.</span><span class="n">containers</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="k">for</span> <span class="p">(</span><span class="n">const</span> <span class="n">container</span> <span class="n">of</span> <span class="n">containers</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="n">const</span> <span class="n">logs</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">getPodLogs</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">container</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">tailLines</span><span class="p">);</span>
          <span class="n">allLogs</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="err">`</span><span class="o">===</span> <span class="err">$</span><span class="p">{</span><span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">}</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">container</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> <span class="o">===</span>\<span class="n">n</span><span class="err">$</span><span class="p">{</span><span class="n">logs</span><span class="p">}</span>\<span class="n">n</span><span class="err">`</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">allLogs</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="err">`</span><span class="o">===</span> <span class="err">$</span><span class="p">{</span><span class="n">pod</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">name</span><span class="p">}</span><span class="o">/</span><span class="err">$</span><span class="p">{</span><span class="n">container</span><span class="o">.</span><span class="n">name</span><span class="p">}</span> <span class="o">===</span>\<span class="n">nError</span> <span class="n">retrieving</span> <span class="n">logs</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">error</span> <span class="n">instanceof</span> <span class="n">Error</span> <span class="err">?</span> <span class="n">error</span><span class="o">.</span><span class="n">message</span> <span class="p">:</span> <span class="n">String</span><span class="p">(</span><span class="n">error</span><span class="p">)}</span>\<span class="n">n</span><span class="err">`</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">allLogs</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">getPods</span><span class="p">(</span><span class="n">namespace</span><span class="err">?</span><span class="p">:</span> <span class="n">string</span><span class="p">):</span> <span class="n">Promise</span><span class="o">&lt;</span><span class="n">k8s</span><span class="o">.</span><span class="n">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">namespace</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span><span class="o">.</span><span class="n">listNamespacedPod</span><span class="p">({</span> <span class="n">namespace</span> <span class="p">});</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span><span class="o">.</span><span class="n">listPodForAllNamespaces</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">items</span> <span class="o">||</span> <span class="p">[];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">throw</span> <span class="n">this</span><span class="o">.</span><span class="n">handleK8sError</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="k">async</span> <span class="n">getPodLogs</span><span class="p">(</span><span class="n">namespace</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">podName</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">containerName</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">tailLines</span><span class="p">:</span> <span class="n">number</span><span class="p">):</span> <span class="n">Promise</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="n">const</span> <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">k8sCoreApi</span><span class="o">.</span><span class="n">readNamespacedPodLog</span><span class="p">({</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">podName</span><span class="p">,</span>
        <span class="n">namespace</span><span class="p">:</span> <span class="n">namespace</span><span class="p">,</span>
        <span class="n">container</span><span class="p">:</span> <span class="n">containerName</span><span class="p">,</span>
        <span class="n">tailLines</span><span class="p">:</span> <span class="n">tailLines</span><span class="p">,</span>
        <span class="n">timestamps</span><span class="p">:</span> <span class="n">true</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="n">response</span> <span class="o">||</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">throw</span> <span class="n">this</span><span class="o">.</span><span class="n">handleK8sError</span><span class="p">(</span><span class="n">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="n">private</span> <span class="n">handleK8sError</span><span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nb">any</span><span class="p">):</span> <span class="n">Error</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="err">?</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">===</span> <span class="mi">403</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">'Access denied: Insufficient permissions to access Kubernetes resources'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="o">.</span><span class="n">response</span><span class="err">?</span><span class="o">.</span><span class="n">statusCode</span> <span class="o">===</span> <span class="mi">404</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="s1">'Resource not found: The specified pod or namespace may not exist'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">new</span> <span class="n">Error</span><span class="p">(</span><span class="err">`</span><span class="n">Kubernetes</span> <span class="n">operation</span> <span class="n">failed</span><span class="p">:</span> <span class="err">$</span><span class="p">{</span><span class="n">error</span><span class="o">.</span><span class="n">message</span><span class="p">}</span><span class="err">`</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="o">//</span> <span class="n">Start</span> <span class="n">the</span> <span class="n">server</span> <span class="ow">and</span> <span class="n">listen</span> <span class="k">for</span> <span class="n">connections</span>
  <span class="k">async</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">const</span> <span class="n">transport</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StdioServerTransport</span><span class="p">();</span>
    <span class="k">await</span> <span class="n">this</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">transport</span><span class="p">);</span>
    <span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">"K-Agent MCP server running on stdio"</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="o">//</span> <span class="n">Actually</span> <span class="n">run</span> <span class="n">the</span> <span class="n">server</span>
<span class="n">const</span> <span class="n">server</span> <span class="o">=</span> <span class="n">new</span> <span class="n">KAgentServer</span><span class="p">();</span>
<span class="n">server</span><span class="o">.</span><span class="n">run</span><span class="p">()</span><span class="o">.</span><span class="n">catch</span><span class="p">(</span><span class="n">console</span><span class="o">.</span><span class="n">error</span><span class="p">);</span>
<span class="err">```</span>
</code></pre></div> <p><br/></p> <h4 id="test-log-collection">Test Log Collection<a class="headerlink" href="#test-log-collection" title="Permanent link">¶</a></h4> <p>Test the log collection functionality with the MCP Inspector:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p>This will start the MCP Inspector connected to your K-Agent server and open a browser window.</p> <p><strong>In the MCP Inspector UI browser window:</strong></p> <ol> <li>Click the <strong>“Connect”</strong> button</li> <li>Click the <strong>“Tools”</strong> tab</li> <li>Click <strong>“List Tools”</strong> - you’ll see both <code>list_pods</code> and <code>collect_pod_logs</code></li> <li>Click on <strong><code>collect_pod_logs</code></strong></li> <li>In the <strong>namespace</strong> field, enter: <code>default</code></li> <li>Click <strong>“Run Tool”</strong></li> </ol> <p>You should see logs from all pods in the default namespace, formatted with pod and container names.</p> <hr/> <h2 id="optional-extensions">Optional Extensions<a class="headerlink" href="#optional-extensions" title="Permanent link">¶</a></h2> <div class="admonition info"> <p class="admonition-title">Prerequisites</p> </div> <p>These exercises assume you have completed <strong>Steps 1-4</strong> and have a fully functional K-Agent server with <code>list_pods</code> and <code>collect_pod_logs</code> tools. These exercises extend the functionality beyond the core implementation.</p> <hr/> <h3 id="exercise-1-advanced-pod-filtering-and-sorting">Exercise 1: Advanced Pod Filtering and Sorting<a class="headerlink" href="#exercise-1-advanced-pod-filtering-and-sorting" title="Permanent link">¶</a></h3> <p>Enhance the <code>list_pods</code> tool to support filtering by status, labels, and sorting by various criteria.</p> <p><strong>Update the list_pods tool schema</strong> in your <code>setupHandlers()</code> method to include new parameters:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"list_pods"</span><span class="p">,</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"List all pods across namespaces with their status, with filtering and sorting options"</span><span class="p">,</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-18-9"><a href="#__codelineno-18-9" id="__codelineno-18-9" name="__codelineno-18-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Optional: Filter by specific namespace"</span>
</span><span id="__span-18-10"><a href="#__codelineno-18-10" id="__codelineno-18-10" name="__codelineno-18-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-11"><a href="#__codelineno-18-11" id="__codelineno-18-11" name="__codelineno-18-11"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-12"><a href="#__codelineno-18-12" id="__codelineno-18-12" name="__codelineno-18-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-18-13"><a href="#__codelineno-18-13" id="__codelineno-18-13" name="__codelineno-18-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Optional: Filter by pod status (Running, Pending, Failed, etc.)"</span><span class="p">,</span>
</span><span id="__span-18-14"><a href="#__codelineno-18-14" id="__codelineno-18-14" name="__codelineno-18-14"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"Running"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Pending"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Failed"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Succeeded"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Unknown"</span><span class="p">]</span>
</span><span id="__span-18-15"><a href="#__codelineno-18-15" id="__codelineno-18-15" name="__codelineno-18-15"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-16"><a href="#__codelineno-18-16" id="__codelineno-18-16" name="__codelineno-18-16"></a><span class="w">      </span><span class="nx">labelSelector</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-17"><a href="#__codelineno-18-17" id="__codelineno-18-17" name="__codelineno-18-17"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-18-18"><a href="#__codelineno-18-18" id="__codelineno-18-18" name="__codelineno-18-18"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Optional: Filter by label selector (e.g., 'app=nginx,env=prod')"</span>
</span><span id="__span-18-19"><a href="#__codelineno-18-19" id="__codelineno-18-19" name="__codelineno-18-19"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-20"><a href="#__codelineno-18-20" id="__codelineno-18-20" name="__codelineno-18-20"></a><span class="w">      </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-21"><a href="#__codelineno-18-21" id="__codelineno-18-21" name="__codelineno-18-21"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-18-22"><a href="#__codelineno-18-22" id="__codelineno-18-22" name="__codelineno-18-22"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Sort results by field"</span><span class="p">,</span>
</span><span id="__span-18-23"><a href="#__codelineno-18-23" id="__codelineno-18-23" name="__codelineno-18-23"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"namespace"</span><span class="p">,</span><span class="w"> </span><span class="s2">"status"</span><span class="p">,</span><span class="w"> </span><span class="s2">"age"</span><span class="p">],</span>
</span><span id="__span-18-24"><a href="#__codelineno-18-24" id="__codelineno-18-24" name="__codelineno-18-24"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">"name"</span>
</span><span id="__span-18-25"><a href="#__codelineno-18-25" id="__codelineno-18-25" name="__codelineno-18-25"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-18-26"><a href="#__codelineno-18-26" id="__codelineno-18-26" name="__codelineno-18-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-27"><a href="#__codelineno-18-27" id="__codelineno-18-27" name="__codelineno-18-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-28"><a href="#__codelineno-18-28" id="__codelineno-18-28" name="__codelineno-18-28"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Update the handleListPods method</strong> to support the new parameters:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector</span><span class="p">,</span><span class="w"> </span><span class="nx">sortBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'name'</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector</span><span class="p">);</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">  </span><span class="c1">// Filter by status if specified</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">    </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">  </span><span class="c1">// Map to simplified format</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a><span class="w">    </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'unknown'</span><span class="p">,</span>
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.creationTimestamp</span>
</span><span id="__span-19-17"><a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">creationTimestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span>
</span><span id="__span-19-18"><a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-19-19"><a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">    </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.labels</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-19-20"><a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-19-21"><a href="#__codelineno-19-21" id="__codelineno-19-21" name="__codelineno-19-21"></a>
</span><span id="__span-19-22"><a href="#__codelineno-19-22" id="__codelineno-19-22" name="__codelineno-19-22"></a><span class="w">  </span><span class="c1">// Sort results</span>
</span><span id="__span-19-23"><a href="#__codelineno-19-23" id="__codelineno-19-23" name="__codelineno-19-23"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedPods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sortPods</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="nx">sortBy</span><span class="p">);</span>
</span><span id="__span-19-24"><a href="#__codelineno-19-24" id="__codelineno-19-24" name="__codelineno-19-24"></a>
</span><span id="__span-19-25"><a href="#__codelineno-19-25" id="__codelineno-19-25" name="__codelineno-19-25"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-26"><a href="#__codelineno-19-26" id="__codelineno-19-26" name="__codelineno-19-26"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-19-27"><a href="#__codelineno-19-27" id="__codelineno-19-27" name="__codelineno-19-27"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-19-28"><a href="#__codelineno-19-28" id="__codelineno-19-28" name="__codelineno-19-28"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-19-29"><a href="#__codelineno-19-29" id="__codelineno-19-29" name="__codelineno-19-29"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">sortedPods</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-19-30"><a href="#__codelineno-19-30" id="__codelineno-19-30" name="__codelineno-19-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-19-31"><a href="#__codelineno-19-31" id="__codelineno-19-31" name="__codelineno-19-31"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-19-32"><a href="#__codelineno-19-32" id="__codelineno-19-32" name="__codelineno-19-32"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-19-33"><a href="#__codelineno-19-33" id="__codelineno-19-33" name="__codelineno-19-33"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Update the getPods method</strong> to support label selectors:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="w">        </span><span class="nx">namespace</span><span class="p">,</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">        </span><span class="nx">labelSelector</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">({</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a><span class="w">        </span><span class="nx">labelSelector</span>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-20-17"><a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-18"><a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add a sorting helper method</strong> after the <code>getPods</code> method:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">sortPods</span><span class="p">(</span><span class="nx">pods</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[],</span><span class="w"> </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">sortBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'namespace'</span><span class="o">:</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">namespace</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'status'</span><span class="o">:</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'age'</span><span class="o">:</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span><span class="w"> </span><span class="c1">// Newest first</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'name'</span><span class="o">:</span>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Test the enhanced filtering:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>Try these test cases:</strong></p> <ul> <li>List only Running pods: Set <code>status</code> to “Running”</li> <li>Filter by labels: Set <code>labelSelector</code> to “app=nginx”</li> <li>Sort by age: Set <code>sortBy</code> to “age”</li> <li>Combine filters: Use namespace + status + sortBy together</li> </ul> <hr/> <h3 id="exercise-2-enhanced-log-analysis-with-search-and-export">Exercise 2: Enhanced Log Analysis with Search and Export<a class="headerlink" href="#exercise-2-enhanced-log-analysis-with-search-and-export" title="Permanent link">¶</a></h3> <p>Extend the <code>collect_pod_logs</code> tool to support log searching, filtering by severity, and exporting logs to files.</p> <p><strong>Add a new tool <code>analyze_logs</code></strong> to your tools array in <code>setupHandlers()</code>:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="p">{</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"analyze_logs"</span><span class="p">,</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Analyze and search through pod logs with filtering and export capabilities"</span><span class="p">,</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Namespace to analyze logs from"</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a><span class="w">      </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Specific pod name (optional)"</span>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">      </span><span class="nx">searchPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Regex pattern to search for in logs"</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">      </span><span class="nx">severityLevel</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-23-21"><a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Filter by log severity"</span><span class="p">,</span>
</span><span id="__span-23-22"><a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"ERROR"</span><span class="p">,</span><span class="w"> </span><span class="s2">"WARN"</span><span class="p">,</span><span class="w"> </span><span class="s2">"INFO"</span><span class="p">,</span><span class="w"> </span><span class="s2">"DEBUG"</span><span class="p">]</span>
</span><span id="__span-23-23"><a href="#__codelineno-23-23" id="__codelineno-23-23" name="__codelineno-23-23"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-24"><a href="#__codelineno-23-24" id="__codelineno-23-24" name="__codelineno-23-24"></a><span class="w">      </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-25"><a href="#__codelineno-23-25" id="__codelineno-23-25" name="__codelineno-23-25"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-23-26"><a href="#__codelineno-23-26" id="__codelineno-23-26" name="__codelineno-23-26"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Number of recent log lines to analyze"</span><span class="p">,</span>
</span><span id="__span-23-27"><a href="#__codelineno-23-27" id="__codelineno-23-27" name="__codelineno-23-27"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-23-28"><a href="#__codelineno-23-28" id="__codelineno-23-28" name="__codelineno-23-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-29"><a href="#__codelineno-23-29" id="__codelineno-23-29" name="__codelineno-23-29"></a><span class="w">      </span><span class="nx">exportToFile</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-30"><a href="#__codelineno-23-30" id="__codelineno-23-30" name="__codelineno-23-30"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span>
</span><span id="__span-23-31"><a href="#__codelineno-23-31" id="__codelineno-23-31" name="__codelineno-23-31"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Export matching logs to a file"</span><span class="p">,</span>
</span><span id="__span-23-32"><a href="#__codelineno-23-32" id="__codelineno-23-32" name="__codelineno-23-32"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span>
</span><span id="__span-23-33"><a href="#__codelineno-23-33" id="__codelineno-23-33" name="__codelineno-23-33"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-23-34"><a href="#__codelineno-23-34" id="__codelineno-23-34" name="__codelineno-23-34"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-35"><a href="#__codelineno-23-35" id="__codelineno-23-35" name="__codelineno-23-35"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span>
</span><span id="__span-23-36"><a href="#__codelineno-23-36" id="__codelineno-23-36" name="__codelineno-23-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-37"><a href="#__codelineno-23-37" id="__codelineno-23-37" name="__codelineno-23-37"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the case to your switch statement:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="k">case</span><span class="w"> </span><span class="s2">"analyze_logs"</span><span class="o">:</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleAnalyzeLogs</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span></code></pre></div> <p><br/></p> <p><strong>Implement the log analysis handler</strong> after your <code>handleCollectPodLogs</code> method:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleAnalyzeLogs</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">exportToFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Namespace is required"</span><span class="p">);</span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">analyzedLogs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeLogs</span><span class="p">(</span><span class="nx">logs</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel</span><span class="p">);</span>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">exportToFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">(</span><span class="nx">analyzedLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">);</span>
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-14"><a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-15"><a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-25-16"><a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-25-17"><a href="#__codelineno-25-17" id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Analysis complete. </span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">totalLines</span><span class="si">}</span><span class="sb"> lines analyzed, </span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matchingLines</span><span class="si">}</span><span class="sb"> matches found.\nExported to: </span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb">\n\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-25-18"><a href="#__codelineno-25-18" id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-25-19"><a href="#__codelineno-25-19" id="__codelineno-25-19" name="__codelineno-25-19"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-25-20"><a href="#__codelineno-25-20" id="__codelineno-25-20" name="__codelineno-25-20"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-25-21"><a href="#__codelineno-25-21" id="__codelineno-25-21" name="__codelineno-25-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-22"><a href="#__codelineno-25-22" id="__codelineno-25-22" name="__codelineno-25-22"></a>
</span><span id="__span-25-23"><a href="#__codelineno-25-23" id="__codelineno-25-23" name="__codelineno-25-23"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-24"><a href="#__codelineno-25-24" id="__codelineno-25-24" name="__codelineno-25-24"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-25"><a href="#__codelineno-25-25" id="__codelineno-25-25" name="__codelineno-25-25"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-25-26"><a href="#__codelineno-25-26" id="__codelineno-25-26" name="__codelineno-25-26"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-25-27"><a href="#__codelineno-25-27" id="__codelineno-25-27" name="__codelineno-25-27"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Analysis Results:\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="si">}</span><span class="sb">\n\nMatching Logs:\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-25-28"><a href="#__codelineno-25-28" id="__codelineno-25-28" name="__codelineno-25-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-25-29"><a href="#__codelineno-25-29" id="__codelineno-25-29" name="__codelineno-25-29"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-25-30"><a href="#__codelineno-25-30" id="__codelineno-25-30" name="__codelineno-25-30"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-25-31"><a href="#__codelineno-25-31" id="__codelineno-25-31" name="__codelineno-25-31"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the log analysis helper method:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">analyzeLogs</span><span class="p">(</span><span class="nx">logs</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">logs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">matches</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">warnings</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">    </span><span class="c1">// Filter by severity if specified</span>
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">severityLevel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">severityLevel</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a>
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">    </span><span class="c1">// Search for pattern if specified</span>
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">searchPattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="s1">'i'</span><span class="p">);</span>
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">        </span><span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="w">      </span><span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a>
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">    </span><span class="c1">// Categorize by severity</span>
</span><span id="__span-26-24"><a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'ERROR'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'error'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-25"><a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">      </span><span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-26"><a href="#__codelineno-26-26" id="__codelineno-26-26" name="__codelineno-26-26"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'WARN'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">'warning'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-27"><a href="#__codelineno-26-27" id="__codelineno-26-27" name="__codelineno-26-27"></a><span class="w">      </span><span class="nx">warnings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-28"><a href="#__codelineno-26-28" id="__codelineno-26-28" name="__codelineno-26-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-29"><a href="#__codelineno-26-29" id="__codelineno-26-29" name="__codelineno-26-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-30"><a href="#__codelineno-26-30" id="__codelineno-26-30" name="__codelineno-26-30"></a>
</span><span id="__span-26-31"><a href="#__codelineno-26-31" id="__codelineno-26-31" name="__codelineno-26-31"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-26-32"><a href="#__codelineno-26-32" id="__codelineno-26-32" name="__codelineno-26-32"></a><span class="w">    </span><span class="sb">`Total Lines: </span><span class="si">${</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-33"><a href="#__codelineno-26-33" id="__codelineno-26-33" name="__codelineno-26-33"></a><span class="w">    </span><span class="sb">`Matching Lines: </span><span class="si">${</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-34"><a href="#__codelineno-26-34" id="__codelineno-26-34" name="__codelineno-26-34"></a><span class="w">    </span><span class="sb">`Errors Found: </span><span class="si">${</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-35"><a href="#__codelineno-26-35" id="__codelineno-26-35" name="__codelineno-26-35"></a><span class="w">    </span><span class="sb">`Warnings Found: </span><span class="si">${</span><span class="nx">warnings</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-36"><a href="#__codelineno-26-36" id="__codelineno-26-36" name="__codelineno-26-36"></a><span class="w">    </span><span class="nx">searchPattern</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Search Pattern: </span><span class="si">${</span><span class="nx">searchPattern</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">''</span><span class="p">,</span>
</span><span id="__span-26-37"><a href="#__codelineno-26-37" id="__codelineno-26-37" name="__codelineno-26-37"></a><span class="w">    </span><span class="nx">severityLevel</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Severity Filter: </span><span class="si">${</span><span class="nx">severityLevel</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">''</span>
</span><span id="__span-26-38"><a href="#__codelineno-26-38" id="__codelineno-26-38" name="__codelineno-26-38"></a><span class="w">  </span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
</span><span id="__span-26-39"><a href="#__codelineno-26-39" id="__codelineno-26-39" name="__codelineno-26-39"></a>
</span><span id="__span-26-40"><a href="#__codelineno-26-40" id="__codelineno-26-40" name="__codelineno-26-40"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-41"><a href="#__codelineno-26-41" id="__codelineno-26-41" name="__codelineno-26-41"></a><span class="w">    </span><span class="nx">totalLines</span><span class="o">:</span><span class="w"> </span><span class="kt">lines.length</span><span class="p">,</span>
</span><span id="__span-26-42"><a href="#__codelineno-26-42" id="__codelineno-26-42" name="__codelineno-26-42"></a><span class="w">    </span><span class="nx">matchingLines</span><span class="o">:</span><span class="w"> </span><span class="kt">matches.length</span><span class="p">,</span>
</span><span id="__span-26-43"><a href="#__codelineno-26-43" id="__codelineno-26-43" name="__codelineno-26-43"></a><span class="w">    </span><span class="nx">matches</span><span class="o">:</span><span class="w"> </span><span class="kt">matches.slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">),</span><span class="w"> </span><span class="c1">// Limit to first 100 matches</span>
</span><span id="__span-26-44"><a href="#__codelineno-26-44" id="__codelineno-26-44" name="__codelineno-26-44"></a><span class="w">    </span><span class="nx">errors</span><span class="p">,</span>
</span><span id="__span-26-45"><a href="#__codelineno-26-45" id="__codelineno-26-45" name="__codelineno-26-45"></a><span class="w">    </span><span class="nx">warnings</span><span class="p">,</span>
</span><span id="__span-26-46"><a href="#__codelineno-26-46" id="__codelineno-26-46" name="__codelineno-26-46"></a><span class="w">    </span><span class="nx">summary</span>
</span><span id="__span-26-47"><a href="#__codelineno-26-47" id="__codelineno-26-47" name="__codelineno-26-47"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-26-48"><a href="#__codelineno-26-48" id="__codelineno-26-48" name="__codelineno-26-48"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the export helper method</strong> (requires fs module - add <code>import * as fs from 'fs';</code> at the top):</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">exportLogs</span><span class="p">(</span><span class="nx">analyzedLogs</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">,</span><span class="w"> </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[:.]/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'-'</span><span class="p">);</span>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`logs_</span><span class="si">${</span><span class="nx">namespace</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">podName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'all'</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">.txt`</span><span class="p">;</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/tmp/</span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">    </span><span class="sb">`Kubernetes Log Analysis Report`</span><span class="p">,</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="w">    </span><span class="sb">`Generated: </span><span class="si">${</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="w">    </span><span class="sb">`Namespace: </span><span class="si">${</span><span class="nx">namespace</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-27-10"><a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="w">    </span><span class="nx">podName</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Pod: </span><span class="si">${</span><span class="nx">podName</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">'All Pods'</span><span class="p">,</span>
</span><span id="__span-27-11"><a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a><span class="w">    </span><span class="sb">``</span><span class="p">,</span>
</span><span id="__span-27-12"><a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="w">    </span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="p">,</span>
</span><span id="__span-27-13"><a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">    </span><span class="sb">``</span><span class="p">,</span>
</span><span id="__span-27-14"><a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">    </span><span class="sb">`=== Matching Log Entries ===`</span><span class="p">,</span>
</span><span id="__span-27-15"><a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">    </span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">)</span>
</span><span id="__span-27-16"><a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">  </span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n'</span><span class="p">);</span>
</span><span id="__span-27-17"><a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a>
</span><span id="__span-27-18"><a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">  </span><span class="c1">// Note: In a real implementation, you'd want to handle file system operations more carefully</span>
</span><span id="__span-27-19"><a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="w">  </span><span class="c1">// For this exercise, we'll just return the intended filename</span>
</span><span id="__span-27-20"><a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">filepath</span><span class="p">;</span>
</span><span id="__span-27-21"><a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Test the log analysis:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>Try these test cases:</strong></p> <ul> <li>Search for errors: Set <code>searchPattern</code> to “error” and <code>severityLevel</code> to “ERROR”</li> <li>Find warnings: Set <code>severityLevel</code> to “WARN”</li> <li>Export logs: Set <code>exportToFile</code> to true</li> <li>Pattern matching: Set <code>searchPattern</code> to a specific error code or message</li> </ul> <hr/> <h3 id="exercise-3-real-time-pod-monitoring">Exercise 3: Real-Time Pod Monitoring<a class="headerlink" href="#exercise-3-real-time-pod-monitoring" title="Permanent link">¶</a></h3> <p>Create a new tool to monitor pod health and events in real-time, providing insights into pod lifecycle changes.</p> <p><strong>Add the <code>monitor_pod_health</code> tool</strong> to your tools array:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"monitor_pod_health"</span><span class="p">,</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Monitor pod health, restart counts, and recent events"</span><span class="p">,</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-7"><a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-29-9"><a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Namespace to monitor"</span>
</span><span id="__span-29-10"><a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-11"><a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">      </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-12"><a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-29-13"><a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Specific pod to monitor (optional)"</span>
</span><span id="__span-29-14"><a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-15"><a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">      </span><span class="nx">includeEvents</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-16"><a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span>
</span><span id="__span-29-17"><a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Include recent Kubernetes events"</span><span class="p">,</span>
</span><span id="__span-29-18"><a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-29-19"><a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-29-20"><a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-21"><a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"namespace"</span><span class="p">]</span>
</span><span id="__span-29-22"><a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-23"><a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the case to your switch statement:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="k">case</span><span class="w"> </span><span class="s2">"monitor_pod_health"</span><span class="o">:</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleMonitorPodHealth</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span></code></pre></div> <p><br/></p> <p><strong>Implement the monitoring handler:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleMonitorPodHealth</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">includeEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-31-3"><a href="#__codelineno-31-3" id="__codelineno-31-3" name="__codelineno-31-3"></a>
</span><span id="__span-31-4"><a href="#__codelineno-31-4" id="__codelineno-31-4" name="__codelineno-31-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-5"><a href="#__codelineno-31-5" id="__codelineno-31-5" name="__codelineno-31-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Namespace is required"</span><span class="p">);</span>
</span><span id="__span-31-6"><a href="#__codelineno-31-6" id="__codelineno-31-6" name="__codelineno-31-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-7"><a href="#__codelineno-31-7" id="__codelineno-31-7" name="__codelineno-31-7"></a>
</span><span id="__span-31-8"><a href="#__codelineno-31-8" id="__codelineno-31-8" name="__codelineno-31-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">podName</span>
</span><span id="__span-31-9"><a href="#__codelineno-31-9" id="__codelineno-31-9" name="__codelineno-31-9"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">pods</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">podName</span><span class="p">))</span>
</span><span id="__span-31-10"><a href="#__codelineno-31-10" id="__codelineno-31-10" name="__codelineno-31-10"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-31-11"><a href="#__codelineno-31-11" id="__codelineno-31-11" name="__codelineno-31-11"></a>
</span><span id="__span-31-12"><a href="#__codelineno-31-12" id="__codelineno-31-12" name="__codelineno-31-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">healthReports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-31-13"><a href="#__codelineno-31-13" id="__codelineno-31-13" name="__codelineno-31-13"></a>
</span><span id="__span-31-14"><a href="#__codelineno-31-14" id="__codelineno-31-14" name="__codelineno-31-14"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">pod</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-15"><a href="#__codelineno-31-15" id="__codelineno-31-15" name="__codelineno-31-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-31-16"><a href="#__codelineno-31-16" id="__codelineno-31-16" name="__codelineno-31-16"></a>
</span><span id="__span-31-17"><a href="#__codelineno-31-17" id="__codelineno-31-17" name="__codelineno-31-17"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzePodHealth</span><span class="p">(</span><span class="nx">pod</span><span class="p">);</span>
</span><span id="__span-31-18"><a href="#__codelineno-31-18" id="__codelineno-31-18" name="__codelineno-31-18"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">includeEvents</span>
</span><span id="__span-31-19"><a href="#__codelineno-31-19" id="__codelineno-31-19" name="__codelineno-31-19"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPodEvents</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
</span><span id="__span-31-20"><a href="#__codelineno-31-20" id="__codelineno-31-20" name="__codelineno-31-20"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-31-21"><a href="#__codelineno-31-21" id="__codelineno-31-21" name="__codelineno-31-21"></a>
</span><span id="__span-31-22"><a href="#__codelineno-31-22" id="__codelineno-31-22" name="__codelineno-31-22"></a><span class="w">    </span><span class="nx">healthReports</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-31-23"><a href="#__codelineno-31-23" id="__codelineno-31-23" name="__codelineno-31-23"></a><span class="w">      </span><span class="nx">pod</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata.name</span><span class="p">,</span>
</span><span id="__span-31-24"><a href="#__codelineno-31-24" id="__codelineno-31-24" name="__codelineno-31-24"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata.namespace</span><span class="p">,</span>
</span><span id="__span-31-25"><a href="#__codelineno-31-25" id="__codelineno-31-25" name="__codelineno-31-25"></a><span class="w">      </span><span class="nx">health</span><span class="p">,</span>
</span><span id="__span-31-26"><a href="#__codelineno-31-26" id="__codelineno-31-26" name="__codelineno-31-26"></a><span class="w">      </span><span class="nx">events</span>
</span><span id="__span-31-27"><a href="#__codelineno-31-27" id="__codelineno-31-27" name="__codelineno-31-27"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-31-28"><a href="#__codelineno-31-28" id="__codelineno-31-28" name="__codelineno-31-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-29"><a href="#__codelineno-31-29" id="__codelineno-31-29" name="__codelineno-31-29"></a>
</span><span id="__span-31-30"><a href="#__codelineno-31-30" id="__codelineno-31-30" name="__codelineno-31-30"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-31"><a href="#__codelineno-31-31" id="__codelineno-31-31" name="__codelineno-31-31"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-32"><a href="#__codelineno-31-32" id="__codelineno-31-32" name="__codelineno-31-32"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-31-33"><a href="#__codelineno-31-33" id="__codelineno-31-33" name="__codelineno-31-33"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-31-34"><a href="#__codelineno-31-34" id="__codelineno-31-34" name="__codelineno-31-34"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">healthReports</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-31-35"><a href="#__codelineno-31-35" id="__codelineno-31-35" name="__codelineno-31-35"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-31-36"><a href="#__codelineno-31-36" id="__codelineno-31-36" name="__codelineno-31-36"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-31-37"><a href="#__codelineno-31-37" id="__codelineno-31-37" name="__codelineno-31-37"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-31-38"><a href="#__codelineno-31-38" id="__codelineno-31-38" name="__codelineno-31-38"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the health analysis method:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">analyzePodHealth</span><span class="p">(</span><span class="nx">pod</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.V1Pod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">conditions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">conditions</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">containerStatuses</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a><span class="w">  </span><span class="c1">// Calculate restart counts</span>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="w">    </span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">cs</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cs</span><span class="p">.</span><span class="nx">restartCount</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">),</span>
</span><span id="__span-32-9"><a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="w">    </span><span class="mf">0</span>
</span><span id="__span-32-10"><a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-32-11"><a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a>
</span><span id="__span-32-12"><a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="w">  </span><span class="c1">// Check readiness</span>
</span><span id="__span-32-13"><a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">readyCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">conditions</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'Ready'</span><span class="p">);</span>
</span><span id="__span-32-14"><a href="#__codelineno-32-14" id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isReady</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readyCondition</span><span class="o">?</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'True'</span><span class="p">;</span>
</span><span id="__span-32-15"><a href="#__codelineno-32-15" id="__codelineno-32-15" name="__codelineno-32-15"></a>
</span><span id="__span-32-16"><a href="#__codelineno-32-16" id="__codelineno-32-16" name="__codelineno-32-16"></a><span class="w">  </span><span class="c1">// Check container states</span>
</span><span id="__span-32-17"><a href="#__codelineno-32-17" id="__codelineno-32-17" name="__codelineno-32-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">containerHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">cs</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-32-18"><a href="#__codelineno-32-18" id="__codelineno-32-18" name="__codelineno-32-18"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.name</span><span class="p">,</span>
</span><span id="__span-32-19"><a href="#__codelineno-32-19" id="__codelineno-32-19" name="__codelineno-32-19"></a><span class="w">    </span><span class="nx">ready</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.ready</span><span class="p">,</span>
</span><span id="__span-32-20"><a href="#__codelineno-32-20" id="__codelineno-32-20" name="__codelineno-32-20"></a><span class="w">    </span><span class="nx">restartCount</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.restartCount</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-32-21"><a href="#__codelineno-32-21" id="__codelineno-32-21" name="__codelineno-32-21"></a><span class="w">    </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.state?.running</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">'Running'</span>
</span><span id="__span-32-22"><a href="#__codelineno-32-22" id="__codelineno-32-22" name="__codelineno-32-22"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="o">?</span><span class="p">.</span><span class="nx">waiting</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Waiting: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">waiting</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-32-23"><a href="#__codelineno-32-23" id="__codelineno-32-23" name="__codelineno-32-23"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="o">?</span><span class="p">.</span><span class="nx">terminated</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Terminated: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">terminated</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-32-24"><a href="#__codelineno-32-24" id="__codelineno-32-24" name="__codelineno-32-24"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="s1">'Unknown'</span><span class="p">,</span>
</span><span id="__span-32-25"><a href="#__codelineno-32-25" id="__codelineno-32-25" name="__codelineno-32-25"></a><span class="w">    </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.lastState?.terminated</span>
</span><span id="__span-32-26"><a href="#__codelineno-32-26" id="__codelineno-32-26" name="__codelineno-32-26"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="sb">`Previously terminated: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">lastState</span><span class="p">.</span><span class="nx">terminated</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-32-27"><a href="#__codelineno-32-27" id="__codelineno-32-27" name="__codelineno-32-27"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span>
</span><span id="__span-32-28"><a href="#__codelineno-32-28" id="__codelineno-32-28" name="__codelineno-32-28"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-32-29"><a href="#__codelineno-32-29" id="__codelineno-32-29" name="__codelineno-32-29"></a>
</span><span id="__span-32-30"><a href="#__codelineno-32-30" id="__codelineno-32-30" name="__codelineno-32-30"></a><span class="w">  </span><span class="c1">// Overall health assessment</span>
</span><span id="__span-32-31"><a href="#__codelineno-32-31" id="__codelineno-32-31" name="__codelineno-32-31"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">healthStatus</span><span class="w"> </span><span class="o">=</span>
</span><span id="__span-32-32"><a href="#__codelineno-32-32" id="__codelineno-32-32" name="__codelineno-32-32"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'Running'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">isReady</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">'Healthy'</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-33"><a href="#__codelineno-32-33" id="__codelineno-32-33" name="__codelineno-32-33"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'Running'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">'Unstable'</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-34"><a href="#__codelineno-32-34" id="__codelineno-32-34" name="__codelineno-32-34"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'Pending'</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">'Starting'</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-35"><a href="#__codelineno-32-35" id="__codelineno-32-35" name="__codelineno-32-35"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'Failed'</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">'Failed'</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-36"><a href="#__codelineno-32-36" id="__codelineno-32-36" name="__codelineno-32-36"></a><span class="w">    </span><span class="s1">'Unknown'</span><span class="p">;</span>
</span><span id="__span-32-37"><a href="#__codelineno-32-37" id="__codelineno-32-37" name="__codelineno-32-37"></a>
</span><span id="__span-32-38"><a href="#__codelineno-32-38" id="__codelineno-32-38" name="__codelineno-32-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-39"><a href="#__codelineno-32-39" id="__codelineno-32-39" name="__codelineno-32-39"></a><span class="w">    </span><span class="nx">phase</span><span class="o">:</span><span class="w"> </span><span class="kt">status?.phase</span><span class="p">,</span>
</span><span id="__span-32-40"><a href="#__codelineno-32-40" id="__codelineno-32-40" name="__codelineno-32-40"></a><span class="w">    </span><span class="nx">healthStatus</span><span class="p">,</span>
</span><span id="__span-32-41"><a href="#__codelineno-32-41" id="__codelineno-32-41" name="__codelineno-32-41"></a><span class="w">    </span><span class="nx">isReady</span><span class="p">,</span>
</span><span id="__span-32-42"><a href="#__codelineno-32-42" id="__codelineno-32-42" name="__codelineno-32-42"></a><span class="w">    </span><span class="nx">totalRestarts</span><span class="p">,</span>
</span><span id="__span-32-43"><a href="#__codelineno-32-43" id="__codelineno-32-43" name="__codelineno-32-43"></a><span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.creationTimestamp</span>
</span><span id="__span-32-44"><a href="#__codelineno-32-44" id="__codelineno-32-44" name="__codelineno-32-44"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">creationTimestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span>
</span><span id="__span-32-45"><a href="#__codelineno-32-45" id="__codelineno-32-45" name="__codelineno-32-45"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-32-46"><a href="#__codelineno-32-46" id="__codelineno-32-46" name="__codelineno-32-46"></a><span class="w">    </span><span class="nx">conditions</span><span class="o">:</span><span class="w"> </span><span class="kt">conditions.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-32-47"><a href="#__codelineno-32-47" id="__codelineno-32-47" name="__codelineno-32-47"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-32-48"><a href="#__codelineno-32-48" id="__codelineno-32-48" name="__codelineno-32-48"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">c.status</span><span class="p">,</span>
</span><span id="__span-32-49"><a href="#__codelineno-32-49" id="__codelineno-32-49" name="__codelineno-32-49"></a><span class="w">      </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="kt">c.reason</span><span class="p">,</span>
</span><span id="__span-32-50"><a href="#__codelineno-32-50" id="__codelineno-32-50" name="__codelineno-32-50"></a><span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">c.message</span>
</span><span id="__span-32-51"><a href="#__codelineno-32-51" id="__codelineno-32-51" name="__codelineno-32-51"></a><span class="w">    </span><span class="p">})),</span>
</span><span id="__span-32-52"><a href="#__codelineno-32-52" id="__codelineno-32-52" name="__codelineno-32-52"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">containerHealth</span>
</span><span id="__span-32-53"><a href="#__codelineno-32-53" id="__codelineno-32-53" name="__codelineno-32-53"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-32-54"><a href="#__codelineno-32-54" id="__codelineno-32-54" name="__codelineno-32-54"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Add the events retrieval method:</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPodEvents</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedEvent</span><span class="p">({</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">      </span><span class="nx">namespace</span><span class="p">,</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">      </span><span class="nx">fieldSelector</span><span class="o">:</span><span class="w"> </span><span class="sb">`involvedObject.name=</span><span class="si">${</span><span class="nx">podName</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[])</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">      </span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">firstTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
</span><span id="__span-33-11"><a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">firstTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">''</span><span class="p">;</span>
</span><span id="__span-33-12"><a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">timeB</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">timeA</span><span class="p">);</span>
</span><span id="__span-33-13"><a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-33-14"><a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">      </span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// Last 10 events</span>
</span><span id="__span-33-15"><a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">      </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-33-16"><a href="#__codelineno-33-16" id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-33-17"><a href="#__codelineno-33-17" id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">        </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="kt">event.reason</span><span class="p">,</span>
</span><span id="__span-33-18"><a href="#__codelineno-33-18" id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">event.message</span><span class="p">,</span>
</span><span id="__span-33-19"><a href="#__codelineno-33-19" id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="w">        </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">event.count</span><span class="p">,</span>
</span><span id="__span-33-20"><a href="#__codelineno-33-20" id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">        </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="kt">event.lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">firstTimestamp</span>
</span><span id="__span-33-21"><a href="#__codelineno-33-21" id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">      </span><span class="p">}));</span>
</span><span id="__span-33-22"><a href="#__codelineno-33-22" id="__codelineno-33-22" name="__codelineno-33-22"></a>
</span><span id="__span-33-23"><a href="#__codelineno-33-23" id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">events</span><span class="p">;</span>
</span><span id="__span-33-24"><a href="#__codelineno-33-24" id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-25"><a href="#__codelineno-33-25" id="__codelineno-33-25" name="__codelineno-33-25"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Failed to retrieve events:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-33-26"><a href="#__codelineno-33-26" id="__codelineno-33-26" name="__codelineno-33-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-33-27"><a href="#__codelineno-33-27" id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-28"><a href="#__codelineno-33-28" id="__codelineno-33-28" name="__codelineno-33-28"></a><span class="p">}</span>
</span></code></pre></div> <p><br/></p> <p><strong>Test the monitoring functionality:</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>Try these test cases:</strong></p> <ul> <li>Monitor a specific pod: Set <code>namespace</code> and <code>podName</code></li> <li>Check all pods in namespace: Set only <code>namespace</code></li> <li>Include events: Set <code>includeEvents</code> to true</li> <li>Look for unhealthy pods with high restart counts</li> </ul> <hr/> <div class="admonition tip"> <p class="admonition-title">Extension Ideas</p> </div> <p>Now that you have a robust K-Agent, consider these additional enhancements:</p> <div class="codehilite"><pre><span></span><code><span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Resource</span><span class="w"> </span><span class="n">Metrics</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">CPU</span><span class="o">/</span><span class="n">memory</span><span class="w"> </span><span class="n">usage</span><span class="w"> </span><span class="n">monitoring</span><span class="w"> </span><span class="n">using</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">Metrics</span><span class="w"> </span><span class="n">API</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Multi</span><span class="o">-</span><span class="n">Cluster</span><span class="w"> </span><span class="n">Support</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Extend</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">work</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">multiple</span><span class="w"> </span><span class="n">Kubernetes</span><span class="w"> </span><span class="n">clusters</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Alerting</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Implement</span><span class="w"> </span><span class="n">threshold</span><span class="o">-</span><span class="n">based</span><span class="w"> </span><span class="n">alerts</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">restart</span><span class="w"> </span><span class="n">counts</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">error</span><span class="w"> </span><span class="n">rates</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Log</span><span class="w"> </span><span class="n">Aggregation</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Integrate</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="nb">log</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="n">systems</span><span class="w"> </span><span class="n">like</span><span class="w"> </span><span class="n">ELK</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">Loki</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Historical</span><span class="w"> </span><span class="n">Analysis</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Store</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="n">analyze</span><span class="w"> </span><span class="n">trends</span><span class="w"> </span><span class="n">over</span><span class="w"> </span><span class="n">time</span>
<span class="o">-</span><span class="w"> </span><span class="o">**</span><span class="n">Auto</span><span class="o">-</span><span class="n">Remediation</span><span class="o">**</span><span class="p">:</span><span class="w"> </span><span class="n">Add</span><span class="w"> </span><span class="n">tools</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">automatically</span><span class="w"> </span><span class="n">restart</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="n">scale</span><span class="w"> </span><span class="n">problematic</span><span class="w"> </span><span class="n">pods</span>
</code></pre></div> <hr/> <h2 id="troubleshooting">Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permanent link">¶</a></h2> <h3 id="common-issues">Common Issues<a class="headerlink" href="#common-issues" title="Permanent link">¶</a></h3> <p><strong>“Kubernetes configuration not found”</strong></p> <ul> <li>Ensure <code>kubectl</code> is installed and configured</li> <li>Check <code>~/.kube/config</code> exists and is readable</li> </ul> <p><strong>“Pod not found” errors</strong></p> <ul> <li>Confirm pod names and namespaces are correct</li> <li>Check pod status with <code>kubectl get pods</code></li> </ul> <h3 id="debug-commands">Debug Commands<a class="headerlink" href="#debug-commands" title="Permanent link">¶</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a><span class="c1"># Check cluster access</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="c1"># Verify service account permissions</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>pods<span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:default:k-agent-sa
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="c1"># Check pod logs</span>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>your-namespace<span class="w"> </span>your-pod-name
</span></code></pre></div> <hr/> <h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">¶</a></h2> <p>!!! success “What You Learned” - <strong>K-Agent Architecture</strong>: Building specialized MCP servers for Kubernetes operations - <strong>MCP Server Setup</strong>: Configuring TypeScript-based MCP servers with proper dependencies - <strong>Kubernetes Client Integration</strong>: Using the @kubernetes/client-node library to interact with clusters - <strong>Tool Implementation</strong>: Creating MCP tools for pod discovery and log collection - <strong>Error Handling</strong>: Managing Kubernetes API errors and edge cases - <strong>Testing with MCP Inspector</strong>: Using the Inspector to test and debug MCP tools</p> <p>Congratulations! You’ve built a functional K-Agent with two core capabilities:</p> <ul> <li><strong>Pod Discovery</strong> - List all pods across namespaces with status information</li> <li><strong>Log Collection</strong> - Retrieve logs from pod containers with timestamp support</li> </ul> <hr/> <h2 id="whats-next">What’s Next?<a class="headerlink" href="#whats-next" title="Permanent link">¶</a></h2> <p>Your K-Agent provides a foundation for more advanced Kubernetes automation.</p> <p>Consider exploring:</p> <ul> <li>Adding filtering, log analysis, and health monitoring</li> <li>Integrating your K-Agent with other MCP clients</li> <li>Adding more tools for resource management (deployments, services, configmaps)</li> <li>Implementing resource watching for real-time cluster monitoring</li> <li>Building custom tools specific to your set Kubernetes workflows</li> </ul> <hr/> <h2 id="additional-resources">Additional Resources<a class="headerlink" href="#additional-resources" title="Permanent link">¶</a></h2> <ul> <li><a href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes API Documentation</a></li> <li><a href="https://github.com/modelcontextprotocol/sdk">MCP SDK Reference</a></li> <li><a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Log Aggregation Patterns</a></li> </ul> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Render date of last update --> <!-- Render date of creation --> <!-- ---------------------------------------------------------------------- --> <!-- Render authors --> <!-- ---------------------------------------------------------------------- --> <!-- Render committers from GitHub --> <!-- Render committers from GitLab --> <!-- Render committers --> <!-- ---------------------------------------------------------------------- --> <!-- Determine date of last update --> <!-- Determine date of creation --> <!-- Source file information --> <aside class="md-source-file"> <!-- Date of last update --> <span class="md-source-file__fact"> <span class="md-icon" title="Last update"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 31, 2026 13:02:58 UTC">January 31, 2026</span> </span> <!-- Authors (git-authors plugin) --> <!-- Authors (git-committers plugin) --> <!-- Fallback: Manual GitHub avatar for repository owner --> <span class="md-source-file__fact"> <nav> <a class="md-author" href="https://github.com/nirgeier" title="@nirgeier"> <img alt="Nir Geier" src="https://avatars.githubusercontent.com/u/555154?size=256"/> </a> </nav> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class="md-footer"> <div class="logo1"></div> <div class="logo2"></div> <!-- Link to previous and/or next page --> <nav aria-label="Footer" class="md-footer__inner md-grid"> <!-- Link to previous page --> <a aria-label="Previous: Lab 7: MCP Ollama" class="md-footer__link md-footer__link--prev" href="../../Lab07-MCP-Ollama/lab/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> Lab 7: MCP Ollama </div> </div> </a> <!-- <ul class="social-badges">
          <li><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a></li>
          <li><a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="sr-only">LinkedIn profile</span></a></li>
          <li><a href="mailto:nirgeier@gmail.com"><img src="https://img.shields.io/badge/-nirgeier@gmail.com-fcc624?style=flat&logo=Gmail&logoColor=red" alt="Gmail Badge"></a></li>
          <li><a href="mailto:nirg@codewizard.co.il"><img src="https://img.shields.io/badge/-nirg@codewizard.co.il-fcc624?style=flat&logo=microsoftoutlook&logoColor=blue" alt="Outlook Badge"></a></li>
        </ul> --> <!-- Link to next page --> <a aria-label="Next: MCP Labs - Learning Series" class="md-footer__link md-footer__link--next" href="../.."> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> MCP Labs - Learning Series </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> ©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" rel="noopener" target="_blank"><img alt="Visitor Badge" src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier"/></a> </div> </div> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky", "mermaid"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../assets/javascripts/bundle.50899def.min.js"></script> <script src="../../js/print-site.js"></script> <script src="https://buttons.github.io/buttons.js?v=1766553928"></script> </body> </html>