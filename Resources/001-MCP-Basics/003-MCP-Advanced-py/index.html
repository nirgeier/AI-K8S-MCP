<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Hands-on labs for the K-Agent framework - Kubernetes-native MCP server" name="description"/><meta content="CodeWizard-IL" name="author"/><link href="https://nirgeier.github.io/AI-K8S-MCP/Resources/001-MCP-Basics/003-MCP-Advanced-py/" rel="canonical"/><link href="../002-MCP-Basics-ts/" rel="prev"/><link href="../../../assets/favicon.png" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.6.16" name="generator"/><title>003 - MCP Advanced (PY) - K-Agent Labs</title><link href="../../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style><link href="../../../css/print-site.css" rel="stylesheet"/><link href="../../../css/print-site-material.css" rel="stylesheet"/><link href="../../../assets/stylesheets/codewizard.css?v=1766553928" rel="stylesheet"/><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> </div> <div data-md-component="announce"> </div> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine classes --> <!-- Header --> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <!-- Link to home --> <a aria-label="K-Agent Labs" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <!-- Header title --> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> K-Agent Labs </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> 003 - MCP Advanced (PY) </span> </div> </div> </div> <div class="m-social__top"> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> <!-- Color palette toggle --> <form class="md-header__option" data-md-component="palette"> <input aria-hidden="true" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/> </form> <!-- User preference: color palette --> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <!-- Site language selector --> <!-- Button to open search modal --> <!-- Check if search is actually enabled - see https://t.ly/DT_0V --> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <!-- Search interface --> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> <nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../../welcome/"> Welcome </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../../Lab00-Setup/"> Setup </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../../labs/"> Labs </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../../Tasks/"> Tasks </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a class="md-tabs__link" href="../001-MCP-Basics-py/"> Resources </a> </li> </ul> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="K-Agent Labs" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> K-Agent Labs </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../../welcome/"> <span class="md-ellipsis"> Welcome </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../Lab00-Setup/"> <span class="md-ellipsis"> Setup </span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../labs/"> <span class="md-ellipsis"> Labs </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../../../Tasks/"> <span class="md-ellipsis"> Tasks </span> <span class="md-nav__icon md-icon"></span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex=""> <span class="md-ellipsis"> Resources </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Resources </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../001-MCP-Basics-py/"> <span class="md-ellipsis"> 001 - MCP Basics (TS) </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../002-MCP-Basics-ts/"> <span class="md-ellipsis"> 002 - MCP Basics (PY) </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> 003 - MCP Advanced (PY) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1>003 - MCP Advanced (PY)</h1> <h3 id="mcp-basics-with-python">MCP Basics with Python<a class="headerlink" href="#mcp-basics-with-python" title="Permanent link">Â¶</a></h3> <div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span><span class="p">,</span> <span class="n">JSONResponse</span><span class="p">,</span> <span class="n">StreamingResponse</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">types</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>
</span><span id="__span-0-12"><a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a><span class="c1"># Ollama configuration</span>
</span><span id="__span-0-13"><a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a><span class="n">OLLAMA_BASE_URL</span> <span class="o">=</span> <span class="s2">"http://localhost:11434"</span>
</span><span id="__span-0-14"><a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="n">DEFAULT_MODEL</span> <span class="o">=</span> <span class="s2">"codestral:latest"</span>
</span><span id="__span-0-15"><a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a>
</span><span id="__span-0-16"><a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="c1"># Tool execution tracking</span>
</span><span id="__span-0-17"><a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a><span class="n">TOOL_EXECUTIONS</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-18"><a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="n">EXECUTION_COUNTER</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-19"><a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a>
</span><span id="__span-0-20"><a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">"kagent-mcp-server"</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8889</span><span class="p">)</span>
</span><span id="__span-0-21"><a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a>
</span><span id="__span-0-22"><a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="c1"># Backwards-compat shim: some inspector tooling (fastmcp helpers)</span>
</span><span id="__span-0-23"><a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="c1"># expect a `_list_tools_mcp` coroutine on the server instance. Provide</span>
</span><span id="__span-0-24"><a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="c1"># a thin wrapper that forwards to the FastMCP `list_tools` implementation.</span>
</span><span id="__span-0-25"><a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_list_tools_mcp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-26"><a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_tools</span><span class="p">()</span>
</span><span id="__span-0-27"><a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a>
</span><span id="__span-0-28"><a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="c1"># Bind the method to the instance</span>
</span><span id="__span-0-29"><a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="c1"># MCP need to access it as an instance method later</span>
</span><span id="__span-0-30"><a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="c1"># This will return list of ToolMetadata objects</span>
</span><span id="__span-0-31"><a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="n">mcp</span><span class="o">.</span><span class="n">_list_tools_mcp</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="n">_list_tools_mcp</span><span class="p">,</span> <span class="n">mcp</span><span class="p">)</span>
</span><span id="__span-0-32"><a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>
</span><span id="__span-0-33"><a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="c1"># Common CORS headers used by the inspector (browser-based)</span>
</span><span id="__span-0-34"><a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-35"><a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="s2">"Access-Control-Allow-Origin"</span><span class="p">:</span> <span class="s2">"*"</span><span class="p">,</span>
</span><span id="__span-0-36"><a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="s2">"Access-Control-Allow-Methods"</span><span class="p">:</span> <span class="s2">"GET,POST,OPTIONS"</span><span class="p">,</span>
</span><span id="__span-0-37"><a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="s2">"Access-Control-Allow-Headers"</span><span class="p">:</span> <span class="s2">"Content-Type,Authorization,X-Proxy-Token"</span><span class="p">,</span>
</span><span id="__span-0-38"><a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="p">}</span>
</span><span id="__span-0-39"><a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a>
</span><span id="__span-0-40"><a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="c1"># Helper functions for tool execution</span>
</span><span id="__span-0-41"><a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-42"><a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="w">    </span><span class="sd">"""Get the actual function for a tool by name"""</span>
</span><span id="__span-0-43"><a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="c1"># Build a mapping of tool names to functions</span>
</span><span id="__span-0-44"><a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a>    <span class="n">tool_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-45"><a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="s1">'hello'</span><span class="p">:</span> <span class="n">hello</span><span class="p">,</span>
</span><span id="__span-0-46"><a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="s1">'add'</span><span class="p">:</span> <span class="n">add</span><span class="p">,</span>
</span><span id="__span-0-47"><a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="s1">'ollama_generate'</span><span class="p">:</span> <span class="n">ollama_generate</span><span class="p">,</span>
</span><span id="__span-0-48"><a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="s1">'ollama_chat'</span><span class="p">:</span> <span class="n">ollama_chat</span><span class="p">,</span>
</span><span id="__span-0-49"><a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="s1">'ollama_list_models'</span><span class="p">:</span> <span class="n">ollama_list_models</span><span class="p">,</span>
</span><span id="__span-0-50"><a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="s1">'code_review_prompt'</span><span class="p">:</span> <span class="n">code_review_prompt</span><span class="p">,</span>
</span><span id="__span-0-51"><a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="s1">'debug_prompt'</span><span class="p">:</span> <span class="n">debug_prompt</span><span class="p">,</span>
</span><span id="__span-0-52"><a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a>    <span class="p">}</span>
</span><span id="__span-0-53"><a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="k">return</span> <span class="n">tool_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-0-54"><a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a>
</span><span id="__span-0-55"><a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-56"><a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="w">    </span><span class="sd">"""Validate arguments against function signature"""</span>
</span><span id="__span-0-57"><a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-58"><a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span>
</span><span id="__span-0-59"><a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
</span><span id="__span-0-60"><a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a>
</span><span id="__span-0-61"><a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="c1"># Check required arguments</span>
</span><span id="__span-0-62"><a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-63"><a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a>            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
</span><span id="__span-0-64"><a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Missing required argument: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-65"><a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="c1"># Check for unexpected arguments</span>
</span><span id="__span-0-67"><a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
</span><span id="__span-0-68"><a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a>            <span class="k">if</span> <span class="n">arg_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="__span-0-69"><a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Unexpected argument: </span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-70"><a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a>
</span><span id="__span-0-71"><a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">"Valid"</span>
</span><span id="__span-0-72"><a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-73"><a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-74"><a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a>
</span><span id="__span-0-75"><a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-76"><a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="w">    </span><span class="sd">"""Execute a tool and return the result"""</span>
</span><span id="__span-0-77"><a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="k">global</span> <span class="n">EXECUTION_COUNTER</span>
</span><span id="__span-0-78"><a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="n">execution_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"exec_</span><span class="si">{</span><span class="n">EXECUTION_COUNTER</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-79"><a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">EXECUTION_COUNTER</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-80"><a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a>
</span><span id="__span-0-81"><a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-82"><a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a>
</span><span id="__span-0-83"><a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-84"><a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a>        <span class="n">tool_func</span> <span class="o">=</span> <span class="n">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-0-85"><a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="__span-0-86"><a href="#__codelineno-0-86" id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-87"><a href="#__codelineno-0-87" id="__codelineno-0-87" name="__codelineno-0-87"></a>                <span class="s2">"execution_id"</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-88"><a href="#__codelineno-0-88" id="__codelineno-0-88" name="__codelineno-0-88"></a>                <span class="s2">"tool"</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-89"><a href="#__codelineno-0-89" id="__codelineno-0-89" name="__codelineno-0-89"></a>                <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-90"><a href="#__codelineno-0-90" id="__codelineno-0-90" name="__codelineno-0-90"></a>                <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Tool '</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">' not found"</span><span class="p">,</span>
</span><span id="__span-0-91"><a href="#__codelineno-0-91" id="__codelineno-0-91" name="__codelineno-0-91"></a>                <span class="s2">"duration_ms"</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-0-92"><a href="#__codelineno-0-92" id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="p">}</span>
</span><span id="__span-0-93"><a href="#__codelineno-0-93" id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a href="#__codelineno-0-94" id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="c1"># Validate arguments</span>
</span><span id="__span-0-95"><a href="#__codelineno-0-95" id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-96"><a href="#__codelineno-0-96" id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="__span-0-97"><a href="#__codelineno-0-97" id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-98"><a href="#__codelineno-0-98" id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="s2">"execution_id"</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-99"><a href="#__codelineno-0-99" id="__codelineno-0-99" name="__codelineno-0-99"></a>                <span class="s2">"tool"</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-100"><a href="#__codelineno-0-100" id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-101"><a href="#__codelineno-0-101" id="__codelineno-0-101" name="__codelineno-0-101"></a>                <span class="s2">"error"</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="__span-0-102"><a href="#__codelineno-0-102" id="__codelineno-0-102" name="__codelineno-0-102"></a>                <span class="s2">"duration_ms"</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-0-103"><a href="#__codelineno-0-103" id="__codelineno-0-103" name="__codelineno-0-103"></a>            <span class="p">}</span>
</span><span id="__span-0-104"><a href="#__codelineno-0-104" id="__codelineno-0-104" name="__codelineno-0-104"></a>
</span><span id="__span-0-105"><a href="#__codelineno-0-105" id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># Execute the tool</span>
</span><span id="__span-0-106"><a href="#__codelineno-0-106" id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="__span-0-107"><a href="#__codelineno-0-107" id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-108"><a href="#__codelineno-0-108" id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-109"><a href="#__codelineno-0-109" id="__codelineno-0-109" name="__codelineno-0-109"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-110"><a href="#__codelineno-0-110" id="__codelineno-0-110" name="__codelineno-0-110"></a>
</span><span id="__span-0-111"><a href="#__codelineno-0-111" id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-0-112"><a href="#__codelineno-0-112" id="__codelineno-0-112" name="__codelineno-0-112"></a>
</span><span id="__span-0-113"><a href="#__codelineno-0-113" id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-114"><a href="#__codelineno-0-114" id="__codelineno-0-114" name="__codelineno-0-114"></a>            <span class="s2">"execution_id"</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-115"><a href="#__codelineno-0-115" id="__codelineno-0-115" name="__codelineno-0-115"></a>            <span class="s2">"tool"</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-116"><a href="#__codelineno-0-116" id="__codelineno-0-116" name="__codelineno-0-116"></a>            <span class="s2">"arguments"</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-0-117"><a href="#__codelineno-0-117" id="__codelineno-0-117" name="__codelineno-0-117"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-118"><a href="#__codelineno-0-118" id="__codelineno-0-118" name="__codelineno-0-118"></a>            <span class="s2">"result"</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
</span><span id="__span-0-119"><a href="#__codelineno-0-119" id="__codelineno-0-119" name="__codelineno-0-119"></a>            <span class="s2">"duration_ms"</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-0-120"><a href="#__codelineno-0-120" id="__codelineno-0-120" name="__codelineno-0-120"></a>            <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-121"><a href="#__codelineno-0-121" id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="p">}</span>
</span><span id="__span-0-122"><a href="#__codelineno-0-122" id="__codelineno-0-122" name="__codelineno-0-122"></a>
</span><span id="__span-0-123"><a href="#__codelineno-0-123" id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-0-124"><a href="#__codelineno-0-124" id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span><span id="__span-0-125"><a href="#__codelineno-0-125" id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a href="#__codelineno-0-126" id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-127"><a href="#__codelineno-0-127" id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-0-128"><a href="#__codelineno-0-128" id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-129"><a href="#__codelineno-0-129" id="__codelineno-0-129" name="__codelineno-0-129"></a>            <span class="s2">"execution_id"</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-130"><a href="#__codelineno-0-130" id="__codelineno-0-130" name="__codelineno-0-130"></a>            <span class="s2">"tool"</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-131"><a href="#__codelineno-0-131" id="__codelineno-0-131" name="__codelineno-0-131"></a>            <span class="s2">"arguments"</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-0-132"><a href="#__codelineno-0-132" id="__codelineno-0-132" name="__codelineno-0-132"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-133"><a href="#__codelineno-0-133" id="__codelineno-0-133" name="__codelineno-0-133"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="__span-0-134"><a href="#__codelineno-0-134" id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="s2">"duration_ms"</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-0-135"><a href="#__codelineno-0-135" id="__codelineno-0-135" name="__codelineno-0-135"></a>            <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-136"><a href="#__codelineno-0-136" id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="p">}</span>
</span><span id="__span-0-137"><a href="#__codelineno-0-137" id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-0-138"><a href="#__codelineno-0-138" id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span><span id="__span-0-139"><a href="#__codelineno-0-139" id="__codelineno-0-139" name="__codelineno-0-139"></a>
</span><span id="__span-0-140"><a href="#__codelineno-0-140" id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="c1"># Example tool definitions</span>
</span><span id="__span-0-141"><a href="#__codelineno-0-141" id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="c1"># These will be automatically registered with the MCP server</span>
</span><span id="__span-0-142"><a href="#__codelineno-0-142" id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-143"><a href="#__codelineno-0-143" id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-144"><a href="#__codelineno-0-144" id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">    </span><span class="sd">"""Returns a friendly greeting message"""</span>
</span><span id="__span-0-145"><a href="#__codelineno-0-145" id="__codelineno-0-145" name="__codelineno-0-145"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to K-Agent Labs."</span>
</span><span id="__span-0-146"><a href="#__codelineno-0-146" id="__codelineno-0-146" name="__codelineno-0-146"></a>
</span><span id="__span-0-147"><a href="#__codelineno-0-147" id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="c1"># Example tool that adds two numbers</span>
</span><span id="__span-0-148"><a href="#__codelineno-0-148" id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="c1"># Demonstrates handling of numeric inputs and outputs</span>
</span><span id="__span-0-149"><a href="#__codelineno-0-149" id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="c1"># This will become MCP tool available at /tools</span>
</span><span id="__span-0-150"><a href="#__codelineno-0-150" id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-151"><a href="#__codelineno-0-151" id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-152"><a href="#__codelineno-0-152" id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">    </span><span class="sd">"""Adds two numbers together"""</span>
</span><span id="__span-0-153"><a href="#__codelineno-0-153" id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span><span id="__span-0-154"><a href="#__codelineno-0-154" id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"The sum of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-155"><a href="#__codelineno-0-155" id="__codelineno-0-155" name="__codelineno-0-155"></a>
</span><span id="__span-0-156"><a href="#__codelineno-0-156" id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="c1"># Ollama integration tools</span>
</span><span id="__span-0-157"><a href="#__codelineno-0-157" id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-158"><a href="#__codelineno-0-158" id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-159"><a href="#__codelineno-0-159" id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="w">    </span><span class="sd">"""Generate text using Ollama LLM"""</span>
</span><span id="__span-0-160"><a href="#__codelineno-0-160" id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-161"><a href="#__codelineno-0-161" id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-162"><a href="#__codelineno-0-162" id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-163"><a href="#__codelineno-0-163" id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/generate"</span><span class="p">,</span>
</span><span id="__span-0-164"><a href="#__codelineno-0-164" id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-165"><a href="#__codelineno-0-165" id="__codelineno-0-165" name="__codelineno-0-165"></a>                <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-166"><a href="#__codelineno-0-166" id="__codelineno-0-166" name="__codelineno-0-166"></a>                <span class="s2">"prompt"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
</span><span id="__span-0-167"><a href="#__codelineno-0-167" id="__codelineno-0-167" name="__codelineno-0-167"></a>                <span class="s2">"stream"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-168"><a href="#__codelineno-0-168" id="__codelineno-0-168" name="__codelineno-0-168"></a>                <span class="s2">"options"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-169"><a href="#__codelineno-0-169" id="__codelineno-0-169" name="__codelineno-0-169"></a>                    <span class="s2">"num_predict"</span><span class="p">:</span> <span class="n">max_tokens</span>
</span><span id="__span-0-170"><a href="#__codelineno-0-170" id="__codelineno-0-170" name="__codelineno-0-170"></a>                <span class="p">}</span>
</span><span id="__span-0-171"><a href="#__codelineno-0-171" id="__codelineno-0-171" name="__codelineno-0-171"></a>            <span class="p">},</span>
</span><span id="__span-0-172"><a href="#__codelineno-0-172" id="__codelineno-0-172" name="__codelineno-0-172"></a>            <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="__span-0-173"><a href="#__codelineno-0-173" id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="p">)</span>
</span><span id="__span-0-174"><a href="#__codelineno-0-174" id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-175"><a href="#__codelineno-0-175" id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-176"><a href="#__codelineno-0-176" id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"response"</span><span class="p">,</span> <span class="s2">"No response from model"</span><span class="p">)</span>
</span><span id="__span-0-177"><a href="#__codelineno-0-177" id="__codelineno-0-177" name="__codelineno-0-177"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-178"><a href="#__codelineno-0-178" id="__codelineno-0-178" name="__codelineno-0-178"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-179"><a href="#__codelineno-0-179" id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-180"><a href="#__codelineno-0-180" id="__codelineno-0-180" name="__codelineno-0-180"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error calling Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-181"><a href="#__codelineno-0-181" id="__codelineno-0-181" name="__codelineno-0-181"></a>
</span><span id="__span-0-182"><a href="#__codelineno-0-182" id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-183"><a href="#__codelineno-0-183" id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-184"><a href="#__codelineno-0-184" id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="w">    </span><span class="sd">"""Chat with Ollama LLM using chat API"""</span>
</span><span id="__span-0-185"><a href="#__codelineno-0-185" id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-186"><a href="#__codelineno-0-186" id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-187"><a href="#__codelineno-0-187" id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-188"><a href="#__codelineno-0-188" id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="k">if</span> <span class="n">system</span><span class="p">:</span>
</span><span id="__span-0-189"><a href="#__codelineno-0-189" id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"system"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">system</span><span class="p">})</span>
</span><span id="__span-0-190"><a href="#__codelineno-0-190" id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">"role"</span><span class="p">:</span> <span class="s2">"user"</span><span class="p">,</span> <span class="s2">"content"</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>
</span><span id="__span-0-191"><a href="#__codelineno-0-191" id="__codelineno-0-191" name="__codelineno-0-191"></a>
</span><span id="__span-0-192"><a href="#__codelineno-0-192" id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-193"><a href="#__codelineno-0-193" id="__codelineno-0-193" name="__codelineno-0-193"></a>            <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/chat"</span><span class="p">,</span>
</span><span id="__span-0-194"><a href="#__codelineno-0-194" id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-195"><a href="#__codelineno-0-195" id="__codelineno-0-195" name="__codelineno-0-195"></a>                <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-196"><a href="#__codelineno-0-196" id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="s2">"messages"</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
</span><span id="__span-0-197"><a href="#__codelineno-0-197" id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="s2">"stream"</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="__span-0-198"><a href="#__codelineno-0-198" id="__codelineno-0-198" name="__codelineno-0-198"></a>            <span class="p">},</span>
</span><span id="__span-0-199"><a href="#__codelineno-0-199" id="__codelineno-0-199" name="__codelineno-0-199"></a>            <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="__span-0-200"><a href="#__codelineno-0-200" id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="p">)</span>
</span><span id="__span-0-201"><a href="#__codelineno-0-201" id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-202"><a href="#__codelineno-0-202" id="__codelineno-0-202" name="__codelineno-0-202"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-203"><a href="#__codelineno-0-203" id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"message"</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"content"</span><span class="p">,</span> <span class="s2">"No response"</span><span class="p">)</span>
</span><span id="__span-0-204"><a href="#__codelineno-0-204" id="__codelineno-0-204" name="__codelineno-0-204"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-205"><a href="#__codelineno-0-205" id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-206"><a href="#__codelineno-0-206" id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-207"><a href="#__codelineno-0-207" id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error calling Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-208"><a href="#__codelineno-0-208" id="__codelineno-0-208" name="__codelineno-0-208"></a>
</span><span id="__span-0-209"><a href="#__codelineno-0-209" id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-210"><a href="#__codelineno-0-210" id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_list_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-211"><a href="#__codelineno-0-211" id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="w">    </span><span class="sd">"""List available Ollama models"""</span>
</span><span id="__span-0-212"><a href="#__codelineno-0-212" id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-213"><a href="#__codelineno-0-213" id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-214"><a href="#__codelineno-0-214" id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/tags"</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-215"><a href="#__codelineno-0-215" id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-216"><a href="#__codelineno-0-216" id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-217"><a href="#__codelineno-0-217" id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">models</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"models"</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-218"><a href="#__codelineno-0-218" id="__codelineno-0-218" name="__codelineno-0-218"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">models</span><span class="p">:</span>
</span><span id="__span-0-219"><a href="#__codelineno-0-219" id="__codelineno-0-219" name="__codelineno-0-219"></a>                <span class="k">return</span> <span class="s2">"No models available"</span>
</span><span id="__span-0-220"><a href="#__codelineno-0-220" id="__codelineno-0-220" name="__codelineno-0-220"></a>
</span><span id="__span-0-221"><a href="#__codelineno-0-221" id="__codelineno-0-221" name="__codelineno-0-221"></a>            <span class="n">result</span> <span class="o">=</span> <span class="s2">"Available Ollama models:</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="__span-0-222"><a href="#__codelineno-0-222" id="__codelineno-0-222" name="__codelineno-0-222"></a>            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
</span><span id="__span-0-223"><a href="#__codelineno-0-223" id="__codelineno-0-223" name="__codelineno-0-223"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span> <span class="s2">"unknown"</span><span class="p">)</span>
</span><span id="__span-0-224"><a href="#__codelineno-0-224" id="__codelineno-0-224" name="__codelineno-0-224"></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"size"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Convert to GB</span>
</span><span id="__span-0-225"><a href="#__codelineno-0-225" id="__codelineno-0-225" name="__codelineno-0-225"></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"- </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">GB)</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="__span-0-226"><a href="#__codelineno-0-226" id="__codelineno-0-226" name="__codelineno-0-226"></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-0-227"><a href="#__codelineno-0-227" id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-228"><a href="#__codelineno-0-228" id="__codelineno-0-228" name="__codelineno-0-228"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-229"><a href="#__codelineno-0-229" id="__codelineno-0-229" name="__codelineno-0-229"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-230"><a href="#__codelineno-0-230" id="__codelineno-0-230" name="__codelineno-0-230"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">"Error listing models: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-231"><a href="#__codelineno-0-231" id="__codelineno-0-231" name="__codelineno-0-231"></a>
</span><span id="__span-0-232"><a href="#__codelineno-0-232" id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="c1"># Prompts - Reusable prompt templates</span>
</span><span id="__span-0-233"><a href="#__codelineno-0-233" id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">prompt</span><span class="p">()</span>
</span><span id="__span-0-234"><a href="#__codelineno-0-234" id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="k">def</span><span class="w"> </span><span class="nf">code_review_prompt</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"python"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-235"><a href="#__codelineno-0-235" id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="w">    </span><span class="sd">"""Generate a code review prompt for the given code"""</span>
</span><span id="__span-0-236"><a href="#__codelineno-0-236" id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">"""Please review this </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2"> code and provide feedback:</span>
</span><span id="__span-0-237"><a href="#__codelineno-0-237" id="__codelineno-0-237" name="__codelineno-0-237"></a>
</span><span id="__span-0-238"><a href="#__codelineno-0-238" id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="s2">---</span><span class="si">{</span><span class="n">language</span><span class="si">}</span>
</span><span id="__span-0-239"><a href="#__codelineno-0-239" id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="si">{</span><span class="n">code</span><span class="si">}</span>
</span><span id="__span-0-240"><a href="#__codelineno-0-240" id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="s2">---</span>
</span><span id="__span-0-241"><a href="#__codelineno-0-241" id="__codelineno-0-241" name="__codelineno-0-241"></a>
</span><span id="__span-0-242"><a href="#__codelineno-0-242" id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="s2">Focus on:</span>
</span><span id="__span-0-243"><a href="#__codelineno-0-243" id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="s2">- Code quality and best practices</span>
</span><span id="__span-0-244"><a href="#__codelineno-0-244" id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="s2">- Potential bugs or issues</span>
</span><span id="__span-0-245"><a href="#__codelineno-0-245" id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="s2">- Performance improvements</span>
</span><span id="__span-0-246"><a href="#__codelineno-0-246" id="__codelineno-0-246" name="__codelineno-0-246"></a><span class="s2">- Security concerns</span>
</span><span id="__span-0-247"><a href="#__codelineno-0-247" id="__codelineno-0-247" name="__codelineno-0-247"></a><span class="s2">"""</span>
</span><span id="__span-0-248"><a href="#__codelineno-0-248" id="__codelineno-0-248" name="__codelineno-0-248"></a>
</span><span id="__span-0-249"><a href="#__codelineno-0-249" id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">prompt</span><span class="p">()</span>
</span><span id="__span-0-250"><a href="#__codelineno-0-250" id="__codelineno-0-250" name="__codelineno-0-250"></a><span class="k">def</span><span class="w"> </span><span class="nf">debug_prompt</span><span class="p">(</span><span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-251"><a href="#__codelineno-0-251" id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="w">    </span><span class="sd">"""Generate a debugging prompt"""</span>
</span><span id="__span-0-252"><a href="#__codelineno-0-252" id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"""Help me debug this error:</span>
</span><span id="__span-0-253"><a href="#__codelineno-0-253" id="__codelineno-0-253" name="__codelineno-0-253"></a>
</span><span id="__span-0-254"><a href="#__codelineno-0-254" id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="s2">Error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span>
</span><span id="__span-0-255"><a href="#__codelineno-0-255" id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="s2">"""</span>
</span><span id="__span-0-256"><a href="#__codelineno-0-256" id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="k">if</span> <span class="n">code_context</span><span class="p">:</span>
</span><span id="__span-0-257"><a href="#__codelineno-0-257" id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">"</span><span class="se">\n\n</span><span class="s2">Code context:</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="si">{</span><span class="n">code_context</span><span class="si">}</span><span class="se">\n</span><span class="s2">---"</span>
</span><span id="__span-0-258"><a href="#__codelineno-0-258" id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="k">return</span> <span class="n">prompt</span>
</span><span id="__span-0-259"><a href="#__codelineno-0-259" id="__codelineno-0-259" name="__codelineno-0-259"></a>
</span><span id="__span-0-260"><a href="#__codelineno-0-260" id="__codelineno-0-260" name="__codelineno-0-260"></a><span class="c1"># Resource to return the source code of this server</span>
</span><span id="__span-0-261"><a href="#__codelineno-0-261" id="__codelineno-0-261" name="__codelineno-0-261"></a><span class="c1"># Useful for inspection and learning purposes</span>
</span><span id="__span-0-262"><a href="#__codelineno-0-262" id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">"mcp://code"</span><span class="p">)</span>
</span><span id="__span-0-263"><a href="#__codelineno-0-263" id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_code</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-264"><a href="#__codelineno-0-264" id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="w">    </span><span class="sd">"""Returns the source code of this server"""</span>
</span><span id="__span-0-265"><a href="#__codelineno-0-265" id="__codelineno-0-265" name="__codelineno-0-265"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-266"><a href="#__codelineno-0-266" id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-0-267"><a href="#__codelineno-0-267" id="__codelineno-0-267" name="__codelineno-0-267"></a>
</span><span id="__span-0-268"><a href="#__codelineno-0-268" id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">"mcp://server-info"</span><span class="p">)</span>
</span><span id="__span-0-269"><a href="#__codelineno-0-269" id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_server_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-270"><a href="#__codelineno-0-270" id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="w">    </span><span class="sd">"""Returns information about this MCP server"""</span>
</span><span id="__span-0-271"><a href="#__codelineno-0-271" id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">return</span> <span class="s2">"""K-Agent MCP Server</span>
</span><span id="__span-0-272"><a href="#__codelineno-0-272" id="__codelineno-0-272" name="__codelineno-0-272"></a>
</span><span id="__span-0-273"><a href="#__codelineno-0-273" id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="s2">Version: 0.1.0</span>
</span><span id="__span-0-274"><a href="#__codelineno-0-274" id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="s2">Capabilities:</span>
</span><span id="__span-0-275"><a href="#__codelineno-0-275" id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="s2">- Tools: hello, add</span>
</span><span id="__span-0-276"><a href="#__codelineno-0-276" id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="s2">- Prompts: code_review_prompt, debug_prompt</span>
</span><span id="__span-0-277"><a href="#__codelineno-0-277" id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="s2">- Resources: code, server-info</span>
</span><span id="__span-0-278"><a href="#__codelineno-0-278" id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="s2">- Sampling: LLM sampling support</span>
</span><span id="__span-0-279"><a href="#__codelineno-0-279" id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="s2">- Roots: File system access</span>
</span><span id="__span-0-280"><a href="#__codelineno-0-280" id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="s2">"""</span>
</span><span id="__span-0-281"><a href="#__codelineno-0-281" id="__codelineno-0-281" name="__codelineno-0-281"></a>
</span><span id="__span-0-282"><a href="#__codelineno-0-282" id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-283"><a href="#__codelineno-0-283" id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">root_health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-284"><a href="#__codelineno-0-284" id="__codelineno-0-284" name="__codelineno-0-284"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">"MCP Server Running"</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-285"><a href="#__codelineno-0-285" id="__codelineno-0-285" name="__codelineno-0-285"></a>
</span><span id="__span-0-286"><a href="#__codelineno-0-286" id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="c1"># Health check endpoints</span>
</span><span id="__span-0-287"><a href="#__codelineno-0-287" id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="c1"># MCP manifest endpoint, negotiation, and tools listing</span>
</span><span id="__span-0-288"><a href="#__codelineno-0-288" id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/health"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-289"><a href="#__codelineno-0-289" id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-290"><a href="#__codelineno-0-290" id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">"MCP Server Running"</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-291"><a href="#__codelineno-0-291" id="__codelineno-0-291" name="__codelineno-0-291"></a>
</span><span id="__span-0-292"><a href="#__codelineno-0-292" id="__codelineno-0-292" name="__codelineno-0-292"></a><span class="c1"># MCP Manifest endpoint as per MCP specification</span>
</span><span id="__span-0-293"><a href="#__codelineno-0-293" id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="c1"># Provides metadata about the MCP server</span>
</span><span id="__span-0-294"><a href="#__codelineno-0-294" id="__codelineno-0-294" name="__codelineno-0-294"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/.well-known/mcp"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-295"><a href="#__codelineno-0-295" id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_manifest</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-296"><a href="#__codelineno-0-296" id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"host"</span><span class="p">,</span> <span class="s2">"localhost:8889"</span><span class="p">)</span>
</span><span id="__span-0-297"><a href="#__codelineno-0-297" id="__codelineno-0-297" name="__codelineno-0-297"></a>    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s2">"http"</span>
</span><span id="__span-0-298"><a href="#__codelineno-0-298" id="__codelineno-0-298" name="__codelineno-0-298"></a>    <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-299"><a href="#__codelineno-0-299" id="__codelineno-0-299" name="__codelineno-0-299"></a>    <span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-300"><a href="#__codelineno-0-300" id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"kagent-mcp-server"</span><span class="p">,</span>
</span><span id="__span-0-301"><a href="#__codelineno-0-301" id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
</span><span id="__span-0-302"><a href="#__codelineno-0-302" id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="s2">"base_url"</span><span class="p">:</span> <span class="n">base</span><span class="p">,</span>
</span><span id="__span-0-303"><a href="#__codelineno-0-303" id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="s2">"transport"</span><span class="p">:</span> <span class="s2">"streamable-http"</span><span class="p">,</span>
</span><span id="__span-0-304"><a href="#__codelineno-0-304" id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="s2">"capabilities"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-305"><a href="#__codelineno-0-305" id="__codelineno-0-305" name="__codelineno-0-305"></a>            <span class="s2">"tools"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-306"><a href="#__codelineno-0-306" id="__codelineno-0-306" name="__codelineno-0-306"></a>            <span class="s2">"prompts"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-307"><a href="#__codelineno-0-307" id="__codelineno-0-307" name="__codelineno-0-307"></a>            <span class="s2">"resources"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-308"><a href="#__codelineno-0-308" id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="s2">"sampling"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-309"><a href="#__codelineno-0-309" id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="s2">"roots"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-310"><a href="#__codelineno-0-310" id="__codelineno-0-310" name="__codelineno-0-310"></a>            <span class="s2">"logging"</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="__span-0-311"><a href="#__codelineno-0-311" id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="p">},</span>
</span><span id="__span-0-312"><a href="#__codelineno-0-312" id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="s2">"endpoints"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-313"><a href="#__codelineno-0-313" id="__codelineno-0-313" name="__codelineno-0-313"></a>            <span class="s2">"manifest"</span><span class="p">:</span> <span class="s2">"/.well-known/mcp"</span><span class="p">,</span>
</span><span id="__span-0-314"><a href="#__codelineno-0-314" id="__codelineno-0-314" name="__codelineno-0-314"></a>            <span class="s2">"health"</span><span class="p">:</span> <span class="s2">"/health"</span><span class="p">,</span>
</span><span id="__span-0-315"><a href="#__codelineno-0-315" id="__codelineno-0-315" name="__codelineno-0-315"></a>            <span class="s2">"ping"</span><span class="p">:</span> <span class="s2">"/ping"</span><span class="p">,</span>
</span><span id="__span-0-316"><a href="#__codelineno-0-316" id="__codelineno-0-316" name="__codelineno-0-316"></a>            <span class="s2">"root"</span><span class="p">:</span> <span class="s2">"/"</span><span class="p">,</span>
</span><span id="__span-0-317"><a href="#__codelineno-0-317" id="__codelineno-0-317" name="__codelineno-0-317"></a>            <span class="s2">"negotiate"</span><span class="p">:</span> <span class="s2">"/negotiate"</span><span class="p">,</span>
</span><span id="__span-0-318"><a href="#__codelineno-0-318" id="__codelineno-0-318" name="__codelineno-0-318"></a>            <span class="s2">"metadata"</span><span class="p">:</span> <span class="s2">"/metadata"</span><span class="p">,</span>
</span><span id="__span-0-319"><a href="#__codelineno-0-319" id="__codelineno-0-319" name="__codelineno-0-319"></a>            <span class="s2">"events"</span><span class="p">:</span> <span class="s2">"/mcp"</span><span class="p">,</span>
</span><span id="__span-0-320"><a href="#__codelineno-0-320" id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="s2">"tools"</span><span class="p">:</span> <span class="s2">"/tools"</span><span class="p">,</span>
</span><span id="__span-0-321"><a href="#__codelineno-0-321" id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="s2">"tools_execute"</span><span class="p">:</span> <span class="s2">"/tools/execute"</span><span class="p">,</span>
</span><span id="__span-0-322"><a href="#__codelineno-0-322" id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="s2">"tools_batch"</span><span class="p">:</span> <span class="s2">"/tools/batch"</span><span class="p">,</span>
</span><span id="__span-0-323"><a href="#__codelineno-0-323" id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="s2">"tools_stream"</span><span class="p">:</span> <span class="s2">"/tools/stream"</span><span class="p">,</span>
</span><span id="__span-0-324"><a href="#__codelineno-0-324" id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="s2">"tools_history"</span><span class="p">:</span> <span class="s2">"/tools/history"</span><span class="p">,</span>
</span><span id="__span-0-325"><a href="#__codelineno-0-325" id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="s2">"prompts"</span><span class="p">:</span> <span class="s2">"/prompts"</span><span class="p">,</span>
</span><span id="__span-0-326"><a href="#__codelineno-0-326" id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="s2">"resources"</span><span class="p">:</span> <span class="s2">"/resources"</span><span class="p">,</span>
</span><span id="__span-0-327"><a href="#__codelineno-0-327" id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="s2">"sampling"</span><span class="p">:</span> <span class="s2">"/sampling"</span><span class="p">,</span>
</span><span id="__span-0-328"><a href="#__codelineno-0-328" id="__codelineno-0-328" name="__codelineno-0-328"></a>            <span class="s2">"roots"</span><span class="p">:</span> <span class="s2">"/roots"</span><span class="p">,</span>
</span><span id="__span-0-329"><a href="#__codelineno-0-329" id="__codelineno-0-329" name="__codelineno-0-329"></a>            <span class="s2">"ollama_status"</span><span class="p">:</span> <span class="s2">"/ollama/status"</span><span class="p">,</span>
</span><span id="__span-0-330"><a href="#__codelineno-0-330" id="__codelineno-0-330" name="__codelineno-0-330"></a>        <span class="p">},</span>
</span><span id="__span-0-331"><a href="#__codelineno-0-331" id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="p">}</span>
</span><span id="__span-0-332"><a href="#__codelineno-0-332" id="__codelineno-0-332" name="__codelineno-0-332"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-333"><a href="#__codelineno-0-333" id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a href="#__codelineno-0-334" id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="c1"># MCP Negotiation endpoint</span>
</span><span id="__span-0-335"><a href="#__codelineno-0-335" id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="c1"># Clients use this to negotiate connection parameters</span>
</span><span id="__span-0-336"><a href="#__codelineno-0-336" id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="c1"># Supports token-based authentication</span>
</span><span id="__span-0-337"><a href="#__codelineno-0-337" id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/negotiate"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-338"><a href="#__codelineno-0-338" id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">negotiate</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-339"><a href="#__codelineno-0-339" id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-340"><a href="#__codelineno-0-340" id="__codelineno-0-340" name="__codelineno-0-340"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-341"><a href="#__codelineno-0-341" id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-342"><a href="#__codelineno-0-342" id="__codelineno-0-342" name="__codelineno-0-342"></a>
</span><span id="__span-0-343"><a href="#__codelineno-0-343" id="__codelineno-0-343" name="__codelineno-0-343"></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"host"</span><span class="p">,</span> <span class="s2">"localhost:8889"</span><span class="p">)</span>
</span><span id="__span-0-344"><a href="#__codelineno-0-344" id="__codelineno-0-344" name="__codelineno-0-344"></a>    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s2">"http"</span>
</span><span id="__span-0-345"><a href="#__codelineno-0-345" id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="n">mcp_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">/mcp"</span>
</span><span id="__span-0-346"><a href="#__codelineno-0-346" id="__codelineno-0-346" name="__codelineno-0-346"></a>
</span><span id="__span-0-347"><a href="#__codelineno-0-347" id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="c1"># Accept proxy token from query param, X-Proxy-Token header, or Authorization bearer</span>
</span><span id="__span-0-348"><a href="#__codelineno-0-348" id="__codelineno-0-348" name="__codelineno-0-348"></a>    <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"token"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"x-proxy-token"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"X-Proxy-Token"</span><span class="p">)</span>
</span><span id="__span-0-349"><a href="#__codelineno-0-349" id="__codelineno-0-349" name="__codelineno-0-349"></a>    <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"authorization"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"Authorization"</span><span class="p">)</span>
</span><span id="__span-0-350"><a href="#__codelineno-0-350" id="__codelineno-0-350" name="__codelineno-0-350"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">and</span> <span class="n">auth</span> <span class="ow">and</span> <span class="n">auth</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"bearer "</span><span class="p">):</span>
</span><span id="__span-0-351"><a href="#__codelineno-0-351" id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-352"><a href="#__codelineno-0-352" id="__codelineno-0-352" name="__codelineno-0-352"></a>
</span><span id="__span-0-353"><a href="#__codelineno-0-353" id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-354"><a href="#__codelineno-0-354" id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="s2">"transport"</span><span class="p">:</span> <span class="s2">"streamable-http"</span><span class="p">,</span>
</span><span id="__span-0-355"><a href="#__codelineno-0-355" id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="s2">"url"</span><span class="p">:</span> <span class="n">mcp_url</span><span class="p">,</span>
</span><span id="__span-0-356"><a href="#__codelineno-0-356" id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="p">}</span>
</span><span id="__span-0-357"><a href="#__codelineno-0-357" id="__codelineno-0-357" name="__codelineno-0-357"></a>
</span><span id="__span-0-358"><a href="#__codelineno-0-358" id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="c1"># Include token in response if provided</span>
</span><span id="__span-0-359"><a href="#__codelineno-0-359" id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
</span><span id="__span-0-360"><a href="#__codelineno-0-360" id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="n">response</span><span class="p">[</span><span class="s2">"proxy_token"</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="__span-0-361"><a href="#__codelineno-0-361" id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-362"><a href="#__codelineno-0-362" id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="c1"># When no token is provided, explicitly indicate no auth is required</span>
</span><span id="__span-0-363"><a href="#__codelineno-0-363" id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="c1"># This helps the Inspector understand it can connect without authentication</span>
</span><span id="__span-0-364"><a href="#__codelineno-0-364" id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">response</span><span class="p">[</span><span class="s2">"requiresAuth"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-365"><a href="#__codelineno-0-365" id="__codelineno-0-365" name="__codelineno-0-365"></a>
</span><span id="__span-0-366"><a href="#__codelineno-0-366" id="__codelineno-0-366" name="__codelineno-0-366"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-367"><a href="#__codelineno-0-367" id="__codelineno-0-367" name="__codelineno-0-367"></a>
</span><span id="__span-0-368"><a href="#__codelineno-0-368" id="__codelineno-0-368" name="__codelineno-0-368"></a><span class="c1"># Tools listing endpoint</span>
</span><span id="__span-0-369"><a href="#__codelineno-0-369" id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="c1"># Returns metadata about all registered tools</span>
</span><span id="__span-0-370"><a href="#__codelineno-0-370" id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="c1"># Used by inspectors to discover available tools</span>
</span><span id="__span-0-371"><a href="#__codelineno-0-371" id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-372"><a href="#__codelineno-0-372" id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tools_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-373"><a href="#__codelineno-0-373" id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-374"><a href="#__codelineno-0-374" id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-375"><a href="#__codelineno-0-375" id="__codelineno-0-375" name="__codelineno-0-375"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-376"><a href="#__codelineno-0-376" id="__codelineno-0-376" name="__codelineno-0-376"></a>
</span><span id="__span-0-377"><a href="#__codelineno-0-377" id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="c1"># Use the server's list_tools implementation so the inspector sees</span>
</span><span id="__span-0-378"><a href="#__codelineno-0-378" id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="c1"># the canonical, generated tool metadata instead of a hand-written list.</span>
</span><span id="__span-0-379"><a href="#__codelineno-0-379" id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mcp</span><span class="o">.</span><span class="n">_list_tools_mcp</span><span class="p">()</span>
</span><span id="__span-0-380"><a href="#__codelineno-0-380" id="__codelineno-0-380" name="__codelineno-0-380"></a>
</span><span id="__span-0-381"><a href="#__codelineno-0-381" id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">serializable</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-382"><a href="#__codelineno-0-382" id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
</span><span id="__span-0-383"><a href="#__codelineno-0-383" id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-384"><a href="#__codelineno-0-384" id="__codelineno-0-384" name="__codelineno-0-384"></a>            <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
</span><span id="__span-0-385"><a href="#__codelineno-0-385" id="__codelineno-0-385" name="__codelineno-0-385"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-386"><a href="#__codelineno-0-386" id="__codelineno-0-386" name="__codelineno-0-386"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-387"><a href="#__codelineno-0-387" id="__codelineno-0-387" name="__codelineno-0-387"></a>                <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
</span><span id="__span-0-388"><a href="#__codelineno-0-388" id="__codelineno-0-388" name="__codelineno-0-388"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-389"><a href="#__codelineno-0-389" id="__codelineno-0-389" name="__codelineno-0-389"></a>                <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span><span id="__span-0-390"><a href="#__codelineno-0-390" id="__codelineno-0-390" name="__codelineno-0-390"></a>
</span><span id="__span-0-391"><a href="#__codelineno-0-391" id="__codelineno-0-391" name="__codelineno-0-391"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">"tools"</span><span class="p">:</span> <span class="n">serializable</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-392"><a href="#__codelineno-0-392" id="__codelineno-0-392" name="__codelineno-0-392"></a>
</span><span id="__span-0-393"><a href="#__codelineno-0-393" id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="c1"># Tool execution endpoint - Execute a single tool</span>
</span><span id="__span-0-394"><a href="#__codelineno-0-394" id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools/execute"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-395"><a href="#__codelineno-0-395" id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-396"><a href="#__codelineno-0-396" id="__codelineno-0-396" name="__codelineno-0-396"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-397"><a href="#__codelineno-0-397" id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-398"><a href="#__codelineno-0-398" id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-399"><a href="#__codelineno-0-399" id="__codelineno-0-399" name="__codelineno-0-399"></a>
</span><span id="__span-0-400"><a href="#__codelineno-0-400" id="__codelineno-0-400" name="__codelineno-0-400"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-401"><a href="#__codelineno-0-401" id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-402"><a href="#__codelineno-0-402" id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"tool"</span><span class="p">)</span>
</span><span id="__span-0-403"><a href="#__codelineno-0-403" id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="n">arguments</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"arguments"</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-404"><a href="#__codelineno-0-404" id="__codelineno-0-404" name="__codelineno-0-404"></a>
</span><span id="__span-0-405"><a href="#__codelineno-0-405" id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="__span-0-406"><a href="#__codelineno-0-406" id="__codelineno-0-406" name="__codelineno-0-406"></a>            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-407"><a href="#__codelineno-0-407" id="__codelineno-0-407" name="__codelineno-0-407"></a>                <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-408"><a href="#__codelineno-0-408" id="__codelineno-0-408" name="__codelineno-0-408"></a>                <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Missing 'tool' field"</span>
</span><span id="__span-0-409"><a href="#__codelineno-0-409" id="__codelineno-0-409" name="__codelineno-0-409"></a>            <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</span><span id="__span-0-410"><a href="#__codelineno-0-410" id="__codelineno-0-410" name="__codelineno-0-410"></a>
</span><span id="__span-0-411"><a href="#__codelineno-0-411" id="__codelineno-0-411" name="__codelineno-0-411"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-412"><a href="#__codelineno-0-412" id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-413"><a href="#__codelineno-0-413" id="__codelineno-0-413" name="__codelineno-0-413"></a>
</span><span id="__span-0-414"><a href="#__codelineno-0-414" id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-415"><a href="#__codelineno-0-415" id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-416"><a href="#__codelineno-0-416" id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-417"><a href="#__codelineno-0-417" id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-418"><a href="#__codelineno-0-418" id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-419"><a href="#__codelineno-0-419" id="__codelineno-0-419" name="__codelineno-0-419"></a>
</span><span id="__span-0-420"><a href="#__codelineno-0-420" id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="c1"># Batch tool execution endpoint</span>
</span><span id="__span-0-421"><a href="#__codelineno-0-421" id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools/batch"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-422"><a href="#__codelineno-0-422" id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_batch_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-423"><a href="#__codelineno-0-423" id="__codelineno-0-423" name="__codelineno-0-423"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-424"><a href="#__codelineno-0-424" id="__codelineno-0-424" name="__codelineno-0-424"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-425"><a href="#__codelineno-0-425" id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-426"><a href="#__codelineno-0-426" id="__codelineno-0-426" name="__codelineno-0-426"></a>
</span><span id="__span-0-427"><a href="#__codelineno-0-427" id="__codelineno-0-427" name="__codelineno-0-427"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-428"><a href="#__codelineno-0-428" id="__codelineno-0-428" name="__codelineno-0-428"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-429"><a href="#__codelineno-0-429" id="__codelineno-0-429" name="__codelineno-0-429"></a>        <span class="n">calls</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"calls"</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-430"><a href="#__codelineno-0-430" id="__codelineno-0-430" name="__codelineno-0-430"></a>
</span><span id="__span-0-431"><a href="#__codelineno-0-431" id="__codelineno-0-431" name="__codelineno-0-431"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">calls</span><span class="p">:</span>
</span><span id="__span-0-432"><a href="#__codelineno-0-432" id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-433"><a href="#__codelineno-0-433" id="__codelineno-0-433" name="__codelineno-0-433"></a>                <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-434"><a href="#__codelineno-0-434" id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Missing 'calls' array"</span>
</span><span id="__span-0-435"><a href="#__codelineno-0-435" id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</span><span id="__span-0-436"><a href="#__codelineno-0-436" id="__codelineno-0-436" name="__codelineno-0-436"></a>
</span><span id="__span-0-437"><a href="#__codelineno-0-437" id="__codelineno-0-437" name="__codelineno-0-437"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-438"><a href="#__codelineno-0-438" id="__codelineno-0-438" name="__codelineno-0-438"></a>        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
</span><span id="__span-0-439"><a href="#__codelineno-0-439" id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"tool"</span><span class="p">)</span>
</span><span id="__span-0-440"><a href="#__codelineno-0-440" id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">arguments</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"arguments"</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-441"><a href="#__codelineno-0-441" id="__codelineno-0-441" name="__codelineno-0-441"></a>
</span><span id="__span-0-442"><a href="#__codelineno-0-442" id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="k">if</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="__span-0-443"><a href="#__codelineno-0-443" id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-444"><a href="#__codelineno-0-444" id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-0-445"><a href="#__codelineno-0-445" id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-446"><a href="#__codelineno-0-446" id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-0-447"><a href="#__codelineno-0-447" id="__codelineno-0-447" name="__codelineno-0-447"></a>                    <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-448"><a href="#__codelineno-0-448" id="__codelineno-0-448" name="__codelineno-0-448"></a>                    <span class="s2">"error"</span><span class="p">:</span> <span class="s2">"Missing tool name in call"</span>
</span><span id="__span-0-449"><a href="#__codelineno-0-449" id="__codelineno-0-449" name="__codelineno-0-449"></a>                <span class="p">})</span>
</span><span id="__span-0-450"><a href="#__codelineno-0-450" id="__codelineno-0-450" name="__codelineno-0-450"></a>
</span><span id="__span-0-451"><a href="#__codelineno-0-451" id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-452"><a href="#__codelineno-0-452" id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-453"><a href="#__codelineno-0-453" id="__codelineno-0-453" name="__codelineno-0-453"></a>            <span class="s2">"results"</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
</span><span id="__span-0-454"><a href="#__codelineno-0-454" id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="s2">"total"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="__span-0-455"><a href="#__codelineno-0-455" id="__codelineno-0-455" name="__codelineno-0-455"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-456"><a href="#__codelineno-0-456" id="__codelineno-0-456" name="__codelineno-0-456"></a>
</span><span id="__span-0-457"><a href="#__codelineno-0-457" id="__codelineno-0-457" name="__codelineno-0-457"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-458"><a href="#__codelineno-0-458" id="__codelineno-0-458" name="__codelineno-0-458"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-459"><a href="#__codelineno-0-459" id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-460"><a href="#__codelineno-0-460" id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Batch execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-461"><a href="#__codelineno-0-461" id="__codelineno-0-461" name="__codelineno-0-461"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-462"><a href="#__codelineno-0-462" id="__codelineno-0-462" name="__codelineno-0-462"></a>
</span><span id="__span-0-463"><a href="#__codelineno-0-463" id="__codelineno-0-463" name="__codelineno-0-463"></a><span class="c1"># Tool execution history endpoint</span>
</span><span id="__span-0-464"><a href="#__codelineno-0-464" id="__codelineno-0-464" name="__codelineno-0-464"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools/history"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-465"><a href="#__codelineno-0-465" id="__codelineno-0-465" name="__codelineno-0-465"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_history</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-466"><a href="#__codelineno-0-466" id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-467"><a href="#__codelineno-0-467" id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-468"><a href="#__codelineno-0-468" id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-469"><a href="#__codelineno-0-469" id="__codelineno-0-469" name="__codelineno-0-469"></a>
</span><span id="__span-0-470"><a href="#__codelineno-0-470" id="__codelineno-0-470" name="__codelineno-0-470"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"limit"</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="__span-0-471"><a href="#__codelineno-0-471" id="__codelineno-0-471" name="__codelineno-0-471"></a>
</span><span id="__span-0-472"><a href="#__codelineno-0-472" id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="c1"># Get recent executions</span>
</span><span id="__span-0-473"><a href="#__codelineno-0-473" id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">executions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TOOL_EXECUTIONS</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-0-474"><a href="#__codelineno-0-474" id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="n">executions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"timestamp"</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-475"><a href="#__codelineno-0-475" id="__codelineno-0-475" name="__codelineno-0-475"></a>
</span><span id="__span-0-476"><a href="#__codelineno-0-476" id="__codelineno-0-476" name="__codelineno-0-476"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-477"><a href="#__codelineno-0-477" id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="s2">"executions"</span><span class="p">:</span> <span class="n">executions</span><span class="p">[:</span><span class="n">limit</span><span class="p">],</span>
</span><span id="__span-0-478"><a href="#__codelineno-0-478" id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="s2">"total"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">executions</span><span class="p">)</span>
</span><span id="__span-0-479"><a href="#__codelineno-0-479" id="__codelineno-0-479" name="__codelineno-0-479"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-480"><a href="#__codelineno-0-480" id="__codelineno-0-480" name="__codelineno-0-480"></a>
</span><span id="__span-0-481"><a href="#__codelineno-0-481" id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="c1"># Get specific execution details</span>
</span><span id="__span-0-482"><a href="#__codelineno-0-482" id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools/execution/</span><span class="si">{execution_id}</span><span class="s2">"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-483"><a href="#__codelineno-0-483" id="__codelineno-0-483" name="__codelineno-0-483"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_execution_detail</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-484"><a href="#__codelineno-0-484" id="__codelineno-0-484" name="__codelineno-0-484"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-485"><a href="#__codelineno-0-485" id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-486"><a href="#__codelineno-0-486" id="__codelineno-0-486" name="__codelineno-0-486"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-487"><a href="#__codelineno-0-487" id="__codelineno-0-487" name="__codelineno-0-487"></a>
</span><span id="__span-0-488"><a href="#__codelineno-0-488" id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="n">execution_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"execution_id"</span><span class="p">)</span>
</span><span id="__span-0-489"><a href="#__codelineno-0-489" id="__codelineno-0-489" name="__codelineno-0-489"></a>
</span><span id="__span-0-490"><a href="#__codelineno-0-490" id="__codelineno-0-490" name="__codelineno-0-490"></a>    <span class="k">if</span> <span class="n">execution_id</span> <span class="ow">in</span> <span class="n">TOOL_EXECUTIONS</span><span class="p">:</span>
</span><span id="__span-0-491"><a href="#__codelineno-0-491" id="__codelineno-0-491" name="__codelineno-0-491"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">],</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-492"><a href="#__codelineno-0-492" id="__codelineno-0-492" name="__codelineno-0-492"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-493"><a href="#__codelineno-0-493" id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-494"><a href="#__codelineno-0-494" id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Execution '</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">' not found"</span>
</span><span id="__span-0-495"><a href="#__codelineno-0-495" id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
</span><span id="__span-0-496"><a href="#__codelineno-0-496" id="__codelineno-0-496" name="__codelineno-0-496"></a>
</span><span id="__span-0-497"><a href="#__codelineno-0-497" id="__codelineno-0-497" name="__codelineno-0-497"></a><span class="c1"># Streaming tool execution</span>
</span><span id="__span-0-498"><a href="#__codelineno-0-498" id="__codelineno-0-498" name="__codelineno-0-498"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/tools/stream"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-499"><a href="#__codelineno-0-499" id="__codelineno-0-499" name="__codelineno-0-499"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_stream_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
</span><span id="__span-0-500"><a href="#__codelineno-0-500" id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-501"><a href="#__codelineno-0-501" id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-502"><a href="#__codelineno-0-502" id="__codelineno-0-502" name="__codelineno-0-502"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-503"><a href="#__codelineno-0-503" id="__codelineno-0-503" name="__codelineno-0-503"></a>
</span><span id="__span-0-504"><a href="#__codelineno-0-504" id="__codelineno-0-504" name="__codelineno-0-504"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-505"><a href="#__codelineno-0-505" id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-506"><a href="#__codelineno-0-506" id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"tool"</span><span class="p">)</span>
</span><span id="__span-0-507"><a href="#__codelineno-0-507" id="__codelineno-0-507" name="__codelineno-0-507"></a>        <span class="n">arguments</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"arguments"</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-508"><a href="#__codelineno-0-508" id="__codelineno-0-508" name="__codelineno-0-508"></a>
</span><span id="__span-0-509"><a href="#__codelineno-0-509" id="__codelineno-0-509" name="__codelineno-0-509"></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_stream</span><span class="p">():</span>
</span><span id="__span-0-510"><a href="#__codelineno-0-510" id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="c1"># Send start event</span>
</span><span id="__span-0-511"><a href="#__codelineno-0-511" id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-512"><a href="#__codelineno-0-512" id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="s2">"event"</span><span class="p">:</span> <span class="s2">"start"</span><span class="p">,</span>
</span><span id="__span-0-513"><a href="#__codelineno-0-513" id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="s2">"tool"</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-514"><a href="#__codelineno-0-514" id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-515"><a href="#__codelineno-0-515" id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="__span-0-516"><a href="#__codelineno-0-516" id="__codelineno-0-516" name="__codelineno-0-516"></a>
</span><span id="__span-0-517"><a href="#__codelineno-0-517" id="__codelineno-0-517" name="__codelineno-0-517"></a>            <span class="c1"># Execute tool</span>
</span><span id="__span-0-518"><a href="#__codelineno-0-518" id="__codelineno-0-518" name="__codelineno-0-518"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-519"><a href="#__codelineno-0-519" id="__codelineno-0-519" name="__codelineno-0-519"></a>
</span><span id="__span-0-520"><a href="#__codelineno-0-520" id="__codelineno-0-520" name="__codelineno-0-520"></a>            <span class="c1"># Send result event</span>
</span><span id="__span-0-521"><a href="#__codelineno-0-521" id="__codelineno-0-521" name="__codelineno-0-521"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-522"><a href="#__codelineno-0-522" id="__codelineno-0-522" name="__codelineno-0-522"></a>                <span class="s2">"event"</span><span class="p">:</span> <span class="s2">"result"</span><span class="p">,</span>
</span><span id="__span-0-523"><a href="#__codelineno-0-523" id="__codelineno-0-523" name="__codelineno-0-523"></a>                <span class="s2">"data"</span><span class="p">:</span> <span class="n">result</span>
</span><span id="__span-0-524"><a href="#__codelineno-0-524" id="__codelineno-0-524" name="__codelineno-0-524"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="__span-0-525"><a href="#__codelineno-0-525" id="__codelineno-0-525" name="__codelineno-0-525"></a>
</span><span id="__span-0-526"><a href="#__codelineno-0-526" id="__codelineno-0-526" name="__codelineno-0-526"></a>            <span class="c1"># Send end event</span>
</span><span id="__span-0-527"><a href="#__codelineno-0-527" id="__codelineno-0-527" name="__codelineno-0-527"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-528"><a href="#__codelineno-0-528" id="__codelineno-0-528" name="__codelineno-0-528"></a>                <span class="s2">"event"</span><span class="p">:</span> <span class="s2">"end"</span><span class="p">,</span>
</span><span id="__span-0-529"><a href="#__codelineno-0-529" id="__codelineno-0-529" name="__codelineno-0-529"></a>                <span class="s2">"timestamp"</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-530"><a href="#__codelineno-0-530" id="__codelineno-0-530" name="__codelineno-0-530"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span>
</span><span id="__span-0-531"><a href="#__codelineno-0-531" id="__codelineno-0-531" name="__codelineno-0-531"></a>
</span><span id="__span-0-532"><a href="#__codelineno-0-532" id="__codelineno-0-532" name="__codelineno-0-532"></a>        <span class="k">return</span> <span class="n">StreamingResponse</span><span class="p">(</span>
</span><span id="__span-0-533"><a href="#__codelineno-0-533" id="__codelineno-0-533" name="__codelineno-0-533"></a>            <span class="n">generate_stream</span><span class="p">(),</span>
</span><span id="__span-0-534"><a href="#__codelineno-0-534" id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="n">media_type</span><span class="o">=</span><span class="s2">"application/x-ndjson"</span><span class="p">,</span>
</span><span id="__span-0-535"><a href="#__codelineno-0-535" id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span>
</span><span id="__span-0-536"><a href="#__codelineno-0-536" id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="p">)</span>
</span><span id="__span-0-537"><a href="#__codelineno-0-537" id="__codelineno-0-537" name="__codelineno-0-537"></a>
</span><span id="__span-0-538"><a href="#__codelineno-0-538" id="__codelineno-0-538" name="__codelineno-0-538"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-539"><a href="#__codelineno-0-539" id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-540"><a href="#__codelineno-0-540" id="__codelineno-0-540" name="__codelineno-0-540"></a>            <span class="s2">"success"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-541"><a href="#__codelineno-0-541" id="__codelineno-0-541" name="__codelineno-0-541"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Stream execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-542"><a href="#__codelineno-0-542" id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-543"><a href="#__codelineno-0-543" id="__codelineno-0-543" name="__codelineno-0-543"></a>
</span><span id="__span-0-544"><a href="#__codelineno-0-544" id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="c1"># Prompts listing endpoint</span>
</span><span id="__span-0-545"><a href="#__codelineno-0-545" id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/prompts"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-546"><a href="#__codelineno-0-546" id="__codelineno-0-546" name="__codelineno-0-546"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">prompts_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-547"><a href="#__codelineno-0-547" id="__codelineno-0-547" name="__codelineno-0-547"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-548"><a href="#__codelineno-0-548" id="__codelineno-0-548" name="__codelineno-0-548"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-549"><a href="#__codelineno-0-549" id="__codelineno-0-549" name="__codelineno-0-549"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-550"><a href="#__codelineno-0-550" id="__codelineno-0-550" name="__codelineno-0-550"></a>
</span><span id="__span-0-551"><a href="#__codelineno-0-551" id="__codelineno-0-551" name="__codelineno-0-551"></a>    <span class="n">prompts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-552"><a href="#__codelineno-0-552" id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="p">{</span>
</span><span id="__span-0-553"><a href="#__codelineno-0-553" id="__codelineno-0-553" name="__codelineno-0-553"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"code_review_prompt"</span><span class="p">,</span>
</span><span id="__span-0-554"><a href="#__codelineno-0-554" id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Generate a code review prompt for the given code"</span><span class="p">,</span>
</span><span id="__span-0-555"><a href="#__codelineno-0-555" id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="s2">"arguments"</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-0-556"><a href="#__codelineno-0-556" id="__codelineno-0-556" name="__codelineno-0-556"></a>                <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"code"</span><span class="p">,</span> <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"The code to review"</span><span class="p">,</span> <span class="s2">"required"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="__span-0-557"><a href="#__codelineno-0-557" id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"language"</span><span class="p">,</span> <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Programming language"</span><span class="p">,</span> <span class="s2">"required"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-558"><a href="#__codelineno-0-558" id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="p">]</span>
</span><span id="__span-0-559"><a href="#__codelineno-0-559" id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="p">},</span>
</span><span id="__span-0-560"><a href="#__codelineno-0-560" id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="p">{</span>
</span><span id="__span-0-561"><a href="#__codelineno-0-561" id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"debug_prompt"</span><span class="p">,</span>
</span><span id="__span-0-562"><a href="#__codelineno-0-562" id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Generate a debugging prompt"</span><span class="p">,</span>
</span><span id="__span-0-563"><a href="#__codelineno-0-563" id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="s2">"arguments"</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-0-564"><a href="#__codelineno-0-564" id="__codelineno-0-564" name="__codelineno-0-564"></a>                <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"error_message"</span><span class="p">,</span> <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"The error message"</span><span class="p">,</span> <span class="s2">"required"</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="__span-0-565"><a href="#__codelineno-0-565" id="__codelineno-0-565" name="__codelineno-0-565"></a>                <span class="p">{</span><span class="s2">"name"</span><span class="p">:</span> <span class="s2">"code_context"</span><span class="p">,</span> <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Relevant code context"</span><span class="p">,</span> <span class="s2">"required"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-566"><a href="#__codelineno-0-566" id="__codelineno-0-566" name="__codelineno-0-566"></a>            <span class="p">]</span>
</span><span id="__span-0-567"><a href="#__codelineno-0-567" id="__codelineno-0-567" name="__codelineno-0-567"></a>        <span class="p">}</span>
</span><span id="__span-0-568"><a href="#__codelineno-0-568" id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="p">]</span>
</span><span id="__span-0-569"><a href="#__codelineno-0-569" id="__codelineno-0-569" name="__codelineno-0-569"></a>
</span><span id="__span-0-570"><a href="#__codelineno-0-570" id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">"prompts"</span><span class="p">:</span> <span class="n">prompts</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-571"><a href="#__codelineno-0-571" id="__codelineno-0-571" name="__codelineno-0-571"></a>
</span><span id="__span-0-572"><a href="#__codelineno-0-572" id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="c1"># Resources listing endpoint</span>
</span><span id="__span-0-573"><a href="#__codelineno-0-573" id="__codelineno-0-573" name="__codelineno-0-573"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/resources"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-574"><a href="#__codelineno-0-574" id="__codelineno-0-574" name="__codelineno-0-574"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resources_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-575"><a href="#__codelineno-0-575" id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-576"><a href="#__codelineno-0-576" id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-577"><a href="#__codelineno-0-577" id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-578"><a href="#__codelineno-0-578" id="__codelineno-0-578" name="__codelineno-0-578"></a>
</span><span id="__span-0-579"><a href="#__codelineno-0-579" id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-580"><a href="#__codelineno-0-580" id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="p">{</span>
</span><span id="__span-0-581"><a href="#__codelineno-0-581" id="__codelineno-0-581" name="__codelineno-0-581"></a>            <span class="s2">"uri"</span><span class="p">:</span> <span class="s2">"mcp://code"</span><span class="p">,</span>
</span><span id="__span-0-582"><a href="#__codelineno-0-582" id="__codelineno-0-582" name="__codelineno-0-582"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Server Source Code"</span><span class="p">,</span>
</span><span id="__span-0-583"><a href="#__codelineno-0-583" id="__codelineno-0-583" name="__codelineno-0-583"></a>            <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Returns the source code of this server"</span><span class="p">,</span>
</span><span id="__span-0-584"><a href="#__codelineno-0-584" id="__codelineno-0-584" name="__codelineno-0-584"></a>            <span class="s2">"mimeType"</span><span class="p">:</span> <span class="s2">"text/plain"</span>
</span><span id="__span-0-585"><a href="#__codelineno-0-585" id="__codelineno-0-585" name="__codelineno-0-585"></a>        <span class="p">},</span>
</span><span id="__span-0-586"><a href="#__codelineno-0-586" id="__codelineno-0-586" name="__codelineno-0-586"></a>        <span class="p">{</span>
</span><span id="__span-0-587"><a href="#__codelineno-0-587" id="__codelineno-0-587" name="__codelineno-0-587"></a>            <span class="s2">"uri"</span><span class="p">:</span> <span class="s2">"mcp://server-info"</span><span class="p">,</span>
</span><span id="__span-0-588"><a href="#__codelineno-0-588" id="__codelineno-0-588" name="__codelineno-0-588"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Server Information"</span><span class="p">,</span>
</span><span id="__span-0-589"><a href="#__codelineno-0-589" id="__codelineno-0-589" name="__codelineno-0-589"></a>            <span class="s2">"description"</span><span class="p">:</span> <span class="s2">"Returns information about this MCP server"</span><span class="p">,</span>
</span><span id="__span-0-590"><a href="#__codelineno-0-590" id="__codelineno-0-590" name="__codelineno-0-590"></a>            <span class="s2">"mimeType"</span><span class="p">:</span> <span class="s2">"text/plain"</span>
</span><span id="__span-0-591"><a href="#__codelineno-0-591" id="__codelineno-0-591" name="__codelineno-0-591"></a>        <span class="p">}</span>
</span><span id="__span-0-592"><a href="#__codelineno-0-592" id="__codelineno-0-592" name="__codelineno-0-592"></a>    <span class="p">]</span>
</span><span id="__span-0-593"><a href="#__codelineno-0-593" id="__codelineno-0-593" name="__codelineno-0-593"></a>
</span><span id="__span-0-594"><a href="#__codelineno-0-594" id="__codelineno-0-594" name="__codelineno-0-594"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">"resources"</span><span class="p">:</span> <span class="n">resources</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-595"><a href="#__codelineno-0-595" id="__codelineno-0-595" name="__codelineno-0-595"></a>
</span><span id="__span-0-596"><a href="#__codelineno-0-596" id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="c1"># Ping endpoint for connection health checks</span>
</span><span id="__span-0-597"><a href="#__codelineno-0-597" id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/ping"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-598"><a href="#__codelineno-0-598" id="__codelineno-0-598" name="__codelineno-0-598"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-599"><a href="#__codelineno-0-599" id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-600"><a href="#__codelineno-0-600" id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-601"><a href="#__codelineno-0-601" id="__codelineno-0-601" name="__codelineno-0-601"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-602"><a href="#__codelineno-0-602" id="__codelineno-0-602" name="__codelineno-0-602"></a>
</span><span id="__span-0-603"><a href="#__codelineno-0-603" id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-604"><a href="#__codelineno-0-604" id="__codelineno-0-604" name="__codelineno-0-604"></a>        <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"ok"</span><span class="p">,</span>
</span><span id="__span-0-605"><a href="#__codelineno-0-605" id="__codelineno-0-605" name="__codelineno-0-605"></a>        <span class="s2">"timestamp"</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">'time'</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
</span><span id="__span-0-606"><a href="#__codelineno-0-606" id="__codelineno-0-606" name="__codelineno-0-606"></a>        <span class="s2">"server"</span><span class="p">:</span> <span class="s2">"kagent-mcp-server"</span>
</span><span id="__span-0-607"><a href="#__codelineno-0-607" id="__codelineno-0-607" name="__codelineno-0-607"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-608"><a href="#__codelineno-0-608" id="__codelineno-0-608" name="__codelineno-0-608"></a>
</span><span id="__span-0-609"><a href="#__codelineno-0-609" id="__codelineno-0-609" name="__codelineno-0-609"></a><span class="c1"># Sampling endpoint - LLM sampling capability using Ollama</span>
</span><span id="__span-0-610"><a href="#__codelineno-0-610" id="__codelineno-0-610" name="__codelineno-0-610"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/sampling"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-611"><a href="#__codelineno-0-611" id="__codelineno-0-611" name="__codelineno-0-611"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sampling</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-612"><a href="#__codelineno-0-612" id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-613"><a href="#__codelineno-0-613" id="__codelineno-0-613" name="__codelineno-0-613"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-614"><a href="#__codelineno-0-614" id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-615"><a href="#__codelineno-0-615" id="__codelineno-0-615" name="__codelineno-0-615"></a>
</span><span id="__span-0-616"><a href="#__codelineno-0-616" id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"POST"</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="__span-0-617"><a href="#__codelineno-0-617" id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"prompt"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
</span><span id="__span-0-618"><a href="#__codelineno-0-618" id="__codelineno-0-618" name="__codelineno-0-618"></a>    <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"maxTokens"</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-619"><a href="#__codelineno-0-619" id="__codelineno-0-619" name="__codelineno-0-619"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"model"</span><span class="p">,</span> <span class="n">DEFAULT_MODEL</span><span class="p">)</span>
</span><span id="__span-0-620"><a href="#__codelineno-0-620" id="__codelineno-0-620" name="__codelineno-0-620"></a>
</span><span id="__span-0-621"><a href="#__codelineno-0-621" id="__codelineno-0-621" name="__codelineno-0-621"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-622"><a href="#__codelineno-0-622" id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-0-623"><a href="#__codelineno-0-623" id="__codelineno-0-623" name="__codelineno-0-623"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-624"><a href="#__codelineno-0-624" id="__codelineno-0-624" name="__codelineno-0-624"></a>                <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/generate"</span><span class="p">,</span>
</span><span id="__span-0-625"><a href="#__codelineno-0-625" id="__codelineno-0-625" name="__codelineno-0-625"></a>                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-626"><a href="#__codelineno-0-626" id="__codelineno-0-626" name="__codelineno-0-626"></a>                    <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-627"><a href="#__codelineno-0-627" id="__codelineno-0-627" name="__codelineno-0-627"></a>                    <span class="s2">"prompt"</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
</span><span id="__span-0-628"><a href="#__codelineno-0-628" id="__codelineno-0-628" name="__codelineno-0-628"></a>                    <span class="s2">"stream"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-629"><a href="#__codelineno-0-629" id="__codelineno-0-629" name="__codelineno-0-629"></a>                    <span class="s2">"options"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-630"><a href="#__codelineno-0-630" id="__codelineno-0-630" name="__codelineno-0-630"></a>                        <span class="s2">"num_predict"</span><span class="p">:</span> <span class="n">max_tokens</span>
</span><span id="__span-0-631"><a href="#__codelineno-0-631" id="__codelineno-0-631" name="__codelineno-0-631"></a>                    <span class="p">}</span>
</span><span id="__span-0-632"><a href="#__codelineno-0-632" id="__codelineno-0-632" name="__codelineno-0-632"></a>                <span class="p">}</span>
</span><span id="__span-0-633"><a href="#__codelineno-0-633" id="__codelineno-0-633" name="__codelineno-0-633"></a>            <span class="p">)</span>
</span><span id="__span-0-634"><a href="#__codelineno-0-634" id="__codelineno-0-634" name="__codelineno-0-634"></a>
</span><span id="__span-0-635"><a href="#__codelineno-0-635" id="__codelineno-0-635" name="__codelineno-0-635"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-636"><a href="#__codelineno-0-636" id="__codelineno-0-636" name="__codelineno-0-636"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-637"><a href="#__codelineno-0-637" id="__codelineno-0-637" name="__codelineno-0-637"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-638"><a href="#__codelineno-0-638" id="__codelineno-0-638" name="__codelineno-0-638"></a>                    <span class="s2">"completion"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"response"</span><span class="p">,</span> <span class="s2">""</span><span class="p">),</span>
</span><span id="__span-0-639"><a href="#__codelineno-0-639" id="__codelineno-0-639" name="__codelineno-0-639"></a>                    <span class="s2">"stopReason"</span><span class="p">:</span> <span class="s2">"endTurn"</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"done"</span><span class="p">)</span> <span class="k">else</span> <span class="s2">"length"</span><span class="p">,</span>
</span><span id="__span-0-640"><a href="#__codelineno-0-640" id="__codelineno-0-640" name="__codelineno-0-640"></a>                    <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-641"><a href="#__codelineno-0-641" id="__codelineno-0-641" name="__codelineno-0-641"></a>                    <span class="s2">"context"</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"context"</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-642"><a href="#__codelineno-0-642" id="__codelineno-0-642" name="__codelineno-0-642"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-643"><a href="#__codelineno-0-643" id="__codelineno-0-643" name="__codelineno-0-643"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-644"><a href="#__codelineno-0-644" id="__codelineno-0-644" name="__codelineno-0-644"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-645"><a href="#__codelineno-0-645" id="__codelineno-0-645" name="__codelineno-0-645"></a>                    <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Ollama error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
</span><span id="__span-0-646"><a href="#__codelineno-0-646" id="__codelineno-0-646" name="__codelineno-0-646"></a>                    <span class="s2">"completion"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span id="__span-0-647"><a href="#__codelineno-0-647" id="__codelineno-0-647" name="__codelineno-0-647"></a>                    <span class="s2">"stopReason"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-0-648"><a href="#__codelineno-0-648" id="__codelineno-0-648" name="__codelineno-0-648"></a>                    <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span>
</span><span id="__span-0-649"><a href="#__codelineno-0-649" id="__codelineno-0-649" name="__codelineno-0-649"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-650"><a href="#__codelineno-0-650" id="__codelineno-0-650" name="__codelineno-0-650"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-651"><a href="#__codelineno-0-651" id="__codelineno-0-651" name="__codelineno-0-651"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-652"><a href="#__codelineno-0-652" id="__codelineno-0-652" name="__codelineno-0-652"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"Failed to connect to Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
</span><span id="__span-0-653"><a href="#__codelineno-0-653" id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="s2">"completion"</span><span class="p">:</span> <span class="s2">""</span><span class="p">,</span>
</span><span id="__span-0-654"><a href="#__codelineno-0-654" id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="s2">"stopReason"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-0-655"><a href="#__codelineno-0-655" id="__codelineno-0-655" name="__codelineno-0-655"></a>            <span class="s2">"model"</span><span class="p">:</span> <span class="n">model</span>
</span><span id="__span-0-656"><a href="#__codelineno-0-656" id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-657"><a href="#__codelineno-0-657" id="__codelineno-0-657" name="__codelineno-0-657"></a>
</span><span id="__span-0-658"><a href="#__codelineno-0-658" id="__codelineno-0-658" name="__codelineno-0-658"></a><span class="c1"># Roots endpoint - File system roots</span>
</span><span id="__span-0-659"><a href="#__codelineno-0-659" id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/roots"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"POST"</span><span class="p">,</span> <span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-660"><a href="#__codelineno-0-660" id="__codelineno-0-660" name="__codelineno-0-660"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">roots_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-661"><a href="#__codelineno-0-661" id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-662"><a href="#__codelineno-0-662" id="__codelineno-0-662" name="__codelineno-0-662"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-663"><a href="#__codelineno-0-663" id="__codelineno-0-663" name="__codelineno-0-663"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-664"><a href="#__codelineno-0-664" id="__codelineno-0-664" name="__codelineno-0-664"></a>
</span><span id="__span-0-665"><a href="#__codelineno-0-665" id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-0-666"><a href="#__codelineno-0-666" id="__codelineno-0-666" name="__codelineno-0-666"></a>    <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-667"><a href="#__codelineno-0-667" id="__codelineno-0-667" name="__codelineno-0-667"></a>        <span class="p">{</span>
</span><span id="__span-0-668"><a href="#__codelineno-0-668" id="__codelineno-0-668" name="__codelineno-0-668"></a>            <span class="s2">"uri"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"file://</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
</span><span id="__span-0-669"><a href="#__codelineno-0-669" id="__codelineno-0-669" name="__codelineno-0-669"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"Current Directory"</span>
</span><span id="__span-0-670"><a href="#__codelineno-0-670" id="__codelineno-0-670" name="__codelineno-0-670"></a>        <span class="p">}</span>
</span><span id="__span-0-671"><a href="#__codelineno-0-671" id="__codelineno-0-671" name="__codelineno-0-671"></a>    <span class="p">]</span>
</span><span id="__span-0-672"><a href="#__codelineno-0-672" id="__codelineno-0-672" name="__codelineno-0-672"></a>
</span><span id="__span-0-673"><a href="#__codelineno-0-673" id="__codelineno-0-673" name="__codelineno-0-673"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">"roots"</span><span class="p">:</span> <span class="n">roots</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-674"><a href="#__codelineno-0-674" id="__codelineno-0-674" name="__codelineno-0-674"></a>
</span><span id="__span-0-675"><a href="#__codelineno-0-675" id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="c1"># Ollama status endpoint</span>
</span><span id="__span-0-676"><a href="#__codelineno-0-676" id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/ollama/status"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-677"><a href="#__codelineno-0-677" id="__codelineno-0-677" name="__codelineno-0-677"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ollama_status</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-678"><a href="#__codelineno-0-678" id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-679"><a href="#__codelineno-0-679" id="__codelineno-0-679" name="__codelineno-0-679"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-680"><a href="#__codelineno-0-680" id="__codelineno-0-680" name="__codelineno-0-680"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-681"><a href="#__codelineno-0-681" id="__codelineno-0-681" name="__codelineno-0-681"></a>
</span><span id="__span-0-682"><a href="#__codelineno-0-682" id="__codelineno-0-682" name="__codelineno-0-682"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-683"><a href="#__codelineno-0-683" id="__codelineno-0-683" name="__codelineno-0-683"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-0-684"><a href="#__codelineno-0-684" id="__codelineno-0-684" name="__codelineno-0-684"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/tags"</span><span class="p">)</span>
</span><span id="__span-0-685"><a href="#__codelineno-0-685" id="__codelineno-0-685" name="__codelineno-0-685"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-686"><a href="#__codelineno-0-686" id="__codelineno-0-686" name="__codelineno-0-686"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-687"><a href="#__codelineno-0-687" id="__codelineno-0-687" name="__codelineno-0-687"></a>                <span class="n">models</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"models"</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-688"><a href="#__codelineno-0-688" id="__codelineno-0-688" name="__codelineno-0-688"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-689"><a href="#__codelineno-0-689" id="__codelineno-0-689" name="__codelineno-0-689"></a>                    <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"connected"</span><span class="p">,</span>
</span><span id="__span-0-690"><a href="#__codelineno-0-690" id="__codelineno-0-690" name="__codelineno-0-690"></a>                    <span class="s2">"url"</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-691"><a href="#__codelineno-0-691" id="__codelineno-0-691" name="__codelineno-0-691"></a>                    <span class="s2">"models_count"</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">),</span>
</span><span id="__span-0-692"><a href="#__codelineno-0-692" id="__codelineno-0-692" name="__codelineno-0-692"></a>                    <span class="s2">"models"</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="__span-0-693"><a href="#__codelineno-0-693" id="__codelineno-0-693" name="__codelineno-0-693"></a>                        <span class="s2">"name"</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"name"</span><span class="p">),</span>
</span><span id="__span-0-694"><a href="#__codelineno-0-694" id="__codelineno-0-694" name="__codelineno-0-694"></a>                        <span class="s2">"size"</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"size"</span><span class="p">),</span>
</span><span id="__span-0-695"><a href="#__codelineno-0-695" id="__codelineno-0-695" name="__codelineno-0-695"></a>                        <span class="s2">"modified"</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"modified_at"</span><span class="p">)</span>
</span><span id="__span-0-696"><a href="#__codelineno-0-696" id="__codelineno-0-696" name="__codelineno-0-696"></a>                    <span class="p">}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">],</span>
</span><span id="__span-0-697"><a href="#__codelineno-0-697" id="__codelineno-0-697" name="__codelineno-0-697"></a>                    <span class="s2">"default_model"</span><span class="p">:</span> <span class="n">DEFAULT_MODEL</span>
</span><span id="__span-0-698"><a href="#__codelineno-0-698" id="__codelineno-0-698" name="__codelineno-0-698"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-699"><a href="#__codelineno-0-699" id="__codelineno-0-699" name="__codelineno-0-699"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-700"><a href="#__codelineno-0-700" id="__codelineno-0-700" name="__codelineno-0-700"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-701"><a href="#__codelineno-0-701" id="__codelineno-0-701" name="__codelineno-0-701"></a>                    <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"error"</span><span class="p">,</span>
</span><span id="__span-0-702"><a href="#__codelineno-0-702" id="__codelineno-0-702" name="__codelineno-0-702"></a>                    <span class="s2">"url"</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-703"><a href="#__codelineno-0-703" id="__codelineno-0-703" name="__codelineno-0-703"></a>                    <span class="s2">"error"</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"HTTP </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">"</span>
</span><span id="__span-0-704"><a href="#__codelineno-0-704" id="__codelineno-0-704" name="__codelineno-0-704"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-705"><a href="#__codelineno-0-705" id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-706"><a href="#__codelineno-0-706" id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-707"><a href="#__codelineno-0-707" id="__codelineno-0-707" name="__codelineno-0-707"></a>            <span class="s2">"status"</span><span class="p">:</span> <span class="s2">"disconnected"</span><span class="p">,</span>
</span><span id="__span-0-708"><a href="#__codelineno-0-708" id="__codelineno-0-708" name="__codelineno-0-708"></a>            <span class="s2">"url"</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-709"><a href="#__codelineno-0-709" id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="s2">"error"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-710"><a href="#__codelineno-0-710" id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-711"><a href="#__codelineno-0-711" id="__codelineno-0-711" name="__codelineno-0-711"></a>
</span><span id="__span-0-712"><a href="#__codelineno-0-712" id="__codelineno-0-712" name="__codelineno-0-712"></a><span class="c1"># Server metadata endpoint</span>
</span><span id="__span-0-713"><a href="#__codelineno-0-713" id="__codelineno-0-713" name="__codelineno-0-713"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/metadata"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"GET"</span><span class="p">,</span> <span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-714"><a href="#__codelineno-0-714" id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-715"><a href="#__codelineno-0-715" id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-716"><a href="#__codelineno-0-716" id="__codelineno-0-716" name="__codelineno-0-716"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">"OPTIONS"</span><span class="p">:</span>
</span><span id="__span-0-717"><a href="#__codelineno-0-717" id="__codelineno-0-717" name="__codelineno-0-717"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-718"><a href="#__codelineno-0-718" id="__codelineno-0-718" name="__codelineno-0-718"></a>
</span><span id="__span-0-719"><a href="#__codelineno-0-719" id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-720"><a href="#__codelineno-0-720" id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="s2">"serverInfo"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-721"><a href="#__codelineno-0-721" id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="s2">"name"</span><span class="p">:</span> <span class="s2">"kagent-mcp-server"</span><span class="p">,</span>
</span><span id="__span-0-722"><a href="#__codelineno-0-722" id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="s2">"version"</span><span class="p">:</span> <span class="s2">"0.1.0"</span><span class="p">,</span>
</span><span id="__span-0-723"><a href="#__codelineno-0-723" id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="s2">"protocolVersion"</span><span class="p">:</span> <span class="s2">"2024-11-05"</span>
</span><span id="__span-0-724"><a href="#__codelineno-0-724" id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="p">},</span>
</span><span id="__span-0-725"><a href="#__codelineno-0-725" id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="s2">"capabilities"</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-726"><a href="#__codelineno-0-726" id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="s2">"tools"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"listChanged"</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-727"><a href="#__codelineno-0-727" id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="s2">"prompts"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"listChanged"</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-728"><a href="#__codelineno-0-728" id="__codelineno-0-728" name="__codelineno-0-728"></a>            <span class="s2">"resources"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"subscribe"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">"listChanged"</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-729"><a href="#__codelineno-0-729" id="__codelineno-0-729" name="__codelineno-0-729"></a>            <span class="s2">"logging"</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-0-730"><a href="#__codelineno-0-730" id="__codelineno-0-730" name="__codelineno-0-730"></a>            <span class="s2">"sampling"</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-0-731"><a href="#__codelineno-0-731" id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="s2">"roots"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"listChanged"</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-732"><a href="#__codelineno-0-732" id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="p">}</span>
</span><span id="__span-0-733"><a href="#__codelineno-0-733" id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-734"><a href="#__codelineno-0-734" id="__codelineno-0-734" name="__codelineno-0-734"></a>
</span><span id="__span-0-735"><a href="#__codelineno-0-735" id="__codelineno-0-735" name="__codelineno-0-735"></a><span class="c1"># Add CORS middleware to handle preflight requests for all endpoints</span>
</span><span id="__span-0-736"><a href="#__codelineno-0-736" id="__codelineno-0-736" name="__codelineno-0-736"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">"/mcp"</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">"OPTIONS"</span><span class="p">])</span>
</span><span id="__span-0-737"><a href="#__codelineno-0-737" id="__codelineno-0-737" name="__codelineno-0-737"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_options</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-738"><a href="#__codelineno-0-738" id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="w">    </span><span class="sd">"""Handle CORS preflight for the MCP endpoint"""</span>
</span><span id="__span-0-739"><a href="#__codelineno-0-739" id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-740"><a href="#__codelineno-0-740" id="__codelineno-0-740" name="__codelineno-0-740"></a>
</span><span id="__span-0-741"><a href="#__codelineno-0-741" id="__codelineno-0-741" name="__codelineno-0-741"></a><span class="c1"># Main entry point to run the MCP server</span>
</span><span id="__span-0-742"><a href="#__codelineno-0-742" id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-0-743"><a href="#__codelineno-0-743" id="__codelineno-0-743" name="__codelineno-0-743"></a>    <span class="c1"># Start the MCP server with streamable-http transport</span>
</span><span id="__span-0-744"><a href="#__codelineno-0-744" id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="c1"># Mounted at /mcp path</span>
</span><span id="__span-0-745"><a href="#__codelineno-0-745" id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="c1"># This will listen on port 8889 as configured above</span>
</span><span id="__span-0-746"><a href="#__codelineno-0-746" id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">"streamable-http"</span><span class="p">,</span> <span class="n">mount_path</span><span class="o">=</span><span class="s2">"/mcp"</span><span class="p">)</span>
</span><span id="__span-0-747"><a href="#__codelineno-0-747" id="__codelineno-0-747" name="__codelineno-0-747"></a>
</span><span id="__span-0-748"><a href="#__codelineno-0-748" id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span><span id="__span-0-749"><a href="#__codelineno-0-749" id="__codelineno-0-749" name="__codelineno-0-749"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Render date of last update --> <!-- Render date of creation --> <!-- ---------------------------------------------------------------------- --> <!-- Render authors --> <!-- ---------------------------------------------------------------------- --> <!-- Render committers from GitHub --> <!-- Render committers from GitLab --> <!-- Render committers --> <!-- ---------------------------------------------------------------------- --> <!-- Determine date of last update --> <!-- Determine date of creation --> <!-- Source file information --> <aside class="md-source-file"> <!-- Date of last update --> <span class="md-source-file__fact"> <span class="md-icon" title="Last update"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 11, 2026 05:42:20 UTC">January 11, 2026</span> </span> <!-- Authors (git-authors plugin) --> <!-- Authors (git-committers plugin) --> <!-- Fallback: Manual GitHub avatar for repository owner --> <span class="md-source-file__fact"> <nav> <a class="md-author" href="https://github.com/nirgeier" title="@nirgeier"> <img alt="Nir Geier" src="https://avatars.githubusercontent.com/u/555154?size=256"/> </a> </nav> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class="md-footer"> <div class="logo1"></div> <div class="logo2"></div> <!-- Link to previous and/or next page --> <nav aria-label="Footer" class="md-footer__inner md-grid"> <!-- Link to previous page --> <a aria-label="Previous: 002 - MCP Basics (PY)" class="md-footer__link md-footer__link--prev" href="../002-MCP-Basics-ts/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> 002 - MCP Basics (PY) </div> </div> </a> <!-- <ul class="social-badges">
          <li><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a></li>
          <li><a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="sr-only">LinkedIn profile</span></a></li>
          <li><a href="mailto:nirgeier@gmail.com"><img src="https://img.shields.io/badge/-nirgeier@gmail.com-fcc624?style=flat&logo=Gmail&logoColor=red" alt="Gmail Badge"></a></li>
          <li><a href="mailto:nirg@codewizard.co.il"><img src="https://img.shields.io/badge/-nirg@codewizard.co.il-fcc624?style=flat&logo=microsoftoutlook&logoColor=blue" alt="Outlook Badge"></a></li>
        </ul> --> <!-- Link to next page --> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> Â©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" rel="noopener" target="_blank"><img alt="Visitor Badge" src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier"/></a> </div> </div> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky", "mermaid"], "search": "../../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../../assets/javascripts/bundle.50899def.min.js"></script> <script src="../../../js/print-site.js"></script> <script src="https://buttons.github.io/buttons.js?v=1766553928"></script> </body> </html>