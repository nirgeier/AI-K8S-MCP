<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="Hands-on labs for the K-Agent framework - Kubernetes-native MCP server" name="description"/><meta content="CodeWizard-IL" name="author"/><link href="https://nirgeier.github.io/AI-K8S-MCP/Lab04-MCP-Resources/lab/" rel="canonical"/><link href="../../Lab03-MCP-Tools/lab/" rel="prev"/><link href="../../Lab05-MCP-Prompts/lab/" rel="next"/><link href="../../assets/favicon.png" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.6.16" name="generator"/><title>Lab 4: MCP Resources - K-Agent Labs</title><link href="../../assets/stylesheets/main.7e37652d.min.css" rel="stylesheet"/><link href="../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style><link href="../../css/print-site.css" rel="stylesheet"/><link href="../../css/print-site-material.css" rel="stylesheet"/><link href="../../assets/stylesheets/codewizard.css?v=1766553928" rel="stylesheet"/><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="indigo" data-md-color-primary="indigo" data-md-color-scheme="slate" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#lab-4-working-with-mcp-resources"> Skip to content </a> </div> <div data-md-component="announce"> </div> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Determine classes --> <!-- Header --> <header class="md-header md-header--shadow md-header--lifted" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <!-- Link to home --> <a aria-label="K-Agent Labs" class="md-header__button md-logo" data-md-component="logo" href="../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> <!-- Button to open drawer --> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <!-- Header title --> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> K-Agent Labs </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> Lab 4: MCP Resources </span> </div> </div> </div> <div class="m-social__top"> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> <!-- Color palette toggle --> <form class="md-header__option" data-md-component="palette"> <input aria-hidden="true" class="md-option" data-md-color-accent="indigo" data-md-color-media="" data-md-color-primary="indigo" data-md-color-scheme="slate" id="__palette_0" name="__palette" type="radio"/> </form> <!-- User preference: color palette --> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <!-- Site language selector --> <!-- Button to open search modal --> <!-- Check if search is actually enabled - see https://t.ly/DT_0V --> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <!-- Search interface --> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg> </a> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> <div class="md-search__suggest" data-md-component="search-suggest"></div> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <!-- Repository information --> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> </nav> <!-- Navigation tabs (sticky) --> <nav aria-label="Tabs" class="md-tabs" data-md-component="tabs"> <div class="md-grid"> <ul class="md-tabs__list"> <li class="md-tabs__item"> <a class="md-tabs__link" href="../../welcome/"> Welcome </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a class="md-tabs__link" href="../../labs/"> Labs </a> </li> <li class="md-tabs__item"> <a class="md-tabs__link" href="../.."> Resources </a> </li> </ul> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="K-Agent Labs" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="K-Agent Labs"> <svg viewbox="0 0 89 89" xmlns="http://www.w3.org/2000/svg"> <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z"></path> <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5"></path> <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z"></path> <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25"></path> </svg> </a> K-Agent Labs </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </div> <div class="md-source__repository"> nirgeier/AI-K8S-MCP </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../welcome/"> <span class="md-ellipsis"> Welcome </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/> <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex=""> <span class="md-ellipsis"> Labs </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_2"> <span class="md-nav__icon md-icon"></span> Labs </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../labs/"> <span class="md-ellipsis"> MCP Labs - Learning Series </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab00-Setup/lab/"> <span class="md-ellipsis"> Lab 0: Setup </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab01-MCP-Fundamentals/lab/"> <span class="md-ellipsis"> Lab 1: MCP Fundamentals </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab02-First-MCP-Server/lab/"> <span class="md-ellipsis"> Lab 2: First MCP Server </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab03-MCP-Tools/lab/"> <span class="md-ellipsis"> Lab 3: MCP Tools </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> Lab 4: MCP Resources </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> Lab 4: MCP Resources </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#overview"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#learning-objectives"> <span class="md-ellipsis"> Learning Objectives </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#prerequisites"> <span class="md-ellipsis"> Prerequisites </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#tools-vs-resources"> <span class="md-ellipsis"> Tools vs. Resources </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#resource-fundamentals"> <span class="md-ellipsis"> Resource Fundamentals </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#designing-resource-uri-schemes"> <span class="md-ellipsis"> Designing Resource URI Schemes </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#implementing-static-resources"> <span class="md-ellipsis"> Implementing Static Resources </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#implementing-dynamic-resources"> <span class="md-ellipsis"> Implementing Dynamic Resources </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#resource-subscriptions-for-live-updates"> <span class="md-ellipsis"> Resource Subscriptions for Live Updates </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#security-and-access-control"> <span class="md-ellipsis"> Security and Access Control </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#combining-resources-with-tools"> <span class="md-ellipsis"> Combining Resources with Tools </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#hands-on-exercises"> <span class="md-ellipsis"> Hands-On Exercises </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#key-takeaways"> <span class="md-ellipsis"> Key Takeaways </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#next-steps"> <span class="md-ellipsis"> Next Steps </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab05-MCP-Prompts/lab/"> <span class="md-ellipsis"> Lab 5: MCP Prompts </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab06-MCP-Workflow/lab/"> <span class="md-ellipsis"> Lab 6: MCP Workflow </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab07-MCP-Ollama/lab/"> <span class="md-ellipsis"> Lab 7: MCP Ollama </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab08-Kagent/lab/"> <span class="md-ellipsis"> Lab 8: Kagent </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../Lab09-Event-Monitor/lab/"> <span class="md-ellipsis"> Lab 9: K8S Event Monitor </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--pruned md-nav__item--nested"> <a class="md-nav__link" href="../.."> <span class="md-ellipsis"> Resources </span> <span class="md-nav__icon md-icon"></span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="lab-4-working-with-mcp-resources">Lab 4: Working with MCP Resources<a class="headerlink" href="#lab-4-working-with-mcp-resources" title="Permanent link">¶</a></h1> <h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¶</a></h2> <p>In <a href="../Lab03-MCP-Tools/">Lab 3</a>, you mastered the art of creating sophisticated MCP tools that perform actions and return rich content. Now it’s time to explore <strong>MCP Resources</strong> - the passive counterpart to tools that provides contextual data for LLMs to read and reference.</p> <p>Resources are the foundation for giving LLMs access to your knowledge bases, files, databases, and other data sources. Unlike tools that <em>do</em> things, resources <em>are</em> things - they represent the data itself that LLMs can access for context and reasoning.</p> <hr/> <h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">¶</a></h2> <p>By the end of this lab, you will:</p> <ul> <li>Understand the fundamental difference between tools and resources</li> <li>Design effective resource URI schemes for different data types</li> <li>Implement static and dynamic resources with proper metadata</li> <li>Create resource templates for parameterized access</li> <li>Build resource subscriptions for real-time updates</li> <li>Apply security best practices for resource access</li> <li>Combine resources with tools for comprehensive MCP servers</li> <li>Test resource implementations thoroughly</li> </ul> <hr/> <h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">¶</a></h2> <ul> <li>Completed <a href="../Lab03-MCP-Tools/">Lab 3 - Implementing MCP Tools</a></li> <li>Understanding of URI / URL patterns and RESTful design</li> <li>Familiarity with file systems and data structures</li> <li>Basic knowledge of caching and performance optimization</li> </ul> <hr/> <h2 id="tools-vs-resources">Tools vs. Resources<a class="headerlink" href="#tools-vs-resources" title="Permanent link">¶</a></h2> <h3 id="the-fundamental-difference">The Fundamental Difference<a class="headerlink" href="#the-fundamental-difference" title="Permanent link">¶</a></h3> <p>Before diving into implementation, it’s crucial to understand when to use tools versus resources. They serve different purposes in the MCP ecosystem.</p> <h3 id="tools-active-operations">Tools: Active Operations<a class="headerlink" href="#tools-active-operations" title="Permanent link">¶</a></h3> <p><strong>Tools perform actions and return results based on parameters.</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// Tool: Active, parameterized, can have side effects</span>
</span><span id="__span-0-2"><a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="p">{</span>
</span><span id="__span-0-3"><a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"search_database"</span><span class="p">,</span>
</span><span id="__span-0-4"><a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Search database with custom query"</span><span class="p">,</span>
</span><span id="__span-0-5"><a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="w">      </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-0-8"><a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">      </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w"> </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-9"><a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-10"><a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-11"><a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>When to use tools:</strong></p> <ul> <li>Data changes frequently or needs computation</li> <li>Operations require parameters or user input</li> <li>Actions have side effects (create, update, delete)</li> <li>Results need processing or transformation</li> </ul> <h3 id="resources-passive-data">Resources: Passive Data<a class="headerlink" href="#resources-passive-data" title="Permanent link">¶</a></h3> <p><strong>Resources expose existing data that can be read and referenced.</strong></p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-1-1"><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="c1">// Resource: Passive, addressable, read-only</span>
</span><span id="__span-1-2"><a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="p">{</span>
</span><span id="__span-1-3"><a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="w">  </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://users/123/profile"</span><span class="p">,</span>
</span><span id="__span-1-4"><a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"User Profile"</span><span class="p">,</span>
</span><span id="__span-1-5"><a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"User profile data for ID 123"</span><span class="p">,</span>
</span><span id="__span-1-6"><a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="w">  </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span>
</span><span id="__span-1-7"><a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>When to use resources:</strong></p> <ul> <li>Data is relatively static or changes predictably</li> <li>Direct access to structured data is needed</li> <li>Content should be cached or bookmarked</li> <li>Data serves as context for LLM reasoning</li> </ul> <h3 id="decision-framework">Decision Framework<a class="headerlink" href="#decision-framework" title="Permanent link">¶</a></h3> <table> <thead> <tr> <th>Scenario</th> <th>Use Tool</th> <th>Use Resource</th> <th>Why</th> </tr> </thead> <tbody> <tr> <td>Current weather</td> <td>✅ Tool</td> <td>❌ Resource</td> <td>Data changes constantly</td> </tr> <tr> <td>API documentation</td> <td>❌ Tool</td> <td>✅ Resource</td> <td>Static reference material</td> </tr> <tr> <td>Database search</td> <td>✅ Tool</td> <td>❌ Resource</td> <td>Requires query parameters</td> </tr> <tr> <td>User profile</td> <td>❌ Tool</td> <td>✅ Resource</td> <td>Direct data access needed</td> </tr> <tr> <td>File contents</td> <td>❌ Tool</td> <td>✅ Resource</td> <td>Static file data</td> </tr> <tr> <td>Generate report</td> <td>✅ Tool</td> <td>❌ Resource</td> <td>Computation required</td> </tr> </tbody> </table> <hr/> <h2 id="resource-fundamentals">Resource Fundamentals<a class="headerlink" href="#resource-fundamentals" title="Permanent link">¶</a></h2> <h3 id="resource-structure">Resource Structure<a class="headerlink" href="#resource-structure" title="Permanent link">¶</a></h3> <p>Every MCP resource has a consistent structure with metadata that helps LLMs understand what they’re accessing:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-2-1"><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">Resource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="w">  </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">           </span><span class="c1">// Unique identifier (like a URL)</span>
</span><span id="__span-2-3"><a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">          </span><span class="c1">// Human-readable title</span>
</span><span id="__span-2-4"><a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">   </span><span class="c1">// What the resource contains</span>
</span><span id="__span-2-5"><a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a><span class="w">  </span><span class="nx">mimeType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">     </span><span class="c1">// Content type (optional but recommended)</span>
</span><span id="__span-2-6"><a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="resource-content">Resource Content<a class="headerlink" href="#resource-content" title="Permanent link">¶</a></h3> <p>When a resource is read, it returns structured content:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-3-1"><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ResourceContent</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="w">  </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
</span><span id="__span-3-3"><a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="w">    </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-4"><a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="w">    </span><span class="nx">mimeType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-5"><a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="w">    </span><span class="nx">text?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// For text content</span>
</span><span id="__span-3-6"><a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="w">    </span><span class="nx">blob?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// For binary content (base64)</span>
</span><span id="__span-3-7"><a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a><span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-3-8"><a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>Key Points:</strong></p> <ul> <li>Resources are <strong>read-only</strong> by convention</li> <li>Content can be <strong>text</strong> or <strong>binary</strong> (base64 encoded)</li> <li>Multiple content items can be returned for complex resources</li> <li><code>MIME (Multipurpose Internet Mail Extensions) types</code> help clients handle content appropriately</li> </ul> <hr/> <h2 id="designing-resource-uri-schemes">Designing Resource URI Schemes<a class="headerlink" href="#designing-resource-uri-schemes" title="Permanent link">¶</a></h2> <p>Effective URI design is crucial for resource organization and discoverability. A good URI scheme should be:</p> <ul> <li><strong>Hierarchical</strong>: Reflects data organization</li> <li><strong>Descriptive</strong>: Self-documenting structure</li> <li><strong>Consistent</strong>: Follows patterns across similar resources</li> <li><strong>Extensible</strong>: Allows for future additions</li> </ul> <h3 id="common-uri-patterns">Common URI Patterns<a class="headerlink" href="#common-uri-patterns" title="Permanent link">¶</a></h3> <h4 id="file-system-resources">File System Resources<a class="headerlink" href="#file-system-resources" title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a>file:///project/src/index.ts
</span><span id="__span-4-2"><a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a>file:///docs/api-reference.md
</span><span id="__span-4-3"><a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a>file:///config/database.json
</span></code></pre></div> <h4 id="database-resources">Database Resources<a class="headerlink" href="#database-resources" title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a>db://users/123/profile
</span><span id="__span-5-2"><a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a>db://products/category/electronics
</span><span id="__span-5-3"><a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>db://orders/recent?limit=10
</span></code></pre></div> <h4 id="api-documentation">API Documentation<a class="headerlink" href="#api-documentation" title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a>api://petstore/v1/swagger.json
</span><span id="__span-6-2"><a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a>api://github/repos/microsoft/vscode/issues
</span><span id="__span-6-3"><a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a>api://weather/current/london
</span></code></pre></div> <h4 id="configuration-resources">Configuration Resources<a class="headerlink" href="#configuration-resources" title="Permanent link">¶</a></h4> <div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a>config://app/settings
</span><span id="__span-7-2"><a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a>config://database/connection
</span><span id="__span-7-3"><a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a>config://logging/level
</span></code></pre></div> <h3 id="uri-design-best-practices">URI Design Best Practices<a class="headerlink" href="#uri-design-best-practices" title="Permanent link">¶</a></h3> <ol> <li><strong>Use descriptive paths</strong>: <code>users/active</code> vs <code>u/a</code></li> <li><strong>Include identifiers</strong>: <code>orders/123</code> vs <code>current-order</code></li> <li><strong>Support hierarchies</strong>: <code>docs/api/v1/endpoints</code></li> <li><strong>Use query parameters moderately</strong>: Prefer path segments</li> <li><strong>Be consistent</strong>: Same patterns for similar resources</li> </ol> <hr/> <h2 id="implementing-static-resources">Implementing Static Resources<a class="headerlink" href="#implementing-static-resources" title="Permanent link">¶</a></h2> <p>Static resources represent fixed data that doesn’t change or changes infrequently. They’re perfect for documentation, configuration files, and reference data.</p> <h3 id="complete-static-resource-server">Complete Static Resource Server<a class="headerlink" href="#complete-static-resource-server" title="Permanent link">¶</a></h3> <p>Here’s a complete MCP server that exposes static resources:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-8-1"><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-8-2"><a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-8-4"><a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-8-5"><a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-8-7"><a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-8-8"><a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-8-9"><a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'fs/promises'</span><span class="p">;</span>
</span><span id="__span-8-10"><a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'path'</span><span class="p">;</span>
</span><span id="__span-8-11"><a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>
</span><span id="__span-8-12"><a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a><span class="cm">/**</span>
</span><span id="__span-8-13"><a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="cm"> * MCP Server exposing static file resources</span>
</span><span id="__span-8-14"><a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="cm"> */</span>
</span><span id="__span-8-15"><a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">StaticResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-16"><a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-8-17"><a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">resourceRoot</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-8-18"><a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a>
</span><span id="__span-8-19"><a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">resourceRoot</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'./resources'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-20"><a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">resourceRoot</span><span class="p">);</span>
</span><span id="__span-8-21"><a href="#__codelineno-8-21" id="__codelineno-8-21" name="__codelineno-8-21"></a>
</span><span id="__span-8-22"><a href="#__codelineno-8-22" id="__codelineno-8-22" name="__codelineno-8-22"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-8-23"><a href="#__codelineno-8-23" id="__codelineno-8-23" name="__codelineno-8-23"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-24"><a href="#__codelineno-8-24" id="__codelineno-8-24" name="__codelineno-8-24"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"static-resource-server"</span><span class="p">,</span>
</span><span id="__span-8-25"><a href="#__codelineno-8-25" id="__codelineno-8-25" name="__codelineno-8-25"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-8-26"><a href="#__codelineno-8-26" id="__codelineno-8-26" name="__codelineno-8-26"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-8-27"><a href="#__codelineno-8-27" id="__codelineno-8-27" name="__codelineno-8-27"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-28"><a href="#__codelineno-8-28" id="__codelineno-8-28" name="__codelineno-8-28"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-29"><a href="#__codelineno-8-29" id="__codelineno-8-29" name="__codelineno-8-29"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-8-30"><a href="#__codelineno-8-30" id="__codelineno-8-30" name="__codelineno-8-30"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-31"><a href="#__codelineno-8-31" id="__codelineno-8-31" name="__codelineno-8-31"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-32"><a href="#__codelineno-8-32" id="__codelineno-8-32" name="__codelineno-8-32"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-8-33"><a href="#__codelineno-8-33" id="__codelineno-8-33" name="__codelineno-8-33"></a>
</span><span id="__span-8-34"><a href="#__codelineno-8-34" id="__codelineno-8-34" name="__codelineno-8-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-8-35"><a href="#__codelineno-8-35" id="__codelineno-8-35" name="__codelineno-8-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-8-36"><a href="#__codelineno-8-36" id="__codelineno-8-36" name="__codelineno-8-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-37"><a href="#__codelineno-8-37" id="__codelineno-8-37" name="__codelineno-8-37"></a>
</span><span id="__span-8-38"><a href="#__codelineno-8-38" id="__codelineno-8-38" name="__codelineno-8-38"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-39"><a href="#__codelineno-8-39" id="__codelineno-8-39" name="__codelineno-8-39"></a><span class="w">    </span><span class="c1">// List available resources</span>
</span><span id="__span-8-40"><a href="#__codelineno-8-40" id="__codelineno-8-40" name="__codelineno-8-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-41"><a href="#__codelineno-8-41" id="__codelineno-8-41" name="__codelineno-8-41"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">discoverResources</span><span class="p">();</span>
</span><span id="__span-8-42"><a href="#__codelineno-8-42" id="__codelineno-8-42" name="__codelineno-8-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-43"><a href="#__codelineno-8-43" id="__codelineno-8-43" name="__codelineno-8-43"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-44"><a href="#__codelineno-8-44" id="__codelineno-8-44" name="__codelineno-8-44"></a>
</span><span id="__span-8-45"><a href="#__codelineno-8-45" id="__codelineno-8-45" name="__codelineno-8-45"></a><span class="w">    </span><span class="c1">// Read specific resource</span>
</span><span id="__span-8-46"><a href="#__codelineno-8-46" id="__codelineno-8-46" name="__codelineno-8-46"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-47"><a href="#__codelineno-8-47" id="__codelineno-8-47" name="__codelineno-8-47"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-8-48"><a href="#__codelineno-8-48" id="__codelineno-8-48" name="__codelineno-8-48"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-8-49"><a href="#__codelineno-8-49" id="__codelineno-8-49" name="__codelineno-8-49"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-50"><a href="#__codelineno-8-50" id="__codelineno-8-50" name="__codelineno-8-50"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-51"><a href="#__codelineno-8-51" id="__codelineno-8-51" name="__codelineno-8-51"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-52"><a href="#__codelineno-8-52" id="__codelineno-8-52" name="__codelineno-8-52"></a>
</span><span id="__span-8-53"><a href="#__codelineno-8-53" id="__codelineno-8-53" name="__codelineno-8-53"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">discoverResources</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-54"><a href="#__codelineno-8-54" id="__codelineno-8-54" name="__codelineno-8-54"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-8-55"><a href="#__codelineno-8-55" id="__codelineno-8-55" name="__codelineno-8-55"></a>
</span><span id="__span-8-56"><a href="#__codelineno-8-56" id="__codelineno-8-56" name="__codelineno-8-56"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-57"><a href="#__codelineno-8-57" id="__codelineno-8-57" name="__codelineno-8-57"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">);</span>
</span><span id="__span-8-58"><a href="#__codelineno-8-58" id="__codelineno-8-58" name="__codelineno-8-58"></a>
</span><span id="__span-8-59"><a href="#__codelineno-8-59" id="__codelineno-8-59" name="__codelineno-8-59"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-60"><a href="#__codelineno-8-60" id="__codelineno-8-60" name="__codelineno-8-60"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-8-61"><a href="#__codelineno-8-61" id="__codelineno-8-61" name="__codelineno-8-61"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`file:///</span><span class="si">${</span><span class="nx">relativePath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'/'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-8-62"><a href="#__codelineno-8-62" id="__codelineno-8-62" name="__codelineno-8-62"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-8-63"><a href="#__codelineno-8-63" id="__codelineno-8-63" name="__codelineno-8-63"></a>
</span><span id="__span-8-64"><a href="#__codelineno-8-64" id="__codelineno-8-64" name="__codelineno-8-64"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-8-65"><a href="#__codelineno-8-65" id="__codelineno-8-65" name="__codelineno-8-65"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-8-66"><a href="#__codelineno-8-66" id="__codelineno-8-66" name="__codelineno-8-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">path.basename</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span>
</span><span id="__span-8-67"><a href="#__codelineno-8-67" id="__codelineno-8-67" name="__codelineno-8-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Static file: </span><span class="si">${</span><span class="nx">relativePath</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-8-68"><a href="#__codelineno-8-68" id="__codelineno-8-68" name="__codelineno-8-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-8-69"><a href="#__codelineno-8-69" id="__codelineno-8-69" name="__codelineno-8-69"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-8-70"><a href="#__codelineno-8-70" id="__codelineno-8-70" name="__codelineno-8-70"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-71"><a href="#__codelineno-8-71" id="__codelineno-8-71" name="__codelineno-8-71"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-72"><a href="#__codelineno-8-72" id="__codelineno-8-72" name="__codelineno-8-72"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Error discovering resources:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-73"><a href="#__codelineno-8-73" id="__codelineno-8-73" name="__codelineno-8-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-74"><a href="#__codelineno-8-74" id="__codelineno-8-74" name="__codelineno-8-74"></a>
</span><span id="__span-8-75"><a href="#__codelineno-8-75" id="__codelineno-8-75" name="__codelineno-8-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">resources</span><span class="p">;</span>
</span><span id="__span-8-76"><a href="#__codelineno-8-76" id="__codelineno-8-76" name="__codelineno-8-76"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-77"><a href="#__codelineno-8-77" id="__codelineno-8-77" name="__codelineno-8-77"></a>
</span><span id="__span-8-78"><a href="#__codelineno-8-78" id="__codelineno-8-78" name="__codelineno-8-78"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-79"><a href="#__codelineno-8-79" id="__codelineno-8-79" name="__codelineno-8-79"></a><span class="w">    </span><span class="c1">// Validate URI format</span>
</span><span id="__span-8-80"><a href="#__codelineno-8-80" id="__codelineno-8-80" name="__codelineno-8-80"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'file:///'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-81"><a href="#__codelineno-8-81" id="__codelineno-8-81" name="__codelineno-8-81"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid URI format: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-8-82"><a href="#__codelineno-8-82" id="__codelineno-8-82" name="__codelineno-8-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-83"><a href="#__codelineno-8-83" id="__codelineno-8-83" name="__codelineno-8-83"></a>
</span><span id="__span-8-84"><a href="#__codelineno-8-84" id="__codelineno-8-84" name="__codelineno-8-84"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'file:///'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-8-85"><a href="#__codelineno-8-85" id="__codelineno-8-85" name="__codelineno-8-85"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">,</span><span class="w"> </span><span class="nx">relativePath</span><span class="p">);</span>
</span><span id="__span-8-86"><a href="#__codelineno-8-86" id="__codelineno-8-86" name="__codelineno-8-86"></a>
</span><span id="__span-8-87"><a href="#__codelineno-8-87" id="__codelineno-8-87" name="__codelineno-8-87"></a><span class="w">    </span><span class="c1">// Security: Prevent directory traversal</span>
</span><span id="__span-8-88"><a href="#__codelineno-8-88" id="__codelineno-8-88" name="__codelineno-8-88"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-8-89"><a href="#__codelineno-8-89" id="__codelineno-8-89" name="__codelineno-8-89"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-90"><a href="#__codelineno-8-90" id="__codelineno-8-90" name="__codelineno-8-90"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Access denied: path outside resource root'</span><span class="p">);</span>
</span><span id="__span-8-91"><a href="#__codelineno-8-91" id="__codelineno-8-91" name="__codelineno-8-91"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-92"><a href="#__codelineno-8-92" id="__codelineno-8-92" name="__codelineno-8-92"></a>
</span><span id="__span-8-93"><a href="#__codelineno-8-93" id="__codelineno-8-93" name="__codelineno-8-93"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-94"><a href="#__codelineno-8-94" id="__codelineno-8-94" name="__codelineno-8-94"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">);</span>
</span><span id="__span-8-95"><a href="#__codelineno-8-95" id="__codelineno-8-95" name="__codelineno-8-95"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-8-96"><a href="#__codelineno-8-96" id="__codelineno-8-96" name="__codelineno-8-96"></a>
</span><span id="__span-8-97"><a href="#__codelineno-8-97" id="__codelineno-8-97" name="__codelineno-8-97"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-98"><a href="#__codelineno-8-98" id="__codelineno-8-98" name="__codelineno-8-98"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-8-99"><a href="#__codelineno-8-99" id="__codelineno-8-99" name="__codelineno-8-99"></a><span class="w">        </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-8-100"><a href="#__codelineno-8-100" id="__codelineno-8-100" name="__codelineno-8-100"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
</span><span id="__span-8-101"><a href="#__codelineno-8-101" id="__codelineno-8-101" name="__codelineno-8-101"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-8-102"><a href="#__codelineno-8-102" id="__codelineno-8-102" name="__codelineno-8-102"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-103"><a href="#__codelineno-8-103" id="__codelineno-8-103" name="__codelineno-8-103"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to read resource: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">'Unknown error'</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-8-104"><a href="#__codelineno-8-104" id="__codelineno-8-104" name="__codelineno-8-104"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-105"><a href="#__codelineno-8-105" id="__codelineno-8-105" name="__codelineno-8-105"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-106"><a href="#__codelineno-8-106" id="__codelineno-8-106" name="__codelineno-8-106"></a>
</span><span id="__span-8-107"><a href="#__codelineno-8-107" id="__codelineno-8-107" name="__codelineno-8-107"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">dir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-108"><a href="#__codelineno-8-108" id="__codelineno-8-108" name="__codelineno-8-108"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-8-109"><a href="#__codelineno-8-109" id="__codelineno-8-109" name="__codelineno-8-109"></a>
</span><span id="__span-8-110"><a href="#__codelineno-8-110" id="__codelineno-8-110" name="__codelineno-8-110"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-111"><a href="#__codelineno-8-111" id="__codelineno-8-111" name="__codelineno-8-111"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">withFileTypes</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-8-112"><a href="#__codelineno-8-112" id="__codelineno-8-112" name="__codelineno-8-112"></a>
</span><span id="__span-8-113"><a href="#__codelineno-8-113" id="__codelineno-8-113" name="__codelineno-8-113"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-114"><a href="#__codelineno-8-114" id="__codelineno-8-114" name="__codelineno-8-114"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-8-115"><a href="#__codelineno-8-115" id="__codelineno-8-115" name="__codelineno-8-115"></a>
</span><span id="__span-8-116"><a href="#__codelineno-8-116" id="__codelineno-8-116" name="__codelineno-8-116"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-117"><a href="#__codelineno-8-117" id="__codelineno-8-117" name="__codelineno-8-117"></a><span class="w">          </span><span class="c1">// Skip hidden directories and node_modules</span>
</span><span id="__span-8-118"><a href="#__codelineno-8-118" id="__codelineno-8-118" name="__codelineno-8-118"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">'node_modules'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-119"><a href="#__codelineno-8-119" id="__codelineno-8-119" name="__codelineno-8-119"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">));</span>
</span><span id="__span-8-120"><a href="#__codelineno-8-120" id="__codelineno-8-120" name="__codelineno-8-120"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-8-121"><a href="#__codelineno-8-121" id="__codelineno-8-121" name="__codelineno-8-121"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-122"><a href="#__codelineno-8-122" id="__codelineno-8-122" name="__codelineno-8-122"></a><span class="w">          </span><span class="c1">// Only include certain file types</span>
</span><span id="__span-8-123"><a href="#__codelineno-8-123" id="__codelineno-8-123" name="__codelineno-8-123"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-8-124"><a href="#__codelineno-8-124" id="__codelineno-8-124" name="__codelineno-8-124"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="s1">'.md'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.txt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.json'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.yaml'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.yml'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.js'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.ts'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.css'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.html'</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-125"><a href="#__codelineno-8-125" id="__codelineno-8-125" name="__codelineno-8-125"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">);</span>
</span><span id="__span-8-126"><a href="#__codelineno-8-126" id="__codelineno-8-126" name="__codelineno-8-126"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-8-127"><a href="#__codelineno-8-127" id="__codelineno-8-127" name="__codelineno-8-127"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-8-128"><a href="#__codelineno-8-128" id="__codelineno-8-128" name="__codelineno-8-128"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-129"><a href="#__codelineno-8-129" id="__codelineno-8-129" name="__codelineno-8-129"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-130"><a href="#__codelineno-8-130" id="__codelineno-8-130" name="__codelineno-8-130"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error walking directory </span><span class="si">${</span><span class="nx">dir</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-131"><a href="#__codelineno-8-131" id="__codelineno-8-131" name="__codelineno-8-131"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-132"><a href="#__codelineno-8-132" id="__codelineno-8-132" name="__codelineno-8-132"></a>
</span><span id="__span-8-133"><a href="#__codelineno-8-133" id="__codelineno-8-133" name="__codelineno-8-133"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">files</span><span class="p">;</span>
</span><span id="__span-8-134"><a href="#__codelineno-8-134" id="__codelineno-8-134" name="__codelineno-8-134"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-135"><a href="#__codelineno-8-135" id="__codelineno-8-135" name="__codelineno-8-135"></a>
</span><span id="__span-8-136"><a href="#__codelineno-8-136" id="__codelineno-8-136" name="__codelineno-8-136"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-137"><a href="#__codelineno-8-137" id="__codelineno-8-137" name="__codelineno-8-137"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-8-138"><a href="#__codelineno-8-138" id="__codelineno-8-138" name="__codelineno-8-138"></a>
</span><span id="__span-8-139"><a href="#__codelineno-8-139" id="__codelineno-8-139" name="__codelineno-8-139"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-140"><a href="#__codelineno-8-140" id="__codelineno-8-140" name="__codelineno-8-140"></a><span class="w">      </span><span class="s1">'.md'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/markdown'</span><span class="p">,</span>
</span><span id="__span-8-141"><a href="#__codelineno-8-141" id="__codelineno-8-141" name="__codelineno-8-141"></a><span class="w">      </span><span class="s1">'.txt'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">,</span>
</span><span id="__span-8-142"><a href="#__codelineno-8-142" id="__codelineno-8-142" name="__codelineno-8-142"></a><span class="w">      </span><span class="s1">'.json'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/json'</span><span class="p">,</span>
</span><span id="__span-8-143"><a href="#__codelineno-8-143" id="__codelineno-8-143" name="__codelineno-8-143"></a><span class="w">      </span><span class="s1">'.yaml'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/yaml'</span><span class="p">,</span>
</span><span id="__span-8-144"><a href="#__codelineno-8-144" id="__codelineno-8-144" name="__codelineno-8-144"></a><span class="w">      </span><span class="s1">'.yml'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/yaml'</span><span class="p">,</span>
</span><span id="__span-8-145"><a href="#__codelineno-8-145" id="__codelineno-8-145" name="__codelineno-8-145"></a><span class="w">      </span><span class="s1">'.js'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/javascript'</span><span class="p">,</span>
</span><span id="__span-8-146"><a href="#__codelineno-8-146" id="__codelineno-8-146" name="__codelineno-8-146"></a><span class="w">      </span><span class="s1">'.ts'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/typescript'</span><span class="p">,</span>
</span><span id="__span-8-147"><a href="#__codelineno-8-147" id="__codelineno-8-147" name="__codelineno-8-147"></a><span class="w">      </span><span class="s1">'.css'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/css'</span><span class="p">,</span>
</span><span id="__span-8-148"><a href="#__codelineno-8-148" id="__codelineno-8-148" name="__codelineno-8-148"></a><span class="w">      </span><span class="s1">'.html'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/html'</span><span class="p">,</span>
</span><span id="__span-8-149"><a href="#__codelineno-8-149" id="__codelineno-8-149" name="__codelineno-8-149"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-8-150"><a href="#__codelineno-8-150" id="__codelineno-8-150" name="__codelineno-8-150"></a>
</span><span id="__span-8-151"><a href="#__codelineno-8-151" id="__codelineno-8-151" name="__codelineno-8-151"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="p">[</span><span class="nx">ext</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">;</span>
</span><span id="__span-8-152"><a href="#__codelineno-8-152" id="__codelineno-8-152" name="__codelineno-8-152"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-153"><a href="#__codelineno-8-153" id="__codelineno-8-153" name="__codelineno-8-153"></a>
</span><span id="__span-8-154"><a href="#__codelineno-8-154" id="__codelineno-8-154" name="__codelineno-8-154"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-155"><a href="#__codelineno-8-155" id="__codelineno-8-155" name="__codelineno-8-155"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-156"><a href="#__codelineno-8-156" id="__codelineno-8-156" name="__codelineno-8-156"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-157"><a href="#__codelineno-8-157" id="__codelineno-8-157" name="__codelineno-8-157"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-8-158"><a href="#__codelineno-8-158" id="__codelineno-8-158" name="__codelineno-8-158"></a>
</span><span id="__span-8-159"><a href="#__codelineno-8-159" id="__codelineno-8-159" name="__codelineno-8-159"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-160"><a href="#__codelineno-8-160" id="__codelineno-8-160" name="__codelineno-8-160"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-8-161"><a href="#__codelineno-8-161" id="__codelineno-8-161" name="__codelineno-8-161"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-8-162"><a href="#__codelineno-8-162" id="__codelineno-8-162" name="__codelineno-8-162"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-163"><a href="#__codelineno-8-163" id="__codelineno-8-163" name="__codelineno-8-163"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-164"><a href="#__codelineno-8-164" id="__codelineno-8-164" name="__codelineno-8-164"></a>
</span><span id="__span-8-165"><a href="#__codelineno-8-165" id="__codelineno-8-165" name="__codelineno-8-165"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-166"><a href="#__codelineno-8-166" id="__codelineno-8-166" name="__codelineno-8-166"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-8-167"><a href="#__codelineno-8-167" id="__codelineno-8-167" name="__codelineno-8-167"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-8-168"><a href="#__codelineno-8-168" id="__codelineno-8-168" name="__codelineno-8-168"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Static Resource Server running on stdio (root: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-8-169"><a href="#__codelineno-8-169" id="__codelineno-8-169" name="__codelineno-8-169"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-170"><a href="#__codelineno-8-170" id="__codelineno-8-170" name="__codelineno-8-170"></a><span class="p">}</span>
</span><span id="__span-8-171"><a href="#__codelineno-8-171" id="__codelineno-8-171" name="__codelineno-8-171"></a>
</span><span id="__span-8-172"><a href="#__codelineno-8-172" id="__codelineno-8-172" name="__codelineno-8-172"></a><span class="c1">// Main entry point</span>
</span><span id="__span-8-173"><a href="#__codelineno-8-173" id="__codelineno-8-173" name="__codelineno-8-173"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-174"><a href="#__codelineno-8-174" id="__codelineno-8-174" name="__codelineno-8-174"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StaticResourceServer</span><span class="p">();</span>
</span><span id="__span-8-175"><a href="#__codelineno-8-175" id="__codelineno-8-175" name="__codelineno-8-175"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-8-176"><a href="#__codelineno-8-176" id="__codelineno-8-176" name="__codelineno-8-176"></a><span class="p">}</span>
</span><span id="__span-8-177"><a href="#__codelineno-8-177" id="__codelineno-8-177" name="__codelineno-8-177"></a>
</span><span id="__span-8-178"><a href="#__codelineno-8-178" id="__codelineno-8-178" name="__codelineno-8-178"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-179"><a href="#__codelineno-8-179" id="__codelineno-8-179" name="__codelineno-8-179"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-180"><a href="#__codelineno-8-180" id="__codelineno-8-180" name="__codelineno-8-180"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-8-181"><a href="#__codelineno-8-181" id="__codelineno-8-181" name="__codelineno-8-181"></a><span class="p">});</span>
</span></code></pre></div> <h3 id="testing-static-resources">Testing Static Resources<a class="headerlink" href="#testing-static-resources" title="Permanent link">¶</a></h3> <p><strong>Step 1: Create Test Resources</strong></p> <p>First, let’s create some test files that our static resource server can expose. These files will simulate a typical project structure with documentation, configuration, and general project files.</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># Create the directory structure</span>
</span><span id="__span-9-2"><a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>resources/docs<span class="w"> </span>resources/config
</span><span id="__span-9-3"><a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a>
</span><span id="__span-9-4"><a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="c1"># Create a markdown documentation file</span>
</span><span id="__span-9-5"><a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"# API Documentation\n\nThis is the API docs."</span><span class="w"> </span>&gt;<span class="w"> </span>resources/docs/api.md
</span><span id="__span-9-6"><a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a>
</span><span id="__span-9-7"><a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="c1"># Create a JSON configuration file</span>
</span><span id="__span-9-8"><a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"version": "1.0.0", "env": "development"}'</span><span class="w"> </span>&gt;<span class="w"> </span>resources/config/settings.json
</span><span id="__span-9-9"><a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a>
</span><span id="__span-9-10"><a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="c1"># Create a plain text README file</span>
</span><span id="__span-9-11"><a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"Welcome to our project!"</span><span class="w"> </span>&gt;<span class="w"> </span>resources/README.txt
</span></code></pre></div> <p><strong>What this creates:</strong></p> <ul> <li><code>resources/docs/api.md</code> - A markdown file with API documentation</li> <li><code>resources/config/settings.json</code> - A JSON configuration file with version and environment info</li> <li><code>resources/README.txt</code> - A plain text file with project information</li> </ul> <p><br/></p> <p><strong>Step 2: Start the Server</strong></p> <p>Now start your MCP server using the MCP Inspector. </p> <p>This will launch both your server and the testing interface:</p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>What to expect:</strong></p> <ul> <li>The MCP Inspector window should open in your browser</li> <li>Your server will start and connect via <code>stdio</code> transport</li> <li>You should see connection confirmation in the terminal</li> <li>The inspector interface will show tabs for Resources, Tools, etc.</li> </ul> <p><br/></p> <p><strong>Step 3: Test Resource Discovery</strong></p> <p>In the MCP Inspector, navigate to the <strong>Resources</strong> tab to see what resources your server is exposing.</p> <ul> <li> <p>The MCP Inspector should show resources like:</p> <ul> <li><code>file:///docs/api.md</code> - Your API documentation file</li> <li><code>file:///config/settings.json</code> - Your configuration file</li> <li><code>file:///README.txt</code> - Your project README</li> </ul> </li> </ul> <p><strong>What to verify:</strong></p> <ul> <li>All three resources should be listed</li> <li>Each resource should have a descriptive name and description</li> <li>MIME types should be correctly detected (text/markdown, application/json, text/plain)</li> <li>URIs should follow the <code>file://</code> scheme with proper paths</li> </ul> <p><br/></p> <p><strong>Step 4: Test Resource Reading</strong></p> <p>Click on each resource in the list to read its content and verify proper handling.</p> <ul> <li> <p>Click on <code>file:///docs/api.md</code>:</p> <ul> <li>Should display: “# API Documentation\n\nThis is the API docs.”</li> <li>MIME type should be: text/markdown</li> </ul> </li> <li> <p>Click on <code>file:///config/settings.json</code>:</p> <ul> <li>Should display: {“version”: “1.0.0”, “env”: “development”}</li> <li>MIME type should be: application/json</li> </ul> </li> <li> <p>Click on <code>file:///README.txt</code>:</p> <ul> <li>Should display: “Welcome to our project!”</li> <li>MIME type should be: text/plain</li> </ul> </li> </ul> <p><strong>Error Testing:</strong></p> <ul> <li>Try reading a non-existent resource like <code>file:///does-not-exist.txt</code></li> <li>Should show an appropriate error message</li> <li>Verify the server handles invalid URIs gracefully</li> </ul> <p><strong>What to learn:</strong></p> <ul> <li>Resources provide direct access to file content</li> <li>MIME types help clients handle different content types</li> <li>Error handling is important for robust resource servers</li> <li>The inspector provides a complete testing environment</li> </ul> <hr/> <h2 id="implementing-dynamic-resources">Implementing Dynamic Resources<a class="headerlink" href="#implementing-dynamic-resources" title="Permanent link">¶</a></h2> <p>Dynamic resources generate content on-demand based on parameters or current state. They’re useful for live data, computed views, and parameterized access.</p> <h3 id="resource-templates">Resource Templates<a class="headerlink" href="#resource-templates" title="Permanent link">¶</a></h3> <p>Resource templates allow parameterized URIs using <code>{parameter}</code> syntax:</p> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-11-1"><a href="#__codelineno-11-1" id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="c1">// Template definition</span>
</span><span id="__span-11-2"><a href="#__codelineno-11-2" id="__codelineno-11-2" name="__codelineno-11-2"></a><span class="p">{</span>
</span><span id="__span-11-3"><a href="#__codelineno-11-3" id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="w">  </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://users/{userId}/profile"</span><span class="p">,</span>
</span><span id="__span-11-4"><a href="#__codelineno-11-4" id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"User Profile"</span><span class="p">,</span>
</span><span id="__span-11-5"><a href="#__codelineno-11-5" id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Profile data for a specific user"</span><span class="p">,</span>
</span><span id="__span-11-6"><a href="#__codelineno-11-6" id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="w">  </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span>
</span><span id="__span-11-7"><a href="#__codelineno-11-7" id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="p">}</span>
</span><span id="__span-11-8"><a href="#__codelineno-11-8" id="__codelineno-11-8" name="__codelineno-11-8"></a>
</span><span id="__span-11-9"><a href="#__codelineno-11-9" id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="c1">// Generated URIs</span>
</span><span id="__span-11-10"><a href="#__codelineno-11-10" id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="s2">"db://users/123/profile"</span>
</span><span id="__span-11-11"><a href="#__codelineno-11-11" id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="s2">"db://users/456/profile"</span>
</span></code></pre></div> <h3 id="complete-dynamic-resource-server">Complete Dynamic Resource Server<a class="headerlink" href="#complete-dynamic-resource-server" title="Permanent link">¶</a></h3> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-12-1"><a href="#__codelineno-12-1" id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-12-2"><a href="#__codelineno-12-2" id="__codelineno-12-2" name="__codelineno-12-2"></a>
</span><span id="__span-12-3"><a href="#__codelineno-12-3" id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-12-4"><a href="#__codelineno-12-4" id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-12-5"><a href="#__codelineno-12-5" id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a href="#__codelineno-12-6" id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-7"><a href="#__codelineno-12-7" id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-8"><a href="#__codelineno-12-8" id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-9"><a href="#__codelineno-12-9" id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-12-10"><a href="#__codelineno-12-10" id="__codelineno-12-10" name="__codelineno-12-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-12-11"><a href="#__codelineno-12-11" id="__codelineno-12-11" name="__codelineno-12-11"></a>
</span><span id="__span-12-12"><a href="#__codelineno-12-12" id="__codelineno-12-12" name="__codelineno-12-12"></a><span class="cm">/**</span>
</span><span id="__span-12-13"><a href="#__codelineno-12-13" id="__codelineno-12-13" name="__codelineno-12-13"></a><span class="cm"> * MCP Server with dynamic resources and templates</span>
</span><span id="__span-12-14"><a href="#__codelineno-12-14" id="__codelineno-12-14" name="__codelineno-12-14"></a><span class="cm"> */</span>
</span><span id="__span-12-15"><a href="#__codelineno-12-15" id="__codelineno-12-15" name="__codelineno-12-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">DynamicResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-16"><a href="#__codelineno-12-16" id="__codelineno-12-16" name="__codelineno-12-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-12-17"><a href="#__codelineno-12-17" id="__codelineno-12-17" name="__codelineno-12-17"></a>
</span><span id="__span-12-18"><a href="#__codelineno-12-18" id="__codelineno-12-18" name="__codelineno-12-18"></a><span class="w">  </span><span class="c1">// Mock data store</span>
</span><span id="__span-12-19"><a href="#__codelineno-12-19" id="__codelineno-12-19" name="__codelineno-12-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-20"><a href="#__codelineno-12-20" id="__codelineno-12-20" name="__codelineno-12-20"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Alice Johnson"</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">"alice@example.com"</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-21"><a href="#__codelineno-12-21" id="__codelineno-12-21" name="__codelineno-12-21"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Bob Smith"</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">"bob@example.com"</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-22"><a href="#__codelineno-12-22" id="__codelineno-12-22" name="__codelineno-12-22"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Charlie Brown"</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">"charlie@example.com"</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">"user"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-23"><a href="#__codelineno-12-23" id="__codelineno-12-23" name="__codelineno-12-23"></a><span class="w">  </span><span class="p">];</span>
</span><span id="__span-12-24"><a href="#__codelineno-12-24" id="__codelineno-12-24" name="__codelineno-12-24"></a>
</span><span id="__span-12-25"><a href="#__codelineno-12-25" id="__codelineno-12-25" name="__codelineno-12-25"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-26"><a href="#__codelineno-12-26" id="__codelineno-12-26" name="__codelineno-12-26"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Laptop"</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">999.99</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">"Electronics"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-27"><a href="#__codelineno-12-27" id="__codelineno-12-27" name="__codelineno-12-27"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Book"</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">19.99</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">"Education"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-28"><a href="#__codelineno-12-28" id="__codelineno-12-28" name="__codelineno-12-28"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Coffee Mug"</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">12.50</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">"Kitchen"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-29"><a href="#__codelineno-12-29" id="__codelineno-12-29" name="__codelineno-12-29"></a><span class="w">  </span><span class="p">];</span>
</span><span id="__span-12-30"><a href="#__codelineno-12-30" id="__codelineno-12-30" name="__codelineno-12-30"></a>
</span><span id="__span-12-31"><a href="#__codelineno-12-31" id="__codelineno-12-31" name="__codelineno-12-31"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-32"><a href="#__codelineno-12-32" id="__codelineno-12-32" name="__codelineno-12-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-12-33"><a href="#__codelineno-12-33" id="__codelineno-12-33" name="__codelineno-12-33"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-34"><a href="#__codelineno-12-34" id="__codelineno-12-34" name="__codelineno-12-34"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"dynamic-resource-server"</span><span class="p">,</span>
</span><span id="__span-12-35"><a href="#__codelineno-12-35" id="__codelineno-12-35" name="__codelineno-12-35"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-12-36"><a href="#__codelineno-12-36" id="__codelineno-12-36" name="__codelineno-12-36"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-12-37"><a href="#__codelineno-12-37" id="__codelineno-12-37" name="__codelineno-12-37"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-38"><a href="#__codelineno-12-38" id="__codelineno-12-38" name="__codelineno-12-38"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-39"><a href="#__codelineno-12-39" id="__codelineno-12-39" name="__codelineno-12-39"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-12-40"><a href="#__codelineno-12-40" id="__codelineno-12-40" name="__codelineno-12-40"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-41"><a href="#__codelineno-12-41" id="__codelineno-12-41" name="__codelineno-12-41"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-42"><a href="#__codelineno-12-42" id="__codelineno-12-42" name="__codelineno-12-42"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-12-43"><a href="#__codelineno-12-43" id="__codelineno-12-43" name="__codelineno-12-43"></a>
</span><span id="__span-12-44"><a href="#__codelineno-12-44" id="__codelineno-12-44" name="__codelineno-12-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-12-45"><a href="#__codelineno-12-45" id="__codelineno-12-45" name="__codelineno-12-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-12-46"><a href="#__codelineno-12-46" id="__codelineno-12-46" name="__codelineno-12-46"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-47"><a href="#__codelineno-12-47" id="__codelineno-12-47" name="__codelineno-12-47"></a>
</span><span id="__span-12-48"><a href="#__codelineno-12-48" id="__codelineno-12-48" name="__codelineno-12-48"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-49"><a href="#__codelineno-12-49" id="__codelineno-12-49" name="__codelineno-12-49"></a><span class="w">    </span><span class="c1">// List resource templates</span>
</span><span id="__span-12-50"><a href="#__codelineno-12-50" id="__codelineno-12-50" name="__codelineno-12-50"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-51"><a href="#__codelineno-12-51" id="__codelineno-12-51" name="__codelineno-12-51"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-52"><a href="#__codelineno-12-52" id="__codelineno-12-52" name="__codelineno-12-52"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-53"><a href="#__codelineno-12-53" id="__codelineno-12-53" name="__codelineno-12-53"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://users/{userId}/profile"</span><span class="p">,</span>
</span><span id="__span-12-54"><a href="#__codelineno-12-54" id="__codelineno-12-54" name="__codelineno-12-54"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"User Profile"</span><span class="p">,</span>
</span><span id="__span-12-55"><a href="#__codelineno-12-55" id="__codelineno-12-55" name="__codelineno-12-55"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Profile information for a specific user"</span><span class="p">,</span>
</span><span id="__span-12-56"><a href="#__codelineno-12-56" id="__codelineno-12-56" name="__codelineno-12-56"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-57"><a href="#__codelineno-12-57" id="__codelineno-12-57" name="__codelineno-12-57"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-58"><a href="#__codelineno-12-58" id="__codelineno-12-58" name="__codelineno-12-58"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-59"><a href="#__codelineno-12-59" id="__codelineno-12-59" name="__codelineno-12-59"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://products/{productId}/details"</span><span class="p">,</span>
</span><span id="__span-12-60"><a href="#__codelineno-12-60" id="__codelineno-12-60" name="__codelineno-12-60"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Product Details"</span><span class="p">,</span>
</span><span id="__span-12-61"><a href="#__codelineno-12-61" id="__codelineno-12-61" name="__codelineno-12-61"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Detailed information about a product"</span><span class="p">,</span>
</span><span id="__span-12-62"><a href="#__codelineno-12-62" id="__codelineno-12-62" name="__codelineno-12-62"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-63"><a href="#__codelineno-12-63" id="__codelineno-12-63" name="__codelineno-12-63"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-64"><a href="#__codelineno-12-64" id="__codelineno-12-64" name="__codelineno-12-64"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-65"><a href="#__codelineno-12-65" id="__codelineno-12-65" name="__codelineno-12-65"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://stats/{category}/summary"</span><span class="p">,</span>
</span><span id="__span-12-66"><a href="#__codelineno-12-66" id="__codelineno-12-66" name="__codelineno-12-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Category Statistics"</span><span class="p">,</span>
</span><span id="__span-12-67"><a href="#__codelineno-12-67" id="__codelineno-12-67" name="__codelineno-12-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Statistical summary for a product category"</span><span class="p">,</span>
</span><span id="__span-12-68"><a href="#__codelineno-12-68" id="__codelineno-12-68" name="__codelineno-12-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-69"><a href="#__codelineno-12-69" id="__codelineno-12-69" name="__codelineno-12-69"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-70"><a href="#__codelineno-12-70" id="__codelineno-12-70" name="__codelineno-12-70"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-12-71"><a href="#__codelineno-12-71" id="__codelineno-12-71" name="__codelineno-12-71"></a>
</span><span id="__span-12-72"><a href="#__codelineno-12-72" id="__codelineno-12-72" name="__codelineno-12-72"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-73"><a href="#__codelineno-12-73" id="__codelineno-12-73" name="__codelineno-12-73"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-74"><a href="#__codelineno-12-74" id="__codelineno-12-74" name="__codelineno-12-74"></a>
</span><span id="__span-12-75"><a href="#__codelineno-12-75" id="__codelineno-12-75" name="__codelineno-12-75"></a><span class="w">    </span><span class="c1">// List available resources (dynamic)</span>
</span><span id="__span-12-76"><a href="#__codelineno-12-76" id="__codelineno-12-76" name="__codelineno-12-76"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-77"><a href="#__codelineno-12-77" id="__codelineno-12-77" name="__codelineno-12-77"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-78"><a href="#__codelineno-12-78" id="__codelineno-12-78" name="__codelineno-12-78"></a>
</span><span id="__span-12-79"><a href="#__codelineno-12-79" id="__codelineno-12-79" name="__codelineno-12-79"></a><span class="w">      </span><span class="c1">// Add user resources</span>
</span><span id="__span-12-80"><a href="#__codelineno-12-80" id="__codelineno-12-80" name="__codelineno-12-80"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-81"><a href="#__codelineno-12-81" id="__codelineno-12-81" name="__codelineno-12-81"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-82"><a href="#__codelineno-12-82" id="__codelineno-12-82" name="__codelineno-12-82"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://users/</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/profile`</span><span class="p">,</span>
</span><span id="__span-12-83"><a href="#__codelineno-12-83" id="__codelineno-12-83" name="__codelineno-12-83"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`User: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-84"><a href="#__codelineno-12-84" id="__codelineno-12-84" name="__codelineno-12-84"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Profile for </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-85"><a href="#__codelineno-12-85" id="__codelineno-12-85" name="__codelineno-12-85"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-86"><a href="#__codelineno-12-86" id="__codelineno-12-86" name="__codelineno-12-86"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-87"><a href="#__codelineno-12-87" id="__codelineno-12-87" name="__codelineno-12-87"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-88"><a href="#__codelineno-12-88" id="__codelineno-12-88" name="__codelineno-12-88"></a>
</span><span id="__span-12-89"><a href="#__codelineno-12-89" id="__codelineno-12-89" name="__codelineno-12-89"></a><span class="w">      </span><span class="c1">// Add product resources</span>
</span><span id="__span-12-90"><a href="#__codelineno-12-90" id="__codelineno-12-90" name="__codelineno-12-90"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-91"><a href="#__codelineno-12-91" id="__codelineno-12-91" name="__codelineno-12-91"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-92"><a href="#__codelineno-12-92" id="__codelineno-12-92" name="__codelineno-12-92"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/details`</span><span class="p">,</span>
</span><span id="__span-12-93"><a href="#__codelineno-12-93" id="__codelineno-12-93" name="__codelineno-12-93"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`Product: </span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-94"><a href="#__codelineno-12-94" id="__codelineno-12-94" name="__codelineno-12-94"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="si">}</span><span class="sb"> - $</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-95"><a href="#__codelineno-12-95" id="__codelineno-12-95" name="__codelineno-12-95"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-96"><a href="#__codelineno-12-96" id="__codelineno-12-96" name="__codelineno-12-96"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-97"><a href="#__codelineno-12-97" id="__codelineno-12-97" name="__codelineno-12-97"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-98"><a href="#__codelineno-12-98" id="__codelineno-12-98" name="__codelineno-12-98"></a>
</span><span id="__span-12-99"><a href="#__codelineno-12-99" id="__codelineno-12-99" name="__codelineno-12-99"></a><span class="w">      </span><span class="c1">// Add category stats</span>
</span><span id="__span-12-100"><a href="#__codelineno-12-100" id="__codelineno-12-100" name="__codelineno-12-100"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">category</span><span class="p">))];</span>
</span><span id="__span-12-101"><a href="#__codelineno-12-101" id="__codelineno-12-101" name="__codelineno-12-101"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">category</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-102"><a href="#__codelineno-12-102" id="__codelineno-12-102" name="__codelineno-12-102"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-103"><a href="#__codelineno-12-103" id="__codelineno-12-103" name="__codelineno-12-103"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://stats/</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">/summary`</span><span class="p">,</span>
</span><span id="__span-12-104"><a href="#__codelineno-12-104" id="__codelineno-12-104" name="__codelineno-12-104"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb"> Statistics`</span><span class="p">,</span>
</span><span id="__span-12-105"><a href="#__codelineno-12-105" id="__codelineno-12-105" name="__codelineno-12-105"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Summary statistics for </span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-106"><a href="#__codelineno-12-106" id="__codelineno-12-106" name="__codelineno-12-106"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-107"><a href="#__codelineno-12-107" id="__codelineno-12-107" name="__codelineno-12-107"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-108"><a href="#__codelineno-12-108" id="__codelineno-12-108" name="__codelineno-12-108"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-109"><a href="#__codelineno-12-109" id="__codelineno-12-109" name="__codelineno-12-109"></a>
</span><span id="__span-12-110"><a href="#__codelineno-12-110" id="__codelineno-12-110" name="__codelineno-12-110"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-111"><a href="#__codelineno-12-111" id="__codelineno-12-111" name="__codelineno-12-111"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-112"><a href="#__codelineno-12-112" id="__codelineno-12-112" name="__codelineno-12-112"></a>
</span><span id="__span-12-113"><a href="#__codelineno-12-113" id="__codelineno-12-113" name="__codelineno-12-113"></a><span class="w">    </span><span class="c1">// Read specific resource</span>
</span><span id="__span-12-114"><a href="#__codelineno-12-114" id="__codelineno-12-114" name="__codelineno-12-114"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-115"><a href="#__codelineno-12-115" id="__codelineno-12-115" name="__codelineno-12-115"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-12-116"><a href="#__codelineno-12-116" id="__codelineno-12-116" name="__codelineno-12-116"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generateResourceContent</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-12-117"><a href="#__codelineno-12-117" id="__codelineno-12-117" name="__codelineno-12-117"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-118"><a href="#__codelineno-12-118" id="__codelineno-12-118" name="__codelineno-12-118"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-119"><a href="#__codelineno-12-119" id="__codelineno-12-119" name="__codelineno-12-119"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-120"><a href="#__codelineno-12-120" id="__codelineno-12-120" name="__codelineno-12-120"></a>
</span><span id="__span-12-121"><a href="#__codelineno-12-121" id="__codelineno-12-121" name="__codelineno-12-121"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">generateResourceContent</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-122"><a href="#__codelineno-12-122" id="__codelineno-12-122" name="__codelineno-12-122"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
</span><span id="__span-12-123"><a href="#__codelineno-12-123" id="__codelineno-12-123" name="__codelineno-12-123"></a>
</span><span id="__span-12-124"><a href="#__codelineno-12-124" id="__codelineno-12-124" name="__codelineno-12-124"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'db:'</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">''</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-125"><a href="#__codelineno-12-125" id="__codelineno-12-125" name="__codelineno-12-125"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">2</span><span class="p">];</span>
</span><span id="__span-12-126"><a href="#__codelineno-12-126" id="__codelineno-12-126" name="__codelineno-12-126"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-12-127"><a href="#__codelineno-12-127" id="__codelineno-12-127" name="__codelineno-12-127"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">4</span><span class="p">];</span>
</span><span id="__span-12-128"><a href="#__codelineno-12-128" id="__codelineno-12-128" name="__codelineno-12-128"></a>
</span><span id="__span-12-129"><a href="#__codelineno-12-129" id="__codelineno-12-129" name="__codelineno-12-129"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-130"><a href="#__codelineno-12-130" id="__codelineno-12-130" name="__codelineno-12-130"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">'users'</span><span class="o">:</span>
</span><span id="__span-12-131"><a href="#__codelineno-12-131" id="__codelineno-12-131" name="__codelineno-12-131"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'profile'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-132"><a href="#__codelineno-12-132" id="__codelineno-12-132" name="__codelineno-12-132"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
</span><span id="__span-12-133"><a href="#__codelineno-12-133" id="__codelineno-12-133" name="__codelineno-12-133"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`User </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">);</span>
</span><span id="__span-12-134"><a href="#__codelineno-12-134" id="__codelineno-12-134" name="__codelineno-12-134"></a>
</span><span id="__span-12-135"><a href="#__codelineno-12-135" id="__codelineno-12-135" name="__codelineno-12-135"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-136"><a href="#__codelineno-12-136" id="__codelineno-12-136" name="__codelineno-12-136"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-137"><a href="#__codelineno-12-137" id="__codelineno-12-137" name="__codelineno-12-137"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-138"><a href="#__codelineno-12-138" id="__codelineno-12-138" name="__codelineno-12-138"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-12-139"><a href="#__codelineno-12-139" id="__codelineno-12-139" name="__codelineno-12-139"></a><span class="w">                </span><span class="nx">user</span><span class="p">,</span>
</span><span id="__span-12-140"><a href="#__codelineno-12-140" id="__codelineno-12-140" name="__codelineno-12-140"></a><span class="w">                </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-141"><a href="#__codelineno-12-141" id="__codelineno-12-141" name="__codelineno-12-141"></a><span class="w">                  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-142"><a href="#__codelineno-12-142" id="__codelineno-12-142" name="__codelineno-12-142"></a><span class="w">                  </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s2">"dynamic-resource-server"</span>
</span><span id="__span-12-143"><a href="#__codelineno-12-143" id="__codelineno-12-143" name="__codelineno-12-143"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-144"><a href="#__codelineno-12-144" id="__codelineno-12-144" name="__codelineno-12-144"></a><span class="w">              </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-145"><a href="#__codelineno-12-145" id="__codelineno-12-145" name="__codelineno-12-145"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-146"><a href="#__codelineno-12-146" id="__codelineno-12-146" name="__codelineno-12-146"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-147"><a href="#__codelineno-12-147" id="__codelineno-12-147" name="__codelineno-12-147"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-148"><a href="#__codelineno-12-148" id="__codelineno-12-148" name="__codelineno-12-148"></a>
</span><span id="__span-12-149"><a href="#__codelineno-12-149" id="__codelineno-12-149" name="__codelineno-12-149"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">'products'</span><span class="o">:</span>
</span><span id="__span-12-150"><a href="#__codelineno-12-150" id="__codelineno-12-150" name="__codelineno-12-150"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'details'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-151"><a href="#__codelineno-12-151" id="__codelineno-12-151" name="__codelineno-12-151"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
</span><span id="__span-12-152"><a href="#__codelineno-12-152" id="__codelineno-12-152" name="__codelineno-12-152"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Product </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">);</span>
</span><span id="__span-12-153"><a href="#__codelineno-12-153" id="__codelineno-12-153" name="__codelineno-12-153"></a>
</span><span id="__span-12-154"><a href="#__codelineno-12-154" id="__codelineno-12-154" name="__codelineno-12-154"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-155"><a href="#__codelineno-12-155" id="__codelineno-12-155" name="__codelineno-12-155"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-156"><a href="#__codelineno-12-156" id="__codelineno-12-156" name="__codelineno-12-156"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-157"><a href="#__codelineno-12-157" id="__codelineno-12-157" name="__codelineno-12-157"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-12-158"><a href="#__codelineno-12-158" id="__codelineno-12-158" name="__codelineno-12-158"></a><span class="w">                </span><span class="nx">product</span><span class="p">,</span>
</span><span id="__span-12-159"><a href="#__codelineno-12-159" id="__codelineno-12-159" name="__codelineno-12-159"></a><span class="w">                </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-160"><a href="#__codelineno-12-160" id="__codelineno-12-160" name="__codelineno-12-160"></a><span class="w">                  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-161"><a href="#__codelineno-12-161" id="__codelineno-12-161" name="__codelineno-12-161"></a><span class="w">                  </span><span class="nx">inStock</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="c1">// Simulate stock status</span>
</span><span id="__span-12-162"><a href="#__codelineno-12-162" id="__codelineno-12-162" name="__codelineno-12-162"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-163"><a href="#__codelineno-12-163" id="__codelineno-12-163" name="__codelineno-12-163"></a><span class="w">              </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-164"><a href="#__codelineno-12-164" id="__codelineno-12-164" name="__codelineno-12-164"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-165"><a href="#__codelineno-12-165" id="__codelineno-12-165" name="__codelineno-12-165"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-166"><a href="#__codelineno-12-166" id="__codelineno-12-166" name="__codelineno-12-166"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-167"><a href="#__codelineno-12-167" id="__codelineno-12-167" name="__codelineno-12-167"></a>
</span><span id="__span-12-168"><a href="#__codelineno-12-168" id="__codelineno-12-168" name="__codelineno-12-168"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">'stats'</span><span class="o">:</span>
</span><span id="__span-12-169"><a href="#__codelineno-12-169" id="__codelineno-12-169" name="__codelineno-12-169"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'summary'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-170"><a href="#__codelineno-12-170" id="__codelineno-12-170" name="__codelineno-12-170"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-12-171"><a href="#__codelineno-12-171" id="__codelineno-12-171" name="__codelineno-12-171"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">categoryProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">category</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">category</span><span class="p">);</span>
</span><span id="__span-12-172"><a href="#__codelineno-12-172" id="__codelineno-12-172" name="__codelineno-12-172"></a>
</span><span id="__span-12-173"><a href="#__codelineno-12-173" id="__codelineno-12-173" name="__codelineno-12-173"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-174"><a href="#__codelineno-12-174" id="__codelineno-12-174" name="__codelineno-12-174"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Category '</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">' not found`</span><span class="p">);</span>
</span><span id="__span-12-175"><a href="#__codelineno-12-175" id="__codelineno-12-175" name="__codelineno-12-175"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-176"><a href="#__codelineno-12-176" id="__codelineno-12-176" name="__codelineno-12-176"></a>
</span><span id="__span-12-177"><a href="#__codelineno-12-177" id="__codelineno-12-177" name="__codelineno-12-177"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-178"><a href="#__codelineno-12-178" id="__codelineno-12-178" name="__codelineno-12-178"></a><span class="w">              </span><span class="nx">category</span><span class="p">,</span>
</span><span id="__span-12-179"><a href="#__codelineno-12-179" id="__codelineno-12-179" name="__codelineno-12-179"></a><span class="w">              </span><span class="nx">totalProducts</span><span class="o">:</span><span class="w"> </span><span class="kt">categoryProducts.length</span><span class="p">,</span>
</span><span id="__span-12-180"><a href="#__codelineno-12-180" id="__codelineno-12-180" name="__codelineno-12-180"></a><span class="w">              </span><span class="nx">averagePrice</span><span class="o">:</span><span class="w"> </span><span class="kt">categoryProducts.reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
</span><span id="__span-12-181"><a href="#__codelineno-12-181" id="__codelineno-12-181" name="__codelineno-12-181"></a><span class="w">              </span><span class="nx">priceRange</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-182"><a href="#__codelineno-12-182" id="__codelineno-12-182" name="__codelineno-12-182"></a><span class="w">                </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.min</span><span class="p">(...</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">)),</span>
</span><span id="__span-12-183"><a href="#__codelineno-12-183" id="__codelineno-12-183" name="__codelineno-12-183"></a><span class="w">                </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.max</span><span class="p">(...</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">)),</span>
</span><span id="__span-12-184"><a href="#__codelineno-12-184" id="__codelineno-12-184" name="__codelineno-12-184"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-12-185"><a href="#__codelineno-12-185" id="__codelineno-12-185" name="__codelineno-12-185"></a><span class="w">              </span><span class="nx">generatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-186"><a href="#__codelineno-12-186" id="__codelineno-12-186" name="__codelineno-12-186"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-187"><a href="#__codelineno-12-187" id="__codelineno-12-187" name="__codelineno-12-187"></a>
</span><span id="__span-12-188"><a href="#__codelineno-12-188" id="__codelineno-12-188" name="__codelineno-12-188"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-189"><a href="#__codelineno-12-189" id="__codelineno-12-189" name="__codelineno-12-189"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-190"><a href="#__codelineno-12-190" id="__codelineno-12-190" name="__codelineno-12-190"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-12-191"><a href="#__codelineno-12-191" id="__codelineno-12-191" name="__codelineno-12-191"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">stats</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-192"><a href="#__codelineno-12-192" id="__codelineno-12-192" name="__codelineno-12-192"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-193"><a href="#__codelineno-12-193" id="__codelineno-12-193" name="__codelineno-12-193"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-194"><a href="#__codelineno-12-194" id="__codelineno-12-194" name="__codelineno-12-194"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-195"><a href="#__codelineno-12-195" id="__codelineno-12-195" name="__codelineno-12-195"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-196"><a href="#__codelineno-12-196" id="__codelineno-12-196" name="__codelineno-12-196"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-197"><a href="#__codelineno-12-197" id="__codelineno-12-197" name="__codelineno-12-197"></a>
</span><span id="__span-12-198"><a href="#__codelineno-12-198" id="__codelineno-12-198" name="__codelineno-12-198"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown resource URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-12-199"><a href="#__codelineno-12-199" id="__codelineno-12-199" name="__codelineno-12-199"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-200"><a href="#__codelineno-12-200" id="__codelineno-12-200" name="__codelineno-12-200"></a>
</span><span id="__span-12-201"><a href="#__codelineno-12-201" id="__codelineno-12-201" name="__codelineno-12-201"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-202"><a href="#__codelineno-12-202" id="__codelineno-12-202" name="__codelineno-12-202"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-203"><a href="#__codelineno-12-203" id="__codelineno-12-203" name="__codelineno-12-203"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-12-204"><a href="#__codelineno-12-204" id="__codelineno-12-204" name="__codelineno-12-204"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-12-205"><a href="#__codelineno-12-205" id="__codelineno-12-205" name="__codelineno-12-205"></a>
</span><span id="__span-12-206"><a href="#__codelineno-12-206" id="__codelineno-12-206" name="__codelineno-12-206"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-207"><a href="#__codelineno-12-207" id="__codelineno-12-207" name="__codelineno-12-207"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-12-208"><a href="#__codelineno-12-208" id="__codelineno-12-208" name="__codelineno-12-208"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-12-209"><a href="#__codelineno-12-209" id="__codelineno-12-209" name="__codelineno-12-209"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-210"><a href="#__codelineno-12-210" id="__codelineno-12-210" name="__codelineno-12-210"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-211"><a href="#__codelineno-12-211" id="__codelineno-12-211" name="__codelineno-12-211"></a>
</span><span id="__span-12-212"><a href="#__codelineno-12-212" id="__codelineno-12-212" name="__codelineno-12-212"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-213"><a href="#__codelineno-12-213" id="__codelineno-12-213" name="__codelineno-12-213"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-12-214"><a href="#__codelineno-12-214" id="__codelineno-12-214" name="__codelineno-12-214"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-12-215"><a href="#__codelineno-12-215" id="__codelineno-12-215" name="__codelineno-12-215"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Dynamic Resource Server running on stdio"</span><span class="p">);</span>
</span><span id="__span-12-216"><a href="#__codelineno-12-216" id="__codelineno-12-216" name="__codelineno-12-216"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-217"><a href="#__codelineno-12-217" id="__codelineno-12-217" name="__codelineno-12-217"></a><span class="p">}</span>
</span><span id="__span-12-218"><a href="#__codelineno-12-218" id="__codelineno-12-218" name="__codelineno-12-218"></a>
</span><span id="__span-12-219"><a href="#__codelineno-12-219" id="__codelineno-12-219" name="__codelineno-12-219"></a><span class="c1">// Main entry point</span>
</span><span id="__span-12-220"><a href="#__codelineno-12-220" id="__codelineno-12-220" name="__codelineno-12-220"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-221"><a href="#__codelineno-12-221" id="__codelineno-12-221" name="__codelineno-12-221"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DynamicResourceServer</span><span class="p">();</span>
</span><span id="__span-12-222"><a href="#__codelineno-12-222" id="__codelineno-12-222" name="__codelineno-12-222"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-12-223"><a href="#__codelineno-12-223" id="__codelineno-12-223" name="__codelineno-12-223"></a><span class="p">}</span>
</span><span id="__span-12-224"><a href="#__codelineno-12-224" id="__codelineno-12-224" name="__codelineno-12-224"></a>
</span><span id="__span-12-225"><a href="#__codelineno-12-225" id="__codelineno-12-225" name="__codelineno-12-225"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-226"><a href="#__codelineno-12-226" id="__codelineno-12-226" name="__codelineno-12-226"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-12-227"><a href="#__codelineno-12-227" id="__codelineno-12-227" name="__codelineno-12-227"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-12-228"><a href="#__codelineno-12-228" id="__codelineno-12-228" name="__codelineno-12-228"></a><span class="p">});</span>
</span></code></pre></div> <h3 id="testing-dynamic-resources">Testing Dynamic Resources<a class="headerlink" href="#testing-dynamic-resources" title="Permanent link">¶</a></h3> <p><strong>Step 1: Start the Server</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a href="#__codelineno-13-1" id="__codelineno-13-1" name="__codelineno-13-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>Step 2: Test Resource Templates</strong></p> <ul> <li>Check that templates are listed: <code>db://users/{userId}/profile</code>, etc.</li> </ul> <p><strong>Step 3: Test Resource Discovery</strong></p> <ul> <li>Should show individual resources for users, products, and categories</li> </ul> <p><strong>Step 4: Test Resource Reading</strong></p> <ul> <li>Try <code>db://users/1/profile</code> - should return user data</li> <li>Try <code>db://products/2/details</code> - should return product data</li> <li>Try <code>db://stats/Electronics/summary</code> - should return category stats</li> <li>Test invalid URIs to verify error handling</li> </ul> <hr/> <h2 id="resource-subscriptions-for-live-updates">Resource Subscriptions for Live Updates<a class="headerlink" href="#resource-subscriptions-for-live-updates" title="Permanent link">¶</a></h2> <p>Resource subscriptions enable real-time updates when resource content changes. This is essential for live data, monitoring dashboards, and collaborative environments.</p> <h3 id="subscription-implementation">Subscription Implementation<a class="headerlink" href="#subscription-implementation" title="Permanent link">¶</a></h3> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-14-1"><a href="#__codelineno-14-1" id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// Enable subscriptions in server capabilities</span>
</span><span id="__span-14-2"><a href="#__codelineno-14-2" id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="p">{</span>
</span><span id="__span-14-3"><a href="#__codelineno-14-3" id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">  </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a href="#__codelineno-14-4" id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a href="#__codelineno-14-5" id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">      </span><span class="nx">subscribe</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w">  </span><span class="c1">// Enable subscription support</span>
</span><span id="__span-14-6"><a href="#__codelineno-14-6" id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-14-7"><a href="#__codelineno-14-7" id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-14-8"><a href="#__codelineno-14-8" id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="p">}</span>
</span></code></pre></div> <h3 id="complete-subscription-server">Complete Subscription Server<a class="headerlink" href="#complete-subscription-server" title="Permanent link">¶</a></h3> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-15-1"><a href="#__codelineno-15-1" id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-15-2"><a href="#__codelineno-15-2" id="__codelineno-15-2" name="__codelineno-15-2"></a>
</span><span id="__span-15-3"><a href="#__codelineno-15-3" id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-15-4"><a href="#__codelineno-15-4" id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-15-5"><a href="#__codelineno-15-5" id="__codelineno-15-5" name="__codelineno-15-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-6"><a href="#__codelineno-15-6" id="__codelineno-15-6" name="__codelineno-15-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-7"><a href="#__codelineno-15-7" id="__codelineno-15-7" name="__codelineno-15-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-8"><a href="#__codelineno-15-8" id="__codelineno-15-8" name="__codelineno-15-8"></a><span class="w">  </span><span class="nx">SubscribeRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-9"><a href="#__codelineno-15-9" id="__codelineno-15-9" name="__codelineno-15-9"></a><span class="w">  </span><span class="nx">UnsubscribeRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-10"><a href="#__codelineno-15-10" id="__codelineno-15-10" name="__codelineno-15-10"></a><span class="w">  </span><span class="nx">ResourceUpdatedNotificationSchema</span><span class="p">,</span>
</span><span id="__span-15-11"><a href="#__codelineno-15-11" id="__codelineno-15-11" name="__codelineno-15-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-15-12"><a href="#__codelineno-15-12" id="__codelineno-15-12" name="__codelineno-15-12"></a>
</span><span id="__span-15-13"><a href="#__codelineno-15-13" id="__codelineno-15-13" name="__codelineno-15-13"></a><span class="cm">/**</span>
</span><span id="__span-15-14"><a href="#__codelineno-15-14" id="__codelineno-15-14" name="__codelineno-15-14"></a><span class="cm"> * MCP Server with resource subscriptions for live updates</span>
</span><span id="__span-15-15"><a href="#__codelineno-15-15" id="__codelineno-15-15" name="__codelineno-15-15"></a><span class="cm"> */</span>
</span><span id="__span-15-16"><a href="#__codelineno-15-16" id="__codelineno-15-16" name="__codelineno-15-16"></a><span class="kd">class</span><span class="w"> </span><span class="nx">SubscriptionResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-17"><a href="#__codelineno-15-17" id="__codelineno-15-17" name="__codelineno-15-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-15-18"><a href="#__codelineno-15-18" id="__codelineno-15-18" name="__codelineno-15-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">subscribers</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">Set</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span><span class="w"> </span><span class="c1">// uri -&gt; sessionIds</span>
</span><span id="__span-15-19"><a href="#__codelineno-15-19" id="__codelineno-15-19" name="__codelineno-15-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">updateInterval</span><span class="o">:</span><span class="w"> </span><span class="kt">NodeJS.Timeout</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-15-20"><a href="#__codelineno-15-20" id="__codelineno-15-20" name="__codelineno-15-20"></a>
</span><span id="__span-15-21"><a href="#__codelineno-15-21" id="__codelineno-15-21" name="__codelineno-15-21"></a><span class="w">  </span><span class="c1">// Simulated live data</span>
</span><span id="__span-15-22"><a href="#__codelineno-15-22" id="__codelineno-15-22" name="__codelineno-15-22"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-23"><a href="#__codelineno-15-23" id="__codelineno-15-23" name="__codelineno-15-23"></a><span class="w">    </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">42</span><span class="p">,</span>
</span><span id="__span-15-24"><a href="#__codelineno-15-24" id="__codelineno-15-24" name="__codelineno-15-24"></a><span class="w">    </span><span class="nx">serverLoad</span><span class="o">:</span><span class="w"> </span><span class="kt">0.65</span><span class="p">,</span>
</span><span id="__span-15-25"><a href="#__codelineno-15-25" id="__codelineno-15-25" name="__codelineno-15-25"></a><span class="w">    </span><span class="nx">responseTime</span><span class="o">:</span><span class="w"> </span><span class="kt">120</span><span class="p">,</span>
</span><span id="__span-15-26"><a href="#__codelineno-15-26" id="__codelineno-15-26" name="__codelineno-15-26"></a><span class="w">    </span><span class="nx">errorRate</span><span class="o">:</span><span class="w"> </span><span class="kt">0.02</span><span class="p">,</span>
</span><span id="__span-15-27"><a href="#__codelineno-15-27" id="__codelineno-15-27" name="__codelineno-15-27"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-15-28"><a href="#__codelineno-15-28" id="__codelineno-15-28" name="__codelineno-15-28"></a>
</span><span id="__span-15-29"><a href="#__codelineno-15-29" id="__codelineno-15-29" name="__codelineno-15-29"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-30"><a href="#__codelineno-15-30" id="__codelineno-15-30" name="__codelineno-15-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-15-31"><a href="#__codelineno-15-31" id="__codelineno-15-31" name="__codelineno-15-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-32"><a href="#__codelineno-15-32" id="__codelineno-15-32" name="__codelineno-15-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"subscription-resource-server"</span><span class="p">,</span>
</span><span id="__span-15-33"><a href="#__codelineno-15-33" id="__codelineno-15-33" name="__codelineno-15-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-15-34"><a href="#__codelineno-15-34" id="__codelineno-15-34" name="__codelineno-15-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-15-35"><a href="#__codelineno-15-35" id="__codelineno-15-35" name="__codelineno-15-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-36"><a href="#__codelineno-15-36" id="__codelineno-15-36" name="__codelineno-15-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-37"><a href="#__codelineno-15-37" id="__codelineno-15-37" name="__codelineno-15-37"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-38"><a href="#__codelineno-15-38" id="__codelineno-15-38" name="__codelineno-15-38"></a><span class="w">            </span><span class="nx">subscribe</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-15-39"><a href="#__codelineno-15-39" id="__codelineno-15-39" name="__codelineno-15-39"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-40"><a href="#__codelineno-15-40" id="__codelineno-15-40" name="__codelineno-15-40"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-15-41"><a href="#__codelineno-15-41" id="__codelineno-15-41" name="__codelineno-15-41"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-42"><a href="#__codelineno-15-42" id="__codelineno-15-42" name="__codelineno-15-42"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-15-43"><a href="#__codelineno-15-43" id="__codelineno-15-43" name="__codelineno-15-43"></a>
</span><span id="__span-15-44"><a href="#__codelineno-15-44" id="__codelineno-15-44" name="__codelineno-15-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-15-45"><a href="#__codelineno-15-45" id="__codelineno-15-45" name="__codelineno-15-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-15-46"><a href="#__codelineno-15-46" id="__codelineno-15-46" name="__codelineno-15-46"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">startMetricsSimulation</span><span class="p">();</span>
</span><span id="__span-15-47"><a href="#__codelineno-15-47" id="__codelineno-15-47" name="__codelineno-15-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-48"><a href="#__codelineno-15-48" id="__codelineno-15-48" name="__codelineno-15-48"></a>
</span><span id="__span-15-49"><a href="#__codelineno-15-49" id="__codelineno-15-49" name="__codelineno-15-49"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-50"><a href="#__codelineno-15-50" id="__codelineno-15-50" name="__codelineno-15-50"></a><span class="w">    </span><span class="c1">// List resources</span>
</span><span id="__span-15-51"><a href="#__codelineno-15-51" id="__codelineno-15-51" name="__codelineno-15-51"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-52"><a href="#__codelineno-15-52" id="__codelineno-15-52" name="__codelineno-15-52"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-53"><a href="#__codelineno-15-53" id="__codelineno-15-53" name="__codelineno-15-53"></a><span class="w">        </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-54"><a href="#__codelineno-15-54" id="__codelineno-15-54" name="__codelineno-15-54"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-55"><a href="#__codelineno-15-55" id="__codelineno-15-55" name="__codelineno-15-55"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"metrics://server/active-users"</span><span class="p">,</span>
</span><span id="__span-15-56"><a href="#__codelineno-15-56" id="__codelineno-15-56" name="__codelineno-15-56"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Active Users"</span><span class="p">,</span>
</span><span id="__span-15-57"><a href="#__codelineno-15-57" id="__codelineno-15-57" name="__codelineno-15-57"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Current number of active users"</span><span class="p">,</span>
</span><span id="__span-15-58"><a href="#__codelineno-15-58" id="__codelineno-15-58" name="__codelineno-15-58"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-15-59"><a href="#__codelineno-15-59" id="__codelineno-15-59" name="__codelineno-15-59"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-60"><a href="#__codelineno-15-60" id="__codelineno-15-60" name="__codelineno-15-60"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-61"><a href="#__codelineno-15-61" id="__codelineno-15-61" name="__codelineno-15-61"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"metrics://server/load"</span><span class="p">,</span>
</span><span id="__span-15-62"><a href="#__codelineno-15-62" id="__codelineno-15-62" name="__codelineno-15-62"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Server Load"</span><span class="p">,</span>
</span><span id="__span-15-63"><a href="#__codelineno-15-63" id="__codelineno-15-63" name="__codelineno-15-63"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Current server load percentage"</span><span class="p">,</span>
</span><span id="__span-15-64"><a href="#__codelineno-15-64" id="__codelineno-15-64" name="__codelineno-15-64"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-15-65"><a href="#__codelineno-15-65" id="__codelineno-15-65" name="__codelineno-15-65"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-66"><a href="#__codelineno-15-66" id="__codelineno-15-66" name="__codelineno-15-66"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-67"><a href="#__codelineno-15-67" id="__codelineno-15-67" name="__codelineno-15-67"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"metrics://server/response-time"</span><span class="p">,</span>
</span><span id="__span-15-68"><a href="#__codelineno-15-68" id="__codelineno-15-68" name="__codelineno-15-68"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Response Time"</span><span class="p">,</span>
</span><span id="__span-15-69"><a href="#__codelineno-15-69" id="__codelineno-15-69" name="__codelineno-15-69"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Average response time in milliseconds"</span><span class="p">,</span>
</span><span id="__span-15-70"><a href="#__codelineno-15-70" id="__codelineno-15-70" name="__codelineno-15-70"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-15-71"><a href="#__codelineno-15-71" id="__codelineno-15-71" name="__codelineno-15-71"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-72"><a href="#__codelineno-15-72" id="__codelineno-15-72" name="__codelineno-15-72"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-73"><a href="#__codelineno-15-73" id="__codelineno-15-73" name="__codelineno-15-73"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"metrics://server/error-rate"</span><span class="p">,</span>
</span><span id="__span-15-74"><a href="#__codelineno-15-74" id="__codelineno-15-74" name="__codelineno-15-74"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Error Rate"</span><span class="p">,</span>
</span><span id="__span-15-75"><a href="#__codelineno-15-75" id="__codelineno-15-75" name="__codelineno-15-75"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Current error rate percentage"</span><span class="p">,</span>
</span><span id="__span-15-76"><a href="#__codelineno-15-76" id="__codelineno-15-76" name="__codelineno-15-76"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-15-77"><a href="#__codelineno-15-77" id="__codelineno-15-77" name="__codelineno-15-77"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-78"><a href="#__codelineno-15-78" id="__codelineno-15-78" name="__codelineno-15-78"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-15-79"><a href="#__codelineno-15-79" id="__codelineno-15-79" name="__codelineno-15-79"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-15-80"><a href="#__codelineno-15-80" id="__codelineno-15-80" name="__codelineno-15-80"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-81"><a href="#__codelineno-15-81" id="__codelineno-15-81" name="__codelineno-15-81"></a>
</span><span id="__span-15-82"><a href="#__codelineno-15-82" id="__codelineno-15-82" name="__codelineno-15-82"></a><span class="w">    </span><span class="c1">// Read resource</span>
</span><span id="__span-15-83"><a href="#__codelineno-15-83" id="__codelineno-15-83" name="__codelineno-15-83"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-84"><a href="#__codelineno-15-84" id="__codelineno-15-84" name="__codelineno-15-84"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-85"><a href="#__codelineno-15-85" id="__codelineno-15-85" name="__codelineno-15-85"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMetricContent</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-15-86"><a href="#__codelineno-15-86" id="__codelineno-15-86" name="__codelineno-15-86"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-15-87"><a href="#__codelineno-15-87" id="__codelineno-15-87" name="__codelineno-15-87"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-88"><a href="#__codelineno-15-88" id="__codelineno-15-88" name="__codelineno-15-88"></a>
</span><span id="__span-15-89"><a href="#__codelineno-15-89" id="__codelineno-15-89" name="__codelineno-15-89"></a><span class="w">    </span><span class="c1">// Subscribe to resource updates</span>
</span><span id="__span-15-90"><a href="#__codelineno-15-90" id="__codelineno-15-90" name="__codelineno-15-90"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">SubscribeRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-91"><a href="#__codelineno-15-91" id="__codelineno-15-91" name="__codelineno-15-91"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-92"><a href="#__codelineno-15-92" id="__codelineno-15-92" name="__codelineno-15-92"></a>
</span><span id="__span-15-93"><a href="#__codelineno-15-93" id="__codelineno-15-93" name="__codelineno-15-93"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-94"><a href="#__codelineno-15-94" id="__codelineno-15-94" name="__codelineno-15-94"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">());</span>
</span><span id="__span-15-95"><a href="#__codelineno-15-95" id="__codelineno-15-95" name="__codelineno-15-95"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-96"><a href="#__codelineno-15-96" id="__codelineno-15-96" name="__codelineno-15-96"></a>
</span><span id="__span-15-97"><a href="#__codelineno-15-97" id="__codelineno-15-97" name="__codelineno-15-97"></a><span class="w">      </span><span class="c1">// In a real implementation, you'd get the session ID from the request</span>
</span><span id="__span-15-98"><a href="#__codelineno-15-98" id="__codelineno-15-98" name="__codelineno-15-98"></a><span class="w">      </span><span class="c1">// For this example, we'll use a mock session ID</span>
</span><span id="__span-15-99"><a href="#__codelineno-15-99" id="__codelineno-15-99" name="__codelineno-15-99"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mock-session"</span><span class="p">;</span>
</span><span id="__span-15-100"><a href="#__codelineno-15-100" id="__codelineno-15-100" name="__codelineno-15-100"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
</span><span id="__span-15-101"><a href="#__codelineno-15-101" id="__codelineno-15-101" name="__codelineno-15-101"></a>
</span><span id="__span-15-102"><a href="#__codelineno-15-102" id="__codelineno-15-102" name="__codelineno-15-102"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Subscribed to </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> (session: </span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-15-103"><a href="#__codelineno-15-103" id="__codelineno-15-103" name="__codelineno-15-103"></a>
</span><span id="__span-15-104"><a href="#__codelineno-15-104" id="__codelineno-15-104" name="__codelineno-15-104"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-15-105"><a href="#__codelineno-15-105" id="__codelineno-15-105" name="__codelineno-15-105"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-106"><a href="#__codelineno-15-106" id="__codelineno-15-106" name="__codelineno-15-106"></a>
</span><span id="__span-15-107"><a href="#__codelineno-15-107" id="__codelineno-15-107" name="__codelineno-15-107"></a><span class="w">    </span><span class="c1">// Unsubscribe from resource updates</span>
</span><span id="__span-15-108"><a href="#__codelineno-15-108" id="__codelineno-15-108" name="__codelineno-15-108"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">UnsubscribeRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-109"><a href="#__codelineno-15-109" id="__codelineno-15-109" name="__codelineno-15-109"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-110"><a href="#__codelineno-15-110" id="__codelineno-15-110" name="__codelineno-15-110"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mock-session"</span><span class="p">;</span><span class="w"> </span><span class="c1">// Would come from request in real implementation</span>
</span><span id="__span-15-111"><a href="#__codelineno-15-111" id="__codelineno-15-111" name="__codelineno-15-111"></a>
</span><span id="__span-15-112"><a href="#__codelineno-15-112" id="__codelineno-15-112" name="__codelineno-15-112"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-113"><a href="#__codelineno-15-113" id="__codelineno-15-113" name="__codelineno-15-113"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
</span><span id="__span-15-114"><a href="#__codelineno-15-114" id="__codelineno-15-114" name="__codelineno-15-114"></a>
</span><span id="__span-15-115"><a href="#__codelineno-15-115" id="__codelineno-15-115" name="__codelineno-15-115"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-116"><a href="#__codelineno-15-116" id="__codelineno-15-116" name="__codelineno-15-116"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-15-117"><a href="#__codelineno-15-117" id="__codelineno-15-117" name="__codelineno-15-117"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-118"><a href="#__codelineno-15-118" id="__codelineno-15-118" name="__codelineno-15-118"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-119"><a href="#__codelineno-15-119" id="__codelineno-15-119" name="__codelineno-15-119"></a>
</span><span id="__span-15-120"><a href="#__codelineno-15-120" id="__codelineno-15-120" name="__codelineno-15-120"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Unsubscribed from </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> (session: </span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-15-121"><a href="#__codelineno-15-121" id="__codelineno-15-121" name="__codelineno-15-121"></a>
</span><span id="__span-15-122"><a href="#__codelineno-15-122" id="__codelineno-15-122" name="__codelineno-15-122"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-15-123"><a href="#__codelineno-15-123" id="__codelineno-15-123" name="__codelineno-15-123"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-124"><a href="#__codelineno-15-124" id="__codelineno-15-124" name="__codelineno-15-124"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-125"><a href="#__codelineno-15-125" id="__codelineno-15-125" name="__codelineno-15-125"></a>
</span><span id="__span-15-126"><a href="#__codelineno-15-126" id="__codelineno-15-126" name="__codelineno-15-126"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMetricContent</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-127"><a href="#__codelineno-15-127" id="__codelineno-15-127" name="__codelineno-15-127"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">metricName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">).</span><span class="nx">pop</span><span class="p">();</span>
</span><span id="__span-15-128"><a href="#__codelineno-15-128" id="__codelineno-15-128" name="__codelineno-15-128"></a>
</span><span id="__span-15-129"><a href="#__codelineno-15-129" id="__codelineno-15-129" name="__codelineno-15-129"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">metricName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">metricName</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-130"><a href="#__codelineno-15-130" id="__codelineno-15-130" name="__codelineno-15-130"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown metric: </span><span class="si">${</span><span class="nx">metricName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-15-131"><a href="#__codelineno-15-131" id="__codelineno-15-131" name="__codelineno-15-131"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-132"><a href="#__codelineno-15-132" id="__codelineno-15-132" name="__codelineno-15-132"></a>
</span><span id="__span-15-133"><a href="#__codelineno-15-133" id="__codelineno-15-133" name="__codelineno-15-133"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">)[</span><span class="nx">metricName</span><span class="p">];</span>
</span><span id="__span-15-134"><a href="#__codelineno-15-134" id="__codelineno-15-134" name="__codelineno-15-134"></a>
</span><span id="__span-15-135"><a href="#__codelineno-15-135" id="__codelineno-15-135" name="__codelineno-15-135"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-136"><a href="#__codelineno-15-136" id="__codelineno-15-136" name="__codelineno-15-136"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-15-137"><a href="#__codelineno-15-137" id="__codelineno-15-137" name="__codelineno-15-137"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-15-138"><a href="#__codelineno-15-138" id="__codelineno-15-138" name="__codelineno-15-138"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-15-139"><a href="#__codelineno-15-139" id="__codelineno-15-139" name="__codelineno-15-139"></a><span class="w">        </span><span class="nx">metric</span><span class="o">:</span><span class="w"> </span><span class="kt">metricName</span><span class="p">,</span>
</span><span id="__span-15-140"><a href="#__codelineno-15-140" id="__codelineno-15-140" name="__codelineno-15-140"></a><span class="w">        </span><span class="nx">value</span><span class="p">,</span>
</span><span id="__span-15-141"><a href="#__codelineno-15-141" id="__codelineno-15-141" name="__codelineno-15-141"></a><span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-15-142"><a href="#__codelineno-15-142" id="__codelineno-15-142" name="__codelineno-15-142"></a><span class="w">        </span><span class="nx">unit</span><span class="o">:</span><span class="w"> </span><span class="kt">this.getMetricUnit</span><span class="p">(</span><span class="nx">metricName</span><span class="p">),</span>
</span><span id="__span-15-143"><a href="#__codelineno-15-143" id="__codelineno-15-143" name="__codelineno-15-143"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-15-144"><a href="#__codelineno-15-144" id="__codelineno-15-144" name="__codelineno-15-144"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-145"><a href="#__codelineno-15-145" id="__codelineno-15-145" name="__codelineno-15-145"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-146"><a href="#__codelineno-15-146" id="__codelineno-15-146" name="__codelineno-15-146"></a>
</span><span id="__span-15-147"><a href="#__codelineno-15-147" id="__codelineno-15-147" name="__codelineno-15-147"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMetricUnit</span><span class="p">(</span><span class="nx">metricName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-148"><a href="#__codelineno-15-148" id="__codelineno-15-148" name="__codelineno-15-148"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-149"><a href="#__codelineno-15-149" id="__codelineno-15-149" name="__codelineno-15-149"></a><span class="w">      </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="s2">"users"</span><span class="p">,</span>
</span><span id="__span-15-150"><a href="#__codelineno-15-150" id="__codelineno-15-150" name="__codelineno-15-150"></a><span class="w">      </span><span class="nx">serverLoad</span><span class="o">:</span><span class="w"> </span><span class="s2">"percentage"</span><span class="p">,</span>
</span><span id="__span-15-151"><a href="#__codelineno-15-151" id="__codelineno-15-151" name="__codelineno-15-151"></a><span class="w">      </span><span class="nx">responseTime</span><span class="o">:</span><span class="w"> </span><span class="s2">"milliseconds"</span><span class="p">,</span>
</span><span id="__span-15-152"><a href="#__codelineno-15-152" id="__codelineno-15-152" name="__codelineno-15-152"></a><span class="w">      </span><span class="nx">errorRate</span><span class="o">:</span><span class="w"> </span><span class="s2">"percentage"</span><span class="p">,</span>
</span><span id="__span-15-153"><a href="#__codelineno-15-153" id="__codelineno-15-153" name="__codelineno-15-153"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-154"><a href="#__codelineno-15-154" id="__codelineno-15-154" name="__codelineno-15-154"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">units</span><span class="p">[</span><span class="nx">metricName</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">"unit"</span><span class="p">;</span>
</span><span id="__span-15-155"><a href="#__codelineno-15-155" id="__codelineno-15-155" name="__codelineno-15-155"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-156"><a href="#__codelineno-15-156" id="__codelineno-15-156" name="__codelineno-15-156"></a>
</span><span id="__span-15-157"><a href="#__codelineno-15-157" id="__codelineno-15-157" name="__codelineno-15-157"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">startMetricsSimulation</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-158"><a href="#__codelineno-15-158" id="__codelineno-15-158" name="__codelineno-15-158"></a><span class="w">    </span><span class="c1">// Simulate changing metrics every 5 seconds</span>
</span><span id="__span-15-159"><a href="#__codelineno-15-159" id="__codelineno-15-159" name="__codelineno-15-159"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-160"><a href="#__codelineno-15-160" id="__codelineno-15-160" name="__codelineno-15-160"></a><span class="w">      </span><span class="c1">// Randomly update metrics</span>
</span><span id="__span-15-161"><a href="#__codelineno-15-161" id="__codelineno-15-161" name="__codelineno-15-161"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
</span><span id="__span-15-162"><a href="#__codelineno-15-162" id="__codelineno-15-162" name="__codelineno-15-162"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="p">);</span>
</span><span id="__span-15-163"><a href="#__codelineno-15-163" id="__codelineno-15-163" name="__codelineno-15-163"></a>
</span><span id="__span-15-164"><a href="#__codelineno-15-164" id="__codelineno-15-164" name="__codelineno-15-164"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">serverLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0.3 to 0.8</span>
</span><span id="__span-15-165"><a href="#__codelineno-15-165" id="__codelineno-15-165" name="__codelineno-15-165"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">responseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 100-200ms</span>
</span><span id="__span-15-166"><a href="#__codelineno-15-166" id="__codelineno-15-166" name="__codelineno-15-166"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">errorRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0-5%</span>
</span><span id="__span-15-167"><a href="#__codelineno-15-167" id="__codelineno-15-167" name="__codelineno-15-167"></a>
</span><span id="__span-15-168"><a href="#__codelineno-15-168" id="__codelineno-15-168" name="__codelineno-15-168"></a><span class="w">      </span><span class="c1">// Notify subscribers of updates</span>
</span><span id="__span-15-169"><a href="#__codelineno-15-169" id="__codelineno-15-169" name="__codelineno-15-169"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">notifySubscribers</span><span class="p">();</span>
</span><span id="__span-15-170"><a href="#__codelineno-15-170" id="__codelineno-15-170" name="__codelineno-15-170"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</span><span id="__span-15-171"><a href="#__codelineno-15-171" id="__codelineno-15-171" name="__codelineno-15-171"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-172"><a href="#__codelineno-15-172" id="__codelineno-15-172" name="__codelineno-15-172"></a>
</span><span id="__span-15-173"><a href="#__codelineno-15-173" id="__codelineno-15-173" name="__codelineno-15-173"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">notifySubscribers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-174"><a href="#__codelineno-15-174" id="__codelineno-15-174" name="__codelineno-15-174"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">sessionIds</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-175"><a href="#__codelineno-15-175" id="__codelineno-15-175" name="__codelineno-15-175"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sessionIds</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-176"><a href="#__codelineno-15-176" id="__codelineno-15-176" name="__codelineno-15-176"></a><span class="w">        </span><span class="c1">// Send notification to all subscribers of this resource</span>
</span><span id="__span-15-177"><a href="#__codelineno-15-177" id="__codelineno-15-177" name="__codelineno-15-177"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">notification</span><span class="p">(</span><span class="nx">ResourceUpdatedNotificationSchema</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-178"><a href="#__codelineno-15-178" id="__codelineno-15-178" name="__codelineno-15-178"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-15-179"><a href="#__codelineno-15-179" id="__codelineno-15-179" name="__codelineno-15-179"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-15-180"><a href="#__codelineno-15-180" id="__codelineno-15-180" name="__codelineno-15-180"></a>
</span><span id="__span-15-181"><a href="#__codelineno-15-181" id="__codelineno-15-181" name="__codelineno-15-181"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Notified </span><span class="si">${</span><span class="nx">sessionIds</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> subscribers of </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> update`</span><span class="p">);</span>
</span><span id="__span-15-182"><a href="#__codelineno-15-182" id="__codelineno-15-182" name="__codelineno-15-182"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-183"><a href="#__codelineno-15-183" id="__codelineno-15-183" name="__codelineno-15-183"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-184"><a href="#__codelineno-15-184" id="__codelineno-15-184" name="__codelineno-15-184"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-185"><a href="#__codelineno-15-185" id="__codelineno-15-185" name="__codelineno-15-185"></a>
</span><span id="__span-15-186"><a href="#__codelineno-15-186" id="__codelineno-15-186" name="__codelineno-15-186"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-187"><a href="#__codelineno-15-187" id="__codelineno-15-187" name="__codelineno-15-187"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-188"><a href="#__codelineno-15-188" id="__codelineno-15-188" name="__codelineno-15-188"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-189"><a href="#__codelineno-15-189" id="__codelineno-15-189" name="__codelineno-15-189"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-190"><a href="#__codelineno-15-190" id="__codelineno-15-190" name="__codelineno-15-190"></a>
</span><span id="__span-15-191"><a href="#__codelineno-15-191" id="__codelineno-15-191" name="__codelineno-15-191"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-192"><a href="#__codelineno-15-192" id="__codelineno-15-192" name="__codelineno-15-192"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-193"><a href="#__codelineno-15-193" id="__codelineno-15-193" name="__codelineno-15-193"></a><span class="w">        </span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="p">);</span>
</span><span id="__span-15-194"><a href="#__codelineno-15-194" id="__codelineno-15-194" name="__codelineno-15-194"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-195"><a href="#__codelineno-15-195" id="__codelineno-15-195" name="__codelineno-15-195"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-15-196"><a href="#__codelineno-15-196" id="__codelineno-15-196" name="__codelineno-15-196"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-15-197"><a href="#__codelineno-15-197" id="__codelineno-15-197" name="__codelineno-15-197"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-198"><a href="#__codelineno-15-198" id="__codelineno-15-198" name="__codelineno-15-198"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-199"><a href="#__codelineno-15-199" id="__codelineno-15-199" name="__codelineno-15-199"></a>
</span><span id="__span-15-200"><a href="#__codelineno-15-200" id="__codelineno-15-200" name="__codelineno-15-200"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-201"><a href="#__codelineno-15-201" id="__codelineno-15-201" name="__codelineno-15-201"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-15-202"><a href="#__codelineno-15-202" id="__codelineno-15-202" name="__codelineno-15-202"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-15-203"><a href="#__codelineno-15-203" id="__codelineno-15-203" name="__codelineno-15-203"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Subscription Resource Server running on stdio"</span><span class="p">);</span>
</span><span id="__span-15-204"><a href="#__codelineno-15-204" id="__codelineno-15-204" name="__codelineno-15-204"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-205"><a href="#__codelineno-15-205" id="__codelineno-15-205" name="__codelineno-15-205"></a><span class="p">}</span>
</span><span id="__span-15-206"><a href="#__codelineno-15-206" id="__codelineno-15-206" name="__codelineno-15-206"></a>
</span><span id="__span-15-207"><a href="#__codelineno-15-207" id="__codelineno-15-207" name="__codelineno-15-207"></a><span class="c1">// Main entry point</span>
</span><span id="__span-15-208"><a href="#__codelineno-15-208" id="__codelineno-15-208" name="__codelineno-15-208"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-209"><a href="#__codelineno-15-209" id="__codelineno-15-209" name="__codelineno-15-209"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SubscriptionResourceServer</span><span class="p">();</span>
</span><span id="__span-15-210"><a href="#__codelineno-15-210" id="__codelineno-15-210" name="__codelineno-15-210"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-15-211"><a href="#__codelineno-15-211" id="__codelineno-15-211" name="__codelineno-15-211"></a><span class="p">}</span>
</span><span id="__span-15-212"><a href="#__codelineno-15-212" id="__codelineno-15-212" name="__codelineno-15-212"></a>
</span><span id="__span-15-213"><a href="#__codelineno-15-213" id="__codelineno-15-213" name="__codelineno-15-213"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-214"><a href="#__codelineno-15-214" id="__codelineno-15-214" name="__codelineno-15-214"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-215"><a href="#__codelineno-15-215" id="__codelineno-15-215" name="__codelineno-15-215"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-15-216"><a href="#__codelineno-15-216" id="__codelineno-15-216" name="__codelineno-15-216"></a><span class="p">});</span>
</span></code></pre></div> <h3 id="testing-subscriptions">Testing Subscriptions<a class="headerlink" href="#testing-subscriptions" title="Permanent link">¶</a></h3> <p><strong>Step 1: Start the Server</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a href="#__codelineno-16-1" id="__codelineno-16-1" name="__codelineno-16-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> <p><strong>Step 2: Test Basic Resource Reading</strong></p> <ul> <li>Read metrics like <code>metrics://server/active-users</code></li> <li>Verify they return current values</li> </ul> <p><strong>Step 3: Test Subscriptions</strong></p> <ul> <li> <p>Subscribe to a metric resource:</p> <ul> <li>In the MCP Inspector Resources tab, find a metric resource (e.g., <code>metrics://server/active-users</code>)</li> <li>Click the “Subscribe” button next to the resource</li> <li>You should see a confirmation that subscription was successful</li> </ul> </li> <li> <p>Watch the MCP Inspector for update notifications every 5 seconds:</p> <ul> <li>Keep the Resources tab open</li> <li>Look for notification messages in the inspector interface</li> <li>The metric values should update automatically every 5 seconds</li> <li>You can also check the console/logs for subscription update messages</li> </ul> </li> <li> <p>Unsubscribe and verify notifications stop:</p> <ul> <li>Click the “Unsubscribe” button for the same resource</li> <li>Confirm that update notifications cease</li> <li>The metric values should stop updating in the interface</li> </ul> </li> </ul> <hr/> <h2 id="security-and-access-control">Security and Access Control<a class="headerlink" href="#security-and-access-control" title="Permanent link">¶</a></h2> <p>Resource security is critical, especially when exposing sensitive data or system information.</p> <h3 id="access-control-patterns">Access Control Patterns<a class="headerlink" href="#access-control-patterns" title="Permanent link">¶</a></h3> <h4 id="1-path-based-authorization">1. Path-Based Authorization<a class="headerlink" href="#1-path-based-authorization" title="Permanent link">¶</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-17-1"><a href="#__codelineno-17-1" id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">checkResourceAccess</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">userId?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a href="#__codelineno-17-2" id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="w">  </span><span class="c1">// Allow access to own profile</span>
</span><span id="__span-17-3"><a href="#__codelineno-17-3" id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="sb">`users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/`</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><a href="#__codelineno-17-4" id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-17-5"><a href="#__codelineno-17-5" id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-6"><a href="#__codelineno-17-6" id="__codelineno-17-6" name="__codelineno-17-6"></a>
</span><span id="__span-17-7"><a href="#__codelineno-17-7" id="__codelineno-17-7" name="__codelineno-17-7"></a><span class="w">  </span><span class="c1">// Restrict admin resources</span>
</span><span id="__span-17-8"><a href="#__codelineno-17-8" id="__codelineno-17-8" name="__codelineno-17-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'admin/'</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">(</span><span class="nx">userId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a href="#__codelineno-17-9" id="__codelineno-17-9" name="__codelineno-17-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-17-10"><a href="#__codelineno-17-10" id="__codelineno-17-10" name="__codelineno-17-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-11"><a href="#__codelineno-17-11" id="__codelineno-17-11" name="__codelineno-17-11"></a>
</span><span id="__span-17-12"><a href="#__codelineno-17-12" id="__codelineno-17-12" name="__codelineno-17-12"></a><span class="w">  </span><span class="c1">// Public resources</span>
</span><span id="__span-17-13"><a href="#__codelineno-17-13" id="__codelineno-17-13" name="__codelineno-17-13"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'public/'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-14"><a href="#__codelineno-17-14" id="__codelineno-17-14" name="__codelineno-17-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-17-15"><a href="#__codelineno-17-15" id="__codelineno-17-15" name="__codelineno-17-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-16"><a href="#__codelineno-17-16" id="__codelineno-17-16" name="__codelineno-17-16"></a>
</span><span id="__span-17-17"><a href="#__codelineno-17-17" id="__codelineno-17-17" name="__codelineno-17-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-17-18"><a href="#__codelineno-17-18" id="__codelineno-17-18" name="__codelineno-17-18"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>How it works:</strong> This method checks if a user has permission to access a resource based on the URI path. It grants access to user-specific resources (like their own profile), restricts admin-only resources unless the user has admin privileges, allows public resources for everyone, and denies access by default for any other paths.</p> <p><br/></p> <h4 id="2-content-filtering">2. Content Filtering<a class="headerlink" href="#2-content-filtering" title="Permanent link">¶</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-18-1"><a href="#__codelineno-18-1" id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">filterSensitiveContent</span><span class="p">(</span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">,</span><span class="w"> </span><span class="nx">userRole</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a href="#__codelineno-18-2" id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userRole</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">'admin'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a href="#__codelineno-18-3" id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="w">    </span><span class="c1">// Remove sensitive fields for non-admin users</span>
</span><span id="__span-18-4"><a href="#__codelineno-18-4" id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">ssn</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">filtered</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-18-5"><a href="#__codelineno-18-5" id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filtered</span><span class="p">;</span>
</span><span id="__span-18-6"><a href="#__codelineno-18-6" id="__codelineno-18-6" name="__codelineno-18-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-7"><a href="#__codelineno-18-7" id="__codelineno-18-7" name="__codelineno-18-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-18-8"><a href="#__codelineno-18-8" id="__codelineno-18-8" name="__codelineno-18-8"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>How it works:</strong> This function removes sensitive information from resource content based on user roles. For non-admin users, it uses object destructuring to exclude sensitive fields like passwords and social security numbers, returning a filtered version of the data. Admin users see the complete, unfiltered content.</p> <p><br/></p> <h4 id="3-rate-limiting">3. Rate Limiting<a class="headerlink" href="#3-rate-limiting" title="Permanent link">¶</a></h4> <div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a href="#__codelineno-19-1" id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">rateLimiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-19-2"><a href="#__codelineno-19-2" id="__codelineno-19-2" name="__codelineno-19-2"></a>
</span><span id="__span-19-3"><a href="#__codelineno-19-3" id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="k">private</span><span class="w"> </span><span class="nx">checkRateLimit</span><span class="p">(</span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRequests</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><a href="#__codelineno-19-4" id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-19-5"><a href="#__codelineno-19-5" id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 minute</span>
</span><span id="__span-19-6"><a href="#__codelineno-19-6" id="__codelineno-19-6" name="__codelineno-19-6"></a>
</span><span id="__span-19-7"><a href="#__codelineno-19-7" id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimiter</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">identifier</span><span class="p">);</span>
</span><span id="__span-19-8"><a href="#__codelineno-19-8" id="__codelineno-19-8" name="__codelineno-19-8"></a>
</span><span id="__span-19-9"><a href="#__codelineno-19-9" id="__codelineno-19-9" name="__codelineno-19-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">resetTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-10"><a href="#__codelineno-19-10" id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimiter</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">identifier</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">now</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-19-11"><a href="#__codelineno-19-11" id="__codelineno-19-11" name="__codelineno-19-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-19-12"><a href="#__codelineno-19-12" id="__codelineno-19-12" name="__codelineno-19-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-13"><a href="#__codelineno-19-13" id="__codelineno-19-13" name="__codelineno-19-13"></a>
</span><span id="__span-19-14"><a href="#__codelineno-19-14" id="__codelineno-19-14" name="__codelineno-19-14"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">maxRequests</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-15"><a href="#__codelineno-19-15" id="__codelineno-19-15" name="__codelineno-19-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-19-16"><a href="#__codelineno-19-16" id="__codelineno-19-16" name="__codelineno-19-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-17"><a href="#__codelineno-19-17" id="__codelineno-19-17" name="__codelineno-19-17"></a>
</span><span id="__span-19-18"><a href="#__codelineno-19-18" id="__codelineno-19-18" name="__codelineno-19-18"></a><span class="w">  </span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-19-19"><a href="#__codelineno-19-19" id="__codelineno-19-19" name="__codelineno-19-19"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-19-20"><a href="#__codelineno-19-20" id="__codelineno-19-20" name="__codelineno-19-20"></a><span class="p">}</span>
</span></code></pre></div> <p><strong>How it works:</strong> This implements a sliding window rate limiter using a Map to track request counts per identifier (like user ID or IP address). It allows up to <code>maxRequests</code> (default 100) within a 1-minute window. When the limit is exceeded, it returns false to block the request. The window resets automatically after the time period expires.</p> <hr/> <h2 id="combining-resources-with-tools">Combining Resources with Tools<a class="headerlink" href="#combining-resources-with-tools" title="Permanent link">¶</a></h2> <p><strong>The most powerful MCP servers combine resources and tools to provide a comprehensive functionality!</strong></p> <h3 id="complete-hybrid-server">Complete Hybrid Server<a class="headerlink" href="#complete-hybrid-server" title="Permanent link">¶</a></h3> <p>The following example demonstrates a server that combines both resources and tools, showing how they work together to provide comprehensive functionality. </p> <p>The server maintains a document store that can be both read as resources and modified through tools.</p> <div class="language-typescript highlight"><span class="filename">Hybrid Server Class</span><pre><span></span><code><span id="__span-20-1"><a href="#__codelineno-20-1" id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-20-2"><a href="#__codelineno-20-2" id="__codelineno-20-2" name="__codelineno-20-2"></a>
</span><span id="__span-20-3"><a href="#__codelineno-20-3" id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-20-4"><a href="#__codelineno-20-4" id="__codelineno-20-4" name="__codelineno-20-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-20-5"><a href="#__codelineno-20-5" id="__codelineno-20-5" name="__codelineno-20-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a href="#__codelineno-20-6" id="__codelineno-20-6" name="__codelineno-20-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-7"><a href="#__codelineno-20-7" id="__codelineno-20-7" name="__codelineno-20-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-8"><a href="#__codelineno-20-8" id="__codelineno-20-8" name="__codelineno-20-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-9"><a href="#__codelineno-20-9" id="__codelineno-20-9" name="__codelineno-20-9"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-10"><a href="#__codelineno-20-10" id="__codelineno-20-10" name="__codelineno-20-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-20-11"><a href="#__codelineno-20-11" id="__codelineno-20-11" name="__codelineno-20-11"></a>
</span><span id="__span-20-12"><a href="#__codelineno-20-12" id="__codelineno-20-12" name="__codelineno-20-12"></a><span class="cm">/**</span>
</span><span id="__span-20-13"><a href="#__codelineno-20-13" id="__codelineno-20-13" name="__codelineno-20-13"></a><span class="cm"> * MCP Server combining resources and tools</span>
</span><span id="__span-20-14"><a href="#__codelineno-20-14" id="__codelineno-20-14" name="__codelineno-20-14"></a><span class="cm"> */</span>
</span><span id="__span-20-15"><a href="#__codelineno-20-15" id="__codelineno-20-15" name="__codelineno-20-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">HybridServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-16"><a href="#__codelineno-20-16" id="__codelineno-20-16" name="__codelineno-20-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-20-17"><a href="#__codelineno-20-17" id="__codelineno-20-17" name="__codelineno-20-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">documents</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-20-18"><a href="#__codelineno-20-18" id="__codelineno-20-18" name="__codelineno-20-18"></a>
</span><span id="__span-20-19"><a href="#__codelineno-20-19" id="__codelineno-20-19" name="__codelineno-20-19"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-20"><a href="#__codelineno-20-20" id="__codelineno-20-20" name="__codelineno-20-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-20-21"><a href="#__codelineno-20-21" id="__codelineno-20-21" name="__codelineno-20-21"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-22"><a href="#__codelineno-20-22" id="__codelineno-20-22" name="__codelineno-20-22"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"hybrid-server"</span><span class="p">,</span>
</span><span id="__span-20-23"><a href="#__codelineno-20-23" id="__codelineno-20-23" name="__codelineno-20-23"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-20-24"><a href="#__codelineno-20-24" id="__codelineno-20-24" name="__codelineno-20-24"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-20-25"><a href="#__codelineno-20-25" id="__codelineno-20-25" name="__codelineno-20-25"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-26"><a href="#__codelineno-20-26" id="__codelineno-20-26" name="__codelineno-20-26"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-27"><a href="#__codelineno-20-27" id="__codelineno-20-27" name="__codelineno-20-27"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w">  </span><span class="c1">// Enable resource capabilities</span>
</span><span id="__span-20-28"><a href="#__codelineno-20-28" id="__codelineno-20-28" name="__codelineno-20-28"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w">      </span><span class="c1">// Enable tool capabilities</span>
</span><span id="__span-20-29"><a href="#__codelineno-20-29" id="__codelineno-20-29" name="__codelineno-20-29"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-30"><a href="#__codelineno-20-30" id="__codelineno-20-30" name="__codelineno-20-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-31"><a href="#__codelineno-20-31" id="__codelineno-20-31" name="__codelineno-20-31"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-20-32"><a href="#__codelineno-20-32" id="__codelineno-20-32" name="__codelineno-20-32"></a>
</span><span id="__span-20-33"><a href="#__codelineno-20-33" id="__codelineno-20-33" name="__codelineno-20-33"></a><span class="w">    </span><span class="c1">// Initialize some sample documents</span>
</span><span id="__span-20-34"><a href="#__codelineno-20-34" id="__codelineno-20-34" name="__codelineno-20-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">"doc1"</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-35"><a href="#__codelineno-20-35" id="__codelineno-20-35" name="__codelineno-20-35"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">"doc1"</span><span class="p">,</span>
</span><span id="__span-20-36"><a href="#__codelineno-20-36" id="__codelineno-20-36" name="__codelineno-20-36"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">"Getting Started Guide"</span><span class="p">,</span>
</span><span id="__span-20-37"><a href="#__codelineno-20-37" id="__codelineno-20-37" name="__codelineno-20-37"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s2">"This is a comprehensive guide to getting started..."</span><span class="p">,</span>
</span><span id="__span-20-38"><a href="#__codelineno-20-38" id="__codelineno-20-38" name="__codelineno-20-38"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"tutorial"</span><span class="p">,</span><span class="w"> </span><span class="s2">"beginner"</span><span class="p">],</span>
</span><span id="__span-20-39"><a href="#__codelineno-20-39" id="__codelineno-20-39" name="__codelineno-20-39"></a><span class="w">      </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-20-40"><a href="#__codelineno-20-40" id="__codelineno-20-40" name="__codelineno-20-40"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-41"><a href="#__codelineno-20-41" id="__codelineno-20-41" name="__codelineno-20-41"></a>
</span><span id="__span-20-42"><a href="#__codelineno-20-42" id="__codelineno-20-42" name="__codelineno-20-42"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-20-43"><a href="#__codelineno-20-43" id="__codelineno-20-43" name="__codelineno-20-43"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-20-44"><a href="#__codelineno-20-44" id="__codelineno-20-44" name="__codelineno-20-44"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Key setup points:</strong></p> <ul> <li>The server declares both <code>resources: {}</code> and <code>tools: {}</code> capabilities</li> <li>A Map is used to store documents in memory</li> <li>Sample data is initialized to demonstrate functionality</li> </ul> <p><br/></p> <div class="language-typescript highlight"><span class="filename">Setup Handlers Method</span><pre><span></span><code><span id="__span-21-1"><a href="#__codelineno-21-1" id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a href="#__codelineno-21-2" id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="c1">// Resource handlers - provide read-only access to documents</span>
</span><span id="__span-21-3"><a href="#__codelineno-21-3" id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><a href="#__codelineno-21-4" id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">entries</span><span class="p">()).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-21-5"><a href="#__codelineno-21-5" id="__codelineno-21-5" name="__codelineno-21-5"></a><span class="w">        </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`docs://documents/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-6"><a href="#__codelineno-21-6" id="__codelineno-21-6" name="__codelineno-21-6"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-21-7"><a href="#__codelineno-21-7" id="__codelineno-21-7" name="__codelineno-21-7"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-8"><a href="#__codelineno-21-8" id="__codelineno-21-8" name="__codelineno-21-8"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-21-9"><a href="#__codelineno-21-9" id="__codelineno-21-9" name="__codelineno-21-9"></a><span class="w">      </span><span class="p">}));</span>
</span><span id="__span-21-10"><a href="#__codelineno-21-10" id="__codelineno-21-10" name="__codelineno-21-10"></a>
</span><span id="__span-21-11"><a href="#__codelineno-21-11" id="__codelineno-21-11" name="__codelineno-21-11"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-21-12"><a href="#__codelineno-21-12" id="__codelineno-21-12" name="__codelineno-21-12"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-13"><a href="#__codelineno-21-13" id="__codelineno-21-13" name="__codelineno-21-13"></a>
</span><span id="__span-21-14"><a href="#__codelineno-21-14" id="__codelineno-21-14" name="__codelineno-21-14"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-15"><a href="#__codelineno-21-15" id="__codelineno-21-15" name="__codelineno-21-15"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-21-16"><a href="#__codelineno-21-16" id="__codelineno-21-16" name="__codelineno-21-16"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readDocument</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-21-17"><a href="#__codelineno-21-17" id="__codelineno-21-17" name="__codelineno-21-17"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-21-18"><a href="#__codelineno-21-18" id="__codelineno-21-18" name="__codelineno-21-18"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-19"><a href="#__codelineno-21-19" id="__codelineno-21-19" name="__codelineno-21-19"></a>
</span><span id="__span-21-20"><a href="#__codelineno-21-20" id="__codelineno-21-20" name="__codelineno-21-20"></a><span class="w">    </span><span class="c1">// Tool handlers - provide write operations for documents</span>
</span><span id="__span-21-21"><a href="#__codelineno-21-21" id="__codelineno-21-21" name="__codelineno-21-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-22"><a href="#__codelineno-21-22" id="__codelineno-21-22" name="__codelineno-21-22"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-23"><a href="#__codelineno-21-23" id="__codelineno-21-23" name="__codelineno-21-23"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-21-24"><a href="#__codelineno-21-24" id="__codelineno-21-24" name="__codelineno-21-24"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-25"><a href="#__codelineno-21-25" id="__codelineno-21-25" name="__codelineno-21-25"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"create_document"</span><span class="p">,</span>
</span><span id="__span-21-26"><a href="#__codelineno-21-26" id="__codelineno-21-26" name="__codelineno-21-26"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Create a new document"</span><span class="p">,</span>
</span><span id="__span-21-27"><a href="#__codelineno-21-27" id="__codelineno-21-27" name="__codelineno-21-27"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-28"><a href="#__codelineno-21-28" id="__codelineno-21-28" name="__codelineno-21-28"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-21-29"><a href="#__codelineno-21-29" id="__codelineno-21-29" name="__codelineno-21-29"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-30"><a href="#__codelineno-21-30" id="__codelineno-21-30" name="__codelineno-21-30"></a><span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-31"><a href="#__codelineno-21-31" id="__codelineno-21-31" name="__codelineno-21-31"></a><span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-32"><a href="#__codelineno-21-32" id="__codelineno-21-32" name="__codelineno-21-32"></a><span class="w">                </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-33"><a href="#__codelineno-21-33" id="__codelineno-21-33" name="__codelineno-21-33"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span>
</span><span id="__span-21-34"><a href="#__codelineno-21-34" id="__codelineno-21-34" name="__codelineno-21-34"></a><span class="w">                  </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-35"><a href="#__codelineno-21-35" id="__codelineno-21-35" name="__codelineno-21-35"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-21-36"><a href="#__codelineno-21-36" id="__codelineno-21-36" name="__codelineno-21-36"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-21-37"><a href="#__codelineno-21-37" id="__codelineno-21-37" name="__codelineno-21-37"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-38"><a href="#__codelineno-21-38" id="__codelineno-21-38" name="__codelineno-21-38"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"title"</span><span class="p">,</span><span class="w"> </span><span class="s2">"content"</span><span class="p">],</span>
</span><span id="__span-21-39"><a href="#__codelineno-21-39" id="__codelineno-21-39" name="__codelineno-21-39"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-40"><a href="#__codelineno-21-40" id="__codelineno-21-40" name="__codelineno-21-40"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-41"><a href="#__codelineno-21-41" id="__codelineno-21-41" name="__codelineno-21-41"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-42"><a href="#__codelineno-21-42" id="__codelineno-21-42" name="__codelineno-21-42"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"search_documents"</span><span class="p">,</span>
</span><span id="__span-21-43"><a href="#__codelineno-21-43" id="__codelineno-21-43" name="__codelineno-21-43"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Search documents by content or tags"</span><span class="p">,</span>
</span><span id="__span-21-44"><a href="#__codelineno-21-44" id="__codelineno-21-44" name="__codelineno-21-44"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-45"><a href="#__codelineno-21-45" id="__codelineno-21-45" name="__codelineno-21-45"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-21-46"><a href="#__codelineno-21-46" id="__codelineno-21-46" name="__codelineno-21-46"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-47"><a href="#__codelineno-21-47" id="__codelineno-21-47" name="__codelineno-21-47"></a><span class="w">                </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-48"><a href="#__codelineno-21-48" id="__codelineno-21-48" name="__codelineno-21-48"></a><span class="w">                </span><span class="nx">tag</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-49"><a href="#__codelineno-21-49" id="__codelineno-21-49" name="__codelineno-21-49"></a><span class="w">                </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span><span class="w"> </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">10</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-50"><a href="#__codelineno-21-50" id="__codelineno-21-50" name="__codelineno-21-50"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-51"><a href="#__codelineno-21-51" id="__codelineno-21-51" name="__codelineno-21-51"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-52"><a href="#__codelineno-21-52" id="__codelineno-21-52" name="__codelineno-21-52"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-53"><a href="#__codelineno-21-53" id="__codelineno-21-53" name="__codelineno-21-53"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-54"><a href="#__codelineno-21-54" id="__codelineno-21-54" name="__codelineno-21-54"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"update_document"</span><span class="p">,</span>
</span><span id="__span-21-55"><a href="#__codelineno-21-55" id="__codelineno-21-55" name="__codelineno-21-55"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Update an existing document"</span><span class="p">,</span>
</span><span id="__span-21-56"><a href="#__codelineno-21-56" id="__codelineno-21-56" name="__codelineno-21-56"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-57"><a href="#__codelineno-21-57" id="__codelineno-21-57" name="__codelineno-21-57"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-21-58"><a href="#__codelineno-21-58" id="__codelineno-21-58" name="__codelineno-21-58"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-59"><a href="#__codelineno-21-59" id="__codelineno-21-59" name="__codelineno-21-59"></a><span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-60"><a href="#__codelineno-21-60" id="__codelineno-21-60" name="__codelineno-21-60"></a><span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-61"><a href="#__codelineno-21-61" id="__codelineno-21-61" name="__codelineno-21-61"></a><span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-62"><a href="#__codelineno-21-62" id="__codelineno-21-62" name="__codelineno-21-62"></a><span class="w">                </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span><span class="w"> </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-63"><a href="#__codelineno-21-63" id="__codelineno-21-63" name="__codelineno-21-63"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-64"><a href="#__codelineno-21-64" id="__codelineno-21-64" name="__codelineno-21-64"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"id"</span><span class="p">],</span>
</span><span id="__span-21-65"><a href="#__codelineno-21-65" id="__codelineno-21-65" name="__codelineno-21-65"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-66"><a href="#__codelineno-21-66" id="__codelineno-21-66" name="__codelineno-21-66"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-67"><a href="#__codelineno-21-67" id="__codelineno-21-67" name="__codelineno-21-67"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-21-68"><a href="#__codelineno-21-68" id="__codelineno-21-68" name="__codelineno-21-68"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-21-69"><a href="#__codelineno-21-69" id="__codelineno-21-69" name="__codelineno-21-69"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-70"><a href="#__codelineno-21-70" id="__codelineno-21-70" name="__codelineno-21-70"></a>
</span><span id="__span-21-71"><a href="#__codelineno-21-71" id="__codelineno-21-71" name="__codelineno-21-71"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-72"><a href="#__codelineno-21-72" id="__codelineno-21-72" name="__codelineno-21-72"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-21-73"><a href="#__codelineno-21-73" id="__codelineno-21-73" name="__codelineno-21-73"></a>
</span><span id="__span-21-74"><a href="#__codelineno-21-74" id="__codelineno-21-74" name="__codelineno-21-74"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-75"><a href="#__codelineno-21-75" id="__codelineno-21-75" name="__codelineno-21-75"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"create_document"</span><span class="o">:</span>
</span><span id="__span-21-76"><a href="#__codelineno-21-76" id="__codelineno-21-76" name="__codelineno-21-76"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-77"><a href="#__codelineno-21-77" id="__codelineno-21-77" name="__codelineno-21-77"></a>
</span><span id="__span-21-78"><a href="#__codelineno-21-78" id="__codelineno-21-78" name="__codelineno-21-78"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"search_documents"</span><span class="o">:</span>
</span><span id="__span-21-79"><a href="#__codelineno-21-79" id="__codelineno-21-79" name="__codelineno-21-79"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">searchDocuments</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-80"><a href="#__codelineno-21-80" id="__codelineno-21-80" name="__codelineno-21-80"></a>
</span><span id="__span-21-81"><a href="#__codelineno-21-81" id="__codelineno-21-81" name="__codelineno-21-81"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">"update_document"</span><span class="o">:</span>
</span><span id="__span-21-82"><a href="#__codelineno-21-82" id="__codelineno-21-82" name="__codelineno-21-82"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">updateDocument</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-83"><a href="#__codelineno-21-83" id="__codelineno-21-83" name="__codelineno-21-83"></a>
</span><span id="__span-21-84"><a href="#__codelineno-21-84" id="__codelineno-21-84" name="__codelineno-21-84"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-21-85"><a href="#__codelineno-21-85" id="__codelineno-21-85" name="__codelineno-21-85"></a><span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-21-86"><a href="#__codelineno-21-86" id="__codelineno-21-86" name="__codelineno-21-86"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-21-87"><a href="#__codelineno-21-87" id="__codelineno-21-87" name="__codelineno-21-87"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-88"><a href="#__codelineno-21-88" id="__codelineno-21-88" name="__codelineno-21-88"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Resource vs Tool handlers:</strong></p> <ul> <li><strong>Resources</strong> expose existing documents for reading (<code>docs://documents/{id}</code>)</li> <li><strong>Tools</strong> provide operations to create, search, and update documents</li> <li>Resources are passive (read-only), tools are active (perform actions)</li> </ul> <p><br/></p> <div class="language-typescript highlight"><span class="filename">Read Document Method</span><pre><span></span><code><span id="__span-22-1"><a href="#__codelineno-22-1" id="__codelineno-22-1" name="__codelineno-22-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readDocument</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a href="#__codelineno-22-2" id="__codelineno-22-2" name="__codelineno-22-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^docs:\/\/documents\/(.+)$/</span><span class="p">);</span>
</span><span id="__span-22-3"><a href="#__codelineno-22-3" id="__codelineno-22-3" name="__codelineno-22-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid document URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-22-4"><a href="#__codelineno-22-4" id="__codelineno-22-4" name="__codelineno-22-4"></a>
</span><span id="__span-22-5"><a href="#__codelineno-22-5" id="__codelineno-22-5" name="__codelineno-22-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-22-6"><a href="#__codelineno-22-6" id="__codelineno-22-6" name="__codelineno-22-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-22-7"><a href="#__codelineno-22-7" id="__codelineno-22-7" name="__codelineno-22-7"></a>
</span><span id="__span-22-8"><a href="#__codelineno-22-8" id="__codelineno-22-8" name="__codelineno-22-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Document not found: </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-22-9"><a href="#__codelineno-22-9" id="__codelineno-22-9" name="__codelineno-22-9"></a>
</span><span id="__span-22-10"><a href="#__codelineno-22-10" id="__codelineno-22-10" name="__codelineno-22-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-11"><a href="#__codelineno-22-11" id="__codelineno-22-11" name="__codelineno-22-11"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-22-12"><a href="#__codelineno-22-12" id="__codelineno-22-12" name="__codelineno-22-12"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-22-13"><a href="#__codelineno-22-13" id="__codelineno-22-13" name="__codelineno-22-13"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-22-14"><a href="#__codelineno-22-14" id="__codelineno-22-14" name="__codelineno-22-14"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-22-15"><a href="#__codelineno-22-15" id="__codelineno-22-15" name="__codelineno-22-15"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Resource reading:</strong> Parses the URI to extract the document ID, retrieves the document from the Map, and returns it as JSON content.</p> <p><br/></p> <div class="language-typescript highlight"><span class="filename">Create Document Method</span><pre><span></span><code><span id="__span-23-1"><a href="#__codelineno-23-1" id="__codelineno-23-1" name="__codelineno-23-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a href="#__codelineno-23-2" id="__codelineno-23-2" name="__codelineno-23-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`doc</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-23-3"><a href="#__codelineno-23-3" id="__codelineno-23-3" name="__codelineno-23-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-4"><a href="#__codelineno-23-4" id="__codelineno-23-4" name="__codelineno-23-4"></a><span class="w">      </span><span class="nx">id</span><span class="p">,</span>
</span><span id="__span-23-5"><a href="#__codelineno-23-5" id="__codelineno-23-5" name="__codelineno-23-5"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">args.title</span><span class="p">,</span>
</span><span id="__span-23-6"><a href="#__codelineno-23-6" id="__codelineno-23-6" name="__codelineno-23-6"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">args.content</span><span class="p">,</span>
</span><span id="__span-23-7"><a href="#__codelineno-23-7" id="__codelineno-23-7" name="__codelineno-23-7"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="kt">args.tags</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-23-8"><a href="#__codelineno-23-8" id="__codelineno-23-8" name="__codelineno-23-8"></a><span class="w">      </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-23-9"><a href="#__codelineno-23-9" id="__codelineno-23-9" name="__codelineno-23-9"></a><span class="w">      </span><span class="nx">modified</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-23-10"><a href="#__codelineno-23-10" id="__codelineno-23-10" name="__codelineno-23-10"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-23-11"><a href="#__codelineno-23-11" id="__codelineno-23-11" name="__codelineno-23-11"></a>
</span><span id="__span-23-12"><a href="#__codelineno-23-12" id="__codelineno-23-12" name="__codelineno-23-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-23-13"><a href="#__codelineno-23-13" id="__codelineno-23-13" name="__codelineno-23-13"></a>
</span><span id="__span-23-14"><a href="#__codelineno-23-14" id="__codelineno-23-14" name="__codelineno-23-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-15"><a href="#__codelineno-23-15" id="__codelineno-23-15" name="__codelineno-23-15"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-16"><a href="#__codelineno-23-16" id="__codelineno-23-16" name="__codelineno-23-16"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-23-17"><a href="#__codelineno-23-17" id="__codelineno-23-17" name="__codelineno-23-17"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-23-18"><a href="#__codelineno-23-18" id="__codelineno-23-18" name="__codelineno-23-18"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document created successfully!\n\nID: </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">\nTitle: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">\nURI: docs://documents/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-23-19"><a href="#__codelineno-23-19" id="__codelineno-23-19" name="__codelineno-23-19"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-20"><a href="#__codelineno-23-20" id="__codelineno-23-20" name="__codelineno-23-20"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-23-21"><a href="#__codelineno-23-21" id="__codelineno-23-21" name="__codelineno-23-21"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-23-22"><a href="#__codelineno-23-22" id="__codelineno-23-22" name="__codelineno-23-22"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Tool implementation:</strong> Creates a new document with a timestamp-based ID, stores it in the Map, and returns success information including the new document’s URI.</p> <p><br/></p> <div class="language-typescript highlight"><span class="filename">Search Documents Method</span><pre><span></span><code><span id="__span-24-1"><a href="#__codelineno-24-1" id="__codelineno-24-1" name="__codelineno-24-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">searchDocuments</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a href="#__codelineno-24-2" id="__codelineno-24-2" name="__codelineno-24-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">values</span><span class="p">());</span>
</span><span id="__span-24-3"><a href="#__codelineno-24-3" id="__codelineno-24-3" name="__codelineno-24-3"></a>
</span><span id="__span-24-4"><a href="#__codelineno-24-4" id="__codelineno-24-4" name="__codelineno-24-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a href="#__codelineno-24-5" id="__codelineno-24-5" name="__codelineno-24-5"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-24-6"><a href="#__codelineno-24-6" id="__codelineno-24-6" name="__codelineno-24-6"></a><span class="w">      </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-24-7"><a href="#__codelineno-24-7" id="__codelineno-24-7" name="__codelineno-24-7"></a><span class="w">        </span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
</span><span id="__span-24-8"><a href="#__codelineno-24-8" id="__codelineno-24-8" name="__codelineno-24-8"></a><span class="w">        </span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
</span><span id="__span-24-9"><a href="#__codelineno-24-9" id="__codelineno-24-9" name="__codelineno-24-9"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-24-10"><a href="#__codelineno-24-10" id="__codelineno-24-10" name="__codelineno-24-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-11"><a href="#__codelineno-24-11" id="__codelineno-24-11" name="__codelineno-24-11"></a>
</span><span id="__span-24-12"><a href="#__codelineno-24-12" id="__codelineno-24-12" name="__codelineno-24-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-13"><a href="#__codelineno-24-13" id="__codelineno-24-13" name="__codelineno-24-13"></a><span class="w">      </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span id="__span-24-14"><a href="#__codelineno-24-14" id="__codelineno-24-14" name="__codelineno-24-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-15"><a href="#__codelineno-24-15" id="__codelineno-24-15" name="__codelineno-24-15"></a>
</span><span id="__span-24-16"><a href="#__codelineno-24-16" id="__codelineno-24-16" name="__codelineno-24-16"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">limit</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
</span><span id="__span-24-17"><a href="#__codelineno-24-17" id="__codelineno-24-17" name="__codelineno-24-17"></a><span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">);</span>
</span><span id="__span-24-18"><a href="#__codelineno-24-18" id="__codelineno-24-18" name="__codelineno-24-18"></a>
</span><span id="__span-24-19"><a href="#__codelineno-24-19" id="__codelineno-24-19" name="__codelineno-24-19"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-24-20"><a href="#__codelineno-24-20" id="__codelineno-24-20" name="__codelineno-24-20"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.id</span><span class="p">,</span>
</span><span id="__span-24-21"><a href="#__codelineno-24-21" id="__codelineno-24-21" name="__codelineno-24-21"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-24-22"><a href="#__codelineno-24-22" id="__codelineno-24-22" name="__codelineno-24-22"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.tags</span><span class="p">,</span>
</span><span id="__span-24-23"><a href="#__codelineno-24-23" id="__codelineno-24-23" name="__codelineno-24-23"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`docs://documents/</span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-24-24"><a href="#__codelineno-24-24" id="__codelineno-24-24" name="__codelineno-24-24"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-24-25"><a href="#__codelineno-24-25" id="__codelineno-24-25" name="__codelineno-24-25"></a>
</span><span id="__span-24-26"><a href="#__codelineno-24-26" id="__codelineno-24-26" name="__codelineno-24-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-27"><a href="#__codelineno-24-27" id="__codelineno-24-27" name="__codelineno-24-27"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-24-28"><a href="#__codelineno-24-28" id="__codelineno-24-28" name="__codelineno-24-28"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-24-29"><a href="#__codelineno-24-29" id="__codelineno-24-29" name="__codelineno-24-29"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-24-30"><a href="#__codelineno-24-30" id="__codelineno-24-30" name="__codelineno-24-30"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Found </span><span class="si">${</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> documents:\n\n</span><span class="si">${</span><span class="nx">formatted</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-24-31"><a href="#__codelineno-24-31" id="__codelineno-24-31" name="__codelineno-24-31"></a><span class="w">            </span><span class="sb">`📄 </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">', '</span><span class="p">)</span><span class="si">}</span><span class="sb">)\n   URI: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-24-32"><a href="#__codelineno-24-32" id="__codelineno-24-32" name="__codelineno-24-32"></a><span class="w">          </span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">'\n\n'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-24-33"><a href="#__codelineno-24-33" id="__codelineno-24-33" name="__codelineno-24-33"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-24-34"><a href="#__codelineno-24-34" id="__codelineno-24-34" name="__codelineno-24-34"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-24-35"><a href="#__codelineno-24-35" id="__codelineno-24-35" name="__codelineno-24-35"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-36"><a href="#__codelineno-24-36" id="__codelineno-24-36" name="__codelineno-24-36"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Search tool:</strong> Filters documents by query string or tag, limits results, and returns formatted text output with document URIs for easy access.</p> <p><br/></p> <div class="language-typescript highlight"><span class="filename">Update Document Method</span><pre><span></span><code><span id="__span-25-1"><a href="#__codelineno-25-1" id="__codelineno-25-1" name="__codelineno-25-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a href="#__codelineno-25-2" id="__codelineno-25-2" name="__codelineno-25-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-25-3"><a href="#__codelineno-25-3" id="__codelineno-25-3" name="__codelineno-25-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Document not found: </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-25-4"><a href="#__codelineno-25-4" id="__codelineno-25-4" name="__codelineno-25-4"></a>
</span><span id="__span-25-5"><a href="#__codelineno-25-5" id="__codelineno-25-5" name="__codelineno-25-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
</span><span id="__span-25-6"><a href="#__codelineno-25-6" id="__codelineno-25-6" name="__codelineno-25-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-25-7"><a href="#__codelineno-25-7" id="__codelineno-25-7" name="__codelineno-25-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tags</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">tags</span><span class="p">;</span>
</span><span id="__span-25-8"><a href="#__codelineno-25-8" id="__codelineno-25-8" name="__codelineno-25-8"></a><span class="w">    </span><span class="nx">doc</span><span class="p">.</span><span class="nx">modified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-25-9"><a href="#__codelineno-25-9" id="__codelineno-25-9" name="__codelineno-25-9"></a>
</span><span id="__span-25-10"><a href="#__codelineno-25-10" id="__codelineno-25-10" name="__codelineno-25-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-11"><a href="#__codelineno-25-11" id="__codelineno-25-11" name="__codelineno-25-11"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-12"><a href="#__codelineno-25-12" id="__codelineno-25-12" name="__codelineno-25-12"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-25-13"><a href="#__codelineno-25-13" id="__codelineno-25-13" name="__codelineno-25-13"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span>
</span><span id="__span-25-14"><a href="#__codelineno-25-14" id="__codelineno-25-14" name="__codelineno-25-14"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document updated successfully!\n\nID: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">\nTitle: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">\nModified: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">modified</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-25-15"><a href="#__codelineno-25-15" id="__codelineno-25-15" name="__codelineno-25-15"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-25-16"><a href="#__codelineno-25-16" id="__codelineno-25-16" name="__codelineno-25-16"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-25-17"><a href="#__codelineno-25-17" id="__codelineno-25-17" name="__codelineno-25-17"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-25-18"><a href="#__codelineno-25-18" id="__codelineno-25-18" name="__codelineno-25-18"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div> <p><strong>Update tool:</strong> Modifies existing document fields and updates the modification timestamp, providing feedback about the changes made.</p> <p><br/></p> <p><strong>How resources and tools complement each other:</strong></p> <ul> <li><strong>Resources</strong> provide passive access: LLMs can read documents at <code>docs://documents/{id}</code></li> <li><strong>Tools</strong> enable active operations: LLMs can create, search, and update documents</li> <li><strong>Integration</strong>: Tools can reference resources in their responses (e.g., “Read the new document at docs://documents/123”)</li> <li><strong>Workflow</strong>: Create documents with tools, then read them as resources for context</li> </ul> <hr/> <h2 id="hands-on-exercises">Hands-On Exercises<a class="headerlink" href="#hands-on-exercises" title="Permanent link">¶</a></h2> <h3 id="exercise-1-file-system-resource-server">Exercise 1: File System Resource Server<a class="headerlink" href="#exercise-1-file-system-resource-server" title="Permanent link">¶</a></h3> <p>Create a tool that:</p> <ul> <li>Exposes a directory as MCP resources</li> <li>Supports different file types (text, JSON, Markdown)</li> <li>Implements proper security (no directory traversal)</li> <li>Includes file metadata (size, modified date)</li> </ul> <details> <summary>💡 Solution: File System Resource Server</summary> Tool Schema - Add this to your tools array: <div class="language-typescript highlight"><pre><span></span><code><span id="__span-26-1"><a href="#__codelineno-26-1" id="__codelineno-26-1" name="__codelineno-26-1"></a><span class="p">{</span>
</span><span id="__span-26-2"><a href="#__codelineno-26-2" id="__codelineno-26-2" name="__codelineno-26-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"create_file_resource_server"</span><span class="p">,</span>
</span><span id="__span-26-3"><a href="#__codelineno-26-3" id="__codelineno-26-3" name="__codelineno-26-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Create an MCP server that exposes a directory as resources"</span><span class="p">,</span>
</span><span id="__span-26-4"><a href="#__codelineno-26-4" id="__codelineno-26-4" name="__codelineno-26-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-5"><a href="#__codelineno-26-5" id="__codelineno-26-5" name="__codelineno-26-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-26-6"><a href="#__codelineno-26-6" id="__codelineno-26-6" name="__codelineno-26-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><a href="#__codelineno-26-7" id="__codelineno-26-7" name="__codelineno-26-7"></a><span class="w">      </span><span class="nx">directory</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a href="#__codelineno-26-8" id="__codelineno-26-8" name="__codelineno-26-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-26-9"><a href="#__codelineno-26-9" id="__codelineno-26-9" name="__codelineno-26-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Directory path to expose as resources"</span><span class="p">,</span>
</span><span id="__span-26-10"><a href="#__codelineno-26-10" id="__codelineno-26-10" name="__codelineno-26-10"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">"./files"</span>
</span><span id="__span-26-11"><a href="#__codelineno-26-11" id="__codelineno-26-11" name="__codelineno-26-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-26-12"><a href="#__codelineno-26-12" id="__codelineno-26-12" name="__codelineno-26-12"></a><span class="w">      </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-13"><a href="#__codelineno-26-13" id="__codelineno-26-13" name="__codelineno-26-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span>
</span><span id="__span-26-14"><a href="#__codelineno-26-14" id="__codelineno-26-14" name="__codelineno-26-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"File extensions to include"</span><span class="p">,</span>
</span><span id="__span-26-15"><a href="#__codelineno-26-15" id="__codelineno-26-15" name="__codelineno-26-15"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-26-16"><a href="#__codelineno-26-16" id="__codelineno-26-16" name="__codelineno-26-16"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">".md"</span><span class="p">,</span><span class="w"> </span><span class="s2">".txt"</span><span class="p">,</span><span class="w"> </span><span class="s2">".json"</span><span class="p">,</span><span class="w"> </span><span class="s2">".yaml"</span><span class="p">,</span><span class="w"> </span><span class="s2">".yml"</span><span class="p">]</span>
</span><span id="__span-26-17"><a href="#__codelineno-26-17" id="__codelineno-26-17" name="__codelineno-26-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-26-18"><a href="#__codelineno-26-18" id="__codelineno-26-18" name="__codelineno-26-18"></a><span class="w">      </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-19"><a href="#__codelineno-26-19" id="__codelineno-26-19" name="__codelineno-26-19"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-26-20"><a href="#__codelineno-26-20" id="__codelineno-26-20" name="__codelineno-26-20"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Maximum file size in bytes"</span><span class="p">,</span>
</span><span id="__span-26-21"><a href="#__codelineno-26-21" id="__codelineno-26-21" name="__codelineno-26-21"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1048576</span>
</span><span id="__span-26-22"><a href="#__codelineno-26-22" id="__codelineno-26-22" name="__codelineno-26-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-23"><a href="#__codelineno-26-23" id="__codelineno-26-23" name="__codelineno-26-23"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-26-24"><a href="#__codelineno-26-24" id="__codelineno-26-24" name="__codelineno-26-24"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"directory"</span><span class="p">]</span>
</span><span id="__span-26-25"><a href="#__codelineno-26-25" id="__codelineno-26-25" name="__codelineno-26-25"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-26"><a href="#__codelineno-26-26" id="__codelineno-26-26" name="__codelineno-26-26"></a><span class="p">}</span>
</span></code></pre></div> Implementation: <div class="language-typescript highlight"><pre><span></span><code><span id="__span-27-1"><a href="#__codelineno-27-1" id="__codelineno-27-1" name="__codelineno-27-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-27-2"><a href="#__codelineno-27-2" id="__codelineno-27-2" name="__codelineno-27-2"></a>
</span><span id="__span-27-3"><a href="#__codelineno-27-3" id="__codelineno-27-3" name="__codelineno-27-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-27-4"><a href="#__codelineno-27-4" id="__codelineno-27-4" name="__codelineno-27-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-27-5"><a href="#__codelineno-27-5" id="__codelineno-27-5" name="__codelineno-27-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-6"><a href="#__codelineno-27-6" id="__codelineno-27-6" name="__codelineno-27-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-27-7"><a href="#__codelineno-27-7" id="__codelineno-27-7" name="__codelineno-27-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-27-8"><a href="#__codelineno-27-8" id="__codelineno-27-8" name="__codelineno-27-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-27-9"><a href="#__codelineno-27-9" id="__codelineno-27-9" name="__codelineno-27-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'fs/promises'</span><span class="p">;</span>
</span><span id="__span-27-10"><a href="#__codelineno-27-10" id="__codelineno-27-10" name="__codelineno-27-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'path'</span><span class="p">;</span>
</span><span id="__span-27-11"><a href="#__codelineno-27-11" id="__codelineno-27-11" name="__codelineno-27-11"></a>
</span><span id="__span-27-12"><a href="#__codelineno-27-12" id="__codelineno-27-12" name="__codelineno-27-12"></a><span class="kd">class</span><span class="w"> </span><span class="nx">FileSystemResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-13"><a href="#__codelineno-27-13" id="__codelineno-27-13" name="__codelineno-27-13"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-27-14"><a href="#__codelineno-27-14" id="__codelineno-27-14" name="__codelineno-27-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">rootDir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-27-15"><a href="#__codelineno-27-15" id="__codelineno-27-15" name="__codelineno-27-15"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
</span><span id="__span-27-16"><a href="#__codelineno-27-16" id="__codelineno-27-16" name="__codelineno-27-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-27-17"><a href="#__codelineno-27-17" id="__codelineno-27-17" name="__codelineno-27-17"></a>
</span><span id="__span-27-18"><a href="#__codelineno-27-18" id="__codelineno-27-18" name="__codelineno-27-18"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">rootDir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'./files'</span><span class="p">,</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'.md'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.txt'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.json'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.yaml'</span><span class="p">,</span><span class="w"> </span><span class="s1">'.yml'</span><span class="p">],</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1048576</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-19"><a href="#__codelineno-27-19" id="__codelineno-27-19" name="__codelineno-27-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">rootDir</span><span class="p">);</span>
</span><span id="__span-27-20"><a href="#__codelineno-27-20" id="__codelineno-27-20" name="__codelineno-27-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="p">;</span>
</span><span id="__span-27-21"><a href="#__codelineno-27-21" id="__codelineno-27-21" name="__codelineno-27-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="p">;</span>
</span><span id="__span-27-22"><a href="#__codelineno-27-22" id="__codelineno-27-22" name="__codelineno-27-22"></a>
</span><span id="__span-27-23"><a href="#__codelineno-27-23" id="__codelineno-27-23" name="__codelineno-27-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-27-24"><a href="#__codelineno-27-24" id="__codelineno-27-24" name="__codelineno-27-24"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-27-25"><a href="#__codelineno-27-25" id="__codelineno-27-25" name="__codelineno-27-25"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"filesystem-resource-server"</span><span class="p">,</span>
</span><span id="__span-27-26"><a href="#__codelineno-27-26" id="__codelineno-27-26" name="__codelineno-27-26"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-27-27"><a href="#__codelineno-27-27" id="__codelineno-27-27" name="__codelineno-27-27"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-27-28"><a href="#__codelineno-27-28" id="__codelineno-27-28" name="__codelineno-27-28"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-27-29"><a href="#__codelineno-27-29" id="__codelineno-27-29" name="__codelineno-27-29"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-30"><a href="#__codelineno-27-30" id="__codelineno-27-30" name="__codelineno-27-30"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-27-31"><a href="#__codelineno-27-31" id="__codelineno-27-31" name="__codelineno-27-31"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-27-32"><a href="#__codelineno-27-32" id="__codelineno-27-32" name="__codelineno-27-32"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-33"><a href="#__codelineno-27-33" id="__codelineno-27-33" name="__codelineno-27-33"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-27-34"><a href="#__codelineno-27-34" id="__codelineno-27-34" name="__codelineno-27-34"></a>
</span><span id="__span-27-35"><a href="#__codelineno-27-35" id="__codelineno-27-35" name="__codelineno-27-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-27-36"><a href="#__codelineno-27-36" id="__codelineno-27-36" name="__codelineno-27-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-27-37"><a href="#__codelineno-27-37" id="__codelineno-27-37" name="__codelineno-27-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-38"><a href="#__codelineno-27-38" id="__codelineno-27-38" name="__codelineno-27-38"></a>
</span><span id="__span-27-39"><a href="#__codelineno-27-39" id="__codelineno-27-39" name="__codelineno-27-39"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-40"><a href="#__codelineno-27-40" id="__codelineno-27-40" name="__codelineno-27-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-41"><a href="#__codelineno-27-41" id="__codelineno-27-41" name="__codelineno-27-41"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">discoverFiles</span><span class="p">();</span>
</span><span id="__span-27-42"><a href="#__codelineno-27-42" id="__codelineno-27-42" name="__codelineno-27-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-27-43"><a href="#__codelineno-27-43" id="__codelineno-27-43" name="__codelineno-27-43"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-44"><a href="#__codelineno-27-44" id="__codelineno-27-44" name="__codelineno-27-44"></a>
</span><span id="__span-27-45"><a href="#__codelineno-27-45" id="__codelineno-27-45" name="__codelineno-27-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-46"><a href="#__codelineno-27-46" id="__codelineno-27-46" name="__codelineno-27-46"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-27-47"><a href="#__codelineno-27-47" id="__codelineno-27-47" name="__codelineno-27-47"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-27-48"><a href="#__codelineno-27-48" id="__codelineno-27-48" name="__codelineno-27-48"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-27-49"><a href="#__codelineno-27-49" id="__codelineno-27-49" name="__codelineno-27-49"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-50"><a href="#__codelineno-27-50" id="__codelineno-27-50" name="__codelineno-27-50"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-51"><a href="#__codelineno-27-51" id="__codelineno-27-51" name="__codelineno-27-51"></a>
</span><span id="__span-27-52"><a href="#__codelineno-27-52" id="__codelineno-27-52" name="__codelineno-27-52"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">discoverFiles</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-53"><a href="#__codelineno-27-53" id="__codelineno-27-53" name="__codelineno-27-53"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-27-54"><a href="#__codelineno-27-54" id="__codelineno-27-54" name="__codelineno-27-54"></a>
</span><span id="__span-27-55"><a href="#__codelineno-27-55" id="__codelineno-27-55" name="__codelineno-27-55"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-56"><a href="#__codelineno-27-56" id="__codelineno-27-56" name="__codelineno-27-56"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">);</span>
</span><span id="__span-27-57"><a href="#__codelineno-27-57" id="__codelineno-27-57" name="__codelineno-27-57"></a>
</span><span id="__span-27-58"><a href="#__codelineno-27-58" id="__codelineno-27-58" name="__codelineno-27-58"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-59"><a href="#__codelineno-27-59" id="__codelineno-27-59" name="__codelineno-27-59"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-60"><a href="#__codelineno-27-60" id="__codelineno-27-60" name="__codelineno-27-60"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`file:///</span><span class="si">${</span><span class="nx">relativePath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span><span class="w"> </span><span class="s1">'/'</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-61"><a href="#__codelineno-27-61" id="__codelineno-27-61" name="__codelineno-27-61"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-62"><a href="#__codelineno-27-62" id="__codelineno-27-62" name="__codelineno-27-62"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-63"><a href="#__codelineno-27-63" id="__codelineno-27-63" name="__codelineno-27-63"></a>
</span><span id="__span-27-64"><a href="#__codelineno-27-64" id="__codelineno-27-64" name="__codelineno-27-64"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-27-65"><a href="#__codelineno-27-65" id="__codelineno-27-65" name="__codelineno-27-65"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-27-66"><a href="#__codelineno-27-66" id="__codelineno-27-66" name="__codelineno-27-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">path.basename</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span>
</span><span id="__span-27-67"><a href="#__codelineno-27-67" id="__codelineno-27-67" name="__codelineno-27-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`File: </span><span class="si">${</span><span class="nx">relativePath</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">formatFileSize</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
</span><span id="__span-27-68"><a href="#__codelineno-27-68" id="__codelineno-27-68" name="__codelineno-27-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-27-69"><a href="#__codelineno-27-69" id="__codelineno-27-69" name="__codelineno-27-69"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-27-70"><a href="#__codelineno-27-70" id="__codelineno-27-70" name="__codelineno-27-70"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-71"><a href="#__codelineno-27-71" id="__codelineno-27-71" name="__codelineno-27-71"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-72"><a href="#__codelineno-27-72" id="__codelineno-27-72" name="__codelineno-27-72"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Error discovering files:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-73"><a href="#__codelineno-27-73" id="__codelineno-27-73" name="__codelineno-27-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-74"><a href="#__codelineno-27-74" id="__codelineno-27-74" name="__codelineno-27-74"></a>
</span><span id="__span-27-75"><a href="#__codelineno-27-75" id="__codelineno-27-75" name="__codelineno-27-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">resources</span><span class="p">;</span>
</span><span id="__span-27-76"><a href="#__codelineno-27-76" id="__codelineno-27-76" name="__codelineno-27-76"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-77"><a href="#__codelineno-27-77" id="__codelineno-27-77" name="__codelineno-27-77"></a>
</span><span id="__span-27-78"><a href="#__codelineno-27-78" id="__codelineno-27-78" name="__codelineno-27-78"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-79"><a href="#__codelineno-27-79" id="__codelineno-27-79" name="__codelineno-27-79"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'file:///'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-80"><a href="#__codelineno-27-80" id="__codelineno-27-80" name="__codelineno-27-80"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid URI format: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-81"><a href="#__codelineno-27-81" id="__codelineno-27-81" name="__codelineno-27-81"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-82"><a href="#__codelineno-27-82" id="__codelineno-27-82" name="__codelineno-27-82"></a>
</span><span id="__span-27-83"><a href="#__codelineno-27-83" id="__codelineno-27-83" name="__codelineno-27-83"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'file:///'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-27-84"><a href="#__codelineno-27-84" id="__codelineno-27-84" name="__codelineno-27-84"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">,</span><span class="w"> </span><span class="nx">relativePath</span><span class="p">);</span>
</span><span id="__span-27-85"><a href="#__codelineno-27-85" id="__codelineno-27-85" name="__codelineno-27-85"></a>
</span><span id="__span-27-86"><a href="#__codelineno-27-86" id="__codelineno-27-86" name="__codelineno-27-86"></a><span class="w">    </span><span class="c1">// Security: Prevent directory traversal</span>
</span><span id="__span-27-87"><a href="#__codelineno-27-87" id="__codelineno-27-87" name="__codelineno-27-87"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-88"><a href="#__codelineno-27-88" id="__codelineno-27-88" name="__codelineno-27-88"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-89"><a href="#__codelineno-27-89" id="__codelineno-27-89" name="__codelineno-27-89"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Access denied: path outside allowed directory'</span><span class="p">);</span>
</span><span id="__span-27-90"><a href="#__codelineno-27-90" id="__codelineno-27-90" name="__codelineno-27-90"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-91"><a href="#__codelineno-27-91" id="__codelineno-27-91" name="__codelineno-27-91"></a>
</span><span id="__span-27-92"><a href="#__codelineno-27-92" id="__codelineno-27-92" name="__codelineno-27-92"></a><span class="w">    </span><span class="c1">// Check if file extension is allowed</span>
</span><span id="__span-27-93"><a href="#__codelineno-27-93" id="__codelineno-27-93" name="__codelineno-27-93"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-94"><a href="#__codelineno-27-94" id="__codelineno-27-94" name="__codelineno-27-94"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-95"><a href="#__codelineno-27-95" id="__codelineno-27-95" name="__codelineno-27-95"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File type not allowed: </span><span class="si">${</span><span class="nx">ext</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-96"><a href="#__codelineno-27-96" id="__codelineno-27-96" name="__codelineno-27-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-97"><a href="#__codelineno-27-97" id="__codelineno-27-97" name="__codelineno-27-97"></a>
</span><span id="__span-27-98"><a href="#__codelineno-27-98" id="__codelineno-27-98" name="__codelineno-27-98"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-99"><a href="#__codelineno-27-99" id="__codelineno-27-99" name="__codelineno-27-99"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-100"><a href="#__codelineno-27-100" id="__codelineno-27-100" name="__codelineno-27-100"></a>
</span><span id="__span-27-101"><a href="#__codelineno-27-101" id="__codelineno-27-101" name="__codelineno-27-101"></a><span class="w">      </span><span class="c1">// Check file size</span>
</span><span id="__span-27-102"><a href="#__codelineno-27-102" id="__codelineno-27-102" name="__codelineno-27-102"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-103"><a href="#__codelineno-27-103" id="__codelineno-27-103" name="__codelineno-27-103"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File too large: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> bytes (max: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-27-104"><a href="#__codelineno-27-104" id="__codelineno-27-104" name="__codelineno-27-104"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-105"><a href="#__codelineno-27-105" id="__codelineno-27-105" name="__codelineno-27-105"></a>
</span><span id="__span-27-106"><a href="#__codelineno-27-106" id="__codelineno-27-106" name="__codelineno-27-106"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="s1">'utf8'</span><span class="p">);</span>
</span><span id="__span-27-107"><a href="#__codelineno-27-107" id="__codelineno-27-107" name="__codelineno-27-107"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-108"><a href="#__codelineno-27-108" id="__codelineno-27-108" name="__codelineno-27-108"></a>
</span><span id="__span-27-109"><a href="#__codelineno-27-109" id="__codelineno-27-109" name="__codelineno-27-109"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-110"><a href="#__codelineno-27-110" id="__codelineno-27-110" name="__codelineno-27-110"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-27-111"><a href="#__codelineno-27-111" id="__codelineno-27-111" name="__codelineno-27-111"></a><span class="w">        </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-27-112"><a href="#__codelineno-27-112" id="__codelineno-27-112" name="__codelineno-27-112"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
</span><span id="__span-27-113"><a href="#__codelineno-27-113" id="__codelineno-27-113" name="__codelineno-27-113"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-27-114"><a href="#__codelineno-27-114" id="__codelineno-27-114" name="__codelineno-27-114"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-115"><a href="#__codelineno-27-115" id="__codelineno-27-115" name="__codelineno-27-115"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to read file: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">'Unknown error'</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-116"><a href="#__codelineno-27-116" id="__codelineno-27-116" name="__codelineno-27-116"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-117"><a href="#__codelineno-27-117" id="__codelineno-27-117" name="__codelineno-27-117"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-118"><a href="#__codelineno-27-118" id="__codelineno-27-118" name="__codelineno-27-118"></a>
</span><span id="__span-27-119"><a href="#__codelineno-27-119" id="__codelineno-27-119" name="__codelineno-27-119"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">dir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-120"><a href="#__codelineno-27-120" id="__codelineno-27-120" name="__codelineno-27-120"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-27-121"><a href="#__codelineno-27-121" id="__codelineno-27-121" name="__codelineno-27-121"></a>
</span><span id="__span-27-122"><a href="#__codelineno-27-122" id="__codelineno-27-122" name="__codelineno-27-122"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-123"><a href="#__codelineno-27-123" id="__codelineno-27-123" name="__codelineno-27-123"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">withFileTypes</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-27-124"><a href="#__codelineno-27-124" id="__codelineno-27-124" name="__codelineno-27-124"></a>
</span><span id="__span-27-125"><a href="#__codelineno-27-125" id="__codelineno-27-125" name="__codelineno-27-125"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-126"><a href="#__codelineno-27-126" id="__codelineno-27-126" name="__codelineno-27-126"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-27-127"><a href="#__codelineno-27-127" id="__codelineno-27-127" name="__codelineno-27-127"></a>
</span><span id="__span-27-128"><a href="#__codelineno-27-128" id="__codelineno-27-128" name="__codelineno-27-128"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-129"><a href="#__codelineno-27-129" id="__codelineno-27-129" name="__codelineno-27-129"></a><span class="w">          </span><span class="c1">// Skip hidden directories</span>
</span><span id="__span-27-130"><a href="#__codelineno-27-130" id="__codelineno-27-130" name="__codelineno-27-130"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'.'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-131"><a href="#__codelineno-27-131" id="__codelineno-27-131" name="__codelineno-27-131"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">));</span>
</span><span id="__span-27-132"><a href="#__codelineno-27-132" id="__codelineno-27-132" name="__codelineno-27-132"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-27-133"><a href="#__codelineno-27-133" id="__codelineno-27-133" name="__codelineno-27-133"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-134"><a href="#__codelineno-27-134" id="__codelineno-27-134" name="__codelineno-27-134"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-135"><a href="#__codelineno-27-135" id="__codelineno-27-135" name="__codelineno-27-135"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-136"><a href="#__codelineno-27-136" id="__codelineno-27-136" name="__codelineno-27-136"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">);</span>
</span><span id="__span-27-137"><a href="#__codelineno-27-137" id="__codelineno-27-137" name="__codelineno-27-137"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-27-138"><a href="#__codelineno-27-138" id="__codelineno-27-138" name="__codelineno-27-138"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-139"><a href="#__codelineno-27-139" id="__codelineno-27-139" name="__codelineno-27-139"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-140"><a href="#__codelineno-27-140" id="__codelineno-27-140" name="__codelineno-27-140"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-141"><a href="#__codelineno-27-141" id="__codelineno-27-141" name="__codelineno-27-141"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error walking directory </span><span class="si">${</span><span class="nx">dir</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-142"><a href="#__codelineno-27-142" id="__codelineno-27-142" name="__codelineno-27-142"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-143"><a href="#__codelineno-27-143" id="__codelineno-27-143" name="__codelineno-27-143"></a>
</span><span id="__span-27-144"><a href="#__codelineno-27-144" id="__codelineno-27-144" name="__codelineno-27-144"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">files</span><span class="p">;</span>
</span><span id="__span-27-145"><a href="#__codelineno-27-145" id="__codelineno-27-145" name="__codelineno-27-145"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-146"><a href="#__codelineno-27-146" id="__codelineno-27-146" name="__codelineno-27-146"></a>
</span><span id="__span-27-147"><a href="#__codelineno-27-147" id="__codelineno-27-147" name="__codelineno-27-147"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-148"><a href="#__codelineno-27-148" id="__codelineno-27-148" name="__codelineno-27-148"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-149"><a href="#__codelineno-27-149" id="__codelineno-27-149" name="__codelineno-27-149"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-150"><a href="#__codelineno-27-150" id="__codelineno-27-150" name="__codelineno-27-150"></a><span class="w">      </span><span class="s1">'.md'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/markdown'</span><span class="p">,</span>
</span><span id="__span-27-151"><a href="#__codelineno-27-151" id="__codelineno-27-151" name="__codelineno-27-151"></a><span class="w">      </span><span class="s1">'.txt'</span><span class="o">:</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">,</span>
</span><span id="__span-27-152"><a href="#__codelineno-27-152" id="__codelineno-27-152" name="__codelineno-27-152"></a><span class="w">      </span><span class="s1">'.json'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/json'</span><span class="p">,</span>
</span><span id="__span-27-153"><a href="#__codelineno-27-153" id="__codelineno-27-153" name="__codelineno-27-153"></a><span class="w">      </span><span class="s1">'.yaml'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/yaml'</span><span class="p">,</span>
</span><span id="__span-27-154"><a href="#__codelineno-27-154" id="__codelineno-27-154" name="__codelineno-27-154"></a><span class="w">      </span><span class="s1">'.yml'</span><span class="o">:</span><span class="w"> </span><span class="s1">'application/yaml'</span><span class="p">,</span>
</span><span id="__span-27-155"><a href="#__codelineno-27-155" id="__codelineno-27-155" name="__codelineno-27-155"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-27-156"><a href="#__codelineno-27-156" id="__codelineno-27-156" name="__codelineno-27-156"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="p">[</span><span class="nx">ext</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'text/plain'</span><span class="p">;</span>
</span><span id="__span-27-157"><a href="#__codelineno-27-157" id="__codelineno-27-157" name="__codelineno-27-157"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-158"><a href="#__codelineno-27-158" id="__codelineno-27-158" name="__codelineno-27-158"></a>
</span><span id="__span-27-159"><a href="#__codelineno-27-159" id="__codelineno-27-159" name="__codelineno-27-159"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">formatFileSize</span><span class="p">(</span><span class="nx">bytes</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-160"><a href="#__codelineno-27-160" id="__codelineno-27-160" name="__codelineno-27-160"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">'B'</span><span class="p">,</span><span class="w"> </span><span class="s1">'KB'</span><span class="p">,</span><span class="w"> </span><span class="s1">'MB'</span><span class="p">,</span><span class="w"> </span><span class="s1">'GB'</span><span class="p">];</span>
</span><span id="__span-27-161"><a href="#__codelineno-27-161" id="__codelineno-27-161" name="__codelineno-27-161"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">;</span>
</span><span id="__span-27-162"><a href="#__codelineno-27-162" id="__codelineno-27-162" name="__codelineno-27-162"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">unitIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-27-163"><a href="#__codelineno-27-163" id="__codelineno-27-163" name="__codelineno-27-163"></a>
</span><span id="__span-27-164"><a href="#__codelineno-27-164" id="__codelineno-27-164" name="__codelineno-27-164"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1024</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">unitIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">units</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-165"><a href="#__codelineno-27-165" id="__codelineno-27-165" name="__codelineno-27-165"></a><span class="w">      </span><span class="nx">size</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">1024</span><span class="p">;</span>
</span><span id="__span-27-166"><a href="#__codelineno-27-166" id="__codelineno-27-166" name="__codelineno-27-166"></a><span class="w">      </span><span class="nx">unitIndex</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-27-167"><a href="#__codelineno-27-167" id="__codelineno-27-167" name="__codelineno-27-167"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-168"><a href="#__codelineno-27-168" id="__codelineno-27-168" name="__codelineno-27-168"></a>
</span><span id="__span-27-169"><a href="#__codelineno-27-169" id="__codelineno-27-169" name="__codelineno-27-169"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">size</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">units</span><span class="p">[</span><span class="nx">unitIndex</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-170"><a href="#__codelineno-27-170" id="__codelineno-27-170" name="__codelineno-27-170"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-171"><a href="#__codelineno-27-171" id="__codelineno-27-171" name="__codelineno-27-171"></a>
</span><span id="__span-27-172"><a href="#__codelineno-27-172" id="__codelineno-27-172" name="__codelineno-27-172"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-173"><a href="#__codelineno-27-173" id="__codelineno-27-173" name="__codelineno-27-173"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-174"><a href="#__codelineno-27-174" id="__codelineno-27-174" name="__codelineno-27-174"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-175"><a href="#__codelineno-27-175" id="__codelineno-27-175" name="__codelineno-27-175"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-27-176"><a href="#__codelineno-27-176" id="__codelineno-27-176" name="__codelineno-27-176"></a>
</span><span id="__span-27-177"><a href="#__codelineno-27-177" id="__codelineno-27-177" name="__codelineno-27-177"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-178"><a href="#__codelineno-27-178" id="__codelineno-27-178" name="__codelineno-27-178"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-27-179"><a href="#__codelineno-27-179" id="__codelineno-27-179" name="__codelineno-27-179"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-27-180"><a href="#__codelineno-27-180" id="__codelineno-27-180" name="__codelineno-27-180"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-181"><a href="#__codelineno-27-181" id="__codelineno-27-181" name="__codelineno-27-181"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-182"><a href="#__codelineno-27-182" id="__codelineno-27-182" name="__codelineno-27-182"></a>
</span><span id="__span-27-183"><a href="#__codelineno-27-183" id="__codelineno-27-183" name="__codelineno-27-183"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-184"><a href="#__codelineno-27-184" id="__codelineno-27-184" name="__codelineno-27-184"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-27-185"><a href="#__codelineno-27-185" id="__codelineno-27-185" name="__codelineno-27-185"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-27-186"><a href="#__codelineno-27-186" id="__codelineno-27-186" name="__codelineno-27-186"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`File System Resource Server running (root: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-27-187"><a href="#__codelineno-27-187" id="__codelineno-27-187" name="__codelineno-27-187"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-188"><a href="#__codelineno-27-188" id="__codelineno-27-188" name="__codelineno-27-188"></a><span class="p">}</span>
</span><span id="__span-27-189"><a href="#__codelineno-27-189" id="__codelineno-27-189" name="__codelineno-27-189"></a>
</span><span id="__span-27-190"><a href="#__codelineno-27-190" id="__codelineno-27-190" name="__codelineno-27-190"></a><span class="c1">// Main entry point</span>
</span><span id="__span-27-191"><a href="#__codelineno-27-191" id="__codelineno-27-191" name="__codelineno-27-191"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-192"><a href="#__codelineno-27-192" id="__codelineno-27-192" name="__codelineno-27-192"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileSystemResourceServer</span><span class="p">();</span>
</span><span id="__span-27-193"><a href="#__codelineno-27-193" id="__codelineno-27-193" name="__codelineno-27-193"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-27-194"><a href="#__codelineno-27-194" id="__codelineno-27-194" name="__codelineno-27-194"></a><span class="p">}</span>
</span><span id="__span-27-195"><a href="#__codelineno-27-195" id="__codelineno-27-195" name="__codelineno-27-195"></a>
</span><span id="__span-27-196"><a href="#__codelineno-27-196" id="__codelineno-27-196" name="__codelineno-27-196"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-197"><a href="#__codelineno-27-197" id="__codelineno-27-197" name="__codelineno-27-197"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-198"><a href="#__codelineno-27-198" id="__codelineno-27-198" name="__codelineno-27-198"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-27-199"><a href="#__codelineno-27-199" id="__codelineno-27-199" name="__codelineno-27-199"></a><span class="p">});</span>
</span></code></pre></div> Testing - Create test files and test the server: <div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a href="#__codelineno-28-1" id="__codelineno-28-1" name="__codelineno-28-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>files/docs<span class="w"> </span>files/data
</span><span id="__span-28-2"><a href="#__codelineno-28-2" id="__codelineno-28-2" name="__codelineno-28-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"# API Documentation"</span><span class="w"> </span>&gt;<span class="w"> </span>files/docs/api.md
</span><span id="__span-28-3"><a href="#__codelineno-28-3" id="__codelineno-28-3" name="__codelineno-28-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">'{"version": "1.0.0"}'</span><span class="w"> </span>&gt;<span class="w"> </span>files/data/config.json
</span><span id="__span-28-4"><a href="#__codelineno-28-4" id="__codelineno-28-4" name="__codelineno-28-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">"Simple text file"</span><span class="w"> </span>&gt;<span class="w"> </span>files/docs/notes.txt
</span></code></pre></div> Test with MCP Inspector to verify file discovery and reading. </details> <h3 id="exercise-2-rest-api-resource-server">Exercise 2: REST API Resource Server<a class="headerlink" href="#exercise-2-rest-api-resource-server" title="Permanent link">¶</a></h3> <p>Create a tool that:</p> <ul> <li>Exposes REST API endpoints as resources</li> <li>Supports query parameters in URIs</li> <li>Handles authentication and rate limiting</li> <li>Caches responses appropriately</li> </ul> <details> <summary>💡 Solution: REST API Resource Server</summary> Tool Schema - Add this to your tools array: <div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a href="#__codelineno-29-1" id="__codelineno-29-1" name="__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a href="#__codelineno-29-2" id="__codelineno-29-2" name="__codelineno-29-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"create_api_resource_server"</span><span class="p">,</span>
</span><span id="__span-29-3"><a href="#__codelineno-29-3" id="__codelineno-29-3" name="__codelineno-29-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Create an MCP server that exposes REST API endpoints as resources"</span><span class="p">,</span>
</span><span id="__span-29-4"><a href="#__codelineno-29-4" id="__codelineno-29-4" name="__codelineno-29-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a href="#__codelineno-29-5" id="__codelineno-29-5" name="__codelineno-29-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-29-6"><a href="#__codelineno-29-6" id="__codelineno-29-6" name="__codelineno-29-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-7"><a href="#__codelineno-29-7" id="__codelineno-29-7" name="__codelineno-29-7"></a><span class="w">      </span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a href="#__codelineno-29-8" id="__codelineno-29-8" name="__codelineno-29-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-29-9"><a href="#__codelineno-29-9" id="__codelineno-29-9" name="__codelineno-29-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Base URL of the API to expose"</span><span class="p">,</span>
</span><span id="__span-29-10"><a href="#__codelineno-29-10" id="__codelineno-29-10" name="__codelineno-29-10"></a><span class="w">        </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s2">"uri"</span>
</span><span id="__span-29-11"><a href="#__codelineno-29-11" id="__codelineno-29-11" name="__codelineno-29-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-12"><a href="#__codelineno-29-12" id="__codelineno-29-12" name="__codelineno-29-12"></a><span class="w">      </span><span class="nx">apiKey</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-13"><a href="#__codelineno-29-13" id="__codelineno-29-13" name="__codelineno-29-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-29-14"><a href="#__codelineno-29-14" id="__codelineno-29-14" name="__codelineno-29-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"API key for authentication"</span>
</span><span id="__span-29-15"><a href="#__codelineno-29-15" id="__codelineno-29-15" name="__codelineno-29-15"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-16"><a href="#__codelineno-29-16" id="__codelineno-29-16" name="__codelineno-29-16"></a><span class="w">      </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-17"><a href="#__codelineno-29-17" id="__codelineno-29-17" name="__codelineno-29-17"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span>
</span><span id="__span-29-18"><a href="#__codelineno-29-18" id="__codelineno-29-18" name="__codelineno-29-18"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Enable response caching"</span><span class="p">,</span>
</span><span id="__span-29-19"><a href="#__codelineno-29-19" id="__codelineno-29-19" name="__codelineno-29-19"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-29-20"><a href="#__codelineno-29-20" id="__codelineno-29-20" name="__codelineno-29-20"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-21"><a href="#__codelineno-29-21" id="__codelineno-29-21" name="__codelineno-29-21"></a><span class="w">      </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-22"><a href="#__codelineno-29-22" id="__codelineno-29-22" name="__codelineno-29-22"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-29-23"><a href="#__codelineno-29-23" id="__codelineno-29-23" name="__codelineno-29-23"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Cache TTL in seconds"</span><span class="p">,</span>
</span><span id="__span-29-24"><a href="#__codelineno-29-24" id="__codelineno-29-24" name="__codelineno-29-24"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">300</span>
</span><span id="__span-29-25"><a href="#__codelineno-29-25" id="__codelineno-29-25" name="__codelineno-29-25"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-26"><a href="#__codelineno-29-26" id="__codelineno-29-26" name="__codelineno-29-26"></a><span class="w">      </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-27"><a href="#__codelineno-29-27" id="__codelineno-29-27" name="__codelineno-29-27"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-29-28"><a href="#__codelineno-29-28" id="__codelineno-29-28" name="__codelineno-29-28"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Requests per minute limit"</span><span class="p">,</span>
</span><span id="__span-29-29"><a href="#__codelineno-29-29" id="__codelineno-29-29" name="__codelineno-29-29"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">60</span>
</span><span id="__span-29-30"><a href="#__codelineno-29-30" id="__codelineno-29-30" name="__codelineno-29-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-29-31"><a href="#__codelineno-29-31" id="__codelineno-29-31" name="__codelineno-29-31"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-32"><a href="#__codelineno-29-32" id="__codelineno-29-32" name="__codelineno-29-32"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"baseUrl"</span><span class="p">]</span>
</span><span id="__span-29-33"><a href="#__codelineno-29-33" id="__codelineno-29-33" name="__codelineno-29-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-34"><a href="#__codelineno-29-34" id="__codelineno-29-34" name="__codelineno-29-34"></a><span class="p">}</span>
</span></code></pre></div> Implementation <div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a href="#__codelineno-30-1" id="__codelineno-30-1" name="__codelineno-30-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-30-2"><a href="#__codelineno-30-2" id="__codelineno-30-2" name="__codelineno-30-2"></a>
</span><span id="__span-30-3"><a href="#__codelineno-30-3" id="__codelineno-30-3" name="__codelineno-30-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-30-4"><a href="#__codelineno-30-4" id="__codelineno-30-4" name="__codelineno-30-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-30-5"><a href="#__codelineno-30-5" id="__codelineno-30-5" name="__codelineno-30-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a href="#__codelineno-30-6" id="__codelineno-30-6" name="__codelineno-30-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-7"><a href="#__codelineno-30-7" id="__codelineno-30-7" name="__codelineno-30-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-8"><a href="#__codelineno-30-8" id="__codelineno-30-8" name="__codelineno-30-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-9"><a href="#__codelineno-30-9" id="__codelineno-30-9" name="__codelineno-30-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-30-10"><a href="#__codelineno-30-10" id="__codelineno-30-10" name="__codelineno-30-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-30-11"><a href="#__codelineno-30-11" id="__codelineno-30-11" name="__codelineno-30-11"></a><span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AxiosResponse</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'axios'</span><span class="p">;</span>
</span><span id="__span-30-12"><a href="#__codelineno-30-12" id="__codelineno-30-12" name="__codelineno-30-12"></a>
</span><span id="__span-30-13"><a href="#__codelineno-30-13" id="__codelineno-30-13" name="__codelineno-30-13"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">CacheEntry</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-14"><a href="#__codelineno-30-14" id="__codelineno-30-14" name="__codelineno-30-14"></a><span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span>
</span><span id="__span-30-15"><a href="#__codelineno-30-15" id="__codelineno-30-15" name="__codelineno-30-15"></a><span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-16"><a href="#__codelineno-30-16" id="__codelineno-30-16" name="__codelineno-30-16"></a><span class="w">  </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-17"><a href="#__codelineno-30-17" id="__codelineno-30-17" name="__codelineno-30-17"></a><span class="p">}</span>
</span><span id="__span-30-18"><a href="#__codelineno-30-18" id="__codelineno-30-18" name="__codelineno-30-18"></a>
</span><span id="__span-30-19"><a href="#__codelineno-30-19" id="__codelineno-30-19" name="__codelineno-30-19"></a><span class="kd">class</span><span class="w"> </span><span class="nx">APIResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-20"><a href="#__codelineno-30-20" id="__codelineno-30-20" name="__codelineno-30-20"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-30-21"><a href="#__codelineno-30-21" id="__codelineno-30-21" name="__codelineno-30-21"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-30-22"><a href="#__codelineno-30-22" id="__codelineno-30-22" name="__codelineno-30-22"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-30-23"><a href="#__codelineno-30-23" id="__codelineno-30-23" name="__codelineno-30-23"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">CacheEntry</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-30-24"><a href="#__codelineno-30-24" id="__codelineno-30-24" name="__codelineno-30-24"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
</span><span id="__span-30-25"><a href="#__codelineno-30-25" id="__codelineno-30-25" name="__codelineno-30-25"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-26"><a href="#__codelineno-30-26" id="__codelineno-30-26" name="__codelineno-30-26"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-27"><a href="#__codelineno-30-27" id="__codelineno-30-27" name="__codelineno-30-27"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">requestCounts</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-30-28"><a href="#__codelineno-30-28" id="__codelineno-30-28" name="__codelineno-30-28"></a>
</span><span id="__span-30-29"><a href="#__codelineno-30-29" id="__codelineno-30-29" name="__codelineno-30-29"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span><span class="w"> </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-30"><a href="#__codelineno-30-30" id="__codelineno-30-30" name="__codelineno-30-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">baseUrl</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span><span class="w"> </span><span class="s1">''</span><span class="p">);</span><span class="w"> </span><span class="c1">// Remove trailing slash</span>
</span><span id="__span-30-31"><a href="#__codelineno-30-31" id="__codelineno-30-31" name="__codelineno-30-31"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">apiKey</span><span class="p">;</span>
</span><span id="__span-30-32"><a href="#__codelineno-30-32" id="__codelineno-30-32" name="__codelineno-30-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="p">;</span>
</span><span id="__span-30-33"><a href="#__codelineno-30-33" id="__codelineno-30-33" name="__codelineno-30-33"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cacheTTL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="p">;</span>
</span><span id="__span-30-34"><a href="#__codelineno-30-34" id="__codelineno-30-34" name="__codelineno-30-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rateLimit</span><span class="p">;</span>
</span><span id="__span-30-35"><a href="#__codelineno-30-35" id="__codelineno-30-35" name="__codelineno-30-35"></a>
</span><span id="__span-30-36"><a href="#__codelineno-30-36" id="__codelineno-30-36" name="__codelineno-30-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-30-37"><a href="#__codelineno-30-37" id="__codelineno-30-37" name="__codelineno-30-37"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-30-38"><a href="#__codelineno-30-38" id="__codelineno-30-38" name="__codelineno-30-38"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"api-resource-server"</span><span class="p">,</span>
</span><span id="__span-30-39"><a href="#__codelineno-30-39" id="__codelineno-30-39" name="__codelineno-30-39"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-30-40"><a href="#__codelineno-30-40" id="__codelineno-30-40" name="__codelineno-30-40"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-30-41"><a href="#__codelineno-30-41" id="__codelineno-30-41" name="__codelineno-30-41"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-30-42"><a href="#__codelineno-30-42" id="__codelineno-30-42" name="__codelineno-30-42"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-43"><a href="#__codelineno-30-43" id="__codelineno-30-43" name="__codelineno-30-43"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-30-44"><a href="#__codelineno-30-44" id="__codelineno-30-44" name="__codelineno-30-44"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-45"><a href="#__codelineno-30-45" id="__codelineno-30-45" name="__codelineno-30-45"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-46"><a href="#__codelineno-30-46" id="__codelineno-30-46" name="__codelineno-30-46"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-30-47"><a href="#__codelineno-30-47" id="__codelineno-30-47" name="__codelineno-30-47"></a>
</span><span id="__span-30-48"><a href="#__codelineno-30-48" id="__codelineno-30-48" name="__codelineno-30-48"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-30-49"><a href="#__codelineno-30-49" id="__codelineno-30-49" name="__codelineno-30-49"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-30-50"><a href="#__codelineno-30-50" id="__codelineno-30-50" name="__codelineno-30-50"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">startCacheCleanup</span><span class="p">();</span>
</span><span id="__span-30-51"><a href="#__codelineno-30-51" id="__codelineno-30-51" name="__codelineno-30-51"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-52"><a href="#__codelineno-30-52" id="__codelineno-30-52" name="__codelineno-30-52"></a>
</span><span id="__span-30-53"><a href="#__codelineno-30-53" id="__codelineno-30-53" name="__codelineno-30-53"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-54"><a href="#__codelineno-30-54" id="__codelineno-30-54" name="__codelineno-30-54"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-55"><a href="#__codelineno-30-55" id="__codelineno-30-55" name="__codelineno-30-55"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-56"><a href="#__codelineno-30-56" id="__codelineno-30-56" name="__codelineno-30-56"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-57"><a href="#__codelineno-30-57" id="__codelineno-30-57" name="__codelineno-30-57"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://users/{userId}"</span><span class="p">,</span>
</span><span id="__span-30-58"><a href="#__codelineno-30-58" id="__codelineno-30-58" name="__codelineno-30-58"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"User Profile"</span><span class="p">,</span>
</span><span id="__span-30-59"><a href="#__codelineno-30-59" id="__codelineno-30-59" name="__codelineno-30-59"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"User profile data from API"</span><span class="p">,</span>
</span><span id="__span-30-60"><a href="#__codelineno-30-60" id="__codelineno-30-60" name="__codelineno-30-60"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-61"><a href="#__codelineno-30-61" id="__codelineno-30-61" name="__codelineno-30-61"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-62"><a href="#__codelineno-30-62" id="__codelineno-30-62" name="__codelineno-30-62"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-63"><a href="#__codelineno-30-63" id="__codelineno-30-63" name="__codelineno-30-63"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://posts/{postId}"</span><span class="p">,</span>
</span><span id="__span-30-64"><a href="#__codelineno-30-64" id="__codelineno-30-64" name="__codelineno-30-64"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Post Details"</span><span class="p">,</span>
</span><span id="__span-30-65"><a href="#__codelineno-30-65" id="__codelineno-30-65" name="__codelineno-30-65"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Post details from API"</span><span class="p">,</span>
</span><span id="__span-30-66"><a href="#__codelineno-30-66" id="__codelineno-30-66" name="__codelineno-30-66"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-67"><a href="#__codelineno-30-67" id="__codelineno-30-67" name="__codelineno-30-67"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-68"><a href="#__codelineno-30-68" id="__codelineno-30-68" name="__codelineno-30-68"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-69"><a href="#__codelineno-30-69" id="__codelineno-30-69" name="__codelineno-30-69"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://search?q={query}&amp;type={type}"</span><span class="p">,</span>
</span><span id="__span-30-70"><a href="#__codelineno-30-70" id="__codelineno-30-70" name="__codelineno-30-70"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Search Results"</span><span class="p">,</span>
</span><span id="__span-30-71"><a href="#__codelineno-30-71" id="__codelineno-30-71" name="__codelineno-30-71"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Search API results"</span><span class="p">,</span>
</span><span id="__span-30-72"><a href="#__codelineno-30-72" id="__codelineno-30-72" name="__codelineno-30-72"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-73"><a href="#__codelineno-30-73" id="__codelineno-30-73" name="__codelineno-30-73"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-74"><a href="#__codelineno-30-74" id="__codelineno-30-74" name="__codelineno-30-74"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-30-75"><a href="#__codelineno-30-75" id="__codelineno-30-75" name="__codelineno-30-75"></a>
</span><span id="__span-30-76"><a href="#__codelineno-30-76" id="__codelineno-30-76" name="__codelineno-30-76"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-77"><a href="#__codelineno-30-77" id="__codelineno-30-77" name="__codelineno-30-77"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-78"><a href="#__codelineno-30-78" id="__codelineno-30-78" name="__codelineno-30-78"></a>
</span><span id="__span-30-79"><a href="#__codelineno-30-79" id="__codelineno-30-79" name="__codelineno-30-79"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-80"><a href="#__codelineno-30-80" id="__codelineno-30-80" name="__codelineno-30-80"></a><span class="w">      </span><span class="c1">// For demonstration, we'll provide some example resources</span>
</span><span id="__span-30-81"><a href="#__codelineno-30-81" id="__codelineno-30-81" name="__codelineno-30-81"></a><span class="w">      </span><span class="c1">// In a real implementation, you might fetch these from the API</span>
</span><span id="__span-30-82"><a href="#__codelineno-30-82" id="__codelineno-30-82" name="__codelineno-30-82"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-83"><a href="#__codelineno-30-83" id="__codelineno-30-83" name="__codelineno-30-83"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-84"><a href="#__codelineno-30-84" id="__codelineno-30-84" name="__codelineno-30-84"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://status"</span><span class="p">,</span>
</span><span id="__span-30-85"><a href="#__codelineno-30-85" id="__codelineno-30-85" name="__codelineno-30-85"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"API Status"</span><span class="p">,</span>
</span><span id="__span-30-86"><a href="#__codelineno-30-86" id="__codelineno-30-86" name="__codelineno-30-86"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Current API status and health"</span><span class="p">,</span>
</span><span id="__span-30-87"><a href="#__codelineno-30-87" id="__codelineno-30-87" name="__codelineno-30-87"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-88"><a href="#__codelineno-30-88" id="__codelineno-30-88" name="__codelineno-30-88"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-89"><a href="#__codelineno-30-89" id="__codelineno-30-89" name="__codelineno-30-89"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-90"><a href="#__codelineno-30-90" id="__codelineno-30-90" name="__codelineno-30-90"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://info"</span><span class="p">,</span>
</span><span id="__span-30-91"><a href="#__codelineno-30-91" id="__codelineno-30-91" name="__codelineno-30-91"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"API Information"</span><span class="p">,</span>
</span><span id="__span-30-92"><a href="#__codelineno-30-92" id="__codelineno-30-92" name="__codelineno-30-92"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"API metadata and capabilities"</span><span class="p">,</span>
</span><span id="__span-30-93"><a href="#__codelineno-30-93" id="__codelineno-30-93" name="__codelineno-30-93"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-94"><a href="#__codelineno-30-94" id="__codelineno-30-94" name="__codelineno-30-94"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-95"><a href="#__codelineno-30-95" id="__codelineno-30-95" name="__codelineno-30-95"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-30-96"><a href="#__codelineno-30-96" id="__codelineno-30-96" name="__codelineno-30-96"></a>
</span><span id="__span-30-97"><a href="#__codelineno-30-97" id="__codelineno-30-97" name="__codelineno-30-97"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-98"><a href="#__codelineno-30-98" id="__codelineno-30-98" name="__codelineno-30-98"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-99"><a href="#__codelineno-30-99" id="__codelineno-30-99" name="__codelineno-30-99"></a>
</span><span id="__span-30-100"><a href="#__codelineno-30-100" id="__codelineno-30-100" name="__codelineno-30-100"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-101"><a href="#__codelineno-30-101" id="__codelineno-30-101" name="__codelineno-30-101"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-30-102"><a href="#__codelineno-30-102" id="__codelineno-30-102" name="__codelineno-30-102"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">fetchAPIResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-103"><a href="#__codelineno-30-103" id="__codelineno-30-103" name="__codelineno-30-103"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-104"><a href="#__codelineno-30-104" id="__codelineno-30-104" name="__codelineno-30-104"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-105"><a href="#__codelineno-30-105" id="__codelineno-30-105" name="__codelineno-30-105"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-106"><a href="#__codelineno-30-106" id="__codelineno-30-106" name="__codelineno-30-106"></a>
</span><span id="__span-30-107"><a href="#__codelineno-30-107" id="__codelineno-30-107" name="__codelineno-30-107"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">fetchAPIResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-108"><a href="#__codelineno-30-108" id="__codelineno-30-108" name="__codelineno-30-108"></a><span class="w">    </span><span class="c1">// Check rate limit</span>
</span><span id="__span-30-109"><a href="#__codelineno-30-109" id="__codelineno-30-109" name="__codelineno-30-109"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">checkRateLimit</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-110"><a href="#__codelineno-30-110" id="__codelineno-30-110" name="__codelineno-30-110"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">"Rate limit exceeded. Please try again later."</span><span class="p">);</span>
</span><span id="__span-30-111"><a href="#__codelineno-30-111" id="__codelineno-30-111" name="__codelineno-30-111"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-112"><a href="#__codelineno-30-112" id="__codelineno-30-112" name="__codelineno-30-112"></a>
</span><span id="__span-30-113"><a href="#__codelineno-30-113" id="__codelineno-30-113" name="__codelineno-30-113"></a><span class="w">    </span><span class="c1">// Check cache first</span>
</span><span id="__span-30-114"><a href="#__codelineno-30-114" id="__codelineno-30-114" name="__codelineno-30-114"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-115"><a href="#__codelineno-30-115" id="__codelineno-30-115" name="__codelineno-30-115"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getCached</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-116"><a href="#__codelineno-30-116" id="__codelineno-30-116" name="__codelineno-30-116"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-117"><a href="#__codelineno-30-117" id="__codelineno-30-117" name="__codelineno-30-117"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-118"><a href="#__codelineno-30-118" id="__codelineno-30-118" name="__codelineno-30-118"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-30-119"><a href="#__codelineno-30-119" id="__codelineno-30-119" name="__codelineno-30-119"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-120"><a href="#__codelineno-30-120" id="__codelineno-30-120" name="__codelineno-30-120"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-30-121"><a href="#__codelineno-30-121" id="__codelineno-30-121" name="__codelineno-30-121"></a><span class="w">            </span><span class="p">...</span><span class="nx">cached</span><span class="p">,</span>
</span><span id="__span-30-122"><a href="#__codelineno-30-122" id="__codelineno-30-122" name="__codelineno-30-122"></a><span class="w">            </span><span class="nx">cached</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-30-123"><a href="#__codelineno-30-123" id="__codelineno-30-123" name="__codelineno-30-123"></a><span class="w">            </span><span class="nx">cacheAge</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">_cacheTimestamp</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">),</span>
</span><span id="__span-30-124"><a href="#__codelineno-30-124" id="__codelineno-30-124" name="__codelineno-30-124"></a><span class="w">          </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-30-125"><a href="#__codelineno-30-125" id="__codelineno-30-125" name="__codelineno-30-125"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-30-126"><a href="#__codelineno-30-126" id="__codelineno-30-126" name="__codelineno-30-126"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-127"><a href="#__codelineno-30-127" id="__codelineno-30-127" name="__codelineno-30-127"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-128"><a href="#__codelineno-30-128" id="__codelineno-30-128" name="__codelineno-30-128"></a>
</span><span id="__span-30-129"><a href="#__codelineno-30-129" id="__codelineno-30-129" name="__codelineno-30-129"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-130"><a href="#__codelineno-30-130" id="__codelineno-30-130" name="__codelineno-30-130"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">apiPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">uriToAPIPath</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-131"><a href="#__codelineno-30-131" id="__codelineno-30-131" name="__codelineno-30-131"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}${</span><span class="nx">apiPath</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-132"><a href="#__codelineno-30-132" id="__codelineno-30-132" name="__codelineno-30-132"></a>
</span><span id="__span-30-133"><a href="#__codelineno-30-133" id="__codelineno-30-133" name="__codelineno-30-133"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-134"><a href="#__codelineno-30-134" id="__codelineno-30-134" name="__codelineno-30-134"></a><span class="w">        </span><span class="s1">'User-Agent'</span><span class="o">:</span><span class="w"> </span><span class="s1">'MCP-API-Resource-Server/1.0'</span><span class="p">,</span>
</span><span id="__span-30-135"><a href="#__codelineno-30-135" id="__codelineno-30-135" name="__codelineno-30-135"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-136"><a href="#__codelineno-30-136" id="__codelineno-30-136" name="__codelineno-30-136"></a>
</span><span id="__span-30-137"><a href="#__codelineno-30-137" id="__codelineno-30-137" name="__codelineno-30-137"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-138"><a href="#__codelineno-30-138" id="__codelineno-30-138" name="__codelineno-30-138"></a><span class="w">        </span><span class="nx">headers</span><span class="p">[</span><span class="s1">'Authorization'</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-139"><a href="#__codelineno-30-139" id="__codelineno-30-139" name="__codelineno-30-139"></a><span class="w">        </span><span class="c1">// Or: headers['X-API-Key'] = this.apiKey;</span>
</span><span id="__span-30-140"><a href="#__codelineno-30-140" id="__codelineno-30-140" name="__codelineno-30-140"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-141"><a href="#__codelineno-30-141" id="__codelineno-30-141" name="__codelineno-30-141"></a>
</span><span id="__span-30-142"><a href="#__codelineno-30-142" id="__codelineno-30-142" name="__codelineno-30-142"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="o">:</span><span class="w"> </span><span class="kt">AxiosResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-143"><a href="#__codelineno-30-143" id="__codelineno-30-143" name="__codelineno-30-143"></a><span class="w">        </span><span class="nx">headers</span><span class="p">,</span>
</span><span id="__span-30-144"><a href="#__codelineno-30-144" id="__codelineno-30-144" name="__codelineno-30-144"></a><span class="w">        </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span><span class="p">,</span>
</span><span id="__span-30-145"><a href="#__codelineno-30-145" id="__codelineno-30-145" name="__codelineno-30-145"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-30-146"><a href="#__codelineno-30-146" id="__codelineno-30-146" name="__codelineno-30-146"></a>
</span><span id="__span-30-147"><a href="#__codelineno-30-147" id="__codelineno-30-147" name="__codelineno-30-147"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-148"><a href="#__codelineno-30-148" id="__codelineno-30-148" name="__codelineno-30-148"></a><span class="w">        </span><span class="p">...</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
</span><span id="__span-30-149"><a href="#__codelineno-30-149" id="__codelineno-30-149" name="__codelineno-30-149"></a><span class="w">        </span><span class="nx">_metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-150"><a href="#__codelineno-30-150" id="__codelineno-30-150" name="__codelineno-30-150"></a><span class="w">          </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="kt">response.status</span><span class="p">,</span>
</span><span id="__span-30-151"><a href="#__codelineno-30-151" id="__codelineno-30-151" name="__codelineno-30-151"></a><span class="w">          </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">url</span><span class="p">,</span>
</span><span id="__span-30-152"><a href="#__codelineno-30-152" id="__codelineno-30-152" name="__codelineno-30-152"></a><span class="w">          </span><span class="nx">fetchedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-30-153"><a href="#__codelineno-30-153" id="__codelineno-30-153" name="__codelineno-30-153"></a><span class="w">          </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="kt">response.headers</span><span class="p">[</span><span class="s1">'content-type'</span><span class="p">],</span>
</span><span id="__span-30-154"><a href="#__codelineno-30-154" id="__codelineno-30-154" name="__codelineno-30-154"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-155"><a href="#__codelineno-30-155" id="__codelineno-30-155" name="__codelineno-30-155"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-156"><a href="#__codelineno-30-156" id="__codelineno-30-156" name="__codelineno-30-156"></a>
</span><span id="__span-30-157"><a href="#__codelineno-30-157" id="__codelineno-30-157" name="__codelineno-30-157"></a><span class="w">      </span><span class="c1">// Cache the response</span>
</span><span id="__span-30-158"><a href="#__codelineno-30-158" id="__codelineno-30-158" name="__codelineno-30-158"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-159"><a href="#__codelineno-30-159" id="__codelineno-30-159" name="__codelineno-30-159"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setCache</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-30-160"><a href="#__codelineno-30-160" id="__codelineno-30-160" name="__codelineno-30-160"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-161"><a href="#__codelineno-30-161" id="__codelineno-30-161" name="__codelineno-30-161"></a>
</span><span id="__span-30-162"><a href="#__codelineno-30-162" id="__codelineno-30-162" name="__codelineno-30-162"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-163"><a href="#__codelineno-30-163" id="__codelineno-30-163" name="__codelineno-30-163"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-30-164"><a href="#__codelineno-30-164" id="__codelineno-30-164" name="__codelineno-30-164"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-30-165"><a href="#__codelineno-30-165" id="__codelineno-30-165" name="__codelineno-30-165"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-30-166"><a href="#__codelineno-30-166" id="__codelineno-30-166" name="__codelineno-30-166"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-167"><a href="#__codelineno-30-167" id="__codelineno-30-167" name="__codelineno-30-167"></a>
</span><span id="__span-30-168"><a href="#__codelineno-30-168" id="__codelineno-30-168" name="__codelineno-30-168"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-169"><a href="#__codelineno-30-169" id="__codelineno-30-169" name="__codelineno-30-169"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">isAxiosError</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-170"><a href="#__codelineno-30-170" id="__codelineno-30-170" name="__codelineno-30-170"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-171"><a href="#__codelineno-30-171" id="__codelineno-30-171" name="__codelineno-30-171"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`API Error </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-172"><a href="#__codelineno-30-172" id="__codelineno-30-172" name="__codelineno-30-172"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'ECONNREFUSED'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-173"><a href="#__codelineno-30-173" id="__codelineno-30-173" name="__codelineno-30-173"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Cannot connect to API: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-174"><a href="#__codelineno-30-174" id="__codelineno-30-174" name="__codelineno-30-174"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-175"><a href="#__codelineno-30-175" id="__codelineno-30-175" name="__codelineno-30-175"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Network error: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-176"><a href="#__codelineno-30-176" id="__codelineno-30-176" name="__codelineno-30-176"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-177"><a href="#__codelineno-30-177" id="__codelineno-30-177" name="__codelineno-30-177"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-178"><a href="#__codelineno-30-178" id="__codelineno-30-178" name="__codelineno-30-178"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch API resource: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">'Unknown error'</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-179"><a href="#__codelineno-30-179" id="__codelineno-30-179" name="__codelineno-30-179"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-180"><a href="#__codelineno-30-180" id="__codelineno-30-180" name="__codelineno-30-180"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-181"><a href="#__codelineno-30-181" id="__codelineno-30-181" name="__codelineno-30-181"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-182"><a href="#__codelineno-30-182" id="__codelineno-30-182" name="__codelineno-30-182"></a>
</span><span id="__span-30-183"><a href="#__codelineno-30-183" id="__codelineno-30-183" name="__codelineno-30-183"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">uriToAPIPath</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-184"><a href="#__codelineno-30-184" id="__codelineno-30-184" name="__codelineno-30-184"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'api://'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-185"><a href="#__codelineno-30-185" id="__codelineno-30-185" name="__codelineno-30-185"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid API URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-186"><a href="#__codelineno-30-186" id="__codelineno-30-186" name="__codelineno-30-186"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-187"><a href="#__codelineno-30-187" id="__codelineno-30-187" name="__codelineno-30-187"></a>
</span><span id="__span-30-188"><a href="#__codelineno-30-188" id="__codelineno-30-188" name="__codelineno-30-188"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'api://'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-189"><a href="#__codelineno-30-189" id="__codelineno-30-189" name="__codelineno-30-189"></a>
</span><span id="__span-30-190"><a href="#__codelineno-30-190" id="__codelineno-30-190" name="__codelineno-30-190"></a><span class="w">    </span><span class="c1">// Handle special cases</span>
</span><span id="__span-30-191"><a href="#__codelineno-30-191" id="__codelineno-30-191" name="__codelineno-30-191"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'status'</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">'/status'</span><span class="p">;</span>
</span><span id="__span-30-192"><a href="#__codelineno-30-192" id="__codelineno-30-192" name="__codelineno-30-192"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'info'</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">'/info'</span><span class="p">;</span>
</span><span id="__span-30-193"><a href="#__codelineno-30-193" id="__codelineno-30-193" name="__codelineno-30-193"></a>
</span><span id="__span-30-194"><a href="#__codelineno-30-194" id="__codelineno-30-194" name="__codelineno-30-194"></a><span class="w">    </span><span class="c1">// Handle template URIs</span>
</span><span id="__span-30-195"><a href="#__codelineno-30-195" id="__codelineno-30-195" name="__codelineno-30-195"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'users/'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-196"><a href="#__codelineno-30-196" id="__codelineno-30-196" name="__codelineno-30-196"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'users/'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-197"><a href="#__codelineno-30-197" id="__codelineno-30-197" name="__codelineno-30-197"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-198"><a href="#__codelineno-30-198" id="__codelineno-30-198" name="__codelineno-30-198"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-199"><a href="#__codelineno-30-199" id="__codelineno-30-199" name="__codelineno-30-199"></a>
</span><span id="__span-30-200"><a href="#__codelineno-30-200" id="__codelineno-30-200" name="__codelineno-30-200"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'posts/'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-201"><a href="#__codelineno-30-201" id="__codelineno-30-201" name="__codelineno-30-201"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">postId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'posts/'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-202"><a href="#__codelineno-30-202" id="__codelineno-30-202" name="__codelineno-30-202"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/posts/</span><span class="si">${</span><span class="nx">postId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-203"><a href="#__codelineno-30-203" id="__codelineno-30-203" name="__codelineno-30-203"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-204"><a href="#__codelineno-30-204" id="__codelineno-30-204" name="__codelineno-30-204"></a>
</span><span id="__span-30-205"><a href="#__codelineno-30-205" id="__codelineno-30-205" name="__codelineno-30-205"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'search?'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-206"><a href="#__codelineno-30-206" id="__codelineno-30-206" name="__codelineno-30-206"></a><span class="w">      </span><span class="c1">// Convert query parameters</span>
</span><span id="__span-30-207"><a href="#__codelineno-30-207" id="__codelineno-30-207" name="__codelineno-30-207"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">queryString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'search?'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-208"><a href="#__codelineno-30-208" id="__codelineno-30-208" name="__codelineno-30-208"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/search?</span><span class="si">${</span><span class="nx">queryString</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-209"><a href="#__codelineno-30-209" id="__codelineno-30-209" name="__codelineno-30-209"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-210"><a href="#__codelineno-30-210" id="__codelineno-30-210" name="__codelineno-30-210"></a>
</span><span id="__span-30-211"><a href="#__codelineno-30-211" id="__codelineno-30-211" name="__codelineno-30-211"></a><span class="w">    </span><span class="c1">// Default: use path as-is</span>
</span><span id="__span-30-212"><a href="#__codelineno-30-212" id="__codelineno-30-212" name="__codelineno-30-212"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`/</span><span class="si">${</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-213"><a href="#__codelineno-30-213" id="__codelineno-30-213" name="__codelineno-30-213"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-214"><a href="#__codelineno-30-214" id="__codelineno-30-214" name="__codelineno-30-214"></a>
</span><span id="__span-30-215"><a href="#__codelineno-30-215" id="__codelineno-30-215" name="__codelineno-30-215"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">checkRateLimit</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-216"><a href="#__codelineno-30-216" id="__codelineno-30-216" name="__codelineno-30-216"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-30-217"><a href="#__codelineno-30-217" id="__codelineno-30-217" name="__codelineno-30-217"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 minute</span>
</span><span id="__span-30-218"><a href="#__codelineno-30-218" id="__codelineno-30-218" name="__codelineno-30-218"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'global'</span><span class="p">;</span><span class="w"> </span><span class="c1">// In a real app, use user/session ID</span>
</span><span id="__span-30-219"><a href="#__codelineno-30-219" id="__codelineno-30-219" name="__codelineno-30-219"></a>
</span><span id="__span-30-220"><a href="#__codelineno-30-220" id="__codelineno-30-220" name="__codelineno-30-220"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">requestCounts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-30-221"><a href="#__codelineno-30-221" id="__codelineno-30-221" name="__codelineno-30-221"></a>
</span><span id="__span-30-222"><a href="#__codelineno-30-222" id="__codelineno-30-222" name="__codelineno-30-222"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">resetTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-223"><a href="#__codelineno-30-223" id="__codelineno-30-223" name="__codelineno-30-223"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">requestCounts</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">now</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-30-224"><a href="#__codelineno-30-224" id="__codelineno-30-224" name="__codelineno-30-224"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-30-225"><a href="#__codelineno-30-225" id="__codelineno-30-225" name="__codelineno-30-225"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-226"><a href="#__codelineno-30-226" id="__codelineno-30-226" name="__codelineno-30-226"></a>
</span><span id="__span-30-227"><a href="#__codelineno-30-227" id="__codelineno-30-227" name="__codelineno-30-227"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-228"><a href="#__codelineno-30-228" id="__codelineno-30-228" name="__codelineno-30-228"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-30-229"><a href="#__codelineno-30-229" id="__codelineno-30-229" name="__codelineno-30-229"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-230"><a href="#__codelineno-30-230" id="__codelineno-30-230" name="__codelineno-30-230"></a>
</span><span id="__span-30-231"><a href="#__codelineno-30-231" id="__codelineno-30-231" name="__codelineno-30-231"></a><span class="w">    </span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-30-232"><a href="#__codelineno-30-232" id="__codelineno-30-232" name="__codelineno-30-232"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-30-233"><a href="#__codelineno-30-233" id="__codelineno-30-233" name="__codelineno-30-233"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-234"><a href="#__codelineno-30-234" id="__codelineno-30-234" name="__codelineno-30-234"></a>
</span><span id="__span-30-235"><a href="#__codelineno-30-235" id="__codelineno-30-235" name="__codelineno-30-235"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getCached</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-236"><a href="#__codelineno-30-236" id="__codelineno-30-236" name="__codelineno-30-236"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-237"><a href="#__codelineno-30-237" id="__codelineno-30-237" name="__codelineno-30-237"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-30-238"><a href="#__codelineno-30-238" id="__codelineno-30-238" name="__codelineno-30-238"></a>
</span><span id="__span-30-239"><a href="#__codelineno-30-239" id="__codelineno-30-239" name="__codelineno-30-239"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">ttl</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-240"><a href="#__codelineno-30-240" id="__codelineno-30-240" name="__codelineno-30-240"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-241"><a href="#__codelineno-30-241" id="__codelineno-30-241" name="__codelineno-30-241"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-30-242"><a href="#__codelineno-30-242" id="__codelineno-30-242" name="__codelineno-30-242"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-243"><a href="#__codelineno-30-243" id="__codelineno-30-243" name="__codelineno-30-243"></a>
</span><span id="__span-30-244"><a href="#__codelineno-30-244" id="__codelineno-30-244" name="__codelineno-30-244"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span id="__span-30-245"><a href="#__codelineno-30-245" id="__codelineno-30-245" name="__codelineno-30-245"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-246"><a href="#__codelineno-30-246" id="__codelineno-30-246" name="__codelineno-30-246"></a>
</span><span id="__span-30-247"><a href="#__codelineno-30-247" id="__codelineno-30-247" name="__codelineno-30-247"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setCache</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-248"><a href="#__codelineno-30-248" id="__codelineno-30-248" name="__codelineno-30-248"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-249"><a href="#__codelineno-30-249" id="__codelineno-30-249" name="__codelineno-30-249"></a><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">_cacheTimestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-30-250"><a href="#__codelineno-30-250" id="__codelineno-30-250" name="__codelineno-30-250"></a><span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
</span><span id="__span-30-251"><a href="#__codelineno-30-251" id="__codelineno-30-251" name="__codelineno-30-251"></a><span class="w">      </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="kt">this.cacheTTL</span><span class="p">,</span>
</span><span id="__span-30-252"><a href="#__codelineno-30-252" id="__codelineno-30-252" name="__codelineno-30-252"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-253"><a href="#__codelineno-30-253" id="__codelineno-30-253" name="__codelineno-30-253"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-254"><a href="#__codelineno-30-254" id="__codelineno-30-254" name="__codelineno-30-254"></a>
</span><span id="__span-30-255"><a href="#__codelineno-30-255" id="__codelineno-30-255" name="__codelineno-30-255"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">startCacheCleanup</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-256"><a href="#__codelineno-30-256" id="__codelineno-30-256" name="__codelineno-30-256"></a><span class="w">    </span><span class="c1">// Clean up expired cache entries every 5 minutes</span>
</span><span id="__span-30-257"><a href="#__codelineno-30-257" id="__codelineno-30-257" name="__codelineno-30-257"></a><span class="w">    </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-258"><a href="#__codelineno-30-258" id="__codelineno-30-258" name="__codelineno-30-258"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-30-259"><a href="#__codelineno-30-259" id="__codelineno-30-259" name="__codelineno-30-259"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-260"><a href="#__codelineno-30-260" id="__codelineno-30-260" name="__codelineno-30-260"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">ttl</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-261"><a href="#__codelineno-30-261" id="__codelineno-30-261" name="__codelineno-30-261"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-262"><a href="#__codelineno-30-262" id="__codelineno-30-262" name="__codelineno-30-262"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-263"><a href="#__codelineno-30-263" id="__codelineno-30-263" name="__codelineno-30-263"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-264"><a href="#__codelineno-30-264" id="__codelineno-30-264" name="__codelineno-30-264"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-30-265"><a href="#__codelineno-30-265" id="__codelineno-30-265" name="__codelineno-30-265"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-266"><a href="#__codelineno-30-266" id="__codelineno-30-266" name="__codelineno-30-266"></a>
</span><span id="__span-30-267"><a href="#__codelineno-30-267" id="__codelineno-30-267" name="__codelineno-30-267"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-268"><a href="#__codelineno-30-268" id="__codelineno-30-268" name="__codelineno-30-268"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-269"><a href="#__codelineno-30-269" id="__codelineno-30-269" name="__codelineno-30-269"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-30-270"><a href="#__codelineno-30-270" id="__codelineno-30-270" name="__codelineno-30-270"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-30-271"><a href="#__codelineno-30-271" id="__codelineno-30-271" name="__codelineno-30-271"></a>
</span><span id="__span-30-272"><a href="#__codelineno-30-272" id="__codelineno-30-272" name="__codelineno-30-272"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-273"><a href="#__codelineno-30-273" id="__codelineno-30-273" name="__codelineno-30-273"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-30-274"><a href="#__codelineno-30-274" id="__codelineno-30-274" name="__codelineno-30-274"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-30-275"><a href="#__codelineno-30-275" id="__codelineno-30-275" name="__codelineno-30-275"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-276"><a href="#__codelineno-30-276" id="__codelineno-30-276" name="__codelineno-30-276"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-277"><a href="#__codelineno-30-277" id="__codelineno-30-277" name="__codelineno-30-277"></a>
</span><span id="__span-30-278"><a href="#__codelineno-30-278" id="__codelineno-30-278" name="__codelineno-30-278"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-279"><a href="#__codelineno-30-279" id="__codelineno-30-279" name="__codelineno-30-279"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-30-280"><a href="#__codelineno-30-280" id="__codelineno-30-280" name="__codelineno-30-280"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-30-281"><a href="#__codelineno-30-281" id="__codelineno-30-281" name="__codelineno-30-281"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`API Resource Server running (API: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-30-282"><a href="#__codelineno-30-282" id="__codelineno-30-282" name="__codelineno-30-282"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-283"><a href="#__codelineno-30-283" id="__codelineno-30-283" name="__codelineno-30-283"></a><span class="p">}</span>
</span><span id="__span-30-284"><a href="#__codelineno-30-284" id="__codelineno-30-284" name="__codelineno-30-284"></a>
</span><span id="__span-30-285"><a href="#__codelineno-30-285" id="__codelineno-30-285" name="__codelineno-30-285"></a><span class="c1">// Main entry point</span>
</span><span id="__span-30-286"><a href="#__codelineno-30-286" id="__codelineno-30-286" name="__codelineno-30-286"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-287"><a href="#__codelineno-30-287" id="__codelineno-30-287" name="__codelineno-30-287"></a><span class="w">  </span><span class="c1">// Example: JSONPlaceholder API</span>
</span><span id="__span-30-288"><a href="#__codelineno-30-288" id="__codelineno-30-288" name="__codelineno-30-288"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">APIResourceServer</span><span class="p">(</span><span class="s1">'https://jsonplaceholder.typicode.com'</span><span class="p">);</span>
</span><span id="__span-30-289"><a href="#__codelineno-30-289" id="__codelineno-30-289" name="__codelineno-30-289"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-30-290"><a href="#__codelineno-30-290" id="__codelineno-30-290" name="__codelineno-30-290"></a><span class="p">}</span>
</span><span id="__span-30-291"><a href="#__codelineno-30-291" id="__codelineno-30-291" name="__codelineno-30-291"></a>
</span><span id="__span-30-292"><a href="#__codelineno-30-292" id="__codelineno-30-292" name="__codelineno-30-292"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-293"><a href="#__codelineno-30-293" id="__codelineno-30-293" name="__codelineno-30-293"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-30-294"><a href="#__codelineno-30-294" id="__codelineno-30-294" name="__codelineno-30-294"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-30-295"><a href="#__codelineno-30-295" id="__codelineno-30-295" name="__codelineno-30-295"></a><span class="p">});</span>
</span></code></pre></div> Testing - Test the server with the JSONPlaceholder API: <div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a href="#__codelineno-31-1" id="__codelineno-31-1" name="__codelineno-31-1"></a><span class="c1"># Start the server</span>
</span><span id="__span-31-2"><a href="#__codelineno-31-2" id="__codelineno-31-2" name="__codelineno-31-2"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div> Test these resources in the MCP Inspector: <div class="language-javascript highlight"><pre><span></span><code><span id="__span-32-1"><a href="#__codelineno-32-1" id="__codelineno-32-1" name="__codelineno-32-1"></a><span class="c1">// API status</span>
</span><span id="__span-32-2"><a href="#__codelineno-32-2" id="__codelineno-32-2" name="__codelineno-32-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://status"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-3"><a href="#__codelineno-32-3" id="__codelineno-32-3" name="__codelineno-32-3"></a>
</span><span id="__span-32-4"><a href="#__codelineno-32-4" id="__codelineno-32-4" name="__codelineno-32-4"></a><span class="c1">// API info</span>
</span><span id="__span-32-5"><a href="#__codelineno-32-5" id="__codelineno-32-5" name="__codelineno-32-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://info"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-6"><a href="#__codelineno-32-6" id="__codelineno-32-6" name="__codelineno-32-6"></a>
</span><span id="__span-32-7"><a href="#__codelineno-32-7" id="__codelineno-32-7" name="__codelineno-32-7"></a><span class="c1">// User profiles (using templates)</span>
</span><span id="__span-32-8"><a href="#__codelineno-32-8" id="__codelineno-32-8" name="__codelineno-32-8"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://users/1"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-9"><a href="#__codelineno-32-9" id="__codelineno-32-9" name="__codelineno-32-9"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://users/2"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-10"><a href="#__codelineno-32-10" id="__codelineno-32-10" name="__codelineno-32-10"></a>
</span><span id="__span-32-11"><a href="#__codelineno-32-11" id="__codelineno-32-11" name="__codelineno-32-11"></a><span class="c1">// Posts</span>
</span><span id="__span-32-12"><a href="#__codelineno-32-12" id="__codelineno-32-12" name="__codelineno-32-12"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://posts/1"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-13"><a href="#__codelineno-32-13" id="__codelineno-32-13" name="__codelineno-32-13"></a>
</span><span id="__span-32-14"><a href="#__codelineno-32-14" id="__codelineno-32-14" name="__codelineno-32-14"></a><span class="c1">// Search (if supported by API)</span>
</span><span id="__span-32-15"><a href="#__codelineno-32-15" id="__codelineno-32-15" name="__codelineno-32-15"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"api://search?q=lorem&amp;type=post"</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div> </details> <h3 id="exercise-3-database-resource-server">Exercise 3: Database Resource Server<a class="headerlink" href="#exercise-3-database-resource-server" title="Permanent link">¶</a></h3> <p>Create a tool that:</p> <ul> <li>Exposes database tables as resources</li> <li>Supports parameterized queries via URI templates</li> <li>Implements read-only access for security</li> <li>Provides metadata about table schemas</li> </ul> <details> <summary>💡 Solution: Database Resource Server</summary> Tool Schema - Add this to your tools array: <div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a href="#__codelineno-33-1" id="__codelineno-33-1" name="__codelineno-33-1"></a><span class="p">{</span>
</span><span id="__span-33-2"><a href="#__codelineno-33-2" id="__codelineno-33-2" name="__codelineno-33-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"create_database_resource_server"</span><span class="p">,</span>
</span><span id="__span-33-3"><a href="#__codelineno-33-3" id="__codelineno-33-3" name="__codelineno-33-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Create an MCP server that exposes database tables as resources"</span><span class="p">,</span>
</span><span id="__span-33-4"><a href="#__codelineno-33-4" id="__codelineno-33-4" name="__codelineno-33-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-5"><a href="#__codelineno-33-5" id="__codelineno-33-5" name="__codelineno-33-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">,</span>
</span><span id="__span-33-6"><a href="#__codelineno-33-6" id="__codelineno-33-6" name="__codelineno-33-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-7"><a href="#__codelineno-33-7" id="__codelineno-33-7" name="__codelineno-33-7"></a><span class="w">      </span><span class="nx">databasePath</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-8"><a href="#__codelineno-33-8" id="__codelineno-33-8" name="__codelineno-33-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="p">,</span>
</span><span id="__span-33-9"><a href="#__codelineno-33-9" id="__codelineno-33-9" name="__codelineno-33-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Path to SQLite database file"</span><span class="p">,</span>
</span><span id="__span-33-10"><a href="#__codelineno-33-10" id="__codelineno-33-10" name="__codelineno-33-10"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">"./data.db"</span>
</span><span id="__span-33-11"><a href="#__codelineno-33-11" id="__codelineno-33-11" name="__codelineno-33-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-12"><a href="#__codelineno-33-12" id="__codelineno-33-12" name="__codelineno-33-12"></a><span class="w">      </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-13"><a href="#__codelineno-33-13" id="__codelineno-33-13" name="__codelineno-33-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"array"</span><span class="p">,</span>
</span><span id="__span-33-14"><a href="#__codelineno-33-14" id="__codelineno-33-14" name="__codelineno-33-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Tables to expose as resources"</span><span class="p">,</span>
</span><span id="__span-33-15"><a href="#__codelineno-33-15" id="__codelineno-33-15" name="__codelineno-33-15"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"string"</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-33-16"><a href="#__codelineno-33-16" id="__codelineno-33-16" name="__codelineno-33-16"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-33-17"><a href="#__codelineno-33-17" id="__codelineno-33-17" name="__codelineno-33-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-18"><a href="#__codelineno-33-18" id="__codelineno-33-18" name="__codelineno-33-18"></a><span class="w">      </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-19"><a href="#__codelineno-33-19" id="__codelineno-33-19" name="__codelineno-33-19"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"boolean"</span><span class="p">,</span>
</span><span id="__span-33-20"><a href="#__codelineno-33-20" id="__codelineno-33-20" name="__codelineno-33-20"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Enforce read-only access"</span><span class="p">,</span>
</span><span id="__span-33-21"><a href="#__codelineno-33-21" id="__codelineno-33-21" name="__codelineno-33-21"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-33-22"><a href="#__codelineno-33-22" id="__codelineno-33-22" name="__codelineno-33-22"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-23"><a href="#__codelineno-33-23" id="__codelineno-33-23" name="__codelineno-33-23"></a><span class="w">      </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-24"><a href="#__codelineno-33-24" id="__codelineno-33-24" name="__codelineno-33-24"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">"number"</span><span class="p">,</span>
</span><span id="__span-33-25"><a href="#__codelineno-33-25" id="__codelineno-33-25" name="__codelineno-33-25"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Maximum rows to return per query"</span><span class="p">,</span>
</span><span id="__span-33-26"><a href="#__codelineno-33-26" id="__codelineno-33-26" name="__codelineno-33-26"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span>
</span><span id="__span-33-27"><a href="#__codelineno-33-27" id="__codelineno-33-27" name="__codelineno-33-27"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-33-28"><a href="#__codelineno-33-28" id="__codelineno-33-28" name="__codelineno-33-28"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-33-29"><a href="#__codelineno-33-29" id="__codelineno-33-29" name="__codelineno-33-29"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"databasePath"</span><span class="p">]</span>
</span><span id="__span-33-30"><a href="#__codelineno-33-30" id="__codelineno-33-30" name="__codelineno-33-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-31"><a href="#__codelineno-33-31" id="__codelineno-33-31" name="__codelineno-33-31"></a><span class="p">}</span>
</span></code></pre></div> Implementation <div class="language-typescript highlight"><pre><span></span><code><span id="__span-34-1"><a href="#__codelineno-34-1" id="__codelineno-34-1" name="__codelineno-34-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-34-2"><a href="#__codelineno-34-2" id="__codelineno-34-2" name="__codelineno-34-2"></a>
</span><span id="__span-34-3"><a href="#__codelineno-34-3" id="__codelineno-34-3" name="__codelineno-34-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/index.js"</span><span class="p">;</span>
</span><span id="__span-34-4"><a href="#__codelineno-34-4" id="__codelineno-34-4" name="__codelineno-34-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/server/stdio.js"</span><span class="p">;</span>
</span><span id="__span-34-5"><a href="#__codelineno-34-5" id="__codelineno-34-5" name="__codelineno-34-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-6"><a href="#__codelineno-34-6" id="__codelineno-34-6" name="__codelineno-34-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-7"><a href="#__codelineno-34-7" id="__codelineno-34-7" name="__codelineno-34-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-8"><a href="#__codelineno-34-8" id="__codelineno-34-8" name="__codelineno-34-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-9"><a href="#__codelineno-34-9" id="__codelineno-34-9" name="__codelineno-34-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-34-10"><a href="#__codelineno-34-10" id="__codelineno-34-10" name="__codelineno-34-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">"@modelcontextprotocol/sdk/types.js"</span><span class="p">;</span>
</span><span id="__span-34-11"><a href="#__codelineno-34-11" id="__codelineno-34-11" name="__codelineno-34-11"></a><span class="k">import</span><span class="w"> </span><span class="nx">Database</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'better-sqlite3'</span><span class="p">;</span>
</span><span id="__span-34-12"><a href="#__codelineno-34-12" id="__codelineno-34-12" name="__codelineno-34-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'fs/promises'</span><span class="p">;</span>
</span><span id="__span-34-13"><a href="#__codelineno-34-13" id="__codelineno-34-13" name="__codelineno-34-13"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">'path'</span><span class="p">;</span>
</span><span id="__span-34-14"><a href="#__codelineno-34-14" id="__codelineno-34-14" name="__codelineno-34-14"></a>
</span><span id="__span-34-15"><a href="#__codelineno-34-15" id="__codelineno-34-15" name="__codelineno-34-15"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">TableInfo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-16"><a href="#__codelineno-34-16" id="__codelineno-34-16" name="__codelineno-34-16"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-17"><a href="#__codelineno-34-17" id="__codelineno-34-17" name="__codelineno-34-17"></a><span class="w">  </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
</span><span id="__span-34-18"><a href="#__codelineno-34-18" id="__codelineno-34-18" name="__codelineno-34-18"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-19"><a href="#__codelineno-34-19" id="__codelineno-34-19" name="__codelineno-34-19"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-20"><a href="#__codelineno-34-20" id="__codelineno-34-20" name="__codelineno-34-20"></a><span class="w">    </span><span class="nx">notnull</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-21"><a href="#__codelineno-34-21" id="__codelineno-34-21" name="__codelineno-34-21"></a><span class="w">    </span><span class="nx">pk</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-22"><a href="#__codelineno-34-22" id="__codelineno-34-22" name="__codelineno-34-22"></a><span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-34-23"><a href="#__codelineno-34-23" id="__codelineno-34-23" name="__codelineno-34-23"></a><span class="w">  </span><span class="nx">rowCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-24"><a href="#__codelineno-34-24" id="__codelineno-34-24" name="__codelineno-34-24"></a><span class="p">}</span>
</span><span id="__span-34-25"><a href="#__codelineno-34-25" id="__codelineno-34-25" name="__codelineno-34-25"></a>
</span><span id="__span-34-26"><a href="#__codelineno-34-26" id="__codelineno-34-26" name="__codelineno-34-26"></a><span class="kd">class</span><span class="w"> </span><span class="nx">DatabaseResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-27"><a href="#__codelineno-34-27" id="__codelineno-34-27" name="__codelineno-34-27"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-34-28"><a href="#__codelineno-34-28" id="__codelineno-34-28" name="__codelineno-34-28"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">dbPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-29"><a href="#__codelineno-34-29" id="__codelineno-34-29" name="__codelineno-34-29"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
</span><span id="__span-34-30"><a href="#__codelineno-34-30" id="__codelineno-34-30" name="__codelineno-34-30"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
</span><span id="__span-34-31"><a href="#__codelineno-34-31" id="__codelineno-34-31" name="__codelineno-34-31"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-32"><a href="#__codelineno-34-32" id="__codelineno-34-32" name="__codelineno-34-32"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">db</span><span class="o">:</span><span class="w"> </span><span class="kt">Database.Database</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-34-33"><a href="#__codelineno-34-33" id="__codelineno-34-33" name="__codelineno-34-33"></a>
</span><span id="__span-34-34"><a href="#__codelineno-34-34" id="__codelineno-34-34" name="__codelineno-34-34"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">dbPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'./data.db'</span><span class="p">,</span><span class="w"> </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-35"><a href="#__codelineno-34-35" id="__codelineno-34-35" name="__codelineno-34-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">);</span>
</span><span id="__span-34-36"><a href="#__codelineno-34-36" id="__codelineno-34-36" name="__codelineno-34-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allowedTables</span><span class="p">;</span>
</span><span id="__span-34-37"><a href="#__codelineno-34-37" id="__codelineno-34-37" name="__codelineno-34-37"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">readOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readOnly</span><span class="p">;</span>
</span><span id="__span-34-38"><a href="#__codelineno-34-38" id="__codelineno-34-38" name="__codelineno-34-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxRows</span><span class="p">;</span>
</span><span id="__span-34-39"><a href="#__codelineno-34-39" id="__codelineno-34-39" name="__codelineno-34-39"></a>
</span><span id="__span-34-40"><a href="#__codelineno-34-40" id="__codelineno-34-40" name="__codelineno-34-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-34-41"><a href="#__codelineno-34-41" id="__codelineno-34-41" name="__codelineno-34-41"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-34-42"><a href="#__codelineno-34-42" id="__codelineno-34-42" name="__codelineno-34-42"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"database-resource-server"</span><span class="p">,</span>
</span><span id="__span-34-43"><a href="#__codelineno-34-43" id="__codelineno-34-43" name="__codelineno-34-43"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">"1.0.0"</span><span class="p">,</span>
</span><span id="__span-34-44"><a href="#__codelineno-34-44" id="__codelineno-34-44" name="__codelineno-34-44"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-34-45"><a href="#__codelineno-34-45" id="__codelineno-34-45" name="__codelineno-34-45"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-34-46"><a href="#__codelineno-34-46" id="__codelineno-34-46" name="__codelineno-34-46"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-47"><a href="#__codelineno-34-47" id="__codelineno-34-47" name="__codelineno-34-47"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-34-48"><a href="#__codelineno-34-48" id="__codelineno-34-48" name="__codelineno-34-48"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-49"><a href="#__codelineno-34-49" id="__codelineno-34-49" name="__codelineno-34-49"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-50"><a href="#__codelineno-34-50" id="__codelineno-34-50" name="__codelineno-34-50"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-34-51"><a href="#__codelineno-34-51" id="__codelineno-34-51" name="__codelineno-34-51"></a>
</span><span id="__span-34-52"><a href="#__codelineno-34-52" id="__codelineno-34-52" name="__codelineno-34-52"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-34-53"><a href="#__codelineno-34-53" id="__codelineno-34-53" name="__codelineno-34-53"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-34-54"><a href="#__codelineno-34-54" id="__codelineno-34-54" name="__codelineno-34-54"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-55"><a href="#__codelineno-34-55" id="__codelineno-34-55" name="__codelineno-34-55"></a>
</span><span id="__span-34-56"><a href="#__codelineno-34-56" id="__codelineno-34-56" name="__codelineno-34-56"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-57"><a href="#__codelineno-34-57" id="__codelineno-34-57" name="__codelineno-34-57"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-58"><a href="#__codelineno-34-58" id="__codelineno-34-58" name="__codelineno-34-58"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-59"><a href="#__codelineno-34-59" id="__codelineno-34-59" name="__codelineno-34-59"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-60"><a href="#__codelineno-34-60" id="__codelineno-34-60" name="__codelineno-34-60"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/{tableName}/schema"</span><span class="p">,</span>
</span><span id="__span-34-61"><a href="#__codelineno-34-61" id="__codelineno-34-61" name="__codelineno-34-61"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Table Schema"</span><span class="p">,</span>
</span><span id="__span-34-62"><a href="#__codelineno-34-62" id="__codelineno-34-62" name="__codelineno-34-62"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Schema information for a database table"</span><span class="p">,</span>
</span><span id="__span-34-63"><a href="#__codelineno-34-63" id="__codelineno-34-63" name="__codelineno-34-63"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-64"><a href="#__codelineno-34-64" id="__codelineno-34-64" name="__codelineno-34-64"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-65"><a href="#__codelineno-34-65" id="__codelineno-34-65" name="__codelineno-34-65"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-66"><a href="#__codelineno-34-66" id="__codelineno-34-66" name="__codelineno-34-66"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/{tableName}/data?limit={limit}&amp;offset={offset}"</span><span class="p">,</span>
</span><span id="__span-34-67"><a href="#__codelineno-34-67" id="__codelineno-34-67" name="__codelineno-34-67"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Table Data"</span><span class="p">,</span>
</span><span id="__span-34-68"><a href="#__codelineno-34-68" id="__codelineno-34-68" name="__codelineno-34-68"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Data from a database table with pagination"</span><span class="p">,</span>
</span><span id="__span-34-69"><a href="#__codelineno-34-69" id="__codelineno-34-69" name="__codelineno-34-69"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-70"><a href="#__codelineno-34-70" id="__codelineno-34-70" name="__codelineno-34-70"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-71"><a href="#__codelineno-34-71" id="__codelineno-34-71" name="__codelineno-34-71"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-72"><a href="#__codelineno-34-72" id="__codelineno-34-72" name="__codelineno-34-72"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/{tableName}/records/{id}"</span><span class="p">,</span>
</span><span id="__span-34-73"><a href="#__codelineno-34-73" id="__codelineno-34-73" name="__codelineno-34-73"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Table Record"</span><span class="p">,</span>
</span><span id="__span-34-74"><a href="#__codelineno-34-74" id="__codelineno-34-74" name="__codelineno-34-74"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Specific record from a database table"</span><span class="p">,</span>
</span><span id="__span-34-75"><a href="#__codelineno-34-75" id="__codelineno-34-75" name="__codelineno-34-75"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-76"><a href="#__codelineno-34-76" id="__codelineno-34-76" name="__codelineno-34-76"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-77"><a href="#__codelineno-34-77" id="__codelineno-34-77" name="__codelineno-34-77"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-78"><a href="#__codelineno-34-78" id="__codelineno-34-78" name="__codelineno-34-78"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://query?sql={sql}&amp;params={params}"</span><span class="p">,</span>
</span><span id="__span-34-79"><a href="#__codelineno-34-79" id="__codelineno-34-79" name="__codelineno-34-79"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Custom Query"</span><span class="p">,</span>
</span><span id="__span-34-80"><a href="#__codelineno-34-80" id="__codelineno-34-80" name="__codelineno-34-80"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Execute a custom SELECT query"</span><span class="p">,</span>
</span><span id="__span-34-81"><a href="#__codelineno-34-81" id="__codelineno-34-81" name="__codelineno-34-81"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-82"><a href="#__codelineno-34-82" id="__codelineno-34-82" name="__codelineno-34-82"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-83"><a href="#__codelineno-34-83" id="__codelineno-34-83" name="__codelineno-34-83"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-34-84"><a href="#__codelineno-34-84" id="__codelineno-34-84" name="__codelineno-34-84"></a>
</span><span id="__span-34-85"><a href="#__codelineno-34-85" id="__codelineno-34-85" name="__codelineno-34-85"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-86"><a href="#__codelineno-34-86" id="__codelineno-34-86" name="__codelineno-34-86"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-87"><a href="#__codelineno-34-87" id="__codelineno-34-87" name="__codelineno-34-87"></a>
</span><span id="__span-34-88"><a href="#__codelineno-34-88" id="__codelineno-34-88" name="__codelineno-34-88"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-89"><a href="#__codelineno-34-89" id="__codelineno-34-89" name="__codelineno-34-89"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-90"><a href="#__codelineno-34-90" id="__codelineno-34-90" name="__codelineno-34-90"></a>
</span><span id="__span-34-91"><a href="#__codelineno-34-91" id="__codelineno-34-91" name="__codelineno-34-91"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-92"><a href="#__codelineno-34-92" id="__codelineno-34-92" name="__codelineno-34-92"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ensureDatabase</span><span class="p">();</span>
</span><span id="__span-34-93"><a href="#__codelineno-34-93" id="__codelineno-34-93" name="__codelineno-34-93"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-94"><a href="#__codelineno-34-94" id="__codelineno-34-94" name="__codelineno-34-94"></a>
</span><span id="__span-34-95"><a href="#__codelineno-34-95" id="__codelineno-34-95" name="__codelineno-34-95"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">tables</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-96"><a href="#__codelineno-34-96" id="__codelineno-34-96" name="__codelineno-34-96"></a><span class="w">          </span><span class="c1">// Table schema resource</span>
</span><span id="__span-34-97"><a href="#__codelineno-34-97" id="__codelineno-34-97" name="__codelineno-34-97"></a><span class="w">          </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-98"><a href="#__codelineno-34-98" id="__codelineno-34-98" name="__codelineno-34-98"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/schema`</span><span class="p">,</span>
</span><span id="__span-34-99"><a href="#__codelineno-34-99" id="__codelineno-34-99" name="__codelineno-34-99"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> Schema`</span><span class="p">,</span>
</span><span id="__span-34-100"><a href="#__codelineno-34-100" id="__codelineno-34-100" name="__codelineno-34-100"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Schema for table </span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> columns)`</span><span class="p">,</span>
</span><span id="__span-34-101"><a href="#__codelineno-34-101" id="__codelineno-34-101" name="__codelineno-34-101"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-102"><a href="#__codelineno-34-102" id="__codelineno-34-102" name="__codelineno-34-102"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-34-103"><a href="#__codelineno-34-103" id="__codelineno-34-103" name="__codelineno-34-103"></a>
</span><span id="__span-34-104"><a href="#__codelineno-34-104" id="__codelineno-34-104" name="__codelineno-34-104"></a><span class="w">          </span><span class="c1">// Table data resource</span>
</span><span id="__span-34-105"><a href="#__codelineno-34-105" id="__codelineno-34-105" name="__codelineno-34-105"></a><span class="w">          </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-106"><a href="#__codelineno-34-106" id="__codelineno-34-106" name="__codelineno-34-106"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/data?limit=100`</span><span class="p">,</span>
</span><span id="__span-34-107"><a href="#__codelineno-34-107" id="__codelineno-34-107" name="__codelineno-34-107"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> Data`</span><span class="p">,</span>
</span><span id="__span-34-108"><a href="#__codelineno-34-108" id="__codelineno-34-108" name="__codelineno-34-108"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Data from table </span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">rowCount</span><span class="si">}</span><span class="sb"> rows)`</span><span class="p">,</span>
</span><span id="__span-34-109"><a href="#__codelineno-34-109" id="__codelineno-34-109" name="__codelineno-34-109"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-110"><a href="#__codelineno-34-110" id="__codelineno-34-110" name="__codelineno-34-110"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-34-111"><a href="#__codelineno-34-111" id="__codelineno-34-111" name="__codelineno-34-111"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-112"><a href="#__codelineno-34-112" id="__codelineno-34-112" name="__codelineno-34-112"></a>
</span><span id="__span-34-113"><a href="#__codelineno-34-113" id="__codelineno-34-113" name="__codelineno-34-113"></a><span class="w">        </span><span class="c1">// Database info resource</span>
</span><span id="__span-34-114"><a href="#__codelineno-34-114" id="__codelineno-34-114" name="__codelineno-34-114"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-115"><a href="#__codelineno-34-115" id="__codelineno-34-115" name="__codelineno-34-115"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://info"</span><span class="p">,</span>
</span><span id="__span-34-116"><a href="#__codelineno-34-116" id="__codelineno-34-116" name="__codelineno-34-116"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">"Database Info"</span><span class="p">,</span>
</span><span id="__span-34-117"><a href="#__codelineno-34-117" id="__codelineno-34-117" name="__codelineno-34-117"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">"Database metadata and statistics"</span><span class="p">,</span>
</span><span id="__span-34-118"><a href="#__codelineno-34-118" id="__codelineno-34-118" name="__codelineno-34-118"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-119"><a href="#__codelineno-34-119" id="__codelineno-34-119" name="__codelineno-34-119"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-34-120"><a href="#__codelineno-34-120" id="__codelineno-34-120" name="__codelineno-34-120"></a>
</span><span id="__span-34-121"><a href="#__codelineno-34-121" id="__codelineno-34-121" name="__codelineno-34-121"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-122"><a href="#__codelineno-34-122" id="__codelineno-34-122" name="__codelineno-34-122"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">'Error listing resources:'</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-123"><a href="#__codelineno-34-123" id="__codelineno-34-123" name="__codelineno-34-123"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-124"><a href="#__codelineno-34-124" id="__codelineno-34-124" name="__codelineno-34-124"></a>
</span><span id="__span-34-125"><a href="#__codelineno-34-125" id="__codelineno-34-125" name="__codelineno-34-125"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-126"><a href="#__codelineno-34-126" id="__codelineno-34-126" name="__codelineno-34-126"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-127"><a href="#__codelineno-34-127" id="__codelineno-34-127" name="__codelineno-34-127"></a>
</span><span id="__span-34-128"><a href="#__codelineno-34-128" id="__codelineno-34-128" name="__codelineno-34-128"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-129"><a href="#__codelineno-34-129" id="__codelineno-34-129" name="__codelineno-34-129"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-34-130"><a href="#__codelineno-34-130" id="__codelineno-34-130" name="__codelineno-34-130"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readDatabaseResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-34-131"><a href="#__codelineno-34-131" id="__codelineno-34-131" name="__codelineno-34-131"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-132"><a href="#__codelineno-34-132" id="__codelineno-34-132" name="__codelineno-34-132"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-133"><a href="#__codelineno-34-133" id="__codelineno-34-133" name="__codelineno-34-133"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-134"><a href="#__codelineno-34-134" id="__codelineno-34-134" name="__codelineno-34-134"></a>
</span><span id="__span-34-135"><a href="#__codelineno-34-135" id="__codelineno-34-135" name="__codelineno-34-135"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">ensureDatabase</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-136"><a href="#__codelineno-34-136" id="__codelineno-34-136" name="__codelineno-34-136"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-34-137"><a href="#__codelineno-34-137" id="__codelineno-34-137" name="__codelineno-34-137"></a>
</span><span id="__span-34-138"><a href="#__codelineno-34-138" id="__codelineno-34-138" name="__codelineno-34-138"></a><span class="w">    </span><span class="c1">// Check if database file exists</span>
</span><span id="__span-34-139"><a href="#__codelineno-34-139" id="__codelineno-34-139" name="__codelineno-34-139"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-140"><a href="#__codelineno-34-140" id="__codelineno-34-140" name="__codelineno-34-140"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-34-141"><a href="#__codelineno-34-141" id="__codelineno-34-141" name="__codelineno-34-141"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-142"><a href="#__codelineno-34-142" id="__codelineno-34-142" name="__codelineno-34-142"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Database file not found: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-143"><a href="#__codelineno-34-143" id="__codelineno-34-143" name="__codelineno-34-143"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-144"><a href="#__codelineno-34-144" id="__codelineno-34-144" name="__codelineno-34-144"></a>
</span><span id="__span-34-145"><a href="#__codelineno-34-145" id="__codelineno-34-145" name="__codelineno-34-145"></a><span class="w">    </span><span class="c1">// Open database in read-only mode if specified</span>
</span><span id="__span-34-146"><a href="#__codelineno-34-146" id="__codelineno-34-146" name="__codelineno-34-146"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Database</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">readonly</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readOnly</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-34-147"><a href="#__codelineno-34-147" id="__codelineno-34-147" name="__codelineno-34-147"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-148"><a href="#__codelineno-34-148" id="__codelineno-34-148" name="__codelineno-34-148"></a>
</span><span id="__span-34-149"><a href="#__codelineno-34-149" id="__codelineno-34-149" name="__codelineno-34-149"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableInfo</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">TableInfo</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-150"><a href="#__codelineno-34-150" id="__codelineno-34-150" name="__codelineno-34-150"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-151"><a href="#__codelineno-34-151" id="__codelineno-34-151" name="__codelineno-34-151"></a>
</span><span id="__span-34-152"><a href="#__codelineno-34-152" id="__codelineno-34-152" name="__codelineno-34-152"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="o">:</span><span class="w"> </span><span class="kt">TableInfo</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-153"><a href="#__codelineno-34-153" id="__codelineno-34-153" name="__codelineno-34-153"></a>
</span><span id="__span-34-154"><a href="#__codelineno-34-154" id="__codelineno-34-154" name="__codelineno-34-154"></a><span class="w">    </span><span class="c1">// Get all tables</span>
</span><span id="__span-34-155"><a href="#__codelineno-34-155" id="__codelineno-34-155" name="__codelineno-34-155"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tableNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-156"><a href="#__codelineno-34-156" id="__codelineno-34-156" name="__codelineno-34-156"></a><span class="sb">      SELECT name FROM sqlite_master </span>
</span><span id="__span-34-157"><a href="#__codelineno-34-157" id="__codelineno-34-157" name="__codelineno-34-157"></a><span class="sb">      WHERE type='table' AND name NOT LIKE 'sqlite_%'</span>
</span><span id="__span-34-158"><a href="#__codelineno-34-158" id="__codelineno-34-158" name="__codelineno-34-158"></a><span class="sb">    `</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-34-159"><a href="#__codelineno-34-159" id="__codelineno-34-159" name="__codelineno-34-159"></a>
</span><span id="__span-34-160"><a href="#__codelineno-34-160" id="__codelineno-34-160" name="__codelineno-34-160"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">tableNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-161"><a href="#__codelineno-34-161" id="__codelineno-34-161" name="__codelineno-34-161"></a><span class="w">      </span><span class="c1">// Check if table is allowed</span>
</span><span id="__span-34-162"><a href="#__codelineno-34-162" id="__codelineno-34-162" name="__codelineno-34-162"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-163"><a href="#__codelineno-34-163" id="__codelineno-34-163" name="__codelineno-34-163"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-34-164"><a href="#__codelineno-34-164" id="__codelineno-34-164" name="__codelineno-34-164"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-165"><a href="#__codelineno-34-165" id="__codelineno-34-165" name="__codelineno-34-165"></a>
</span><span id="__span-34-166"><a href="#__codelineno-34-166" id="__codelineno-34-166" name="__codelineno-34-166"></a><span class="w">      </span><span class="c1">// Get column info</span>
</span><span id="__span-34-167"><a href="#__codelineno-34-167" id="__codelineno-34-167" name="__codelineno-34-167"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`PRAGMA table_info(</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">)`</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-168"><a href="#__codelineno-34-168" id="__codelineno-34-168" name="__codelineno-34-168"></a>
</span><span id="__span-34-169"><a href="#__codelineno-34-169" id="__codelineno-34-169" name="__codelineno-34-169"></a><span class="w">      </span><span class="c1">// Get row count</span>
</span><span id="__span-34-170"><a href="#__codelineno-34-170" id="__codelineno-34-170" name="__codelineno-34-170"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">rowCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`SELECT COUNT(*) as count FROM </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">).</span><span class="nx">count</span><span class="p">;</span>
</span><span id="__span-34-171"><a href="#__codelineno-34-171" id="__codelineno-34-171" name="__codelineno-34-171"></a>
</span><span id="__span-34-172"><a href="#__codelineno-34-172" id="__codelineno-34-172" name="__codelineno-34-172"></a><span class="w">      </span><span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-173"><a href="#__codelineno-34-173" id="__codelineno-34-173" name="__codelineno-34-173"></a><span class="w">        </span><span class="nx">name</span><span class="p">,</span>
</span><span id="__span-34-174"><a href="#__codelineno-34-174" id="__codelineno-34-174" name="__codelineno-34-174"></a><span class="w">        </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">columns.map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-34-175"><a href="#__codelineno-34-175" id="__codelineno-34-175" name="__codelineno-34-175"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">col.name</span><span class="p">,</span>
</span><span id="__span-34-176"><a href="#__codelineno-34-176" id="__codelineno-34-176" name="__codelineno-34-176"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-34-177"><a href="#__codelineno-34-177" id="__codelineno-34-177" name="__codelineno-34-177"></a><span class="w">          </span><span class="nx">notnull</span><span class="o">:</span><span class="w"> </span><span class="kt">col.notnull</span><span class="p">,</span>
</span><span id="__span-34-178"><a href="#__codelineno-34-178" id="__codelineno-34-178" name="__codelineno-34-178"></a><span class="w">          </span><span class="nx">pk</span><span class="o">:</span><span class="w"> </span><span class="kt">col.pk</span><span class="p">,</span>
</span><span id="__span-34-179"><a href="#__codelineno-34-179" id="__codelineno-34-179" name="__codelineno-34-179"></a><span class="w">        </span><span class="p">})),</span>
</span><span id="__span-34-180"><a href="#__codelineno-34-180" id="__codelineno-34-180" name="__codelineno-34-180"></a><span class="w">        </span><span class="nx">rowCount</span><span class="p">,</span>
</span><span id="__span-34-181"><a href="#__codelineno-34-181" id="__codelineno-34-181" name="__codelineno-34-181"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-34-182"><a href="#__codelineno-34-182" id="__codelineno-34-182" name="__codelineno-34-182"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-183"><a href="#__codelineno-34-183" id="__codelineno-34-183" name="__codelineno-34-183"></a>
</span><span id="__span-34-184"><a href="#__codelineno-34-184" id="__codelineno-34-184" name="__codelineno-34-184"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tables</span><span class="p">;</span>
</span><span id="__span-34-185"><a href="#__codelineno-34-185" id="__codelineno-34-185" name="__codelineno-34-185"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-186"><a href="#__codelineno-34-186" id="__codelineno-34-186" name="__codelineno-34-186"></a>
</span><span id="__span-34-187"><a href="#__codelineno-34-187" id="__codelineno-34-187" name="__codelineno-34-187"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readDatabaseResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-188"><a href="#__codelineno-34-188" id="__codelineno-34-188" name="__codelineno-34-188"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ensureDatabase</span><span class="p">();</span>
</span><span id="__span-34-189"><a href="#__codelineno-34-189" id="__codelineno-34-189" name="__codelineno-34-189"></a>
</span><span id="__span-34-190"><a href="#__codelineno-34-190" id="__codelineno-34-190" name="__codelineno-34-190"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'db://'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-191"><a href="#__codelineno-34-191" id="__codelineno-34-191" name="__codelineno-34-191"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid database URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-192"><a href="#__codelineno-34-192" id="__codelineno-34-192" name="__codelineno-34-192"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-193"><a href="#__codelineno-34-193" id="__codelineno-34-193" name="__codelineno-34-193"></a>
</span><span id="__span-34-194"><a href="#__codelineno-34-194" id="__codelineno-34-194" name="__codelineno-34-194"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'db://'</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-34-195"><a href="#__codelineno-34-195" id="__codelineno-34-195" name="__codelineno-34-195"></a>
</span><span id="__span-34-196"><a href="#__codelineno-34-196" id="__codelineno-34-196" name="__codelineno-34-196"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">'info'</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-197"><a href="#__codelineno-34-197" id="__codelineno-34-197" name="__codelineno-34-197"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getDatabaseInfo</span><span class="p">();</span>
</span><span id="__span-34-198"><a href="#__codelineno-34-198" id="__codelineno-34-198" name="__codelineno-34-198"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-199"><a href="#__codelineno-34-199" id="__codelineno-34-199" name="__codelineno-34-199"></a>
</span><span id="__span-34-200"><a href="#__codelineno-34-200" id="__codelineno-34-200" name="__codelineno-34-200"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'tables/'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-201"><a href="#__codelineno-34-201" id="__codelineno-34-201" name="__codelineno-34-201"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readTableResource</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'tables/'</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
</span><span id="__span-34-202"><a href="#__codelineno-34-202" id="__codelineno-34-202" name="__codelineno-34-202"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-203"><a href="#__codelineno-34-203" id="__codelineno-34-203" name="__codelineno-34-203"></a>
</span><span id="__span-34-204"><a href="#__codelineno-34-204" id="__codelineno-34-204" name="__codelineno-34-204"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'query?'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-205"><a href="#__codelineno-34-205" id="__codelineno-34-205" name="__codelineno-34-205"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">executeCustomQuery</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">'query?'</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
</span><span id="__span-34-206"><a href="#__codelineno-34-206" id="__codelineno-34-206" name="__codelineno-34-206"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-207"><a href="#__codelineno-34-207" id="__codelineno-34-207" name="__codelineno-34-207"></a>
</span><span id="__span-34-208"><a href="#__codelineno-34-208" id="__codelineno-34-208" name="__codelineno-34-208"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown database resource: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-209"><a href="#__codelineno-34-209" id="__codelineno-34-209" name="__codelineno-34-209"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-210"><a href="#__codelineno-34-210" id="__codelineno-34-210" name="__codelineno-34-210"></a>
</span><span id="__span-34-211"><a href="#__codelineno-34-211" id="__codelineno-34-211" name="__codelineno-34-211"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getDatabaseInfo</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-212"><a href="#__codelineno-34-212" id="__codelineno-34-212" name="__codelineno-34-212"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-213"><a href="#__codelineno-34-213" id="__codelineno-34-213" name="__codelineno-34-213"></a>
</span><span id="__span-34-214"><a href="#__codelineno-34-214" id="__codelineno-34-214" name="__codelineno-34-214"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-215"><a href="#__codelineno-34-215" id="__codelineno-34-215" name="__codelineno-34-215"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dbStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-216"><a href="#__codelineno-34-216" id="__codelineno-34-216" name="__codelineno-34-216"></a><span class="sb">      SELECT </span>
</span><span id="__span-34-217"><a href="#__codelineno-34-217" id="__codelineno-34-217" name="__codelineno-34-217"></a><span class="sb">        COUNT(*) as tableCount,</span>
</span><span id="__span-34-218"><a href="#__codelineno-34-218" id="__codelineno-34-218" name="__codelineno-34-218"></a><span class="sb">        SUM(</span>
</span><span id="__span-34-219"><a href="#__codelineno-34-219" id="__codelineno-34-219" name="__codelineno-34-219"></a><span class="sb">          (SELECT COUNT(*) FROM sqlite_master WHERE type='index') +</span>
</span><span id="__span-34-220"><a href="#__codelineno-34-220" id="__codelineno-34-220" name="__codelineno-34-220"></a><span class="sb">          (SELECT COUNT(*) FROM pragma_table_info(name))</span>
</span><span id="__span-34-221"><a href="#__codelineno-34-221" id="__codelineno-34-221" name="__codelineno-34-221"></a><span class="sb">        ) as totalColumns</span>
</span><span id="__span-34-222"><a href="#__codelineno-34-222" id="__codelineno-34-222" name="__codelineno-34-222"></a><span class="sb">      FROM sqlite_master </span>
</span><span id="__span-34-223"><a href="#__codelineno-34-223" id="__codelineno-34-223" name="__codelineno-34-223"></a><span class="sb">      WHERE type='table' AND name NOT LIKE 'sqlite_%'</span>
</span><span id="__span-34-224"><a href="#__codelineno-34-224" id="__codelineno-34-224" name="__codelineno-34-224"></a><span class="sb">    `</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">;</span>
</span><span id="__span-34-225"><a href="#__codelineno-34-225" id="__codelineno-34-225" name="__codelineno-34-225"></a>
</span><span id="__span-34-226"><a href="#__codelineno-34-226" id="__codelineno-34-226" name="__codelineno-34-226"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-227"><a href="#__codelineno-34-227" id="__codelineno-34-227" name="__codelineno-34-227"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://info"</span><span class="p">,</span>
</span><span id="__span-34-228"><a href="#__codelineno-34-228" id="__codelineno-34-228" name="__codelineno-34-228"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-229"><a href="#__codelineno-34-229" id="__codelineno-34-229" name="__codelineno-34-229"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-230"><a href="#__codelineno-34-230" id="__codelineno-34-230" name="__codelineno-34-230"></a><span class="w">        </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-231"><a href="#__codelineno-34-231" id="__codelineno-34-231" name="__codelineno-34-231"></a><span class="w">          </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">this.dbPath</span><span class="p">,</span>
</span><span id="__span-34-232"><a href="#__codelineno-34-232" id="__codelineno-34-232" name="__codelineno-34-232"></a><span class="w">          </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">this.readOnly</span><span class="p">,</span>
</span><span id="__span-34-233"><a href="#__codelineno-34-233" id="__codelineno-34-233" name="__codelineno-34-233"></a><span class="w">          </span><span class="nx">tableCount</span><span class="o">:</span><span class="w"> </span><span class="kt">dbStats.tableCount</span><span class="p">,</span>
</span><span id="__span-34-234"><a href="#__codelineno-34-234" id="__codelineno-34-234" name="__codelineno-34-234"></a><span class="w">          </span><span class="nx">totalColumns</span><span class="o">:</span><span class="w"> </span><span class="kt">dbStats.totalColumns</span><span class="p">,</span>
</span><span id="__span-34-235"><a href="#__codelineno-34-235" id="__codelineno-34-235" name="__codelineno-34-235"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-236"><a href="#__codelineno-34-236" id="__codelineno-34-236" name="__codelineno-34-236"></a><span class="w">        </span><span class="nx">tables</span><span class="o">:</span><span class="w"> </span><span class="kt">tables.map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-34-237"><a href="#__codelineno-34-237" id="__codelineno-34-237" name="__codelineno-34-237"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">t.name</span><span class="p">,</span>
</span><span id="__span-34-238"><a href="#__codelineno-34-238" id="__codelineno-34-238" name="__codelineno-34-238"></a><span class="w">          </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">t.columns.length</span><span class="p">,</span>
</span><span id="__span-34-239"><a href="#__codelineno-34-239" id="__codelineno-34-239" name="__codelineno-34-239"></a><span class="w">          </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="kt">t.rowCount</span><span class="p">,</span>
</span><span id="__span-34-240"><a href="#__codelineno-34-240" id="__codelineno-34-240" name="__codelineno-34-240"></a><span class="w">          </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="kt">t.columns.find</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pk</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
</span><span id="__span-34-241"><a href="#__codelineno-34-241" id="__codelineno-34-241" name="__codelineno-34-241"></a><span class="w">        </span><span class="p">})),</span>
</span><span id="__span-34-242"><a href="#__codelineno-34-242" id="__codelineno-34-242" name="__codelineno-34-242"></a><span class="w">        </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-243"><a href="#__codelineno-34-243" id="__codelineno-34-243" name="__codelineno-34-243"></a><span class="w">          </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">this.maxRows</span><span class="p">,</span>
</span><span id="__span-34-244"><a href="#__codelineno-34-244" id="__codelineno-34-244" name="__codelineno-34-244"></a><span class="w">          </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">this.allowedTables.length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">'all'</span><span class="p">,</span>
</span><span id="__span-34-245"><a href="#__codelineno-34-245" id="__codelineno-34-245" name="__codelineno-34-245"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-246"><a href="#__codelineno-34-246" id="__codelineno-34-246" name="__codelineno-34-246"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-247"><a href="#__codelineno-34-247" id="__codelineno-34-247" name="__codelineno-34-247"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-248"><a href="#__codelineno-34-248" id="__codelineno-34-248" name="__codelineno-34-248"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-249"><a href="#__codelineno-34-249" id="__codelineno-34-249" name="__codelineno-34-249"></a>
</span><span id="__span-34-250"><a href="#__codelineno-34-250" id="__codelineno-34-250" name="__codelineno-34-250"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readTableResource</span><span class="p">(</span><span class="nx">tablePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-251"><a href="#__codelineno-34-251" id="__codelineno-34-251" name="__codelineno-34-251"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-252"><a href="#__codelineno-34-252" id="__codelineno-34-252" name="__codelineno-34-252"></a>
</span><span id="__span-34-253"><a href="#__codelineno-34-253" id="__codelineno-34-253" name="__codelineno-34-253"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tablePath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">'/'</span><span class="p">);</span>
</span><span id="__span-34-254"><a href="#__codelineno-34-254" id="__codelineno-34-254" name="__codelineno-34-254"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-34-255"><a href="#__codelineno-34-255" id="__codelineno-34-255" name="__codelineno-34-255"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-34-256"><a href="#__codelineno-34-256" id="__codelineno-34-256" name="__codelineno-34-256"></a>
</span><span id="__span-34-257"><a href="#__codelineno-34-257" id="__codelineno-34-257" name="__codelineno-34-257"></a><span class="w">    </span><span class="c1">// Validate table access</span>
</span><span id="__span-34-258"><a href="#__codelineno-34-258" id="__codelineno-34-258" name="__codelineno-34-258"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">tableName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-259"><a href="#__codelineno-34-259" id="__codelineno-34-259" name="__codelineno-34-259"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Access denied to table: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-260"><a href="#__codelineno-34-260" id="__codelineno-34-260" name="__codelineno-34-260"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-261"><a href="#__codelineno-34-261" id="__codelineno-34-261" name="__codelineno-34-261"></a>
</span><span id="__span-34-262"><a href="#__codelineno-34-262" id="__codelineno-34-262" name="__codelineno-34-262"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-263"><a href="#__codelineno-34-263" id="__codelineno-34-263" name="__codelineno-34-263"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'schema'</span><span class="o">:</span>
</span><span id="__span-34-264"><a href="#__codelineno-34-264" id="__codelineno-34-264" name="__codelineno-34-264"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableSchema</span><span class="p">(</span><span class="nx">tableName</span><span class="p">);</span>
</span><span id="__span-34-265"><a href="#__codelineno-34-265" id="__codelineno-34-265" name="__codelineno-34-265"></a>
</span><span id="__span-34-266"><a href="#__codelineno-34-266" id="__codelineno-34-266" name="__codelineno-34-266"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'data'</span><span class="o">:</span>
</span><span id="__span-34-267"><a href="#__codelineno-34-267" id="__codelineno-34-267" name="__codelineno-34-267"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tablePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-268"><a href="#__codelineno-34-268" id="__codelineno-34-268" name="__codelineno-34-268"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'limit'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'100'</span><span class="p">);</span>
</span><span id="__span-34-269"><a href="#__codelineno-34-269" id="__codelineno-34-269" name="__codelineno-34-269"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'offset'</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">'0'</span><span class="p">);</span>
</span><span id="__span-34-270"><a href="#__codelineno-34-270" id="__codelineno-34-270" name="__codelineno-34-270"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableData</span><span class="p">(</span><span class="nx">tableName</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">);</span>
</span><span id="__span-34-271"><a href="#__codelineno-34-271" id="__codelineno-34-271" name="__codelineno-34-271"></a>
</span><span id="__span-34-272"><a href="#__codelineno-34-272" id="__codelineno-34-272" name="__codelineno-34-272"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">'records'</span><span class="o">:</span>
</span><span id="__span-34-273"><a href="#__codelineno-34-273" id="__codelineno-34-273" name="__codelineno-34-273"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">recordId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">2</span><span class="p">];</span>
</span><span id="__span-34-274"><a href="#__codelineno-34-274" id="__codelineno-34-274" name="__codelineno-34-274"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableRecord</span><span class="p">(</span><span class="nx">tableName</span><span class="p">,</span><span class="w"> </span><span class="nx">recordId</span><span class="p">);</span>
</span><span id="__span-34-275"><a href="#__codelineno-34-275" id="__codelineno-34-275" name="__codelineno-34-275"></a>
</span><span id="__span-34-276"><a href="#__codelineno-34-276" id="__codelineno-34-276" name="__codelineno-34-276"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-34-277"><a href="#__codelineno-34-277" id="__codelineno-34-277" name="__codelineno-34-277"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown table action: </span><span class="si">${</span><span class="nx">action</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-278"><a href="#__codelineno-34-278" id="__codelineno-34-278" name="__codelineno-34-278"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-279"><a href="#__codelineno-34-279" id="__codelineno-34-279" name="__codelineno-34-279"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-280"><a href="#__codelineno-34-280" id="__codelineno-34-280" name="__codelineno-34-280"></a>
</span><span id="__span-34-281"><a href="#__codelineno-34-281" id="__codelineno-34-281" name="__codelineno-34-281"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableSchema</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-282"><a href="#__codelineno-34-282" id="__codelineno-34-282" name="__codelineno-34-282"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-283"><a href="#__codelineno-34-283" id="__codelineno-34-283" name="__codelineno-34-283"></a>
</span><span id="__span-34-284"><a href="#__codelineno-34-284" id="__codelineno-34-284" name="__codelineno-34-284"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-285"><a href="#__codelineno-34-285" id="__codelineno-34-285" name="__codelineno-34-285"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tables</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">tableName</span><span class="p">);</span>
</span><span id="__span-34-286"><a href="#__codelineno-34-286" id="__codelineno-34-286" name="__codelineno-34-286"></a>
</span><span id="__span-34-287"><a href="#__codelineno-34-287" id="__codelineno-34-287" name="__codelineno-34-287"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-288"><a href="#__codelineno-34-288" id="__codelineno-34-288" name="__codelineno-34-288"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Table not found: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-289"><a href="#__codelineno-34-289" id="__codelineno-34-289" name="__codelineno-34-289"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-290"><a href="#__codelineno-34-290" id="__codelineno-34-290" name="__codelineno-34-290"></a>
</span><span id="__span-34-291"><a href="#__codelineno-34-291" id="__codelineno-34-291" name="__codelineno-34-291"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-292"><a href="#__codelineno-34-292" id="__codelineno-34-292" name="__codelineno-34-292"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/schema`</span><span class="p">,</span>
</span><span id="__span-34-293"><a href="#__codelineno-34-293" id="__codelineno-34-293" name="__codelineno-34-293"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-294"><a href="#__codelineno-34-294" id="__codelineno-34-294" name="__codelineno-34-294"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-295"><a href="#__codelineno-34-295" id="__codelineno-34-295" name="__codelineno-34-295"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-296"><a href="#__codelineno-34-296" id="__codelineno-34-296" name="__codelineno-34-296"></a><span class="w">        </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">table.columns</span><span class="p">,</span>
</span><span id="__span-34-297"><a href="#__codelineno-34-297" id="__codelineno-34-297" name="__codelineno-34-297"></a><span class="w">        </span><span class="nx">rowCount</span><span class="o">:</span><span class="w"> </span><span class="kt">table.rowCount</span><span class="p">,</span>
</span><span id="__span-34-298"><a href="#__codelineno-34-298" id="__codelineno-34-298" name="__codelineno-34-298"></a><span class="w">        </span><span class="nx">indexes</span><span class="o">:</span><span class="w"> </span><span class="kt">this.getTableIndexes</span><span class="p">(</span><span class="nx">tableName</span><span class="p">),</span>
</span><span id="__span-34-299"><a href="#__codelineno-34-299" id="__codelineno-34-299" name="__codelineno-34-299"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-300"><a href="#__codelineno-34-300" id="__codelineno-34-300" name="__codelineno-34-300"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-301"><a href="#__codelineno-34-301" id="__codelineno-34-301" name="__codelineno-34-301"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-302"><a href="#__codelineno-34-302" id="__codelineno-34-302" name="__codelineno-34-302"></a>
</span><span id="__span-34-303"><a href="#__codelineno-34-303" id="__codelineno-34-303" name="__codelineno-34-303"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableData</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-304"><a href="#__codelineno-34-304" id="__codelineno-34-304" name="__codelineno-34-304"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-305"><a href="#__codelineno-34-305" id="__codelineno-34-305" name="__codelineno-34-305"></a>
</span><span id="__span-34-306"><a href="#__codelineno-34-306" id="__codelineno-34-306" name="__codelineno-34-306"></a><span class="w">    </span><span class="c1">// Validate limits</span>
</span><span id="__span-34-307"><a href="#__codelineno-34-307" id="__codelineno-34-307" name="__codelineno-34-307"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">actualLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">limit</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="p">);</span>
</span><span id="__span-34-308"><a href="#__codelineno-34-308" id="__codelineno-34-308" name="__codelineno-34-308"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">actualOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">);</span>
</span><span id="__span-34-309"><a href="#__codelineno-34-309" id="__codelineno-34-309" name="__codelineno-34-309"></a>
</span><span id="__span-34-310"><a href="#__codelineno-34-310" id="__codelineno-34-310" name="__codelineno-34-310"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb"> LIMIT ? OFFSET ?`</span><span class="p">;</span>
</span><span id="__span-34-311"><a href="#__codelineno-34-311" id="__codelineno-34-311" name="__codelineno-34-311"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nx">all</span><span class="p">(</span><span class="nx">actualLimit</span><span class="p">,</span><span class="w"> </span><span class="nx">actualOffset</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-312"><a href="#__codelineno-34-312" id="__codelineno-34-312" name="__codelineno-34-312"></a>
</span><span id="__span-34-313"><a href="#__codelineno-34-313" id="__codelineno-34-313" name="__codelineno-34-313"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-314"><a href="#__codelineno-34-314" id="__codelineno-34-314" name="__codelineno-34-314"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/data?limit=</span><span class="si">${</span><span class="nx">actualLimit</span><span class="si">}</span><span class="sb">&amp;offset=</span><span class="si">${</span><span class="nx">actualOffset</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-315"><a href="#__codelineno-34-315" id="__codelineno-34-315" name="__codelineno-34-315"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-316"><a href="#__codelineno-34-316" id="__codelineno-34-316" name="__codelineno-34-316"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-317"><a href="#__codelineno-34-317" id="__codelineno-34-317" name="__codelineno-34-317"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-318"><a href="#__codelineno-34-318" id="__codelineno-34-318" name="__codelineno-34-318"></a><span class="w">        </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-319"><a href="#__codelineno-34-319" id="__codelineno-34-319" name="__codelineno-34-319"></a><span class="w">          </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">actualLimit</span><span class="p">,</span>
</span><span id="__span-34-320"><a href="#__codelineno-34-320" id="__codelineno-34-320" name="__codelineno-34-320"></a><span class="w">          </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="kt">actualOffset</span><span class="p">,</span>
</span><span id="__span-34-321"><a href="#__codelineno-34-321" id="__codelineno-34-321" name="__codelineno-34-321"></a><span class="w">          </span><span class="nx">totalRows</span><span class="o">:</span><span class="w"> </span><span class="kt">rows.length</span><span class="p">,</span>
</span><span id="__span-34-322"><a href="#__codelineno-34-322" id="__codelineno-34-322" name="__codelineno-34-322"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-323"><a href="#__codelineno-34-323" id="__codelineno-34-323" name="__codelineno-34-323"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">rows</span><span class="p">,</span>
</span><span id="__span-34-324"><a href="#__codelineno-34-324" id="__codelineno-34-324" name="__codelineno-34-324"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-325"><a href="#__codelineno-34-325" id="__codelineno-34-325" name="__codelineno-34-325"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-326"><a href="#__codelineno-34-326" id="__codelineno-34-326" name="__codelineno-34-326"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-327"><a href="#__codelineno-34-327" id="__codelineno-34-327" name="__codelineno-34-327"></a>
</span><span id="__span-34-328"><a href="#__codelineno-34-328" id="__codelineno-34-328" name="__codelineno-34-328"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableRecord</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">recordId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-329"><a href="#__codelineno-34-329" id="__codelineno-34-329" name="__codelineno-34-329"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-330"><a href="#__codelineno-34-330" id="__codelineno-34-330" name="__codelineno-34-330"></a>
</span><span id="__span-34-331"><a href="#__codelineno-34-331" id="__codelineno-34-331" name="__codelineno-34-331"></a><span class="w">    </span><span class="c1">// Get primary key column</span>
</span><span id="__span-34-332"><a href="#__codelineno-34-332" id="__codelineno-34-332" name="__codelineno-34-332"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`PRAGMA table_info(</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">)`</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-333"><a href="#__codelineno-34-333" id="__codelineno-34-333" name="__codelineno-34-333"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pkColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="nx">pk</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-34-334"><a href="#__codelineno-34-334" id="__codelineno-34-334" name="__codelineno-34-334"></a>
</span><span id="__span-34-335"><a href="#__codelineno-34-335" id="__codelineno-34-335" name="__codelineno-34-335"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pkColumn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-336"><a href="#__codelineno-34-336" id="__codelineno-34-336" name="__codelineno-34-336"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`No primary key found for table: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-337"><a href="#__codelineno-34-337" id="__codelineno-34-337" name="__codelineno-34-337"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-338"><a href="#__codelineno-34-338" id="__codelineno-34-338" name="__codelineno-34-338"></a>
</span><span id="__span-34-339"><a href="#__codelineno-34-339" id="__codelineno-34-339" name="__codelineno-34-339"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb"> WHERE </span><span class="si">${</span><span class="nx">pkColumn</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> = ?`</span><span class="p">;</span>
</span><span id="__span-34-340"><a href="#__codelineno-34-340" id="__codelineno-34-340" name="__codelineno-34-340"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">recordId</span><span class="p">);</span>
</span><span id="__span-34-341"><a href="#__codelineno-34-341" id="__codelineno-34-341" name="__codelineno-34-341"></a>
</span><span id="__span-34-342"><a href="#__codelineno-34-342" id="__codelineno-34-342" name="__codelineno-34-342"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-343"><a href="#__codelineno-34-343" id="__codelineno-34-343" name="__codelineno-34-343"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Record not found: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">pkColumn</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">recordId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-344"><a href="#__codelineno-34-344" id="__codelineno-34-344" name="__codelineno-34-344"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-345"><a href="#__codelineno-34-345" id="__codelineno-34-345" name="__codelineno-34-345"></a>
</span><span id="__span-34-346"><a href="#__codelineno-34-346" id="__codelineno-34-346" name="__codelineno-34-346"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-347"><a href="#__codelineno-34-347" id="__codelineno-34-347" name="__codelineno-34-347"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/records/</span><span class="si">${</span><span class="nx">recordId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-348"><a href="#__codelineno-34-348" id="__codelineno-34-348" name="__codelineno-34-348"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-349"><a href="#__codelineno-34-349" id="__codelineno-34-349" name="__codelineno-34-349"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-350"><a href="#__codelineno-34-350" id="__codelineno-34-350" name="__codelineno-34-350"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-351"><a href="#__codelineno-34-351" id="__codelineno-34-351" name="__codelineno-34-351"></a><span class="w">        </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-352"><a href="#__codelineno-34-352" id="__codelineno-34-352" name="__codelineno-34-352"></a><span class="w">          </span><span class="nx">column</span><span class="o">:</span><span class="w"> </span><span class="kt">pkColumn.name</span><span class="p">,</span>
</span><span id="__span-34-353"><a href="#__codelineno-34-353" id="__codelineno-34-353" name="__codelineno-34-353"></a><span class="w">          </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">recordId</span><span class="p">,</span>
</span><span id="__span-34-354"><a href="#__codelineno-34-354" id="__codelineno-34-354" name="__codelineno-34-354"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-355"><a href="#__codelineno-34-355" id="__codelineno-34-355" name="__codelineno-34-355"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">row</span><span class="p">,</span>
</span><span id="__span-34-356"><a href="#__codelineno-34-356" id="__codelineno-34-356" name="__codelineno-34-356"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-357"><a href="#__codelineno-34-357" id="__codelineno-34-357" name="__codelineno-34-357"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-358"><a href="#__codelineno-34-358" id="__codelineno-34-358" name="__codelineno-34-358"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-359"><a href="#__codelineno-34-359" id="__codelineno-34-359" name="__codelineno-34-359"></a>
</span><span id="__span-34-360"><a href="#__codelineno-34-360" id="__codelineno-34-360" name="__codelineno-34-360"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">executeCustomQuery</span><span class="p">(</span><span class="nx">queryString</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-361"><a href="#__codelineno-34-361" id="__codelineno-34-361" name="__codelineno-34-361"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Database not initialized'</span><span class="p">);</span>
</span><span id="__span-34-362"><a href="#__codelineno-34-362" id="__codelineno-34-362" name="__codelineno-34-362"></a>
</span><span id="__span-34-363"><a href="#__codelineno-34-363" id="__codelineno-34-363" name="__codelineno-34-363"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`db://query?</span><span class="si">${</span><span class="nx">queryString</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-364"><a href="#__codelineno-34-364" id="__codelineno-34-364" name="__codelineno-34-364"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'sql'</span><span class="p">);</span>
</span><span id="__span-34-365"><a href="#__codelineno-34-365" id="__codelineno-34-365" name="__codelineno-34-365"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">'params'</span><span class="p">);</span>
</span><span id="__span-34-366"><a href="#__codelineno-34-366" id="__codelineno-34-366" name="__codelineno-34-366"></a>
</span><span id="__span-34-367"><a href="#__codelineno-34-367" id="__codelineno-34-367" name="__codelineno-34-367"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">sql</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-368"><a href="#__codelineno-34-368" id="__codelineno-34-368" name="__codelineno-34-368"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'SQL parameter required for custom query'</span><span class="p">);</span>
</span><span id="__span-34-369"><a href="#__codelineno-34-369" id="__codelineno-34-369" name="__codelineno-34-369"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-370"><a href="#__codelineno-34-370" id="__codelineno-34-370" name="__codelineno-34-370"></a>
</span><span id="__span-34-371"><a href="#__codelineno-34-371" id="__codelineno-34-371" name="__codelineno-34-371"></a><span class="w">    </span><span class="c1">// Security: Only allow SELECT queries</span>
</span><span id="__span-34-372"><a href="#__codelineno-34-372" id="__codelineno-34-372" name="__codelineno-34-372"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">sql</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">'SELECT'</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-373"><a href="#__codelineno-34-373" id="__codelineno-34-373" name="__codelineno-34-373"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Only SELECT queries are allowed for security'</span><span class="p">);</span>
</span><span id="__span-34-374"><a href="#__codelineno-34-374" id="__codelineno-34-374" name="__codelineno-34-374"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-375"><a href="#__codelineno-34-375" id="__codelineno-34-375" name="__codelineno-34-375"></a>
</span><span id="__span-34-376"><a href="#__codelineno-34-376" id="__codelineno-34-376" name="__codelineno-34-376"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">queryParams</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-377"><a href="#__codelineno-34-377" id="__codelineno-34-377" name="__codelineno-34-377"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-378"><a href="#__codelineno-34-378" id="__codelineno-34-378" name="__codelineno-34-378"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-379"><a href="#__codelineno-34-379" id="__codelineno-34-379" name="__codelineno-34-379"></a><span class="w">        </span><span class="nx">queryParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span><span id="__span-34-380"><a href="#__codelineno-34-380" id="__codelineno-34-380" name="__codelineno-34-380"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-381"><a href="#__codelineno-34-381" id="__codelineno-34-381" name="__codelineno-34-381"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">'Invalid params JSON'</span><span class="p">);</span>
</span><span id="__span-34-382"><a href="#__codelineno-34-382" id="__codelineno-34-382" name="__codelineno-34-382"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-383"><a href="#__codelineno-34-383" id="__codelineno-34-383" name="__codelineno-34-383"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-384"><a href="#__codelineno-34-384" id="__codelineno-34-384" name="__codelineno-34-384"></a>
</span><span id="__span-34-385"><a href="#__codelineno-34-385" id="__codelineno-34-385" name="__codelineno-34-385"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">sql</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">' LIMIT ?'</span><span class="p">);</span>
</span><span id="__span-34-386"><a href="#__codelineno-34-386" id="__codelineno-34-386" name="__codelineno-34-386"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">all</span><span class="p">(...</span><span class="nx">queryParams</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="p">);</span>
</span><span id="__span-34-387"><a href="#__codelineno-34-387" id="__codelineno-34-387" name="__codelineno-34-387"></a>
</span><span id="__span-34-388"><a href="#__codelineno-34-388" id="__codelineno-34-388" name="__codelineno-34-388"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-389"><a href="#__codelineno-34-389" id="__codelineno-34-389" name="__codelineno-34-389"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://query?sql=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span><span class="si">}</span><span class="sb">&amp;params=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">))</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-390"><a href="#__codelineno-34-390" id="__codelineno-34-390" name="__codelineno-34-390"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">"application/json"</span><span class="p">,</span>
</span><span id="__span-34-391"><a href="#__codelineno-34-391" id="__codelineno-34-391" name="__codelineno-34-391"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-392"><a href="#__codelineno-34-392" id="__codelineno-34-392" name="__codelineno-34-392"></a><span class="w">        </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="kt">sql</span><span class="p">,</span>
</span><span id="__span-34-393"><a href="#__codelineno-34-393" id="__codelineno-34-393" name="__codelineno-34-393"></a><span class="w">        </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="kt">queryParams</span><span class="p">,</span>
</span><span id="__span-34-394"><a href="#__codelineno-34-394" id="__codelineno-34-394" name="__codelineno-34-394"></a><span class="w">        </span><span class="nx">resultCount</span><span class="o">:</span><span class="w"> </span><span class="kt">rows.length</span><span class="p">,</span>
</span><span id="__span-34-395"><a href="#__codelineno-34-395" id="__codelineno-34-395" name="__codelineno-34-395"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">rows</span><span class="p">,</span>
</span><span id="__span-34-396"><a href="#__codelineno-34-396" id="__codelineno-34-396" name="__codelineno-34-396"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-397"><a href="#__codelineno-34-397" id="__codelineno-34-397" name="__codelineno-34-397"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-398"><a href="#__codelineno-34-398" id="__codelineno-34-398" name="__codelineno-34-398"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-399"><a href="#__codelineno-34-399" id="__codelineno-34-399" name="__codelineno-34-399"></a>
</span><span id="__span-34-400"><a href="#__codelineno-34-400" id="__codelineno-34-400" name="__codelineno-34-400"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableIndexes</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-401"><a href="#__codelineno-34-401" id="__codelineno-34-401" name="__codelineno-34-401"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-402"><a href="#__codelineno-34-402" id="__codelineno-34-402" name="__codelineno-34-402"></a>
</span><span id="__span-34-403"><a href="#__codelineno-34-403" id="__codelineno-34-403" name="__codelineno-34-403"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-404"><a href="#__codelineno-34-404" id="__codelineno-34-404" name="__codelineno-34-404"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-405"><a href="#__codelineno-34-405" id="__codelineno-34-405" name="__codelineno-34-405"></a><span class="sb">        SELECT name, sql </span>
</span><span id="__span-34-406"><a href="#__codelineno-34-406" id="__codelineno-34-406" name="__codelineno-34-406"></a><span class="sb">        FROM sqlite_master </span>
</span><span id="__span-34-407"><a href="#__codelineno-34-407" id="__codelineno-34-407" name="__codelineno-34-407"></a><span class="sb">        WHERE type='index' AND tbl_name=?</span>
</span><span id="__span-34-408"><a href="#__codelineno-34-408" id="__codelineno-34-408" name="__codelineno-34-408"></a><span class="sb">      `</span><span class="p">).</span><span class="nx">all</span><span class="p">(</span><span class="nx">tableName</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-409"><a href="#__codelineno-34-409" id="__codelineno-34-409" name="__codelineno-34-409"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-410"><a href="#__codelineno-34-410" id="__codelineno-34-410" name="__codelineno-34-410"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-411"><a href="#__codelineno-34-411" id="__codelineno-34-411" name="__codelineno-34-411"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-412"><a href="#__codelineno-34-412" id="__codelineno-34-412" name="__codelineno-34-412"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-413"><a href="#__codelineno-34-413" id="__codelineno-34-413" name="__codelineno-34-413"></a>
</span><span id="__span-34-414"><a href="#__codelineno-34-414" id="__codelineno-34-414" name="__codelineno-34-414"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-415"><a href="#__codelineno-34-415" id="__codelineno-34-415" name="__codelineno-34-415"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-416"><a href="#__codelineno-34-416" id="__codelineno-34-416" name="__codelineno-34-416"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"[MCP Error]"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-417"><a href="#__codelineno-34-417" id="__codelineno-34-417" name="__codelineno-34-417"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-418"><a href="#__codelineno-34-418" id="__codelineno-34-418" name="__codelineno-34-418"></a>
</span><span id="__span-34-419"><a href="#__codelineno-34-419" id="__codelineno-34-419" name="__codelineno-34-419"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">"SIGINT"</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-420"><a href="#__codelineno-34-420" id="__codelineno-34-420" name="__codelineno-34-420"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-421"><a href="#__codelineno-34-421" id="__codelineno-34-421" name="__codelineno-34-421"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-34-422"><a href="#__codelineno-34-422" id="__codelineno-34-422" name="__codelineno-34-422"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-423"><a href="#__codelineno-34-423" id="__codelineno-34-423" name="__codelineno-34-423"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-34-424"><a href="#__codelineno-34-424" id="__codelineno-34-424" name="__codelineno-34-424"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-34-425"><a href="#__codelineno-34-425" id="__codelineno-34-425" name="__codelineno-34-425"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-426"><a href="#__codelineno-34-426" id="__codelineno-34-426" name="__codelineno-34-426"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-427"><a href="#__codelineno-34-427" id="__codelineno-34-427" name="__codelineno-34-427"></a>
</span><span id="__span-34-428"><a href="#__codelineno-34-428" id="__codelineno-34-428" name="__codelineno-34-428"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-429"><a href="#__codelineno-34-429" id="__codelineno-34-429" name="__codelineno-34-429"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-34-430"><a href="#__codelineno-34-430" id="__codelineno-34-430" name="__codelineno-34-430"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-34-431"><a href="#__codelineno-34-431" id="__codelineno-34-431" name="__codelineno-34-431"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Database Resource Server running (DB: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-34-432"><a href="#__codelineno-34-432" id="__codelineno-34-432" name="__codelineno-34-432"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-433"><a href="#__codelineno-34-433" id="__codelineno-34-433" name="__codelineno-34-433"></a><span class="p">}</span>
</span><span id="__span-34-434"><a href="#__codelineno-34-434" id="__codelineno-34-434" name="__codelineno-34-434"></a>
</span><span id="__span-34-435"><a href="#__codelineno-34-435" id="__codelineno-34-435" name="__codelineno-34-435"></a><span class="c1">// Main entry point</span>
</span><span id="__span-34-436"><a href="#__codelineno-34-436" id="__codelineno-34-436" name="__codelineno-34-436"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-437"><a href="#__codelineno-34-437" id="__codelineno-34-437" name="__codelineno-34-437"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DatabaseResourceServer</span><span class="p">();</span>
</span><span id="__span-34-438"><a href="#__codelineno-34-438" id="__codelineno-34-438" name="__codelineno-34-438"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-34-439"><a href="#__codelineno-34-439" id="__codelineno-34-439" name="__codelineno-34-439"></a><span class="p">}</span>
</span><span id="__span-34-440"><a href="#__codelineno-34-440" id="__codelineno-34-440" name="__codelineno-34-440"></a>
</span><span id="__span-34-441"><a href="#__codelineno-34-441" id="__codelineno-34-441" name="__codelineno-34-441"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-442"><a href="#__codelineno-34-442" id="__codelineno-34-442" name="__codelineno-34-442"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">"Fatal error:"</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-443"><a href="#__codelineno-34-443" id="__codelineno-34-443" name="__codelineno-34-443"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-34-444"><a href="#__codelineno-34-444" id="__codelineno-34-444" name="__codelineno-34-444"></a><span class="p">});</span>
</span></code></pre></div> Testing - First, create a test database: <div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a href="#__codelineno-35-1" id="__codelineno-35-1" name="__codelineno-35-1"></a>sqlite3<span class="w"> </span>test.db<span class="w"> </span><span class="s">&lt;&lt; 'EOF'</span>
</span><span id="__span-35-2"><a href="#__codelineno-35-2" id="__codelineno-35-2" name="__codelineno-35-2"></a><span class="s">CREATE TABLE users (</span>
</span><span id="__span-35-3"><a href="#__codelineno-35-3" id="__codelineno-35-3" name="__codelineno-35-3"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-35-4"><a href="#__codelineno-35-4" id="__codelineno-35-4" name="__codelineno-35-4"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-35-5"><a href="#__codelineno-35-5" id="__codelineno-35-5" name="__codelineno-35-5"></a><span class="s">  email TEXT UNIQUE,</span>
</span><span id="__span-35-6"><a href="#__codelineno-35-6" id="__codelineno-35-6" name="__codelineno-35-6"></a><span class="s">  age INTEGER,</span>
</span><span id="__span-35-7"><a href="#__codelineno-35-7" id="__codelineno-35-7" name="__codelineno-35-7"></a><span class="s">  created_at DATETIME DEFAULT CURRENT_TIMESTAMP</span>
</span><span id="__span-35-8"><a href="#__codelineno-35-8" id="__codelineno-35-8" name="__codelineno-35-8"></a><span class="s">);</span>
</span><span id="__span-35-9"><a href="#__codelineno-35-9" id="__codelineno-35-9" name="__codelineno-35-9"></a>
</span><span id="__span-35-10"><a href="#__codelineno-35-10" id="__codelineno-35-10" name="__codelineno-35-10"></a><span class="s">CREATE TABLE products (</span>
</span><span id="__span-35-11"><a href="#__codelineno-35-11" id="__codelineno-35-11" name="__codelineno-35-11"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-35-12"><a href="#__codelineno-35-12" id="__codelineno-35-12" name="__codelineno-35-12"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-35-13"><a href="#__codelineno-35-13" id="__codelineno-35-13" name="__codelineno-35-13"></a><span class="s">  price REAL,</span>
</span><span id="__span-35-14"><a href="#__codelineno-35-14" id="__codelineno-35-14" name="__codelineno-35-14"></a><span class="s">  category TEXT,</span>
</span><span id="__span-35-15"><a href="#__codelineno-35-15" id="__codelineno-35-15" name="__codelineno-35-15"></a><span class="s">  in_stock BOOLEAN DEFAULT 1</span>
</span><span id="__span-35-16"><a href="#__codelineno-35-16" id="__codelineno-35-16" name="__codelineno-35-16"></a><span class="s">);</span>
</span><span id="__span-35-17"><a href="#__codelineno-35-17" id="__codelineno-35-17" name="__codelineno-35-17"></a>
</span><span id="__span-35-18"><a href="#__codelineno-35-18" id="__codelineno-35-18" name="__codelineno-35-18"></a><span class="s">INSERT INTO users (name, email, age) VALUES </span>
</span><span id="__span-35-19"><a href="#__codelineno-35-19" id="__codelineno-35-19" name="__codelineno-35-19"></a><span class="s">  ('Alice Johnson', 'alice@example.com', 28),</span>
</span><span id="__span-35-20"><a href="#__codelineno-35-20" id="__codelineno-35-20" name="__codelineno-35-20"></a><span class="s">  ('Bob Smith', 'bob@example.com', 34);</span>
</span><span id="__span-35-21"><a href="#__codelineno-35-21" id="__codelineno-35-21" name="__codelineno-35-21"></a>
</span><span id="__span-35-22"><a href="#__codelineno-35-22" id="__codelineno-35-22" name="__codelineno-35-22"></a><span class="s">INSERT INTO products (name, price, category, in_stock) VALUES </span>
</span><span id="__span-35-23"><a href="#__codelineno-35-23" id="__codelineno-35-23" name="__codelineno-35-23"></a><span class="s">  ('Laptop', 999.99, 'Electronics', 1),</span>
</span><span id="__span-35-24"><a href="#__codelineno-35-24" id="__codelineno-35-24" name="__codelineno-35-24"></a><span class="s">  ('Book', 19.99, 'Education', 1);</span>
</span><span id="__span-35-25"><a href="#__codelineno-35-25" id="__codelineno-35-25" name="__codelineno-35-25"></a>
</span><span id="__span-35-26"><a href="#__codelineno-35-26" id="__codelineno-35-26" name="__codelineno-35-26"></a><span class="s">.quit</span>
</span><span id="__span-35-27"><a href="#__codelineno-35-27" id="__codelineno-35-27" name="__codelineno-35-27"></a><span class="s">EOF</span>
</span></code></pre></div> Test the server: <div class="language-javascript highlight"><pre><span></span><code><span id="__span-36-1"><a href="#__codelineno-36-1" id="__codelineno-36-1" name="__codelineno-36-1"></a><span class="c1">// Database info</span>
</span><span id="__span-36-2"><a href="#__codelineno-36-2" id="__codelineno-36-2" name="__codelineno-36-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://info"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-3"><a href="#__codelineno-36-3" id="__codelineno-36-3" name="__codelineno-36-3"></a>
</span><span id="__span-36-4"><a href="#__codelineno-36-4" id="__codelineno-36-4" name="__codelineno-36-4"></a><span class="c1">// Table schemas</span>
</span><span id="__span-36-5"><a href="#__codelineno-36-5" id="__codelineno-36-5" name="__codelineno-36-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/users/schema"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-6"><a href="#__codelineno-36-6" id="__codelineno-36-6" name="__codelineno-36-6"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/products/schema"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-7"><a href="#__codelineno-36-7" id="__codelineno-36-7" name="__codelineno-36-7"></a>
</span><span id="__span-36-8"><a href="#__codelineno-36-8" id="__codelineno-36-8" name="__codelineno-36-8"></a><span class="c1">// Table data</span>
</span><span id="__span-36-9"><a href="#__codelineno-36-9" id="__codelineno-36-9" name="__codelineno-36-9"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/users/data?limit=10"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-10"><a href="#__codelineno-36-10" id="__codelineno-36-10" name="__codelineno-36-10"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/products/data?limit=10"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-11"><a href="#__codelineno-36-11" id="__codelineno-36-11" name="__codelineno-36-11"></a>
</span><span id="__span-36-12"><a href="#__codelineno-36-12" id="__codelineno-36-12" name="__codelineno-36-12"></a><span class="c1">// Specific records</span>
</span><span id="__span-36-13"><a href="#__codelineno-36-13" id="__codelineno-36-13" name="__codelineno-36-13"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/users/records/1"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-14"><a href="#__codelineno-36-14" id="__codelineno-36-14" name="__codelineno-36-14"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://tables/products/records/2"</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-15"><a href="#__codelineno-36-15" id="__codelineno-36-15" name="__codelineno-36-15"></a>
</span><span id="__span-36-16"><a href="#__codelineno-36-16" id="__codelineno-36-16" name="__codelineno-36-16"></a><span class="c1">// Custom query</span>
</span><span id="__span-36-17"><a href="#__codelineno-36-17" id="__codelineno-36-17" name="__codelineno-36-17"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">"db://query?sql=SELECT * FROM users WHERE age &gt; ?&amp;params=[25]"</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div> </details> <hr/> <h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">¶</a></h2> <p>✅ <strong>Resources</strong> provide passive data access for LLMs</p> <p>✅ <strong>Tools</strong> perform active operations with side effects</p> <p>✅ <strong>URI schemes</strong> should be hierarchical and descriptive</p> <p>✅ <strong>Templates</strong> enable parameterized resource access</p> <p>✅ <strong>Subscriptions</strong> support real-time data updates</p> <p>✅ <strong>Security</strong> is critical for resource access control</p> <p>✅ <strong>Caching</strong> improves performance for static resources</p> <p>✅ <strong>Hybrid servers</strong> combine resources and tools effectively</p> <hr/> <h2 id="next-steps">Next Steps<a class="headerlink" href="#next-steps" title="Permanent link">¶</a></h2> <p>In <a href="../Lab05-MCP-Prompts/"><strong>Lab 5</strong></a>, you’ll complete your MCP mastery by learning about Prompts:</p> <ul> <li>Creating reusable prompt templates</li> <li>Embedding resources in prompts</li> <li>Supporting prompt arguments</li> <li>Building complete, production-ready MCP servers</li> </ul> <hr/> <p><strong>Ready to add prompts to your MCP toolkit? Continue to <a href="../Lab05-MCP-Prompts/">Lab 5!</a></strong></p> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Render date of last update --> <!-- Render date of creation --> <!-- ---------------------------------------------------------------------- --> <!-- Render authors --> <!-- ---------------------------------------------------------------------- --> <!-- Render committers from GitHub --> <!-- Render committers from GitLab --> <!-- Render committers --> <!-- ---------------------------------------------------------------------- --> <!-- Determine date of last update --> <!-- Determine date of creation --> <!-- Source file information --> <aside class="md-source-file"> <!-- Date of last update --> <span class="md-source-file__fact"> <span class="md-icon" title="Last update"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg> </span> <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="January 28, 2026 11:05:44 UTC">January 28, 2026</span> </span> <!-- Authors (git-authors plugin) --> <!-- Authors (git-committers plugin) --> <!-- Fallback: Manual GitHub avatar for repository owner --> <span class="md-source-file__fact"> <nav> <a class="md-author" href="https://github.com/nirgeier" title="@nirgeier"> <img alt="Nir Geier" src="https://avatars.githubusercontent.com/u/555154?size=256"/> </a> </nav> </span> </aside> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
--> <!-- Footer --> <footer class="md-footer"> <div class="logo1"></div> <div class="logo2"></div> <!-- Link to previous and/or next page --> <nav aria-label="Footer" class="md-footer__inner md-grid"> <!-- Link to previous page --> <a aria-label="Previous: Lab 3: MCP Tools" class="md-footer__link md-footer__link--prev" href="../../Lab03-MCP-Tools/lab/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> Lab 3: MCP Tools </div> </div> </a> <!-- <ul class="social-badges">
          <li><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a></li>
          <li><a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="sr-only">LinkedIn profile</span></a></li>
          <li><a href="mailto:nirgeier@gmail.com"><img src="https://img.shields.io/badge/-nirgeier@gmail.com-fcc624?style=flat&logo=Gmail&logoColor=red" alt="Gmail Badge"></a></li>
          <li><a href="mailto:nirg@codewizard.co.il"><img src="https://img.shields.io/badge/-nirg@codewizard.co.il-fcc624?style=flat&logo=microsoftoutlook&logoColor=blue" alt="Outlook Badge"></a></li>
        </ul> --> <!-- Link to next page --> <a aria-label="Next: Lab 5: MCP Prompts" class="md-footer__link md-footer__link--next" href="../../Lab05-MCP-Prompts/lab/"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> Lab 5: MCP Prompts </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <!-- Further information --> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> <div class="md-copyright__highlight"> ©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" rel="noopener" target="_blank"><img alt="Visitor Badge" src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier"/></a> </div> </div> <!-- Social links --> <div class="md-social"> <a class="md-social__link social-class__github" href="https://github.com/nirgeier/AI-K8S-MCP" rel="noopener" target="_blank" title="View on GitHub"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__fork" href="https://github.com/nirgeier/AI-K8S-MCP/network/members" rel="noopener" target="_blank" title="Fork this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"></path></svg> </a> <a class="md-social__link social-class__star" href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" rel="noopener" target="_blank" title="Star this repo"> <svg viewbox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"></path></svg> </a> <a class="md-social__link social-class__linkedin" href="https://www.linkedin.com/in/nirgeier/" rel="noopener" target="_blank" title="Connect on LinkedIn"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__discord" href="https://discord.gg/U6xW23Ss" rel="noopener" target="_blank" title="Follow me on Discord"> <svg viewbox="0 0 576 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__stackoverflow" href="https://stackoverflow.com/users/1755598/codewizard" rel="noopener" target="_blank" title="Follow me on Stack Overflow"> <svg viewbox="0 0 384 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__whatsapp" href="https://wa.me/972548122310" rel="noopener" target="_blank" title="Follow me on WhatsApp"> <svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6" fill="currentColor"></path></svg> </a> <a class="md-social__link social-class__email" href="mailto:nirg@codewizard.co.il" rel="noopener" target="_blank" title="Email me"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z" fill="currentColor"></path></svg> </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", "navigation.expand", "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky", "mermaid"], "search": "../../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../assets/javascripts/bundle.50899def.min.js"></script> <script src="../../js/print-site.js"></script> <script src="https://buttons.github.io/buttons.js?v=1766553928"></script> </body> </html>