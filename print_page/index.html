
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Hands-on labs for the K-Agent framework - Kubernetes-native MCP server">
      
      
        <meta name="author" content="CodeWizard-IL">
      
      
        <link rel="canonical" href="https://nirgeier.github.io/AI-K8S-MCP/print_page/">
      
      
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Print Site - K-Agent Labs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/codewizard.css?v=1766553928">
    
    <script>__md_scope=new URL("/AI-K8S-MCP/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->





<!-- Header -->
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">

    <!-- Link to home -->
    <a href=".." title="K-Agent Labs"
      class="md-header__button md-logo" aria-label="K-Agent Labs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            K-Agent Labs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
            Print Site
            
          </span>
        </div>
      </div>
    </div>

    <div class="m-social__top">
      <!-- Social links -->
      
      
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>

    <!-- Color palette toggle -->
    
    
    <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
    
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    

    <!-- Check if search is actually enabled - see https://t.ly/DT_0V -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      <a href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/AI-K8S-MCP
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
  
  
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../welcome/" class="md-tabs__link">
        
  
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../Lab00-Setup/" class="md-tabs__link">
        
  
  
    
  
  Setup

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../labs/" class="md-tabs__link">
          
  
  
    
  
  Labs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Tasks/" class="md-tabs__link">
          
  
  
    
  
  Tasks

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../Resources/001-MCP-Basics/001-MCP-Basics-py/" class="md-tabs__link">
          
  
  
    
  
  Resources

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
  
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="K-Agent Labs" class="md-nav__button md-logo" aria-label="K-Agent Labs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    K-Agent Labs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nirgeier/AI-K8S-MCP.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/AI-K8S-MCP
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Lab00-Setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setup
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../labs/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Labs
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../Tasks/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Tasks
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../Resources/001-MCP-Basics/001-MCP-Basics-py/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Resources
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="welcome" heading-number="1"><!-- header start -->
<div class="text-center">
<h1 id="welcome-k8s-mcp-k-agent-workshop">K8S - MCP (K-Agent Workshop)<a class="headerlink" href="#welcome-k8s-mcp-k-agent-workshop" title="Permanent link">&para;</a></h1>
</div>
<p><img src="../assets/images/k8s-kagent-lab.jpg" style="width:100%; border-radius: 20px;">
<img src="../../assets/images/mcp-feature-image.jpg" alt="MCP Feature" class="center" style="max-width:800; border-radius:20px;"/></p>
<hr />
<div class="admonition success">
<p class="admonition-title">Getting Started Tip</p>
<ul>
<li>Choose the preferred way to run the labs. </li>
<li>If you encounter any issues, please check the documentation or ask for assistance.</li>
</ul>
</div>
<hr />
<p><img src="../assets/images/tldr.png" style="width:100px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);"></p>
<h2 id="welcome-intro">Intro<a class="headerlink" href="#welcome-intro" title="Permanent link">&para;</a></h2>
<ul>
<li>This tutorial is a custom made workshop for teaching AI In focus on MCP development.</li>
<li>The lab is based upon <strong>K-Agent framework</strong> through hands-on labs designed as practical exercises.</li>
<li>Each lab is packaged in its own folder and includes the files, manifests, and assets required to complete the lab.</li>
<li>Every lab folder includes a <code>README</code> that describes the lab&rsquo;s objectives, tasks, and how to verify the solution.</li>
<li>The K-Agent Labs are a series of Kubernetes and MCP automation exercises designed to teach Model Context Protocol skills &amp; features.</li>
<li>The inspiration for this project is to provide practical learning experiences for K-Agent and MCP.</li>
</ul>
<h2 id="welcome-architecture-overview">Architecture Overview<a class="headerlink" href="#welcome-architecture-overview" title="Permanent link">&para;</a></h2>
<pre class="mermaid"><code>graph TD
    A[K-Agent Labs] --&gt; B[MCP Server]
    B --&gt; C[Kubernetes Cluster]
    C --&gt; D[Pods &amp; Services]
    B --&gt; E[AI Models]</code></pre>
<hr />
<h2 id="welcome-pre-requirements">Pre-Requirements<a class="headerlink" href="#welcome-pre-requirements" title="Permanent link">&para;</a></h2>
<ul>
<li>This tutorial will test your <code>Kubernetes</code>, <code>MCP</code>, and <code>Python</code> skills.</li>
<li>You should be familiar with the following topics:<ul>
<li>Basic Docker and container concepts</li>
<li>Kubernetes fundamentals (pods, deployments, services)</li>
<li>Basic knowledge of YAML</li>
<li>Node.js or Python programming basics</li>
</ul>
</li>
<li>For advanced Labs: <ul>
<li><code>MCP</code> protocol basics</li>
<li><code>Kubernetes</code> advanced concepts (RBAC, ConfigMaps, Secrets)</li>
<li><code>GCP</code> (Google Cloud Platform) basics</li>
</ul>
</li>
</ul>
<hr />
<h2 id="welcome-required-tools">Required Tools<a class="headerlink" href="#welcome-required-tools" title="Permanent link">&para;</a></h2>
<div class="grid cards">
<ul>
<li>
<h4 id="welcome-visual-studio-code">Visual Studio Code<a class="headerlink" href="#welcome-visual-studio-code" title="Permanent link">&para;</a></h4>
<p>An integrated development environment (IDE) for coding, debugging, and version control.</p>
</li>
<li>
<h4 id="welcome-python-3">Python 3<a class="headerlink" href="#welcome-python-3" title="Permanent link">&para;</a></h4>
<p>A versatile programming language essential for scripting and building MCP servers.</p>
</li>
<li>
<h4 id="welcome-nodejs">Node.js<a class="headerlink" href="#welcome-nodejs" title="Permanent link">&para;</a></h4>
<p>A JavaScript runtime for building scalable network applications and MCP tools.</p>
</li>
<li>
<h4 id="welcome-git">Git<a class="headerlink" href="#welcome-git" title="Permanent link">&para;</a></h4>
<p>A version control system for tracking changes in source code during development.</p>
</li>
<li>
<h4 id="welcome-docker">Docker<a class="headerlink" href="#welcome-docker" title="Permanent link">&para;</a></h4>
<p>A platform for developing, shipping, and running applications in containers.</p>
</li>
<li>
<h4 id="welcome-kubernetes-kubectl">Kubernetes (kubectl)<a class="headerlink" href="#welcome-kubernetes-kubectl" title="Permanent link">&para;</a></h4>
<p>A command-line tool for deploying and managing containerized applications on Kubernetes clusters.</p>
</li>
<li>
<h4 id="welcome-ollama">Ollama<a class="headerlink" href="#welcome-ollama" title="Permanent link">&para;</a></h4>
<p>A tool for running large language models locally for AI assistance.</p>
</li>
<li>
<h4 id="welcome-mcp-inspector">MCP Inspector<a class="headerlink" href="#welcome-mcp-inspector" title="Permanent link">&para;</a></h4>
<p>A utility for inspecting and debugging MCP protocol interactions.</p>
</li>
</ul>
</div>
<hr />
<div class="admonition debug">
<p class="admonition-title">Before You Begin</p>
<ul>
<li>Ensure you have the the above tools, permissions to run <code>Docker</code> commands &amp;&amp; <code>Kubernetes</code>  on your system.</li>
<li>Enjoy, and don&rsquo;t forget to star the project on GitHub!</li>
</ul>
</div>
<hr />
<h2 id="welcome-preface">Preface<a class="headerlink" href="#welcome-preface" title="Permanent link">&para;</a></h2>
<h3 id="welcome-what-is-k-agent">What is K-Agent?<a class="headerlink" href="#welcome-what-is-k-agent" title="Permanent link">&para;</a></h3>
<ul>
<li><code>K-Agent</code> is a Kubernetes-native tool to write <code>Model Context Protocol</code> (<code>MCP</code>) server(s), tool(s) and more.</li>
<li><code>K-Agent</code> enables AI assistants to interact with Kubernetes clusters and cloud services through standardized tools.</li>
<li><code>K-Agent</code> provides a set of MCP tools for cluster management, monitoring, and operations.</li>
<li><code>K-Agent</code> framework supports multiple transport protocols: stdio, HTTP, and WebSocket.</li>
<li><code>K-Agent</code> can be deployed as a containerized service in Kubernetes or run locally for development.</li>
</ul>
<hr />
<h3 id="welcome-what-is-mcp">What is MCP<a class="headerlink" href="#welcome-what-is-mcp" title="Permanent link">&para;</a></h3>
<ul>
<li><code>MCP</code> - Model Context Protocol</li>
<li><code>MCP</code> is an <strong>open standard protocol</strong> for connecting AI assistants to <strong>external tools</strong> and data sources.</li>
<li><code>MCP</code> defines a standard way for AI models to discover, invoke, and interact with tools.</li>
<li><code>MCP</code> uses JSON-RPC 2.0 protocol over various transports (stdio, HTTP, WebSocket).</li>
<li><code>MCP</code> enables AI assistants to perform actions beyond text generation, such as API calls, database queries, and system operations.</li>
</ul>
<hr />
<h3 id="welcome-how-does-k-agent-work">How Does <code>K-Agent</code> Work<a class="headerlink" href="#welcome-how-does-k-agent-work" title="Permanent link">&para;</a></h3>
<ul>
<li><code>K-Agent</code> acts as an <code>MCP server</code> that exposes <code>Kubernetes</code> and <code>cloud management capabilities</code> as tools.</li>
<li>AI assistants connect to <code>K-Agent</code> using the <code>MCP protocol</code>.</li>
<li><code>K-Agent</code> translates MCP tool invocations into <code>Kubernetes API</code> calls or <code>cloud service</code> operations.</li>
<li>Results are returned to the AI assistant in a structured format.</li>
</ul>
<hr />
<h3 id="welcome-k-agent-architecture-flow">K-Agent Architecture Flow<a class="headerlink" href="#welcome-k-agent-architecture-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    assistant[AI Assistant] --&gt;|MCP tool request| kagent[K-Agent MCP Server]
    kagent --&gt; toolRouter[K-Agent Tool Router]
    toolRouter --&gt;|kubeclient| k8s[Kubernetes API]
    toolRouter --&gt;|cloud sdk| clouds[Cloud Providers]
    kagent --&gt;|context updates| datastore[State &amp; Context Store]
    datastore --&gt;|observability| observ[Logs &amp; Metrics]
    k8s --&gt;|responses| kagent
    clouds --&gt;|responses| kagent
    kagent --&gt;|MCP response| assistant
    subgraph cluster [Kubernetes Cluster]
        direction LR
        k8s
        datastore
        observ
    end</code></pre>
<hr />
<h3 id="welcome-how-tdo-we-use-this-k-agent-labs">How tDo we use this K-Agent Labs<a class="headerlink" href="#welcome-how-tdo-we-use-this-k-agent-labs" title="Permanent link">&para;</a></h3>
<ul>
<li>Here&rsquo;s a brief overview of how this <code>K-Agent Labs</code> work:</li>
</ul>
<div class="grid cards">
<ul>
<li>
<h4 id="welcome-lab-structure">Lab Structure<a class="headerlink" href="#welcome-lab-structure" title="Permanent link">&para;</a></h4>
<ul>
<li>Each <code>lab</code> is a self-contained learning module with README, demo scripts, and resources.</li>
<li>Labs build upon each other (piled), starting with MCP basics and progressing to production deployments.</li>
<li>Each lab includes hands-on exercises and verification steps.</li>
</ul>
</li>
<li>
<h4 id="welcome-environment">Environment<a class="headerlink" href="#welcome-environment" title="Permanent link">&para;</a></h4>
<ul>
<li>Refer to the &ldquo;Environment Setup&rdquo; section for detailed instructions.</li>
<li>The environment is consistent across all platforms (macOS, Linux, Windows).</li>
<li>Automated scripts initialize clusters and deploy resources.</li>
</ul>
</li>
<li>
<h4 id="welcome-progressive-learning">Progressive Learning<a class="headerlink" href="#welcome-progressive-learning" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Start with MCP fundamentals and simple tools.</p>
</li>
<li>
<p>Progress through TypeScript and Python MCP server development.</p>
</li>
<li>
<p>Learn Kubernetes deployment and management.</p>
</li>
</ul>
</li>
<li>
<h4 id="welcome-hands-on-practice">Hands-On Practice<a class="headerlink" href="#welcome-hands-on-practice" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>Each lab includes executable demo scripts for automation.</p>
</li>
<li>
<p>Verify your work with provided test scripts.</p>
</li>
<li>
<p>Build real-world MCP tools that interact with Kubernetes.</p>
</li>
</ul>
</li>
</ul>
</div>
<ul>
<li>The K-Agent Labs are <strong>designed for practical learning</strong> with a focus on hands-on experience.</li>
<li>They guide you from MCP basics to production-ready deployments.</li>
<li>Labs can be completed in any supported environment (Docker Desktop, Minikube, Kind, GKE).</li>
</ul></section><section class="print-page" id="lab00-setup" heading-number="2"><h1 id="lab00-setup-lab-000-environment-setup">Lab 000 - Environment Setup<a class="headerlink" href="#lab00-setup-lab-000-environment-setup" title="Permanent link">&para;</a></h1>
<ul>
<li>Welcome to <code>K-Agent</code> Labs! </li>
<li>In this first lab, you&rsquo;ll set up your development environment with all the tools needed for the <code>K-Agent</code> infrastructure. </li>
<li>This lab covers <code>Docker</code>, <code>Kubernetes</code>, and the <code>K-Agent</code> labs environment container.</li>
</ul>
<hr />
<h4 id="lab00-setup-what-youll-learn-in-this-workshop">What you&rsquo;ll learn in this workshop:<a class="headerlink" href="#lab00-setup-what-youll-learn-in-this-workshop" title="Permanent link">&para;</a></h4>
<ul>
<li>Install and configure required tools (Docker, kubectl, Helm, Ollama, MCP Inspector, K-Agent etc.)</li>
<li>Build and run the K-Agent labs environment (Docker container or locally)</li>
<li>Verify Kubernetes cluster connectivity </li>
<li>Prepare the MCP server setup</li>
</ul>
<hr />
<h2 id="lab00-setup-01-prerequisites-installation">01. Prerequisites Installation<a class="headerlink" href="#lab00-setup-01-prerequisites-installation" title="Permanent link">&para;</a></h2>
<h3 id="lab00-setup-docker-installation">üê≥ Docker Installation<a class="headerlink" href="#lab00-setup-docker-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="lab00-setup-__tabbed_1_1" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_2" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_3" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_4" name="lab00-setup-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_1_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_1_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_1_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_1_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab00-setup-__codelineno-0-1"></a><span class="c1"># Install Docker Desktop</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab00-setup-__codelineno-0-2"></a>brew<span class="w"> </span>install<span class="w"> </span>--cask<span class="w"> </span>docker
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab00-setup-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab00-setup-__codelineno-0-4"></a><span class="c1"># Start Docker Desktop from Applications</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab00-setup-__codelineno-0-5"></a><span class="c1"># Or use command line:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab00-setup-__codelineno-0-6"></a>open<span class="w"> </span>/Applications/Docker.app
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab00-setup-__codelineno-1-1"></a><span class="c1"># Update package index</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab00-setup-__codelineno-1-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab00-setup-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#lab00-setup-__codelineno-1-4"></a><span class="c1"># Install Docker</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#lab00-setup-__codelineno-1-5"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.docker.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#lab00-setup-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#lab00-setup-__codelineno-1-7"></a><span class="c1"># Add user to docker group</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#lab00-setup-__codelineno-1-8"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#lab00-setup-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#lab00-setup-__codelineno-1-10"></a><span class="c1"># Restart session or run:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#lab00-setup-__codelineno-1-11"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab00-setup-__codelineno-2-1"></a><span class="c1"># Set up the repository</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab00-setup-__codelineno-2-2"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab00-setup-__codelineno-2-3"></a>sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://download.docker.com/linux/centos/docker-ce.repo
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab00-setup-__codelineno-2-4"></a><span class="c1"># Install Docker</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab00-setup-__codelineno-2-5"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab00-setup-__codelineno-2-6"></a><span class="c1"># Start Docker</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab00-setup-__codelineno-2-7"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab00-setup-__codelineno-2-8"></a><span class="c1"># Add user to docker group</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#lab00-setup-__codelineno-2-9"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#lab00-setup-__codelineno-2-10"></a><span class="c1"># Restart session or run:</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#lab00-setup-__codelineno-2-11"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab00-setup-__codelineno-3-1"></a><span class="c1"># Docker is pre-installed in Cloud Shell</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab00-setup-__codelineno-3-2"></a>docker<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubectl-installation">‚ò∏Ô∏è kubectl Installation<a class="headerlink" href="#lab00-setup-kubectl-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="lab00-setup-__tabbed_2_1" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_2" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_3" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_4" name="lab00-setup-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_2_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_2_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_2_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_2_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab00-setup-__codelineno-4-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab00-setup-__codelineno-5-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab00-setup-__codelineno-5-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>-o<span class="w"> </span>root<span class="w"> </span>-g<span class="w"> </span>root<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab00-setup-__codelineno-6-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span><span class="w"> </span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab00-setup-__codelineno-6-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>-o<span class="w"> </span>root<span class="w"> </span>-g<span class="w"> </span>root<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab00-setup-__codelineno-7-1"></a><span class="c1"># kubectl is pre-installed</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab00-setup-__codelineno-7-2"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-helm-installation">‚öì Helm Installation<a class="headerlink" href="#lab00-setup-helm-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="lab00-setup-__tabbed_3_1" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_2" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_3" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_4" name="lab00-setup-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_3_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_3_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_3_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_3_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab00-setup-__codelineno-8-1"></a>brew<span class="w"> </span>install<span class="w"> </span>helm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab00-setup-__codelineno-9-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab00-setup-__codelineno-10-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab00-setup-__codelineno-11-1"></a><span class="c1"># Helm is pre-installed</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab00-setup-__codelineno-11-2"></a>helm<span class="w"> </span>version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-git-installation">üêô Git Installation<a class="headerlink" href="#lab00-setup-git-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="lab00-setup-__tabbed_4_1" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_2" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_3" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_4" name="lab00-setup-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_4_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_4_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_4_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_4_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab00-setup-__codelineno-12-1"></a>brew<span class="w"> </span>install<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab00-setup-__codelineno-13-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab00-setup-__codelineno-14-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab00-setup-__codelineno-15-1"></a><span class="c1"># Git is pre-installed</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab00-setup-__codelineno-15-2"></a>git<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-python3-installation">üêç Python3 Installation<a class="headerlink" href="#lab00-setup-python3-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="5:4"><input checked="checked" id="lab00-setup-__tabbed_5_1" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_2" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_3" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_4" name="lab00-setup-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_5_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_5_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_5_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_5_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab00-setup-__codelineno-16-1"></a>brew<span class="w"> </span>install<span class="w"> </span>python
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab00-setup-__codelineno-17-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3<span class="w"> </span>python3-pip
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab00-setup-__codelineno-18-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3<span class="w"> </span>python3-pip
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab00-setup-__codelineno-19-1"></a><span class="c1"># Python3 is pre-installed</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab00-setup-__codelineno-19-2"></a>python3<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-nodejs-installation">üì¶ Node.js Installation<a class="headerlink" href="#lab00-setup-nodejs-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="6:4"><input checked="checked" id="lab00-setup-__tabbed_6_1" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_2" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_3" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_4" name="lab00-setup-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_6_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_6_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_6_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_6_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab00-setup-__codelineno-20-1"></a>brew<span class="w"> </span>install<span class="w"> </span>node
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab00-setup-__codelineno-21-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs<span class="w"> </span>npm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab00-setup-__codelineno-22-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs<span class="w"> </span>npm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab00-setup-__codelineno-23-1"></a><span class="c1"># Node.js is pre-installed</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab00-setup-__codelineno-23-2"></a>node<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-ollama-installation">ü§ñ Ollama Installation<a class="headerlink" href="#lab00-setup-ollama-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="7:4"><input checked="checked" id="lab00-setup-__tabbed_7_1" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_2" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_3" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_4" name="lab00-setup-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_7_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_7_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_7_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_7_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab00-setup-__codelineno-24-1"></a>brew<span class="w"> </span>install<span class="w"> </span>ollama
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#lab00-setup-__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#lab00-setup-__codelineno-24-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#lab00-setup-__codelineno-24-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab00-setup-__codelineno-25-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://ollama.ai/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab00-setup-__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#lab00-setup-__codelineno-25-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#lab00-setup-__codelineno-25-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab00-setup-__codelineno-26-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://ollama.ai/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#lab00-setup-__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#lab00-setup-__codelineno-26-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#lab00-setup-__codelineno-26-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab00-setup-__codelineno-27-1"></a><span class="c1"># Ollama is not supported in Cloud Shell</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab00-setup-__codelineno-27-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ollama is not supported in Cloud Shell&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-mcp-inspector-installation">üîç MCP Inspector Installation<a class="headerlink" href="#lab00-setup-mcp-inspector-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="8:4"><input checked="checked" id="lab00-setup-__tabbed_8_1" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_2" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_3" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_4" name="lab00-setup-__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_8_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_8_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_8_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_8_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab00-setup-__codelineno-28-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab00-setup-__codelineno-29-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab00-setup-__codelineno-30-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab00-setup-__codelineno-31-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubernetes-cluster-setup-minikube">Kubernetes Cluster Setup (minikube)<a class="headerlink" href="#lab00-setup-kubernetes-cluster-setup-minikube" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="9:4"><input checked="checked" id="lab00-setup-__tabbed_9_1" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_2" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_3" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_4" name="lab00-setup-__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_9_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_9_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_9_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_9_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab00-setup-__codelineno-32-1"></a>brew<span class="w"> </span>install<span class="w"> </span>minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab00-setup-__codelineno-33-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab00-setup-__codelineno-33-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>minikube-linux-amd64<span class="w"> </span>/usr/local/bin/minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab00-setup-__codelineno-34-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#lab00-setup-__codelineno-34-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>minikube-linux-amd64<span class="w"> </span>/usr/local/bin/minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab00-setup-__codelineno-35-1"></a><span class="c1"># Minikube is already installed in Cloud Shell</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab00-setup-__codelineno-35-2"></a>minikube<span class="w"> </span>version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubernetes-cluster-setup-kind">Kubernetes Cluster Setup (kind)<a class="headerlink" href="#lab00-setup-kubernetes-cluster-setup-kind" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="10:4"><input checked="checked" id="lab00-setup-__tabbed_10_1" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_2" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_3" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_4" name="lab00-setup-__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_10_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_10_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_10_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_10_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#lab00-setup-__codelineno-36-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#lab00-setup-__codelineno-37-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#lab00-setup-__codelineno-37-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#lab00-setup-__codelineno-37-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#lab00-setup-__codelineno-38-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#lab00-setup-__codelineno-38-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#lab00-setup-__codelineno-38-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#lab00-setup-__codelineno-39-1"></a>Kind<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported<span class="w"> </span><span class="k">in</span><span class="w"> </span>Cloud<span class="w"> </span>Shell<span class="w"> </span>-<span class="w"> </span>Use<span class="w"> </span>minikube<span class="w"> </span>instead
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h2 id="lab00-setup-02-verify-tools-installation">02. Verify Tools Installation<a class="headerlink" href="#lab00-setup-02-verify-tools-installation" title="Permanent link">&para;</a></h2>
<ul>
<li>Verify that all the tools are installed
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#lab00-setup-__codelineno-40-1"></a><span class="c1"># Verify Docker</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#lab00-setup-__codelineno-40-2"></a>docker<span class="w"> </span>--version
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#lab00-setup-__codelineno-40-3"></a><span class="c1"># Verify kubectl</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#lab00-setup-__codelineno-40-4"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#lab00-setup-__codelineno-40-5"></a><span class="c1"># Verify Helm</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#lab00-setup-__codelineno-40-6"></a>helm<span class="w"> </span>version
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#lab00-setup-__codelineno-40-7"></a><span class="c1"># Verify Git</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#lab00-setup-__codelineno-40-8"></a>git<span class="w"> </span>--version
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#lab00-setup-__codelineno-40-9"></a><span class="c1"># Verify Python3</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#lab00-setup-__codelineno-40-10"></a>python3<span class="w"> </span>--version
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#lab00-setup-__codelineno-40-11"></a><span class="c1"># Verify Node.js</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#lab00-setup-__codelineno-40-12"></a>node<span class="w"> </span>--version
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#lab00-setup-__codelineno-40-13"></a><span class="c1"># Verify Ollama (if installed)</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#lab00-setup-__codelineno-40-14"></a>ollama<span class="w"> </span>--version
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#lab00-setup-__codelineno-40-15"></a><span class="c1"># Verify MCP Inspector</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#lab00-setup-__codelineno-40-16"></a>mcp-inspector<span class="w"> </span>--version<span class="w"> </span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#lab00-setup-__codelineno-40-17"></a><span class="c1"># Verify Kind (if installed)</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#lab00-setup-__codelineno-40-18"></a>kind<span class="w"> </span>--version
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#lab00-setup-__codelineno-40-19"></a><span class="c1"># Verify Minikube (if installed)</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#lab00-setup-__codelineno-40-20"></a>minikube<span class="w"> </span>version
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#lab00-setup-__codelineno-40-21"></a><span class="c1"># Verify Cluster Info (if cluster is running)</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#lab00-setup-__codelineno-40-22"></a>kubectl<span class="w"> </span>cluster-info
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="lab00-setup-03-install-the-k-agent">03. Install the K-Agent<a class="headerlink" href="#lab00-setup-03-install-the-k-agent" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>K-Agent</code> labs environment is the fundamental building block for all labs.</li>
<li>Its an Open Source framework to write MCP tools and interact with Kubernetes clusters.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="11:4"><input checked="checked" id="lab00-setup-__tabbed_11_1" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_2" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_3" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_4" name="lab00-setup-__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_11_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_11_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_11_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_11_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#lab00-setup-__codelineno-41-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kagent
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>```bash
curl https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent | bash</p>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#lab00-setup-__codelineno-42-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#lab00-setup-__codelineno-43-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lab00-setup-verifty-k-agent-installation">Verifty K-Agent Installation<a class="headerlink" href="#lab00-setup-verifty-k-agent-installation" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#lab00-setup-__codelineno-44-1"></a>kagent<span class="w"> </span>version
</span></code></pre></div>
<hr />
<h2 id="lab00-setup-04-ollama-setup">04. Ollama Setup<a class="headerlink" href="#lab00-setup-04-ollama-setup" title="Permanent link">&para;</a></h2>
<ul>
<li>Ollama will be used as our LLLM model for the labs.</li>
<li>Ollama is a local LLM server that allows you to run large language models on your machine.</li>
<li>Ollama supports various models, for example: Qwen and Llama.</li>
<li>We will ise the <code>qwen3-coder</code> model which is optimized for coding tasks or the <code>gpt-oos</code> model.  </li>
</ul>
<div class="admonition info">
<p class="admonition-title">Pulling Models (Ollama)</p>
<ul>
<li>Pulling models can take a while depending on your internet speed and system performance.</li>
<li>You can skip this step and return to it later when needed.</li>
</ul>
</div>
<h4 id="lab00-setup-setup-ollama-models">Setup Ollama models<a class="headerlink" href="#lab00-setup-setup-ollama-models" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#lab00-setup-__codelineno-45-1"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#lab00-setup-__codelineno-45-2"></a>ollama<span class="w"> </span>serve
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#lab00-setup-__codelineno-45-3"></a>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#lab00-setup-__codelineno-45-4"></a><span class="c1"># In a new terminal, pull the qwen3-coder model (optimized for coding tasks)</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#lab00-setup-__codelineno-45-5"></a>ollama<span class="w"> </span>pull<span class="w"> </span>qwen3-coder:30b
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#lab00-setup-__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#lab00-setup-__codelineno-45-7"></a><span class="c1"># Alternatively, pull the gpt-oos model</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#lab00-setup-__codelineno-45-8"></a>ollama<span class="w"> </span>pull<span class="w"> </span>gpt-oos:7b
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#lab00-setup-__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#lab00-setup-__codelineno-45-10"></a><span class="c1"># Verify</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#lab00-setup-__codelineno-45-11"></a>ollama<span class="w"> </span>list
</span></code></pre></div>
<h3 id="lab00-setup-pull-a-model">Pull a Model<a class="headerlink" href="#lab00-setup-pull-a-model" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#lab00-setup-__codelineno-46-1"></a><span class="c1"># In a new terminal, pull the qwen3-coder model (optimized for coding tasks)</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#lab00-setup-__codelineno-46-2"></a>ollama<span class="w"> </span>pull<span class="w"> </span>qwen3-coder:30b
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#lab00-setup-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#lab00-setup-__codelineno-46-4"></a><span class="c1"># Verify</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#lab00-setup-__codelineno-46-5"></a>ollama<span class="w"> </span>list
</span></code></pre></div>
<hr />
<h2 id="lab00-setup-07-verify-setup">07. Verify Setup<a class="headerlink" href="#lab00-setup-07-verify-setup" title="Permanent link">&para;</a></h2>
<ul>
<li>Let&rsquo;s verify your setup by running a simple test.</li>
</ul>
<h4 id="lab00-setup-task-01-check-cluster-information">Task 01: Check Cluster Information<a class="headerlink" href="#lab00-setup-task-01-check-cluster-information" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#lab00-setup-__codelineno-47-1"></a><span class="c1"># Check cluster info</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#lab00-setup-__codelineno-47-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#lab00-setup-__codelineno-47-3"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#lab00-setup-__codelineno-47-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespaces
</span></code></pre></div>
<p><strong>Exercise 2: Test Container Environment</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#lab00-setup-__codelineno-48-1"></a><span class="c1"># Start labs environment if not running</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#lab00-setup-__codelineno-48-2"></a><span class="nb">cd</span><span class="w"> </span>labs-environment
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#lab00-setup-__codelineno-48-3"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#lab00-setup-__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#lab00-setup-__codelineno-48-5"></a><span class="c1"># Execute commands in container</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#lab00-setup-__codelineno-48-6"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kagent-controller<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#lab00-setup-__codelineno-48-7"></a><span class="s2">echo &#39;=== Environment Check ===&#39;</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#lab00-setup-__codelineno-48-8"></a><span class="s2">echo &#39;Node.js:&#39; \$(node --version)</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#lab00-setup-__codelineno-48-9"></a><span class="s2">echo &#39;Python:&#39; \$(python --version)</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#lab00-setup-__codelineno-48-10"></a><span class="s2">echo &#39;kubectl:&#39; \$(kubectl version --client --short)</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#lab00-setup-__codelineno-48-11"></a><span class="s2">echo &#39;Helm:&#39; \$(helm version --short)</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#lab00-setup-__codelineno-48-12"></a><span class="s2">echo &#39;=========================&#39;</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#lab00-setup-__codelineno-48-13"></a><span class="s2">&quot;</span>
</span></code></pre></div>
<p><strong>Expected Output:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#lab00-setup-__codelineno-49-1"></a>=== Environment Check ===
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#lab00-setup-__codelineno-49-2"></a>Node.js: v18.x.x
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#lab00-setup-__codelineno-49-3"></a>Python: Python 3.10.x
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#lab00-setup-__codelineno-49-4"></a>kubectl: Client Version: v1.28.x
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#lab00-setup-__codelineno-49-5"></a>Helm: v3.13.x
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#lab00-setup-__codelineno-49-6"></a>=========================
</span></code></pre></div></p>
<hr />
<h2 id="lab00-setup-08-troubleshooting">08. Troubleshooting<a class="headerlink" href="#lab00-setup-08-troubleshooting" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Container Won&rsquo;t Start</p>
<p>If the container fails to start, check:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#lab00-setup-__codelineno-50-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#lab00-setup-__codelineno-50-2"></a>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>kagent
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#lab00-setup-__codelineno-50-3"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Kubectl Not Working in Container</p>
<p>If kubectl commands fail in the container:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#lab00-setup-__codelineno-51-1"></a><span class="c1"># Verify kubeconfig is mounted correctly</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#lab00-setup-__codelineno-51-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kagent-controller<span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/root/.kube/
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#lab00-setup-__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#lab00-setup-__codelineno-51-4"></a><span class="c1"># Try copying kubeconfig again</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#lab00-setup-__codelineno-51-5"></a>cp<span class="w"> </span>~/.kube/config<span class="w"> </span><span class="k">$(</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--show-toplevel<span class="k">)</span>//runtime/.kube/config
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#lab00-setup-__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#lab00-setup-__codelineno-51-7"></a><span class="c1"># Restart container</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#lab00-setup-__codelineno-51-8"></a><span class="nb">cd</span><span class="w"> </span>labs-environment
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#lab00-setup-__codelineno-51-9"></a>docker<span class="w"> </span>compose<span class="w"> </span>restart
</span></code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Platform Issues (M1/M2 Mac)</p>
<p>If you encounter platform errors:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#lab00-setup-__codelineno-52-1"></a><span class="c1"># Verify platform in .env file</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#lab00-setup-__codelineno-52-2"></a>cat<span class="w"> </span>labs-environment/.env
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#lab00-setup-__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#lab00-setup-__codelineno-52-4"></a><span class="c1"># Should show: TARGET_PLATFORM=linux/arm64</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#lab00-setup-__codelineno-52-5"></a><span class="c1"># If not, update it manually</span>
</span></code></pre></div></p>
</div></section>
                    <section class='print-page md-section' id='section-3' heading-number='3'>
                        <h1>Labs<a class='headerlink' href='#section-3' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="labs" heading-number="3.1"><h1 id="labs-mcp-labs-learning-series">MCP Labs - Learning Series<a class="headerlink" href="#labs-mcp-labs-learning-series" title="Permanent link">&para;</a></h1>
<p><img src="../assets/images/mcp-feature-image.jpg" alt="MCP Feature" class="center" style="max-width:800; border-radius:20px;"/></p>
<hr />
<ul>
<li>Welcome to the Model Context Protocol (MCP) hands-on learning series! </li>
<li>This comprehensive set of labs will take you from MCP fundamentals to building production-ready MCP servers.</li>
<li><strong>Here you&rsquo;ll Learn and Build Model Context Protocol (MCP) from Scratch</strong></li>
<li>Whether you&rsquo;re new to MCP or looking to deepen your understanding, this learning series will take you from fundamentals to building production-ready MCP servers.</li>
</ul>
<hr />
<h2 id="labs-what-youll-learn">What You&rsquo;ll Learn<a class="headerlink" href="#labs-what-youll-learn" title="Permanent link">&para;</a></h2>
<p>Through these 6 progressive <a href="#labs">labs</a>, you&rsquo;ll master:</p>
<table>
<thead>
<tr>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>MCP Architecture</td>
<td>Understanding and mastering the client-server model and core concepts</td>
</tr>
<tr>
<td>Server Development</td>
<td>Building MCP servers from scratch with TypeScript using the official SDK</td>
</tr>
<tr>
<td>Tools Implementation</td>
<td>Creating sophisticated tools that interact with external systems and developing functions that LLMs can call to perform actions</td>
</tr>
<tr>
<td>Resource Management</td>
<td>Exposing contextual data through MCP resources that LLMs can read and reference</td>
</tr>
<tr>
<td>Prompt Engineering</td>
<td>Building reusable prompt templates for common tasks</td>
</tr>
<tr>
<td>Production Deployment</td>
<td>Applying best practices for real-world applications</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="labs-labs-overview">Labs Overview<a class="headerlink" href="#labs-labs-overview" title="Permanent link">&para;</a></h2>
<h3 id="labs-lab-1-mcp-fundamentals"><a href="#lab01-mcp-fundamentals">Lab 1: MCP Fundamentals</a><a class="headerlink" href="#labs-lab-1-mcp-fundamentals" title="Permanent link">&para;</a></h3>
<p>Get started with the basics! Learn what MCP is, why it exists, and understand its architecture and core components.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>What is MCP and the problem it solves</li>
<li>Client-server architecture</li>
<li>Core capabilities: Tools, Resources, and Prompts</li>
<li>MCP communication model and lifecycle</li>
<li>Common use cases</li>
</ul>
<hr />
<h3 id="labs-lab-2-building-your-first-mcp-server"><a href="#lab02-first-mcp-server">Lab 2: Building Your First MCP Server</a><a class="headerlink" href="#labs-lab-2-building-your-first-mcp-server" title="Permanent link">&para;</a></h3>
<p>Build a complete, working MCP server from the ground up.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>Project setup with Node.js and TypeScript</li>
<li>Implementing the MCP protocol</li>
<li>Creating your first tool</li>
<li>Testing with MCP Inspector</li>
<li>Connecting to Claude Desktop</li>
</ul>
<hr />
<h3 id="labs-lab-3-implementing-mcp-tools"><a href="#lab03-mcp-tools">Lab 3: Implementing MCP Tools</a><a class="headerlink" href="#labs-lab-3-implementing-mcp-tools" title="Permanent link">&para;</a></h3>
<p>Master the art of creating sophisticated, production-ready tools.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>Advanced input validation with JSON Schema</li>
<li>Real-world tool examples (Weather API, File operations, Database queries)</li>
<li>Returning rich content types</li>
<li>Error handling patterns</li>
<li>Performance optimization and caching</li>
</ul>
<hr />
<h3 id="labs-lab-4-working-with-mcp-resources"><a href="#lab04-mcp-resources">Lab 4: Working with MCP Resources</a><a class="headerlink" href="#labs-lab-4-working-with-mcp-resources" title="Permanent link">&para;</a></h3>
<p>Learn to expose contextual data that LLMs can read and reference.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>Understanding tools vs. resources</li>
<li>Implementing different resource types</li>
<li>Resource URI schemes and templates</li>
<li>Resource subscriptions for live updates</li>
<li>Combining tools and resources</li>
</ul>
<hr />
<h3 id="labs-lab-5-mcp-prompts-and-complete-integration"><a href="#lab05-mcp-prompts">Lab 5: MCP Prompts and Complete Integration</a><a class="headerlink" href="#labs-lab-5-mcp-prompts-and-complete-integration" title="Permanent link">&para;</a></h3>
<p>Complete your MCP education with prompts and production best practices.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>Creating reusable prompt templates</li>
<li>Embedding resources in prompts</li>
<li>Building a complete server with all capabilities</li>
<li>Production deployment and configuration</li>
<li>Debugging and troubleshooting</li>
</ul>
<hr />
<h3 id="labs-lab-6-k-agent-integration"><a href="#lab06-k-agent">Lab 6: K-Agent Integration</a><a class="headerlink" href="#labs-lab-6-k-agent-integration" title="Permanent link">&para;</a></h3>
<p>Implement a specialized MCP server (K-Agent) that interacts with Kubernetes clusters to provide AI-driven log collection and analysis.</p>
<p><strong>Topics:</strong></p>
<ul>
<li>MCP server architecture for Kubernetes</li>
<li>Secure communication with Kubernetes API</li>
<li>Implementing tools for pod discovery and log retrieval</li>
<li>Collecting and structuring logs for LLM consumption</li>
<li>Containerizing and deploying the K-Agent server</li>
</ul>
<hr />
<h2 id="labs-ready-to-begin">Ready to Begin?<a class="headerlink" href="#labs-ready-to-begin" title="Permanent link">&para;</a></h2>
<p><strong><a href="#lab01-mcp-fundamentals">Start with Lab 1: MCP Fundamentals ‚Üí</a></strong></p>
<p>Let&rsquo;s build something amazing with MCP!</p></section><section class="print-page" id="lab00-setup" heading-number="3.2"><h1 id="lab00-setup-lab-000-environment-setup">Lab 000 - Environment Setup<a class="headerlink" href="#lab00-setup-lab-000-environment-setup" title="Permanent link">&para;</a></h1>
<ul>
<li>Welcome to <code>K-Agent</code> Labs! </li>
<li>In this first lab, you&rsquo;ll set up your development environment with all the tools needed for the <code>K-Agent</code> infrastructure. </li>
<li>This lab covers <code>Docker</code>, <code>Kubernetes</code>, and the <code>K-Agent</code> labs environment container.</li>
</ul>
<hr />
<h4 id="lab00-setup-what-youll-learn-in-this-workshop">What you&rsquo;ll learn in this workshop:<a class="headerlink" href="#lab00-setup-what-youll-learn-in-this-workshop" title="Permanent link">&para;</a></h4>
<ul>
<li>Install and configure required tools (Docker, kubectl, Helm, Ollama, MCP Inspector, K-Agent etc.)</li>
<li>Build and run the K-Agent labs environment (Docker container or locally)</li>
<li>Verify Kubernetes cluster connectivity </li>
<li>Prepare the MCP server setup</li>
</ul>
<hr />
<h2 id="lab00-setup-01-prerequisites-installation">01. Prerequisites Installation<a class="headerlink" href="#lab00-setup-01-prerequisites-installation" title="Permanent link">&para;</a></h2>
<h3 id="lab00-setup-docker-installation">üê≥ Docker Installation<a class="headerlink" href="#lab00-setup-docker-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="lab00-setup-__tabbed_1_1" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_2" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_3" name="lab00-setup-__tabbed_1" type="radio" /><input id="lab00-setup-__tabbed_1_4" name="lab00-setup-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_1_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_1_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_1_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_1_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab00-setup-__codelineno-0-1"></a><span class="c1"># Install Docker Desktop</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab00-setup-__codelineno-0-2"></a>brew<span class="w"> </span>install<span class="w"> </span>--cask<span class="w"> </span>docker
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab00-setup-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab00-setup-__codelineno-0-4"></a><span class="c1"># Start Docker Desktop from Applications</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab00-setup-__codelineno-0-5"></a><span class="c1"># Or use command line:</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab00-setup-__codelineno-0-6"></a>open<span class="w"> </span>/Applications/Docker.app
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab00-setup-__codelineno-1-1"></a><span class="c1"># Update package index</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab00-setup-__codelineno-1-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab00-setup-__codelineno-1-3"></a>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#lab00-setup-__codelineno-1-4"></a><span class="c1"># Install Docker</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#lab00-setup-__codelineno-1-5"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.docker.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#lab00-setup-__codelineno-1-6"></a>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#lab00-setup-__codelineno-1-7"></a><span class="c1"># Add user to docker group</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#lab00-setup-__codelineno-1-8"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#lab00-setup-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#lab00-setup-__codelineno-1-10"></a><span class="c1"># Restart session or run:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#lab00-setup-__codelineno-1-11"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab00-setup-__codelineno-2-1"></a><span class="c1"># Set up the repository</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab00-setup-__codelineno-2-2"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab00-setup-__codelineno-2-3"></a>sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://download.docker.com/linux/centos/docker-ce.repo
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab00-setup-__codelineno-2-4"></a><span class="c1"># Install Docker</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab00-setup-__codelineno-2-5"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab00-setup-__codelineno-2-6"></a><span class="c1"># Start Docker</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab00-setup-__codelineno-2-7"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab00-setup-__codelineno-2-8"></a><span class="c1"># Add user to docker group</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#lab00-setup-__codelineno-2-9"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#lab00-setup-__codelineno-2-10"></a><span class="c1"># Restart session or run:</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#lab00-setup-__codelineno-2-11"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab00-setup-__codelineno-3-1"></a><span class="c1"># Docker is pre-installed in Cloud Shell</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab00-setup-__codelineno-3-2"></a>docker<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubectl-installation">‚ò∏Ô∏è kubectl Installation<a class="headerlink" href="#lab00-setup-kubectl-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="lab00-setup-__tabbed_2_1" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_2" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_3" name="lab00-setup-__tabbed_2" type="radio" /><input id="lab00-setup-__tabbed_2_4" name="lab00-setup-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_2_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_2_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_2_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_2_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab00-setup-__codelineno-4-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab00-setup-__codelineno-5-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab00-setup-__codelineno-5-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>-o<span class="w"> </span>root<span class="w"> </span>-g<span class="w"> </span>root<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab00-setup-__codelineno-6-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span><span class="w"> </span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab00-setup-__codelineno-6-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>-o<span class="w"> </span>root<span class="w"> </span>-g<span class="w"> </span>root<span class="w"> </span>-m<span class="w"> </span><span class="m">0755</span><span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/kubectl
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab00-setup-__codelineno-7-1"></a><span class="c1"># kubectl is pre-installed</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab00-setup-__codelineno-7-2"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-helm-installation">‚öì Helm Installation<a class="headerlink" href="#lab00-setup-helm-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="lab00-setup-__tabbed_3_1" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_2" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_3" name="lab00-setup-__tabbed_3" type="radio" /><input id="lab00-setup-__tabbed_3_4" name="lab00-setup-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_3_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_3_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_3_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_3_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab00-setup-__codelineno-8-1"></a>brew<span class="w"> </span>install<span class="w"> </span>helm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab00-setup-__codelineno-9-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab00-setup-__codelineno-10-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab00-setup-__codelineno-11-1"></a><span class="c1"># Helm is pre-installed</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab00-setup-__codelineno-11-2"></a>helm<span class="w"> </span>version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-git-installation">üêô Git Installation<a class="headerlink" href="#lab00-setup-git-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="lab00-setup-__tabbed_4_1" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_2" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_3" name="lab00-setup-__tabbed_4" type="radio" /><input id="lab00-setup-__tabbed_4_4" name="lab00-setup-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_4_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_4_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_4_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_4_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab00-setup-__codelineno-12-1"></a>brew<span class="w"> </span>install<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab00-setup-__codelineno-13-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab00-setup-__codelineno-14-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab00-setup-__codelineno-15-1"></a><span class="c1"># Git is pre-installed</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab00-setup-__codelineno-15-2"></a>git<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-python3-installation">üêç Python3 Installation<a class="headerlink" href="#lab00-setup-python3-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="5:4"><input checked="checked" id="lab00-setup-__tabbed_5_1" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_2" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_3" name="lab00-setup-__tabbed_5" type="radio" /><input id="lab00-setup-__tabbed_5_4" name="lab00-setup-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_5_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_5_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_5_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_5_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab00-setup-__codelineno-16-1"></a>brew<span class="w"> </span>install<span class="w"> </span>python
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab00-setup-__codelineno-17-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3<span class="w"> </span>python3-pip
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab00-setup-__codelineno-18-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>python3<span class="w"> </span>python3-pip
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab00-setup-__codelineno-19-1"></a><span class="c1"># Python3 is pre-installed</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab00-setup-__codelineno-19-2"></a>python3<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-nodejs-installation">üì¶ Node.js Installation<a class="headerlink" href="#lab00-setup-nodejs-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="6:4"><input checked="checked" id="lab00-setup-__tabbed_6_1" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_2" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_3" name="lab00-setup-__tabbed_6" type="radio" /><input id="lab00-setup-__tabbed_6_4" name="lab00-setup-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_6_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_6_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_6_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_6_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab00-setup-__codelineno-20-1"></a>brew<span class="w"> </span>install<span class="w"> </span>node
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab00-setup-__codelineno-21-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs<span class="w"> </span>npm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab00-setup-__codelineno-22-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs<span class="w"> </span>npm
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab00-setup-__codelineno-23-1"></a><span class="c1"># Node.js is pre-installed</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab00-setup-__codelineno-23-2"></a>node<span class="w"> </span>--version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-ollama-installation">ü§ñ Ollama Installation<a class="headerlink" href="#lab00-setup-ollama-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="7:4"><input checked="checked" id="lab00-setup-__tabbed_7_1" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_2" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_3" name="lab00-setup-__tabbed_7" type="radio" /><input id="lab00-setup-__tabbed_7_4" name="lab00-setup-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_7_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_7_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_7_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_7_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab00-setup-__codelineno-24-1"></a>brew<span class="w"> </span>install<span class="w"> </span>ollama
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#lab00-setup-__codelineno-24-2"></a>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#lab00-setup-__codelineno-24-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#lab00-setup-__codelineno-24-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab00-setup-__codelineno-25-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://ollama.ai/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab00-setup-__codelineno-25-2"></a>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#lab00-setup-__codelineno-25-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#lab00-setup-__codelineno-25-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab00-setup-__codelineno-26-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://ollama.ai/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#lab00-setup-__codelineno-26-2"></a>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#lab00-setup-__codelineno-26-3"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#lab00-setup-__codelineno-26-4"></a>ollama<span class="w"> </span>serve
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab00-setup-__codelineno-27-1"></a><span class="c1"># Ollama is not supported in Cloud Shell</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab00-setup-__codelineno-27-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Ollama is not supported in Cloud Shell&quot;</span>
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-mcp-inspector-installation">üîç MCP Inspector Installation<a class="headerlink" href="#lab00-setup-mcp-inspector-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="8:4"><input checked="checked" id="lab00-setup-__tabbed_8_1" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_2" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_3" name="lab00-setup-__tabbed_8" type="radio" /><input id="lab00-setup-__tabbed_8_4" name="lab00-setup-__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_8_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_8_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_8_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_8_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab00-setup-__codelineno-28-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab00-setup-__codelineno-29-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab00-setup-__codelineno-30-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab00-setup-__codelineno-31-1"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubernetes-cluster-setup-minikube">Kubernetes Cluster Setup (minikube)<a class="headerlink" href="#lab00-setup-kubernetes-cluster-setup-minikube" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="9:4"><input checked="checked" id="lab00-setup-__tabbed_9_1" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_2" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_3" name="lab00-setup-__tabbed_9" type="radio" /><input id="lab00-setup-__tabbed_9_4" name="lab00-setup-__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_9_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_9_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_9_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_9_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab00-setup-__codelineno-32-1"></a>brew<span class="w"> </span>install<span class="w"> </span>minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab00-setup-__codelineno-33-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab00-setup-__codelineno-33-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>minikube-linux-amd64<span class="w"> </span>/usr/local/bin/minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab00-setup-__codelineno-34-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span>https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#lab00-setup-__codelineno-34-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>minikube-linux-amd64<span class="w"> </span>/usr/local/bin/minikube
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab00-setup-__codelineno-35-1"></a><span class="c1"># Minikube is already installed in Cloud Shell</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab00-setup-__codelineno-35-2"></a>minikube<span class="w"> </span>version
</span></code></pre></div>
</div>
</div>
</div>
<h3 id="lab00-setup-kubernetes-cluster-setup-kind">Kubernetes Cluster Setup (kind)<a class="headerlink" href="#lab00-setup-kubernetes-cluster-setup-kind" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="10:4"><input checked="checked" id="lab00-setup-__tabbed_10_1" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_2" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_3" name="lab00-setup-__tabbed_10" type="radio" /><input id="lab00-setup-__tabbed_10_4" name="lab00-setup-__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_10_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_10_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_10_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_10_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#lab00-setup-__codelineno-36-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#lab00-setup-__codelineno-37-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#lab00-setup-__codelineno-37-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#lab00-setup-__codelineno-37-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#lab00-setup-__codelineno-38-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#lab00-setup-__codelineno-38-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#lab00-setup-__codelineno-38-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#lab00-setup-__codelineno-39-1"></a>Kind<span class="w"> </span>is<span class="w"> </span>not<span class="w"> </span>supported<span class="w"> </span><span class="k">in</span><span class="w"> </span>Cloud<span class="w"> </span>Shell<span class="w"> </span>-<span class="w"> </span>Use<span class="w"> </span>minikube<span class="w"> </span>instead
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h2 id="lab00-setup-02-verify-tools-installation">02. Verify Tools Installation<a class="headerlink" href="#lab00-setup-02-verify-tools-installation" title="Permanent link">&para;</a></h2>
<ul>
<li>Verify that all the tools are installed
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#lab00-setup-__codelineno-40-1"></a><span class="c1"># Verify Docker</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#lab00-setup-__codelineno-40-2"></a>docker<span class="w"> </span>--version
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#lab00-setup-__codelineno-40-3"></a><span class="c1"># Verify kubectl</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#lab00-setup-__codelineno-40-4"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#lab00-setup-__codelineno-40-5"></a><span class="c1"># Verify Helm</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#lab00-setup-__codelineno-40-6"></a>helm<span class="w"> </span>version
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#lab00-setup-__codelineno-40-7"></a><span class="c1"># Verify Git</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#lab00-setup-__codelineno-40-8"></a>git<span class="w"> </span>--version
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#lab00-setup-__codelineno-40-9"></a><span class="c1"># Verify Python3</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#lab00-setup-__codelineno-40-10"></a>python3<span class="w"> </span>--version
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#lab00-setup-__codelineno-40-11"></a><span class="c1"># Verify Node.js</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#lab00-setup-__codelineno-40-12"></a>node<span class="w"> </span>--version
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#lab00-setup-__codelineno-40-13"></a><span class="c1"># Verify Ollama (if installed)</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#lab00-setup-__codelineno-40-14"></a>ollama<span class="w"> </span>--version
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#lab00-setup-__codelineno-40-15"></a><span class="c1"># Verify MCP Inspector</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#lab00-setup-__codelineno-40-16"></a>mcp-inspector<span class="w"> </span>--version<span class="w"> </span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#lab00-setup-__codelineno-40-17"></a><span class="c1"># Verify Kind (if installed)</span>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#lab00-setup-__codelineno-40-18"></a>kind<span class="w"> </span>--version
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#lab00-setup-__codelineno-40-19"></a><span class="c1"># Verify Minikube (if installed)</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#lab00-setup-__codelineno-40-20"></a>minikube<span class="w"> </span>version
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#lab00-setup-__codelineno-40-21"></a><span class="c1"># Verify Cluster Info (if cluster is running)</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#lab00-setup-__codelineno-40-22"></a>kubectl<span class="w"> </span>cluster-info
</span></code></pre></div></li>
</ul>
<hr />
<h2 id="lab00-setup-03-install-the-k-agent">03. Install the K-Agent<a class="headerlink" href="#lab00-setup-03-install-the-k-agent" title="Permanent link">&para;</a></h2>
<ul>
<li>The <code>K-Agent</code> labs environment is the fundamental building block for all labs.</li>
<li>Its an Open Source framework to write MCP tools and interact with Kubernetes clusters.</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="11:4"><input checked="checked" id="lab00-setup-__tabbed_11_1" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_2" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_3" name="lab00-setup-__tabbed_11" type="radio" /><input id="lab00-setup-__tabbed_11_4" name="lab00-setup-__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="lab00-setup-__tabbed_11_1">Ô£ø macOS</label><label for="lab00-setup-__tabbed_11_2">üêß Linux (Ubuntu/Debian)</label><label for="lab00-setup-__tabbed_11_3">üêß Linux (CentOS)</label><label for="lab00-setup-__tabbed_11_4">‚òÅÔ∏è GCP Cloud Shell</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#lab00-setup-__codelineno-41-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kagent
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>```bash
curl https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent | bash</p>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#lab00-setup-__codelineno-42-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#lab00-setup-__codelineno-43-1"></a>curl<span class="w"> </span>https://raw.githubusercontent.com/kagent-dev/kagent/refs/heads/main/scripts/get-kagent<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div>
</div>
</div>
</div>
<h4 id="lab00-setup-verifty-k-agent-installation">Verifty K-Agent Installation<a class="headerlink" href="#lab00-setup-verifty-k-agent-installation" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#lab00-setup-__codelineno-44-1"></a>kagent<span class="w"> </span>version
</span></code></pre></div>
<hr />
<h2 id="lab00-setup-04-ollama-setup">04. Ollama Setup<a class="headerlink" href="#lab00-setup-04-ollama-setup" title="Permanent link">&para;</a></h2>
<ul>
<li>Ollama will be used as our LLLM model for the labs.</li>
<li>Ollama is a local LLM server that allows you to run large language models on your machine.</li>
<li>Ollama supports various models, for example: Qwen and Llama.</li>
<li>We will ise the <code>qwen3-coder</code> model which is optimized for coding tasks or the <code>gpt-oos</code> model.  </li>
</ul>
<div class="admonition info">
<p class="admonition-title">Pulling Models (Ollama)</p>
<ul>
<li>Pulling models can take a while depending on your internet speed and system performance.</li>
<li>You can skip this step and return to it later when needed.</li>
</ul>
</div>
<h4 id="lab00-setup-setup-ollama-models">Setup Ollama models<a class="headerlink" href="#lab00-setup-setup-ollama-models" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#lab00-setup-__codelineno-45-1"></a><span class="c1"># Start Ollama service</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#lab00-setup-__codelineno-45-2"></a>ollama<span class="w"> </span>serve
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#lab00-setup-__codelineno-45-3"></a>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#lab00-setup-__codelineno-45-4"></a><span class="c1"># In a new terminal, pull the qwen3-coder model (optimized for coding tasks)</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#lab00-setup-__codelineno-45-5"></a>ollama<span class="w"> </span>pull<span class="w"> </span>qwen3-coder:30b
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#lab00-setup-__codelineno-45-6"></a>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#lab00-setup-__codelineno-45-7"></a><span class="c1"># Alternatively, pull the gpt-oos model</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#lab00-setup-__codelineno-45-8"></a>ollama<span class="w"> </span>pull<span class="w"> </span>gpt-oos:7b
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#lab00-setup-__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#lab00-setup-__codelineno-45-10"></a><span class="c1"># Verify</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#lab00-setup-__codelineno-45-11"></a>ollama<span class="w"> </span>list
</span></code></pre></div>
<h3 id="lab00-setup-pull-a-model">Pull a Model<a class="headerlink" href="#lab00-setup-pull-a-model" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#lab00-setup-__codelineno-46-1"></a><span class="c1"># In a new terminal, pull the qwen3-coder model (optimized for coding tasks)</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#lab00-setup-__codelineno-46-2"></a>ollama<span class="w"> </span>pull<span class="w"> </span>qwen3-coder:30b
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#lab00-setup-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#lab00-setup-__codelineno-46-4"></a><span class="c1"># Verify</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#lab00-setup-__codelineno-46-5"></a>ollama<span class="w"> </span>list
</span></code></pre></div>
<hr />
<h2 id="lab00-setup-07-verify-setup">07. Verify Setup<a class="headerlink" href="#lab00-setup-07-verify-setup" title="Permanent link">&para;</a></h2>
<ul>
<li>Let&rsquo;s verify your setup by running a simple test.</li>
</ul>
<h4 id="lab00-setup-task-01-check-cluster-information">Task 01: Check Cluster Information<a class="headerlink" href="#lab00-setup-task-01-check-cluster-information" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#lab00-setup-__codelineno-47-1"></a><span class="c1"># Check cluster info</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#lab00-setup-__codelineno-47-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#lab00-setup-__codelineno-47-3"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#lab00-setup-__codelineno-47-4"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespaces
</span></code></pre></div>
<p><strong>Exercise 2: Test Container Environment</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#lab00-setup-__codelineno-48-1"></a><span class="c1"># Start labs environment if not running</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#lab00-setup-__codelineno-48-2"></a><span class="nb">cd</span><span class="w"> </span>labs-environment
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#lab00-setup-__codelineno-48-3"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#lab00-setup-__codelineno-48-4"></a>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#lab00-setup-__codelineno-48-5"></a><span class="c1"># Execute commands in container</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#lab00-setup-__codelineno-48-6"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kagent-controller<span class="w"> </span>bash<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#lab00-setup-__codelineno-48-7"></a><span class="s2">echo &#39;=== Environment Check ===&#39;</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#lab00-setup-__codelineno-48-8"></a><span class="s2">echo &#39;Node.js:&#39; \$(node --version)</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#lab00-setup-__codelineno-48-9"></a><span class="s2">echo &#39;Python:&#39; \$(python --version)</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#lab00-setup-__codelineno-48-10"></a><span class="s2">echo &#39;kubectl:&#39; \$(kubectl version --client --short)</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#lab00-setup-__codelineno-48-11"></a><span class="s2">echo &#39;Helm:&#39; \$(helm version --short)</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#lab00-setup-__codelineno-48-12"></a><span class="s2">echo &#39;=========================&#39;</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#lab00-setup-__codelineno-48-13"></a><span class="s2">&quot;</span>
</span></code></pre></div>
<p><strong>Expected Output:</strong>
<div class="language-text highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#lab00-setup-__codelineno-49-1"></a>=== Environment Check ===
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#lab00-setup-__codelineno-49-2"></a>Node.js: v18.x.x
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#lab00-setup-__codelineno-49-3"></a>Python: Python 3.10.x
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#lab00-setup-__codelineno-49-4"></a>kubectl: Client Version: v1.28.x
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#lab00-setup-__codelineno-49-5"></a>Helm: v3.13.x
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#lab00-setup-__codelineno-49-6"></a>=========================
</span></code></pre></div></p>
<hr />
<h2 id="lab00-setup-08-troubleshooting">08. Troubleshooting<a class="headerlink" href="#lab00-setup-08-troubleshooting" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Container Won&rsquo;t Start</p>
<p>If the container fails to start, check:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#lab00-setup-__codelineno-50-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>logs
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#lab00-setup-__codelineno-50-2"></a>docker<span class="w"> </span>images<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>kagent
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#lab00-setup-__codelineno-50-3"></a>docker<span class="w"> </span>ps<span class="w"> </span>-a
</span></code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Kubectl Not Working in Container</p>
<p>If kubectl commands fail in the container:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#lab00-setup-__codelineno-51-1"></a><span class="c1"># Verify kubeconfig is mounted correctly</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#lab00-setup-__codelineno-51-2"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>kagent-controller<span class="w"> </span>ls<span class="w"> </span>-la<span class="w"> </span>/root/.kube/
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#lab00-setup-__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#lab00-setup-__codelineno-51-4"></a><span class="c1"># Try copying kubeconfig again</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#lab00-setup-__codelineno-51-5"></a>cp<span class="w"> </span>~/.kube/config<span class="w"> </span><span class="k">$(</span>git<span class="w"> </span>rev-parse<span class="w"> </span>--show-toplevel<span class="k">)</span>//runtime/.kube/config
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#lab00-setup-__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#lab00-setup-__codelineno-51-7"></a><span class="c1"># Restart container</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#lab00-setup-__codelineno-51-8"></a><span class="nb">cd</span><span class="w"> </span>labs-environment
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#lab00-setup-__codelineno-51-9"></a>docker<span class="w"> </span>compose<span class="w"> </span>restart
</span></code></pre></div></p>
</div>
<div class="admonition warning">
<p class="admonition-title">Platform Issues (M1/M2 Mac)</p>
<p>If you encounter platform errors:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#lab00-setup-__codelineno-52-1"></a><span class="c1"># Verify platform in .env file</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#lab00-setup-__codelineno-52-2"></a>cat<span class="w"> </span>labs-environment/.env
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#lab00-setup-__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#lab00-setup-__codelineno-52-4"></a><span class="c1"># Should show: TARGET_PLATFORM=linux/arm64</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#lab00-setup-__codelineno-52-5"></a><span class="c1"># If not, update it manually</span>
</span></code></pre></div></p>
</div></section><section class="print-page" id="lab01-mcp-fundamentals" heading-number="3.3"><h1 id="lab01-mcp-fundamentals-lab-1-mcp-fundamentals">Lab 1 - MCP Fundamentals<a class="headerlink" href="#lab01-mcp-fundamentals-lab-1-mcp-fundamentals" title="Permanent link">&para;</a></h1>
<h2 id="lab01-mcp-fundamentals-overview">Overview<a class="headerlink" href="#lab01-mcp-fundamentals-overview" title="Permanent link">&para;</a></h2>
<ul>
<li><code>MCP</code> is a game-changer for AI application development .</li>
<li>In this lab, you&rsquo;ll learn about the Model Context Protocol (<code>MCP</code>), the communication standard that enables AI assistants to interact with external tools and services. </li>
<li>You&rsquo;ll explore MCP concepts, test simple tools, and understand the protocol structure.</li>
<li>
<p>This lab uses the MCP server included in the K-Agent labs environment.</p>
<div class="admonition danger">
<p class="admonition-title">Prerequisites</p>
<ul>
<li>Make sure you have completed <a href="#000-setup">Lab 000 - Environment Setup</a> before starting this lab.</li>
</ul>
</div>
</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-learning-objectives">Learning Objectives<a class="headerlink" href="#lab01-mcp-fundamentals-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Understand what <code>MCP</code> is and why it was created</li>
<li>Learn the core architecture and components of <code>MCP</code></li>
<li>Identify the key capabilities <code>MCP</code> provides</li>
<li>Understand the client-server model in <code>MCP</code></li>
<li>Recognize common use cases for <code>MCP</code></li>
<li>Learn MCP server and client communication</li>
<li>Testing MCP tools with stdio transport</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-what-is-mcp">What is MCP?<a class="headerlink" href="#lab01-mcp-fundamentals-what-is-mcp" title="Permanent link">&para;</a></h2>
<ul>
<li>The <strong>Model Context Protocol (MCP)</strong> is an open protocol that standardizes how AI applications interact with external data sources and tools. </li>
<li>It defines a structured way for AI assistants (clients) to discover, call, and receive responses from tools (servers) using JSON-RPC over various transport layers.</li>
<li>MCP is designed to be flexible and extensible, allowing developers to create custom tools that can be easily integrated with different AI models.</li>
</ul>
<hr />
<h3 id="lab01-mcp-fundamentals-what-does-mcp-offer">What does MCP offer?<a class="headerlink" href="#lab01-mcp-fundamentals-what-does-mcp-offer" title="Permanent link">&para;</a></h3>
<div class="grid cards">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-standardized-communication">Standardized Communication<a class="headerlink" href="#lab01-mcp-fundamentals-standardized-communication" title="Permanent link">&para;</a></h4>
<p>AI assistants can work with any MCP-compatible tool</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-tool-discovery">Tool Discovery<a class="headerlink" href="#lab01-mcp-fundamentals-tool-discovery" title="Permanent link">&para;</a></h4>
<p>Clients can discover available tools from servers</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-structured-interaction">Structured Interaction<a class="headerlink" href="#lab01-mcp-fundamentals-structured-interaction" title="Permanent link">&para;</a></h4>
<p>Well-defined input/output schemas using JSON</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-standardized-communication_1">Standardized Communication<a class="headerlink" href="#lab01-mcp-fundamentals-standardized-communication_1" title="Permanent link">&para;</a></h4>
<p>AI assistants can work with any MCP-compatible tool</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-tool-discovery_1">Tool Discovery<a class="headerlink" href="#lab01-mcp-fundamentals-tool-discovery_1" title="Permanent link">&para;</a></h4>
<p>Clients can discover available tools from servers</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-structured-interaction_1">Structured Interaction<a class="headerlink" href="#lab01-mcp-fundamentals-structured-interaction_1" title="Permanent link">&para;</a></h4>
<p>Well-defined input/output schemas using JSON</p>
</li>
<li>
<h4 id="lab01-mcp-fundamentals-multiple-transports">Multiple Transports<a class="headerlink" href="#lab01-mcp-fundamentals-multiple-transports" title="Permanent link">&para;</a></h4>
<p>Supports stdio, HTTP, WebSocket</p>
</li>
</ul>
</div>
<hr />
<h3 id="lab01-mcp-fundamentals-the-problem-mcp-solves">The Problem MCP Solves<a class="headerlink" href="#lab01-mcp-fundamentals-the-problem-mcp-solves" title="Permanent link">&para;</a></h3>
<p>Before <code>MCP</code>, every AI application had to build custom integrations for each data source or tool it wanted to use. This led to:</p>
<ul>
<li><strong>Fragmentation</strong>: Each app using different methods to connect to the same services</li>
<li><strong>Duplication</strong>: Developers rebuilding the same integrations repeatedly</li>
<li><strong>Limited scalability</strong>: Adding new integrations was time-consuming and error-prone</li>
<li><strong>Inconsistent experiences</strong>: No standard way for LLMs to interact with external systems</li>
</ul>
<hr />
<h3 id="lab01-mcp-fundamentals-the-mcp-solution">The MCP Solution<a class="headerlink" href="#lab01-mcp-fundamentals-the-mcp-solution" title="Permanent link">&para;</a></h3>
<p><code>MCP</code> provides a <strong>standardized protocol</strong> that:</p>
<ul>
<li>Enables <strong>universal connectivity</strong> between LLMs and data sources</li>
<li>Allows <strong>one integration to work across all MCP-compatible applications</strong></li>
<li>Provides a <strong>consistent interface</strong> for accessing tools, resources, and prompts</li>
<li>Supports <strong>secure, controlled access</strong> to external systems</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-mcp-architecture-overview">MCP Architecture Overview<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-architecture-overview" title="Permanent link">&para;</a></h2>
<p><code>MCP</code> follows a <strong>client-server architecture</strong> with clear separation of concerns:</p>
<pre class="mermaid"><code>graph TD
    A[MCP Client] --&gt; B[Ollama Module]
    A --&gt; C[IDEs &amp; Apps]
    A --&gt; D[AI Tools]
    B --&gt; E[MCP Protocol]
    C --&gt; E
    D --&gt; E
    E --&gt; F[MCP Server]
    F --&gt; G[Exposes: Tools, Resources &amp; Prompts]
    F --&gt; H[Connects to: APIs, Databases, Files, etc.]</code></pre>
<hr />
<h3 id="lab01-mcp-fundamentals-k-agent-architecture-flow">K-Agent Architecture Flow<a class="headerlink" href="#lab01-mcp-fundamentals-k-agent-architecture-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>flowchart TD
    assistant[AI Assistant] --&gt;|MCP tool request| kagent[K-Agent MCP Server]
    kagent --&gt; toolRouter[K-Agent Tool Router]
    toolRouter --&gt;|kubeclient| k8s[Kubernetes API]
    toolRouter --&gt;|cloud sdk| clouds[Cloud Providers]
    kagent --&gt;|context updates| datastore[State &amp; Context Store]
    datastore --&gt;|observability| observ[Logs &amp; Metrics]
    k8s --&gt;|responses| kagent
    clouds --&gt;|responses| kagent
    kagent --&gt;|MCP response| assistant
    subgraph cluster [Kubernetes Cluster]
        direction LR
        k8s
        datastore
        observ
    end</code></pre>
<hr />
<h2 id="lab01-mcp-fundamentals-mcp-components">MCP Components<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-components" title="Permanent link">&para;</a></h2>
<p><img src="../assets/images/MCP.svg" alt="MCP Components Diagram" class="center" style="max-width:800; border-radius:20px;"/></p>
<h3 id="lab01-mcp-fundamentals-mcp-server">MCP Server<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-server" title="Permanent link">&para;</a></h3>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-exposes-toolsresources-to-clients">Exposes tools/resources to clients<a class="headerlink" href="#lab01-mcp-fundamentals-exposes-toolsresources-to-clients" title="Permanent link">&para;</a></h4>
<ul>
<li>Provides a standardized interface for tool interaction</li>
<li>Allows AI assistants to discover and call tools</li>
<li>Manages tool lifecycle and execution</li>
<li>Handles tool errors and retries</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-implements-the-mcp-protocol">Implements the MCP protocol<a class="headerlink" href="#lab01-mcp-fundamentals-implements-the-mcp-protocol" title="Permanent link">&para;</a></h4>
<ul>
<li>Follows JSON-RPC 2.0 specification</li>
<li>Supports multiple transport layers (stdio, HTTP, WebSocket)</li>
<li>Manages tool schemas and validation</li>
<li>Supports tool discovery and listing</li>
<li>Provides structured responses</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-typical-mcp-server-features">Typical MCP Server Features<a class="headerlink" href="#lab01-mcp-fundamentals-typical-mcp-server-features" title="Permanent link">&para;</a></h4>
<ul>
<li>Runs as a standalone process or service</li>
<li>Can be deployed locally or in the cloud</li>
<li>Can run in containers or serverless environments</li>
<li>Scales based on demand</li>
<li>Monitors tool usage and performance</li>
<li>Logs tool interactions for auditing</li>
<li>Supports authentication and authorization</li>
<li>Integrates with AI assistants and applications</li>
<li>Defines tool schemas (inputs/outputs)</li>
<li>Handles tool execution</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-mcp-server-notes">MCP Server Notes<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-server-notes" title="Permanent link">&para;</a></h4>
<ul>
<li>Communicates via transport layer (stdio, HTTP, WebSocket)</li>
<li>Typically runs as a local process or container</li>
<li>In K-Agent, the MCP server exposes Kubernetes and cloud management tools.</li>
<li>The server listens for incoming MCP requests from AI assistants and executes the requested tools.</li>
<li>In our lab The server translates MCP tool calls into Kubernetes API calls or cloud service operations.</li>
<li>The server returns structured responses back to the AI assistant.</li>
<li>The server can also update context/state in a datastore for persistent information.</li>
<li>The server is implemented using the MCP SDK, which simplifies tool definition and communication handling.</li>
<li>The server supports multiple transport layers, allowing it to communicate with different types of AI assistants.</li>
</ul>
</li>
</ul>
</div>
<hr />
<h3 id="lab01-mcp-fundamentals-mcp-client">MCP Client<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-client" title="Permanent link">&para;</a></h3>
<div class="cards grid single-column">
<ul>
<li>
<h3 id="lab01-mcp-fundamentals-general-mcp-client-features">General MCP Client Features<a class="headerlink" href="#lab01-mcp-fundamentals-general-mcp-client-features" title="Permanent link">&para;</a></h3>
<ul>
<li>The application that hosts the LLM (e.g., Roo Code, VS Code, Visual Studio, etc.)</li>
<li>Discovers available tools from MCP servers</li>
<li>Sends tool call requests with parameters</li>
<li>Receives and processes tool responses</li>
<li>Manages tool invocation lifecycle</li>
<li>Handles errors and retries</li>
<li>Typically embedded in remote AI assistants (Claude, ChatGPT, etc.) or local models (Ollama, etc.)</li>
<li>Presents server capabilities to the user/LLM</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h3 id="lab01-mcp-fundamentals-the-host-application">The Host Application<a class="headerlink" href="#lab01-mcp-fundamentals-the-host-application" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>Client</code> is often part of a <strong>Host Application</strong> (like VS Code, Claude Desktop, or a CLI).</li>
<li>The Host manages the connection to the MCP Server.</li>
<li>It provides the user interface for interacting with the AI.</li>
<li>It handles permissions (asking the user before running a tool).</li>
</ul>
</li>
</ul>
</div>
<h3 id="lab01-mcp-fundamentals-client-capabilities">Client Capabilities<a class="headerlink" href="#lab01-mcp-fundamentals-client-capabilities" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Capability</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Sampling</strong></td>
<td>The server can request the client to sample an LLM (generate text).</td>
</tr>
<tr>
<td><strong>Roots</strong></td>
<td>The client can tell the server which files/folders are accessible.</td>
</tr>
<tr>
<td><strong>Notifications</strong></td>
<td>The client can receive notifications from the server (e.g. logs, progress).</td>
</tr>
<tr>
<td><strong>Context Updates</strong></td>
<td>The client can send context/state updates to the server.</td>
</tr>
<tr>
<td><strong>Authentication</strong></td>
<td>The client can provide authentication tokens/credentials to the server.</td>
</tr>
<tr>
<td><strong>Transport</strong></td>
<td>The client supports multiple transport layers (stdio, HTTP, WebSocket).</td>
</tr>
<tr>
<td><strong>Error Handling</strong></td>
<td>The client manages errors and retries for tool calls.</td>
</tr>
<tr>
<td><strong>Tool Discovery</strong></td>
<td>The client can list available tools from the server.</td>
</tr>
<tr>
<td><strong>Tool Invocation</strong></td>
<td>The client can call tools with parameters and receive structured responses.</td>
</tr>
<tr>
<td><strong>Logging</strong></td>
<td>The client can log tool interactions for auditing and debugging.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lab01-mcp-fundamentals-transport-layer-mcp-communication">Transport Layer - MCP Communication<a class="headerlink" href="#lab01-mcp-fundamentals-transport-layer-mcp-communication" title="Permanent link">&para;</a></h3>
<ul>
<li>MCP supports multiple transport mechanisms:</li>
</ul>
<table>
<thead>
<tr>
<th>Protocol</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>stdio</code></td>
<td>Standard input/output (used in K-Agent)</td>
</tr>
<tr>
<td><code>HTTP</code></td>
<td>RESTful API communication</td>
</tr>
<tr>
<td><code>WebSocket</code></td>
<td>Real-time bidirectional communication</td>
</tr>
<tr>
<td><code>gRPC</code></td>
<td>High-performance RPC framework</td>
</tr>
<tr>
<td><code>MQTT</code></td>
<td>Lightweight messaging protocol</td>
</tr>
<tr>
<td><code>Custom</code></td>
<td>Any custom transport implementation</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="lab01-mcp-fundamentals-mcp-communication-flow">MCP Communication Flow<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-communication-flow" title="Permanent link">&para;</a></h3>
<pre class="mermaid"><code>sequenceDiagram
    participant C as Client
    participant S as Server

    C-&gt;&gt;S: 1. Discover available tools
    C-&gt;&gt;S: 2. Send tool call request (parameters)
    Note over S: 3. Validate request against schema
    Note over S: 4. Execute tool logic
    S--&gt;&gt;C: 5. Return structured response
    Note over C: 6. Process response &amp; continue interaction</code></pre>
<h2 id="lab01-mcp-fundamentals-mcp-tool-structure">MCP Tool Structure<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-tool-structure" title="Permanent link">&para;</a></h2>
<ul>
<li>An MCP tool consists of:</li>
</ul>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-tool-definition">Tool Definition<a class="headerlink" href="#lab01-mcp-fundamentals-tool-definition" title="Permanent link">&para;</a></h4>
<ul>
<li>Metadata about the tool (name, description)</li>
<li>Input schema defining parameters</li>
<li>Output schema defining response structure</li>
<li>Versioning information</li>
<li>Dependencies and requirements</li>
<li>Authentication requirements</li>
<li>Rate limiting information</li>
<li>Error handling strategies</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-tool-handler">Tool Handler<a class="headerlink" href="#lab01-mcp-fundamentals-tool-handler" title="Permanent link">&para;</a></h4>
<ul>
<li>Function that implements the tool&rsquo;s logic</li>
<li>Receives input parameters</li>
<li>Performs the tool&rsquo;s operation</li>
<li>Returns structured output</li>
<li>Handles errors and exceptions</li>
<li>Logs execution details</li>
<li>Manages state/context if needed</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h4 id="lab01-mcp-fundamentals-tool-execution-flow">Tool Execution Flow<a class="headerlink" href="#lab01-mcp-fundamentals-tool-execution-flow" title="Permanent link">&para;</a></h4>
<ul>
<li>Client discovers tool from server</li>
<li>Client sends tool call request with parameters</li>
<li>Server validates request against tool schema</li>
<li>Server invokes tool handler with parameters</li>
<li>Tool handler executes logic and returns response</li>
<li>Server sends structured response back to client</li>
</ul>
</li>
</ul>
</div>
<div class="cards grid single-column">
<ul>
<li>
<h3 id="lab01-mcp-fundamentals-input-schema">Input Schema<a class="headerlink" href="#lab01-mcp-fundamentals-input-schema" title="Permanent link">&para;</a></h3>
<ul>
<li>Defines expected parameters for the tool</li>
<li>Uses JSON Schema format</li>
<li>Specifies data types, required fields, and descriptions</li>
<li>Enables validation of incoming requests</li>
<li>Facilitates client-side form generation</li>
<li>Supports complex nested structures</li>
<li>Allows default values and constraints</li>
<li>Enhances interoperability between clients and servers</li>
</ul>
</li>
</ul>
</div>
<hr />
<h2 id="lab01-mcp-fundamentals-core-mcp-capabilities">Core MCP Capabilities<a class="headerlink" href="#lab01-mcp-fundamentals-core-mcp-capabilities" title="Permanent link">&para;</a></h2>
<p><code>MCP</code> servers can expose three main types of capabilities:</p>
<h3 id="lab01-mcp-fundamentals-1-tools">1. <strong>Tools</strong><a class="headerlink" href="#lab01-mcp-fundamentals-1-tools" title="Permanent link">&para;</a></h3>
<p>Functions that the LLM can call to perform actions or retrieve information.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Search a database</li>
<li>Make an API call</li>
<li>Perform calculations</li>
<li>Execute system commands</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Defined with JSON Schema for input validation</li>
<li>Return structured results</li>
<li>Can have side effects (create, update, delete operations)</li>
</ul>
<h4 id="lab01-mcp-fundamentals-examples">Examples:<a class="headerlink" href="#lab01-mcp-fundamentals-examples" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p><strong>Tool Definition</strong>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab01-mcp-fundamentals-__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab01-mcp-fundamentals-__codelineno-0-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p">,</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab01-mcp-fundamentals-__codelineno-0-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Returns a greeting message&quot;</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab01-mcp-fundamentals-__codelineno-0-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab01-mcp-fundamentals-__codelineno-0-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab01-mcp-fundamentals-__codelineno-0-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab01-mcp-fundamentals-__codelineno-0-7"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab01-mcp-fundamentals-__codelineno-0-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#lab01-mcp-fundamentals-__codelineno-0-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Name to greet&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#lab01-mcp-fundamentals-__codelineno-0-10"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#lab01-mcp-fundamentals-__codelineno-0-11"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#lab01-mcp-fundamentals-__codelineno-0-12"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#lab01-mcp-fundamentals-__codelineno-0-13"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#lab01-mcp-fundamentals-__codelineno-0-14"></a><span class="p">}</span>
</span></code></pre></div>
</li>
<li>
<p><strong>Tool Handler:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab01-mcp-fundamentals-__codelineno-1-1"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">handleHello</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">})</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab01-mcp-fundamentals-__codelineno-1-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab01-mcp-fundamentals-__codelineno-1-3"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#lab01-mcp-fundamentals-__codelineno-1-4"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#lab01-mcp-fundamentals-__codelineno-1-5"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#lab01-mcp-fundamentals-__codelineno-1-6"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Hello, </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">!`</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#lab01-mcp-fundamentals-__codelineno-1-7"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#lab01-mcp-fundamentals-__codelineno-1-8"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#lab01-mcp-fundamentals-__codelineno-1-9"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#lab01-mcp-fundamentals-__codelineno-1-10"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<hr />
<h3 id="lab01-mcp-fundamentals-2-resources">2. <strong>Resources</strong><a class="headerlink" href="#lab01-mcp-fundamentals-2-resources" title="Permanent link">&para;</a></h3>
<p>Contextual data that can be read by the LLM.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>File contents</li>
<li>Database records</li>
<li>API responses</li>
<li>Documentation</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Identified by URI (Uniform Resource Identifier)</li>
<li>Can be text, binary, or structured data</li>
<li>Typically read-only</li>
<li>Support for templates and subscriptions</li>
</ul>
<hr />
<h3 id="lab01-mcp-fundamentals-3-prompts">3. <strong>Prompts</strong><a class="headerlink" href="#lab01-mcp-fundamentals-3-prompts" title="Permanent link">&para;</a></h3>
<p>Pre-built prompt templates that users can invoke.</p>
<p><strong>Examples:</strong></p>
<ul>
<li>Code review templates</li>
<li>Documentation generation prompts</li>
<li>Analysis frameworks</li>
<li>Interaction patterns</li>
</ul>
<p><strong>Characteristics:</strong></p>
<ul>
<li>Can include embedded resources</li>
<li>Support arguments for customization</li>
<li>Help standardize common tasks</li>
<li>Improve consistency and quality</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-the-mcp-lifecycle">The MCP Lifecycle<a class="headerlink" href="#lab01-mcp-fundamentals-the-mcp-lifecycle" title="Permanent link">&para;</a></h2>
<p>Understanding how <code>MCP</code> clients and servers interact:</p>
<h3 id="lab01-mcp-fundamentals-1-initialization">1. <strong>Initialization</strong><a class="headerlink" href="#lab01-mcp-fundamentals-1-initialization" title="Permanent link">&para;</a></h3>
<ul>
<li>Client connects to server via transport layer</li>
<li>Handshake to establish protocol version and capabilities</li>
<li>Server sends initial tool/resource/prompt listings</li>
<li>Client acknowledges and prepares for interaction</li>
</ul>
<h3 id="lab01-mcp-fundamentals-2-capability-discovery">2. <strong>Capability Discovery</strong><a class="headerlink" href="#lab01-mcp-fundamentals-2-capability-discovery" title="Permanent link">&para;</a></h3>
<ul>
<li>Client requests list of available tools, resources, or prompts</li>
<li>Server responds with detailed descriptions</li>
<li>Client presents these to the user/LLM</li>
<li>Client selects tools/resources/prompts to use</li>
</ul>
<h3 id="lab01-mcp-fundamentals-3-execution">3. <strong>Execution</strong><a class="headerlink" href="#lab01-mcp-fundamentals-3-execution" title="Permanent link">&para;</a></h3>
<ul>
<li>Client sends requests to invoke tools, read resources, or render prompts</li>
<li>Server processes the request</li>
<li>Server returns results in standardized format</li>
<li>Client handles the response and continues interaction</li>
</ul>
<h3 id="lab01-mcp-fundamentals-4-cleanup">4. <strong>Cleanup</strong><a class="headerlink" href="#lab01-mcp-fundamentals-4-cleanup" title="Permanent link">&para;</a></h3>
<ul>
<li>Either party can close the connection</li>
<li>Graceful shutdown with notifications</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-mcp-communication-model">MCP Communication Model<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-communication-model" title="Permanent link">&para;</a></h2>
<p><code>MCP</code> uses <strong>three types of messages</strong>:</p>
<h3 id="lab01-mcp-fundamentals-1-requests">1. <strong>Requests</strong><a class="headerlink" href="#lab01-mcp-fundamentals-1-requests" title="Permanent link">&para;</a></h3>
<ul>
<li>Require a response</li>
<li>Include a unique request ID</li>
<li>Examples: <code>tools/list</code>, <code>resources/read</code>, <code>tools/call</code></li>
</ul>
<h3 id="lab01-mcp-fundamentals-2-responses">2. <strong>Responses</strong><a class="headerlink" href="#lab01-mcp-fundamentals-2-responses" title="Permanent link">&para;</a></h3>
<ul>
<li>Match to requests by ID</li>
<li>Contain either results or errors</li>
<li>Must be sent for every request</li>
</ul>
<h3 id="lab01-mcp-fundamentals-3-notifications">3. <strong>Notifications</strong><a class="headerlink" href="#lab01-mcp-fundamentals-3-notifications" title="Permanent link">&para;</a></h3>
<ul>
<li>One-way messages</li>
<li>Don&rsquo;t require responses</li>
<li>Examples: <code>notifications/initialized</code>, <code>notifications/cancelled</code></li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-security-considerations">Security Considerations<a class="headerlink" href="#lab01-mcp-fundamentals-security-considerations" title="Permanent link">&para;</a></h2>
<p>When working with <code>MCP</code>, keep these best practices in mind:</p>
<ol>
<li>
<p><strong>Authentication &amp; Authorization</strong></p>
<ul>
<li>Servers should validate requests</li>
<li>Use appropriate credentials management</li>
<li>Implement least-privilege access</li>
</ul>
</li>
<li>
<p><strong>Data Privacy</strong></p>
<ul>
<li>Be mindful of what data is exposed</li>
<li>Implement proper access controls</li>
<li>Consider encryption for sensitive data</li>
</ul>
</li>
<li>
<p><strong>Rate Limiting</strong></p>
<ul>
<li>Protect against abuse</li>
<li>Implement appropriate throttling</li>
<li>Monitor usage patterns</li>
</ul>
</li>
<li>
<p><strong>Input Validation</strong></p>
<ul>
<li>Always validate tool inputs</li>
<li>Sanitize user-provided data</li>
<li>Prevent injection attacks</li>
</ul>
</li>
</ol>
<hr />
<h2 id="lab01-mcp-fundamentals-common-use-cases">Common Use Cases<a class="headerlink" href="#lab01-mcp-fundamentals-common-use-cases" title="Permanent link">&para;</a></h2>
<p><code>MCP</code> is ideal for:</p>
<h3 id="lab01-mcp-fundamentals-enterprise-integration">Enterprise Integration<a class="headerlink" href="#lab01-mcp-fundamentals-enterprise-integration" title="Permanent link">&para;</a></h3>
<ul>
<li>Connect LLMs to internal databases</li>
<li>Access corporate knowledge bases</li>
<li>Integrate with business tools (CRM, ERP, etc.)</li>
</ul>
<h3 id="lab01-mcp-fundamentals-developer-tools">Developer Tools<a class="headerlink" href="#lab01-mcp-fundamentals-developer-tools" title="Permanent link">&para;</a></h3>
<ul>
<li>File system access</li>
<li>Git operations</li>
<li>Database queries</li>
<li>API testing and documentation</li>
</ul>
<h3 id="lab01-mcp-fundamentals-data-analysis">Data Analysis<a class="headerlink" href="#lab01-mcp-fundamentals-data-analysis" title="Permanent link">&para;</a></h3>
<ul>
<li>Query and visualize data</li>
<li>Generate reports</li>
<li>Perform statistical analysis</li>
<li>Access multiple data sources</li>
</ul>
<h3 id="lab01-mcp-fundamentals-productivity">Productivity<a class="headerlink" href="#lab01-mcp-fundamentals-productivity" title="Permanent link">&para;</a></h3>
<ul>
<li>Calendar and email management</li>
<li>Task and project tracking</li>
<li>Document processing</li>
<li>Automated workflows</li>
</ul>
<hr />
<h2 id="lab01-mcp-fundamentals-mcp-vs-other-approaches">MCP vs. Other Approaches<a class="headerlink" href="#lab01-mcp-fundamentals-mcp-vs-other-approaches" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Approach</th>
<th>Pros</th>
<th>Cons</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Function Calling</strong></td>
<td>Simple, direct</td>
<td>Requires custom implementation per app</td>
</tr>
<tr>
<td><strong>API Integration</strong></td>
<td>Flexible</td>
<td>No standard, duplicated effort</td>
</tr>
<tr>
<td><strong>MCP</strong></td>
<td>Universal standard, reusable, scalable</td>
<td>Requires initial setup</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="lab01-mcp-fundamentals-hands-on-exercise">Hands-On Exercise<a class="headerlink" href="#lab01-mcp-fundamentals-hands-on-exercise" title="Permanent link">&para;</a></h2>
<h3 id="lab01-mcp-fundamentals-explore-an-mcp-server-configuration">Explore an MCP Server Configuration<a class="headerlink" href="#lab01-mcp-fundamentals-explore-an-mcp-server-configuration" title="Permanent link">&para;</a></h3>
<p>Look at how an <code>MCP</code> server is configured in a client application (like Roo Code):</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab01-mcp-fundamentals-__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab01-mcp-fundamentals-__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;mcpServers&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab01-mcp-fundamentals-__codelineno-2-3"></a><span class="w">    </span><span class="nt">&quot;example-server&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab01-mcp-fundamentals-__codelineno-2-4"></a><span class="w">      </span><span class="nt">&quot;command&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab01-mcp-fundamentals-__codelineno-2-5"></a><span class="w">      </span><span class="nt">&quot;args&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;/path/to/server/index.js&quot;</span><span class="p">],</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab01-mcp-fundamentals-__codelineno-2-6"></a><span class="w">      </span><span class="nt">&quot;env&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab01-mcp-fundamentals-__codelineno-2-7"></a><span class="w">        </span><span class="nt">&quot;API_KEY&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;your-api-key&quot;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab01-mcp-fundamentals-__codelineno-2-8"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#lab01-mcp-fundamentals-__codelineno-2-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#lab01-mcp-fundamentals-__codelineno-2-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#lab01-mcp-fundamentals-__codelineno-2-11"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="lab01-mcp-fundamentals-testing-mcp-tools-ts">Testing MCP Tools (TS)<a class="headerlink" href="#lab01-mcp-fundamentals-testing-mcp-tools-ts" title="Permanent link">&para;</a></h2>
<h3 id="lab01-mcp-fundamentals-using-mcp-inspector">Using MCP Inspector<a class="headerlink" href="#lab01-mcp-fundamentals-using-mcp-inspector" title="Permanent link">&para;</a></h3>
<p><code>MCP Inspector</code> is a tool for testing MCP servers interactively.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab01-mcp-fundamentals-__codelineno-3-1"></a><span class="c1"># Install mcp-inspector (if not already installed)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab01-mcp-fundamentals-__codelineno-3-2"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#lab01-mcp-fundamentals-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#lab01-mcp-fundamentals-__codelineno-3-4"></a><span class="c1"># Start the MCP Inspector with the TS code</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#lab01-mcp-fundamentals-__codelineno-3-5"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>./build/index.js
</span></code></pre></div>
<div class="admonition info">
<p class="admonition-title">MCP Inspector UI</p>
<ul>
<li>MCP Inspector will start a web interface at <code>http://localhost:6274</code></li>
<li>You can also test tools programmatically using the examples below.</li>
</ul>
</div>
<hr />
<p><strong>Step-by-step MCP Inspector Testing:</strong></p>
<ol>
<li>
<p>Get the Authentication Token<br />
   When you start MCP Inspector, the terminal displays:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab01-mcp-fundamentals-__codelineno-4-1"></a>üîë Session token: [long-token-string]
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#lab01-mcp-fundamentals-__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#lab01-mcp-fundamentals-__codelineno-4-3"></a>üîó Open inspector with token pre-filled:
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#lab01-mcp-fundamentals-__codelineno-4-4"></a>    http://localhost:6274/?MCP_PROXY_AUTH_TOKEN=[token]
</span></code></pre></div>
</li>
<li>
<p>Copy the Authentication URL<br />
   Copy the complete URL with the token (the second line starting with <code>http://</code>)</p>
</li>
<li>
<p>Open MCP Inspector in Your Browser<br />
   Paste the complete URL from step 2 into your browser. You&rsquo;ll be authenticated immediately.</p>
</li>
<li>
<p>Configure the Server Connection<br />
   In the MCP Inspector interface:</p>
<ul>
<li>Verify the <strong>&ldquo;Transport&rdquo;</strong> is set to <strong><code>stdio</code></strong> (NOT http or streamable-http)</li>
<li>You&rsquo;ll see a <strong>&ldquo;Command&rdquo;</strong> field - it should already show: <code>node</code></li>
<li>look for the <strong>&ldquo;Argument&rdquo;</strong> field - it should show: <code>/app/build/index.js</code></li>
<li>Click the <strong>&ldquo;Connect&rdquo;</strong> button</li>
<li>Wait for the status to show <strong>&ldquo;Connected&rdquo;</strong> with a green indicator</li>
</ul>
</li>
<li>
<p>Explore Available Tools:</p>
<ul>
<li>Once connected, click on the <strong>&ldquo;Tools&rdquo;</strong> tab at the top of the interface, and the on <strong>&ldquo;List Tools&rdquo;</strong> button</li>
<li>You&rsquo;ll see a list of available tools from your MCP server</li>
</ul>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title">Authentication Required</p>
<ul>
<li>The MCP Inspector requires authentication by default. </li>
<li>Always use the URL with the token (shown in the terminal when you start the inspector), or manually enter the token in the Configuration settings. </li>
<li>If you forget the token, restart the MCP Inspector to generate a new one.</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Disabling Authentication (Development Only)</p>
<p>Y* ou can disable authentication by setting the <code>DANGEROUSLY_OMIT_AUTH=true</code> environment variable:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab01-mcp-fundamentals-__codelineno-5-1"></a><span class="nv">DANGEROUSLY_OMIT_AUTH</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>/app/build/index.js
</span></code></pre></div>
<strong>‚ö†Ô∏è WARNING</strong>: This is dangerous and should ONLY be used in isolated development environments, never in production or when exposed to the internet.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Keep MCP Inspector Running</p>
<ul>
<li>Make sure the MCP Inspector command (<code>npx @modelcontextprotocol/inspector node /app/build/index.js</code>) is still running in your terminal. </li>
<li>If the connection fails or you see errors, restart the command in the container.</li>
</ul>
</div>
<div class="admonition tip">
<p class="admonition-title">Interactive Testing</p>
<ul>
<li>The MCP Inspector provides a user-friendly web interface to test your MCP server without writing code. </li>
<li>This is perfect for debugging and understanding how MCP tools work before integrating them with AI assistants.</li>
</ul>
</div>
<div class="admonition explore">
<p class="admonition-title">Understanding MCP Inspector Output</p>
<ul>
<li>The Inspector displays tool results in a readable format. </li>
<li>Internally, MCP uses JSON-RPC 2.0 protocol with structured responses, but the UI shows you the human-readable content. </li>
<li>For JSON view, see the &ldquo;History&rdquo; section below the UI</li>
</ul>
</div>
<hr />
<p><strong>Ready to build your first MCP server? <a href="#lab02-first-mcp-server">Continue to Lab 2!</a></strong></p></section><section class="print-page" id="lab02-first-mcp-server" heading-number="3.4"><h1 id="lab02-first-mcp-server-lab-2-building-your-first-mcp-server">Lab 2: Building Your First MCP Server<a class="headerlink" href="#lab02-first-mcp-server-lab-2-building-your-first-mcp-server" title="Permanent link">&para;</a></h1>
<h2 id="lab02-first-mcp-server-overview">Overview<a class="headerlink" href="#lab02-first-mcp-server-overview" title="Permanent link">&para;</a></h2>
<ul>
<li>Now that you understand the fundamentals of <code>MCP</code>, it&rsquo;s time to get hands-on! </li>
<li>In this lab, you&rsquo;ll build a complete, working <code>MCP</code> server from scratch. </li>
<li>You&rsquo;ll learn how to set up the project, implement the core protocol, and connect it to an <code>MCP</code> client.</li>
</ul>
<hr />
<h2 id="lab02-first-mcp-server-learning-objectives">Learning Objectives<a class="headerlink" href="#lab02-first-mcp-server-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Set up a <code>Node.js / TypeScript / Python</code> project for <code>MCP</code> development</li>
<li>Implement the <code>MCP</code> initialization handshake</li>
<li>Create a basic server structure using the <code>MCP</code> SDK</li>
<li>Test your server with a real <code>MCP</code> client</li>
<li>Understand the request/response lifecycle</li>
<li>Debug and troubleshoot common issues</li>
</ul>
<hr />
<h2 id="lab02-first-mcp-server-prerequisites">Prerequisites<a class="headerlink" href="#lab02-first-mcp-server-prerequisites" title="Permanent link">&para;</a></h2>
<p>Before starting, ensure you have:</p>
<ul>
<li><strong>Node.js</strong> (v18 or later) installed</li>
<li><strong>Python</strong> (v3.8 or later) installed</li>
<li><strong>npm</strong> or <strong>yarn</strong> package manager</li>
<li>A code editor (<strong>VS Code</strong> recommended)</li>
<li>Basic understanding of <strong>JavaScript</strong> / <strong>TypeScript</strong> / <strong>Python</strong></li>
<li>Familiarity with <strong>JSON</strong> and <strong>HTTP</strong></li>
<li>Basic knowledge of <strong>MCP concepts</strong> from <a href="#lab01-mcp-fundamentals">Lab 1</a></li>
</ul>
<p>To verify your prerequisites are installed correctly, run the following commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab02-first-mcp-server-__codelineno-0-1"></a><span class="c1"># Check Node.js version</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab02-first-mcp-server-__codelineno-0-2"></a>node<span class="w"> </span>--version
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab02-first-mcp-server-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab02-first-mcp-server-__codelineno-0-4"></a><span class="c1"># Check npm version</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab02-first-mcp-server-__codelineno-0-5"></a>npm<span class="w"> </span>--version
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab02-first-mcp-server-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab02-first-mcp-server-__codelineno-0-7"></a><span class="c1"># Check Python version</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab02-first-mcp-server-__codelineno-0-8"></a>python3<span class="w"> </span>--version
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#lab02-first-mcp-server-__codelineno-0-9"></a>python<span class="w"> </span>--version
</span></code></pre></div>
<hr />
<h2 id="lab02-first-mcp-server-project-setup">Project Setup<a class="headerlink" href="#lab02-first-mcp-server-project-setup" title="Permanent link">&para;</a></h2>
<h3 id="lab02-first-mcp-server-step-1-initialize-your-project">Step 1: Initialize Your Project<a class="headerlink" href="#lab02-first-mcp-server-step-1-initialize-your-project" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Create a new directory for your <code>MCP</code> server, navigate into it, and initialize a new <code>Node.js</code> / <code>Python</code> project:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab02-first-mcp-server-__codelineno-1-1"></a>mkdir<span class="w"> </span>my-first-mcp-server
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab02-first-mcp-server-__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>my-first-mcp-server
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-step-2-install-dependencies">Step 2: Install Dependencies<a class="headerlink" href="#lab02-first-mcp-server-step-2-install-dependencies" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_1_1" name="lab02-first-mcp-server-__tabbed_1" type="radio" /><input id="lab02-first-mcp-server-__tabbed_1_2" name="lab02-first-mcp-server-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_1_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_1_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>
<p>Install the MCP SDK and TypeScript dependencies using npm and build tool:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab02-first-mcp-server-__codelineno-2-1"></a><span class="c1"># Core MCP SDK</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab02-first-mcp-server-__codelineno-2-2"></a>npm<span class="w"> </span>install<span class="w"> </span>@modelcontextprotocol/sdk
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab02-first-mcp-server-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab02-first-mcp-server-__codelineno-2-4"></a><span class="c1"># TypeScript and type definitions</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab02-first-mcp-server-__codelineno-2-5"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>typescript<span class="w"> </span>@types/node
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab02-first-mcp-server-__codelineno-2-6"></a>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab02-first-mcp-server-__codelineno-2-7"></a><span class="c1"># Build tool</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab02-first-mcp-server-__codelineno-2-8"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>tsx
</span></code></pre></div></p>
</li>
<li>
<p>To verify TypeScript installation:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab02-first-mcp-server-__codelineno-3-1"></a>tsc<span class="w"> </span>--version
</span></code></pre></div></p>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>
<p>For this lab, we&rsquo;ll use <strong>FastMCP</strong> which simplifies MCP server development with a Flask-like decorator syntax.</p>
</li>
<li>
<p>Create a <code>requirements.txt</code> file:
  <div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab02-first-mcp-server-__codelineno-4-1"></a>mcp
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#lab02-first-mcp-server-__codelineno-4-2"></a>fastmcp
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#lab02-first-mcp-server-__codelineno-4-3"></a>uvicorn
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#lab02-first-mcp-server-__codelineno-4-4"></a>httpx
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#lab02-first-mcp-server-__codelineno-4-5"></a>starlette
</span></code></pre></div></p>
</li>
<li>
<p>Install <strong>uv</strong> (fast Python package installer) if not already installed:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab02-first-mcp-server-__codelineno-5-1"></a>curl<span class="w"> </span>-LsSf<span class="w"> </span>https://astral.sh/uv/install.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span></code></pre></div></p>
</li>
<li>
<p>Create and activate a virtual environment, then install dependencies:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab02-first-mcp-server-__codelineno-6-1"></a><span class="c1"># Create virtual environment using uv</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab02-first-mcp-server-__codelineno-6-2"></a>uv<span class="w"> </span>venv
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#lab02-first-mcp-server-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#lab02-first-mcp-server-__codelineno-6-4"></a><span class="c1"># Activate virtual environment</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#lab02-first-mcp-server-__codelineno-6-5"></a><span class="nb">source</span><span class="w"> </span>.venv/bin/activate<span class="w">  </span><span class="c1"># On Windows use `.venv\Scripts\activate`</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#lab02-first-mcp-server-__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#lab02-first-mcp-server-__codelineno-6-7"></a><span class="c1"># Install dependencies</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#lab02-first-mcp-server-__codelineno-6-8"></a>uv<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
</span></code></pre></div></p>
</li>
<li>
<p>To verify installation:
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab02-first-mcp-server-__codelineno-7-1"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;import mcp; print(&#39;MCP installed successfully&#39;)&quot;</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab02-first-mcp-server-__codelineno-7-2"></a>python<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;from mcp.server.fastmcp import FastMCP; print(&#39;FastMCP ready&#39;)&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
</div>
</div>
</div>
<hr />
<h3 id="lab02-first-mcp-server-step-3-configure-your-project">Step 3: Configure Your Project<a class="headerlink" href="#lab02-first-mcp-server-step-3-configure-your-project" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_2_1" name="lab02-first-mcp-server-__tabbed_2" type="radio" /><input id="lab02-first-mcp-server-__tabbed_2_2" name="lab02-first-mcp-server-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_2_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_2_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Create a <code>tsconfig.json</code> file:
    <div class="language-json highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab02-first-mcp-server-__codelineno-8-1"></a><span class="p">{</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#lab02-first-mcp-server-__codelineno-8-2"></a><span class="w">  </span><span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#lab02-first-mcp-server-__codelineno-8-3"></a><span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES2022&quot;</span><span class="p">,</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#lab02-first-mcp-server-__codelineno-8-4"></a><span class="w">    </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node16&quot;</span><span class="p">,</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#lab02-first-mcp-server-__codelineno-8-5"></a><span class="w">    </span><span class="nt">&quot;moduleResolution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node16&quot;</span><span class="p">,</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#lab02-first-mcp-server-__codelineno-8-6"></a><span class="w">    </span><span class="nt">&quot;outDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./dist&quot;</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#lab02-first-mcp-server-__codelineno-8-7"></a><span class="w">    </span><span class="nt">&quot;rootDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./src&quot;</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#lab02-first-mcp-server-__codelineno-8-8"></a><span class="w">    </span><span class="nt">&quot;strict&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#lab02-first-mcp-server-__codelineno-8-9"></a><span class="w">    </span><span class="nt">&quot;esModuleInterop&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#lab02-first-mcp-server-__codelineno-8-10"></a><span class="w">    </span><span class="nt">&quot;skipLibCheck&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#lab02-first-mcp-server-__codelineno-8-11"></a><span class="w">    </span><span class="nt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#lab02-first-mcp-server-__codelineno-8-12"></a><span class="w">    </span><span class="nt">&quot;resolveJsonModule&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#lab02-first-mcp-server-__codelineno-8-13"></a><span class="w">    </span><span class="nt">&quot;declaration&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#lab02-first-mcp-server-__codelineno-8-14"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#lab02-first-mcp-server-__codelineno-8-15"></a><span class="w">  </span><span class="nt">&quot;include&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src/**/*&quot;</span><span class="p">],</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#lab02-first-mcp-server-__codelineno-8-16"></a><span class="w">  </span><span class="nt">&quot;exclude&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node_modules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dist&quot;</span><span class="p">]</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#lab02-first-mcp-server-__codelineno-8-17"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Replace (copy / paste) the entire content of the file <code>package.json</code>, located inside the previously created <code>my-first-mcp-server</code> directory with this:
    <div class="language-json highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab02-first-mcp-server-__codelineno-9-1"></a><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#lab02-first-mcp-server-__codelineno-9-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#lab02-first-mcp-server-__codelineno-9-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#lab02-first-mcp-server-__codelineno-9-4"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;module&quot;</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#lab02-first-mcp-server-__codelineno-9-5"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My first MCP server&quot;</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#lab02-first-mcp-server-__codelineno-9-6"></a><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dist/index.js&quot;</span><span class="p">,</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#lab02-first-mcp-server-__codelineno-9-7"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#lab02-first-mcp-server-__codelineno-9-8"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#lab02-first-mcp-server-__codelineno-9-9"></a><span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsx src/index.ts&quot;</span><span class="p">,</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#lab02-first-mcp-server-__codelineno-9-10"></a><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node dist/index.js&quot;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#lab02-first-mcp-server-__codelineno-9-11"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#lab02-first-mcp-server-__codelineno-9-12"></a><span class="w">  </span><span class="nt">&quot;keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;mcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;server&quot;</span><span class="p">],</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#lab02-first-mcp-server-__codelineno-9-13"></a><span class="w">  </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Your Name&quot;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#lab02-first-mcp-server-__codelineno-9-14"></a><span class="p">}</span>
</span></code></pre></div></li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>Create a <code>requirements.txt</code> file with the necessary dependencies (if not created in Step 2):
  <div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab02-first-mcp-server-__codelineno-10-1"></a>mcp
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#lab02-first-mcp-server-__codelineno-10-2"></a>fastmcp
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#lab02-first-mcp-server-__codelineno-10-3"></a>uvicorn
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#lab02-first-mcp-server-__codelineno-10-4"></a>httpx
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#lab02-first-mcp-server-__codelineno-10-5"></a>starlette
</span></code></pre></div></li>
</ul>
</div>
</div>
</div>
<hr />
<h3 id="lab02-first-mcp-server-step-4-create-the-mcp-server">Step 4: Create the MCP Server<a class="headerlink" href="#lab02-first-mcp-server-step-4-create-the-mcp-server" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_3_1" name="lab02-first-mcp-server-__tabbed_3" type="radio" /><input id="lab02-first-mcp-server-__tabbed_3_2" name="lab02-first-mcp-server-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_3_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_3_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<ul>
<li>Create a directory named <code>src</code> inside <code>my-first-mcp-server</code>.</li>
<li>
<p>Create a file named <code>index.ts</code> inside the <code>src</code> directory and fill it with the following basic server skeleton code (copy / paste inside the file):</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab02-first-mcp-server-__codelineno-11-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab02-first-mcp-server-__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#lab02-first-mcp-server-__codelineno-11-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#lab02-first-mcp-server-__codelineno-11-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#lab02-first-mcp-server-__codelineno-11-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#lab02-first-mcp-server-__codelineno-11-6"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#lab02-first-mcp-server-__codelineno-11-7"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#lab02-first-mcp-server-__codelineno-11-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#lab02-first-mcp-server-__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#lab02-first-mcp-server-__codelineno-11-10"></a><span class="cm">/**</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#lab02-first-mcp-server-__codelineno-11-11"></a><span class="cm">* Create an MCP server with core capabilities</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#lab02-first-mcp-server-__codelineno-11-12"></a><span class="cm">*/</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#lab02-first-mcp-server-__codelineno-11-13"></a><span class="kd">class</span><span class="w"> </span><span class="nx">MyFirstMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#lab02-first-mcp-server-__codelineno-11-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#lab02-first-mcp-server-__codelineno-11-15"></a>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#lab02-first-mcp-server-__codelineno-11-16"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#lab02-first-mcp-server-__codelineno-11-17"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#lab02-first-mcp-server-__codelineno-11-18"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#lab02-first-mcp-server-__codelineno-11-19"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#lab02-first-mcp-server-__codelineno-11-20"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#lab02-first-mcp-server-__codelineno-11-21"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#lab02-first-mcp-server-__codelineno-11-22"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#lab02-first-mcp-server-__codelineno-11-23"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#lab02-first-mcp-server-__codelineno-11-24"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#lab02-first-mcp-server-__codelineno-11-25"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#lab02-first-mcp-server-__codelineno-11-26"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#lab02-first-mcp-server-__codelineno-11-27"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#lab02-first-mcp-server-__codelineno-11-28"></a>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#lab02-first-mcp-server-__codelineno-11-29"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#lab02-first-mcp-server-__codelineno-11-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#lab02-first-mcp-server-__codelineno-11-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#lab02-first-mcp-server-__codelineno-11-32"></a>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#lab02-first-mcp-server-__codelineno-11-33"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#lab02-first-mcp-server-__codelineno-11-34"></a><span class="cm">  * Set up request handlers</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#lab02-first-mcp-server-__codelineno-11-35"></a><span class="cm">  */</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#lab02-first-mcp-server-__codelineno-11-36"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#lab02-first-mcp-server-__codelineno-11-37"></a><span class="w">    </span><span class="c1">// Handler for listing available tools</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#lab02-first-mcp-server-__codelineno-11-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#lab02-first-mcp-server-__codelineno-11-39"></a><span class="w">      </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#lab02-first-mcp-server-__codelineno-11-40"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#lab02-first-mcp-server-__codelineno-11-41"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#lab02-first-mcp-server-__codelineno-11-42"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#lab02-first-mcp-server-__codelineno-11-43"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">,</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#lab02-first-mcp-server-__codelineno-11-44"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Returns a friendly greeting message&quot;</span><span class="p">,</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#lab02-first-mcp-server-__codelineno-11-45"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#lab02-first-mcp-server-__codelineno-11-46"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#lab02-first-mcp-server-__codelineno-11-47"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#lab02-first-mcp-server-__codelineno-11-48"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#lab02-first-mcp-server-__codelineno-11-49"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#lab02-first-mcp-server-__codelineno-11-50"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The name to greet&quot;</span><span class="p">,</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#lab02-first-mcp-server-__codelineno-11-51"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#lab02-first-mcp-server-__codelineno-11-52"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#lab02-first-mcp-server-__codelineno-11-53"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#lab02-first-mcp-server-__codelineno-11-54"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#lab02-first-mcp-server-__codelineno-11-55"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#lab02-first-mcp-server-__codelineno-11-56"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#lab02-first-mcp-server-__codelineno-11-57"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#lab02-first-mcp-server-__codelineno-11-58"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#lab02-first-mcp-server-__codelineno-11-59"></a>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#lab02-first-mcp-server-__codelineno-11-60"></a><span class="w">    </span><span class="c1">// Handler for calling tools</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#lab02-first-mcp-server-__codelineno-11-61"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#lab02-first-mcp-server-__codelineno-11-62"></a><span class="w">      </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#lab02-first-mcp-server-__codelineno-11-63"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#lab02-first-mcp-server-__codelineno-11-64"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#lab02-first-mcp-server-__codelineno-11-65"></a>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#lab02-first-mcp-server-__codelineno-11-66"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#lab02-first-mcp-server-__codelineno-11-67"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#lab02-first-mcp-server-__codelineno-11-68"></a>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#lab02-first-mcp-server-__codelineno-11-69"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#lab02-first-mcp-server-__codelineno-11-70"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter is required&quot;</span><span class="p">);</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#lab02-first-mcp-server-__codelineno-11-71"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#lab02-first-mcp-server-__codelineno-11-72"></a>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#lab02-first-mcp-server-__codelineno-11-73"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#lab02-first-mcp-server-__codelineno-11-74"></a><span class="w">            </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#lab02-first-mcp-server-__codelineno-11-75"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#lab02-first-mcp-server-__codelineno-11-76"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#lab02-first-mcp-server-__codelineno-11-77"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Hello, </span><span class="si">${</span><span class="nx">userName</span><span class="si">}</span><span class="sb">! Welcome to your first MCP server! üéâ`</span><span class="p">,</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#lab02-first-mcp-server-__codelineno-11-78"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#lab02-first-mcp-server-__codelineno-11-79"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#lab02-first-mcp-server-__codelineno-11-80"></a><span class="w">          </span><span class="p">};</span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#lab02-first-mcp-server-__codelineno-11-81"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#lab02-first-mcp-server-__codelineno-11-82"></a>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#lab02-first-mcp-server-__codelineno-11-83"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#lab02-first-mcp-server-__codelineno-11-84"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#lab02-first-mcp-server-__codelineno-11-85"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86" href="#lab02-first-mcp-server-__codelineno-11-86"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87" href="#lab02-first-mcp-server-__codelineno-11-87"></a>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88" href="#lab02-first-mcp-server-__codelineno-11-88"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89" href="#lab02-first-mcp-server-__codelineno-11-89"></a><span class="cm">  * Set up error handling</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90" href="#lab02-first-mcp-server-__codelineno-11-90"></a><span class="cm">  */</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91" href="#lab02-first-mcp-server-__codelineno-11-91"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92" href="#lab02-first-mcp-server-__codelineno-11-92"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93" href="#lab02-first-mcp-server-__codelineno-11-93"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94" href="#lab02-first-mcp-server-__codelineno-11-94"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95" href="#lab02-first-mcp-server-__codelineno-11-95"></a>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96" href="#lab02-first-mcp-server-__codelineno-11-96"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97" href="#lab02-first-mcp-server-__codelineno-11-97"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98" href="#lab02-first-mcp-server-__codelineno-11-98"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99" href="#lab02-first-mcp-server-__codelineno-11-99"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100" href="#lab02-first-mcp-server-__codelineno-11-100"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101" href="#lab02-first-mcp-server-__codelineno-11-101"></a>
</span><span id="__span-11-102"><a id="__codelineno-11-102" name="__codelineno-11-102" href="#lab02-first-mcp-server-__codelineno-11-102"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-11-103"><a id="__codelineno-11-103" name="__codelineno-11-103" href="#lab02-first-mcp-server-__codelineno-11-103"></a><span class="cm">  * Start the server</span>
</span><span id="__span-11-104"><a id="__codelineno-11-104" name="__codelineno-11-104" href="#lab02-first-mcp-server-__codelineno-11-104"></a><span class="cm">  */</span>
</span><span id="__span-11-105"><a id="__codelineno-11-105" name="__codelineno-11-105" href="#lab02-first-mcp-server-__codelineno-11-105"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-106"><a id="__codelineno-11-106" name="__codelineno-11-106" href="#lab02-first-mcp-server-__codelineno-11-106"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-11-107"><a id="__codelineno-11-107" name="__codelineno-11-107" href="#lab02-first-mcp-server-__codelineno-11-107"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-11-108"><a id="__codelineno-11-108" name="__codelineno-11-108" href="#lab02-first-mcp-server-__codelineno-11-108"></a>
</span><span id="__span-11-109"><a id="__codelineno-11-109" name="__codelineno-11-109" href="#lab02-first-mcp-server-__codelineno-11-109"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;My First MCP Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-11-110"><a id="__codelineno-11-110" name="__codelineno-11-110" href="#lab02-first-mcp-server-__codelineno-11-110"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-111"><a id="__codelineno-11-111" name="__codelineno-11-111" href="#lab02-first-mcp-server-__codelineno-11-111"></a><span class="p">}</span>
</span><span id="__span-11-112"><a id="__codelineno-11-112" name="__codelineno-11-112" href="#lab02-first-mcp-server-__codelineno-11-112"></a>
</span><span id="__span-11-113"><a id="__codelineno-11-113" name="__codelineno-11-113" href="#lab02-first-mcp-server-__codelineno-11-113"></a><span class="cm">/**</span>
</span><span id="__span-11-114"><a id="__codelineno-11-114" name="__codelineno-11-114" href="#lab02-first-mcp-server-__codelineno-11-114"></a><span class="cm">* Main entry point</span>
</span><span id="__span-11-115"><a id="__codelineno-11-115" name="__codelineno-11-115" href="#lab02-first-mcp-server-__codelineno-11-115"></a><span class="cm">*/</span>
</span><span id="__span-11-116"><a id="__codelineno-11-116" name="__codelineno-11-116" href="#lab02-first-mcp-server-__codelineno-11-116"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-117"><a id="__codelineno-11-117" name="__codelineno-11-117" href="#lab02-first-mcp-server-__codelineno-11-117"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MyFirstMCPServer</span><span class="p">();</span>
</span><span id="__span-11-118"><a id="__codelineno-11-118" name="__codelineno-11-118" href="#lab02-first-mcp-server-__codelineno-11-118"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-11-119"><a id="__codelineno-11-119" name="__codelineno-11-119" href="#lab02-first-mcp-server-__codelineno-11-119"></a><span class="p">}</span>
</span><span id="__span-11-120"><a id="__codelineno-11-120" name="__codelineno-11-120" href="#lab02-first-mcp-server-__codelineno-11-120"></a>
</span><span id="__span-11-121"><a id="__codelineno-11-121" name="__codelineno-11-121" href="#lab02-first-mcp-server-__codelineno-11-121"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-122"><a id="__codelineno-11-122" name="__codelineno-11-122" href="#lab02-first-mcp-server-__codelineno-11-122"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-11-123"><a id="__codelineno-11-123" name="__codelineno-11-123" href="#lab02-first-mcp-server-__codelineno-11-123"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-11-124"><a id="__codelineno-11-124" name="__codelineno-11-124" href="#lab02-first-mcp-server-__codelineno-11-124"></a><span class="p">});</span>
</span></code></pre></div>
</li>
</ul>
</div>
<div class="tabbed-block">
<ul>
<li>
<p>Create a file named <code>mcp.py</code> in the root of <code>my-first-mcp-server</code> directory and add the following code:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab02-first-mcp-server-__codelineno-12-1"></a><span class="ch">#!/usr/bin/env python3</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#lab02-first-mcp-server-__codelineno-12-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#lab02-first-mcp-server-__codelineno-12-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">JSONResponse</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#lab02-first-mcp-server-__codelineno-12-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#lab02-first-mcp-server-__codelineno-12-5"></a>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#lab02-first-mcp-server-__codelineno-12-6"></a><span class="c1"># Create FastMCP server instance</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#lab02-first-mcp-server-__codelineno-12-7"></a><span class="c1"># This will listen on port 8889</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#lab02-first-mcp-server-__codelineno-12-8"></a><span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8889</span><span class="p">)</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#lab02-first-mcp-server-__codelineno-12-9"></a>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#lab02-first-mcp-server-__codelineno-12-10"></a><span class="c1"># CORS headers for browser-based inspector</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#lab02-first-mcp-server-__codelineno-12-11"></a><span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#lab02-first-mcp-server-__codelineno-12-12"></a>    <span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#lab02-first-mcp-server-__codelineno-12-13"></a>    <span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">:</span> <span class="s2">&quot;GET,POST,OPTIONS&quot;</span><span class="p">,</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#lab02-first-mcp-server-__codelineno-12-14"></a>    <span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">:</span> <span class="s2">&quot;Content-Type,Authorization,X-Proxy-Token&quot;</span><span class="p">,</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#lab02-first-mcp-server-__codelineno-12-15"></a><span class="p">}</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#lab02-first-mcp-server-__codelineno-12-16"></a>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#lab02-first-mcp-server-__codelineno-12-17"></a><span class="c1"># Define a simple hello tool using @mcp.tool() decorator</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#lab02-first-mcp-server-__codelineno-12-18"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#lab02-first-mcp-server-__codelineno-12-19"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#lab02-first-mcp-server-__codelineno-12-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a friendly greeting message&quot;&quot;&quot;</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#lab02-first-mcp-server-__codelineno-12-21"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to your first MCP server! üéâ&quot;</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#lab02-first-mcp-server-__codelineno-12-22"></a>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#lab02-first-mcp-server-__codelineno-12-23"></a><span class="c1"># Health check endpoint</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#lab02-first-mcp-server-__codelineno-12-24"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#lab02-first-mcp-server-__codelineno-12-25"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#lab02-first-mcp-server-__codelineno-12-26"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#lab02-first-mcp-server-__codelineno-12-27"></a>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#lab02-first-mcp-server-__codelineno-12-28"></a><span class="c1"># MCP Manifest endpoint</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#lab02-first-mcp-server-__codelineno-12-29"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/.well-known/mcp&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#lab02-first-mcp-server-__codelineno-12-30"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_manifest</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#lab02-first-mcp-server-__codelineno-12-31"></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:8889&quot;</span><span class="p">)</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#lab02-first-mcp-server-__codelineno-12-32"></a>    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s2">&quot;http&quot;</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#lab02-first-mcp-server-__codelineno-12-33"></a>    <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#lab02-first-mcp-server-__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#lab02-first-mcp-server-__codelineno-12-35"></a>    <span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#lab02-first-mcp-server-__codelineno-12-36"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#lab02-first-mcp-server-__codelineno-12-37"></a>        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#lab02-first-mcp-server-__codelineno-12-38"></a>        <span class="s2">&quot;base_url&quot;</span><span class="p">:</span> <span class="n">base</span><span class="p">,</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#lab02-first-mcp-server-__codelineno-12-39"></a>        <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#lab02-first-mcp-server-__codelineno-12-40"></a>        <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#lab02-first-mcp-server-__codelineno-12-41"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#lab02-first-mcp-server-__codelineno-12-42"></a>            <span class="s2">&quot;prompts&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#lab02-first-mcp-server-__codelineno-12-43"></a>            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#lab02-first-mcp-server-__codelineno-12-44"></a>        <span class="p">},</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#lab02-first-mcp-server-__codelineno-12-45"></a>        <span class="s2">&quot;endpoints&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#lab02-first-mcp-server-__codelineno-12-46"></a>            <span class="s2">&quot;manifest&quot;</span><span class="p">:</span> <span class="s2">&quot;/.well-known/mcp&quot;</span><span class="p">,</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#lab02-first-mcp-server-__codelineno-12-47"></a>            <span class="s2">&quot;health&quot;</span><span class="p">:</span> <span class="s2">&quot;/health&quot;</span><span class="p">,</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#lab02-first-mcp-server-__codelineno-12-48"></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="s2">&quot;/mcp&quot;</span><span class="p">,</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#lab02-first-mcp-server-__codelineno-12-49"></a>        <span class="p">},</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#lab02-first-mcp-server-__codelineno-12-50"></a>    <span class="p">}</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#lab02-first-mcp-server-__codelineno-12-51"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#lab02-first-mcp-server-__codelineno-12-52"></a>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#lab02-first-mcp-server-__codelineno-12-53"></a><span class="c1"># Server metadata endpoint</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#lab02-first-mcp-server-__codelineno-12-54"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/metadata&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#lab02-first-mcp-server-__codelineno-12-55"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#lab02-first-mcp-server-__codelineno-12-56"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#lab02-first-mcp-server-__codelineno-12-57"></a>        <span class="s2">&quot;serverInfo&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#lab02-first-mcp-server-__codelineno-12-58"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#lab02-first-mcp-server-__codelineno-12-59"></a>            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#lab02-first-mcp-server-__codelineno-12-60"></a>            <span class="s2">&quot;protocolVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-05&quot;</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#lab02-first-mcp-server-__codelineno-12-61"></a>        <span class="p">},</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#lab02-first-mcp-server-__codelineno-12-62"></a>        <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#lab02-first-mcp-server-__codelineno-12-63"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;listChanged&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#lab02-first-mcp-server-__codelineno-12-64"></a>        <span class="p">}</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#lab02-first-mcp-server-__codelineno-12-65"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#lab02-first-mcp-server-__codelineno-12-66"></a>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#lab02-first-mcp-server-__codelineno-12-67"></a><span class="c1"># Main entry point</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#lab02-first-mcp-server-__codelineno-12-68"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#lab02-first-mcp-server-__codelineno-12-69"></a>    <span class="c1"># Start the MCP server with streamable-http transport</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#lab02-first-mcp-server-__codelineno-12-70"></a>    <span class="c1"># Mounted at /mcp path</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#lab02-first-mcp-server-__codelineno-12-71"></a>    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span> <span class="n">mount_path</span><span class="o">=</span><span class="s2">&quot;/mcp&quot;</span><span class="p">)</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#lab02-first-mcp-server-__codelineno-12-72"></a>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#lab02-first-mcp-server-__codelineno-12-73"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#lab02-first-mcp-server-__codelineno-12-74"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div>
</li>
</ul>
</div>
</div>
</div>
<hr />
<h2 id="lab02-first-mcp-server-understanding-the-code">Understanding the Code<a class="headerlink" href="#lab02-first-mcp-server-understanding-the-code" title="Permanent link">&para;</a></h2>
<p>Let&rsquo;s break down the key components:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_4_1" name="lab02-first-mcp-server-__tabbed_4" type="radio" /><input id="lab02-first-mcp-server-__tabbed_4_2" name="lab02-first-mcp-server-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_4_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_4_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-1-server-initialization">1. <strong>Server Initialization</strong><a class="headerlink" href="#lab02-first-mcp-server-1-server-initialization" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab02-first-mcp-server-__codelineno-13-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#lab02-first-mcp-server-__codelineno-13-2"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#lab02-first-mcp-server-__codelineno-13-3"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#lab02-first-mcp-server-__codelineno-13-4"></a><span class="w">    </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#lab02-first-mcp-server-__codelineno-13-5"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#lab02-first-mcp-server-__codelineno-13-6"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#lab02-first-mcp-server-__codelineno-13-7"></a><span class="w">    </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#lab02-first-mcp-server-__codelineno-13-8"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#lab02-first-mcp-server-__codelineno-13-9"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#lab02-first-mcp-server-__codelineno-13-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#lab02-first-mcp-server-__codelineno-13-11"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>Defines server metadata (name and version)</li>
<li>Declares capabilities (in this case, the server supports tools)</li>
<li>This information is sent during the initialization handshake</li>
</ul>
<h3 id="lab02-first-mcp-server-2-list-tools-handler">2. <strong>List Tools Handler</strong><a class="headerlink" href="#lab02-first-mcp-server-2-list-tools-handler" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab02-first-mcp-server-__codelineno-14-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#lab02-first-mcp-server-__codelineno-14-2"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#lab02-first-mcp-server-__codelineno-14-3"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#lab02-first-mcp-server-__codelineno-14-4"></a><span class="w">    </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[...],</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#lab02-first-mcp-server-__codelineno-14-5"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#lab02-first-mcp-server-__codelineno-14-6"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>Responds to <code>tools/list</code> requests from clients</li>
<li>Returns an array of tool definitions</li>
<li>Each tool has: name, description and inputSchema (JSON Schema)</li>
</ul>
<h3 id="lab02-first-mcp-server-3-call-tool-handler">3. <strong>Call Tool Handler</strong><a class="headerlink" href="#lab02-first-mcp-server-3-call-tool-handler" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab02-first-mcp-server-__codelineno-15-1"></a><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab02-first-mcp-server-__codelineno-15-2"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#lab02-first-mcp-server-__codelineno-15-3"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#lab02-first-mcp-server-__codelineno-15-4"></a><span class="w">    </span><span class="c1">// Tool execution logic</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#lab02-first-mcp-server-__codelineno-15-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#lab02-first-mcp-server-__codelineno-15-6"></a><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>Responds to <code>tools/call</code> requests</li>
<li>Receives tool name and arguments</li>
<li>Returns tool results in a standardized format</li>
</ul>
<h3 id="lab02-first-mcp-server-4-transport-layer">4. <strong>Transport Layer</strong><a class="headerlink" href="#lab02-first-mcp-server-4-transport-layer" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab02-first-mcp-server-__codelineno-16-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#lab02-first-mcp-server-__codelineno-16-2"></a><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span></code></pre></div>
<ul>
<li>Uses stdio (standard input/output) for communication</li>
<li>Server runs as a subprocess of the client</li>
<li>All <code>MCP</code> messages flow through stdin/stdout</li>
</ul>
</div>
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-1-server-initialization-with-fastmcp">1. <strong>Server Initialization with FastMCP</strong><a class="headerlink" href="#lab02-first-mcp-server-1-server-initialization-with-fastmcp" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab02-first-mcp-server-__codelineno-17-1"></a><span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8889</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>Creates a FastMCP server instance with a name and port</li>
<li>FastMCP uses a Flask-like decorator syntax for simplicity</li>
<li>The server will listen on port 8889 for HTTP connections</li>
</ul>
<h3 id="lab02-first-mcp-server-2-tool-definition-with-decorators">2. <strong>Tool Definition with Decorators</strong><a class="headerlink" href="#lab02-first-mcp-server-2-tool-definition-with-decorators" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab02-first-mcp-server-__codelineno-18-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#lab02-first-mcp-server-__codelineno-18-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#lab02-first-mcp-server-__codelineno-18-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a friendly greeting message&quot;&quot;&quot;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#lab02-first-mcp-server-__codelineno-18-4"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to your first MCP server! üéâ&quot;</span>
</span></code></pre></div>
<ul>
<li>The <code>@mcp.tool()</code> decorator automatically registers the function as an MCP tool</li>
<li>Function signature defines the input parameters (with type hints)</li>
<li>Docstring becomes the tool description</li>
<li>Return value is automatically formatted as MCP response</li>
</ul>
<h3 id="lab02-first-mcp-server-3-custom-routes-for-mcp-protocol">3. <strong>Custom Routes for MCP Protocol</strong><a class="headerlink" href="#lab02-first-mcp-server-3-custom-routes-for-mcp-protocol" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab02-first-mcp-server-__codelineno-19-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab02-first-mcp-server-__codelineno-19-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#lab02-first-mcp-server-__codelineno-19-3"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;healthy&quot;</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>Custom routes handle MCP protocol endpoints</li>
<li>Support for CORS headers enables browser-based inspector access</li>
<li>Returns JSON responses following MCP specification</li>
</ul>
<h3 id="lab02-first-mcp-server-4-transport-layer_1">4. <strong>Transport Layer</strong><a class="headerlink" href="#lab02-first-mcp-server-4-transport-layer_1" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab02-first-mcp-server-__codelineno-20-1"></a><span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span> <span class="n">mount_path</span><span class="o">=</span><span class="s2">&quot;/mcp&quot;</span><span class="p">)</span>
</span></code></pre></div>
<ul>
<li>Uses streamable-http transport for bi-directional communication</li>
<li>Mounts the MCP protocol handler at <code>/mcp</code> path</li>
<li>Server runs with uvicorn ASGI server automatically</li>
</ul>
<h3 id="lab02-first-mcp-server-5-tool-execution-helper-why-get_tool_function">5. <strong>Tool Execution Helper - Why <code>get_tool_function</code>?</strong><a class="headerlink" href="#lab02-first-mcp-server-5-tool-execution-helper-why-get_tool_function" title="Permanent link">&para;</a></h3>
<p>In more advanced MCP servers (like the full example in <code>mcp.py</code>), you&rsquo;ll see a helper function called <code>get_tool_function</code>:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab02-first-mcp-server-__codelineno-21-1"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#lab02-first-mcp-server-__codelineno-21-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the actual function for a tool by name&quot;&quot;&quot;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#lab02-first-mcp-server-__codelineno-21-3"></a>    <span class="n">tool_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#lab02-first-mcp-server-__codelineno-21-4"></a>        <span class="s1">&#39;hello_world&#39;</span><span class="p">:</span> <span class="n">hello_world</span><span class="p">,</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#lab02-first-mcp-server-__codelineno-21-5"></a>        <span class="s1">&#39;calculate&#39;</span><span class="p">:</span> <span class="n">calculate</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#lab02-first-mcp-server-__codelineno-21-6"></a>        <span class="s1">&#39;echo&#39;</span><span class="p">:</span> <span class="n">echo</span><span class="p">,</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#lab02-first-mcp-server-__codelineno-21-7"></a>    <span class="p">}</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#lab02-first-mcp-server-__codelineno-21-8"></a>    <span class="k">return</span> <span class="n">tool_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Why do we need this?</strong></p>
<ol>
<li>
<p><strong>Dynamic Tool Execution</strong>: When the MCP Inspector or client sends a tool call request with just the tool name as a string (e.g., <code>"hello_world"</code>), we need to map that string to the actual Python function.</p>
</li>
<li>
<p><strong>Decoupling Tool Registration from Execution</strong>: While <code>@mcp.tool()</code> decorator handles registration, for custom execution workflows (like tracking execution history, adding middleware, or batch execution), we need direct access to the tool functions.</p>
</li>
<li>
<p><strong>Tool Validation</strong>: Before executing a tool, we can verify it exists in our tool map, providing better error messages if a non-existent tool is called.</p>
</li>
<li>
<p><strong>Execution Tracking</strong>: In the full <code>mcp.py</code> example, we use this helper to:</p>
</li>
<li>Track tool execution history</li>
<li>Measure execution time</li>
<li>Log tool calls</li>
<li>Handle errors consistently</li>
</ol>
<p><strong>Example usage in execution flow:</strong></p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab02-first-mcp-server-__codelineno-22-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#lab02-first-mcp-server-__codelineno-22-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a tool and return the result&quot;&quot;&quot;</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#lab02-first-mcp-server-__codelineno-22-3"></a>    <span class="c1"># Get the actual function by name</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#lab02-first-mcp-server-__codelineno-22-4"></a>    <span class="n">tool_func</span> <span class="o">=</span> <span class="n">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#lab02-first-mcp-server-__codelineno-22-5"></a>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#lab02-first-mcp-server-__codelineno-22-6"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#lab02-first-mcp-server-__codelineno-22-7"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">}</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#lab02-first-mcp-server-__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#lab02-first-mcp-server-__codelineno-22-9"></a>    <span class="c1"># Validate arguments against function signature</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#lab02-first-mcp-server-__codelineno-22-10"></a>    <span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#lab02-first-mcp-server-__codelineno-22-11"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#lab02-first-mcp-server-__codelineno-22-12"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">}</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#lab02-first-mcp-server-__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#lab02-first-mcp-server-__codelineno-22-14"></a>    <span class="c1"># Execute the tool</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#lab02-first-mcp-server-__codelineno-22-15"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span> <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span> <span class="k">else</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#lab02-first-mcp-server-__codelineno-22-16"></a>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#lab02-first-mcp-server-__codelineno-22-17"></a>    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use it:</strong></p>
<ul>
<li>Building custom execution endpoints (<code>/tools/execute</code>, <code>/tools/batch</code>)</li>
<li>Adding execution middleware (logging, timing, caching)</li>
<li>Implementing tool execution history</li>
<li>Creating custom validation or error handling</li>
<li>Not needed for basic MCP servers where <code>@mcp.tool()</code> handles everything</li>
</ul>
<div class="admonition tip">
<p class="admonition-title">Simplified vs Advanced Approach</p>
<p>For this lab&rsquo;s basic server, <code>@mcp.tool()</code> decorator is sufficient. The <code>get_tool_function</code> pattern is useful when you need more control over tool execution, which you&rsquo;ll see in advanced labs.</p>
</div>
<h3 id="lab02-first-mcp-server-6-the-execute_tool-function-complete-tool-execution-pipeline">6. <strong>The <code>execute_tool</code> Function - Complete Tool Execution Pipeline</strong><a class="headerlink" href="#lab02-first-mcp-server-6-the-execute_tool-function-complete-tool-execution-pipeline" title="Permanent link">&para;</a></h3>
<p>The <code>execute_tool</code> function is the heart of custom tool execution. It orchestrates the entire lifecycle of a tool call:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab02-first-mcp-server-__codelineno-23-1"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab02-first-mcp-server-__codelineno-23-2"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a tool and return the result&quot;&quot;&quot;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#lab02-first-mcp-server-__codelineno-23-3"></a>    <span class="k">global</span> <span class="n">EXECUTION_COUNTER</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#lab02-first-mcp-server-__codelineno-23-4"></a>    <span class="n">execution_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;exec_</span><span class="si">{</span><span class="n">EXECUTION_COUNTER</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#lab02-first-mcp-server-__codelineno-23-5"></a>    <span class="n">EXECUTION_COUNTER</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#lab02-first-mcp-server-__codelineno-23-6"></a>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#lab02-first-mcp-server-__codelineno-23-7"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#lab02-first-mcp-server-__codelineno-23-8"></a>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#lab02-first-mcp-server-__codelineno-23-9"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#lab02-first-mcp-server-__codelineno-23-10"></a>        <span class="c1"># 1. Lookup the tool function</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#lab02-first-mcp-server-__codelineno-23-11"></a>        <span class="n">tool_func</span> <span class="o">=</span> <span class="n">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#lab02-first-mcp-server-__codelineno-23-12"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#lab02-first-mcp-server-__codelineno-23-13"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#lab02-first-mcp-server-__codelineno-23-14"></a>                <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#lab02-first-mcp-server-__codelineno-23-15"></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#lab02-first-mcp-server-__codelineno-23-16"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#lab02-first-mcp-server-__codelineno-23-17"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#lab02-first-mcp-server-__codelineno-23-18"></a>                <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#lab02-first-mcp-server-__codelineno-23-19"></a>            <span class="p">}</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#lab02-first-mcp-server-__codelineno-23-20"></a>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#lab02-first-mcp-server-__codelineno-23-21"></a>        <span class="c1"># 2. Validate arguments</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#lab02-first-mcp-server-__codelineno-23-22"></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#lab02-first-mcp-server-__codelineno-23-23"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#lab02-first-mcp-server-__codelineno-23-24"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#lab02-first-mcp-server-__codelineno-23-25"></a>                <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#lab02-first-mcp-server-__codelineno-23-26"></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#lab02-first-mcp-server-__codelineno-23-27"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#lab02-first-mcp-server-__codelineno-23-28"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#lab02-first-mcp-server-__codelineno-23-29"></a>                <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#lab02-first-mcp-server-__codelineno-23-30"></a>            <span class="p">}</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#lab02-first-mcp-server-__codelineno-23-31"></a>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#lab02-first-mcp-server-__codelineno-23-32"></a>        <span class="c1"># 3. Execute the tool (handle both sync and async)</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#lab02-first-mcp-server-__codelineno-23-33"></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#lab02-first-mcp-server-__codelineno-23-34"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#lab02-first-mcp-server-__codelineno-23-35"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#lab02-first-mcp-server-__codelineno-23-36"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#lab02-first-mcp-server-__codelineno-23-37"></a>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#lab02-first-mcp-server-__codelineno-23-38"></a>        <span class="c1"># 4. Record successful execution</span>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#lab02-first-mcp-server-__codelineno-23-39"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#lab02-first-mcp-server-__codelineno-23-40"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#lab02-first-mcp-server-__codelineno-23-41"></a>            <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#lab02-first-mcp-server-__codelineno-23-42"></a>            <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#lab02-first-mcp-server-__codelineno-23-43"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#lab02-first-mcp-server-__codelineno-23-44"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#lab02-first-mcp-server-__codelineno-23-45"></a>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#lab02-first-mcp-server-__codelineno-23-46"></a>            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#lab02-first-mcp-server-__codelineno-23-47"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#lab02-first-mcp-server-__codelineno-23-48"></a>        <span class="p">}</span>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#lab02-first-mcp-server-__codelineno-23-49"></a>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#lab02-first-mcp-server-__codelineno-23-50"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#lab02-first-mcp-server-__codelineno-23-51"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52" href="#lab02-first-mcp-server-__codelineno-23-52"></a>
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53" href="#lab02-first-mcp-server-__codelineno-23-53"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54" href="#lab02-first-mcp-server-__codelineno-23-54"></a>        <span class="c1"># 5. Record failed execution</span>
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55" href="#lab02-first-mcp-server-__codelineno-23-55"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56" href="#lab02-first-mcp-server-__codelineno-23-56"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57" href="#lab02-first-mcp-server-__codelineno-23-57"></a>            <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58" href="#lab02-first-mcp-server-__codelineno-23-58"></a>            <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59" href="#lab02-first-mcp-server-__codelineno-23-59"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60" href="#lab02-first-mcp-server-__codelineno-23-60"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61" href="#lab02-first-mcp-server-__codelineno-23-61"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62" href="#lab02-first-mcp-server-__codelineno-23-62"></a>            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63" href="#lab02-first-mcp-server-__codelineno-23-63"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64" href="#lab02-first-mcp-server-__codelineno-23-64"></a>        <span class="p">}</span>
</span><span id="__span-23-65"><a id="__codelineno-23-65" name="__codelineno-23-65" href="#lab02-first-mcp-server-__codelineno-23-65"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-23-66"><a id="__codelineno-23-66" name="__codelineno-23-66" href="#lab02-first-mcp-server-__codelineno-23-66"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span></code></pre></div>
<p><strong>What does <code>execute_tool</code> do?</strong></p>
<ol>
<li>
<p><strong>Generates Execution ID</strong>: Creates a unique identifier for tracking this specific tool execution
   <div class="language-python highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab02-first-mcp-server-__codelineno-24-1"></a><span class="n">execution_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;exec_</span><span class="si">{</span><span class="n">EXECUTION_COUNTER</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Tool Lookup</strong>: Uses <code>get_tool_function()</code> to find the actual Python function</p>
</li>
<li>Returns error immediately if tool doesn&rsquo;t exist</li>
<li>
<p>Avoids crashes from undefined tools</p>
</li>
<li>
<p><strong>Argument Validation</strong>: Validates parameters against the function signature</p>
</li>
<li>Checks for required parameters</li>
<li>Detects unexpected parameters</li>
<li>
<p>Provides clear error messages</p>
</li>
<li>
<p><strong>Async/Sync Execution</strong>: Handles both synchronous and asynchronous tools
   <div class="language-python highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab02-first-mcp-server-__codelineno-25-1"></a><span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab02-first-mcp-server-__codelineno-25-2"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#lab02-first-mcp-server-__codelineno-25-3"></a><span class="k">else</span><span class="p">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#lab02-first-mcp-server-__codelineno-25-4"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Performance Tracking</strong>: Measures execution time in milliseconds
   <div class="language-python highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab02-first-mcp-server-__codelineno-26-1"></a><span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Execution History</strong>: Stores all executions (success and failure) in <code>TOOL_EXECUTIONS</code> dictionary</p>
</li>
<li>Enables debugging</li>
<li>Supports execution history endpoint (<code>/tools/history</code>)</li>
<li>
<p>Helps track tool usage patterns</p>
</li>
<li>
<p><strong>Structured Responses</strong>: Returns consistent response format:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab02-first-mcp-server-__codelineno-27-1"></a><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab02-first-mcp-server-__codelineno-27-2"></a>    <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="s2">&quot;exec_0&quot;</span><span class="p">,</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#lab02-first-mcp-server-__codelineno-27-3"></a>    <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="s2">&quot;hello_world&quot;</span><span class="p">,</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#lab02-first-mcp-server-__codelineno-27-4"></a>    <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Alice&quot;</span><span class="p">},</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#lab02-first-mcp-server-__codelineno-27-5"></a>    <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#lab02-first-mcp-server-__codelineno-27-6"></a>    <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="s2">&quot;Hello, Alice!&quot;</span><span class="p">,</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#lab02-first-mcp-server-__codelineno-27-7"></a>    <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mf">1.23</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#lab02-first-mcp-server-__codelineno-27-8"></a>    <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="mf">1704931200.0</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#lab02-first-mcp-server-__codelineno-27-9"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<p><strong>Why use <code>execute_tool</code> instead of calling tools directly?</strong></p>
<table>
<thead>
<tr>
<th>Direct Call</th>
<th>Through <code>execute_tool</code></th>
</tr>
</thead>
<tbody>
<tr>
<td><code>result = hello_world(name="Alice")</code></td>
<td><code>result = await execute_tool("hello_world", {"name": "Alice"})</code></td>
</tr>
<tr>
<td>No validation</td>
<td>Argument validation</td>
</tr>
<tr>
<td>No error tracking</td>
<td>Error records</td>
</tr>
<tr>
<td>No timing data</td>
<td>Performance metrics</td>
</tr>
<tr>
<td>No execution history</td>
<td>Complete audit trail</td>
</tr>
<tr>
<td>Manual async handling</td>
<td>Automatic async detection</td>
</tr>
</tbody>
</table>
<p><strong>Where is <code>execute_tool</code> used?</strong></p>
<ol>
<li>
<p><strong>Custom Execution Endpoint</strong> (<code>/tools/execute</code>):
   <div class="language-python highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab02-first-mcp-server-__codelineno-28-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/execute&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#lab02-first-mcp-server-__codelineno-28-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#lab02-first-mcp-server-__codelineno-28-3"></a>    <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#lab02-first-mcp-server-__codelineno-28-4"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">body</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">],</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#lab02-first-mcp-server-__codelineno-28-5"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Batch Execution</strong> (<code>/tools/batch</code>):
   <div class="language-python highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab02-first-mcp-server-__codelineno-29-1"></a><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#lab02-first-mcp-server-__codelineno-29-2"></a><span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#lab02-first-mcp-server-__codelineno-29-3"></a>    <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">call</span><span class="p">[</span><span class="s2">&quot;tool&quot;</span><span class="p">],</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="p">{}))</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#lab02-first-mcp-server-__codelineno-29-4"></a>    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Streaming Execution</strong> (<code>/tools/stream</code>):
   <div class="language-python highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab02-first-mcp-server-__codelineno-30-1"></a><span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#lab02-first-mcp-server-__codelineno-30-2"></a><span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span><span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">})</span>
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition info">
<p class="admonition-title">Production Benefits</p>
<ul>
<li><strong>Observability</strong>: Track which tools are used most, their success rates, and performance</li>
<li><strong>Debugging</strong>: View execution history with <code>/tools/history</code> endpoint</li>
<li><strong>Error Analysis</strong>: See all failures with context and timing</li>
<li><strong>API Consistency</strong>: All execution endpoints return the same structure</li>
<li><strong>Audit Trail</strong>: Complete log of all tool invocations</li>
</ul>
</div>
</div>
</div>
</div>
<hr />
<h2 id="lab02-first-mcp-server-testing-your-server">Testing Your Server<a class="headerlink" href="#lab02-first-mcp-server-testing-your-server" title="Permanent link">&para;</a></h2>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_5_1" name="lab02-first-mcp-server-__tabbed_5" type="radio" /><input id="lab02-first-mcp-server-__tabbed_5_2" name="lab02-first-mcp-server-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_5_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_5_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-testing-with-the-mcp-inspector">Testing with the MCP Inspector<a class="headerlink" href="#lab02-first-mcp-server-testing-with-the-mcp-inspector" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>The MCP Inspector is a web-based tool for testing MCP servers. Run these commands from your <code>my-first-mcp-server</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab02-first-mcp-server-__codelineno-31-1"></a><span class="c1"># Install the inspector globally</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#lab02-first-mcp-server-__codelineno-31-2"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#lab02-first-mcp-server-__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#lab02-first-mcp-server-__codelineno-31-4"></a><span class="c1"># Run your server with the inspector</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#lab02-first-mcp-server-__codelineno-31-5"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>--transport<span class="w"> </span>stdio<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
</li>
<li>
<p>This will open a web interface where you can:</p>
<ul>
<li>See the server&rsquo;s capabilities</li>
<li>List available tools</li>
<li>Call tools with test inputs</li>
<li>View request/response messages</li>
</ul>
</li>
</ul>
</div>
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-testing-with-the-mcp-inspector_1">Testing with the MCP Inspector<a class="headerlink" href="#lab02-first-mcp-server-testing-with-the-mcp-inspector_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>The MCP Inspector can test Python MCP servers over HTTP. Run these commands from your <code>my-first-mcp-server</code> directory:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab02-first-mcp-server-__codelineno-32-1"></a><span class="c1"># Make sure your virtual environment is activated</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#lab02-first-mcp-server-__codelineno-32-2"></a><span class="nb">source</span><span class="w"> </span>.venv/bin/activate
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#lab02-first-mcp-server-__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#lab02-first-mcp-server-__codelineno-32-4"></a><span class="c1"># Run the Python MCP server</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#lab02-first-mcp-server-__codelineno-32-5"></a>python<span class="w"> </span>mcp.py
</span></code></pre></div>
</li>
<li>
<p>The server will start on <code>http://localhost:8889</code></p>
</li>
<li>
<p>In a <strong>new terminal</strong>, install and run the MCP Inspector:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab02-first-mcp-server-__codelineno-33-1"></a><span class="c1"># Install the inspector globally (if not already installed)</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab02-first-mcp-server-__codelineno-33-2"></a>npm<span class="w"> </span>install<span class="w"> </span>-g<span class="w"> </span>@modelcontextprotocol/inspector
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#lab02-first-mcp-server-__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#lab02-first-mcp-server-__codelineno-33-4"></a><span class="c1"># Run the inspector pointing to your Python server</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#lab02-first-mcp-server-__codelineno-33-5"></a><span class="c1"># Disable auth for easier testing</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#lab02-first-mcp-server-__codelineno-33-6"></a><span class="nv">DANGEROUSLY_OMIT_AUTH</span><span class="o">=</span><span class="nb">true</span><span class="w"> </span>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span><span class="se">\</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#lab02-first-mcp-server-__codelineno-33-7"></a><span class="w">  </span><span class="s2">&quot;http://localhost:8889/mcp&quot;</span>
</span></code></pre></div>
</li>
<li>
<p>This will open a web interface where you can:</p>
<ul>
<li>See the server&rsquo;s capabilities</li>
<li>List available tools</li>
<li>Call tools with test inputs</li>
<li>View request/response messages</li>
<li>Test health endpoints</li>
</ul>
</li>
</ul>
<p>#### Testing with curl:</p>
<p>You can also test the server directly with curl commands:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab02-first-mcp-server-__codelineno-34-1"></a><span class="c1"># Test health endpoint</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#lab02-first-mcp-server-__codelineno-34-2"></a>curl<span class="w"> </span>http://localhost:8889/health
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#lab02-first-mcp-server-__codelineno-34-3"></a>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#lab02-first-mcp-server-__codelineno-34-4"></a><span class="c1"># Test metadata endpoint</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#lab02-first-mcp-server-__codelineno-34-5"></a>curl<span class="w"> </span>http://localhost:8889/metadata
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#lab02-first-mcp-server-__codelineno-34-6"></a>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#lab02-first-mcp-server-__codelineno-34-7"></a><span class="c1"># Test manifest endpoint</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#lab02-first-mcp-server-__codelineno-34-8"></a>curl<span class="w"> </span>http://localhost:8889/.well-known/mcp
</span></code></pre></div>
</div>
</div>
</div>
<hr />
<h2 id="lab02-first-mcp-server-the-request-response-lifecycle">The Request - Response Lifecycle<a class="headerlink" href="#lab02-first-mcp-server-the-request-response-lifecycle" title="Permanent link">&para;</a></h2>
<p>Here&rsquo;s what happens when a tool is called:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant Client
    participant Server

    Client-&gt;&gt;Server: tools/list request
    Note over Server: Process request:&lt;br/&gt;- Match handler&lt;br/&gt;- Execute handler function
    Server--&gt;&gt;Client: tools/list response&lt;br/&gt;(list of available tools)

    Client-&gt;&gt;Server: tools/call request&lt;br/&gt;{ name: "hello_world",&lt;br/&gt;arguments: { name: "Alice" } }
    Note over Server: Process request:&lt;br/&gt;- Validate tool name&lt;br/&gt;- Validate arguments&lt;br/&gt;- Execute tool logic&lt;br/&gt;- Format response
    Server--&gt;&gt;Client: tools/call response&lt;br/&gt;{ content: [...] }</code></pre>
<hr />
<h2 id="lab02-first-mcp-server-error-handling-best-practices">Error Handling Best Practices<a class="headerlink" href="#lab02-first-mcp-server-error-handling-best-practices" title="Permanent link">&para;</a></h2>
<p>Proper error handling is crucial for <code>MCP</code> servers! </p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_6_1" name="lab02-first-mcp-server-__tabbed_6" type="radio" /><input id="lab02-first-mcp-server-__tabbed_6_2" name="lab02-first-mcp-server-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_6_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_6_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p>Here&rsquo;s how to implement robust error handling, step by step:</p>
<h3 id="lab02-first-mcp-server-1-validate-inputs">1. <strong>Validate Inputs</strong><a class="headerlink" href="#lab02-first-mcp-server-1-validate-inputs" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Always validate input parameters before processing to prevent runtime errors and provide clear feedback to clients.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Check for required parameters</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab02-first-mcp-server-__codelineno-35-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab02-first-mcp-server-__codelineno-35-2"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter is required&quot;</span><span class="p">);</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#lab02-first-mcp-server-__codelineno-35-3"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Validate parameter types</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#lab02-first-mcp-server-__codelineno-36-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="ow">typeof</span><span class="w"> </span><span class="nx">userName</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#lab02-first-mcp-server-__codelineno-36-2"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter must be a string&quot;</span><span class="p">);</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#lab02-first-mcp-server-__codelineno-36-3"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Combine validation checks</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#lab02-first-mcp-server-__codelineno-37-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">userName</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#lab02-first-mcp-server-__codelineno-37-2"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter is required and must be a string&quot;</span><span class="p">);</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#lab02-first-mcp-server-__codelineno-37-3"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Validate against schema constraints</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#lab02-first-mcp-server-__codelineno-38-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userName</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#lab02-first-mcp-server-__codelineno-38-2"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter cannot be empty&quot;</span><span class="p">);</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#lab02-first-mcp-server-__codelineno-38-3"></a><span class="p">}</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#lab02-first-mcp-server-__codelineno-38-4"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userName</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#lab02-first-mcp-server-__codelineno-38-5"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter cannot exceed 100 characters&quot;</span><span class="p">);</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#lab02-first-mcp-server-__codelineno-38-6"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-2-provide-helpful-error-messages">2. <strong>Provide Helpful Error Messages</strong><a class="headerlink" href="#lab02-first-mcp-server-2-provide-helpful-error-messages" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Clear error messages help developers understand what went wrong and how to fix it.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Include the problematic value in the error</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#lab02-first-mcp-server-__codelineno-39-1"></a><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Suggest available alternatives</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#lab02-first-mcp-server-__codelineno-40-1"></a><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">. Available tools: hello_world`</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Provide context about what was expected</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#lab02-first-mcp-server-__codelineno-41-1"></a><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid operation: </span><span class="si">${</span><span class="nx">operation</span><span class="si">}</span><span class="sb">. Expected: add, subtract, multiply, or divide`</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Include parameter names for clarity</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#lab02-first-mcp-server-__codelineno-42-1"></a><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Parameter &#39;count&#39; must be a positive number, got: </span><span class="si">${</span><span class="nx">count</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-3-handle-async-errors">3. <strong>Handle Async Errors</strong><a class="headerlink" href="#lab02-first-mcp-server-3-handle-async-errors" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Asynchronous operations can fail, and these errors need to be caught and handled properly.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Wrap async operations in try-catch</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#lab02-first-mcp-server-__codelineno-43-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-2"><a id="__codelineno-43-2" name="__codelineno-43-2" href="#lab02-first-mcp-server-__codelineno-43-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">someAsyncOperation</span><span class="p">();</span>
</span><span id="__span-43-3"><a id="__codelineno-43-3" name="__codelineno-43-3" href="#lab02-first-mcp-server-__codelineno-43-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">result</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-43-4"><a id="__codelineno-43-4" name="__codelineno-43-4" href="#lab02-first-mcp-server-__codelineno-43-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-43-5"><a id="__codelineno-43-5" name="__codelineno-43-5" href="#lab02-first-mcp-server-__codelineno-43-5"></a><span class="w">  </span><span class="c1">// Handle the error</span>
</span><span id="__span-43-6"><a id="__codelineno-43-6" name="__codelineno-43-6" href="#lab02-first-mcp-server-__codelineno-43-6"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Extract error information safely</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#lab02-first-mcp-server-__codelineno-44-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#lab02-first-mcp-server-__codelineno-44-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">someAsyncOperation</span><span class="p">();</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#lab02-first-mcp-server-__codelineno-44-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">result</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#lab02-first-mcp-server-__codelineno-44-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#lab02-first-mcp-server-__codelineno-44-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error occurred&#39;</span><span class="p">;</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#lab02-first-mcp-server-__codelineno-44-6"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Operation failed: </span><span class="si">${</span><span class="nx">errorMessage</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#lab02-first-mcp-server-__codelineno-44-7"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Preserve original error context</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#lab02-first-mcp-server-__codelineno-45-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#lab02-first-mcp-server-__codelineno-45-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">someAsyncOperation</span><span class="p">();</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#lab02-first-mcp-server-__codelineno-45-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">result</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#lab02-first-mcp-server-__codelineno-45-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#lab02-first-mcp-server-__codelineno-45-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Async operation failed:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#lab02-first-mcp-server-__codelineno-45-6"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#lab02-first-mcp-server-__codelineno-45-7"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Handle different error types appropriately</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#lab02-first-mcp-server-__codelineno-46-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#lab02-first-mcp-server-__codelineno-46-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">someAsyncOperation</span><span class="p">();</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#lab02-first-mcp-server-__codelineno-46-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">result</span><span class="w"> </span><span class="p">}]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#lab02-first-mcp-server-__codelineno-46-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#lab02-first-mcp-server-__codelineno-46-5"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ENOTFOUND&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#lab02-first-mcp-server-__codelineno-46-6"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Network connection failed. Please check your internet connection.&#39;</span><span class="p">);</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#lab02-first-mcp-server-__codelineno-46-7"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ETIMEDOUT&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#lab02-first-mcp-server-__codelineno-46-8"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Operation timed out. Please try again.&#39;</span><span class="p">);</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#lab02-first-mcp-server-__codelineno-46-9"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#lab02-first-mcp-server-__codelineno-46-10"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#lab02-first-mcp-server-__codelineno-46-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#lab02-first-mcp-server-__codelineno-46-12"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-4-log-to-stderr">4. <strong>Log to stderr</strong><a class="headerlink" href="#lab02-first-mcp-server-4-log-to-stderr" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: <code>MCP</code> protocol uses <code>stdout</code> for communication. Logging to <code>stdout</code> can break the protocol.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Use console.error() for all logging</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#lab02-first-mcp-server-__codelineno-47-1"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Tool called:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#lab02-first-mcp-server-__codelineno-47-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Arguments:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Structure your log messages</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#lab02-first-mcp-server-__codelineno-48-1"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[INFO] Processing tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#lab02-first-mcp-server-__codelineno-48-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[DEBUG] Input validation passed`</span><span class="p">);</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#lab02-first-mcp-server-__codelineno-48-3"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[ERROR] Tool execution failed:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Log at appropriate levels</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#lab02-first-mcp-server-__codelineno-49-1"></a><span class="c1">// Debug information</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#lab02-first-mcp-server-__codelineno-49-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[DEBUG] Server initialized with capabilities:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">capabilities</span><span class="p">);</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#lab02-first-mcp-server-__codelineno-49-3"></a>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#lab02-first-mcp-server-__codelineno-49-4"></a><span class="c1">// Info for normal operations</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#lab02-first-mcp-server-__codelineno-49-5"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[INFO] Tool executed successfully&quot;</span><span class="p">);</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#lab02-first-mcp-server-__codelineno-49-6"></a>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#lab02-first-mcp-server-__codelineno-49-7"></a><span class="c1">// Warnings for potential issues</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#lab02-first-mcp-server-__codelineno-49-8"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[WARN] Using default value for optional parameter&quot;</span><span class="p">);</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#lab02-first-mcp-server-__codelineno-49-9"></a>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#lab02-first-mcp-server-__codelineno-49-10"></a><span class="c1">// Errors for failures</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#lab02-first-mcp-server-__codelineno-49-11"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[ERROR] Tool execution failed:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Include timestamps for debugging</strong>:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#lab02-first-mcp-server-__codelineno-50-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#lab02-first-mcp-server-__codelineno-50-2"></a><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">] [INFO] Server started`</span><span class="p">);</span>
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title"><strong>Important</strong></p>
<p>Use <code>console.error()</code> for logging, not <code>console.log()</code>. Your MCP server must not write to <code>stdout</code> for logging purposes, as
stdout is reserved for MCP protocol messages!</p>
</div>
</div>
<div class="tabbed-block">
<p>Here&rsquo;s how to implement robust error handling in Python:</p>
<h3 id="lab02-first-mcp-server-1-validate-inputs-with-type-hints">1. <strong>Validate Inputs with Type Hints</strong><a class="headerlink" href="#lab02-first-mcp-server-1-validate-inputs-with-type-hints" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Python type hints combined with runtime validation prevent errors and provide clear feedback.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Use type hints in function signatures</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#lab02-first-mcp-server-__codelineno-51-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#lab02-first-mcp-server-__codelineno-51-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#lab02-first-mcp-server-__codelineno-51-3"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#lab02-first-mcp-server-__codelineno-51-4"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name parameter is required&quot;</span><span class="p">)</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#lab02-first-mcp-server-__codelineno-51-5"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Validate parameter types at runtime</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#lab02-first-mcp-server-__codelineno-52-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#lab02-first-mcp-server-__codelineno-52-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#lab02-first-mcp-server-__codelineno-52-3"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#lab02-first-mcp-server-__codelineno-52-4"></a>        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Name parameter must be a string&quot;</span><span class="p">)</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#lab02-first-mcp-server-__codelineno-52-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">name</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
</span><span id="__span-52-6"><a id="__codelineno-52-6" name="__codelineno-52-6" href="#lab02-first-mcp-server-__codelineno-52-6"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name parameter cannot be empty&quot;</span><span class="p">)</span>
</span><span id="__span-52-7"><a id="__codelineno-52-7" name="__codelineno-52-7" href="#lab02-first-mcp-server-__codelineno-52-7"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Validate against constraints</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#lab02-first-mcp-server-__codelineno-53-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-53-2"><a id="__codelineno-53-2" name="__codelineno-53-2" href="#lab02-first-mcp-server-__codelineno-53-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-53-3"><a id="__codelineno-53-3" name="__codelineno-53-3" href="#lab02-first-mcp-server-__codelineno-53-3"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
</span><span id="__span-53-4"><a id="__codelineno-53-4" name="__codelineno-53-4" href="#lab02-first-mcp-server-__codelineno-53-4"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name parameter cannot exceed 100 characters&quot;</span><span class="p">)</span>
</span><span id="__span-53-5"><a id="__codelineno-53-5" name="__codelineno-53-5" href="#lab02-first-mcp-server-__codelineno-53-5"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-53-6"><a id="__codelineno-53-6" name="__codelineno-53-6" href="#lab02-first-mcp-server-__codelineno-53-6"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name parameter must be at least 1 character&quot;</span><span class="p">)</span>
</span><span id="__span-53-7"><a id="__codelineno-53-7" name="__codelineno-53-7" href="#lab02-first-mcp-server-__codelineno-53-7"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-2-provide-helpful-error-messages_1">2. <strong>Provide Helpful Error Messages</strong><a class="headerlink" href="#lab02-first-mcp-server-2-provide-helpful-error-messages_1" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Clear error messages help developers understand and fix issues quickly.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Include problematic values</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#lab02-first-mcp-server-__codelineno-54-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#lab02-first-mcp-server-__codelineno-54-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#lab02-first-mcp-server-__codelineno-54-3"></a>    <span class="n">valid_ops</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span> <span class="s2">&quot;multiply&quot;</span><span class="p">,</span> <span class="s2">&quot;divide&quot;</span><span class="p">]</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#lab02-first-mcp-server-__codelineno-54-4"></a>    <span class="k">if</span> <span class="n">operation</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_ops</span><span class="p">:</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#lab02-first-mcp-server-__codelineno-54-5"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-54-6"><a id="__codelineno-54-6" name="__codelineno-54-6" href="#lab02-first-mcp-server-__codelineno-54-6"></a>            <span class="sa">f</span><span class="s2">&quot;Unknown operation: </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="__span-54-7"><a id="__codelineno-54-7" name="__codelineno-54-7" href="#lab02-first-mcp-server-__codelineno-54-7"></a>            <span class="sa">f</span><span class="s2">&quot;Available operations: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">valid_ops</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-54-8"><a id="__codelineno-54-8" name="__codelineno-54-8" href="#lab02-first-mcp-server-__codelineno-54-8"></a>        <span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Provide context in exceptions</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#lab02-first-mcp-server-__codelineno-55-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#lab02-first-mcp-server-__codelineno-55-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">process_data</span><span class="p">(</span><span class="n">count</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-55-3"><a id="__codelineno-55-3" name="__codelineno-55-3" href="#lab02-first-mcp-server-__codelineno-55-3"></a>    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-55-4"><a id="__codelineno-55-4" name="__codelineno-55-4" href="#lab02-first-mcp-server-__codelineno-55-4"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-55-5"><a id="__codelineno-55-5" name="__codelineno-55-5" href="#lab02-first-mcp-server-__codelineno-55-5"></a>            <span class="sa">f</span><span class="s2">&quot;Parameter &#39;count&#39; must be a positive number, got: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-55-6"><a id="__codelineno-55-6" name="__codelineno-55-6" href="#lab02-first-mcp-server-__codelineno-55-6"></a>        <span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-3-handle-async-errors_1">3. <strong>Handle Async Errors</strong><a class="headerlink" href="#lab02-first-mcp-server-3-handle-async-errors_1" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Async operations can fail and need proper error handling.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Wrap async operations in try-except</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#lab02-first-mcp-server-__codelineno-56-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-56-2"><a id="__codelineno-56-2" name="__codelineno-56-2" href="#lab02-first-mcp-server-__codelineno-56-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-56-3"><a id="__codelineno-56-3" name="__codelineno-56-3" href="#lab02-first-mcp-server-__codelineno-56-3"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-56-4"><a id="__codelineno-56-4" name="__codelineno-56-4" href="#lab02-first-mcp-server-__codelineno-56-4"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-56-5"><a id="__codelineno-56-5" name="__codelineno-56-5" href="#lab02-first-mcp-server-__codelineno-56-5"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-56-6"><a id="__codelineno-56-6" name="__codelineno-56-6" href="#lab02-first-mcp-server-__codelineno-56-6"></a>            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-56-7"><a id="__codelineno-56-7" name="__codelineno-56-7" href="#lab02-first-mcp-server-__codelineno-56-7"></a>    <span class="k">except</span> <span class="n">httpx</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-56-8"><a id="__codelineno-56-8" name="__codelineno-56-8" href="#lab02-first-mcp-server-__codelineno-56-8"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to fetch data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Handle specific exception types</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#lab02-first-mcp-server-__codelineno-57-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-57-2"><a id="__codelineno-57-2" name="__codelineno-57-2" href="#lab02-first-mcp-server-__codelineno-57-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">fetch_data</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-57-3"><a id="__codelineno-57-3" name="__codelineno-57-3" href="#lab02-first-mcp-server-__codelineno-57-3"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-57-4"><a id="__codelineno-57-4" name="__codelineno-57-4" href="#lab02-first-mcp-server-__codelineno-57-4"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-57-5"><a id="__codelineno-57-5" name="__codelineno-57-5" href="#lab02-first-mcp-server-__codelineno-57-5"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span id="__span-57-6"><a id="__codelineno-57-6" name="__codelineno-57-6" href="#lab02-first-mcp-server-__codelineno-57-6"></a>            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
</span><span id="__span-57-7"><a id="__codelineno-57-7" name="__codelineno-57-7" href="#lab02-first-mcp-server-__codelineno-57-7"></a>    <span class="k">except</span> <span class="n">httpx</span><span class="o">.</span><span class="n">TimeoutException</span><span class="p">:</span>
</span><span id="__span-57-8"><a id="__codelineno-57-8" name="__codelineno-57-8" href="#lab02-first-mcp-server-__codelineno-57-8"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Request timed out. Please try again.&quot;</span><span class="p">)</span>
</span><span id="__span-57-9"><a id="__codelineno-57-9" name="__codelineno-57-9" href="#lab02-first-mcp-server-__codelineno-57-9"></a>    <span class="k">except</span> <span class="n">httpx</span><span class="o">.</span><span class="n">NetworkError</span><span class="p">:</span>
</span><span id="__span-57-10"><a id="__codelineno-57-10" name="__codelineno-57-10" href="#lab02-first-mcp-server-__codelineno-57-10"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Network connection failed.&quot;</span><span class="p">)</span>
</span><span id="__span-57-11"><a id="__codelineno-57-11" name="__codelineno-57-11" href="#lab02-first-mcp-server-__codelineno-57-11"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-57-12"><a id="__codelineno-57-12" name="__codelineno-57-12" href="#lab02-first-mcp-server-__codelineno-57-12"></a>        <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
</ol>
<h3 id="lab02-first-mcp-server-4-use-pythons-logging-module">4. <strong>Use Python&rsquo;s Logging Module</strong><a class="headerlink" href="#lab02-first-mcp-server-4-use-pythons-logging-module" title="Permanent link">&para;</a></h3>
<p><strong>Why</strong>: Proper logging helps debug issues without interfering with MCP protocol.</p>
<p><strong>Step-by-step implementation</strong>:</p>
<ol>
<li>
<p><strong>Configure logging at the start of your script</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#lab02-first-mcp-server-__codelineno-58-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-58-2"><a id="__codelineno-58-2" name="__codelineno-58-2" href="#lab02-first-mcp-server-__codelineno-58-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-58-3"><a id="__codelineno-58-3" name="__codelineno-58-3" href="#lab02-first-mcp-server-__codelineno-58-3"></a>
</span><span id="__span-58-4"><a id="__codelineno-58-4" name="__codelineno-58-4" href="#lab02-first-mcp-server-__codelineno-58-4"></a><span class="c1"># Configure logging to stderr</span>
</span><span id="__span-58-5"><a id="__codelineno-58-5" name="__codelineno-58-5" href="#lab02-first-mcp-server-__codelineno-58-5"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span id="__span-58-6"><a id="__codelineno-58-6" name="__codelineno-58-6" href="#lab02-first-mcp-server-__codelineno-58-6"></a>    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="__span-58-7"><a id="__codelineno-58-7" name="__codelineno-58-7" href="#lab02-first-mcp-server-__codelineno-58-7"></a>    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;[</span><span class="si">%(asctime)s</span><span class="s1">] </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="__span-58-8"><a id="__codelineno-58-8" name="__codelineno-58-8" href="#lab02-first-mcp-server-__codelineno-58-8"></a>    <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
</span><span id="__span-58-9"><a id="__codelineno-58-9" name="__codelineno-58-9" href="#lab02-first-mcp-server-__codelineno-58-9"></a><span class="p">)</span>
</span><span id="__span-58-10"><a id="__codelineno-58-10" name="__codelineno-58-10" href="#lab02-first-mcp-server-__codelineno-58-10"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Log at appropriate levels</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#lab02-first-mcp-server-__codelineno-59-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-59-2"><a id="__codelineno-59-2" name="__codelineno-59-2" href="#lab02-first-mcp-server-__codelineno-59-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-59-3"><a id="__codelineno-59-3" name="__codelineno-59-3" href="#lab02-first-mcp-server-__codelineno-59-3"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hello_world called with name: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-59-4"><a id="__codelineno-59-4" name="__codelineno-59-4" href="#lab02-first-mcp-server-__codelineno-59-4"></a>
</span><span id="__span-59-5"><a id="__codelineno-59-5" name="__codelineno-59-5" href="#lab02-first-mcp-server-__codelineno-59-5"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span><span class="p">:</span>
</span><span id="__span-59-6"><a id="__codelineno-59-6" name="__codelineno-59-6" href="#lab02-first-mcp-server-__codelineno-59-6"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;hello_world called with empty name&quot;</span><span class="p">)</span>
</span><span id="__span-59-7"><a id="__codelineno-59-7" name="__codelineno-59-7" href="#lab02-first-mcp-server-__codelineno-59-7"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Name parameter is required&quot;</span><span class="p">)</span>
</span><span id="__span-59-8"><a id="__codelineno-59-8" name="__codelineno-59-8" href="#lab02-first-mcp-server-__codelineno-59-8"></a>
</span><span id="__span-59-9"><a id="__codelineno-59-9" name="__codelineno-59-9" href="#lab02-first-mcp-server-__codelineno-59-9"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully greeted: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-59-10"><a id="__codelineno-59-10" name="__codelineno-59-10" href="#lab02-first-mcp-server-__codelineno-59-10"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&quot;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Log errors with full context</strong>:
   <div class="language-python highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#lab02-first-mcp-server-__codelineno-60-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-60-2"><a id="__codelineno-60-2" name="__codelineno-60-2" href="#lab02-first-mcp-server-__codelineno-60-2"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">process_request</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-60-3"><a id="__codelineno-60-3" name="__codelineno-60-3" href="#lab02-first-mcp-server-__codelineno-60-3"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-60-4"><a id="__codelineno-60-4" name="__codelineno-60-4" href="#lab02-first-mcp-server-__codelineno-60-4"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">some_async_operation</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span id="__span-60-5"><a id="__codelineno-60-5" name="__codelineno-60-5" href="#lab02-first-mcp-server-__codelineno-60-5"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Request processed successfully&quot;</span><span class="p">)</span>
</span><span id="__span-60-6"><a id="__codelineno-60-6" name="__codelineno-60-6" href="#lab02-first-mcp-server-__codelineno-60-6"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-60-7"><a id="__codelineno-60-7" name="__codelineno-60-7" href="#lab02-first-mcp-server-__codelineno-60-7"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-60-8"><a id="__codelineno-60-8" name="__codelineno-60-8" href="#lab02-first-mcp-server-__codelineno-60-8"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to process request: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-60-9"><a id="__codelineno-60-9" name="__codelineno-60-9" href="#lab02-first-mcp-server-__codelineno-60-9"></a>        <span class="k">raise</span>
</span></code></pre></div></p>
</li>
</ol>
<div class="admonition warning">
<p class="admonition-title"><strong>Important</strong></p>
<p>Use <code>logging</code> module with <code>stream=sys.stderr</code> for all logging. Never use <code>print()</code> for logging in production MCP servers, as it can interfere with protocol communication in stdio transport mode.</p>
</div>
</div>
</div>
</div>
<hr />
<h2 id="lab02-first-mcp-server-common-issues-and-solutions">Common Issues and Solutions<a class="headerlink" href="#lab02-first-mcp-server-common-issues-and-solutions" title="Permanent link">&para;</a></h2>
<h3 id="lab02-first-mcp-server-issue-1-server-not-connecting">Issue 1: Server Not Connecting<a class="headerlink" href="#lab02-first-mcp-server-issue-1-server-not-connecting" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Symptoms:</strong> Client doesn&rsquo;t see the server or times out</p>
</li>
<li>
<p><strong>Solutions:</strong></p>
<ul>
<li>Check that the command path is absolute</li>
<li>Verify Node.js is in the PATH</li>
<li>Look at client logs for connection errors</li>
<li>Ensure the server starts without crashing</li>
</ul>
</li>
</ul>
<h3 id="lab02-first-mcp-server-issue-2-tools-not-appearing">Issue 2: Tools Not Appearing<a class="headerlink" href="#lab02-first-mcp-server-issue-2-tools-not-appearing" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Symptoms:</strong> Server connects but no tools are listed</p>
</li>
<li>
<p><strong>Solutions:</strong></p>
<ul>
<li>Verify <code>capabilities.tools</code> is declared in server initialization</li>
<li>Check that <code>ListToolsRequestSchema</code> handler is registered</li>
<li>Ensure the handler returns the correct format</li>
<li>Restart the client after code changes</li>
</ul>
</li>
</ul>
<h3 id="lab02-first-mcp-server-issue-3-tool-execution-fails">Issue 3: Tool Execution Fails<a class="headerlink" href="#lab02-first-mcp-server-issue-3-tool-execution-fails" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Symptoms:</strong> Tool appears but fails when called</p>
</li>
<li>
<p><strong>Solutions:</strong></p>
<ul>
<li>Validate input arguments match the schema</li>
<li>Check for typos in tool names</li>
<li>Add debug logging to see what&rsquo;s received</li>
<li>Ensure return format matches <code>MCP</code> specification</li>
</ul>
</li>
</ul>
<h3 id="lab02-first-mcp-server-issue-4-server-crashes">Issue 4: Server Crashes<a class="headerlink" href="#lab02-first-mcp-server-issue-4-server-crashes" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Symptoms:</strong> Server exits unexpectedly</p>
</li>
<li>
<p><strong>Solutions:</strong></p>
<ul>
<li>Add try-catch blocks around async code</li>
<li>Check for unhandled promise rejections</li>
<li>Validate all external data</li>
<li>Add process error handlers</li>
</ul>
</li>
</ul>
<hr />
<h2 id="lab02-first-mcp-server-extending-your-server-hands-on-exercises">Extending Your Server: Hands-On Exercises<a class="headerlink" href="#lab02-first-mcp-server-extending-your-server-hands-on-exercises" title="Permanent link">&para;</a></h2>
<p>Now that you have a working server, try these exercises:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="lab02-first-mcp-server-__tabbed_7_1" name="lab02-first-mcp-server-__tabbed_7" type="radio" /><input id="lab02-first-mcp-server-__tabbed_7_2" name="lab02-first-mcp-server-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="lab02-first-mcp-server-__tabbed_7_1">Node.js / TypeScript</label><label for="lab02-first-mcp-server-__tabbed_7_2">Python</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-exercise-1-add-a-calculator-tool">Exercise 1: Add a Calculator Tool<a class="headerlink" href="#lab02-first-mcp-server-exercise-1-add-a-calculator-tool" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Create a tool that performs basic math operations:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#lab02-first-mcp-server-__codelineno-61-1"></a><span class="p">{</span>
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#lab02-first-mcp-server-__codelineno-61-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;calculate&quot;</span><span class="p">,</span>
</span><span id="__span-61-3"><a id="__codelineno-61-3" name="__codelineno-61-3" href="#lab02-first-mcp-server-__codelineno-61-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Performs basic math operations&quot;</span><span class="p">,</span>
</span><span id="__span-61-4"><a id="__codelineno-61-4" name="__codelineno-61-4" href="#lab02-first-mcp-server-__codelineno-61-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-5"><a id="__codelineno-61-5" name="__codelineno-61-5" href="#lab02-first-mcp-server-__codelineno-61-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-61-6"><a id="__codelineno-61-6" name="__codelineno-61-6" href="#lab02-first-mcp-server-__codelineno-61-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-7"><a id="__codelineno-61-7" name="__codelineno-61-7" href="#lab02-first-mcp-server-__codelineno-61-7"></a><span class="w">      </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-8"><a id="__codelineno-61-8" name="__codelineno-61-8" href="#lab02-first-mcp-server-__codelineno-61-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-61-9"><a id="__codelineno-61-9" name="__codelineno-61-9" href="#lab02-first-mcp-server-__codelineno-61-9"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;add&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;subtract&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;multiply&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;divide&quot;</span><span class="p">],</span>
</span><span id="__span-61-10"><a id="__codelineno-61-10" name="__codelineno-61-10" href="#lab02-first-mcp-server-__codelineno-61-10"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The operation to perform&quot;</span>
</span><span id="__span-61-11"><a id="__codelineno-61-11" name="__codelineno-61-11" href="#lab02-first-mcp-server-__codelineno-61-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-61-12"><a id="__codelineno-61-12" name="__codelineno-61-12" href="#lab02-first-mcp-server-__codelineno-61-12"></a><span class="w">      </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-13"><a id="__codelineno-61-13" name="__codelineno-61-13" href="#lab02-first-mcp-server-__codelineno-61-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-61-14"><a id="__codelineno-61-14" name="__codelineno-61-14" href="#lab02-first-mcp-server-__codelineno-61-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;First number&quot;</span>
</span><span id="__span-61-15"><a id="__codelineno-61-15" name="__codelineno-61-15" href="#lab02-first-mcp-server-__codelineno-61-15"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-61-16"><a id="__codelineno-61-16" name="__codelineno-61-16" href="#lab02-first-mcp-server-__codelineno-61-16"></a><span class="w">      </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-61-17"><a id="__codelineno-61-17" name="__codelineno-61-17" href="#lab02-first-mcp-server-__codelineno-61-17"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-61-18"><a id="__codelineno-61-18" name="__codelineno-61-18" href="#lab02-first-mcp-server-__codelineno-61-18"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Second number&quot;</span>
</span><span id="__span-61-19"><a id="__codelineno-61-19" name="__codelineno-61-19" href="#lab02-first-mcp-server-__codelineno-61-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-61-20"><a id="__codelineno-61-20" name="__codelineno-61-20" href="#lab02-first-mcp-server-__codelineno-61-20"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-61-21"><a id="__codelineno-61-21" name="__codelineno-61-21" href="#lab02-first-mcp-server-__codelineno-61-21"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;operation&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">]</span>
</span><span id="__span-61-22"><a id="__codelineno-61-22" name="__codelineno-61-22" href="#lab02-first-mcp-server-__codelineno-61-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-61-23"><a id="__codelineno-61-23" name="__codelineno-61-23" href="#lab02-first-mcp-server-__codelineno-61-23"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-exercise-2-add-an-echo-tool">Exercise 2: Add an Echo Tool<a class="headerlink" href="#lab02-first-mcp-server-exercise-2-add-an-echo-tool" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Create a tool that returns whatever text it receives:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#lab02-first-mcp-server-__codelineno-62-1"></a><span class="p">{</span>
</span><span id="__span-62-2"><a id="__codelineno-62-2" name="__codelineno-62-2" href="#lab02-first-mcp-server-__codelineno-62-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;echo&quot;</span><span class="p">,</span>
</span><span id="__span-62-3"><a id="__codelineno-62-3" name="__codelineno-62-3" href="#lab02-first-mcp-server-__codelineno-62-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Echoes back the input text&quot;</span><span class="p">,</span>
</span><span id="__span-62-4"><a id="__codelineno-62-4" name="__codelineno-62-4" href="#lab02-first-mcp-server-__codelineno-62-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-5"><a id="__codelineno-62-5" name="__codelineno-62-5" href="#lab02-first-mcp-server-__codelineno-62-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-62-6"><a id="__codelineno-62-6" name="__codelineno-62-6" href="#lab02-first-mcp-server-__codelineno-62-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-7"><a id="__codelineno-62-7" name="__codelineno-62-7" href="#lab02-first-mcp-server-__codelineno-62-7"></a><span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-8"><a id="__codelineno-62-8" name="__codelineno-62-8" href="#lab02-first-mcp-server-__codelineno-62-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-62-9"><a id="__codelineno-62-9" name="__codelineno-62-9" href="#lab02-first-mcp-server-__codelineno-62-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The message to echo&quot;</span>
</span><span id="__span-62-10"><a id="__codelineno-62-10" name="__codelineno-62-10" href="#lab02-first-mcp-server-__codelineno-62-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-62-11"><a id="__codelineno-62-11" name="__codelineno-62-11" href="#lab02-first-mcp-server-__codelineno-62-11"></a><span class="w">      </span><span class="nx">repeat</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-62-12"><a id="__codelineno-62-12" name="__codelineno-62-12" href="#lab02-first-mcp-server-__codelineno-62-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-62-13"><a id="__codelineno-62-13" name="__codelineno-62-13" href="#lab02-first-mcp-server-__codelineno-62-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Number of times to repeat (default: 1)&quot;</span><span class="p">,</span>
</span><span id="__span-62-14"><a id="__codelineno-62-14" name="__codelineno-62-14" href="#lab02-first-mcp-server-__codelineno-62-14"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span>
</span><span id="__span-62-15"><a id="__codelineno-62-15" name="__codelineno-62-15" href="#lab02-first-mcp-server-__codelineno-62-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-62-16"><a id="__codelineno-62-16" name="__codelineno-62-16" href="#lab02-first-mcp-server-__codelineno-62-16"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-62-17"><a id="__codelineno-62-17" name="__codelineno-62-17" href="#lab02-first-mcp-server-__codelineno-62-17"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">]</span>
</span><span id="__span-62-18"><a id="__codelineno-62-18" name="__codelineno-62-18" href="#lab02-first-mcp-server-__codelineno-62-18"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-62-19"><a id="__codelineno-62-19" name="__codelineno-62-19" href="#lab02-first-mcp-server-__codelineno-62-19"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-exercise-3-add-logging">Exercise 3: Add Logging<a class="headerlink" href="#lab02-first-mcp-server-exercise-3-add-logging" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Enhance your server with structured logging:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#lab02-first-mcp-server-__codelineno-63-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">log</span><span class="p">(</span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data?</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#lab02-first-mcp-server-__codelineno-63-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#lab02-first-mcp-server-__codelineno-63-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logEntry</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">timestamp</span><span class="p">,</span><span class="w"> </span><span class="nx">level</span><span class="p">,</span><span class="w"> </span><span class="nx">message</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-63-4"><a id="__codelineno-63-4" name="__codelineno-63-4" href="#lab02-first-mcp-server-__codelineno-63-4"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">logEntry</span><span class="p">));</span>
</span><span id="__span-63-5"><a id="__codelineno-63-5" name="__codelineno-63-5" href="#lab02-first-mcp-server-__codelineno-63-5"></a><span class="p">}</span>
</span></code></pre></div>
</li>
</ul>
</div>
<div class="tabbed-block">
<h3 id="lab02-first-mcp-server-exercise-1-add-a-calculator-tool_1">Exercise 1: Add a Calculator Tool<a class="headerlink" href="#lab02-first-mcp-server-exercise-1-add-a-calculator-tool_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Add a calculator tool to your <code>mcp.py</code> file:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#lab02-first-mcp-server-__codelineno-64-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-64-2"><a id="__codelineno-64-2" name="__codelineno-64-2" href="#lab02-first-mcp-server-__codelineno-64-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">calculate</span><span class="p">(</span><span class="n">operation</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-64-3"><a id="__codelineno-64-3" name="__codelineno-64-3" href="#lab02-first-mcp-server-__codelineno-64-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Performs basic math operations&quot;&quot;&quot;</span>
</span><span id="__span-64-4"><a id="__codelineno-64-4" name="__codelineno-64-4" href="#lab02-first-mcp-server-__codelineno-64-4"></a>    <span class="k">if</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;add&quot;</span><span class="p">:</span>
</span><span id="__span-64-5"><a id="__codelineno-64-5" name="__codelineno-64-5" href="#lab02-first-mcp-server-__codelineno-64-5"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span><span id="__span-64-6"><a id="__codelineno-64-6" name="__codelineno-64-6" href="#lab02-first-mcp-server-__codelineno-64-6"></a>    <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;subtract&quot;</span><span class="p">:</span>
</span><span id="__span-64-7"><a id="__codelineno-64-7" name="__codelineno-64-7" href="#lab02-first-mcp-server-__codelineno-64-7"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
</span><span id="__span-64-8"><a id="__codelineno-64-8" name="__codelineno-64-8" href="#lab02-first-mcp-server-__codelineno-64-8"></a>    <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;multiply&quot;</span><span class="p">:</span>
</span><span id="__span-64-9"><a id="__codelineno-64-9" name="__codelineno-64-9" href="#lab02-first-mcp-server-__codelineno-64-9"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">*</span> <span class="n">b</span>
</span><span id="__span-64-10"><a id="__codelineno-64-10" name="__codelineno-64-10" href="#lab02-first-mcp-server-__codelineno-64-10"></a>    <span class="k">elif</span> <span class="n">operation</span> <span class="o">==</span> <span class="s2">&quot;divide&quot;</span><span class="p">:</span>
</span><span id="__span-64-11"><a id="__codelineno-64-11" name="__codelineno-64-11" href="#lab02-first-mcp-server-__codelineno-64-11"></a>        <span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-64-12"><a id="__codelineno-64-12" name="__codelineno-64-12" href="#lab02-first-mcp-server-__codelineno-64-12"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot divide by zero&quot;</span><span class="p">)</span>
</span><span id="__span-64-13"><a id="__codelineno-64-13" name="__codelineno-64-13" href="#lab02-first-mcp-server-__codelineno-64-13"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">/</span> <span class="n">b</span>
</span><span id="__span-64-14"><a id="__codelineno-64-14" name="__codelineno-64-14" href="#lab02-first-mcp-server-__codelineno-64-14"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-64-15"><a id="__codelineno-64-15" name="__codelineno-64-15" href="#lab02-first-mcp-server-__codelineno-64-15"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="__span-64-16"><a id="__codelineno-64-16" name="__codelineno-64-16" href="#lab02-first-mcp-server-__codelineno-64-16"></a>            <span class="sa">f</span><span class="s2">&quot;Unknown operation: </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2">. &quot;</span>
</span><span id="__span-64-17"><a id="__codelineno-64-17" name="__codelineno-64-17" href="#lab02-first-mcp-server-__codelineno-64-17"></a>            <span class="sa">f</span><span class="s2">&quot;Use: add, subtract, multiply, or divide&quot;</span>
</span><span id="__span-64-18"><a id="__codelineno-64-18" name="__codelineno-64-18" href="#lab02-first-mcp-server-__codelineno-64-18"></a>        <span class="p">)</span>
</span><span id="__span-64-19"><a id="__codelineno-64-19" name="__codelineno-64-19" href="#lab02-first-mcp-server-__codelineno-64-19"></a>
</span><span id="__span-64-20"><a id="__codelineno-64-20" name="__codelineno-64-20" href="#lab02-first-mcp-server-__codelineno-64-20"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The result of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">operation</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-exercise-2-add-an-echo-tool_1">Exercise 2: Add an Echo Tool<a class="headerlink" href="#lab02-first-mcp-server-exercise-2-add-an-echo-tool_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Add an echo tool that repeats messages:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#lab02-first-mcp-server-__codelineno-65-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#lab02-first-mcp-server-__codelineno-65-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">echo</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">repeat</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#lab02-first-mcp-server-__codelineno-65-3"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Echoes back the input text, optionally repeated&quot;&quot;&quot;</span>
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#lab02-first-mcp-server-__codelineno-65-4"></a>    <span class="k">if</span> <span class="n">repeat</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="__span-65-5"><a id="__codelineno-65-5" name="__codelineno-65-5" href="#lab02-first-mcp-server-__codelineno-65-5"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Repeat count must be at least 1&quot;</span><span class="p">)</span>
</span><span id="__span-65-6"><a id="__codelineno-65-6" name="__codelineno-65-6" href="#lab02-first-mcp-server-__codelineno-65-6"></a>    <span class="k">if</span> <span class="n">repeat</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
</span><span id="__span-65-7"><a id="__codelineno-65-7" name="__codelineno-65-7" href="#lab02-first-mcp-server-__codelineno-65-7"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Repeat count cannot exceed 10&quot;</span><span class="p">)</span>
</span><span id="__span-65-8"><a id="__codelineno-65-8" name="__codelineno-65-8" href="#lab02-first-mcp-server-__codelineno-65-8"></a>
</span><span id="__span-65-9"><a id="__codelineno-65-9" name="__codelineno-65-9" href="#lab02-first-mcp-server-__codelineno-65-9"></a>    <span class="k">return</span> <span class="p">(</span><span class="n">message</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">repeat</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-exercise-3-add-logging_1">Exercise 3: Add Logging<a class="headerlink" href="#lab02-first-mcp-server-exercise-3-add-logging_1" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Add structured logging to your server:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#lab02-first-mcp-server-__codelineno-66-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span id="__span-66-2"><a id="__codelineno-66-2" name="__codelineno-66-2" href="#lab02-first-mcp-server-__codelineno-66-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span id="__span-66-3"><a id="__codelineno-66-3" name="__codelineno-66-3" href="#lab02-first-mcp-server-__codelineno-66-3"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-66-4"><a id="__codelineno-66-4" name="__codelineno-66-4" href="#lab02-first-mcp-server-__codelineno-66-4"></a>
</span><span id="__span-66-5"><a id="__codelineno-66-5" name="__codelineno-66-5" href="#lab02-first-mcp-server-__codelineno-66-5"></a><span class="c1"># Configure logging</span>
</span><span id="__span-66-6"><a id="__codelineno-66-6" name="__codelineno-66-6" href="#lab02-first-mcp-server-__codelineno-66-6"></a><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span>
</span><span id="__span-66-7"><a id="__codelineno-66-7" name="__codelineno-66-7" href="#lab02-first-mcp-server-__codelineno-66-7"></a>    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
</span><span id="__span-66-8"><a id="__codelineno-66-8" name="__codelineno-66-8" href="#lab02-first-mcp-server-__codelineno-66-8"></a>    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;[</span><span class="si">%(asctime)s</span><span class="s1">] </span><span class="si">%(levelname)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="__span-66-9"><a id="__codelineno-66-9" name="__codelineno-66-9" href="#lab02-first-mcp-server-__codelineno-66-9"></a>    <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
</span><span id="__span-66-10"><a id="__codelineno-66-10" name="__codelineno-66-10" href="#lab02-first-mcp-server-__codelineno-66-10"></a><span class="p">)</span>
</span><span id="__span-66-11"><a id="__codelineno-66-11" name="__codelineno-66-11" href="#lab02-first-mcp-server-__codelineno-66-11"></a><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-66-12"><a id="__codelineno-66-12" name="__codelineno-66-12" href="#lab02-first-mcp-server-__codelineno-66-12"></a>
</span><span id="__span-66-13"><a id="__codelineno-66-13" name="__codelineno-66-13" href="#lab02-first-mcp-server-__codelineno-66-13"></a><span class="c1"># Add logging to your tools</span>
</span><span id="__span-66-14"><a id="__codelineno-66-14" name="__codelineno-66-14" href="#lab02-first-mcp-server-__codelineno-66-14"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-66-15"><a id="__codelineno-66-15" name="__codelineno-66-15" href="#lab02-first-mcp-server-__codelineno-66-15"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello_world</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-66-16"><a id="__codelineno-66-16" name="__codelineno-66-16" href="#lab02-first-mcp-server-__codelineno-66-16"></a>    \<span class="s2">&quot;</span><span class="se">\&quot;\&quot;</span><span class="s2">Returns a friendly greeting message</span><span class="se">\&quot;\&quot;\&quot;</span>
</span><span id="__span-66-17"><a id="__codelineno-66-17" name="__codelineno-66-17" href="#lab02-first-mcp-server-__codelineno-66-17"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-66-18"><a id="__codelineno-66-18" name="__codelineno-66-18" href="#lab02-first-mcp-server-__codelineno-66-18"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing hello_world for: </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-66-19"><a id="__codelineno-66-19" name="__codelineno-66-19" href="#lab02-first-mcp-server-__codelineno-66-19"></a>
</span><span id="__span-66-20"><a id="__codelineno-66-20" name="__codelineno-66-20" href="#lab02-first-mcp-server-__codelineno-66-20"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-66-21"><a id="__codelineno-66-21" name="__codelineno-66-21" href="#lab02-first-mcp-server-__codelineno-66-21"></a>        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to your first MCP server! üéâ&quot;</span>
</span><span id="__span-66-22"><a id="__codelineno-66-22" name="__codelineno-66-22" href="#lab02-first-mcp-server-__codelineno-66-22"></a>        <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-66-23"><a id="__codelineno-66-23" name="__codelineno-66-23" href="#lab02-first-mcp-server-__codelineno-66-23"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hello_world completed in </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">ms&quot;</span><span class="p">)</span>
</span><span id="__span-66-24"><a id="__codelineno-66-24" name="__codelineno-66-24" href="#lab02-first-mcp-server-__codelineno-66-24"></a>        <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-66-25"><a id="__codelineno-66-25" name="__codelineno-66-25" href="#lab02-first-mcp-server-__codelineno-66-25"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-66-26"><a id="__codelineno-66-26" name="__codelineno-66-26" href="#lab02-first-mcp-server-__codelineno-66-26"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;hello_world failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-66-27"><a id="__codelineno-66-27" name="__codelineno-66-27" href="#lab02-first-mcp-server-__codelineno-66-27"></a>        <span class="k">raise</span>
</span></code></pre></div>
</li>
</ul>
<h3 id="lab02-first-mcp-server-exercise-4-add-a-resource">Exercise 4: Add a Resource<a class="headerlink" href="#lab02-first-mcp-server-exercise-4-add-a-resource" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Add a resource that returns server statistics:</p>
<div class="language-python highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#lab02-first-mcp-server-__codelineno-67-1"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;mcp://stats&quot;</span><span class="p">)</span>
</span><span id="__span-67-2"><a id="__codelineno-67-2" name="__codelineno-67-2" href="#lab02-first-mcp-server-__codelineno-67-2"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_server_stats</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-67-3"><a id="__codelineno-67-3" name="__codelineno-67-3" href="#lab02-first-mcp-server-__codelineno-67-3"></a>    \<span class="s2">&quot;</span><span class="se">\&quot;\&quot;</span><span class="s2">Returns server statistics</span><span class="se">\&quot;\&quot;\&quot;</span>
</span><span id="__span-67-4"><a id="__codelineno-67-4" name="__codelineno-67-4" href="#lab02-first-mcp-server-__codelineno-67-4"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">psutil</span>
</span><span id="__span-67-5"><a id="__codelineno-67-5" name="__codelineno-67-5" href="#lab02-first-mcp-server-__codelineno-67-5"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-67-6"><a id="__codelineno-67-6" name="__codelineno-67-6" href="#lab02-first-mcp-server-__codelineno-67-6"></a>
</span><span id="__span-67-7"><a id="__codelineno-67-7" name="__codelineno-67-7" href="#lab02-first-mcp-server-__codelineno-67-7"></a>    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-67-8"><a id="__codelineno-67-8" name="__codelineno-67-8" href="#lab02-first-mcp-server-__codelineno-67-8"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-67-9"><a id="__codelineno-67-9" name="__codelineno-67-9" href="#lab02-first-mcp-server-__codelineno-67-9"></a>        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-67-10"><a id="__codelineno-67-10" name="__codelineno-67-10" href="#lab02-first-mcp-server-__codelineno-67-10"></a>        <span class="s2">&quot;uptime_seconds&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">,</span>
</span><span id="__span-67-11"><a id="__codelineno-67-11" name="__codelineno-67-11" href="#lab02-first-mcp-server-__codelineno-67-11"></a>        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">getpid</span><span class="p">(),</span>
</span><span id="__span-67-12"><a id="__codelineno-67-12" name="__codelineno-67-12" href="#lab02-first-mcp-server-__codelineno-67-12"></a>        <span class="s2">&quot;memory_mb&quot;</span><span class="p">:</span> <span class="n">psutil</span><span class="o">.</span><span class="n">Process</span><span class="p">()</span><span class="o">.</span><span class="n">memory_info</span><span class="p">()</span><span class="o">.</span><span class="n">rss</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="__span-67-13"><a id="__codelineno-67-13" name="__codelineno-67-13" href="#lab02-first-mcp-server-__codelineno-67-13"></a>    <span class="p">}</span>
</span><span id="__span-67-14"><a id="__codelineno-67-14" name="__codelineno-67-14" href="#lab02-first-mcp-server-__codelineno-67-14"></a>
</span><span id="__span-67-15"><a id="__codelineno-67-15" name="__codelineno-67-15" href="#lab02-first-mcp-server-__codelineno-67-15"></a>    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</span></code></pre></div>
</li>
</ul>
</div>
</div>
</div>
<hr />
<h2 id="lab02-first-mcp-server-key-takeaways">Key Takeaways<a class="headerlink" href="#lab02-first-mcp-server-key-takeaways" title="Permanent link">&para;</a></h2>
<ul>
<li>MCP servers are built up using the <code>sdk</code> package</li>
<li>The SDK handles protocol details, letting you focus on business logic</li>
<li>Servers communicate via stdio, HTTP, or custom transports</li>
<li>Tools are defined with JSON Schema for type safety      </li>
<li>Error handling and validation are critical for reliability</li>
<li>The MCP Inspector is invaluable for development and testing</li>
<li>Always log to stderr, never stdout (reserved for protocol)</li>
</ul>
<hr />
<h2 id="lab02-first-mcp-server-troubleshooting-checklist">Troubleshooting Checklist<a class="headerlink" href="#lab02-first-mcp-server-troubleshooting-checklist" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Before moving on, verify:</p>
<ul class="task-list">
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Your server builds without TypeScript errors</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> The server starts and logs &ldquo;running on stdio&rdquo;</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> The MCP Inspector can connect to your server</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Tools appear in the inspector&rsquo;s tool list</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> You can successfully call the <code>hello_world</code> tool</li>
<li class="task-list-item"><label class="task-list-control"><input type="checkbox" disabled/><span class="task-list-indicator"></span></label> Error messages are helpful and informative</li>
</ul>
</li>
</ul>
<hr />
<p><strong>Congratulations! You&rsquo;ve built your first MCP server! Ready for more? Continue to <a href="#lab03-mcp-tools"><strong>Lab 3</strong></a>!</strong></p></section><section class="print-page" id="lab03-mcp-tools" heading-number="3.5"><h1 id="lab03-mcp-tools-lab-3-implementing-mcp-tools">Lab 3: Implementing MCP Tools<a class="headerlink" href="#lab03-mcp-tools-lab-3-implementing-mcp-tools" title="Permanent link">&para;</a></h1>
<h2 id="lab03-mcp-tools-overview">Overview<a class="headerlink" href="#lab03-mcp-tools-overview" title="Permanent link">&para;</a></h2>
<p>In <a href="#lab02-first-mcp-server">Lab 2</a>, you created a basic <code>MCP</code> server with a simple &ldquo;hello world&rdquo; tool. Now it&rsquo;s time to level up! </p>
<p>In this lab, you&rsquo;ll master the art of creating sophisticated, production-ready <code>MCP</code> tools that can handle complex inputs, perform real-world operations, and return rich content types.</p>
<hr />
<h2 id="lab03-mcp-tools-learning-objectives">Learning Objectives<a class="headerlink" href="#lab03-mcp-tools-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Design robust tool schemas with advanced validation</li>
<li>Implement tools that interact with external systems (APIs, databases, file systems)</li>
<li>Return multiple content types (text, images, resources)</li>
<li>Handle errors gracefully with detailed feedback</li>
<li>Implement async operations and streaming responses</li>
<li>Apply best practices for tool composition</li>
<li>Test tools thoroughly with various edge cases</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-prerequisites">Prerequisites<a class="headerlink" href="#lab03-mcp-tools-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Completed <a href="#lab02-first-mcp-server">Lab 2 - Building Your First MCP Server</a></li>
<li>Understanding of async/await in JavaScript/TypeScript</li>
<li>Basic knowledge of REST APIs and JSON</li>
<li>Node.js development environment set up</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-understanding-tool-design">Understanding Tool Design<a class="headerlink" href="#lab03-mcp-tools-understanding-tool-design" title="Permanent link">&para;</a></h2>
<h3 id="lab03-mcp-tools-what-makes-a-great-mcp-tool">What Makes a Great <code>MCP</code> Tool?<a class="headerlink" href="#lab03-mcp-tools-what-makes-a-great-mcp-tool" title="Permanent link">&para;</a></h3>
<p>A well-designed tool should be:</p>
<ol>
<li><strong>Single Purpose</strong>: Does one thing well</li>
<li><strong>Self-Descriptive</strong>: Clear name and description</li>
<li><strong>Well-Validated</strong>: Comprehensive input schema</li>
<li><strong>Error-Resilient</strong>: Handles failures gracefully</li>
<li><strong>Efficient</strong>: Returns results quickly</li>
<li><strong>Composable</strong>: Can work with other tools</li>
</ol>
<h3 id="lab03-mcp-tools-tool-anatomy">Tool Anatomy<a class="headerlink" href="#lab03-mcp-tools-tool-anatomy" title="Permanent link">&para;</a></h3>
<p>Every <code>MCP</code> tool consists of the following key components:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab03-mcp-tools-__codelineno-0-1"></a><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab03-mcp-tools-__codelineno-0-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;tool_name&quot;</span><span class="p">,</span><span class="w">              </span><span class="c1">// Unique identifier</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab03-mcp-tools-__codelineno-0-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;What it does&quot;</span><span class="p">,</span><span class="w">    </span><span class="c1">// Clear explanation for LLM</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab03-mcp-tools-__codelineno-0-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w">                  </span><span class="c1">// JSON Schema for validation</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab03-mcp-tools-__codelineno-0-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab03-mcp-tools-__codelineno-0-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab03-mcp-tools-__codelineno-0-7"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">]</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab03-mcp-tools-__codelineno-0-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#lab03-mcp-tools-__codelineno-0-9"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="lab03-mcp-tools-advanced-input-schema-design">Advanced Input Schema Design<a class="headerlink" href="#lab03-mcp-tools-advanced-input-schema-design" title="Permanent link">&para;</a></h2>
<h3 id="lab03-mcp-tools-example-1-file-search-tool">Example 1: File Search Tool<a class="headerlink" href="#lab03-mcp-tools-example-1-file-search-tool" title="Permanent link">&para;</a></h3>
<p><strong>Key Features:</strong></p>
<ul>
<li>Pattern validation using <code>regex</code></li>
<li>Default values for optional parameters</li>
<li>Min/max constraints for numbers</li>
<li>Clear descriptions for the <strong>LLM</strong> </li>
</ul>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab03-mcp-tools-__codelineno-1-1"></a><span class="p">{</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab03-mcp-tools-__codelineno-1-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;search_files&quot;</span><span class="p">,</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab03-mcp-tools-__codelineno-1-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search for files in a directory using glob patterns&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#lab03-mcp-tools-__codelineno-1-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#lab03-mcp-tools-__codelineno-1-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#lab03-mcp-tools-__codelineno-1-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#lab03-mcp-tools-__codelineno-1-7"></a><span class="w">      </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#lab03-mcp-tools-__codelineno-1-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#lab03-mcp-tools-__codelineno-1-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Directory path to search in&quot;</span><span class="p">,</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#lab03-mcp-tools-__codelineno-1-10"></a><span class="w">        </span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;^(/|\\./|\\.\\./).*&quot;</span><span class="w">  </span><span class="c1">// Must be absolute or relative path</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#lab03-mcp-tools-__codelineno-1-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#lab03-mcp-tools-__codelineno-1-12"></a><span class="w">      </span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#lab03-mcp-tools-__codelineno-1-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#lab03-mcp-tools-__codelineno-1-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Glob pattern (e.g., &#39;*.ts&#39;, &#39;**/*.json&#39;)&quot;</span><span class="p">,</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#lab03-mcp-tools-__codelineno-1-15"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#lab03-mcp-tools-__codelineno-1-16"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#lab03-mcp-tools-__codelineno-1-17"></a><span class="w">      </span><span class="nx">recursive</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#lab03-mcp-tools-__codelineno-1-18"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#lab03-mcp-tools-__codelineno-1-19"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search subdirectories&quot;</span><span class="p">,</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#lab03-mcp-tools-__codelineno-1-20"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#lab03-mcp-tools-__codelineno-1-21"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#lab03-mcp-tools-__codelineno-1-22"></a><span class="w">      </span><span class="nx">maxResults</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#lab03-mcp-tools-__codelineno-1-23"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#lab03-mcp-tools-__codelineno-1-24"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum number of results to return&quot;</span><span class="p">,</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#lab03-mcp-tools-__codelineno-1-25"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#lab03-mcp-tools-__codelineno-1-26"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span><span class="p">,</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#lab03-mcp-tools-__codelineno-1-27"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-1-28"><a id="__codelineno-1-28" name="__codelineno-1-28" href="#lab03-mcp-tools-__codelineno-1-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-1-29"><a id="__codelineno-1-29" name="__codelineno-1-29" href="#lab03-mcp-tools-__codelineno-1-29"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-1-30"><a id="__codelineno-1-30" name="__codelineno-1-30" href="#lab03-mcp-tools-__codelineno-1-30"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">]</span>
</span><span id="__span-1-31"><a id="__codelineno-1-31" name="__codelineno-1-31" href="#lab03-mcp-tools-__codelineno-1-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-1-32"><a id="__codelineno-1-32" name="__codelineno-1-32" href="#lab03-mcp-tools-__codelineno-1-32"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lab03-mcp-tools-example-2-api-request-tool">Example 2: API Request Tool<a class="headerlink" href="#lab03-mcp-tools-example-2-api-request-tool" title="Permanent link">&para;</a></h3>
<p><strong>Key Features:</strong></p>
<ul>
<li>Format validation (<code>uri</code>)</li>
<li>Enum constraints</li>
<li>Nested objects with additional properties</li>
<li>Practical defaults</li>
</ul>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab03-mcp-tools-__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab03-mcp-tools-__codelineno-2-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;make_api_request&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab03-mcp-tools-__codelineno-2-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Make HTTP requests to REST APIs&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab03-mcp-tools-__codelineno-2-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab03-mcp-tools-__codelineno-2-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab03-mcp-tools-__codelineno-2-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab03-mcp-tools-__codelineno-2-7"></a><span class="w">      </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab03-mcp-tools-__codelineno-2-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#lab03-mcp-tools-__codelineno-2-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Full URL to request&quot;</span><span class="p">,</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#lab03-mcp-tools-__codelineno-2-10"></a><span class="w">        </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#lab03-mcp-tools-__codelineno-2-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#lab03-mcp-tools-__codelineno-2-12"></a><span class="w">      </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#lab03-mcp-tools-__codelineno-2-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#lab03-mcp-tools-__codelineno-2-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;HTTP method&quot;</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#lab03-mcp-tools-__codelineno-2-15"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;POST&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PUT&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DELETE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;PATCH&quot;</span><span class="p">],</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#lab03-mcp-tools-__codelineno-2-16"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;GET&quot;</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#lab03-mcp-tools-__codelineno-2-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#lab03-mcp-tools-__codelineno-2-18"></a><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#lab03-mcp-tools-__codelineno-2-19"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#lab03-mcp-tools-__codelineno-2-20"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;HTTP headers as key-value pairs&quot;</span><span class="p">,</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#lab03-mcp-tools-__codelineno-2-21"></a><span class="w">        </span><span class="nx">additionalProperties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#lab03-mcp-tools-__codelineno-2-22"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#lab03-mcp-tools-__codelineno-2-23"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#lab03-mcp-tools-__codelineno-2-24"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-2-25"><a id="__codelineno-2-25" name="__codelineno-2-25" href="#lab03-mcp-tools-__codelineno-2-25"></a><span class="w">      </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-26"><a id="__codelineno-2-26" name="__codelineno-2-26" href="#lab03-mcp-tools-__codelineno-2-26"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-2-27"><a id="__codelineno-2-27" name="__codelineno-2-27" href="#lab03-mcp-tools-__codelineno-2-27"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Request body (JSON string for POST/PUT)&quot;</span>
</span><span id="__span-2-28"><a id="__codelineno-2-28" name="__codelineno-2-28" href="#lab03-mcp-tools-__codelineno-2-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-2-29"><a id="__codelineno-2-29" name="__codelineno-2-29" href="#lab03-mcp-tools-__codelineno-2-29"></a><span class="w">      </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-30"><a id="__codelineno-2-30" name="__codelineno-2-30" href="#lab03-mcp-tools-__codelineno-2-30"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-2-31"><a id="__codelineno-2-31" name="__codelineno-2-31" href="#lab03-mcp-tools-__codelineno-2-31"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Request timeout in milliseconds&quot;</span><span class="p">,</span>
</span><span id="__span-2-32"><a id="__codelineno-2-32" name="__codelineno-2-32" href="#lab03-mcp-tools-__codelineno-2-32"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="p">,</span>
</span><span id="__span-2-33"><a id="__codelineno-2-33" name="__codelineno-2-33" href="#lab03-mcp-tools-__codelineno-2-33"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">30000</span><span class="p">,</span>
</span><span id="__span-2-34"><a id="__codelineno-2-34" name="__codelineno-2-34" href="#lab03-mcp-tools-__codelineno-2-34"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">5000</span>
</span><span id="__span-2-35"><a id="__codelineno-2-35" name="__codelineno-2-35" href="#lab03-mcp-tools-__codelineno-2-35"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-2-36"><a id="__codelineno-2-36" name="__codelineno-2-36" href="#lab03-mcp-tools-__codelineno-2-36"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-2-37"><a id="__codelineno-2-37" name="__codelineno-2-37" href="#lab03-mcp-tools-__codelineno-2-37"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;method&quot;</span><span class="p">]</span>
</span><span id="__span-2-38"><a id="__codelineno-2-38" name="__codelineno-2-38" href="#lab03-mcp-tools-__codelineno-2-38"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-39"><a id="__codelineno-2-39" name="__codelineno-2-39" href="#lab03-mcp-tools-__codelineno-2-39"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="lab03-mcp-tools-implementing-real-world-tools">Implementing Real-World Tools<a class="headerlink" href="#lab03-mcp-tools-implementing-real-world-tools" title="Permanent link">&para;</a></h2>
<h3 id="lab03-mcp-tools-tool-1-weather-information-with-ollama">Tool 1: Weather Information with Ollama<a class="headerlink" href="#lab03-mcp-tools-tool-1-weather-information-with-ollama" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Create a production-ready weather tool that uses Ollama (local AI) to generate weather information, handles errors gracefully, and returns formatted information.</p>
<h4 id="lab03-mcp-tools-complete-weather-tool-implementation-with-ollama">Complete Weather Tool Implementation with Ollama<a class="headerlink" href="#lab03-mcp-tools-complete-weather-tool-implementation-with-ollama" title="Permanent link">&para;</a></h4>
<ul>
<li>Here is the complete <code>src/index.ts</code> file with the Ollama-based weather tool added. </li>
<li><strong>Copy this entire code and overwrite your existing <code>src/index.ts</code> file:</strong></li>
</ul>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab03-mcp-tools-__codelineno-3-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab03-mcp-tools-__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#lab03-mcp-tools-__codelineno-3-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#lab03-mcp-tools-__codelineno-3-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#lab03-mcp-tools-__codelineno-3-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#lab03-mcp-tools-__codelineno-3-6"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#lab03-mcp-tools-__codelineno-3-7"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#lab03-mcp-tools-__codelineno-3-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#lab03-mcp-tools-__codelineno-3-9"></a>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#lab03-mcp-tools-__codelineno-3-10"></a><span class="cm">/**</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#lab03-mcp-tools-__codelineno-3-11"></a><span class="cm">* Create an MCP server with core capabilities</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#lab03-mcp-tools-__codelineno-3-12"></a><span class="cm">*/</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#lab03-mcp-tools-__codelineno-3-13"></a><span class="kd">class</span><span class="w"> </span><span class="nx">MyFirstMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#lab03-mcp-tools-__codelineno-3-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#lab03-mcp-tools-__codelineno-3-15"></a>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#lab03-mcp-tools-__codelineno-3-16"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-17"><a id="__codelineno-3-17" name="__codelineno-3-17" href="#lab03-mcp-tools-__codelineno-3-17"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-3-18"><a id="__codelineno-3-18" name="__codelineno-3-18" href="#lab03-mcp-tools-__codelineno-3-18"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-3-19"><a id="__codelineno-3-19" name="__codelineno-3-19" href="#lab03-mcp-tools-__codelineno-3-19"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-3-20"><a id="__codelineno-3-20" name="__codelineno-3-20" href="#lab03-mcp-tools-__codelineno-3-20"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-3-21"><a id="__codelineno-3-21" name="__codelineno-3-21" href="#lab03-mcp-tools-__codelineno-3-21"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-3-22"><a id="__codelineno-3-22" name="__codelineno-3-22" href="#lab03-mcp-tools-__codelineno-3-22"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-3-23"><a id="__codelineno-3-23" name="__codelineno-3-23" href="#lab03-mcp-tools-__codelineno-3-23"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-24"><a id="__codelineno-3-24" name="__codelineno-3-24" href="#lab03-mcp-tools-__codelineno-3-24"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-3-25"><a id="__codelineno-3-25" name="__codelineno-3-25" href="#lab03-mcp-tools-__codelineno-3-25"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-3-26"><a id="__codelineno-3-26" name="__codelineno-3-26" href="#lab03-mcp-tools-__codelineno-3-26"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-3-27"><a id="__codelineno-3-27" name="__codelineno-3-27" href="#lab03-mcp-tools-__codelineno-3-27"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-3-28"><a id="__codelineno-3-28" name="__codelineno-3-28" href="#lab03-mcp-tools-__codelineno-3-28"></a>
</span><span id="__span-3-29"><a id="__codelineno-3-29" name="__codelineno-3-29" href="#lab03-mcp-tools-__codelineno-3-29"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-3-30"><a id="__codelineno-3-30" name="__codelineno-3-30" href="#lab03-mcp-tools-__codelineno-3-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-3-31"><a id="__codelineno-3-31" name="__codelineno-3-31" href="#lab03-mcp-tools-__codelineno-3-31"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-32"><a id="__codelineno-3-32" name="__codelineno-3-32" href="#lab03-mcp-tools-__codelineno-3-32"></a>
</span><span id="__span-3-33"><a id="__codelineno-3-33" name="__codelineno-3-33" href="#lab03-mcp-tools-__codelineno-3-33"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-3-34"><a id="__codelineno-3-34" name="__codelineno-3-34" href="#lab03-mcp-tools-__codelineno-3-34"></a><span class="cm">  * Set up request handlers</span>
</span><span id="__span-3-35"><a id="__codelineno-3-35" name="__codelineno-3-35" href="#lab03-mcp-tools-__codelineno-3-35"></a><span class="cm">  */</span>
</span><span id="__span-3-36"><a id="__codelineno-3-36" name="__codelineno-3-36" href="#lab03-mcp-tools-__codelineno-3-36"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-37"><a id="__codelineno-3-37" name="__codelineno-3-37" href="#lab03-mcp-tools-__codelineno-3-37"></a><span class="w">    </span><span class="c1">// Handler for listing available tools</span>
</span><span id="__span-3-38"><a id="__codelineno-3-38" name="__codelineno-3-38" href="#lab03-mcp-tools-__codelineno-3-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-3-39"><a id="__codelineno-3-39" name="__codelineno-3-39" href="#lab03-mcp-tools-__codelineno-3-39"></a><span class="w">      </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-3-40"><a id="__codelineno-3-40" name="__codelineno-3-40" href="#lab03-mcp-tools-__codelineno-3-40"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-3-41"><a id="__codelineno-3-41" name="__codelineno-3-41" href="#lab03-mcp-tools-__codelineno-3-41"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-42"><a id="__codelineno-3-42" name="__codelineno-3-42" href="#lab03-mcp-tools-__codelineno-3-42"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-3-43"><a id="__codelineno-3-43" name="__codelineno-3-43" href="#lab03-mcp-tools-__codelineno-3-43"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
</span><span id="__span-3-44"><a id="__codelineno-3-44" name="__codelineno-3-44" href="#lab03-mcp-tools-__codelineno-3-44"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Get current weather information for a city using AI&quot;</span><span class="p">,</span>
</span><span id="__span-3-45"><a id="__codelineno-3-45" name="__codelineno-3-45" href="#lab03-mcp-tools-__codelineno-3-45"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-46"><a id="__codelineno-3-46" name="__codelineno-3-46" href="#lab03-mcp-tools-__codelineno-3-46"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-3-47"><a id="__codelineno-3-47" name="__codelineno-3-47" href="#lab03-mcp-tools-__codelineno-3-47"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-48"><a id="__codelineno-3-48" name="__codelineno-3-48" href="#lab03-mcp-tools-__codelineno-3-48"></a><span class="w">                </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-49"><a id="__codelineno-3-49" name="__codelineno-3-49" href="#lab03-mcp-tools-__codelineno-3-49"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-3-50"><a id="__codelineno-3-50" name="__codelineno-3-50" href="#lab03-mcp-tools-__codelineno-3-50"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;City name (e.g., &#39;London&#39;, &#39;New York&#39;)&quot;</span>
</span><span id="__span-3-51"><a id="__codelineno-3-51" name="__codelineno-3-51" href="#lab03-mcp-tools-__codelineno-3-51"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-52"><a id="__codelineno-3-52" name="__codelineno-3-52" href="#lab03-mcp-tools-__codelineno-3-52"></a><span class="w">                </span><span class="nx">units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-53"><a id="__codelineno-3-53" name="__codelineno-3-53" href="#lab03-mcp-tools-__codelineno-3-53"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-3-54"><a id="__codelineno-3-54" name="__codelineno-3-54" href="#lab03-mcp-tools-__codelineno-3-54"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Temperature units&quot;</span><span class="p">,</span>
</span><span id="__span-3-55"><a id="__codelineno-3-55" name="__codelineno-3-55" href="#lab03-mcp-tools-__codelineno-3-55"></a><span class="w">                  </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;celsius&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">],</span>
</span><span id="__span-3-56"><a id="__codelineno-3-56" name="__codelineno-3-56" href="#lab03-mcp-tools-__codelineno-3-56"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;celsius&quot;</span>
</span><span id="__span-3-57"><a id="__codelineno-3-57" name="__codelineno-3-57" href="#lab03-mcp-tools-__codelineno-3-57"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-58"><a id="__codelineno-3-58" name="__codelineno-3-58" href="#lab03-mcp-tools-__codelineno-3-58"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-3-59"><a id="__codelineno-3-59" name="__codelineno-3-59" href="#lab03-mcp-tools-__codelineno-3-59"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span>
</span><span id="__span-3-60"><a id="__codelineno-3-60" name="__codelineno-3-60" href="#lab03-mcp-tools-__codelineno-3-60"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-3-61"><a id="__codelineno-3-61" name="__codelineno-3-61" href="#lab03-mcp-tools-__codelineno-3-61"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-3-62"><a id="__codelineno-3-62" name="__codelineno-3-62" href="#lab03-mcp-tools-__codelineno-3-62"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-3-63"><a id="__codelineno-3-63" name="__codelineno-3-63" href="#lab03-mcp-tools-__codelineno-3-63"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">,</span>
</span><span id="__span-3-64"><a id="__codelineno-3-64" name="__codelineno-3-64" href="#lab03-mcp-tools-__codelineno-3-64"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Returns a friendly greeting message&quot;</span><span class="p">,</span>
</span><span id="__span-3-65"><a id="__codelineno-3-65" name="__codelineno-3-65" href="#lab03-mcp-tools-__codelineno-3-65"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-66"><a id="__codelineno-3-66" name="__codelineno-3-66" href="#lab03-mcp-tools-__codelineno-3-66"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-3-67"><a id="__codelineno-3-67" name="__codelineno-3-67" href="#lab03-mcp-tools-__codelineno-3-67"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-68"><a id="__codelineno-3-68" name="__codelineno-3-68" href="#lab03-mcp-tools-__codelineno-3-68"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-69"><a id="__codelineno-3-69" name="__codelineno-3-69" href="#lab03-mcp-tools-__codelineno-3-69"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-3-70"><a id="__codelineno-3-70" name="__codelineno-3-70" href="#lab03-mcp-tools-__codelineno-3-70"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The name to greet&quot;</span><span class="p">,</span>
</span><span id="__span-3-71"><a id="__codelineno-3-71" name="__codelineno-3-71" href="#lab03-mcp-tools-__codelineno-3-71"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-72"><a id="__codelineno-3-72" name="__codelineno-3-72" href="#lab03-mcp-tools-__codelineno-3-72"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-3-73"><a id="__codelineno-3-73" name="__codelineno-3-73" href="#lab03-mcp-tools-__codelineno-3-73"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="__span-3-74"><a id="__codelineno-3-74" name="__codelineno-3-74" href="#lab03-mcp-tools-__codelineno-3-74"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-3-75"><a id="__codelineno-3-75" name="__codelineno-3-75" href="#lab03-mcp-tools-__codelineno-3-75"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-3-76"><a id="__codelineno-3-76" name="__codelineno-3-76" href="#lab03-mcp-tools-__codelineno-3-76"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-3-77"><a id="__codelineno-3-77" name="__codelineno-3-77" href="#lab03-mcp-tools-__codelineno-3-77"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-3-78"><a id="__codelineno-3-78" name="__codelineno-3-78" href="#lab03-mcp-tools-__codelineno-3-78"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-3-79"><a id="__codelineno-3-79" name="__codelineno-3-79" href="#lab03-mcp-tools-__codelineno-3-79"></a>
</span><span id="__span-3-80"><a id="__codelineno-3-80" name="__codelineno-3-80" href="#lab03-mcp-tools-__codelineno-3-80"></a><span class="w">    </span><span class="c1">// Handler for calling tools</span>
</span><span id="__span-3-81"><a id="__codelineno-3-81" name="__codelineno-3-81" href="#lab03-mcp-tools-__codelineno-3-81"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-3-82"><a id="__codelineno-3-82" name="__codelineno-3-82" href="#lab03-mcp-tools-__codelineno-3-82"></a><span class="w">      </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-3-83"><a id="__codelineno-3-83" name="__codelineno-3-83" href="#lab03-mcp-tools-__codelineno-3-83"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-84"><a id="__codelineno-3-84" name="__codelineno-3-84" href="#lab03-mcp-tools-__codelineno-3-84"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-3-85"><a id="__codelineno-3-85" name="__codelineno-3-85" href="#lab03-mcp-tools-__codelineno-3-85"></a>
</span><span id="__span-3-86"><a id="__codelineno-3-86" name="__codelineno-3-86" href="#lab03-mcp-tools-__codelineno-3-86"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;get_weather&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-87"><a id="__codelineno-3-87" name="__codelineno-3-87" href="#lab03-mcp-tools-__codelineno-3-87"></a><span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-88"><a id="__codelineno-3-88" name="__codelineno-3-88" href="#lab03-mcp-tools-__codelineno-3-88"></a><span class="w">            </span><span class="c1">// Extract and validate parameters</span>
</span><span id="__span-3-89"><a id="__codelineno-3-89" name="__codelineno-3-89" href="#lab03-mcp-tools-__codelineno-3-89"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">city</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">city</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-90"><a id="__codelineno-3-90" name="__codelineno-3-90" href="#lab03-mcp-tools-__codelineno-3-90"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">units</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;celsius&quot;</span><span class="p">;</span>
</span><span id="__span-3-91"><a id="__codelineno-3-91" name="__codelineno-3-91" href="#lab03-mcp-tools-__codelineno-3-91"></a>
</span><span id="__span-3-92"><a id="__codelineno-3-92" name="__codelineno-3-92" href="#lab03-mcp-tools-__codelineno-3-92"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">city</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">city</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-93"><a id="__codelineno-3-93" name="__codelineno-3-93" href="#lab03-mcp-tools-__codelineno-3-93"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;City name cannot be empty&quot;</span><span class="p">);</span>
</span><span id="__span-3-94"><a id="__codelineno-3-94" name="__codelineno-3-94" href="#lab03-mcp-tools-__codelineno-3-94"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-3-95"><a id="__codelineno-3-95" name="__codelineno-3-95" href="#lab03-mcp-tools-__codelineno-3-95"></a>
</span><span id="__span-3-96"><a id="__codelineno-3-96" name="__codelineno-3-96" href="#lab03-mcp-tools-__codelineno-3-96"></a><span class="w">            </span><span class="c1">// Use Ollama to generate weather information</span>
</span><span id="__span-3-97"><a id="__codelineno-3-97" name="__codelineno-3-97" href="#lab03-mcp-tools-__codelineno-3-97"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">prompt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`Generate realistic current weather information for </span><span class="si">${</span><span class="nx">city</span><span class="si">}</span><span class="sb">.</span>
</span><span id="__span-3-98"><a id="__codelineno-3-98" name="__codelineno-3-98" href="#lab03-mcp-tools-__codelineno-3-98"></a><span class="sb">            Return ONLY a JSON object with this exact structure:</span>
</span><span id="__span-3-99"><a id="__codelineno-3-99" name="__codelineno-3-99" href="#lab03-mcp-tools-__codelineno-3-99"></a><span class="sb">            {</span>
</span><span id="__span-3-100"><a id="__codelineno-3-100" name="__codelineno-3-100" href="#lab03-mcp-tools-__codelineno-3-100"></a><span class="sb">              &quot;name&quot;: &quot;</span><span class="si">${</span><span class="nx">city</span><span class="si">}</span><span class="sb">&quot;,</span>
</span><span id="__span-3-101"><a id="__codelineno-3-101" name="__codelineno-3-101" href="#lab03-mcp-tools-__codelineno-3-101"></a><span class="sb">              &quot;sys&quot;: {&quot;country&quot;: &quot;XX&quot;},</span>
</span><span id="__span-3-102"><a id="__codelineno-3-102" name="__codelineno-3-102" href="#lab03-mcp-tools-__codelineno-3-102"></a><span class="sb">              &quot;main&quot;: {&quot;temp&quot;: 20.5, &quot;feels_like&quot;: 22.1, &quot;humidity&quot;: 65},</span>
</span><span id="__span-3-103"><a id="__codelineno-3-103" name="__codelineno-3-103" href="#lab03-mcp-tools-__codelineno-3-103"></a><span class="sb">              &quot;weather&quot;: [{&quot;description&quot;: &quot;clear sky&quot;}],</span>
</span><span id="__span-3-104"><a id="__codelineno-3-104" name="__codelineno-3-104" href="#lab03-mcp-tools-__codelineno-3-104"></a><span class="sb">              &quot;wind&quot;: {&quot;speed&quot;: 3.2}</span>
</span><span id="__span-3-105"><a id="__codelineno-3-105" name="__codelineno-3-105" href="#lab03-mcp-tools-__codelineno-3-105"></a><span class="sb">            }</span>
</span><span id="__span-3-106"><a id="__codelineno-3-106" name="__codelineno-3-106" href="#lab03-mcp-tools-__codelineno-3-106"></a>
</span><span id="__span-3-107"><a id="__codelineno-3-107" name="__codelineno-3-107" href="#lab03-mcp-tools-__codelineno-3-107"></a><span class="sb">            Use realistic weather data appropriate for the location. Temperature should be in Celsius. Choose an appropriate 2-letter country code for the city. Make the weather description realistic for the location and season.`</span><span class="p">;</span>
</span><span id="__span-3-108"><a id="__codelineno-3-108" name="__codelineno-3-108" href="#lab03-mcp-tools-__codelineno-3-108"></a>
</span><span id="__span-3-109"><a id="__codelineno-3-109" name="__codelineno-3-109" href="#lab03-mcp-tools-__codelineno-3-109"></a><span class="w">            </span><span class="c1">// Call Ollama API</span>
</span><span id="__span-3-110"><a id="__codelineno-3-110" name="__codelineno-3-110" href="#lab03-mcp-tools-__codelineno-3-110"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetch</span><span class="p">(</span><span class="s1">&#39;http://localhost:11434/api/generate&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-111"><a id="__codelineno-3-111" name="__codelineno-3-111" href="#lab03-mcp-tools-__codelineno-3-111"></a><span class="w">              </span><span class="nx">method</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;POST&#39;</span><span class="p">,</span>
</span><span id="__span-3-112"><a id="__codelineno-3-112" name="__codelineno-3-112" href="#lab03-mcp-tools-__codelineno-3-112"></a><span class="w">              </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-113"><a id="__codelineno-3-113" name="__codelineno-3-113" href="#lab03-mcp-tools-__codelineno-3-113"></a><span class="w">                </span><span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-3-114"><a id="__codelineno-3-114" name="__codelineno-3-114" href="#lab03-mcp-tools-__codelineno-3-114"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-3-115"><a id="__codelineno-3-115" name="__codelineno-3-115" href="#lab03-mcp-tools-__codelineno-3-115"></a><span class="w">              </span><span class="nx">body</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-3-116"><a id="__codelineno-3-116" name="__codelineno-3-116" href="#lab03-mcp-tools-__codelineno-3-116"></a><span class="w">                </span><span class="nx">model</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;gpt-oss:20b&#39;</span><span class="p">,</span>
</span><span id="__span-3-117"><a id="__codelineno-3-117" name="__codelineno-3-117" href="#lab03-mcp-tools-__codelineno-3-117"></a><span class="w">                </span><span class="nx">prompt</span><span class="o">:</span><span class="w"> </span><span class="kt">prompt</span><span class="p">,</span>
</span><span id="__span-3-118"><a id="__codelineno-3-118" name="__codelineno-3-118" href="#lab03-mcp-tools-__codelineno-3-118"></a><span class="w">                </span><span class="nx">stream</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-3-119"><a id="__codelineno-3-119" name="__codelineno-3-119" href="#lab03-mcp-tools-__codelineno-3-119"></a><span class="w">                </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;json&#39;</span>
</span><span id="__span-3-120"><a id="__codelineno-3-120" name="__codelineno-3-120" href="#lab03-mcp-tools-__codelineno-3-120"></a><span class="w">              </span><span class="p">}),</span>
</span><span id="__span-3-121"><a id="__codelineno-3-121" name="__codelineno-3-121" href="#lab03-mcp-tools-__codelineno-3-121"></a><span class="w">            </span><span class="p">});</span>
</span><span id="__span-3-122"><a id="__codelineno-3-122" name="__codelineno-3-122" href="#lab03-mcp-tools-__codelineno-3-122"></a>
</span><span id="__span-3-123"><a id="__codelineno-3-123" name="__codelineno-3-123" href="#lab03-mcp-tools-__codelineno-3-123"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">response</span><span class="p">.</span><span class="nx">ok</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-124"><a id="__codelineno-3-124" name="__codelineno-3-124" href="#lab03-mcp-tools-__codelineno-3-124"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Ollama API error: </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">. Make sure Ollama is running with &#39;ollama serve&#39;.`</span><span class="p">);</span>
</span><span id="__span-3-125"><a id="__codelineno-3-125" name="__codelineno-3-125" href="#lab03-mcp-tools-__codelineno-3-125"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-3-126"><a id="__codelineno-3-126" name="__codelineno-3-126" href="#lab03-mcp-tools-__codelineno-3-126"></a>
</span><span id="__span-3-127"><a id="__codelineno-3-127" name="__codelineno-3-127" href="#lab03-mcp-tools-__codelineno-3-127"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">ollamaResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">json</span><span class="p">();</span>
</span><span id="__span-3-128"><a id="__codelineno-3-128" name="__codelineno-3-128" href="#lab03-mcp-tools-__codelineno-3-128"></a><span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="nx">data</span><span class="p">;</span>
</span><span id="__span-3-129"><a id="__codelineno-3-129" name="__codelineno-3-129" href="#lab03-mcp-tools-__codelineno-3-129"></a>
</span><span id="__span-3-130"><a id="__codelineno-3-130" name="__codelineno-3-130" href="#lab03-mcp-tools-__codelineno-3-130"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-131"><a id="__codelineno-3-131" name="__codelineno-3-131" href="#lab03-mcp-tools-__codelineno-3-131"></a><span class="w">              </span><span class="c1">// Parse the JSON response from Ollama</span>
</span><span id="__span-3-132"><a id="__codelineno-3-132" name="__codelineno-3-132" href="#lab03-mcp-tools-__codelineno-3-132"></a><span class="w">              </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">ollamaResult</span><span class="p">.</span><span class="nx">response</span><span class="p">);</span>
</span><span id="__span-3-133"><a id="__codelineno-3-133" name="__codelineno-3-133" href="#lab03-mcp-tools-__codelineno-3-133"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">parseError</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-134"><a id="__codelineno-3-134" name="__codelineno-3-134" href="#lab03-mcp-tools-__codelineno-3-134"></a><span class="w">              </span><span class="c1">// Fallback to mock data if parsing fails</span>
</span><span id="__span-3-135"><a id="__codelineno-3-135" name="__codelineno-3-135" href="#lab03-mcp-tools-__codelineno-3-135"></a><span class="w">              </span><span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;Failed to parse Ollama response, using fallback data&#39;</span><span class="p">);</span>
</span><span id="__span-3-136"><a id="__codelineno-3-136" name="__codelineno-3-136" href="#lab03-mcp-tools-__codelineno-3-136"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">fallbackData</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-137"><a id="__codelineno-3-137" name="__codelineno-3-137" href="#lab03-mcp-tools-__codelineno-3-137"></a><span class="w">                </span><span class="s2">&quot;london&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-138"><a id="__codelineno-3-138" name="__codelineno-3-138" href="#lab03-mcp-tools-__codelineno-3-138"></a><span class="w">                  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;London&quot;</span><span class="p">,</span>
</span><span id="__span-3-139"><a id="__codelineno-3-139" name="__codelineno-3-139" href="#lab03-mcp-tools-__codelineno-3-139"></a><span class="w">                  </span><span class="nx">sys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;GB&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-140"><a id="__codelineno-3-140" name="__codelineno-3-140" href="#lab03-mcp-tools-__codelineno-3-140"></a><span class="w">                  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="kt">15.2</span><span class="p">,</span><span class="w"> </span><span class="nx">feels_like</span><span class="o">:</span><span class="w"> </span><span class="kt">14.8</span><span class="p">,</span><span class="w"> </span><span class="nx">humidity</span><span class="o">:</span><span class="w"> </span><span class="kt">82</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-141"><a id="__codelineno-3-141" name="__codelineno-3-141" href="#lab03-mcp-tools-__codelineno-3-141"></a><span class="w">                  </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;light rain&quot;</span><span class="w"> </span><span class="p">}],</span>
</span><span id="__span-3-142"><a id="__codelineno-3-142" name="__codelineno-3-142" href="#lab03-mcp-tools-__codelineno-3-142"></a><span class="w">                  </span><span class="nx">wind</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">3.6</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-143"><a id="__codelineno-3-143" name="__codelineno-3-143" href="#lab03-mcp-tools-__codelineno-3-143"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-144"><a id="__codelineno-3-144" name="__codelineno-3-144" href="#lab03-mcp-tools-__codelineno-3-144"></a><span class="w">                </span><span class="s2">&quot;new york&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-145"><a id="__codelineno-3-145" name="__codelineno-3-145" href="#lab03-mcp-tools-__codelineno-3-145"></a><span class="w">                  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;New York&quot;</span><span class="p">,</span>
</span><span id="__span-3-146"><a id="__codelineno-3-146" name="__codelineno-3-146" href="#lab03-mcp-tools-__codelineno-3-146"></a><span class="w">                  </span><span class="nx">sys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;US&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-147"><a id="__codelineno-3-147" name="__codelineno-3-147" href="#lab03-mcp-tools-__codelineno-3-147"></a><span class="w">                  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="kt">22.5</span><span class="p">,</span><span class="w"> </span><span class="nx">feels_like</span><span class="o">:</span><span class="w"> </span><span class="kt">24.1</span><span class="p">,</span><span class="w"> </span><span class="nx">humidity</span><span class="o">:</span><span class="w"> </span><span class="kt">65</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-148"><a id="__codelineno-3-148" name="__codelineno-3-148" href="#lab03-mcp-tools-__codelineno-3-148"></a><span class="w">                  </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;clear sky&quot;</span><span class="w"> </span><span class="p">}],</span>
</span><span id="__span-3-149"><a id="__codelineno-3-149" name="__codelineno-3-149" href="#lab03-mcp-tools-__codelineno-3-149"></a><span class="w">                  </span><span class="nx">wind</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">2.1</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-150"><a id="__codelineno-3-150" name="__codelineno-3-150" href="#lab03-mcp-tools-__codelineno-3-150"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-151"><a id="__codelineno-3-151" name="__codelineno-3-151" href="#lab03-mcp-tools-__codelineno-3-151"></a><span class="w">                </span><span class="s2">&quot;tokyo&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-152"><a id="__codelineno-3-152" name="__codelineno-3-152" href="#lab03-mcp-tools-__codelineno-3-152"></a><span class="w">                  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Tokyo&quot;</span><span class="p">,</span>
</span><span id="__span-3-153"><a id="__codelineno-3-153" name="__codelineno-3-153" href="#lab03-mcp-tools-__codelineno-3-153"></a><span class="w">                  </span><span class="nx">sys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;JP&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-154"><a id="__codelineno-3-154" name="__codelineno-3-154" href="#lab03-mcp-tools-__codelineno-3-154"></a><span class="w">                  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="kt">18.7</span><span class="p">,</span><span class="w"> </span><span class="nx">feels_like</span><span class="o">:</span><span class="w"> </span><span class="kt">18.2</span><span class="p">,</span><span class="w"> </span><span class="nx">humidity</span><span class="o">:</span><span class="w"> </span><span class="kt">78</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-155"><a id="__codelineno-3-155" name="__codelineno-3-155" href="#lab03-mcp-tools-__codelineno-3-155"></a><span class="w">                  </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;few clouds&quot;</span><span class="w"> </span><span class="p">}],</span>
</span><span id="__span-3-156"><a id="__codelineno-3-156" name="__codelineno-3-156" href="#lab03-mcp-tools-__codelineno-3-156"></a><span class="w">                  </span><span class="nx">wind</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">1.8</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-157"><a id="__codelineno-3-157" name="__codelineno-3-157" href="#lab03-mcp-tools-__codelineno-3-157"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-158"><a id="__codelineno-3-158" name="__codelineno-3-158" href="#lab03-mcp-tools-__codelineno-3-158"></a><span class="w">                </span><span class="s2">&quot;paris&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-159"><a id="__codelineno-3-159" name="__codelineno-3-159" href="#lab03-mcp-tools-__codelineno-3-159"></a><span class="w">                  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Paris&quot;</span><span class="p">,</span>
</span><span id="__span-3-160"><a id="__codelineno-3-160" name="__codelineno-3-160" href="#lab03-mcp-tools-__codelineno-3-160"></a><span class="w">                  </span><span class="nx">sys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;FR&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-161"><a id="__codelineno-3-161" name="__codelineno-3-161" href="#lab03-mcp-tools-__codelineno-3-161"></a><span class="w">                  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="kt">12.8</span><span class="p">,</span><span class="w"> </span><span class="nx">feels_like</span><span class="o">:</span><span class="w"> </span><span class="kt">11.9</span><span class="p">,</span><span class="w"> </span><span class="nx">humidity</span><span class="o">:</span><span class="w"> </span><span class="kt">71</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-162"><a id="__codelineno-3-162" name="__codelineno-3-162" href="#lab03-mcp-tools-__codelineno-3-162"></a><span class="w">                  </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;overcast clouds&quot;</span><span class="w"> </span><span class="p">}],</span>
</span><span id="__span-3-163"><a id="__codelineno-3-163" name="__codelineno-3-163" href="#lab03-mcp-tools-__codelineno-3-163"></a><span class="w">                  </span><span class="nx">wind</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">4.2</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-164"><a id="__codelineno-3-164" name="__codelineno-3-164" href="#lab03-mcp-tools-__codelineno-3-164"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-3-165"><a id="__codelineno-3-165" name="__codelineno-3-165" href="#lab03-mcp-tools-__codelineno-3-165"></a><span class="w">                </span><span class="s2">&quot;sydney&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-166"><a id="__codelineno-3-166" name="__codelineno-3-166" href="#lab03-mcp-tools-__codelineno-3-166"></a><span class="w">                  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Sydney&quot;</span><span class="p">,</span>
</span><span id="__span-3-167"><a id="__codelineno-3-167" name="__codelineno-3-167" href="#lab03-mcp-tools-__codelineno-3-167"></a><span class="w">                  </span><span class="nx">sys</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">country</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;AU&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-168"><a id="__codelineno-3-168" name="__codelineno-3-168" href="#lab03-mcp-tools-__codelineno-3-168"></a><span class="w">                  </span><span class="nx">main</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">temp</span><span class="o">:</span><span class="w"> </span><span class="kt">24.3</span><span class="p">,</span><span class="w"> </span><span class="nx">feels_like</span><span class="o">:</span><span class="w"> </span><span class="kt">25.1</span><span class="p">,</span><span class="w"> </span><span class="nx">humidity</span><span class="o">:</span><span class="w"> </span><span class="kt">73</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-3-169"><a id="__codelineno-3-169" name="__codelineno-3-169" href="#lab03-mcp-tools-__codelineno-3-169"></a><span class="w">                  </span><span class="nx">weather</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;sunny&quot;</span><span class="w"> </span><span class="p">}],</span>
</span><span id="__span-3-170"><a id="__codelineno-3-170" name="__codelineno-3-170" href="#lab03-mcp-tools-__codelineno-3-170"></a><span class="w">                  </span><span class="nx">wind</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">speed</span><span class="o">:</span><span class="w"> </span><span class="kt">2.8</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-3-171"><a id="__codelineno-3-171" name="__codelineno-3-171" href="#lab03-mcp-tools-__codelineno-3-171"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-172"><a id="__codelineno-3-172" name="__codelineno-3-172" href="#lab03-mcp-tools-__codelineno-3-172"></a><span class="w">              </span><span class="p">};</span>
</span><span id="__span-3-173"><a id="__codelineno-3-173" name="__codelineno-3-173" href="#lab03-mcp-tools-__codelineno-3-173"></a><span class="w">              </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fallbackData</span><span class="p">[</span><span class="nx">city</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">trim</span><span class="p">()]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">fallbackData</span><span class="p">[</span><span class="s2">&quot;london&quot;</span><span class="p">];</span>
</span><span id="__span-3-174"><a id="__codelineno-3-174" name="__codelineno-3-174" href="#lab03-mcp-tools-__codelineno-3-174"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-3-175"><a id="__codelineno-3-175" name="__codelineno-3-175" href="#lab03-mcp-tools-__codelineno-3-175"></a>
</span><span id="__span-3-176"><a id="__codelineno-3-176" name="__codelineno-3-176" href="#lab03-mcp-tools-__codelineno-3-176"></a><span class="w">            </span><span class="c1">// Format response</span>
</span><span id="__span-3-177"><a id="__codelineno-3-177" name="__codelineno-3-177" href="#lab03-mcp-tools-__codelineno-3-177"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">tempUnit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">units</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;fahrenheit&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s2">&quot;¬∞F&quot;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;¬∞C&quot;</span><span class="p">;</span>
</span><span id="__span-3-178"><a id="__codelineno-3-178" name="__codelineno-3-178" href="#lab03-mcp-tools-__codelineno-3-178"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">weatherText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-3-179"><a id="__codelineno-3-179" name="__codelineno-3-179" href="#lab03-mcp-tools-__codelineno-3-179"></a><span class="sb">Weather in </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">, </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">country</span><span class="si">}</span><span class="sb">:</span>
</span><span id="__span-3-180"><a id="__codelineno-3-180" name="__codelineno-3-180" href="#lab03-mcp-tools-__codelineno-3-180"></a><span class="sb">- Temperature: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">temp</span><span class="si">}${</span><span class="nx">tempUnit</span><span class="si">}</span>
</span><span id="__span-3-181"><a id="__codelineno-3-181" name="__codelineno-3-181" href="#lab03-mcp-tools-__codelineno-3-181"></a><span class="sb">- Feels like: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">feels_like</span><span class="si">}${</span><span class="nx">tempUnit</span><span class="si">}</span>
</span><span id="__span-3-182"><a id="__codelineno-3-182" name="__codelineno-3-182" href="#lab03-mcp-tools-__codelineno-3-182"></a><span class="sb">- Conditions: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">weather</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">description</span><span class="si">}</span>
</span><span id="__span-3-183"><a id="__codelineno-3-183" name="__codelineno-3-183" href="#lab03-mcp-tools-__codelineno-3-183"></a><span class="sb">- Humidity: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">main</span><span class="p">.</span><span class="nx">humidity</span><span class="si">}</span><span class="sb">%</span>
</span><span id="__span-3-184"><a id="__codelineno-3-184" name="__codelineno-3-184" href="#lab03-mcp-tools-__codelineno-3-184"></a><span class="sb">- Wind Speed: </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">wind</span><span class="p">.</span><span class="nx">speed</span><span class="si">}</span><span class="sb"> m/s</span>
</span><span id="__span-3-185"><a id="__codelineno-3-185" name="__codelineno-3-185" href="#lab03-mcp-tools-__codelineno-3-185"></a>
</span><span id="__span-3-186"><a id="__codelineno-3-186" name="__codelineno-3-186" href="#lab03-mcp-tools-__codelineno-3-186"></a><span class="sb">*Generated by Ollama AI*</span>
</span><span id="__span-3-187"><a id="__codelineno-3-187" name="__codelineno-3-187" href="#lab03-mcp-tools-__codelineno-3-187"></a><span class="sb">`</span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
</span><span id="__span-3-188"><a id="__codelineno-3-188" name="__codelineno-3-188" href="#lab03-mcp-tools-__codelineno-3-188"></a>
</span><span id="__span-3-189"><a id="__codelineno-3-189" name="__codelineno-3-189" href="#lab03-mcp-tools-__codelineno-3-189"></a><span class="w">            </span><span class="c1">// Return MCP response</span>
</span><span id="__span-3-190"><a id="__codelineno-3-190" name="__codelineno-3-190" href="#lab03-mcp-tools-__codelineno-3-190"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-191"><a id="__codelineno-3-191" name="__codelineno-3-191" href="#lab03-mcp-tools-__codelineno-3-191"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-192"><a id="__codelineno-3-192" name="__codelineno-3-192" href="#lab03-mcp-tools-__codelineno-3-192"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-3-193"><a id="__codelineno-3-193" name="__codelineno-3-193" href="#lab03-mcp-tools-__codelineno-3-193"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-3-194"><a id="__codelineno-3-194" name="__codelineno-3-194" href="#lab03-mcp-tools-__codelineno-3-194"></a><span class="w">                  </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">weatherText</span>
</span><span id="__span-3-195"><a id="__codelineno-3-195" name="__codelineno-3-195" href="#lab03-mcp-tools-__codelineno-3-195"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-3-196"><a id="__codelineno-3-196" name="__codelineno-3-196" href="#lab03-mcp-tools-__codelineno-3-196"></a><span class="w">              </span><span class="p">]</span>
</span><span id="__span-3-197"><a id="__codelineno-3-197" name="__codelineno-3-197" href="#lab03-mcp-tools-__codelineno-3-197"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-3-198"><a id="__codelineno-3-198" name="__codelineno-3-198" href="#lab03-mcp-tools-__codelineno-3-198"></a>
</span><span id="__span-3-199"><a id="__codelineno-3-199" name="__codelineno-3-199" href="#lab03-mcp-tools-__codelineno-3-199"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-200"><a id="__codelineno-3-200" name="__codelineno-3-200" href="#lab03-mcp-tools-__codelineno-3-200"></a><span class="w">            </span><span class="c1">// Handle errors</span>
</span><span id="__span-3-201"><a id="__codelineno-3-201" name="__codelineno-3-201" href="#lab03-mcp-tools-__codelineno-3-201"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-3-202"><a id="__codelineno-3-202" name="__codelineno-3-202" href="#lab03-mcp-tools-__codelineno-3-202"></a><span class="w">              </span><span class="sb">`Failed to get weather: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-3-203"><a id="__codelineno-3-203" name="__codelineno-3-203" href="#lab03-mcp-tools-__codelineno-3-203"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-3-204"><a id="__codelineno-3-204" name="__codelineno-3-204" href="#lab03-mcp-tools-__codelineno-3-204"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-3-205"><a id="__codelineno-3-205" name="__codelineno-3-205" href="#lab03-mcp-tools-__codelineno-3-205"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-206"><a id="__codelineno-3-206" name="__codelineno-3-206" href="#lab03-mcp-tools-__codelineno-3-206"></a>
</span><span id="__span-3-207"><a id="__codelineno-3-207" name="__codelineno-3-207" href="#lab03-mcp-tools-__codelineno-3-207"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-208"><a id="__codelineno-3-208" name="__codelineno-3-208" href="#lab03-mcp-tools-__codelineno-3-208"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">userName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-209"><a id="__codelineno-3-209" name="__codelineno-3-209" href="#lab03-mcp-tools-__codelineno-3-209"></a>
</span><span id="__span-3-210"><a id="__codelineno-3-210" name="__codelineno-3-210" href="#lab03-mcp-tools-__codelineno-3-210"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">userName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-211"><a id="__codelineno-3-211" name="__codelineno-3-211" href="#lab03-mcp-tools-__codelineno-3-211"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Name parameter is required&quot;</span><span class="p">);</span>
</span><span id="__span-3-212"><a id="__codelineno-3-212" name="__codelineno-3-212" href="#lab03-mcp-tools-__codelineno-3-212"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-3-213"><a id="__codelineno-3-213" name="__codelineno-3-213" href="#lab03-mcp-tools-__codelineno-3-213"></a>
</span><span id="__span-3-214"><a id="__codelineno-3-214" name="__codelineno-3-214" href="#lab03-mcp-tools-__codelineno-3-214"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-215"><a id="__codelineno-3-215" name="__codelineno-3-215" href="#lab03-mcp-tools-__codelineno-3-215"></a><span class="w">            </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-3-216"><a id="__codelineno-3-216" name="__codelineno-3-216" href="#lab03-mcp-tools-__codelineno-3-216"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-3-217"><a id="__codelineno-3-217" name="__codelineno-3-217" href="#lab03-mcp-tools-__codelineno-3-217"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-3-218"><a id="__codelineno-3-218" name="__codelineno-3-218" href="#lab03-mcp-tools-__codelineno-3-218"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Hello, </span><span class="si">${</span><span class="nx">userName</span><span class="si">}</span><span class="sb">! Welcome to your first MCP server! üéâ`</span><span class="p">,</span>
</span><span id="__span-3-219"><a id="__codelineno-3-219" name="__codelineno-3-219" href="#lab03-mcp-tools-__codelineno-3-219"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-3-220"><a id="__codelineno-3-220" name="__codelineno-3-220" href="#lab03-mcp-tools-__codelineno-3-220"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-3-221"><a id="__codelineno-3-221" name="__codelineno-3-221" href="#lab03-mcp-tools-__codelineno-3-221"></a><span class="w">          </span><span class="p">};</span>
</span><span id="__span-3-222"><a id="__codelineno-3-222" name="__codelineno-3-222" href="#lab03-mcp-tools-__codelineno-3-222"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-3-223"><a id="__codelineno-3-223" name="__codelineno-3-223" href="#lab03-mcp-tools-__codelineno-3-223"></a>
</span><span id="__span-3-224"><a id="__codelineno-3-224" name="__codelineno-3-224" href="#lab03-mcp-tools-__codelineno-3-224"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-3-225"><a id="__codelineno-3-225" name="__codelineno-3-225" href="#lab03-mcp-tools-__codelineno-3-225"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-3-226"><a id="__codelineno-3-226" name="__codelineno-3-226" href="#lab03-mcp-tools-__codelineno-3-226"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-3-227"><a id="__codelineno-3-227" name="__codelineno-3-227" href="#lab03-mcp-tools-__codelineno-3-227"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-228"><a id="__codelineno-3-228" name="__codelineno-3-228" href="#lab03-mcp-tools-__codelineno-3-228"></a>
</span><span id="__span-3-229"><a id="__codelineno-3-229" name="__codelineno-3-229" href="#lab03-mcp-tools-__codelineno-3-229"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-3-230"><a id="__codelineno-3-230" name="__codelineno-3-230" href="#lab03-mcp-tools-__codelineno-3-230"></a><span class="cm">  * Set up error handling</span>
</span><span id="__span-3-231"><a id="__codelineno-3-231" name="__codelineno-3-231" href="#lab03-mcp-tools-__codelineno-3-231"></a><span class="cm">  */</span>
</span><span id="__span-3-232"><a id="__codelineno-3-232" name="__codelineno-3-232" href="#lab03-mcp-tools-__codelineno-3-232"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-233"><a id="__codelineno-3-233" name="__codelineno-3-233" href="#lab03-mcp-tools-__codelineno-3-233"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-234"><a id="__codelineno-3-234" name="__codelineno-3-234" href="#lab03-mcp-tools-__codelineno-3-234"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-3-235"><a id="__codelineno-3-235" name="__codelineno-3-235" href="#lab03-mcp-tools-__codelineno-3-235"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-3-236"><a id="__codelineno-3-236" name="__codelineno-3-236" href="#lab03-mcp-tools-__codelineno-3-236"></a>
</span><span id="__span-3-237"><a id="__codelineno-3-237" name="__codelineno-3-237" href="#lab03-mcp-tools-__codelineno-3-237"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-238"><a id="__codelineno-3-238" name="__codelineno-3-238" href="#lab03-mcp-tools-__codelineno-3-238"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-3-239"><a id="__codelineno-3-239" name="__codelineno-3-239" href="#lab03-mcp-tools-__codelineno-3-239"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-3-240"><a id="__codelineno-3-240" name="__codelineno-3-240" href="#lab03-mcp-tools-__codelineno-3-240"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-3-241"><a id="__codelineno-3-241" name="__codelineno-3-241" href="#lab03-mcp-tools-__codelineno-3-241"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-242"><a id="__codelineno-3-242" name="__codelineno-3-242" href="#lab03-mcp-tools-__codelineno-3-242"></a>
</span><span id="__span-3-243"><a id="__codelineno-3-243" name="__codelineno-3-243" href="#lab03-mcp-tools-__codelineno-3-243"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-3-244"><a id="__codelineno-3-244" name="__codelineno-3-244" href="#lab03-mcp-tools-__codelineno-3-244"></a><span class="cm">  * Start the server</span>
</span><span id="__span-3-245"><a id="__codelineno-3-245" name="__codelineno-3-245" href="#lab03-mcp-tools-__codelineno-3-245"></a><span class="cm">  */</span>
</span><span id="__span-3-246"><a id="__codelineno-3-246" name="__codelineno-3-246" href="#lab03-mcp-tools-__codelineno-3-246"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-247"><a id="__codelineno-3-247" name="__codelineno-3-247" href="#lab03-mcp-tools-__codelineno-3-247"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-3-248"><a id="__codelineno-3-248" name="__codelineno-3-248" href="#lab03-mcp-tools-__codelineno-3-248"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-3-249"><a id="__codelineno-3-249" name="__codelineno-3-249" href="#lab03-mcp-tools-__codelineno-3-249"></a>
</span><span id="__span-3-250"><a id="__codelineno-3-250" name="__codelineno-3-250" href="#lab03-mcp-tools-__codelineno-3-250"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;My First MCP Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-3-251"><a id="__codelineno-3-251" name="__codelineno-3-251" href="#lab03-mcp-tools-__codelineno-3-251"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-3-252"><a id="__codelineno-3-252" name="__codelineno-3-252" href="#lab03-mcp-tools-__codelineno-3-252"></a><span class="p">}</span>
</span><span id="__span-3-253"><a id="__codelineno-3-253" name="__codelineno-3-253" href="#lab03-mcp-tools-__codelineno-3-253"></a>
</span><span id="__span-3-254"><a id="__codelineno-3-254" name="__codelineno-3-254" href="#lab03-mcp-tools-__codelineno-3-254"></a><span class="cm">/**</span>
</span><span id="__span-3-255"><a id="__codelineno-3-255" name="__codelineno-3-255" href="#lab03-mcp-tools-__codelineno-3-255"></a><span class="cm">* Main entry point</span>
</span><span id="__span-3-256"><a id="__codelineno-3-256" name="__codelineno-3-256" href="#lab03-mcp-tools-__codelineno-3-256"></a><span class="cm">*/</span>
</span><span id="__span-3-257"><a id="__codelineno-3-257" name="__codelineno-3-257" href="#lab03-mcp-tools-__codelineno-3-257"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-258"><a id="__codelineno-3-258" name="__codelineno-3-258" href="#lab03-mcp-tools-__codelineno-3-258"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">MyFirstMCPServer</span><span class="p">();</span>
</span><span id="__span-3-259"><a id="__codelineno-3-259" name="__codelineno-3-259" href="#lab03-mcp-tools-__codelineno-3-259"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-3-260"><a id="__codelineno-3-260" name="__codelineno-3-260" href="#lab03-mcp-tools-__codelineno-3-260"></a><span class="p">}</span>
</span><span id="__span-3-261"><a id="__codelineno-3-261" name="__codelineno-3-261" href="#lab03-mcp-tools-__codelineno-3-261"></a>
</span><span id="__span-3-262"><a id="__codelineno-3-262" name="__codelineno-3-262" href="#lab03-mcp-tools-__codelineno-3-262"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-263"><a id="__codelineno-3-263" name="__codelineno-3-263" href="#lab03-mcp-tools-__codelineno-3-263"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-3-264"><a id="__codelineno-3-264" name="__codelineno-3-264" href="#lab03-mcp-tools-__codelineno-3-264"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-3-265"><a id="__codelineno-3-265" name="__codelineno-3-265" href="#lab03-mcp-tools-__codelineno-3-265"></a><span class="p">});</span>
</span></code></pre></div>
<h4 id="lab03-mcp-tools-testing-the-weather-tool-with-ollama">Testing the Weather Tool with Ollama:<a class="headerlink" href="#lab03-mcp-tools-testing-the-weather-tool-with-ollama" title="Permanent link">&para;</a></h4>
<p><strong>Step 1: Install Ollama</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab03-mcp-tools-__codelineno-4-1"></a><span class="c1"># On macOS (using Homebrew)</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#lab03-mcp-tools-__codelineno-4-2"></a>brew<span class="w"> </span>install<span class="w"> </span>ollama
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#lab03-mcp-tools-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#lab03-mcp-tools-__codelineno-4-4"></a><span class="c1"># Or download from the official website: https://ollama.ai/download</span>
</span></code></pre></div>
<p><strong>Step 2: Download a Model</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab03-mcp-tools-__codelineno-5-1"></a><span class="c1"># Pull the recommended model for this lab</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab03-mcp-tools-__codelineno-5-2"></a>ollama<span class="w"> </span>pull<span class="w"> </span>gpt-oss:20b
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#lab03-mcp-tools-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#lab03-mcp-tools-__codelineno-5-4"></a><span class="c1"># List available models to verify the download completed successfully</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#lab03-mcp-tools-__codelineno-5-5"></a>ollama<span class="w"> </span>list
</span></code></pre></div>
<p><strong>Step 3: Start Ollama Server</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab03-mcp-tools-__codelineno-6-1"></a><span class="c1"># Start the Ollama server (keep this running in a terminal)</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab03-mcp-tools-__codelineno-6-2"></a>ollama<span class="w"> </span>serve
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#lab03-mcp-tools-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#lab03-mcp-tools-__codelineno-6-4"></a><span class="c1"># Check which models are currently running locally:</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#lab03-mcp-tools-__codelineno-6-5"></a>curl<span class="w"> </span>http://localhost:11434/api/tags<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span>.
</span></code></pre></div>
<p>The server will run on <a href="http://localhost:11434">http://localhost:11434</a> by default.</p>
<p><strong>Step 4: Test the Weather Tool</strong></p>
<ol>
<li>
<p><strong>Start the MCP Inspector</strong> (in a new terminal):
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab03-mcp-tools-__codelineno-7-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div></p>
</li>
<li>
<p><strong>In the MCP Inspector interface</strong>:</p>
<ul>
<li>You should see both <code>get_weather</code> and <code>hello_world</code> tools listed</li>
<li>Click on <code>get_weather</code> tool</li>
<li>Enter a city name like &ldquo;London&rdquo;, &ldquo;New York&rdquo;, &ldquo;Tokyo&rdquo;, &ldquo;Paris&rdquo;, or &ldquo;Sydney&rdquo;</li>
<li>Optionally set units to &ldquo;fahrenheit&rdquo; for Fahrenheit temperatures</li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Test different scenarios</strong>:</p>
<ul>
<li>Valid cities: &ldquo;London&rdquo;, &ldquo;New York&rdquo;, &ldquo;Tokyo&rdquo;, &ldquo;Paris&rdquo;, &ldquo;Sydney&rdquo;</li>
<li>Invalid cities: &ldquo;InvalidCity123&rdquo; (will use fallback data)</li>
<li>Different units: Try both &ldquo;celsius&rdquo; and &ldquo;fahrenheit&rdquo;</li>
<li>Empty city: Try with empty string (should show validation error)</li>
</ul>
</li>
<li>
<p><strong>Test error cases</strong>:</p>
<ul>
<li>Stop Ollama server and try calling the tool (should show API error)</li>
<li>Try with invalid model name in the code (should show error)</li>
</ul>
</li>
</ol>
<p><strong>Step 5: Verify Everything Works</strong></p>
<ul>
<li>
<p>You should see AI-generated weather information formatted like this:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab03-mcp-tools-__codelineno-8-1"></a>Weather in London, GB:
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#lab03-mcp-tools-__codelineno-8-2"></a>- Temperature: 15.2¬∞C
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#lab03-mcp-tools-__codelineno-8-3"></a>- Feels like: 14.8¬∞C
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#lab03-mcp-tools-__codelineno-8-4"></a>- Conditions: light rain
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#lab03-mcp-tools-__codelineno-8-5"></a>- Humidity: 82%
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#lab03-mcp-tools-__codelineno-8-6"></a>- Wind Speed: 3.6 m/s
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#lab03-mcp-tools-__codelineno-8-7"></a>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#lab03-mcp-tools-__codelineno-8-8"></a>*Generated by Ollama AI*
</span></code></pre></div>
</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li>If you get &ldquo;Ollama API error&rdquo;, make sure <code>ollama serve</code> is running</li>
<li>If you see fallback data, Ollama might not be responding properly</li>
<li>Check that the model is downloaded with <code>ollama list</code></li>
<li>Try a different model if gpt-oss:20b doesn&rsquo;t work well</li>
<li>Make sure you&rsquo;re in the correct directory when running commands</li>
</ul>
<h4 id="lab03-mcp-tools-key-learning-points">Key Learning Points:<a class="headerlink" href="#lab03-mcp-tools-key-learning-points" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Local AI integration</strong> using Ollama for generating content</li>
<li><strong>Fallback handling</strong> when AI services are unavailable</li>
<li><strong>JSON parsing</strong> from AI-generated responses</li>
<li><strong>Error handling</strong> for external service dependencies</li>
<li><strong>Input validation</strong> and data formatting</li>
<li><strong>API communication</strong> with local services</li>
</ul>
<hr />
<h3 id="lab03-mcp-tools-tool-2-file-operations">Tool 2: File Operations<a class="headerlink" href="#lab03-mcp-tools-tool-2-file-operations" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Create a secure file reading tool that can handle various file types, validate paths, and return formatted content with metadata.</p>
<h4 id="lab03-mcp-tools-complete-file-operations-tool-implementation">Complete File Operations Tool Implementation<a class="headerlink" href="#lab03-mcp-tools-complete-file-operations-tool-implementation" title="Permanent link">&para;</a></h4>
<p><strong>Important</strong>: Do NOT copy the entire code block below. Instead, add the <code>read_file</code> tool to your existing <code>src/index.ts</code> file by following these specific steps:</p>
<ol>
<li>
<p><strong>Add the import</strong> at the top of your file (after existing imports):
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab03-mcp-tools-__codelineno-9-1"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#lab03-mcp-tools-__codelineno-9-2"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Add the <code>read_file</code> tool to your tools array</strong> in the <code>ListToolsRequestSchema</code> handler:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab03-mcp-tools-__codelineno-10-1"></a><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#lab03-mcp-tools-__codelineno-10-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">,</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#lab03-mcp-tools-__codelineno-10-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Read contents of a text file with security validation&quot;</span><span class="p">,</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#lab03-mcp-tools-__codelineno-10-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#lab03-mcp-tools-__codelineno-10-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#lab03-mcp-tools-__codelineno-10-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#lab03-mcp-tools-__codelineno-10-7"></a><span class="w">      </span><span class="nx">filepath</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#lab03-mcp-tools-__codelineno-10-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#lab03-mcp-tools-__codelineno-10-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Absolute path to the file&quot;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#lab03-mcp-tools-__codelineno-10-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#lab03-mcp-tools-__codelineno-10-11"></a><span class="w">      </span><span class="nx">encoding</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#lab03-mcp-tools-__codelineno-10-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#lab03-mcp-tools-__codelineno-10-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;File encoding&quot;</span><span class="p">,</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#lab03-mcp-tools-__codelineno-10-14"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;base64&quot;</span><span class="p">],</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#lab03-mcp-tools-__codelineno-10-15"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;utf8&quot;</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#lab03-mcp-tools-__codelineno-10-16"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#lab03-mcp-tools-__codelineno-10-17"></a><span class="w">      </span><span class="nx">maxSize</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#lab03-mcp-tools-__codelineno-10-18"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#lab03-mcp-tools-__codelineno-10-19"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum file size in bytes&quot;</span><span class="p">,</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#lab03-mcp-tools-__codelineno-10-20"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#lab03-mcp-tools-__codelineno-10-21"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">10485760</span><span class="p">,</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#lab03-mcp-tools-__codelineno-10-22"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1048576</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#lab03-mcp-tools-__codelineno-10-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#lab03-mcp-tools-__codelineno-10-24"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#lab03-mcp-tools-__codelineno-10-25"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#lab03-mcp-tools-__codelineno-10-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#lab03-mcp-tools-__codelineno-10-27"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Add the <code>read_file</code> handler</strong> in the <code>CallToolRequestSchema</code> handler (before the final <code>throw new Error</code>):
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab03-mcp-tools-__codelineno-11-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab03-mcp-tools-__codelineno-11-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#lab03-mcp-tools-__codelineno-11-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">filepath</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#lab03-mcp-tools-__codelineno-11-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">encoding</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">BufferEncoding</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;utf8&quot;</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#lab03-mcp-tools-__codelineno-11-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">1048576</span><span class="p">;</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#lab03-mcp-tools-__codelineno-11-6"></a>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#lab03-mcp-tools-__codelineno-11-7"></a><span class="w">    </span><span class="c1">// Security: Validate input</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#lab03-mcp-tools-__codelineno-11-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">filepath</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#lab03-mcp-tools-__codelineno-11-9"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;filepath must be a non-empty string&quot;</span><span class="p">);</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#lab03-mcp-tools-__codelineno-11-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#lab03-mcp-tools-__codelineno-11-11"></a>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#lab03-mcp-tools-__codelineno-11-12"></a><span class="w">    </span><span class="c1">// Security: Resolve and validate path</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#lab03-mcp-tools-__codelineno-11-13"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#lab03-mcp-tools-__codelineno-11-14"></a>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#lab03-mcp-tools-__codelineno-11-15"></a><span class="w">    </span><span class="c1">// Prevent directory traversal attacks</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#lab03-mcp-tools-__codelineno-11-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#lab03-mcp-tools-__codelineno-11-17"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Access denied: file path outside allowed directory&quot;</span><span class="p">);</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#lab03-mcp-tools-__codelineno-11-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#lab03-mcp-tools-__codelineno-11-19"></a>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#lab03-mcp-tools-__codelineno-11-20"></a><span class="w">    </span><span class="c1">// Check if file exists and is readable</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#lab03-mcp-tools-__codelineno-11-21"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#lab03-mcp-tools-__codelineno-11-22"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#lab03-mcp-tools-__codelineno-11-23"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#lab03-mcp-tools-__codelineno-11-24"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File not found or not readable: </span><span class="si">${</span><span class="nx">filepath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#lab03-mcp-tools-__codelineno-11-25"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#lab03-mcp-tools-__codelineno-11-26"></a>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#lab03-mcp-tools-__codelineno-11-27"></a><span class="w">    </span><span class="c1">// Get file stats</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#lab03-mcp-tools-__codelineno-11-28"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">);</span>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#lab03-mcp-tools-__codelineno-11-29"></a>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#lab03-mcp-tools-__codelineno-11-30"></a><span class="w">    </span><span class="c1">// Check if it&#39;s actually a file (not a directory)</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#lab03-mcp-tools-__codelineno-11-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">stats</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#lab03-mcp-tools-__codelineno-11-32"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Path is not a file: </span><span class="si">${</span><span class="nx">filepath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#lab03-mcp-tools-__codelineno-11-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#lab03-mcp-tools-__codelineno-11-34"></a>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#lab03-mcp-tools-__codelineno-11-35"></a><span class="w">    </span><span class="c1">// Check file size</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#lab03-mcp-tools-__codelineno-11-36"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#lab03-mcp-tools-__codelineno-11-37"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#lab03-mcp-tools-__codelineno-11-38"></a><span class="w">        </span><span class="sb">`File too large: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> bytes (max: </span><span class="si">${</span><span class="nx">maxSize</span><span class="si">}</span><span class="sb">)`</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#lab03-mcp-tools-__codelineno-11-39"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#lab03-mcp-tools-__codelineno-11-40"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#lab03-mcp-tools-__codelineno-11-41"></a>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#lab03-mcp-tools-__codelineno-11-42"></a><span class="w">    </span><span class="c1">// Read file content</span>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#lab03-mcp-tools-__codelineno-11-43"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">,</span><span class="w"> </span><span class="nx">encoding</span><span class="p">);</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#lab03-mcp-tools-__codelineno-11-44"></a>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#lab03-mcp-tools-__codelineno-11-45"></a><span class="w">    </span><span class="c1">// Format response with metadata</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#lab03-mcp-tools-__codelineno-11-46"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#lab03-mcp-tools-__codelineno-11-47"></a><span class="w">      </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">resolvedPath</span><span class="p">,</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#lab03-mcp-tools-__codelineno-11-48"></a><span class="w">      </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">stats.size</span><span class="p">,</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#lab03-mcp-tools-__codelineno-11-49"></a><span class="w">      </span><span class="nx">modified</span><span class="o">:</span><span class="w"> </span><span class="kt">stats.mtime.toISOString</span><span class="p">(),</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#lab03-mcp-tools-__codelineno-11-50"></a><span class="w">      </span><span class="nx">encoding</span><span class="o">:</span><span class="w"> </span><span class="kt">encoding</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#lab03-mcp-tools-__codelineno-11-51"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#lab03-mcp-tools-__codelineno-11-52"></a>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#lab03-mcp-tools-__codelineno-11-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#lab03-mcp-tools-__codelineno-11-54"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#lab03-mcp-tools-__codelineno-11-55"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#lab03-mcp-tools-__codelineno-11-56"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#lab03-mcp-tools-__codelineno-11-57"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`File Information:\n</span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">fileInfo</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">\n\nContent:\n</span><span class="si">${</span><span class="nx">content</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#lab03-mcp-tools-__codelineno-11-58"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#lab03-mcp-tools-__codelineno-11-59"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#lab03-mcp-tools-__codelineno-11-60"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#lab03-mcp-tools-__codelineno-11-61"></a>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#lab03-mcp-tools-__codelineno-11-62"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#lab03-mcp-tools-__codelineno-11-63"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#lab03-mcp-tools-__codelineno-11-64"></a><span class="w">      </span><span class="sb">`Failed to read file: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#lab03-mcp-tools-__codelineno-11-65"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#lab03-mcp-tools-__codelineno-11-66"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#lab03-mcp-tools-__codelineno-11-67"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<p><strong>The code block below is for reference only</strong> - it shows what your complete file should look like after adding the tool. Do not copy-paste the entire block:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab03-mcp-tools-__codelineno-12-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#lab03-mcp-tools-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#lab03-mcp-tools-__codelineno-12-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#lab03-mcp-tools-__codelineno-12-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#lab03-mcp-tools-__codelineno-12-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#lab03-mcp-tools-__codelineno-12-6"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#lab03-mcp-tools-__codelineno-12-7"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#lab03-mcp-tools-__codelineno-12-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#lab03-mcp-tools-__codelineno-12-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#lab03-mcp-tools-__codelineno-12-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#lab03-mcp-tools-__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#lab03-mcp-tools-__codelineno-12-12"></a><span class="cm">/**</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#lab03-mcp-tools-__codelineno-12-13"></a><span class="cm">* Create an MCP server with core capabilities</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#lab03-mcp-tools-__codelineno-12-14"></a><span class="cm">*/</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#lab03-mcp-tools-__codelineno-12-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">MyFirstMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#lab03-mcp-tools-__codelineno-12-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#lab03-mcp-tools-__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#lab03-mcp-tools-__codelineno-12-18"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#lab03-mcp-tools-__codelineno-12-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#lab03-mcp-tools-__codelineno-12-20"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#lab03-mcp-tools-__codelineno-12-21"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;my-first-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#lab03-mcp-tools-__codelineno-12-22"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#lab03-mcp-tools-__codelineno-12-23"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#lab03-mcp-tools-__codelineno-12-24"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#lab03-mcp-tools-__codelineno-12-25"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#lab03-mcp-tools-__codelineno-12-26"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#lab03-mcp-tools-__codelineno-12-27"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#lab03-mcp-tools-__codelineno-12-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#lab03-mcp-tools-__codelineno-12-29"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#lab03-mcp-tools-__codelineno-12-30"></a>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#lab03-mcp-tools-__codelineno-12-31"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#lab03-mcp-tools-__codelineno-12-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#lab03-mcp-tools-__codelineno-12-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#lab03-mcp-tools-__codelineno-12-34"></a>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#lab03-mcp-tools-__codelineno-12-35"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#lab03-mcp-tools-__codelineno-12-36"></a><span class="cm">  * Set up request handlers</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#lab03-mcp-tools-__codelineno-12-37"></a><span class="cm">  */</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#lab03-mcp-tools-__codelineno-12-38"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#lab03-mcp-tools-__codelineno-12-39"></a><span class="w">    </span><span class="c1">// Handler for listing available tools</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#lab03-mcp-tools-__codelineno-12-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#lab03-mcp-tools-__codelineno-12-41"></a><span class="w">      </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#lab03-mcp-tools-__codelineno-12-42"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#lab03-mcp-tools-__codelineno-12-43"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#lab03-mcp-tools-__codelineno-12-44"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#lab03-mcp-tools-__codelineno-12-45"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;get_weather&quot;</span><span class="p">,</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#lab03-mcp-tools-__codelineno-12-46"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Get current weather information for a city using AI&quot;</span><span class="p">,</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#lab03-mcp-tools-__codelineno-12-47"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#lab03-mcp-tools-__codelineno-12-48"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#lab03-mcp-tools-__codelineno-12-49"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#lab03-mcp-tools-__codelineno-12-50"></a><span class="w">                </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#lab03-mcp-tools-__codelineno-12-51"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#lab03-mcp-tools-__codelineno-12-52"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;City name (e.g., &#39;London&#39;, &#39;New York&#39;)&quot;</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#lab03-mcp-tools-__codelineno-12-53"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#lab03-mcp-tools-__codelineno-12-54"></a><span class="w">                </span><span class="nx">units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#lab03-mcp-tools-__codelineno-12-55"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#lab03-mcp-tools-__codelineno-12-56"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Temperature units&quot;</span><span class="p">,</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#lab03-mcp-tools-__codelineno-12-57"></a><span class="w">                  </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;celsius&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">],</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#lab03-mcp-tools-__codelineno-12-58"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;celsius&quot;</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#lab03-mcp-tools-__codelineno-12-59"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#lab03-mcp-tools-__codelineno-12-60"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#lab03-mcp-tools-__codelineno-12-61"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;city&quot;</span><span class="p">]</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#lab03-mcp-tools-__codelineno-12-62"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#lab03-mcp-tools-__codelineno-12-63"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#lab03-mcp-tools-__codelineno-12-64"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#lab03-mcp-tools-__codelineno-12-65"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">,</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#lab03-mcp-tools-__codelineno-12-66"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Read contents of a text file with security validation&quot;</span><span class="p">,</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#lab03-mcp-tools-__codelineno-12-67"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#lab03-mcp-tools-__codelineno-12-68"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#lab03-mcp-tools-__codelineno-12-69"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#lab03-mcp-tools-__codelineno-12-70"></a><span class="w">                </span><span class="nx">filepath</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#lab03-mcp-tools-__codelineno-12-71"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#lab03-mcp-tools-__codelineno-12-72"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Absolute path to the file&quot;</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#lab03-mcp-tools-__codelineno-12-73"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#lab03-mcp-tools-__codelineno-12-74"></a><span class="w">                </span><span class="nx">encoding</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#lab03-mcp-tools-__codelineno-12-75"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#lab03-mcp-tools-__codelineno-12-76"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;File encoding&quot;</span><span class="p">,</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#lab03-mcp-tools-__codelineno-12-77"></a><span class="w">                  </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;utf8&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;ascii&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;base64&quot;</span><span class="p">],</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#lab03-mcp-tools-__codelineno-12-78"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;utf8&quot;</span>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#lab03-mcp-tools-__codelineno-12-79"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#lab03-mcp-tools-__codelineno-12-80"></a><span class="w">                </span><span class="nx">maxSize</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#lab03-mcp-tools-__codelineno-12-81"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#lab03-mcp-tools-__codelineno-12-82"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum file size in bytes&quot;</span><span class="p">,</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#lab03-mcp-tools-__codelineno-12-83"></a><span class="w">                  </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#lab03-mcp-tools-__codelineno-12-84"></a><span class="w">                  </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">10485760</span><span class="p">,</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#lab03-mcp-tools-__codelineno-12-85"></a><span class="w">                  </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1048576</span>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#lab03-mcp-tools-__codelineno-12-86"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#lab03-mcp-tools-__codelineno-12-87"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#lab03-mcp-tools-__codelineno-12-88"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#lab03-mcp-tools-__codelineno-12-89"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#lab03-mcp-tools-__codelineno-12-90"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#lab03-mcp-tools-__codelineno-12-91"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#lab03-mcp-tools-__codelineno-12-92"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">,</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#lab03-mcp-tools-__codelineno-12-93"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Returns a friendly greeting message&quot;</span><span class="p">,</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#lab03-mcp-tools-__codelineno-12-94"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#lab03-mcp-tools-__codelineno-12-95"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#lab03-mcp-tools-__codelineno-12-96"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#lab03-mcp-tools-__codelineno-12-97"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#lab03-mcp-tools-__codelineno-12-98"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#lab03-mcp-tools-__codelineno-12-99"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The name to greet&quot;</span><span class="p">,</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#lab03-mcp-tools-__codelineno-12-100"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#lab03-mcp-tools-__codelineno-12-101"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#lab03-mcp-tools-__codelineno-12-102"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#lab03-mcp-tools-__codelineno-12-103"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#lab03-mcp-tools-__codelineno-12-104"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#lab03-mcp-tools-__codelineno-12-105"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#lab03-mcp-tools-__codelineno-12-106"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#lab03-mcp-tools-__codelineno-12-107"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#lab03-mcp-tools-__codelineno-12-108"></a>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#lab03-mcp-tools-__codelineno-12-109"></a><span class="w">    </span><span class="c1">// Handler for calling tools</span>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#lab03-mcp-tools-__codelineno-12-110"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#lab03-mcp-tools-__codelineno-12-111"></a><span class="w">      </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#lab03-mcp-tools-__codelineno-12-112"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#lab03-mcp-tools-__codelineno-12-113"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#lab03-mcp-tools-__codelineno-12-114"></a>
</span><span id="__span-12-115"><a id="__codelineno-12-115" name="__codelineno-12-115" href="#lab03-mcp-tools-__codelineno-12-115"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;get_weather&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-116"><a id="__codelineno-12-116" name="__codelineno-12-116" href="#lab03-mcp-tools-__codelineno-12-116"></a><span class="w">          </span><span class="c1">// ... existing weather tool code ...</span>
</span><span id="__span-12-117"><a id="__codelineno-12-117" name="__codelineno-12-117" href="#lab03-mcp-tools-__codelineno-12-117"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-118"><a id="__codelineno-12-118" name="__codelineno-12-118" href="#lab03-mcp-tools-__codelineno-12-118"></a>
</span><span id="__span-12-119"><a id="__codelineno-12-119" name="__codelineno-12-119" href="#lab03-mcp-tools-__codelineno-12-119"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-120"><a id="__codelineno-12-120" name="__codelineno-12-120" href="#lab03-mcp-tools-__codelineno-12-120"></a><span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-121"><a id="__codelineno-12-121" name="__codelineno-12-121" href="#lab03-mcp-tools-__codelineno-12-121"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">filepath</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-12-122"><a id="__codelineno-12-122" name="__codelineno-12-122" href="#lab03-mcp-tools-__codelineno-12-122"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">encoding</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">BufferEncoding</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;utf8&quot;</span><span class="p">;</span>
</span><span id="__span-12-123"><a id="__codelineno-12-123" name="__codelineno-12-123" href="#lab03-mcp-tools-__codelineno-12-123"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">1048576</span><span class="p">;</span>
</span><span id="__span-12-124"><a id="__codelineno-12-124" name="__codelineno-12-124" href="#lab03-mcp-tools-__codelineno-12-124"></a>
</span><span id="__span-12-125"><a id="__codelineno-12-125" name="__codelineno-12-125" href="#lab03-mcp-tools-__codelineno-12-125"></a><span class="w">            </span><span class="c1">// Security: Validate input</span>
</span><span id="__span-12-126"><a id="__codelineno-12-126" name="__codelineno-12-126" href="#lab03-mcp-tools-__codelineno-12-126"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">filepath</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">filepath</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-127"><a id="__codelineno-12-127" name="__codelineno-12-127" href="#lab03-mcp-tools-__codelineno-12-127"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;filepath must be a non-empty string&quot;</span><span class="p">);</span>
</span><span id="__span-12-128"><a id="__codelineno-12-128" name="__codelineno-12-128" href="#lab03-mcp-tools-__codelineno-12-128"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-129"><a id="__codelineno-12-129" name="__codelineno-12-129" href="#lab03-mcp-tools-__codelineno-12-129"></a>
</span><span id="__span-12-130"><a id="__codelineno-12-130" name="__codelineno-12-130" href="#lab03-mcp-tools-__codelineno-12-130"></a><span class="w">            </span><span class="c1">// Security: Resolve and validate path</span>
</span><span id="__span-12-131"><a id="__codelineno-12-131" name="__codelineno-12-131" href="#lab03-mcp-tools-__codelineno-12-131"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span>
</span><span id="__span-12-132"><a id="__codelineno-12-132" name="__codelineno-12-132" href="#lab03-mcp-tools-__codelineno-12-132"></a>
</span><span id="__span-12-133"><a id="__codelineno-12-133" name="__codelineno-12-133" href="#lab03-mcp-tools-__codelineno-12-133"></a><span class="w">            </span><span class="c1">// Prevent directory traversal attacks</span>
</span><span id="__span-12-134"><a id="__codelineno-12-134" name="__codelineno-12-134" href="#lab03-mcp-tools-__codelineno-12-134"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-135"><a id="__codelineno-12-135" name="__codelineno-12-135" href="#lab03-mcp-tools-__codelineno-12-135"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Access denied: file path outside allowed directory&quot;</span><span class="p">);</span>
</span><span id="__span-12-136"><a id="__codelineno-12-136" name="__codelineno-12-136" href="#lab03-mcp-tools-__codelineno-12-136"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-137"><a id="__codelineno-12-137" name="__codelineno-12-137" href="#lab03-mcp-tools-__codelineno-12-137"></a>
</span><span id="__span-12-138"><a id="__codelineno-12-138" name="__codelineno-12-138" href="#lab03-mcp-tools-__codelineno-12-138"></a><span class="w">            </span><span class="c1">// Check if file exists and is readable</span>
</span><span id="__span-12-139"><a id="__codelineno-12-139" name="__codelineno-12-139" href="#lab03-mcp-tools-__codelineno-12-139"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-140"><a id="__codelineno-12-140" name="__codelineno-12-140" href="#lab03-mcp-tools-__codelineno-12-140"></a><span class="w">              </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-12-141"><a id="__codelineno-12-141" name="__codelineno-12-141" href="#lab03-mcp-tools-__codelineno-12-141"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-142"><a id="__codelineno-12-142" name="__codelineno-12-142" href="#lab03-mcp-tools-__codelineno-12-142"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File not found or not readable: </span><span class="si">${</span><span class="nx">filepath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-12-143"><a id="__codelineno-12-143" name="__codelineno-12-143" href="#lab03-mcp-tools-__codelineno-12-143"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-144"><a id="__codelineno-12-144" name="__codelineno-12-144" href="#lab03-mcp-tools-__codelineno-12-144"></a>
</span><span id="__span-12-145"><a id="__codelineno-12-145" name="__codelineno-12-145" href="#lab03-mcp-tools-__codelineno-12-145"></a><span class="w">            </span><span class="c1">// Get file stats</span>
</span><span id="__span-12-146"><a id="__codelineno-12-146" name="__codelineno-12-146" href="#lab03-mcp-tools-__codelineno-12-146"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">);</span>
</span><span id="__span-12-147"><a id="__codelineno-12-147" name="__codelineno-12-147" href="#lab03-mcp-tools-__codelineno-12-147"></a>
</span><span id="__span-12-148"><a id="__codelineno-12-148" name="__codelineno-12-148" href="#lab03-mcp-tools-__codelineno-12-148"></a><span class="w">            </span><span class="c1">// Check if it&#39;s actually a file (not a directory)</span>
</span><span id="__span-12-149"><a id="__codelineno-12-149" name="__codelineno-12-149" href="#lab03-mcp-tools-__codelineno-12-149"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">stats</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-150"><a id="__codelineno-12-150" name="__codelineno-12-150" href="#lab03-mcp-tools-__codelineno-12-150"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Path is not a file: </span><span class="si">${</span><span class="nx">filepath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-12-151"><a id="__codelineno-12-151" name="__codelineno-12-151" href="#lab03-mcp-tools-__codelineno-12-151"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-152"><a id="__codelineno-12-152" name="__codelineno-12-152" href="#lab03-mcp-tools-__codelineno-12-152"></a>
</span><span id="__span-12-153"><a id="__codelineno-12-153" name="__codelineno-12-153" href="#lab03-mcp-tools-__codelineno-12-153"></a><span class="w">            </span><span class="c1">// Check file size</span>
</span><span id="__span-12-154"><a id="__codelineno-12-154" name="__codelineno-12-154" href="#lab03-mcp-tools-__codelineno-12-154"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-155"><a id="__codelineno-12-155" name="__codelineno-12-155" href="#lab03-mcp-tools-__codelineno-12-155"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-12-156"><a id="__codelineno-12-156" name="__codelineno-12-156" href="#lab03-mcp-tools-__codelineno-12-156"></a><span class="w">                </span><span class="sb">`File too large: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> bytes (max: </span><span class="si">${</span><span class="nx">maxSize</span><span class="si">}</span><span class="sb">)`</span>
</span><span id="__span-12-157"><a id="__codelineno-12-157" name="__codelineno-12-157" href="#lab03-mcp-tools-__codelineno-12-157"></a><span class="w">              </span><span class="p">);</span>
</span><span id="__span-12-158"><a id="__codelineno-12-158" name="__codelineno-12-158" href="#lab03-mcp-tools-__codelineno-12-158"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-159"><a id="__codelineno-12-159" name="__codelineno-12-159" href="#lab03-mcp-tools-__codelineno-12-159"></a>
</span><span id="__span-12-160"><a id="__codelineno-12-160" name="__codelineno-12-160" href="#lab03-mcp-tools-__codelineno-12-160"></a><span class="w">            </span><span class="c1">// Read file content</span>
</span><span id="__span-12-161"><a id="__codelineno-12-161" name="__codelineno-12-161" href="#lab03-mcp-tools-__codelineno-12-161"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">resolvedPath</span><span class="p">,</span><span class="w"> </span><span class="nx">encoding</span><span class="p">);</span>
</span><span id="__span-12-162"><a id="__codelineno-12-162" name="__codelineno-12-162" href="#lab03-mcp-tools-__codelineno-12-162"></a>
</span><span id="__span-12-163"><a id="__codelineno-12-163" name="__codelineno-12-163" href="#lab03-mcp-tools-__codelineno-12-163"></a><span class="w">            </span><span class="c1">// Format response with metadata</span>
</span><span id="__span-12-164"><a id="__codelineno-12-164" name="__codelineno-12-164" href="#lab03-mcp-tools-__codelineno-12-164"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">fileInfo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-165"><a id="__codelineno-12-165" name="__codelineno-12-165" href="#lab03-mcp-tools-__codelineno-12-165"></a><span class="w">              </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">resolvedPath</span><span class="p">,</span>
</span><span id="__span-12-166"><a id="__codelineno-12-166" name="__codelineno-12-166" href="#lab03-mcp-tools-__codelineno-12-166"></a><span class="w">              </span><span class="nx">size</span><span class="o">:</span><span class="w"> </span><span class="kt">stats.size</span><span class="p">,</span>
</span><span id="__span-12-167"><a id="__codelineno-12-167" name="__codelineno-12-167" href="#lab03-mcp-tools-__codelineno-12-167"></a><span class="w">              </span><span class="nx">modified</span><span class="o">:</span><span class="w"> </span><span class="kt">stats.mtime.toISOString</span><span class="p">(),</span>
</span><span id="__span-12-168"><a id="__codelineno-12-168" name="__codelineno-12-168" href="#lab03-mcp-tools-__codelineno-12-168"></a><span class="w">              </span><span class="nx">encoding</span><span class="o">:</span><span class="w"> </span><span class="kt">encoding</span>
</span><span id="__span-12-169"><a id="__codelineno-12-169" name="__codelineno-12-169" href="#lab03-mcp-tools-__codelineno-12-169"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-170"><a id="__codelineno-12-170" name="__codelineno-12-170" href="#lab03-mcp-tools-__codelineno-12-170"></a>
</span><span id="__span-12-171"><a id="__codelineno-12-171" name="__codelineno-12-171" href="#lab03-mcp-tools-__codelineno-12-171"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-172"><a id="__codelineno-12-172" name="__codelineno-12-172" href="#lab03-mcp-tools-__codelineno-12-172"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-173"><a id="__codelineno-12-173" name="__codelineno-12-173" href="#lab03-mcp-tools-__codelineno-12-173"></a><span class="w">                </span><span class="p">{</span>
</span><span id="__span-12-174"><a id="__codelineno-12-174" name="__codelineno-12-174" href="#lab03-mcp-tools-__codelineno-12-174"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-12-175"><a id="__codelineno-12-175" name="__codelineno-12-175" href="#lab03-mcp-tools-__codelineno-12-175"></a><span class="w">                  </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`File Information:\n</span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">fileInfo</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">\n\nContent:\n</span><span class="si">${</span><span class="nx">content</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-12-176"><a id="__codelineno-12-176" name="__codelineno-12-176" href="#lab03-mcp-tools-__codelineno-12-176"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-177"><a id="__codelineno-12-177" name="__codelineno-12-177" href="#lab03-mcp-tools-__codelineno-12-177"></a><span class="w">              </span><span class="p">]</span>
</span><span id="__span-12-178"><a id="__codelineno-12-178" name="__codelineno-12-178" href="#lab03-mcp-tools-__codelineno-12-178"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-179"><a id="__codelineno-12-179" name="__codelineno-12-179" href="#lab03-mcp-tools-__codelineno-12-179"></a>
</span><span id="__span-12-180"><a id="__codelineno-12-180" name="__codelineno-12-180" href="#lab03-mcp-tools-__codelineno-12-180"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-181"><a id="__codelineno-12-181" name="__codelineno-12-181" href="#lab03-mcp-tools-__codelineno-12-181"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-12-182"><a id="__codelineno-12-182" name="__codelineno-12-182" href="#lab03-mcp-tools-__codelineno-12-182"></a><span class="w">              </span><span class="sb">`Failed to read file: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-12-183"><a id="__codelineno-12-183" name="__codelineno-12-183" href="#lab03-mcp-tools-__codelineno-12-183"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-12-184"><a id="__codelineno-12-184" name="__codelineno-12-184" href="#lab03-mcp-tools-__codelineno-12-184"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-185"><a id="__codelineno-12-185" name="__codelineno-12-185" href="#lab03-mcp-tools-__codelineno-12-185"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-186"><a id="__codelineno-12-186" name="__codelineno-12-186" href="#lab03-mcp-tools-__codelineno-12-186"></a>
</span><span id="__span-12-187"><a id="__codelineno-12-187" name="__codelineno-12-187" href="#lab03-mcp-tools-__codelineno-12-187"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;hello_world&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-188"><a id="__codelineno-12-188" name="__codelineno-12-188" href="#lab03-mcp-tools-__codelineno-12-188"></a><span class="w">          </span><span class="c1">// ... existing hello world code ...</span>
</span><span id="__span-12-189"><a id="__codelineno-12-189" name="__codelineno-12-189" href="#lab03-mcp-tools-__codelineno-12-189"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-12-190"><a id="__codelineno-12-190" name="__codelineno-12-190" href="#lab03-mcp-tools-__codelineno-12-190"></a>
</span><span id="__span-12-191"><a id="__codelineno-12-191" name="__codelineno-12-191" href="#lab03-mcp-tools-__codelineno-12-191"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-12-192"><a id="__codelineno-12-192" name="__codelineno-12-192" href="#lab03-mcp-tools-__codelineno-12-192"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-193"><a id="__codelineno-12-193" name="__codelineno-12-193" href="#lab03-mcp-tools-__codelineno-12-193"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-12-194"><a id="__codelineno-12-194" name="__codelineno-12-194" href="#lab03-mcp-tools-__codelineno-12-194"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-195"><a id="__codelineno-12-195" name="__codelineno-12-195" href="#lab03-mcp-tools-__codelineno-12-195"></a>
</span><span id="__span-12-196"><a id="__codelineno-12-196" name="__codelineno-12-196" href="#lab03-mcp-tools-__codelineno-12-196"></a><span class="w">  </span><span class="c1">// ... rest of the class remains the same ...</span>
</span><span id="__span-12-197"><a id="__codelineno-12-197" name="__codelineno-12-197" href="#lab03-mcp-tools-__codelineno-12-197"></a><span class="p">}</span>
</span></code></pre></div>
<h4 id="lab03-mcp-tools-testing-the-file-operations-tool">Testing the File Operations Tool<a class="headerlink" href="#lab03-mcp-tools-testing-the-file-operations-tool" title="Permanent link">&para;</a></h4>
<p><strong>Step 1: Create Test Files</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab03-mcp-tools-__codelineno-13-1"></a><span class="c1"># Create a test directory and files</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#lab03-mcp-tools-__codelineno-13-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>test-files
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#lab03-mcp-tools-__codelineno-13-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Hello, this is a test file!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>test-files/hello.txt
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#lab03-mcp-tools-__codelineno-13-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;test&quot;, &quot;value&quot;: 123}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>test-files/data.json
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#lab03-mcp-tools-__codelineno-13-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Line 1\nLine 2\nLine 3&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>test-files/lines.txt
</span></code></pre></div>
<p><strong>Step 2: Start the MCP Inspector</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab03-mcp-tools-__codelineno-14-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Step 3: Test File Reading</strong></p>
<ol>
<li>
<p><strong>Test with a simple text file</strong>:</p>
<ul>
<li>Tool: <code>read_file</code></li>
<li>filepath: <code>/absolute/path/to/test-files/hello.txt</code> (use the full absolute path)</li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Test with JSON file</strong>:</p>
<ul>
<li>Tool: <code>read_file</code></li>
<li>filepath: <code>/absolute/path/to/test-files/data.json</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Test with different encoding</strong>:</p>
<ul>
<li>Tool: <code>read_file</code></li>
<li>filepath: <code>/absolute/path/to/test-files/hello.txt</code></li>
<li>encoding: <code>base64</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Test file size limit</strong>:</p>
<ul>
<li>Create a large file: <code>dd if=/dev/zero of=test-files/large.txt bs=1M count=2</code></li>
<li>Try reading it with default maxSize (1MB)</li>
<li>Try with maxSize: <code>2097152</code> (2MB)</li>
</ul>
</li>
</ol>
<p><strong>Step 4: Test Error Cases</strong></p>
<ol>
<li>
<p><strong>Non-existent file</strong>:</p>
<ul>
<li>filepath: <code>/absolute/path/to/test-files/nonexistent.txt</code></li>
</ul>
</li>
<li>
<p><strong>Directory instead of file</strong>:</p>
<ul>
<li>filepath: <code>/absolute/path/to/test-files</code> (the directory itself)</li>
</ul>
</li>
<li>
<p><strong>Empty filepath</strong>:</p>
<ul>
<li>filepath: <code>""</code></li>
</ul>
</li>
<li>
<p><strong>Path traversal attempt</strong>:</p>
<ul>
<li>filepath: <code>/absolute/path/../../../etc/passwd</code></li>
</ul>
</li>
</ol>
<p><strong>Step 5: Verify Output</strong></p>
<ul>
<li>
<p>You should see output like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab03-mcp-tools-__codelineno-15-1"></a>File Information:
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab03-mcp-tools-__codelineno-15-2"></a>{
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#lab03-mcp-tools-__codelineno-15-3"></a>  &quot;path&quot;: &quot;/Users/username/project/test-files/hello.txt&quot;,
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#lab03-mcp-tools-__codelineno-15-4"></a>  &quot;size&quot;: 27,
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#lab03-mcp-tools-__codelineno-15-5"></a>  &quot;modified&quot;: &quot;2024-01-06T10:30:00.000Z&quot;,
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#lab03-mcp-tools-__codelineno-15-6"></a>  &quot;encoding&quot;: &quot;utf8&quot;
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#lab03-mcp-tools-__codelineno-15-7"></a>}
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#lab03-mcp-tools-__codelineno-15-8"></a>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#lab03-mcp-tools-__codelineno-15-9"></a>Content:
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#lab03-mcp-tools-__codelineno-15-10"></a>Hello, this is a test file!
</span></code></pre></div>
</li>
</ul>
<h4 id="lab03-mcp-tools-troubleshooting"><strong>Troubleshooting:</strong><a class="headerlink" href="#lab03-mcp-tools-troubleshooting" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>&ldquo;File not found&rdquo;</strong>: Make sure you&rsquo;re using the absolute path</li>
<li><strong>&ldquo;Access denied&rdquo;</strong>: The file path is outside your project directory</li>
<li><strong>&ldquo;Path is not a file&rdquo;</strong>: You tried to read a directory</li>
<li><strong>&ldquo;File too large&rdquo;</strong>: Increase the maxSize parameter</li>
</ul>
<h4 id="lab03-mcp-tools-key-learning-points_1">Key Learning Points:<a class="headerlink" href="#lab03-mcp-tools-key-learning-points_1" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Path security</strong> and preventing directory traversal attacks</li>
<li><strong>File system operations</strong> with Node.js fs/promises</li>
<li><strong>Input validation</strong> beyond JSON Schema</li>
<li><strong>File metadata</strong> extraction and formatting</li>
<li><strong>Error handling</strong> for various file system scenarios</li>
<li><strong>Resource limits</strong> to prevent abuse</li>
</ul>
<hr />
<h3 id="lab03-mcp-tools-tool-3-database-query">Tool 3: Database Query<a class="headerlink" href="#lab03-mcp-tools-tool-3-database-query" title="Permanent link">&para;</a></h3>
<p><strong>Goal</strong>: Create a secure database query tool that can execute SELECT statements on a SQLite database with proper validation and safety measures.</p>
<h4 id="lab03-mcp-tools-complete-database-query-tool-implementation">Complete Database Query Tool Implementation<a class="headerlink" href="#lab03-mcp-tools-complete-database-query-tool-implementation" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>First, install the SQLite dependency:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab03-mcp-tools-__codelineno-16-1"></a>npm<span class="w"> </span>install<span class="w"> </span>better-sqlite3
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#lab03-mcp-tools-__codelineno-16-2"></a>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>@types/better-sqlite3
</span></code></pre></div>
</li>
</ul>
<p><strong>Important</strong>: Do NOT copy the entire code block below. Instead, add the <code>query_database</code> tool to your existing <code>src/index.ts</code> file by following these specific steps:</p>
<ol>
<li>
<p><strong>Add the imports</strong> at the top of your file (after existing imports):
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab03-mcp-tools-__codelineno-17-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Database</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;better-sqlite3&#39;</span><span class="p">;</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Add the <code>query_database</code> tool to your tools array</strong> in the <code>ListToolsRequestSchema</code> handler:
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab03-mcp-tools-__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#lab03-mcp-tools-__codelineno-18-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;query_database&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#lab03-mcp-tools-__codelineno-18-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Execute SELECT queries on a SQLite database&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#lab03-mcp-tools-__codelineno-18-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#lab03-mcp-tools-__codelineno-18-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#lab03-mcp-tools-__codelineno-18-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#lab03-mcp-tools-__codelineno-18-7"></a><span class="w">      </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#lab03-mcp-tools-__codelineno-18-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#lab03-mcp-tools-__codelineno-18-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SQL SELECT query to execute&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#lab03-mcp-tools-__codelineno-18-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#lab03-mcp-tools-__codelineno-18-11"></a><span class="w">      </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#lab03-mcp-tools-__codelineno-18-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#lab03-mcp-tools-__codelineno-18-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Query parameters for prepared statement&quot;</span><span class="p">,</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#lab03-mcp-tools-__codelineno-18-14"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#lab03-mcp-tools-__codelineno-18-15"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#lab03-mcp-tools-__codelineno-18-16"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#lab03-mcp-tools-__codelineno-18-17"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#lab03-mcp-tools-__codelineno-18-18"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#lab03-mcp-tools-__codelineno-18-19"></a><span class="w">      </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#lab03-mcp-tools-__codelineno-18-20"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#lab03-mcp-tools-__codelineno-18-21"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum number of rows to return&quot;</span><span class="p">,</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#lab03-mcp-tools-__codelineno-18-22"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#lab03-mcp-tools-__codelineno-18-23"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span><span class="p">,</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#lab03-mcp-tools-__codelineno-18-24"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#lab03-mcp-tools-__codelineno-18-25"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#lab03-mcp-tools-__codelineno-18-26"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#lab03-mcp-tools-__codelineno-18-27"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#lab03-mcp-tools-__codelineno-18-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-29"><a id="__codelineno-18-29" name="__codelineno-18-29" href="#lab03-mcp-tools-__codelineno-18-29"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
<li>
<p><strong>Add the <code>query_database</code> handler</strong> in the <code>CallToolRequestSchema</code> handler (before the final <code>throw new Error</code>):
   <div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab03-mcp-tools-__codelineno-19-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;query_database&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab03-mcp-tools-__codelineno-19-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#lab03-mcp-tools-__codelineno-19-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#lab03-mcp-tools-__codelineno-19-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">parameters</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#lab03-mcp-tools-__codelineno-19-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">limit</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#lab03-mcp-tools-__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#lab03-mcp-tools-__codelineno-19-7"></a><span class="w">    </span><span class="c1">// Security: Validate input</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#lab03-mcp-tools-__codelineno-19-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">query</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#lab03-mcp-tools-__codelineno-19-9"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;query must be a non-empty string&quot;</span><span class="p">);</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#lab03-mcp-tools-__codelineno-19-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#lab03-mcp-tools-__codelineno-19-11"></a>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#lab03-mcp-tools-__codelineno-19-12"></a><span class="w">    </span><span class="c1">// Security: Only allow SELECT queries</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#lab03-mcp-tools-__codelineno-19-13"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">trimmedQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">();</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#lab03-mcp-tools-__codelineno-19-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">trimmedQuery</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;SELECT&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#lab03-mcp-tools-__codelineno-19-15"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Only SELECT queries are allowed for security&quot;</span><span class="p">);</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#lab03-mcp-tools-__codelineno-19-16"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#lab03-mcp-tools-__codelineno-19-17"></a>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#lab03-mcp-tools-__codelineno-19-18"></a><span class="w">    </span><span class="c1">// Check if database file exists</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#lab03-mcp-tools-__codelineno-19-19"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dbPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./data.db&#39;</span><span class="p">;</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#lab03-mcp-tools-__codelineno-19-20"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#lab03-mcp-tools-__codelineno-19-21"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#lab03-mcp-tools-__codelineno-19-22"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#lab03-mcp-tools-__codelineno-19-23"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Database file &#39;data.db&#39; not found in project root&quot;</span><span class="p">);</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#lab03-mcp-tools-__codelineno-19-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#lab03-mcp-tools-__codelineno-19-25"></a>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#lab03-mcp-tools-__codelineno-19-26"></a><span class="w">    </span><span class="c1">// Open database in read-only mode</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#lab03-mcp-tools-__codelineno-19-27"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Database</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">readonly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#lab03-mcp-tools-__codelineno-19-28"></a>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#lab03-mcp-tools-__codelineno-19-29"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#lab03-mcp-tools-__codelineno-19-30"></a><span class="w">      </span><span class="c1">// Prepare statement</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#lab03-mcp-tools-__codelineno-19-31"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; LIMIT ?&#39;</span><span class="p">);</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#lab03-mcp-tools-__codelineno-19-32"></a>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#lab03-mcp-tools-__codelineno-19-33"></a><span class="w">      </span><span class="c1">// Execute query</span>
</span><span id="__span-19-34"><a id="__codelineno-19-34" name="__codelineno-19-34" href="#lab03-mcp-tools-__codelineno-19-34"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">all</span><span class="p">(...</span><span class="nx">parameters</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">);</span>
</span><span id="__span-19-35"><a id="__codelineno-19-35" name="__codelineno-19-35" href="#lab03-mcp-tools-__codelineno-19-35"></a>
</span><span id="__span-19-36"><a id="__codelineno-19-36" name="__codelineno-19-36" href="#lab03-mcp-tools-__codelineno-19-36"></a><span class="w">      </span><span class="c1">// Format results</span>
</span><span id="__span-19-37"><a id="__codelineno-19-37" name="__codelineno-19-37" href="#lab03-mcp-tools-__codelineno-19-37"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resultText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span>
</span><span id="__span-19-38"><a id="__codelineno-19-38" name="__codelineno-19-38" href="#lab03-mcp-tools-__codelineno-19-38"></a><span class="w">        </span><span class="o">?</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-19-39"><a id="__codelineno-19-39" name="__codelineno-19-39" href="#lab03-mcp-tools-__codelineno-19-39"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No results found&quot;</span><span class="p">;</span>
</span><span id="__span-19-40"><a id="__codelineno-19-40" name="__codelineno-19-40" href="#lab03-mcp-tools-__codelineno-19-40"></a>
</span><span id="__span-19-41"><a id="__codelineno-19-41" name="__codelineno-19-41" href="#lab03-mcp-tools-__codelineno-19-41"></a><span class="w">      </span><span class="c1">// Get query info</span>
</span><span id="__span-19-42"><a id="__codelineno-19-42" name="__codelineno-19-42" href="#lab03-mcp-tools-__codelineno-19-42"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">columns</span><span class="p">();</span>
</span><span id="__span-19-43"><a id="__codelineno-19-43" name="__codelineno-19-43" href="#lab03-mcp-tools-__codelineno-19-43"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">columnNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-19-44"><a id="__codelineno-19-44" name="__codelineno-19-44" href="#lab03-mcp-tools-__codelineno-19-44"></a>
</span><span id="__span-19-45"><a id="__codelineno-19-45" name="__codelineno-19-45" href="#lab03-mcp-tools-__codelineno-19-45"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-46"><a id="__codelineno-19-46" name="__codelineno-19-46" href="#lab03-mcp-tools-__codelineno-19-46"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-19-47"><a id="__codelineno-19-47" name="__codelineno-19-47" href="#lab03-mcp-tools-__codelineno-19-47"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-19-48"><a id="__codelineno-19-48" name="__codelineno-19-48" href="#lab03-mcp-tools-__codelineno-19-48"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-19-49"><a id="__codelineno-19-49" name="__codelineno-19-49" href="#lab03-mcp-tools-__codelineno-19-49"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Query executed successfully.\nDatabase: </span><span class="si">${</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">\nColumns: </span><span class="si">${</span><span class="nx">columnNames</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">\nRows returned: </span><span class="si">${</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">\n\nResults:\n</span><span class="si">${</span><span class="nx">resultText</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-19-50"><a id="__codelineno-19-50" name="__codelineno-19-50" href="#lab03-mcp-tools-__codelineno-19-50"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-19-51"><a id="__codelineno-19-51" name="__codelineno-19-51" href="#lab03-mcp-tools-__codelineno-19-51"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-19-52"><a id="__codelineno-19-52" name="__codelineno-19-52" href="#lab03-mcp-tools-__codelineno-19-52"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-19-53"><a id="__codelineno-19-53" name="__codelineno-19-53" href="#lab03-mcp-tools-__codelineno-19-53"></a>
</span><span id="__span-19-54"><a id="__codelineno-19-54" name="__codelineno-19-54" href="#lab03-mcp-tools-__codelineno-19-54"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-55"><a id="__codelineno-19-55" name="__codelineno-19-55" href="#lab03-mcp-tools-__codelineno-19-55"></a><span class="w">      </span><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-19-56"><a id="__codelineno-19-56" name="__codelineno-19-56" href="#lab03-mcp-tools-__codelineno-19-56"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-19-57"><a id="__codelineno-19-57" name="__codelineno-19-57" href="#lab03-mcp-tools-__codelineno-19-57"></a>
</span><span id="__span-19-58"><a id="__codelineno-19-58" name="__codelineno-19-58" href="#lab03-mcp-tools-__codelineno-19-58"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-59"><a id="__codelineno-19-59" name="__codelineno-19-59" href="#lab03-mcp-tools-__codelineno-19-59"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-19-60"><a id="__codelineno-19-60" name="__codelineno-19-60" href="#lab03-mcp-tools-__codelineno-19-60"></a><span class="w">      </span><span class="sb">`Database query failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-19-61"><a id="__codelineno-19-61" name="__codelineno-19-61" href="#lab03-mcp-tools-__codelineno-19-61"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-19-62"><a id="__codelineno-19-62" name="__codelineno-19-62" href="#lab03-mcp-tools-__codelineno-19-62"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-63"><a id="__codelineno-19-63" name="__codelineno-19-63" href="#lab03-mcp-tools-__codelineno-19-63"></a><span class="p">}</span>
</span></code></pre></div></p>
</li>
</ol>
<p><br></p>
<ul>
<li>
<p><strong>The code block below is for reference only</strong> - it shows what your complete file should look like after adding the tool. Do not copy-paste the entire block:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab03-mcp-tools-__codelineno-20-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#lab03-mcp-tools-__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#lab03-mcp-tools-__codelineno-20-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#lab03-mcp-tools-__codelineno-20-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#lab03-mcp-tools-__codelineno-20-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#lab03-mcp-tools-__codelineno-20-6"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#lab03-mcp-tools-__codelineno-20-7"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#lab03-mcp-tools-__codelineno-20-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#lab03-mcp-tools-__codelineno-20-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#lab03-mcp-tools-__codelineno-20-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#lab03-mcp-tools-__codelineno-20-11"></a><span class="k">import</span><span class="w"> </span><span class="nx">Database</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;better-sqlite3&#39;</span><span class="p">;</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#lab03-mcp-tools-__codelineno-20-12"></a>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#lab03-mcp-tools-__codelineno-20-13"></a><span class="c1">// ... existing imports and class definition ...</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#lab03-mcp-tools-__codelineno-20-14"></a>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#lab03-mcp-tools-__codelineno-20-15"></a><span class="w">  </span><span class="cm">/**</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#lab03-mcp-tools-__codelineno-20-16"></a><span class="cm">  * Set up request handlers</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#lab03-mcp-tools-__codelineno-20-17"></a><span class="cm">  */</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#lab03-mcp-tools-__codelineno-20-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#lab03-mcp-tools-__codelineno-20-19"></a><span class="w">    </span><span class="c1">// Handler for listing available tools</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#lab03-mcp-tools-__codelineno-20-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#lab03-mcp-tools-__codelineno-20-21"></a><span class="w">      </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#lab03-mcp-tools-__codelineno-20-22"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#lab03-mcp-tools-__codelineno-20-23"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#lab03-mcp-tools-__codelineno-20-24"></a><span class="w">          </span><span class="c1">// ... existing tools ...</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#lab03-mcp-tools-__codelineno-20-25"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#lab03-mcp-tools-__codelineno-20-26"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;query_database&quot;</span><span class="p">,</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#lab03-mcp-tools-__codelineno-20-27"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Execute SELECT queries on a SQLite database&quot;</span><span class="p">,</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#lab03-mcp-tools-__codelineno-20-28"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#lab03-mcp-tools-__codelineno-20-29"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#lab03-mcp-tools-__codelineno-20-30"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#lab03-mcp-tools-__codelineno-20-31"></a><span class="w">                </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#lab03-mcp-tools-__codelineno-20-32"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#lab03-mcp-tools-__codelineno-20-33"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;SQL SELECT query to execute&quot;</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#lab03-mcp-tools-__codelineno-20-34"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#lab03-mcp-tools-__codelineno-20-35"></a><span class="w">                </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#lab03-mcp-tools-__codelineno-20-36"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#lab03-mcp-tools-__codelineno-20-37"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Query parameters for prepared statement&quot;</span><span class="p">,</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#lab03-mcp-tools-__codelineno-20-38"></a><span class="w">                  </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#lab03-mcp-tools-__codelineno-20-39"></a><span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;null&quot;</span><span class="p">]</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#lab03-mcp-tools-__codelineno-20-40"></a><span class="w">                  </span><span class="p">},</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#lab03-mcp-tools-__codelineno-20-41"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#lab03-mcp-tools-__codelineno-20-42"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#lab03-mcp-tools-__codelineno-20-43"></a><span class="w">                </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#lab03-mcp-tools-__codelineno-20-44"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#lab03-mcp-tools-__codelineno-20-45"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum number of rows to return&quot;</span><span class="p">,</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#lab03-mcp-tools-__codelineno-20-46"></a><span class="w">                  </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#lab03-mcp-tools-__codelineno-20-47"></a><span class="w">                  </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span><span class="p">,</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#lab03-mcp-tools-__codelineno-20-48"></a><span class="w">                  </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#lab03-mcp-tools-__codelineno-20-49"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#lab03-mcp-tools-__codelineno-20-50"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#lab03-mcp-tools-__codelineno-20-51"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;query&quot;</span><span class="p">]</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#lab03-mcp-tools-__codelineno-20-52"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#lab03-mcp-tools-__codelineno-20-53"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#lab03-mcp-tools-__codelineno-20-54"></a><span class="w">          </span><span class="c1">// ... existing tools ...</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#lab03-mcp-tools-__codelineno-20-55"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#lab03-mcp-tools-__codelineno-20-56"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#lab03-mcp-tools-__codelineno-20-57"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#lab03-mcp-tools-__codelineno-20-58"></a>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#lab03-mcp-tools-__codelineno-20-59"></a><span class="w">    </span><span class="c1">// Handler for calling tools</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#lab03-mcp-tools-__codelineno-20-60"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#lab03-mcp-tools-__codelineno-20-61"></a><span class="w">      </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#lab03-mcp-tools-__codelineno-20-62"></a><span class="w">      </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#lab03-mcp-tools-__codelineno-20-63"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#lab03-mcp-tools-__codelineno-20-64"></a>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#lab03-mcp-tools-__codelineno-20-65"></a><span class="w">        </span><span class="c1">// ... existing tool handlers ...</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#lab03-mcp-tools-__codelineno-20-66"></a>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#lab03-mcp-tools-__codelineno-20-67"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;query_database&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#lab03-mcp-tools-__codelineno-20-68"></a><span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#lab03-mcp-tools-__codelineno-20-69"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#lab03-mcp-tools-__codelineno-20-70"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">parameters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">parameters</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#lab03-mcp-tools-__codelineno-20-71"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">limit</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#lab03-mcp-tools-__codelineno-20-72"></a>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#lab03-mcp-tools-__codelineno-20-73"></a><span class="w">            </span><span class="c1">// Security: Validate input</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#lab03-mcp-tools-__codelineno-20-74"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">query</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#lab03-mcp-tools-__codelineno-20-75"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;query must be a non-empty string&quot;</span><span class="p">);</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#lab03-mcp-tools-__codelineno-20-76"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#lab03-mcp-tools-__codelineno-20-77"></a>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#lab03-mcp-tools-__codelineno-20-78"></a><span class="w">            </span><span class="c1">// Security: Only allow SELECT queries</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#lab03-mcp-tools-__codelineno-20-79"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">trimmedQuery</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">query</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">();</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#lab03-mcp-tools-__codelineno-20-80"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">trimmedQuery</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;SELECT&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#lab03-mcp-tools-__codelineno-20-81"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Only SELECT queries are allowed for security&quot;</span><span class="p">);</span>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#lab03-mcp-tools-__codelineno-20-82"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#lab03-mcp-tools-__codelineno-20-83"></a>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#lab03-mcp-tools-__codelineno-20-84"></a><span class="w">            </span><span class="c1">// Check if database file exists</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#lab03-mcp-tools-__codelineno-20-85"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">dbPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./data.db&#39;</span><span class="p">;</span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#lab03-mcp-tools-__codelineno-20-86"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#lab03-mcp-tools-__codelineno-20-87"></a><span class="w">              </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#lab03-mcp-tools-__codelineno-20-88"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#lab03-mcp-tools-__codelineno-20-89"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Database file &#39;data.db&#39; not found in project root&quot;</span><span class="p">);</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#lab03-mcp-tools-__codelineno-20-90"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#lab03-mcp-tools-__codelineno-20-91"></a>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#lab03-mcp-tools-__codelineno-20-92"></a><span class="w">            </span><span class="c1">// Open database in read-only mode</span>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#lab03-mcp-tools-__codelineno-20-93"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Database</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">readonly</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#lab03-mcp-tools-__codelineno-20-94"></a>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#lab03-mcp-tools-__codelineno-20-95"></a><span class="w">            </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#lab03-mcp-tools-__codelineno-20-96"></a><span class="w">              </span><span class="c1">// Prepare statement</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#lab03-mcp-tools-__codelineno-20-97"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; LIMIT ?&#39;</span><span class="p">);</span>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#lab03-mcp-tools-__codelineno-20-98"></a>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#lab03-mcp-tools-__codelineno-20-99"></a><span class="w">              </span><span class="c1">// Execute query</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#lab03-mcp-tools-__codelineno-20-100"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">all</span><span class="p">(...</span><span class="nx">parameters</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">);</span>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#lab03-mcp-tools-__codelineno-20-101"></a>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#lab03-mcp-tools-__codelineno-20-102"></a><span class="w">              </span><span class="c1">// Format results</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#lab03-mcp-tools-__codelineno-20-103"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">resultText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#lab03-mcp-tools-__codelineno-20-104"></a><span class="w">                </span><span class="o">?</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">rows</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#lab03-mcp-tools-__codelineno-20-105"></a><span class="w">                </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;No results found&quot;</span><span class="p">;</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#lab03-mcp-tools-__codelineno-20-106"></a>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#lab03-mcp-tools-__codelineno-20-107"></a><span class="w">              </span><span class="c1">// Get query info</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#lab03-mcp-tools-__codelineno-20-108"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">info</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">columns</span><span class="p">();</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#lab03-mcp-tools-__codelineno-20-109"></a><span class="w">              </span><span class="kd">const</span><span class="w"> </span><span class="nx">columnNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">info</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#lab03-mcp-tools-__codelineno-20-110"></a>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#lab03-mcp-tools-__codelineno-20-111"></a><span class="w">              </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112" href="#lab03-mcp-tools-__codelineno-20-112"></a><span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113" href="#lab03-mcp-tools-__codelineno-20-113"></a><span class="w">                  </span><span class="p">{</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114" href="#lab03-mcp-tools-__codelineno-20-114"></a><span class="w">                    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-20-115"><a id="__codelineno-20-115" name="__codelineno-20-115" href="#lab03-mcp-tools-__codelineno-20-115"></a><span class="w">                    </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Query executed successfully.\nDatabase: </span><span class="si">${</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">\nColumns: </span><span class="si">${</span><span class="nx">columnNames</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">\nRows returned: </span><span class="si">${</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">\n\nResults:\n</span><span class="si">${</span><span class="nx">resultText</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-20-116"><a id="__codelineno-20-116" name="__codelineno-20-116" href="#lab03-mcp-tools-__codelineno-20-116"></a><span class="w">                  </span><span class="p">}</span>
</span><span id="__span-20-117"><a id="__codelineno-20-117" name="__codelineno-20-117" href="#lab03-mcp-tools-__codelineno-20-117"></a><span class="w">                </span><span class="p">]</span>
</span><span id="__span-20-118"><a id="__codelineno-20-118" name="__codelineno-20-118" href="#lab03-mcp-tools-__codelineno-20-118"></a><span class="w">              </span><span class="p">};</span>
</span><span id="__span-20-119"><a id="__codelineno-20-119" name="__codelineno-20-119" href="#lab03-mcp-tools-__codelineno-20-119"></a>
</span><span id="__span-20-120"><a id="__codelineno-20-120" name="__codelineno-20-120" href="#lab03-mcp-tools-__codelineno-20-120"></a><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-121"><a id="__codelineno-20-121" name="__codelineno-20-121" href="#lab03-mcp-tools-__codelineno-20-121"></a><span class="w">              </span><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-20-122"><a id="__codelineno-20-122" name="__codelineno-20-122" href="#lab03-mcp-tools-__codelineno-20-122"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-20-123"><a id="__codelineno-20-123" name="__codelineno-20-123" href="#lab03-mcp-tools-__codelineno-20-123"></a>
</span><span id="__span-20-124"><a id="__codelineno-20-124" name="__codelineno-20-124" href="#lab03-mcp-tools-__codelineno-20-124"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-125"><a id="__codelineno-20-125" name="__codelineno-20-125" href="#lab03-mcp-tools-__codelineno-20-125"></a><span class="w">            </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-20-126"><a id="__codelineno-20-126" name="__codelineno-20-126" href="#lab03-mcp-tools-__codelineno-20-126"></a><span class="w">              </span><span class="sb">`Database query failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-20-127"><a id="__codelineno-20-127" name="__codelineno-20-127" href="#lab03-mcp-tools-__codelineno-20-127"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-20-128"><a id="__codelineno-20-128" name="__codelineno-20-128" href="#lab03-mcp-tools-__codelineno-20-128"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-20-129"><a id="__codelineno-20-129" name="__codelineno-20-129" href="#lab03-mcp-tools-__codelineno-20-129"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-20-130"><a id="__codelineno-20-130" name="__codelineno-20-130" href="#lab03-mcp-tools-__codelineno-20-130"></a>
</span><span id="__span-20-131"><a id="__codelineno-20-131" name="__codelineno-20-131" href="#lab03-mcp-tools-__codelineno-20-131"></a><span class="w">        </span><span class="c1">// ... existing tool handlers ...</span>
</span><span id="__span-20-132"><a id="__codelineno-20-132" name="__codelineno-20-132" href="#lab03-mcp-tools-__codelineno-20-132"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-133"><a id="__codelineno-20-133" name="__codelineno-20-133" href="#lab03-mcp-tools-__codelineno-20-133"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-20-134"><a id="__codelineno-20-134" name="__codelineno-20-134" href="#lab03-mcp-tools-__codelineno-20-134"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-135"><a id="__codelineno-20-135" name="__codelineno-20-135" href="#lab03-mcp-tools-__codelineno-20-135"></a>
</span><span id="__span-20-136"><a id="__codelineno-20-136" name="__codelineno-20-136" href="#lab03-mcp-tools-__codelineno-20-136"></a><span class="w">  </span><span class="c1">// ... rest of the class remains the same ...</span>
</span></code></pre></div>
</li>
</ul>
<h4 id="lab03-mcp-tools-testing-the-database-query-tool">Testing the Database Query Tool<a class="headerlink" href="#lab03-mcp-tools-testing-the-database-query-tool" title="Permanent link">&para;</a></h4>
<p><strong>Step 1: Install SQLite</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab03-mcp-tools-__codelineno-21-1"></a><span class="c1"># Install sqlite3 command-line tool (if not already installed)</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#lab03-mcp-tools-__codelineno-21-2"></a>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#lab03-mcp-tools-__codelineno-21-3"></a><span class="c1"># On macOS:</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#lab03-mcp-tools-__codelineno-21-4"></a>brew<span class="w"> </span>install<span class="w"> </span>sqlite3
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#lab03-mcp-tools-__codelineno-21-5"></a>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#lab03-mcp-tools-__codelineno-21-6"></a><span class="c1"># On Linux (Ubuntu/Debian):</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#lab03-mcp-tools-__codelineno-21-7"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>sqlite3
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#lab03-mcp-tools-__codelineno-21-8"></a>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#lab03-mcp-tools-__codelineno-21-9"></a><span class="c1"># On Linux (CentOS/RHEL/Fedora):</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#lab03-mcp-tools-__codelineno-21-10"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>sqlite3<span class="w">    </span><span class="c1"># or sudo dnf install sqlite3</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#lab03-mcp-tools-__codelineno-21-11"></a>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#lab03-mcp-tools-__codelineno-21-12"></a><span class="c1"># On Windows (using Chocolatey):</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#lab03-mcp-tools-__codelineno-21-13"></a>choco<span class="w"> </span>install<span class="w"> </span>sqlite
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#lab03-mcp-tools-__codelineno-21-14"></a>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#lab03-mcp-tools-__codelineno-21-15"></a><span class="c1"># On Windows (manual download):</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#lab03-mcp-tools-__codelineno-21-16"></a><span class="c1"># Download from: https://www.sqlite.org/download.html</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#lab03-mcp-tools-__codelineno-21-17"></a><span class="c1"># Extract sqlite3.exe to a folder in your PATH</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#lab03-mcp-tools-__codelineno-21-18"></a>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#lab03-mcp-tools-__codelineno-21-19"></a><span class="c1"># Verify installation:</span>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#lab03-mcp-tools-__codelineno-21-20"></a>sqlite3<span class="w"> </span>--version
</span></code></pre></div>
<p><br></p>
<p><strong>Step 2: Create a Sample Database</strong></p>
<p><strong>Navigate to your MCP server directory</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab03-mcp-tools-__codelineno-22-1"></a><span class="nb">cd</span><span class="w"> </span>/Users/orni/Code-Wizard/MCP_Lab/MCP_Lab/lab_solution/my-first-mcp-server
</span></code></pre></div>
<p><strong>Run the database creation command</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab03-mcp-tools-__codelineno-23-1"></a>sqlite3<span class="w"> </span>data.db<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab03-mcp-tools-__codelineno-23-2"></a><span class="s">CREATE TABLE users (</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#lab03-mcp-tools-__codelineno-23-3"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#lab03-mcp-tools-__codelineno-23-4"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#lab03-mcp-tools-__codelineno-23-5"></a><span class="s">  email TEXT UNIQUE,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#lab03-mcp-tools-__codelineno-23-6"></a><span class="s">  age INTEGER,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#lab03-mcp-tools-__codelineno-23-7"></a><span class="s">  created_at DATETIME DEFAULT CURRENT_TIMESTAMP</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#lab03-mcp-tools-__codelineno-23-8"></a><span class="s">);</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#lab03-mcp-tools-__codelineno-23-9"></a>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#lab03-mcp-tools-__codelineno-23-10"></a><span class="s">CREATE TABLE products (</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#lab03-mcp-tools-__codelineno-23-11"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#lab03-mcp-tools-__codelineno-23-12"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#lab03-mcp-tools-__codelineno-23-13"></a><span class="s">  price REAL,</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#lab03-mcp-tools-__codelineno-23-14"></a><span class="s">  category TEXT,</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#lab03-mcp-tools-__codelineno-23-15"></a><span class="s">  in_stock BOOLEAN DEFAULT 1</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#lab03-mcp-tools-__codelineno-23-16"></a><span class="s">);</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#lab03-mcp-tools-__codelineno-23-17"></a>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#lab03-mcp-tools-__codelineno-23-18"></a><span class="s">INSERT INTO users (name, email, age) VALUES </span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#lab03-mcp-tools-__codelineno-23-19"></a><span class="s">  (&#39;Alice Johnson&#39;, &#39;alice@example.com&#39;, 28),</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#lab03-mcp-tools-__codelineno-23-20"></a><span class="s">  (&#39;Bob Smith&#39;, &#39;bob@example.com&#39;, 34),</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#lab03-mcp-tools-__codelineno-23-21"></a><span class="s">  (&#39;Charlie Brown&#39;, &#39;charlie@example.com&#39;, 22);</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#lab03-mcp-tools-__codelineno-23-22"></a>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#lab03-mcp-tools-__codelineno-23-23"></a><span class="s">INSERT INTO products (name, price, category, in_stock) VALUES </span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#lab03-mcp-tools-__codelineno-23-24"></a><span class="s">  (&#39;Laptop&#39;, 999.99, &#39;Electronics&#39;, 1),</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#lab03-mcp-tools-__codelineno-23-25"></a><span class="s">  (&#39;Book&#39;, 19.99, &#39;Education&#39;, 1),</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#lab03-mcp-tools-__codelineno-23-26"></a><span class="s">  (&#39;Coffee Mug&#39;, 12.50, &#39;Kitchen&#39;, 0);</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#lab03-mcp-tools-__codelineno-23-27"></a>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#lab03-mcp-tools-__codelineno-23-28"></a><span class="s">.quit</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#lab03-mcp-tools-__codelineno-23-29"></a><span class="s">EOF</span>
</span></code></pre></div>
<p><strong>Verify the database was created</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab03-mcp-tools-__codelineno-24-1"></a>sqlite3<span class="w"> </span>data.db<span class="w"> </span><span class="s2">&quot;SELECT name FROM sqlite_master WHERE type=&#39;table&#39;;&quot;</span>
</span></code></pre></div>
<ul>
<li>
<p>You should see output like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab03-mcp-tools-__codelineno-25-1"></a>users
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab03-mcp-tools-__codelineno-25-2"></a>products
</span></code></pre></div>
</li>
</ul>
<p><strong>What this does:</strong></p>
<ul>
<li>Creates a SQLite database file called <code>data.db</code> in your project directory</li>
<li>Creates two tables: <code>users</code> and <code>products</code></li>
<li>Inserts sample data into both tables</li>
<li>This gives you test data to query with your <code>query_database</code> tool</li>
</ul>
<p><br></p>
<p><strong>Step 2: Start the MCP Inspector</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab03-mcp-tools-__codelineno-26-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><br></p>
<p><strong>Step 3: Test Database Queries</strong></p>
<ol>
<li>
<p><strong>Simple SELECT query</strong>:</p>
<ul>
<li>Tool: <code>query_database</code></li>
<li>query: <code>SELECT * FROM users</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Query with WHERE clause</strong>:</p>
<ul>
<li>Tool: <code>query_database</code></li>
<li>query: <code>SELECT name, email FROM users WHERE age &gt; 25</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Query with parameters</strong>:</p>
<ul>
<li>Tool: <code>query_database</code></li>
<li>query: <code>SELECT * FROM products WHERE category = ?</code></li>
<li>parameters: <code>["Electronics"]</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>Query with LIMIT</strong>:</p>
<ul>
<li>Tool: <code>query_database</code></li>
<li>query: <code>SELECT * FROM users</code></li>
<li>limit: <code>2</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
<li>
<p><strong>JOIN query</strong>:</p>
<ul>
<li>Tool: <code>query_database</code></li>
<li>query: <code>SELECT u.name, p.name as product FROM users u CROSS JOIN products p LIMIT 5</code></li>
<li>Click &ldquo;Call Tool&rdquo;</li>
</ul>
</li>
</ol>
<p><br></p>
<p><strong>Step 4: Test Error Cases</strong></p>
<ol>
<li>
<p><strong>Non-SELECT query</strong>:</p>
<ul>
<li>query: <code>DELETE FROM users WHERE id = 1</code></li>
</ul>
</li>
<li>
<p><strong>Invalid SQL syntax</strong>:</p>
<ul>
<li>query: <code>SELECT * FROM nonexistent_table</code></li>
</ul>
</li>
<li>
<p><strong>Missing database file</strong>:</p>
<ul>
<li>Rename <code>data.db</code> to <code>data.db.backup</code> and try a query</li>
</ul>
</li>
<li>
<p><strong>Empty query</strong>:</p>
<ul>
<li>query: <code>""</code></li>
</ul>
</li>
</ol>
<p><br></p>
<p><strong>Step 5: Verify Output</strong></p>
<ul>
<li>
<p>You should see output like:</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab03-mcp-tools-__codelineno-27-1"></a>Query executed successfully.
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab03-mcp-tools-__codelineno-27-2"></a>Database: ./data.db
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#lab03-mcp-tools-__codelineno-27-3"></a>Columns: id, name, email, age, created_at
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#lab03-mcp-tools-__codelineno-27-4"></a>Rows returned: 3
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#lab03-mcp-tools-__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#lab03-mcp-tools-__codelineno-27-6"></a>Results:
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#lab03-mcp-tools-__codelineno-27-7"></a>[
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#lab03-mcp-tools-__codelineno-27-8"></a>  {
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#lab03-mcp-tools-__codelineno-27-9"></a>    &quot;id&quot;: 1,
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#lab03-mcp-tools-__codelineno-27-10"></a>    &quot;name&quot;: &quot;Alice Johnson&quot;,
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#lab03-mcp-tools-__codelineno-27-11"></a>    &quot;email&quot;: &quot;alice@example.com&quot;,
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#lab03-mcp-tools-__codelineno-27-12"></a>    &quot;age&quot;: 28,
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#lab03-mcp-tools-__codelineno-27-13"></a>    &quot;created_at&quot;: &quot;2024-01-06 10:30:00&quot;
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#lab03-mcp-tools-__codelineno-27-14"></a>  },
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#lab03-mcp-tools-__codelineno-27-15"></a>  ...
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#lab03-mcp-tools-__codelineno-27-16"></a>]
</span></code></pre></div>
</li>
</ul>
<p><strong>Troubleshooting:</strong></p>
<ul>
<li><strong>&ldquo;Database file not found&rdquo;</strong>: Make sure <code>data.db</code> exists in your project root</li>
<li><strong>&ldquo;Only SELECT queries are allowed&rdquo;</strong>: The tool only allows SELECT statements for security</li>
<li><strong>&ldquo;no such table&rdquo;</strong>: Check your table names in the database</li>
<li><strong>&ldquo;sqlite3: command not found&rdquo;</strong>: Install sqlite3 CLI tool</li>
</ul>
<h4 id="lab03-mcp-tools-key-learning-points_2">Key Learning Points:<a class="headerlink" href="#lab03-mcp-tools-key-learning-points_2" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>SQL injection prevention</strong> using prepared statements</li>
<li><strong>Database security</strong> with read-only access and query restrictions</li>
<li><strong>SQLite operations</strong> with better-sqlite3</li>
<li><strong>Query parameterization</strong> for safe dynamic queries</li>
<li><strong>Result formatting</strong> and metadata extraction</li>
<li><strong>Resource management</strong> with proper database connection handling</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-returning-rich-content">Returning Rich Content<a class="headerlink" href="#lab03-mcp-tools-returning-rich-content" title="Permanent link">&para;</a></h2>
<p>MCP supports multiple content types in tool responses, allowing you to return not just text but also images, resources, and combinations of different content types. This enables richer, more interactive responses that can include visual data, file references, and structured information.</p>
<h3 id="lab03-mcp-tools-1-text-content">1. Text Content<a class="headerlink" href="#lab03-mcp-tools-1-text-content" title="Permanent link">&para;</a></h3>
<p><strong>Text content</strong> is the most common and basic type of response. Use it for any string-based information like analysis results, status messages, or formatted data.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab03-mcp-tools-__codelineno-28-1"></a><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#lab03-mcp-tools-__codelineno-28-2"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#lab03-mcp-tools-__codelineno-28-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#lab03-mcp-tools-__codelineno-28-4"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-28-5"><a id="__codelineno-28-5" name="__codelineno-28-5" href="#lab03-mcp-tools-__codelineno-28-5"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Simple text response&quot;</span>
</span><span id="__span-28-6"><a id="__codelineno-28-6" name="__codelineno-28-6" href="#lab03-mcp-tools-__codelineno-28-6"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-28-7"><a id="__codelineno-28-7" name="__codelineno-28-7" href="#lab03-mcp-tools-__codelineno-28-7"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-28-8"><a id="__codelineno-28-8" name="__codelineno-28-8" href="#lab03-mcp-tools-__codelineno-28-8"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>When to use -</strong> Most tool responses will use text content. It&rsquo;s perfect for:</p>
<ul>
<li>Status messages and confirmations</li>
<li>Formatted data output (JSON, tables, lists)</li>
<li>Error messages and explanations</li>
<li>Analysis results and summaries</li>
</ul>
<h3 id="lab03-mcp-tools-2-image-content">2. Image Content<a class="headerlink" href="#lab03-mcp-tools-2-image-content" title="Permanent link">&para;</a></h3>
<p><strong>Image content</strong> allows you to return visual data directly in the response. The image data must be base64-encoded and include the appropriate MIME type.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab03-mcp-tools-__codelineno-29-1"></a><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#lab03-mcp-tools-__codelineno-29-2"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#lab03-mcp-tools-__codelineno-29-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#lab03-mcp-tools-__codelineno-29-4"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#lab03-mcp-tools-__codelineno-29-5"></a><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">base64ImageData</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#lab03-mcp-tools-__codelineno-29-6"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;image/png&quot;</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#lab03-mcp-tools-__codelineno-29-7"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#lab03-mcp-tools-__codelineno-29-8"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#lab03-mcp-tools-__codelineno-29-9"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>When to use -</strong> Ideal for tools that generate or process visual content:</p>
<ul>
<li>Charts and graphs from data analysis</li>
<li>Screenshots or visual captures</li>
<li>Generated diagrams or illustrations</li>
<li>Image processing results</li>
</ul>
<p><strong>Important:</strong> Always specify the correct MIME type (image/png, image/jpeg, image/svg+xml, etc.) and ensure the base64 data is properly encoded.</p>
<h3 id="lab03-mcp-tools-3-resource-content">3. Resource Content<a class="headerlink" href="#lab03-mcp-tools-3-resource-content" title="Permanent link">&para;</a></h3>
<p><strong>Resource content</strong> references external resources rather than including their data directly. This is useful for large files or when you want to provide access to resources without embedding them.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab03-mcp-tools-__codelineno-30-1"></a><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#lab03-mcp-tools-__codelineno-30-2"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#lab03-mcp-tools-__codelineno-30-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#lab03-mcp-tools-__codelineno-30-4"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;resource&quot;</span><span class="p">,</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#lab03-mcp-tools-__codelineno-30-5"></a><span class="w">      </span><span class="nx">resource</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#lab03-mcp-tools-__codelineno-30-6"></a><span class="w">        </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;file:///path/to/file.txt&quot;</span><span class="p">,</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#lab03-mcp-tools-__codelineno-30-7"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#lab03-mcp-tools-__codelineno-30-8"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;File contents...&quot;</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#lab03-mcp-tools-__codelineno-30-9"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#lab03-mcp-tools-__codelineno-30-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#lab03-mcp-tools-__codelineno-30-11"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#lab03-mcp-tools-__codelineno-30-12"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>When to use -</strong> Best for:</p>
<ul>
<li>Large files that would make responses too bulky</li>
<li>References to external files or URLs</li>
<li>When the client should handle the resource directly</li>
<li>Providing access to generated files</li>
</ul>
<p><strong>Note:</strong> The <code>text</code> field is optional - you can omit it if the resource content is too large or if you just want to provide a reference.</p>
<h3 id="lab03-mcp-tools-4-multiple-content-items">4. Multiple Content Items<a class="headerlink" href="#lab03-mcp-tools-4-multiple-content-items" title="Permanent link">&para;</a></h3>
<p><strong>Multiple content items</strong> allow you to combine different types of content in a single response. This creates rich, multi-part responses that can include text explanations alongside visual data.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab03-mcp-tools-__codelineno-31-1"></a><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#lab03-mcp-tools-__codelineno-31-2"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#lab03-mcp-tools-__codelineno-31-3"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#lab03-mcp-tools-__codelineno-31-4"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#lab03-mcp-tools-__codelineno-31-5"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analysis complete:&quot;</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#lab03-mcp-tools-__codelineno-31-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#lab03-mcp-tools-__codelineno-31-7"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#lab03-mcp-tools-__codelineno-31-8"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#lab03-mcp-tools-__codelineno-31-9"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Details:\n- Item 1\n- Item 2&quot;</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#lab03-mcp-tools-__codelineno-31-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#lab03-mcp-tools-__codelineno-31-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#lab03-mcp-tools-__codelineno-31-12"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;image&quot;</span><span class="p">,</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#lab03-mcp-tools-__codelineno-31-13"></a><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">chartImage</span><span class="p">,</span>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#lab03-mcp-tools-__codelineno-31-14"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;image/png&quot;</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#lab03-mcp-tools-__codelineno-31-15"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#lab03-mcp-tools-__codelineno-31-16"></a><span class="w">  </span><span class="p">]</span>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#lab03-mcp-tools-__codelineno-31-17"></a><span class="p">};</span>
</span></code></pre></div>
<p><strong>When to use -</strong> Perfect for comprehensive responses that need multiple components:</p>
<ul>
<li>Analysis reports with both text summaries and visual charts</li>
<li>File processing results with metadata and content preview</li>
<li>Multi-step operations with status updates and final results</li>
<li>Complex data with both tabular and graphical representations</li>
</ul>
<p><strong>Tip:</strong> Order your content logically - start with text explanations, then show supporting images or resources.</p>
<hr />
<h2 id="lab03-mcp-tools-error-handling-patterns">Error Handling Patterns<a class="headerlink" href="#lab03-mcp-tools-error-handling-patterns" title="Permanent link">&para;</a></h2>
<p>Error handling is crucial for robust MCP tools. Different situations require different approaches to handle failures gracefully while providing useful feedback to users. Here are three essential patterns for handling errors effectively.</p>
<h3 id="lab03-mcp-tools-pattern-1-input-validation">Pattern 1: Input Validation<a class="headerlink" href="#lab03-mcp-tools-pattern-1-input-validation" title="Permanent link">&para;</a></h3>
<p><strong>Input validation</strong> ensures that tool arguments meet your requirements before processing begins. This prevents runtime errors and provides clear feedback when users provide invalid data.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab03-mcp-tools-__codelineno-32-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">validateInput</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#lab03-mcp-tools-__codelineno-32-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">args</span><span class="p">.</span><span class="nx">filepath</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="ow">typeof</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">filepath</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;string&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#lab03-mcp-tools-__codelineno-32-3"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;filepath must be a non-empty string&quot;</span><span class="p">);</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#lab03-mcp-tools-__codelineno-32-4"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#lab03-mcp-tools-__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#lab03-mcp-tools-__codelineno-32-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">maxSize</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">10485760</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#lab03-mcp-tools-__codelineno-32-7"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;maxSize must be between 1 and 10485760 bytes&quot;</span><span class="p">);</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#lab03-mcp-tools-__codelineno-32-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#lab03-mcp-tools-__codelineno-32-9"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> Always validate inputs before processing, even when using JSON Schema validation. This pattern is essential for:</p>
<ul>
<li>Type checking beyond JSON Schema capabilities</li>
<li>Business logic validation (file size limits, path security)</li>
<li>Preventing runtime errors from malformed data</li>
<li>Providing specific, actionable error messages</li>
</ul>
<p><strong>Why it matters:</strong> Early validation fails fast and gives users clear guidance on how to fix their input.</p>
<h3 id="lab03-mcp-tools-pattern-2-graceful-degradation">Pattern 2: Graceful Degradation<a class="headerlink" href="#lab03-mcp-tools-pattern-2-graceful-degradation" title="Permanent link">&para;</a></h3>
<p><strong>Graceful degradation</strong> provides partial functionality when full operation isn&rsquo;t possible. Instead of failing completely, the tool returns useful information or falls back to alternative approaches.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab03-mcp-tools-__codelineno-33-1"></a><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab03-mcp-tools-__codelineno-33-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fetchFromAPI</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#lab03-mcp-tools-__codelineno-33-3"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">formatSuccess</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#lab03-mcp-tools-__codelineno-33-4"></a><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#lab03-mcp-tools-__codelineno-33-5"></a><span class="w">  </span><span class="c1">// Log error but return partial results if possible</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#lab03-mcp-tools-__codelineno-33-6"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;API call failed:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#lab03-mcp-tools-__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#lab03-mcp-tools-__codelineno-33-8"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#lab03-mcp-tools-__codelineno-33-9"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#lab03-mcp-tools-__codelineno-33-10"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#lab03-mcp-tools-__codelineno-33-11"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#lab03-mcp-tools-__codelineno-33-12"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;‚ö†Ô∏è Could not fetch live data. Using cached results...&quot;</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#lab03-mcp-tools-__codelineno-33-13"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#lab03-mcp-tools-__codelineno-33-14"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#lab03-mcp-tools-__codelineno-33-15"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#lab03-mcp-tools-__codelineno-33-16"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For external dependencies that might be unreliable:</p>
<ul>
<li>API calls that could timeout or fail</li>
<li>Network-dependent operations</li>
<li>Services with occasional downtime</li>
<li>When partial results are better than no results</li>
</ul>
<p><strong>Why it matters:</strong> Users get some value even when systems are partially broken, improving overall reliability and user experience.</p>
<h3 id="lab03-mcp-tools-pattern-3-detailed-error-context">Pattern 3: Detailed Error Context<a class="headerlink" href="#lab03-mcp-tools-pattern-3-detailed-error-context" title="Permanent link">&para;</a></h3>
<p><strong>Detailed error context</strong> provides comprehensive information for debugging while keeping user-facing messages clean. Log full details internally but expose only safe, helpful information to users.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab03-mcp-tools-__codelineno-34-1"></a><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#lab03-mcp-tools-__codelineno-34-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorMessage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="p">;</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#lab03-mcp-tools-__codelineno-34-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errorContext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#lab03-mcp-tools-__codelineno-34-4"></a><span class="w">    </span><span class="nx">tool</span><span class="o">:</span><span class="w"> </span><span class="kt">name</span><span class="p">,</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#lab03-mcp-tools-__codelineno-34-5"></a><span class="w">    </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="p">,</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#lab03-mcp-tools-__codelineno-34-6"></a><span class="w">    </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#lab03-mcp-tools-__codelineno-34-7"></a><span class="w">    </span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">errorMessage</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#lab03-mcp-tools-__codelineno-34-8"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#lab03-mcp-tools-__codelineno-34-9"></a>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#lab03-mcp-tools-__codelineno-34-10"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[Tool Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">errorContext</span><span class="p">));</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#lab03-mcp-tools-__codelineno-34-11"></a>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#lab03-mcp-tools-__codelineno-34-12"></a><span class="w">  </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#lab03-mcp-tools-__codelineno-34-13"></a><span class="w">    </span><span class="sb">`Tool &#39;</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">&#39; failed: </span><span class="si">${</span><span class="nx">errorMessage</span><span class="si">}</span><span class="sb">. Check server logs for details.`</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#lab03-mcp-tools-__codelineno-34-14"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#lab03-mcp-tools-__codelineno-34-15"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For complex operations where debugging might be needed:</p>
<ul>
<li>Multi-step processes with potential failure points</li>
<li>Operations involving external systems</li>
<li>When you need to track error patterns over time</li>
<li>Production environments where detailed logging is crucial</li>
</ul>
<p><strong>Why it matters:</strong> Developers can diagnose issues effectively while users get clear, non-technical error messages.</p>
<p><br></p>
<h4 id="lab03-mcp-tools-best-practices-for-error-handling"><strong>Best Practices for Error Handling:</strong><a class="headerlink" href="#lab03-mcp-tools-best-practices-for-error-handling" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Fail Fast:</strong> Validate inputs early and stop processing on critical errors</li>
<li><strong>Log Internally:</strong> Use <code>console.error()</code> for detailed logging (goes to stderr, not stdout)</li>
<li><strong>User-Friendly Messages:</strong> Keep error messages clear and actionable</li>
<li><strong>Don&rsquo;t Leak Sensitive Data:</strong> Never expose file paths, credentials, or internal details</li>
<li><strong>Consistent Format:</strong> Use similar error message patterns across tools</li>
<li><strong>Recovery Options:</strong> When possible, suggest how users can resolve the issue</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-async-operations-and-performance">Async Operations and Performance<a class="headerlink" href="#lab03-mcp-tools-async-operations-and-performance" title="Permanent link">&para;</a></h2>
<p>MCP tools often need to handle asynchronous operations and optimize performance. Long-running tasks require special handling to prevent timeouts and provide feedback, while expensive operations benefit from caching to improve response times and reduce resource usage.</p>
<h3 id="lab03-mcp-tools-long-running-operations">Long-Running Operations<a class="headerlink" href="#lab03-mcp-tools-long-running-operations" title="Permanent link">&para;</a></h3>
<p><strong>Long-running operations</strong> need monitoring and progress feedback to prevent timeouts and keep users informed. Use logging and timing to track operation progress and provide completion status.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab03-mcp-tools-__codelineno-35-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;analyze_large_file&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab03-mcp-tools-__codelineno-35-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">filepath</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#lab03-mcp-tools-__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#lab03-mcp-tools-__codelineno-35-4"></a><span class="w">  </span><span class="c1">// For very long operations, consider streaming or progress updates</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#lab03-mcp-tools-__codelineno-35-5"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[INFO] Starting analysis of </span><span class="si">${</span><span class="nx">filepath</span><span class="si">}</span><span class="sb">...`</span><span class="p">);</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#lab03-mcp-tools-__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#lab03-mcp-tools-__codelineno-35-7"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#lab03-mcp-tools-__codelineno-35-8"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#lab03-mcp-tools-__codelineno-35-9"></a>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#lab03-mcp-tools-__codelineno-35-10"></a><span class="w">    </span><span class="c1">// Perform analysis</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#lab03-mcp-tools-__codelineno-35-11"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">performLongAnalysis</span><span class="p">(</span><span class="nx">filepath</span><span class="p">);</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#lab03-mcp-tools-__codelineno-35-12"></a>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#lab03-mcp-tools-__codelineno-35-13"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">duration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="p">;</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#lab03-mcp-tools-__codelineno-35-14"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[INFO] Analysis completed in </span><span class="si">${</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#lab03-mcp-tools-__codelineno-35-15"></a>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#lab03-mcp-tools-__codelineno-35-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#lab03-mcp-tools-__codelineno-35-17"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#lab03-mcp-tools-__codelineno-35-18"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#lab03-mcp-tools-__codelineno-35-19"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#lab03-mcp-tools-__codelineno-35-20"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Analysis Results (completed in </span><span class="si">${</span><span class="nx">duration</span><span class="si">}</span><span class="sb">ms):\n\n</span><span class="si">${</span><span class="nx">result</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#lab03-mcp-tools-__codelineno-35-21"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#lab03-mcp-tools-__codelineno-35-22"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#lab03-mcp-tools-__codelineno-35-23"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#lab03-mcp-tools-__codelineno-35-24"></a>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#lab03-mcp-tools-__codelineno-35-25"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#lab03-mcp-tools-__codelineno-35-26"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`[ERROR] Analysis failed after </span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">startTime</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#lab03-mcp-tools-__codelineno-35-27"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="nx">error</span><span class="p">;</span>
</span><span id="__span-35-28"><a id="__codelineno-35-28" name="__codelineno-35-28" href="#lab03-mcp-tools-__codelineno-35-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-35-29"><a id="__codelineno-35-29" name="__codelineno-35-29" href="#lab03-mcp-tools-__codelineno-35-29"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For operations that take more than a few seconds:</p>
<ul>
<li>Large file processing or analysis</li>
<li>Complex computations</li>
<li>External API calls with potential delays</li>
<li>Batch operations on multiple items</li>
</ul>
<p><strong>Why it matters:</strong> Prevents timeouts, provides user feedback, enables monitoring and debugging of slow operations.</p>
<h3 id="lab03-mcp-tools-caching-results">Caching Results<a class="headerlink" href="#lab03-mcp-tools-caching-results" title="Permanent link">&para;</a></h3>
<p><strong>Caching results</strong> stores expensive operation results to avoid redundant computation. Use time-based expiration and proper cache keys for efficient reuse of results.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#lab03-mcp-tools-__codelineno-36-1"></a><span class="kd">class</span><span class="w"> </span><span class="nx">CachedMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#lab03-mcp-tools-__codelineno-36-2"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span><span class="w"> </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#lab03-mcp-tools-__codelineno-36-3"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 minute</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#lab03-mcp-tools-__codelineno-36-4"></a>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#lab03-mcp-tools-__codelineno-36-5"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#lab03-mcp-tools-__codelineno-36-6"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#lab03-mcp-tools-__codelineno-36-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#lab03-mcp-tools-__codelineno-36-8"></a>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#lab03-mcp-tools-__codelineno-36-9"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getCacheKey</span><span class="p">(</span><span class="nx">toolName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#lab03-mcp-tools-__codelineno-36-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">toolName</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#lab03-mcp-tools-__codelineno-36-11"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#lab03-mcp-tools-__codelineno-36-12"></a>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#lab03-mcp-tools-__codelineno-36-13"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getCached</span><span class="p">(</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#lab03-mcp-tools-__codelineno-36-14"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#lab03-mcp-tools-__codelineno-36-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#lab03-mcp-tools-__codelineno-36-16"></a>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#lab03-mcp-tools-__codelineno-36-17"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cacheTTL</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-18"><a id="__codelineno-36-18" name="__codelineno-36-18" href="#lab03-mcp-tools-__codelineno-36-18"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-36-19"><a id="__codelineno-36-19" name="__codelineno-36-19" href="#lab03-mcp-tools-__codelineno-36-19"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-36-20"><a id="__codelineno-36-20" name="__codelineno-36-20" href="#lab03-mcp-tools-__codelineno-36-20"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-36-21"><a id="__codelineno-36-21" name="__codelineno-36-21" href="#lab03-mcp-tools-__codelineno-36-21"></a>
</span><span id="__span-36-22"><a id="__codelineno-36-22" name="__codelineno-36-22" href="#lab03-mcp-tools-__codelineno-36-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span id="__span-36-23"><a id="__codelineno-36-23" name="__codelineno-36-23" href="#lab03-mcp-tools-__codelineno-36-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-24"><a id="__codelineno-36-24" name="__codelineno-36-24" href="#lab03-mcp-tools-__codelineno-36-24"></a>
</span><span id="__span-36-25"><a id="__codelineno-36-25" name="__codelineno-36-25" href="#lab03-mcp-tools-__codelineno-36-25"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setCache</span><span class="p">(</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-26"><a id="__codelineno-36-26" name="__codelineno-36-26" href="#lab03-mcp-tools-__codelineno-36-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-36-27"><a id="__codelineno-36-27" name="__codelineno-36-27" href="#lab03-mcp-tools-__codelineno-36-27"></a><span class="w">      </span><span class="nx">data</span><span class="p">,</span>
</span><span id="__span-36-28"><a id="__codelineno-36-28" name="__codelineno-36-28" href="#lab03-mcp-tools-__codelineno-36-28"></a><span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span>
</span><span id="__span-36-29"><a id="__codelineno-36-29" name="__codelineno-36-29" href="#lab03-mcp-tools-__codelineno-36-29"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-36-30"><a id="__codelineno-36-30" name="__codelineno-36-30" href="#lab03-mcp-tools-__codelineno-36-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-36-31"><a id="__codelineno-36-31" name="__codelineno-36-31" href="#lab03-mcp-tools-__codelineno-36-31"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For expensive operations that return consistent results:</p>
<ul>
<li>API calls to external services</li>
<li>Complex calculations or data processing</li>
<li>Database queries with static data</li>
<li>File analysis that doesn&rsquo;t change frequently</li>
</ul>
<p><strong>Why it matters:</strong> Dramatically improves response times, reduces resource usage, and provides better user experience for repeated requests.</p>
<h4 id="lab03-mcp-tools-best-practices-for-async-operations-and-performance"><strong>Best Practices for Async Operations and Performance:</strong><a class="headerlink" href="#lab03-mcp-tools-best-practices-for-async-operations-and-performance" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Monitor Execution Time:</strong> Log start/end times for operations over 1 second</li>
<li><strong>Set Reasonable Timeouts:</strong> Use appropriate timeouts for external calls (5-30 seconds)</li>
<li><strong>Cache Strategically:</strong> Cache expensive operations but consider data freshness</li>
<li><strong>Use Streaming:</strong> For very large responses, consider streaming or pagination</li>
<li><strong>Resource Cleanup:</strong> Always clean up connections, file handles, and memory</li>
<li><strong>Progress Feedback:</strong> For long operations, provide progress updates via logging</li>
<li><strong>Memory Management:</strong> Be mindful of memory usage in long-running processes</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-tool-composition">Tool Composition<a class="headerlink" href="#lab03-mcp-tools-tool-composition" title="Permanent link">&para;</a></h2>
<p><strong>Tool composition</strong> is the art of designing MCP tools that work seamlessly together, allowing LLMs to chain multiple tools to accomplish complex tasks. Well-composed tools create a powerful ecosystem where each tool handles a specific responsibility while enabling sophisticated workflows through intelligent combination.</p>
<h3 id="lab03-mcp-tools-example-multi-step-analysis">Example: Multi-Step Analysis<a class="headerlink" href="#lab03-mcp-tools-example-multi-step-analysis" title="Permanent link">&para;</a></h3>
<p><strong>Multi-step analysis</strong> demonstrates how simple, focused tools can be combined to perform complex data processing workflows. Each tool has a clear responsibility and can be used independently or as part of larger operations.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#lab03-mcp-tools-__codelineno-37-1"></a><span class="c1">// Tool 1: List files</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#lab03-mcp-tools-__codelineno-37-2"></a><span class="p">{</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#lab03-mcp-tools-__codelineno-37-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_files&quot;</span><span class="p">,</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#lab03-mcp-tools-__codelineno-37-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List files in a directory&quot;</span><span class="p">,</span>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#lab03-mcp-tools-__codelineno-37-5"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#lab03-mcp-tools-__codelineno-37-6"></a><span class="p">}</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#lab03-mcp-tools-__codelineno-37-7"></a>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#lab03-mcp-tools-__codelineno-37-8"></a><span class="c1">// Tool 2: Read file</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#lab03-mcp-tools-__codelineno-37-9"></a><span class="p">{</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#lab03-mcp-tools-__codelineno-37-10"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;read_file&quot;</span><span class="p">,</span>
</span><span id="__span-37-11"><a id="__codelineno-37-11" name="__codelineno-37-11" href="#lab03-mcp-tools-__codelineno-37-11"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Read a specific file&quot;</span><span class="p">,</span>
</span><span id="__span-37-12"><a id="__codelineno-37-12" name="__codelineno-37-12" href="#lab03-mcp-tools-__codelineno-37-12"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-37-13"><a id="__codelineno-37-13" name="__codelineno-37-13" href="#lab03-mcp-tools-__codelineno-37-13"></a><span class="p">}</span>
</span><span id="__span-37-14"><a id="__codelineno-37-14" name="__codelineno-37-14" href="#lab03-mcp-tools-__codelineno-37-14"></a>
</span><span id="__span-37-15"><a id="__codelineno-37-15" name="__codelineno-37-15" href="#lab03-mcp-tools-__codelineno-37-15"></a><span class="c1">// Tool 3: Analyze content</span>
</span><span id="__span-37-16"><a id="__codelineno-37-16" name="__codelineno-37-16" href="#lab03-mcp-tools-__codelineno-37-16"></a><span class="p">{</span>
</span><span id="__span-37-17"><a id="__codelineno-37-17" name="__codelineno-37-17" href="#lab03-mcp-tools-__codelineno-37-17"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;analyze_text&quot;</span><span class="p">,</span>
</span><span id="__span-37-18"><a id="__codelineno-37-18" name="__codelineno-37-18" href="#lab03-mcp-tools-__codelineno-37-18"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analyze text content&quot;</span><span class="p">,</span>
</span><span id="__span-37-19"><a id="__codelineno-37-19" name="__codelineno-37-19" href="#lab03-mcp-tools-__codelineno-37-19"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-37-20"><a id="__codelineno-37-20" name="__codelineno-37-20" href="#lab03-mcp-tools-__codelineno-37-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For workflows that require multiple processing steps:</p>
<ul>
<li>Data analysis pipelines</li>
<li>File processing workflows</li>
<li>Multi-stage computations</li>
<li>Complex research tasks</li>
</ul>
<p><strong>Why it matters:</strong> Breaks down complex problems into manageable, reusable components that can be combined in flexible ways.</p>
<h3 id="lab03-mcp-tools-llm-tool-chaining">LLM Tool Chaining<a class="headerlink" href="#lab03-mcp-tools-llm-tool-chaining" title="Permanent link">&para;</a></h3>
<p><strong>LLM tool chaining</strong> allows AI models to automatically sequence tool calls based on intermediate results. The LLM analyzes outputs from one tool and determines which tool to call next, creating intelligent workflows without explicit programming.</p>
<p>The LLM can chain these tools:</p>
<ol>
<li><strong>List files in directory</strong> - Discover available files</li>
<li><strong>Read interesting files</strong> - Access content based on filenames</li>
<li><strong>Analyze their content</strong> - Process and extract insights</li>
</ol>
<p><strong>When to use -</strong> When tasks naturally break down into sequential steps:</p>
<ul>
<li>Research and analysis workflows</li>
<li>Data processing pipelines</li>
<li>Content generation chains</li>
<li>Problem-solving sequences</li>
</ul>
<p><strong>Why it matters:</strong> Enables complex, multi-step reasoning and problem-solving that would be difficult to implement in single tools.</p>
<h3 id="lab03-mcp-tools-testing-composed-tools">Testing Composed Tools<a class="headerlink" href="#lab03-mcp-tools-testing-composed-tools" title="Permanent link">&para;</a></h3>
<p><strong>Testing composed tools</strong> ensures that individual tools work correctly both in isolation and when chained together. Use comprehensive test suites that cover single-tool usage and multi-tool workflows.</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#lab03-mcp-tools-__codelineno-38-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">describe</span><span class="p">,</span><span class="w"> </span><span class="nx">it</span><span class="p">,</span><span class="w"> </span><span class="nx">expect</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;vitest&#39;</span><span class="p">;</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#lab03-mcp-tools-__codelineno-38-2"></a>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#lab03-mcp-tools-__codelineno-38-3"></a><span class="nx">describe</span><span class="p">(</span><span class="s1">&#39;Weather Tool&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#lab03-mcp-tools-__codelineno-38-4"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should validate city name&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#lab03-mcp-tools-__codelineno-38-5"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#lab03-mcp-tools-__codelineno-38-6"></a><span class="w">      </span><span class="nx">callTool</span><span class="p">(</span><span class="s1">&#39;get_weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#lab03-mcp-tools-__codelineno-38-7"></a><span class="w">    </span><span class="p">).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;City name cannot be empty&#39;</span><span class="p">);</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#lab03-mcp-tools-__codelineno-38-8"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#lab03-mcp-tools-__codelineno-38-9"></a>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#lab03-mcp-tools-__codelineno-38-10"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should handle invalid city&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#lab03-mcp-tools-__codelineno-38-11"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">expect</span><span class="p">(</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#lab03-mcp-tools-__codelineno-38-12"></a><span class="w">      </span><span class="nx">callTool</span><span class="p">(</span><span class="s1">&#39;get_weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;InvalidCity12345&#39;</span><span class="w"> </span><span class="p">})</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#lab03-mcp-tools-__codelineno-38-13"></a><span class="w">    </span><span class="p">).</span><span class="nx">rejects</span><span class="p">.</span><span class="nx">toThrow</span><span class="p">(</span><span class="s1">&#39;not found&#39;</span><span class="p">);</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#lab03-mcp-tools-__codelineno-38-14"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#lab03-mcp-tools-__codelineno-38-15"></a>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#lab03-mcp-tools-__codelineno-38-16"></a><span class="w">  </span><span class="nx">it</span><span class="p">(</span><span class="s1">&#39;should return weather data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#lab03-mcp-tools-__codelineno-38-17"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">callTool</span><span class="p">(</span><span class="s1">&#39;get_weather&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#lab03-mcp-tools-__codelineno-38-18"></a><span class="w">      </span><span class="nx">city</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;London&#39;</span><span class="p">,</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#lab03-mcp-tools-__codelineno-38-19"></a><span class="w">      </span><span class="nx">units</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;celsius&#39;</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#lab03-mcp-tools-__codelineno-38-20"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#lab03-mcp-tools-__codelineno-38-21"></a>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#lab03-mcp-tools-__codelineno-38-22"></a><span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">content</span><span class="p">).</span><span class="nx">toHaveLength</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#lab03-mcp-tools-__codelineno-38-23"></a><span class="w">    </span><span class="nx">expect</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">content</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">text</span><span class="p">).</span><span class="nx">toContain</span><span class="p">(</span><span class="s1">&#39;Temperature&#39;</span><span class="p">);</span>
</span><span id="__span-38-24"><a id="__codelineno-38-24" name="__codelineno-38-24" href="#lab03-mcp-tools-__codelineno-38-24"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-38-25"><a id="__codelineno-38-25" name="__codelineno-38-25" href="#lab03-mcp-tools-__codelineno-38-25"></a><span class="p">});</span>
</span></code></pre></div>
<p><strong>When to use -</strong> For validating tool behavior in different scenarios:</p>
<ul>
<li>Unit testing individual tools</li>
<li>Integration testing tool chains</li>
<li>Regression testing after changes</li>
<li>Edge case validation</li>
</ul>
<p><strong>Why it matters:</strong> Ensures reliability and predictability when tools are used individually or in combination.</p>
<h4 id="lab03-mcp-tools-best-practices-for-tool-composition"><strong>Best Practices for Tool Composition:</strong><a class="headerlink" href="#lab03-mcp-tools-best-practices-for-tool-composition" title="Permanent link">&para;</a></h4>
<ul>
<li><strong>Single Responsibility:</strong> Each tool should do one thing well</li>
<li><strong>Consistent Interfaces:</strong> Use similar parameter patterns across tools</li>
<li><strong>Clear Dependencies:</strong> Document which tools work well together</li>
<li><strong>Error Propagation:</strong> Handle failures gracefully in tool chains</li>
<li><strong>State Management:</strong> Avoid tools that require complex state between calls</li>
<li><strong>Flexible Outputs:</strong> Design tool outputs to be usable as inputs for other tools</li>
<li><strong>Documentation:</strong> Clearly explain how tools can be combined</li>
<li><strong>Version Compatibility:</strong> Ensure tool interfaces remain stable</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-best-practices-checklist">Best Practices Checklist<a class="headerlink" href="#lab03-mcp-tools-best-practices-checklist" title="Permanent link">&para;</a></h2>
<p>‚úÖ <strong>Schema Design</strong></p>
<ul>
<li>Use descriptive names and descriptions</li>
<li>Add examples in descriptions</li>
<li>Set reasonable defaults</li>
<li>Use enums for constrained values</li>
<li>Add min/max for numbers</li>
</ul>
<p>‚úÖ <strong>Implementation</strong></p>
<ul>
<li>Validate all inputs, even with schemas</li>
<li>Handle errors gracefully</li>
<li>Log to stderr, not stdout</li>
<li>Use async/await properly</li>
<li>Clean up resources (file handles, connections)</li>
</ul>
<p>‚úÖ <strong>Security</strong></p>
<ul>
<li>Validate and sanitize file paths</li>
<li>Use prepared statements for SQL</li>
<li>Limit resource usage (file sizes, API calls)</li>
<li>Don&rsquo;t expose sensitive data in errors</li>
<li>Implement rate limiting</li>
</ul>
<p>‚úÖ <strong>Performance</strong></p>
<ul>
<li>Cache expensive operations</li>
<li>Set reasonable timeouts</li>
<li>Limit result sizes</li>
<li>Use streaming for large data</li>
<li>Monitor execution time</li>
</ul>
<p>‚úÖ <strong>User Experience</strong></p>
<ul>
<li>Provide clear error messages</li>
<li>Return structured data when possible</li>
<li>Include relevant context in responses</li>
<li>Handle edge cases gracefully</li>
<li>Document expected behavior</li>
</ul>
<hr />
<h2 id="lab03-mcp-tools-hands-on-exercises">Hands-On Exercises<a class="headerlink" href="#lab03-mcp-tools-hands-on-exercises" title="Permanent link">&para;</a></h2>
<h3 id="lab03-mcp-tools-exercise-1-text-processing-tool">Exercise 1: Text Processing Tool<a class="headerlink" href="#lab03-mcp-tools-exercise-1-text-processing-tool" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Counts words, characters, lines</li>
<li>Finds specific patterns</li>
<li>Calculates reading time</li>
<li>Detects language</li>
</ul>
<details>
<summary>üí° Solution: Text Processing Tool</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#lab03-mcp-tools-__codelineno-39-1"></a><span class="p">{</span>
</span><span id="__span-39-2"><a id="__codelineno-39-2" name="__codelineno-39-2" href="#lab03-mcp-tools-__codelineno-39-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;process_text&quot;</span><span class="p">,</span>
</span><span id="__span-39-3"><a id="__codelineno-39-3" name="__codelineno-39-3" href="#lab03-mcp-tools-__codelineno-39-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analyze and process text content with various metrics and operations&quot;</span><span class="p">,</span>
</span><span id="__span-39-4"><a id="__codelineno-39-4" name="__codelineno-39-4" href="#lab03-mcp-tools-__codelineno-39-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-5"><a id="__codelineno-39-5" name="__codelineno-39-5" href="#lab03-mcp-tools-__codelineno-39-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-39-6"><a id="__codelineno-39-6" name="__codelineno-39-6" href="#lab03-mcp-tools-__codelineno-39-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-7"><a id="__codelineno-39-7" name="__codelineno-39-7" href="#lab03-mcp-tools-__codelineno-39-7"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-8"><a id="__codelineno-39-8" name="__codelineno-39-8" href="#lab03-mcp-tools-__codelineno-39-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-39-9"><a id="__codelineno-39-9" name="__codelineno-39-9" href="#lab03-mcp-tools-__codelineno-39-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The text content to process&quot;</span>
</span><span id="__span-39-10"><a id="__codelineno-39-10" name="__codelineno-39-10" href="#lab03-mcp-tools-__codelineno-39-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-39-11"><a id="__codelineno-39-11" name="__codelineno-39-11" href="#lab03-mcp-tools-__codelineno-39-11"></a><span class="w">      </span><span class="nx">operations</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-12"><a id="__codelineno-39-12" name="__codelineno-39-12" href="#lab03-mcp-tools-__codelineno-39-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-39-13"><a id="__codelineno-39-13" name="__codelineno-39-13" href="#lab03-mcp-tools-__codelineno-39-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Operations to perform&quot;</span><span class="p">,</span>
</span><span id="__span-39-14"><a id="__codelineno-39-14" name="__codelineno-39-14" href="#lab03-mcp-tools-__codelineno-39-14"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-15"><a id="__codelineno-39-15" name="__codelineno-39-15" href="#lab03-mcp-tools-__codelineno-39-15"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-39-16"><a id="__codelineno-39-16" name="__codelineno-39-16" href="#lab03-mcp-tools-__codelineno-39-16"></a><span class="w">          </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;find_pattern&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;reading_time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;detect_language&quot;</span><span class="p">]</span>
</span><span id="__span-39-17"><a id="__codelineno-39-17" name="__codelineno-39-17" href="#lab03-mcp-tools-__codelineno-39-17"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-39-18"><a id="__codelineno-39-18" name="__codelineno-39-18" href="#lab03-mcp-tools-__codelineno-39-18"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span>
</span><span id="__span-39-19"><a id="__codelineno-39-19" name="__codelineno-39-19" href="#lab03-mcp-tools-__codelineno-39-19"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-39-20"><a id="__codelineno-39-20" name="__codelineno-39-20" href="#lab03-mcp-tools-__codelineno-39-20"></a><span class="w">      </span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-39-21"><a id="__codelineno-39-21" name="__codelineno-39-21" href="#lab03-mcp-tools-__codelineno-39-21"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-39-22"><a id="__codelineno-39-22" name="__codelineno-39-22" href="#lab03-mcp-tools-__codelineno-39-22"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Regex pattern for find_pattern operation&quot;</span>
</span><span id="__span-39-23"><a id="__codelineno-39-23" name="__codelineno-39-23" href="#lab03-mcp-tools-__codelineno-39-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-39-24"><a id="__codelineno-39-24" name="__codelineno-39-24" href="#lab03-mcp-tools-__codelineno-39-24"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-39-25"><a id="__codelineno-39-25" name="__codelineno-39-25" href="#lab03-mcp-tools-__codelineno-39-25"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">]</span>
</span><span id="__span-39-26"><a id="__codelineno-39-26" name="__codelineno-39-26" href="#lab03-mcp-tools-__codelineno-39-26"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-39-27"><a id="__codelineno-39-27" name="__codelineno-39-27" href="#lab03-mcp-tools-__codelineno-39-27"></a><span class="p">}</span>
</span></code></pre></div>

Implementation - Add this handler in your "CallToolRequestSchema" handler:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#lab03-mcp-tools-__codelineno-40-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;process_text&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#lab03-mcp-tools-__codelineno-40-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#lab03-mcp-tools-__codelineno-40-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">text</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">text</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#lab03-mcp-tools-__codelineno-40-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">operations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">operations</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">[])</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">];</span>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#lab03-mcp-tools-__codelineno-40-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pattern</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">pattern</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#lab03-mcp-tools-__codelineno-40-6"></a>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#lab03-mcp-tools-__codelineno-40-7"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">results</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#lab03-mcp-tools-__codelineno-40-8"></a>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#lab03-mcp-tools-__codelineno-40-9"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">op</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">operations</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-10"><a id="__codelineno-40-10" name="__codelineno-40-10" href="#lab03-mcp-tools-__codelineno-40-10"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">op</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-11"><a id="__codelineno-40-11" name="__codelineno-40-11" href="#lab03-mcp-tools-__codelineno-40-11"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;count&quot;</span><span class="o">:</span>
</span><span id="__span-40-12"><a id="__codelineno-40-12" name="__codelineno-40-12" href="#lab03-mcp-tools-__codelineno-40-12"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-13"><a id="__codelineno-40-13" name="__codelineno-40-13" href="#lab03-mcp-tools-__codelineno-40-13"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">words</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-14"><a id="__codelineno-40-14" name="__codelineno-40-14" href="#lab03-mcp-tools-__codelineno-40-14"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">chars</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-15"><a id="__codelineno-40-15" name="__codelineno-40-15" href="#lab03-mcp-tools-__codelineno-40-15"></a><span class="w">          </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`üìä Text Statistics:\n- Lines: </span><span class="si">${</span><span class="nx">lines</span><span class="si">}</span><span class="sb">\n- Words: </span><span class="si">${</span><span class="nx">words</span><span class="si">}</span><span class="sb">\n- Characters: </span><span class="si">${</span><span class="nx">chars</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-40-16"><a id="__codelineno-40-16" name="__codelineno-40-16" href="#lab03-mcp-tools-__codelineno-40-16"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-17"><a id="__codelineno-40-17" name="__codelineno-40-17" href="#lab03-mcp-tools-__codelineno-40-17"></a>
</span><span id="__span-40-18"><a id="__codelineno-40-18" name="__codelineno-40-18" href="#lab03-mcp-tools-__codelineno-40-18"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;find_pattern&quot;</span><span class="o">:</span>
</span><span id="__span-40-19"><a id="__codelineno-40-19" name="__codelineno-40-19" href="#lab03-mcp-tools-__codelineno-40-19"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-20"><a id="__codelineno-40-20" name="__codelineno-40-20" href="#lab03-mcp-tools-__codelineno-40-20"></a><span class="w">            </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s2">&quot;‚ùå Pattern required for find_pattern operation&quot;</span><span class="p">);</span>
</span><span id="__span-40-21"><a id="__codelineno-40-21" name="__codelineno-40-21" href="#lab03-mcp-tools-__codelineno-40-21"></a><span class="w">            </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-22"><a id="__codelineno-40-22" name="__codelineno-40-22" href="#lab03-mcp-tools-__codelineno-40-22"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-40-23"><a id="__codelineno-40-23" name="__codelineno-40-23" href="#lab03-mcp-tools-__codelineno-40-23"></a><span class="w">          </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-24"><a id="__codelineno-40-24" name="__codelineno-40-24" href="#lab03-mcp-tools-__codelineno-40-24"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="nx">pattern</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;g&#39;</span><span class="p">);</span>
</span><span id="__span-40-25"><a id="__codelineno-40-25" name="__codelineno-40-25" href="#lab03-mcp-tools-__codelineno-40-25"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">matches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">regex</span><span class="p">);</span>
</span><span id="__span-40-26"><a id="__codelineno-40-26" name="__codelineno-40-26" href="#lab03-mcp-tools-__codelineno-40-26"></a><span class="w">            </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`üîç Pattern Matches (</span><span class="si">${</span><span class="nx">pattern</span><span class="si">}</span><span class="sb">):\nFound </span><span class="si">${</span><span class="nx">matches</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">matches.length</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">0</span><span class="si">}</span><span class="sb"> matches:\n</span><span class="si">${</span><span class="nx">matches</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">matches</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-40-27"><a id="__codelineno-40-27" name="__codelineno-40-27" href="#lab03-mcp-tools-__codelineno-40-27"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-28"><a id="__codelineno-40-28" name="__codelineno-40-28" href="#lab03-mcp-tools-__codelineno-40-28"></a><span class="w">            </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`‚ùå Invalid regex pattern: </span><span class="si">${</span><span class="nx">pattern</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-40-29"><a id="__codelineno-40-29" name="__codelineno-40-29" href="#lab03-mcp-tools-__codelineno-40-29"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-40-30"><a id="__codelineno-40-30" name="__codelineno-40-30" href="#lab03-mcp-tools-__codelineno-40-30"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-31"><a id="__codelineno-40-31" name="__codelineno-40-31" href="#lab03-mcp-tools-__codelineno-40-31"></a>
</span><span id="__span-40-32"><a id="__codelineno-40-32" name="__codelineno-40-32" href="#lab03-mcp-tools-__codelineno-40-32"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;reading_time&quot;</span><span class="o">:</span>
</span><span id="__span-40-33"><a id="__codelineno-40-33" name="__codelineno-40-33" href="#lab03-mcp-tools-__codelineno-40-33"></a><span class="w">          </span><span class="c1">// Average reading speed: 200 words per minute</span>
</span><span id="__span-40-34"><a id="__codelineno-40-34" name="__codelineno-40-34" href="#lab03-mcp-tools-__codelineno-40-34"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">wordCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">text</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nx">w</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">w</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-35"><a id="__codelineno-40-35" name="__codelineno-40-35" href="#lab03-mcp-tools-__codelineno-40-35"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">readingTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="nx">wordCount</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">200</span><span class="p">);</span>
</span><span id="__span-40-36"><a id="__codelineno-40-36" name="__codelineno-40-36" href="#lab03-mcp-tools-__codelineno-40-36"></a><span class="w">          </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`‚è±Ô∏è Reading Time: Approximately </span><span class="si">${</span><span class="nx">readingTime</span><span class="si">}</span><span class="sb"> minute</span><span class="si">${</span><span class="nx">readingTime</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="mf">1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;s&#39;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">wordCount</span><span class="si">}</span><span class="sb"> words at 200 WPM)`</span><span class="p">);</span>
</span><span id="__span-40-37"><a id="__codelineno-40-37" name="__codelineno-40-37" href="#lab03-mcp-tools-__codelineno-40-37"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-38"><a id="__codelineno-40-38" name="__codelineno-40-38" href="#lab03-mcp-tools-__codelineno-40-38"></a>
</span><span id="__span-40-39"><a id="__codelineno-40-39" name="__codelineno-40-39" href="#lab03-mcp-tools-__codelineno-40-39"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;detect_language&quot;</span><span class="o">:</span>
</span><span id="__span-40-40"><a id="__codelineno-40-40" name="__codelineno-40-40" href="#lab03-mcp-tools-__codelineno-40-40"></a><span class="w">          </span><span class="c1">// Simple language detection based on common words</span>
</span><span id="__span-40-41"><a id="__codelineno-40-41" name="__codelineno-40-41" href="#lab03-mcp-tools-__codelineno-40-41"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">englishWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/\b(the|and|or|but|in|on|at|to|for|of|with|by)\b/gi</span><span class="p">;</span>
</span><span id="__span-40-42"><a id="__codelineno-40-42" name="__codelineno-40-42" href="#lab03-mcp-tools-__codelineno-40-42"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">spanishWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/\b(el|la|los|las|y|o|pero|en|sobre|a|para|de|con|por)\b/gi</span><span class="p">;</span>
</span><span id="__span-40-43"><a id="__codelineno-40-43" name="__codelineno-40-43" href="#lab03-mcp-tools-__codelineno-40-43"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">frenchWords</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sr">/\b(le|la|les|et|ou|mais|dans|sur|√†|pour|de|avec|par)\b/gi</span><span class="p">;</span>
</span><span id="__span-40-44"><a id="__codelineno-40-44" name="__codelineno-40-44" href="#lab03-mcp-tools-__codelineno-40-44"></a>
</span><span id="__span-40-45"><a id="__codelineno-40-45" name="__codelineno-40-45" href="#lab03-mcp-tools-__codelineno-40-45"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">englishMatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">englishWords</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-46"><a id="__codelineno-40-46" name="__codelineno-40-46" href="#lab03-mcp-tools-__codelineno-40-46"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">spanishMatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">spanishWords</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-47"><a id="__codelineno-40-47" name="__codelineno-40-47" href="#lab03-mcp-tools-__codelineno-40-47"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">frenchMatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">frenchWords</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]).</span><span class="nx">length</span><span class="p">;</span>
</span><span id="__span-40-48"><a id="__codelineno-40-48" name="__codelineno-40-48" href="#lab03-mcp-tools-__codelineno-40-48"></a>
</span><span id="__span-40-49"><a id="__codelineno-40-49" name="__codelineno-40-49" href="#lab03-mcp-tools-__codelineno-40-49"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxMatches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">englishMatches</span><span class="p">,</span><span class="w"> </span><span class="nx">spanishMatches</span><span class="p">,</span><span class="w"> </span><span class="nx">frenchMatches</span><span class="p">);</span>
</span><span id="__span-40-50"><a id="__codelineno-40-50" name="__codelineno-40-50" href="#lab03-mcp-tools-__codelineno-40-50"></a><span class="w">          </span><span class="kd">let</span><span class="w"> </span><span class="nx">detectedLang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">;</span>
</span><span id="__span-40-51"><a id="__codelineno-40-51" name="__codelineno-40-51" href="#lab03-mcp-tools-__codelineno-40-51"></a>
</span><span id="__span-40-52"><a id="__codelineno-40-52" name="__codelineno-40-52" href="#lab03-mcp-tools-__codelineno-40-52"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">maxMatches</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-53"><a id="__codelineno-40-53" name="__codelineno-40-53" href="#lab03-mcp-tools-__codelineno-40-53"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">englishMatches</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">maxMatches</span><span class="p">)</span><span class="w"> </span><span class="nx">detectedLang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;English&quot;</span><span class="p">;</span>
</span><span id="__span-40-54"><a id="__codelineno-40-54" name="__codelineno-40-54" href="#lab03-mcp-tools-__codelineno-40-54"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">spanishMatches</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">maxMatches</span><span class="p">)</span><span class="w"> </span><span class="nx">detectedLang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Spanish&quot;</span><span class="p">;</span>
</span><span id="__span-40-55"><a id="__codelineno-40-55" name="__codelineno-40-55" href="#lab03-mcp-tools-__codelineno-40-55"></a><span class="w">            </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">frenchMatches</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">maxMatches</span><span class="p">)</span><span class="w"> </span><span class="nx">detectedLang</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;French&quot;</span><span class="p">;</span>
</span><span id="__span-40-56"><a id="__codelineno-40-56" name="__codelineno-40-56" href="#lab03-mcp-tools-__codelineno-40-56"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-40-57"><a id="__codelineno-40-57" name="__codelineno-40-57" href="#lab03-mcp-tools-__codelineno-40-57"></a>
</span><span id="__span-40-58"><a id="__codelineno-40-58" name="__codelineno-40-58" href="#lab03-mcp-tools-__codelineno-40-58"></a><span class="w">          </span><span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`üåç Detected Language: </span><span class="si">${</span><span class="nx">detectedLang</span><span class="si">}</span><span class="sb"> (confidence: </span><span class="si">${</span><span class="nx">maxMatches</span><span class="si">}</span><span class="sb"> common words)`</span><span class="p">);</span>
</span><span id="__span-40-59"><a id="__codelineno-40-59" name="__codelineno-40-59" href="#lab03-mcp-tools-__codelineno-40-59"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-40-60"><a id="__codelineno-40-60" name="__codelineno-40-60" href="#lab03-mcp-tools-__codelineno-40-60"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-40-61"><a id="__codelineno-40-61" name="__codelineno-40-61" href="#lab03-mcp-tools-__codelineno-40-61"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-40-62"><a id="__codelineno-40-62" name="__codelineno-40-62" href="#lab03-mcp-tools-__codelineno-40-62"></a>
</span><span id="__span-40-63"><a id="__codelineno-40-63" name="__codelineno-40-63" href="#lab03-mcp-tools-__codelineno-40-63"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-64"><a id="__codelineno-40-64" name="__codelineno-40-64" href="#lab03-mcp-tools-__codelineno-40-64"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-40-65"><a id="__codelineno-40-65" name="__codelineno-40-65" href="#lab03-mcp-tools-__codelineno-40-65"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-40-66"><a id="__codelineno-40-66" name="__codelineno-40-66" href="#lab03-mcp-tools-__codelineno-40-66"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-40-67"><a id="__codelineno-40-67" name="__codelineno-40-67" href="#lab03-mcp-tools-__codelineno-40-67"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">results.join</span><span class="p">(</span><span class="s1">&#39;\n\n&#39;</span><span class="p">)</span>
</span><span id="__span-40-68"><a id="__codelineno-40-68" name="__codelineno-40-68" href="#lab03-mcp-tools-__codelineno-40-68"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-40-69"><a id="__codelineno-40-69" name="__codelineno-40-69" href="#lab03-mcp-tools-__codelineno-40-69"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-40-70"><a id="__codelineno-40-70" name="__codelineno-40-70" href="#lab03-mcp-tools-__codelineno-40-70"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-40-71"><a id="__codelineno-40-71" name="__codelineno-40-71" href="#lab03-mcp-tools-__codelineno-40-71"></a>
</span><span id="__span-40-72"><a id="__codelineno-40-72" name="__codelineno-40-72" href="#lab03-mcp-tools-__codelineno-40-72"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-40-73"><a id="__codelineno-40-73" name="__codelineno-40-73" href="#lab03-mcp-tools-__codelineno-40-73"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Text processing failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-40-74"><a id="__codelineno-40-74" name="__codelineno-40-74" href="#lab03-mcp-tools-__codelineno-40-74"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-40-75"><a id="__codelineno-40-75" name="__codelineno-40-75" href="#lab03-mcp-tools-__codelineno-40-75"></a><span class="p">}</span>
</span></code></pre></div>

Testing - Test with different inputs:

<div class="language-javascript highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#lab03-mcp-tools-__codelineno-41-1"></a><span class="c1">// Basic counting</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#lab03-mcp-tools-__codelineno-41-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hello world\nThis is a test&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#lab03-mcp-tools-__codelineno-41-3"></a>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#lab03-mcp-tools-__codelineno-41-4"></a><span class="c1">// Pattern matching</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#lab03-mcp-tools-__codelineno-41-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;The quick brown fox jumps over the lazy dog&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;find_pattern&quot;</span><span class="p">],</span><span class="w"> </span><span class="nx">pattern</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;\\b\\w{4}\\b&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#lab03-mcp-tools-__codelineno-41-6"></a>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#lab03-mcp-tools-__codelineno-41-7"></a><span class="c1">// Multiple operations</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#lab03-mcp-tools-__codelineno-41-8"></a><span class="p">{</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;This is a longer piece of text to analyze for various metrics and patterns.&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">operations</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;count&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;reading_time&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;detect_language&quot;</span><span class="p">]</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>

</details>

<h3 id="lab03-mcp-tools-exercise-2-json-validator-tool">Exercise 2: JSON Validator Tool<a class="headerlink" href="#lab03-mcp-tools-exercise-2-json-validator-tool" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Validates JSON syntax</li>
<li>Validates against JSON Schema</li>
<li>Formats/pretty-prints JSON</li>
<li>Compares two JSON objects</li>
</ul>
<details>
<summary>üí° Solution: JSON Validator Tool</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#lab03-mcp-tools-__codelineno-42-1"></a><span class="p">{</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#lab03-mcp-tools-__codelineno-42-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;validate_json&quot;</span><span class="p">,</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#lab03-mcp-tools-__codelineno-42-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Validate, format, and compare JSON data&quot;</span><span class="p">,</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#lab03-mcp-tools-__codelineno-42-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#lab03-mcp-tools-__codelineno-42-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#lab03-mcp-tools-__codelineno-42-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#lab03-mcp-tools-__codelineno-42-7"></a><span class="w">      </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#lab03-mcp-tools-__codelineno-42-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#lab03-mcp-tools-__codelineno-42-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;JSON string to validate or format&quot;</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#lab03-mcp-tools-__codelineno-42-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#lab03-mcp-tools-__codelineno-42-11"></a><span class="w">      </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#lab03-mcp-tools-__codelineno-42-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#lab03-mcp-tools-__codelineno-42-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Operation to perform&quot;</span><span class="p">,</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#lab03-mcp-tools-__codelineno-42-14"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;validate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;format&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;schema_validate&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;compare&quot;</span><span class="p">],</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#lab03-mcp-tools-__codelineno-42-15"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;validate&quot;</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#lab03-mcp-tools-__codelineno-42-16"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-42-17"><a id="__codelineno-42-17" name="__codelineno-42-17" href="#lab03-mcp-tools-__codelineno-42-17"></a><span class="w">      </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-18"><a id="__codelineno-42-18" name="__codelineno-42-18" href="#lab03-mcp-tools-__codelineno-42-18"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-42-19"><a id="__codelineno-42-19" name="__codelineno-42-19" href="#lab03-mcp-tools-__codelineno-42-19"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;JSON Schema for schema validation (as JSON string)&quot;</span>
</span><span id="__span-42-20"><a id="__codelineno-42-20" name="__codelineno-42-20" href="#lab03-mcp-tools-__codelineno-42-20"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-42-21"><a id="__codelineno-42-21" name="__codelineno-42-21" href="#lab03-mcp-tools-__codelineno-42-21"></a><span class="w">      </span><span class="nx">json2</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-42-22"><a id="__codelineno-42-22" name="__codelineno-42-22" href="#lab03-mcp-tools-__codelineno-42-22"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-42-23"><a id="__codelineno-42-23" name="__codelineno-42-23" href="#lab03-mcp-tools-__codelineno-42-23"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Second JSON string for comparison&quot;</span>
</span><span id="__span-42-24"><a id="__codelineno-42-24" name="__codelineno-42-24" href="#lab03-mcp-tools-__codelineno-42-24"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-42-25"><a id="__codelineno-42-25" name="__codelineno-42-25" href="#lab03-mcp-tools-__codelineno-42-25"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-42-26"><a id="__codelineno-42-26" name="__codelineno-42-26" href="#lab03-mcp-tools-__codelineno-42-26"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;operation&quot;</span><span class="p">]</span>
</span><span id="__span-42-27"><a id="__codelineno-42-27" name="__codelineno-42-27" href="#lab03-mcp-tools-__codelineno-42-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-42-28"><a id="__codelineno-42-28" name="__codelineno-42-28" href="#lab03-mcp-tools-__codelineno-42-28"></a><span class="p">}</span>
</span></code></pre></div>

Implementation - First, install the required dependency:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#lab03-mcp-tools-__codelineno-43-1"></a>npm<span class="w"> </span>install<span class="w"> </span>ajv
</span></code></pre></div>

Add the import:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#lab03-mcp-tools-__codelineno-44-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Ajv</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;ajv&#39;</span><span class="p">;</span>
</span></code></pre></div>

Add this handler in your "CallToolRequestSchema" handler:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#lab03-mcp-tools-__codelineno-45-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;validate_json&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#lab03-mcp-tools-__codelineno-45-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#lab03-mcp-tools-__codelineno-45-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">json</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">json</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#lab03-mcp-tools-__codelineno-45-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">operation</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#lab03-mcp-tools-__codelineno-45-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">schema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">schema</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#lab03-mcp-tools-__codelineno-45-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">json2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">json2</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#lab03-mcp-tools-__codelineno-45-7"></a>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#lab03-mcp-tools-__codelineno-45-8"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#lab03-mcp-tools-__codelineno-45-9"></a>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#lab03-mcp-tools-__codelineno-45-10"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">operation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#lab03-mcp-tools-__codelineno-45-11"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;validate&quot;</span><span class="o">:</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#lab03-mcp-tools-__codelineno-45-12"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#lab03-mcp-tools-__codelineno-45-13"></a><span class="w">          </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#lab03-mcp-tools-__codelineno-45-14"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;‚úÖ Valid JSON syntax&quot;</span><span class="p">;</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#lab03-mcp-tools-__codelineno-45-15"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#lab03-mcp-tools-__codelineno-45-16"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ùå Invalid JSON: </span><span class="si">${</span><span class="nx">e</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#lab03-mcp-tools-__codelineno-45-17"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#lab03-mcp-tools-__codelineno-45-18"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#lab03-mcp-tools-__codelineno-45-19"></a>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#lab03-mcp-tools-__codelineno-45-20"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;format&quot;</span><span class="o">:</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#lab03-mcp-tools-__codelineno-45-21"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#lab03-mcp-tools-__codelineno-45-22"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">parsed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</span><span id="__span-45-23"><a id="__codelineno-45-23" name="__codelineno-45-23" href="#lab03-mcp-tools-__codelineno-45-23"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`üìÑ Formatted JSON:\n\`\`\`json\n</span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">parsed</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">\n\`\`\``</span><span class="p">;</span>
</span><span id="__span-45-24"><a id="__codelineno-45-24" name="__codelineno-45-24" href="#lab03-mcp-tools-__codelineno-45-24"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-25"><a id="__codelineno-45-25" name="__codelineno-45-25" href="#lab03-mcp-tools-__codelineno-45-25"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ùå Cannot format invalid JSON: </span><span class="si">${</span><span class="nx">e</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-26"><a id="__codelineno-45-26" name="__codelineno-45-26" href="#lab03-mcp-tools-__codelineno-45-26"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-27"><a id="__codelineno-45-27" name="__codelineno-45-27" href="#lab03-mcp-tools-__codelineno-45-27"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-28"><a id="__codelineno-45-28" name="__codelineno-45-28" href="#lab03-mcp-tools-__codelineno-45-28"></a>
</span><span id="__span-45-29"><a id="__codelineno-45-29" name="__codelineno-45-29" href="#lab03-mcp-tools-__codelineno-45-29"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;schema_validate&quot;</span><span class="o">:</span>
</span><span id="__span-45-30"><a id="__codelineno-45-30" name="__codelineno-45-30" href="#lab03-mcp-tools-__codelineno-45-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">schema</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-31"><a id="__codelineno-45-31" name="__codelineno-45-31" href="#lab03-mcp-tools-__codelineno-45-31"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;‚ùå Schema required for schema validation&quot;</span><span class="p">;</span>
</span><span id="__span-45-32"><a id="__codelineno-45-32" name="__codelineno-45-32" href="#lab03-mcp-tools-__codelineno-45-32"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-33"><a id="__codelineno-45-33" name="__codelineno-45-33" href="#lab03-mcp-tools-__codelineno-45-33"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-34"><a id="__codelineno-45-34" name="__codelineno-45-34" href="#lab03-mcp-tools-__codelineno-45-34"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-35"><a id="__codelineno-45-35" name="__codelineno-45-35" href="#lab03-mcp-tools-__codelineno-45-35"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">ajv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Ajv</span><span class="p">();</span>
</span><span id="__span-45-36"><a id="__codelineno-45-36" name="__codelineno-45-36" href="#lab03-mcp-tools-__codelineno-45-36"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">parsedJson</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</span><span id="__span-45-37"><a id="__codelineno-45-37" name="__codelineno-45-37" href="#lab03-mcp-tools-__codelineno-45-37"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">parsedSchema</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">schema</span><span class="p">);</span>
</span><span id="__span-45-38"><a id="__codelineno-45-38" name="__codelineno-45-38" href="#lab03-mcp-tools-__codelineno-45-38"></a>
</span><span id="__span-45-39"><a id="__codelineno-45-39" name="__codelineno-45-39" href="#lab03-mcp-tools-__codelineno-45-39"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">validate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ajv</span><span class="p">.</span><span class="nx">compile</span><span class="p">(</span><span class="nx">parsedSchema</span><span class="p">);</span>
</span><span id="__span-45-40"><a id="__codelineno-45-40" name="__codelineno-45-40" href="#lab03-mcp-tools-__codelineno-45-40"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">valid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">validate</span><span class="p">(</span><span class="nx">parsedJson</span><span class="p">);</span>
</span><span id="__span-45-41"><a id="__codelineno-45-41" name="__codelineno-45-41" href="#lab03-mcp-tools-__codelineno-45-41"></a>
</span><span id="__span-45-42"><a id="__codelineno-45-42" name="__codelineno-45-42" href="#lab03-mcp-tools-__codelineno-45-42"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">valid</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-43"><a id="__codelineno-45-43" name="__codelineno-45-43" href="#lab03-mcp-tools-__codelineno-45-43"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;‚úÖ JSON validates against schema&quot;</span><span class="p">;</span>
</span><span id="__span-45-44"><a id="__codelineno-45-44" name="__codelineno-45-44" href="#lab03-mcp-tools-__codelineno-45-44"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-45"><a id="__codelineno-45-45" name="__codelineno-45-45" href="#lab03-mcp-tools-__codelineno-45-45"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ùå Schema validation failed:\n</span><span class="si">${</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">validate</span><span class="p">.</span><span class="nx">errors</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-46"><a id="__codelineno-45-46" name="__codelineno-45-46" href="#lab03-mcp-tools-__codelineno-45-46"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-47"><a id="__codelineno-45-47" name="__codelineno-45-47" href="#lab03-mcp-tools-__codelineno-45-47"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-48"><a id="__codelineno-45-48" name="__codelineno-45-48" href="#lab03-mcp-tools-__codelineno-45-48"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ùå Schema validation error: </span><span class="si">${</span><span class="nx">e</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-49"><a id="__codelineno-45-49" name="__codelineno-45-49" href="#lab03-mcp-tools-__codelineno-45-49"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-50"><a id="__codelineno-45-50" name="__codelineno-45-50" href="#lab03-mcp-tools-__codelineno-45-50"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-51"><a id="__codelineno-45-51" name="__codelineno-45-51" href="#lab03-mcp-tools-__codelineno-45-51"></a>
</span><span id="__span-45-52"><a id="__codelineno-45-52" name="__codelineno-45-52" href="#lab03-mcp-tools-__codelineno-45-52"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;compare&quot;</span><span class="o">:</span>
</span><span id="__span-45-53"><a id="__codelineno-45-53" name="__codelineno-45-53" href="#lab03-mcp-tools-__codelineno-45-53"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">json2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-54"><a id="__codelineno-45-54" name="__codelineno-45-54" href="#lab03-mcp-tools-__codelineno-45-54"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;‚ùå Second JSON required for comparison&quot;</span><span class="p">;</span>
</span><span id="__span-45-55"><a id="__codelineno-45-55" name="__codelineno-45-55" href="#lab03-mcp-tools-__codelineno-45-55"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-56"><a id="__codelineno-45-56" name="__codelineno-45-56" href="#lab03-mcp-tools-__codelineno-45-56"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-57"><a id="__codelineno-45-57" name="__codelineno-45-57" href="#lab03-mcp-tools-__codelineno-45-57"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-58"><a id="__codelineno-45-58" name="__codelineno-45-58" href="#lab03-mcp-tools-__codelineno-45-58"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">obj1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json</span><span class="p">);</span>
</span><span id="__span-45-59"><a id="__codelineno-45-59" name="__codelineno-45-59" href="#lab03-mcp-tools-__codelineno-45-59"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">obj2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">json2</span><span class="p">);</span>
</span><span id="__span-45-60"><a id="__codelineno-45-60" name="__codelineno-45-60" href="#lab03-mcp-tools-__codelineno-45-60"></a>
</span><span id="__span-45-61"><a id="__codelineno-45-61" name="__codelineno-45-61" href="#lab03-mcp-tools-__codelineno-45-61"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">differences</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-45-62"><a id="__codelineno-45-62" name="__codelineno-45-62" href="#lab03-mcp-tools-__codelineno-45-62"></a>
</span><span id="__span-45-63"><a id="__codelineno-45-63" name="__codelineno-45-63" href="#lab03-mcp-tools-__codelineno-45-63"></a><span class="w">          </span><span class="c1">// Simple comparison - check if objects are equal</span>
</span><span id="__span-45-64"><a id="__codelineno-45-64" name="__codelineno-45-64" href="#lab03-mcp-tools-__codelineno-45-64"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj1</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj2</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-65"><a id="__codelineno-45-65" name="__codelineno-45-65" href="#lab03-mcp-tools-__codelineno-45-65"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;‚úÖ JSON objects are identical&quot;</span><span class="p">;</span>
</span><span id="__span-45-66"><a id="__codelineno-45-66" name="__codelineno-45-66" href="#lab03-mcp-tools-__codelineno-45-66"></a><span class="w">          </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-67"><a id="__codelineno-45-67" name="__codelineno-45-67" href="#lab03-mcp-tools-__codelineno-45-67"></a><span class="w">            </span><span class="c1">// Find differences</span>
</span><span id="__span-45-68"><a id="__codelineno-45-68" name="__codelineno-45-68" href="#lab03-mcp-tools-__codelineno-45-68"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj1</span><span class="p">);</span>
</span><span id="__span-45-69"><a id="__codelineno-45-69" name="__codelineno-45-69" href="#lab03-mcp-tools-__codelineno-45-69"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">keys2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">obj2</span><span class="p">);</span>
</span><span id="__span-45-70"><a id="__codelineno-45-70" name="__codelineno-45-70" href="#lab03-mcp-tools-__codelineno-45-70"></a>
</span><span id="__span-45-71"><a id="__codelineno-45-71" name="__codelineno-45-71" href="#lab03-mcp-tools-__codelineno-45-71"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">added</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">keys2</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="nx">keys1</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">k</span><span class="p">));</span>
</span><span id="__span-45-72"><a id="__codelineno-45-72" name="__codelineno-45-72" href="#lab03-mcp-tools-__codelineno-45-72"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">removed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">keys1</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="o">!</span><span class="nx">keys2</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">k</span><span class="p">));</span>
</span><span id="__span-45-73"><a id="__codelineno-45-73" name="__codelineno-45-73" href="#lab03-mcp-tools-__codelineno-45-73"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">modified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">keys1</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">k</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">keys2</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">k</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj1</span><span class="p">[</span><span class="nx">k</span><span class="p">])</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">obj2</span><span class="p">[</span><span class="nx">k</span><span class="p">]));</span>
</span><span id="__span-45-74"><a id="__codelineno-45-74" name="__codelineno-45-74" href="#lab03-mcp-tools-__codelineno-45-74"></a>
</span><span id="__span-45-75"><a id="__codelineno-45-75" name="__codelineno-45-75" href="#lab03-mcp-tools-__codelineno-45-75"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">added</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">differences</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`Added keys: </span><span class="si">${</span><span class="nx">added</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-45-76"><a id="__codelineno-45-76" name="__codelineno-45-76" href="#lab03-mcp-tools-__codelineno-45-76"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">removed</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">differences</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`Removed keys: </span><span class="si">${</span><span class="nx">removed</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-45-77"><a id="__codelineno-45-77" name="__codelineno-45-77" href="#lab03-mcp-tools-__codelineno-45-77"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">modified</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="nx">differences</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`Modified keys: </span><span class="si">${</span><span class="nx">modified</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-45-78"><a id="__codelineno-45-78" name="__codelineno-45-78" href="#lab03-mcp-tools-__codelineno-45-78"></a>
</span><span id="__span-45-79"><a id="__codelineno-45-79" name="__codelineno-45-79" href="#lab03-mcp-tools-__codelineno-45-79"></a><span class="w">            </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ö†Ô∏è JSON objects differ:\n</span><span class="si">${</span><span class="nx">differences</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-80"><a id="__codelineno-45-80" name="__codelineno-45-80" href="#lab03-mcp-tools-__codelineno-45-80"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-45-81"><a id="__codelineno-45-81" name="__codelineno-45-81" href="#lab03-mcp-tools-__codelineno-45-81"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-82"><a id="__codelineno-45-82" name="__codelineno-45-82" href="#lab03-mcp-tools-__codelineno-45-82"></a><span class="w">          </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`‚ùå Comparison error: </span><span class="si">${</span><span class="nx">e</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">e</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-45-83"><a id="__codelineno-45-83" name="__codelineno-45-83" href="#lab03-mcp-tools-__codelineno-45-83"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-84"><a id="__codelineno-45-84" name="__codelineno-45-84" href="#lab03-mcp-tools-__codelineno-45-84"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-45-85"><a id="__codelineno-45-85" name="__codelineno-45-85" href="#lab03-mcp-tools-__codelineno-45-85"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-45-86"><a id="__codelineno-45-86" name="__codelineno-45-86" href="#lab03-mcp-tools-__codelineno-45-86"></a>
</span><span id="__span-45-87"><a id="__codelineno-45-87" name="__codelineno-45-87" href="#lab03-mcp-tools-__codelineno-45-87"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-88"><a id="__codelineno-45-88" name="__codelineno-45-88" href="#lab03-mcp-tools-__codelineno-45-88"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-45-89"><a id="__codelineno-45-89" name="__codelineno-45-89" href="#lab03-mcp-tools-__codelineno-45-89"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-45-90"><a id="__codelineno-45-90" name="__codelineno-45-90" href="#lab03-mcp-tools-__codelineno-45-90"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-45-91"><a id="__codelineno-45-91" name="__codelineno-45-91" href="#lab03-mcp-tools-__codelineno-45-91"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">result</span>
</span><span id="__span-45-92"><a id="__codelineno-45-92" name="__codelineno-45-92" href="#lab03-mcp-tools-__codelineno-45-92"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-45-93"><a id="__codelineno-45-93" name="__codelineno-45-93" href="#lab03-mcp-tools-__codelineno-45-93"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-45-94"><a id="__codelineno-45-94" name="__codelineno-45-94" href="#lab03-mcp-tools-__codelineno-45-94"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-45-95"><a id="__codelineno-45-95" name="__codelineno-45-95" href="#lab03-mcp-tools-__codelineno-45-95"></a>
</span><span id="__span-45-96"><a id="__codelineno-45-96" name="__codelineno-45-96" href="#lab03-mcp-tools-__codelineno-45-96"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-45-97"><a id="__codelineno-45-97" name="__codelineno-45-97" href="#lab03-mcp-tools-__codelineno-45-97"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`JSON validation failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-45-98"><a id="__codelineno-45-98" name="__codelineno-45-98" href="#lab03-mcp-tools-__codelineno-45-98"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-45-99"><a id="__codelineno-45-99" name="__codelineno-45-99" href="#lab03-mcp-tools-__codelineno-45-99"></a><span class="p">}</span>
</span></code></pre></div>

Testing - Test different operations:

<div class="language-javascript highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#lab03-mcp-tools-__codelineno-46-1"></a><span class="c1">// Validate syntax</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#lab03-mcp-tools-__codelineno-46-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;test&quot;, &quot;value&quot;: 123}&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;validate&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#lab03-mcp-tools-__codelineno-46-3"></a>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#lab03-mcp-tools-__codelineno-46-4"></a><span class="c1">// Format JSON</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#lab03-mcp-tools-__codelineno-46-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;:&quot;test&quot;,&quot;value&quot;:123}&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;format&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#lab03-mcp-tools-__codelineno-46-6"></a>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#lab03-mcp-tools-__codelineno-46-7"></a><span class="c1">// Schema validation</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#lab03-mcp-tools-__codelineno-46-8"></a><span class="p">{</span><span class="w"> </span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#lab03-mcp-tools-__codelineno-46-9"></a><span class="w">  </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;name&quot;: &quot;John&quot;, &quot;age&quot;: 30}&#39;</span><span class="p">,</span><span class="w"> </span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#lab03-mcp-tools-__codelineno-46-10"></a><span class="w">  </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;schema_validate&quot;</span><span class="p">,</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#lab03-mcp-tools-__codelineno-46-11"></a><span class="w">  </span><span class="nx">schema</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;type&quot;: &quot;object&quot;, &quot;properties&quot;: {&quot;name&quot;: {&quot;type&quot;: &quot;string&quot;}, &quot;age&quot;: {&quot;type&quot;: &quot;number&quot;}}}&#39;</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#lab03-mcp-tools-__codelineno-46-12"></a><span class="p">}</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#lab03-mcp-tools-__codelineno-46-13"></a>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#lab03-mcp-tools-__codelineno-46-14"></a><span class="c1">// Compare JSON</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#lab03-mcp-tools-__codelineno-46-15"></a><span class="p">{</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#lab03-mcp-tools-__codelineno-46-16"></a><span class="w">  </span><span class="nx">json</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;a&quot;: 1, &quot;b&quot;: 2}&#39;</span><span class="p">,</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#lab03-mcp-tools-__codelineno-46-17"></a><span class="w">  </span><span class="nx">json2</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;{&quot;a&quot;: 1, &quot;c&quot;: 3}&#39;</span><span class="p">,</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#lab03-mcp-tools-__codelineno-46-18"></a><span class="w">  </span><span class="nx">operation</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;compare&quot;</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#lab03-mcp-tools-__codelineno-46-19"></a><span class="p">}</span>
</span></code></pre></div>

</details>

<h3 id="lab03-mcp-tools-exercise-3-web-scraper-tool">Exercise 3: Web Scraper Tool<a class="headerlink" href="#lab03-mcp-tools-exercise-3-web-scraper-tool" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Fetches web page content</li>
<li>Extracts specific elements</li>
<li>Returns clean text</li>
<li>Handles errors gracefully</li>
</ul>
<details>
<summary>üí° Solution: Web Scraper Tool</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#lab03-mcp-tools-__codelineno-47-1"></a><span class="p">{</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#lab03-mcp-tools-__codelineno-47-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;scrape_web&quot;</span><span class="p">,</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#lab03-mcp-tools-__codelineno-47-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Fetch and extract content from web pages&quot;</span><span class="p">,</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#lab03-mcp-tools-__codelineno-47-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#lab03-mcp-tools-__codelineno-47-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#lab03-mcp-tools-__codelineno-47-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-7"><a id="__codelineno-47-7" name="__codelineno-47-7" href="#lab03-mcp-tools-__codelineno-47-7"></a><span class="w">      </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-8"><a id="__codelineno-47-8" name="__codelineno-47-8" href="#lab03-mcp-tools-__codelineno-47-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-47-9"><a id="__codelineno-47-9" name="__codelineno-47-9" href="#lab03-mcp-tools-__codelineno-47-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;URL to scrape&quot;</span><span class="p">,</span>
</span><span id="__span-47-10"><a id="__codelineno-47-10" name="__codelineno-47-10" href="#lab03-mcp-tools-__codelineno-47-10"></a><span class="w">        </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span>
</span><span id="__span-47-11"><a id="__codelineno-47-11" name="__codelineno-47-11" href="#lab03-mcp-tools-__codelineno-47-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-47-12"><a id="__codelineno-47-12" name="__codelineno-47-12" href="#lab03-mcp-tools-__codelineno-47-12"></a><span class="w">      </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-13"><a id="__codelineno-47-13" name="__codelineno-47-13" href="#lab03-mcp-tools-__codelineno-47-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-47-14"><a id="__codelineno-47-14" name="__codelineno-47-14" href="#lab03-mcp-tools-__codelineno-47-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;CSS selector to extract specific elements (optional)&quot;</span><span class="p">,</span>
</span><span id="__span-47-15"><a id="__codelineno-47-15" name="__codelineno-47-15" href="#lab03-mcp-tools-__codelineno-47-15"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;body&quot;</span>
</span><span id="__span-47-16"><a id="__codelineno-47-16" name="__codelineno-47-16" href="#lab03-mcp-tools-__codelineno-47-16"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-47-17"><a id="__codelineno-47-17" name="__codelineno-47-17" href="#lab03-mcp-tools-__codelineno-47-17"></a><span class="w">      </span><span class="nx">includeText</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-18"><a id="__codelineno-47-18" name="__codelineno-47-18" href="#lab03-mcp-tools-__codelineno-47-18"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-47-19"><a id="__codelineno-47-19" name="__codelineno-47-19" href="#lab03-mcp-tools-__codelineno-47-19"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Extract only text content (remove HTML)&quot;</span><span class="p">,</span>
</span><span id="__span-47-20"><a id="__codelineno-47-20" name="__codelineno-47-20" href="#lab03-mcp-tools-__codelineno-47-20"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-47-21"><a id="__codelineno-47-21" name="__codelineno-47-21" href="#lab03-mcp-tools-__codelineno-47-21"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-47-22"><a id="__codelineno-47-22" name="__codelineno-47-22" href="#lab03-mcp-tools-__codelineno-47-22"></a><span class="w">      </span><span class="nx">maxLength</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-23"><a id="__codelineno-47-23" name="__codelineno-47-23" href="#lab03-mcp-tools-__codelineno-47-23"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-47-24"><a id="__codelineno-47-24" name="__codelineno-47-24" href="#lab03-mcp-tools-__codelineno-47-24"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum length of extracted content&quot;</span><span class="p">,</span>
</span><span id="__span-47-25"><a id="__codelineno-47-25" name="__codelineno-47-25" href="#lab03-mcp-tools-__codelineno-47-25"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="p">,</span>
</span><span id="__span-47-26"><a id="__codelineno-47-26" name="__codelineno-47-26" href="#lab03-mcp-tools-__codelineno-47-26"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span><span class="p">,</span>
</span><span id="__span-47-27"><a id="__codelineno-47-27" name="__codelineno-47-27" href="#lab03-mcp-tools-__codelineno-47-27"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">2000</span>
</span><span id="__span-47-28"><a id="__codelineno-47-28" name="__codelineno-47-28" href="#lab03-mcp-tools-__codelineno-47-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-47-29"><a id="__codelineno-47-29" name="__codelineno-47-29" href="#lab03-mcp-tools-__codelineno-47-29"></a><span class="w">      </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-47-30"><a id="__codelineno-47-30" name="__codelineno-47-30" href="#lab03-mcp-tools-__codelineno-47-30"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-47-31"><a id="__codelineno-47-31" name="__codelineno-47-31" href="#lab03-mcp-tools-__codelineno-47-31"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Request timeout in milliseconds&quot;</span><span class="p">,</span>
</span><span id="__span-47-32"><a id="__codelineno-47-32" name="__codelineno-47-32" href="#lab03-mcp-tools-__codelineno-47-32"></a><span class="w">        </span><span class="nx">minimum</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span><span class="p">,</span>
</span><span id="__span-47-33"><a id="__codelineno-47-33" name="__codelineno-47-33" href="#lab03-mcp-tools-__codelineno-47-33"></a><span class="w">        </span><span class="nx">maximum</span><span class="o">:</span><span class="w"> </span><span class="kt">30000</span><span class="p">,</span>
</span><span id="__span-47-34"><a id="__codelineno-47-34" name="__codelineno-47-34" href="#lab03-mcp-tools-__codelineno-47-34"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span>
</span><span id="__span-47-35"><a id="__codelineno-47-35" name="__codelineno-47-35" href="#lab03-mcp-tools-__codelineno-47-35"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-47-36"><a id="__codelineno-47-36" name="__codelineno-47-36" href="#lab03-mcp-tools-__codelineno-47-36"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-47-37"><a id="__codelineno-47-37" name="__codelineno-47-37" href="#lab03-mcp-tools-__codelineno-47-37"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;url&quot;</span><span class="p">]</span>
</span><span id="__span-47-38"><a id="__codelineno-47-38" name="__codelineno-47-38" href="#lab03-mcp-tools-__codelineno-47-38"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-47-39"><a id="__codelineno-47-39" name="__codelineno-47-39" href="#lab03-mcp-tools-__codelineno-47-39"></a><span class="p">}</span>
</span></code></pre></div>

Implementation - First, install the required dependencies:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#lab03-mcp-tools-__codelineno-48-1"></a>npm<span class="w"> </span>install<span class="w"> </span>axios<span class="w"> </span>cheerio
</span></code></pre></div>

Add the imports:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#lab03-mcp-tools-__codelineno-49-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;axios&#39;</span><span class="p">;</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#lab03-mcp-tools-__codelineno-49-2"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">cheerio</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;cheerio&#39;</span><span class="p">;</span>
</span></code></pre></div>

Add this handler in your `CallToolRequestSchema` handler:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#lab03-mcp-tools-__codelineno-50-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;scrape_web&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#lab03-mcp-tools-__codelineno-50-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#lab03-mcp-tools-__codelineno-50-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#lab03-mcp-tools-__codelineno-50-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">selector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">selector</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="p">;</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#lab03-mcp-tools-__codelineno-50-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">includeText</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">includeText</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="kc">false</span><span class="p">);</span><span class="w"> </span><span class="c1">// default true</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#lab03-mcp-tools-__codelineno-50-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">maxLength</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">maxLength</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">2000</span><span class="p">;</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#lab03-mcp-tools-__codelineno-50-7"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">timeout</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">10000</span><span class="p">;</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#lab03-mcp-tools-__codelineno-50-8"></a>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#lab03-mcp-tools-__codelineno-50-9"></a><span class="w">    </span><span class="c1">// Validate URL</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#lab03-mcp-tools-__codelineno-50-10"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#lab03-mcp-tools-__codelineno-50-11"></a><span class="w">      </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#lab03-mcp-tools-__codelineno-50-12"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#lab03-mcp-tools-__codelineno-50-13"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Invalid URL format&quot;</span><span class="p">);</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#lab03-mcp-tools-__codelineno-50-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#lab03-mcp-tools-__codelineno-50-15"></a>
</span><span id="__span-50-16"><a id="__codelineno-50-16" name="__codelineno-50-16" href="#lab03-mcp-tools-__codelineno-50-16"></a><span class="w">    </span><span class="c1">// Fetch the webpage</span>
</span><span id="__span-50-17"><a id="__codelineno-50-17" name="__codelineno-50-17" href="#lab03-mcp-tools-__codelineno-50-17"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-18"><a id="__codelineno-50-18" name="__codelineno-50-18" href="#lab03-mcp-tools-__codelineno-50-18"></a><span class="w">      </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="kt">timeout</span><span class="p">,</span>
</span><span id="__span-50-19"><a id="__codelineno-50-19" name="__codelineno-50-19" href="#lab03-mcp-tools-__codelineno-50-19"></a><span class="w">      </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-20"><a id="__codelineno-50-20" name="__codelineno-50-20" href="#lab03-mcp-tools-__codelineno-50-20"></a><span class="w">        </span><span class="s1">&#39;User-Agent&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MCP-Web-Scraper/1.0 (Educational Tool)&#39;</span>
</span><span id="__span-50-21"><a id="__codelineno-50-21" name="__codelineno-50-21" href="#lab03-mcp-tools-__codelineno-50-21"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-50-22"><a id="__codelineno-50-22" name="__codelineno-50-22" href="#lab03-mcp-tools-__codelineno-50-22"></a><span class="w">      </span><span class="nx">maxContentLength</span><span class="o">:</span><span class="w"> </span><span class="kt">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024</span><span class="p">,</span><span class="w"> </span><span class="c1">// 5MB limit</span>
</span><span id="__span-50-23"><a id="__codelineno-50-23" name="__codelineno-50-23" href="#lab03-mcp-tools-__codelineno-50-23"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-50-24"><a id="__codelineno-50-24" name="__codelineno-50-24" href="#lab03-mcp-tools-__codelineno-50-24"></a>
</span><span id="__span-50-25"><a id="__codelineno-50-25" name="__codelineno-50-25" href="#lab03-mcp-tools-__codelineno-50-25"></a><span class="w">    </span><span class="c1">// Load HTML into cheerio</span>
</span><span id="__span-50-26"><a id="__codelineno-50-26" name="__codelineno-50-26" href="#lab03-mcp-tools-__codelineno-50-26"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">$</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cheerio</span><span class="p">.</span><span class="nx">load</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-50-27"><a id="__codelineno-50-27" name="__codelineno-50-27" href="#lab03-mcp-tools-__codelineno-50-27"></a>
</span><span id="__span-50-28"><a id="__codelineno-50-28" name="__codelineno-50-28" href="#lab03-mcp-tools-__codelineno-50-28"></a><span class="w">    </span><span class="c1">// Extract content based on selector</span>
</span><span id="__span-50-29"><a id="__codelineno-50-29" name="__codelineno-50-29" href="#lab03-mcp-tools-__codelineno-50-29"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-50-30"><a id="__codelineno-50-30" name="__codelineno-50-30" href="#lab03-mcp-tools-__codelineno-50-30"></a>
</span><span id="__span-50-31"><a id="__codelineno-50-31" name="__codelineno-50-31" href="#lab03-mcp-tools-__codelineno-50-31"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">selector</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-32"><a id="__codelineno-50-32" name="__codelineno-50-32" href="#lab03-mcp-tools-__codelineno-50-32"></a><span class="w">      </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">includeText</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">text</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-50-33"><a id="__codelineno-50-33" name="__codelineno-50-33" href="#lab03-mcp-tools-__codelineno-50-33"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-34"><a id="__codelineno-50-34" name="__codelineno-50-34" href="#lab03-mcp-tools-__codelineno-50-34"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">elements</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
</span><span id="__span-50-35"><a id="__codelineno-50-35" name="__codelineno-50-35" href="#lab03-mcp-tools-__codelineno-50-35"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-36"><a id="__codelineno-50-36" name="__codelineno-50-36" href="#lab03-mcp-tools-__codelineno-50-36"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`No elements found matching selector: </span><span class="si">${</span><span class="nx">selector</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-37"><a id="__codelineno-50-37" name="__codelineno-50-37" href="#lab03-mcp-tools-__codelineno-50-37"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-50-38"><a id="__codelineno-50-38" name="__codelineno-50-38" href="#lab03-mcp-tools-__codelineno-50-38"></a>
</span><span id="__span-50-39"><a id="__codelineno-50-39" name="__codelineno-50-39" href="#lab03-mcp-tools-__codelineno-50-39"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">includeText</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-40"><a id="__codelineno-50-40" name="__codelineno-50-40" href="#lab03-mcp-tools-__codelineno-50-40"></a><span class="w">        </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">).</span><span class="nx">text</span><span class="p">()).</span><span class="nx">get</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n\n&#39;</span><span class="p">);</span>
</span><span id="__span-50-41"><a id="__codelineno-50-41" name="__codelineno-50-41" href="#lab03-mcp-tools-__codelineno-50-41"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-42"><a id="__codelineno-50-42" name="__codelineno-50-42" href="#lab03-mcp-tools-__codelineno-50-42"></a><span class="w">        </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">elements</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span><span class="w"> </span><span class="nx">el</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">$</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">el</span><span class="p">)).</span><span class="nx">get</span><span class="p">().</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n\n&#39;</span><span class="p">);</span>
</span><span id="__span-50-43"><a id="__codelineno-50-43" name="__codelineno-50-43" href="#lab03-mcp-tools-__codelineno-50-43"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-50-44"><a id="__codelineno-50-44" name="__codelineno-50-44" href="#lab03-mcp-tools-__codelineno-50-44"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-45"><a id="__codelineno-50-45" name="__codelineno-50-45" href="#lab03-mcp-tools-__codelineno-50-45"></a>
</span><span id="__span-50-46"><a id="__codelineno-50-46" name="__codelineno-50-46" href="#lab03-mcp-tools-__codelineno-50-46"></a><span class="w">    </span><span class="c1">// Clean up the content</span>
</span><span id="__span-50-47"><a id="__codelineno-50-47" name="__codelineno-50-47" href="#lab03-mcp-tools-__codelineno-50-47"></a><span class="w">    </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extractedContent</span>
</span><span id="__span-50-48"><a id="__codelineno-50-48" name="__codelineno-50-48" href="#lab03-mcp-tools-__codelineno-50-48"></a><span class="w">      </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s+/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Replace multiple whitespace with single space</span>
</span><span id="__span-50-49"><a id="__codelineno-50-49" name="__codelineno-50-49" href="#lab03-mcp-tools-__codelineno-50-49"></a><span class="w">      </span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\n\s*\n/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="w">  </span><span class="c1">// Remove empty lines</span>
</span><span id="__span-50-50"><a id="__codelineno-50-50" name="__codelineno-50-50" href="#lab03-mcp-tools-__codelineno-50-50"></a><span class="w">      </span><span class="p">.</span><span class="nx">trim</span><span class="p">();</span>
</span><span id="__span-50-51"><a id="__codelineno-50-51" name="__codelineno-50-51" href="#lab03-mcp-tools-__codelineno-50-51"></a>
</span><span id="__span-50-52"><a id="__codelineno-50-52" name="__codelineno-50-52" href="#lab03-mcp-tools-__codelineno-50-52"></a><span class="w">    </span><span class="c1">// Truncate if too long</span>
</span><span id="__span-50-53"><a id="__codelineno-50-53" name="__codelineno-50-53" href="#lab03-mcp-tools-__codelineno-50-53"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">extractedContent</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">maxLength</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-54"><a id="__codelineno-50-54" name="__codelineno-50-54" href="#lab03-mcp-tools-__codelineno-50-54"></a><span class="w">      </span><span class="nx">extractedContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">extractedContent</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">maxLength</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">3</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s2">&quot;...&quot;</span><span class="p">;</span>
</span><span id="__span-50-55"><a id="__codelineno-50-55" name="__codelineno-50-55" href="#lab03-mcp-tools-__codelineno-50-55"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-56"><a id="__codelineno-50-56" name="__codelineno-50-56" href="#lab03-mcp-tools-__codelineno-50-56"></a>
</span><span id="__span-50-57"><a id="__codelineno-50-57" name="__codelineno-50-57" href="#lab03-mcp-tools-__codelineno-50-57"></a><span class="w">    </span><span class="c1">// Prepare metadata</span>
</span><span id="__span-50-58"><a id="__codelineno-50-58" name="__codelineno-50-58" href="#lab03-mcp-tools-__codelineno-50-58"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">metadata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-59"><a id="__codelineno-50-59" name="__codelineno-50-59" href="#lab03-mcp-tools-__codelineno-50-59"></a><span class="w">      </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">url</span><span class="p">,</span>
</span><span id="__span-50-60"><a id="__codelineno-50-60" name="__codelineno-50-60" href="#lab03-mcp-tools-__codelineno-50-60"></a><span class="w">      </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="kt">response.status</span><span class="p">,</span>
</span><span id="__span-50-61"><a id="__codelineno-50-61" name="__codelineno-50-61" href="#lab03-mcp-tools-__codelineno-50-61"></a><span class="w">      </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="kt">response.headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
</span><span id="__span-50-62"><a id="__codelineno-50-62" name="__codelineno-50-62" href="#lab03-mcp-tools-__codelineno-50-62"></a><span class="w">      </span><span class="nx">contentLength</span><span class="o">:</span><span class="w"> </span><span class="kt">response.data.length</span><span class="p">,</span>
</span><span id="__span-50-63"><a id="__codelineno-50-63" name="__codelineno-50-63" href="#lab03-mcp-tools-__codelineno-50-63"></a><span class="w">      </span><span class="nx">extractedLength</span><span class="o">:</span><span class="w"> </span><span class="kt">extractedContent.length</span><span class="p">,</span>
</span><span id="__span-50-64"><a id="__codelineno-50-64" name="__codelineno-50-64" href="#lab03-mcp-tools-__codelineno-50-64"></a><span class="w">      </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="kt">selector</span><span class="p">,</span>
</span><span id="__span-50-65"><a id="__codelineno-50-65" name="__codelineno-50-65" href="#lab03-mcp-tools-__codelineno-50-65"></a><span class="w">      </span><span class="nx">elementsFound</span><span class="o">:</span><span class="w"> </span><span class="kt">selector</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;body&quot;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">1</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">$</span><span class="p">(</span><span class="nx">selector</span><span class="p">).</span><span class="nx">length</span>
</span><span id="__span-50-66"><a id="__codelineno-50-66" name="__codelineno-50-66" href="#lab03-mcp-tools-__codelineno-50-66"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-50-67"><a id="__codelineno-50-67" name="__codelineno-50-67" href="#lab03-mcp-tools-__codelineno-50-67"></a>
</span><span id="__span-50-68"><a id="__codelineno-50-68" name="__codelineno-50-68" href="#lab03-mcp-tools-__codelineno-50-68"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-69"><a id="__codelineno-50-69" name="__codelineno-50-69" href="#lab03-mcp-tools-__codelineno-50-69"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-50-70"><a id="__codelineno-50-70" name="__codelineno-50-70" href="#lab03-mcp-tools-__codelineno-50-70"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-50-71"><a id="__codelineno-50-71" name="__codelineno-50-71" href="#lab03-mcp-tools-__codelineno-50-71"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-50-72"><a id="__codelineno-50-72" name="__codelineno-50-72" href="#lab03-mcp-tools-__codelineno-50-72"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`üåê Web Scraping Results\n\nüìä Metadata:\n</span><span class="si">${</span><span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">metadata</span><span class="p">).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">k</span><span class="p">,</span><span class="w"> </span><span class="nx">v</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`- </span><span class="si">${</span><span class="nx">k</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">v</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">\n\nüìÑ Extracted Content:\n</span><span class="si">${</span><span class="nx">extractedContent</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-50-73"><a id="__codelineno-50-73" name="__codelineno-50-73" href="#lab03-mcp-tools-__codelineno-50-73"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-50-74"><a id="__codelineno-50-74" name="__codelineno-50-74" href="#lab03-mcp-tools-__codelineno-50-74"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-50-75"><a id="__codelineno-50-75" name="__codelineno-50-75" href="#lab03-mcp-tools-__codelineno-50-75"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-50-76"><a id="__codelineno-50-76" name="__codelineno-50-76" href="#lab03-mcp-tools-__codelineno-50-76"></a>
</span><span id="__span-50-77"><a id="__codelineno-50-77" name="__codelineno-50-77" href="#lab03-mcp-tools-__codelineno-50-77"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-78"><a id="__codelineno-50-78" name="__codelineno-50-78" href="#lab03-mcp-tools-__codelineno-50-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">isAxiosError</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-79"><a id="__codelineno-50-79" name="__codelineno-50-79" href="#lab03-mcp-tools-__codelineno-50-79"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ENOTFOUND&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-80"><a id="__codelineno-50-80" name="__codelineno-50-80" href="#lab03-mcp-tools-__codelineno-50-80"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Could not resolve hostname: </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-81"><a id="__codelineno-50-81" name="__codelineno-50-81" href="#lab03-mcp-tools-__codelineno-50-81"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ECONNREFUSED&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-82"><a id="__codelineno-50-82" name="__codelineno-50-82" href="#lab03-mcp-tools-__codelineno-50-82"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Connection refused: </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">url</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-83"><a id="__codelineno-50-83" name="__codelineno-50-83" href="#lab03-mcp-tools-__codelineno-50-83"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-84"><a id="__codelineno-50-84" name="__codelineno-50-84" href="#lab03-mcp-tools-__codelineno-50-84"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`HTTP </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-85"><a id="__codelineno-50-85" name="__codelineno-50-85" href="#lab03-mcp-tools-__codelineno-50-85"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ETIMEDOUT&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-86"><a id="__codelineno-50-86" name="__codelineno-50-86" href="#lab03-mcp-tools-__codelineno-50-86"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Request timeout after </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">timeout</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">10000</span><span class="si">}</span><span class="sb">ms`</span><span class="p">);</span>
</span><span id="__span-50-87"><a id="__codelineno-50-87" name="__codelineno-50-87" href="#lab03-mcp-tools-__codelineno-50-87"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-88"><a id="__codelineno-50-88" name="__codelineno-50-88" href="#lab03-mcp-tools-__codelineno-50-88"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Network error: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-89"><a id="__codelineno-50-89" name="__codelineno-50-89" href="#lab03-mcp-tools-__codelineno-50-89"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-50-90"><a id="__codelineno-50-90" name="__codelineno-50-90" href="#lab03-mcp-tools-__codelineno-50-90"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-50-91"><a id="__codelineno-50-91" name="__codelineno-50-91" href="#lab03-mcp-tools-__codelineno-50-91"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Web scraping failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-50-92"><a id="__codelineno-50-92" name="__codelineno-50-92" href="#lab03-mcp-tools-__codelineno-50-92"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-50-93"><a id="__codelineno-50-93" name="__codelineno-50-93" href="#lab03-mcp-tools-__codelineno-50-93"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-50-94"><a id="__codelineno-50-94" name="__codelineno-50-94" href="#lab03-mcp-tools-__codelineno-50-94"></a><span class="p">}</span>
</span></code></pre></div>

Testing - Test with different websites and selectors:

<div class="language-javascript highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#lab03-mcp-tools-__codelineno-51-1"></a><span class="c1">// Basic page scraping</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#lab03-mcp-tools-__codelineno-51-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://httpbin.org/html&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#lab03-mcp-tools-__codelineno-51-3"></a>
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#lab03-mcp-tools-__codelineno-51-4"></a><span class="c1">// Extract specific elements</span>
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#lab03-mcp-tools-__codelineno-51-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://httpbin.org/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;h1&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#lab03-mcp-tools-__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#lab03-mcp-tools-__codelineno-51-7"></a><span class="c1">// Get HTML instead of text</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#lab03-mcp-tools-__codelineno-51-8"></a><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://httpbin.org/html&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">selector</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">includeText</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-51-9"><a id="__codelineno-51-9" name="__codelineno-51-9" href="#lab03-mcp-tools-__codelineno-51-9"></a>
</span><span id="__span-51-10"><a id="__codelineno-51-10" name="__codelineno-51-10" href="#lab03-mcp-tools-__codelineno-51-10"></a><span class="c1">// Test error handling</span>
</span><span id="__span-51-11"><a id="__codelineno-51-11" name="__codelineno-51-11" href="#lab03-mcp-tools-__codelineno-51-11"></a><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://nonexistent-domain-12345.com&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-51-12"><a id="__codelineno-51-12" name="__codelineno-51-12" href="#lab03-mcp-tools-__codelineno-51-12"></a><span class="p">{</span><span class="w"> </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;https://httpbin.org/status/404&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>

#### Security Notes

- This tool includes basic security measures but should not be used for production scraping
- Always respect robots.txt and terms of service
- Consider rate limiting to avoid being blocked
- Some websites may block requests without proper headers

</details>

<hr />
<h2 id="lab03-mcp-tools-key-takeaways">Key Takeaways<a class="headerlink" href="#lab03-mcp-tools-key-takeaways" title="Permanent link">&para;</a></h2>
<p>‚úÖ Well-designed tools have clear schemas with validation</p>
<p>‚úÖ Always validate inputs, even with JSON Schema</p>
<p>‚úÖ Return rich content types when appropriate</p>
<p>‚úÖ Handle errors gracefully with helpful messages</p>
<p>‚úÖ Consider performance and caching for expensive operations</p>
<p>‚úÖ Design tools to be composable with others</p>
<p>‚úÖ Test thoroughly with edge cases</p>
<p>‚úÖ Security is paramount - validate and sanitize everything</p>
<hr />
<h2 id="lab03-mcp-tools-next-steps">Next Steps<a class="headerlink" href="#lab03-mcp-tools-next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="#lab04-mcp-resources"><strong>Lab 4</strong></a>, you&rsquo;ll explore MCP Resources. You&rsquo;ll learn:</p>
<ul>
<li>What resources are and how they differ from tools</li>
<li>Implementing resource URIs and templates</li>
<li>Supporting resource subscriptions for live updates</li>
<li>Best practices for resource organization</li>
<li>Combining tools and resources effectively</li>
</ul>
<hr />
<p><strong>You&rsquo;re becoming an MCP expert! Continue to <a href="#lab04-mcp-resources"><strong>Lab 4</strong></a>.</strong></p></section><section class="print-page" id="lab04-mcp-resources" heading-number="3.6"><h1 id="lab04-mcp-resources-lab-4-implementing-mcp-resources">Lab 4: Implementing MCP Resources<a class="headerlink" href="#lab04-mcp-resources-lab-4-implementing-mcp-resources" title="Permanent link">&para;</a></h1>
<h2 id="lab04-mcp-resources-overview">Overview<a class="headerlink" href="#lab04-mcp-resources-overview" title="Permanent link">&para;</a></h2>
<p>In <a href="#lab03-mcp-tools">Lab 3</a>, you mastered the art of creating sophisticated MCP tools that perform actions and return rich content. Now it&rsquo;s time to explore <strong>MCP Resources</strong> - the passive counterpart to tools that provides contextual data for LLMs to read and reference.</p>
<p>Resources are the foundation for giving LLMs access to your knowledge bases, files, databases, and other data sources. Unlike tools that <em>do</em> things, resources <em>are</em> things - they represent the data itself that LLMs can access for context and reasoning.</p>
<hr />
<h2 id="lab04-mcp-resources-learning-objectives">Learning Objectives<a class="headerlink" href="#lab04-mcp-resources-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Understand the fundamental difference between tools and resources</li>
<li>Design effective resource URI schemes for different data types</li>
<li>Implement static and dynamic resources with proper metadata</li>
<li>Create resource templates for parameterized access</li>
<li>Build resource subscriptions for real-time updates</li>
<li>Apply security best practices for resource access</li>
<li>Combine resources with tools for comprehensive MCP servers</li>
<li>Test resource implementations thoroughly</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-prerequisites">Prerequisites<a class="headerlink" href="#lab04-mcp-resources-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Completed <a href="#lab03-mcp-tools">Lab 3 - Implementing MCP Tools</a></li>
<li>Understanding of URI / URL patterns and RESTful design</li>
<li>Familiarity with file systems and data structures</li>
<li>Basic knowledge of caching and performance optimization</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-tools-vs-resources">Tools vs. Resources<a class="headerlink" href="#lab04-mcp-resources-tools-vs-resources" title="Permanent link">&para;</a></h2>
<h3 id="lab04-mcp-resources-the-fundamental-difference">The Fundamental Difference<a class="headerlink" href="#lab04-mcp-resources-the-fundamental-difference" title="Permanent link">&para;</a></h3>
<p>Before diving into implementation, it&rsquo;s crucial to understand when to use tools versus resources. They serve different purposes in the MCP ecosystem.</p>
<h3 id="lab04-mcp-resources-tools-active-operations">Tools: Active Operations<a class="headerlink" href="#lab04-mcp-resources-tools-active-operations" title="Permanent link">&para;</a></h3>
<p><strong>Tools perform actions and return results based on parameters.</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab04-mcp-resources-__codelineno-0-1"></a><span class="c1">// Tool: Active, parameterized, can have side effects</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab04-mcp-resources-__codelineno-0-2"></a><span class="p">{</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab04-mcp-resources-__codelineno-0-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;search_database&quot;</span><span class="p">,</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab04-mcp-resources-__codelineno-0-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search database with custom query&quot;</span><span class="p">,</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab04-mcp-resources-__codelineno-0-5"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab04-mcp-resources-__codelineno-0-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab04-mcp-resources-__codelineno-0-7"></a><span class="w">      </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab04-mcp-resources-__codelineno-0-8"></a><span class="w">      </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#lab04-mcp-resources-__codelineno-0-9"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#lab04-mcp-resources-__codelineno-0-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#lab04-mcp-resources-__codelineno-0-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use tools:</strong></p>
<ul>
<li>Data changes frequently or needs computation</li>
<li>Operations require parameters or user input</li>
<li>Actions have side effects (create, update, delete)</li>
<li>Results need processing or transformation</li>
</ul>
<h3 id="lab04-mcp-resources-resources-passive-data">Resources: Passive Data<a class="headerlink" href="#lab04-mcp-resources-resources-passive-data" title="Permanent link">&para;</a></h3>
<p><strong>Resources expose existing data that can be read and referenced.</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab04-mcp-resources-__codelineno-1-1"></a><span class="c1">// Resource: Passive, addressable, read-only</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab04-mcp-resources-__codelineno-1-2"></a><span class="p">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab04-mcp-resources-__codelineno-1-3"></a><span class="w">  </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://users/123/profile&quot;</span><span class="p">,</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#lab04-mcp-resources-__codelineno-1-4"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User Profile&quot;</span><span class="p">,</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#lab04-mcp-resources-__codelineno-1-5"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User profile data for ID 123&quot;</span><span class="p">,</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#lab04-mcp-resources-__codelineno-1-6"></a><span class="w">  </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#lab04-mcp-resources-__codelineno-1-7"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>When to use resources:</strong></p>
<ul>
<li>Data is relatively static or changes predictably</li>
<li>Direct access to structured data is needed</li>
<li>Content should be cached or bookmarked</li>
<li>Data serves as context for LLM reasoning</li>
</ul>
<h3 id="lab04-mcp-resources-decision-framework">Decision Framework<a class="headerlink" href="#lab04-mcp-resources-decision-framework" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Scenario</th>
<th>Use Tool</th>
<th>Use Resource</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Current weather</td>
<td>‚úÖ Tool</td>
<td>‚ùå Resource</td>
<td>Data changes constantly</td>
</tr>
<tr>
<td>API documentation</td>
<td>‚ùå Tool</td>
<td>‚úÖ Resource</td>
<td>Static reference material</td>
</tr>
<tr>
<td>Database search</td>
<td>‚úÖ Tool</td>
<td>‚ùå Resource</td>
<td>Requires query parameters</td>
</tr>
<tr>
<td>User profile</td>
<td>‚ùå Tool</td>
<td>‚úÖ Resource</td>
<td>Direct data access needed</td>
</tr>
<tr>
<td>File contents</td>
<td>‚ùå Tool</td>
<td>‚úÖ Resource</td>
<td>Static file data</td>
</tr>
<tr>
<td>Generate report</td>
<td>‚úÖ Tool</td>
<td>‚ùå Resource</td>
<td>Computation required</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="lab04-mcp-resources-resource-fundamentals">Resource Fundamentals<a class="headerlink" href="#lab04-mcp-resources-resource-fundamentals" title="Permanent link">&para;</a></h2>
<h3 id="lab04-mcp-resources-resource-structure">Resource Structure<a class="headerlink" href="#lab04-mcp-resources-resource-structure" title="Permanent link">&para;</a></h3>
<p>Every MCP resource has a consistent structure with metadata that helps LLMs understand what they&rsquo;re accessing:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab04-mcp-resources-__codelineno-2-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">Resource</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab04-mcp-resources-__codelineno-2-2"></a><span class="w">  </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">           </span><span class="c1">// Unique identifier (like a URL)</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab04-mcp-resources-__codelineno-2-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">          </span><span class="c1">// Human-readable title</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab04-mcp-resources-__codelineno-2-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">   </span><span class="c1">// What the resource contains</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab04-mcp-resources-__codelineno-2-5"></a><span class="w">  </span><span class="nx">mimeType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">     </span><span class="c1">// Content type (optional but recommended)</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab04-mcp-resources-__codelineno-2-6"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-resource-content">Resource Content<a class="headerlink" href="#lab04-mcp-resources-resource-content" title="Permanent link">&para;</a></h3>
<p>When a resource is read, it returns structured content:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab04-mcp-resources-__codelineno-3-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">ResourceContent</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab04-mcp-resources-__codelineno-3-2"></a><span class="w">  </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#lab04-mcp-resources-__codelineno-3-3"></a><span class="w">    </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#lab04-mcp-resources-__codelineno-3-4"></a><span class="w">    </span><span class="nx">mimeType?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#lab04-mcp-resources-__codelineno-3-5"></a><span class="w">    </span><span class="nx">text?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// For text content</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#lab04-mcp-resources-__codelineno-3-6"></a><span class="w">    </span><span class="nx">blob?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// For binary content (base64)</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#lab04-mcp-resources-__codelineno-3-7"></a><span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#lab04-mcp-resources-__codelineno-3-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>Key Points:</strong></p>
<ul>
<li>Resources are <strong>read-only</strong> by convention</li>
<li>Content can be <strong>text</strong> or <strong>binary</strong> (base64 encoded)</li>
<li>Multiple content items can be returned for complex resources</li>
<li><code>MIME (Multipurpose Internet Mail Extensions) types</code> help clients handle content appropriately</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-designing-resource-uri-schemes">Designing Resource URI Schemes<a class="headerlink" href="#lab04-mcp-resources-designing-resource-uri-schemes" title="Permanent link">&para;</a></h2>
<p>Effective URI design is crucial for resource organization and discoverability. A good URI scheme should be:</p>
<ul>
<li><strong>Hierarchical</strong>: Reflects data organization</li>
<li><strong>Descriptive</strong>: Self-documenting structure</li>
<li><strong>Consistent</strong>: Follows patterns across similar resources</li>
<li><strong>Extensible</strong>: Allows for future additions</li>
</ul>
<h3 id="lab04-mcp-resources-common-uri-patterns">Common URI Patterns<a class="headerlink" href="#lab04-mcp-resources-common-uri-patterns" title="Permanent link">&para;</a></h3>
<h4 id="lab04-mcp-resources-file-system-resources">File System Resources<a class="headerlink" href="#lab04-mcp-resources-file-system-resources" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab04-mcp-resources-__codelineno-4-1"></a>file:///project/src/index.ts
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#lab04-mcp-resources-__codelineno-4-2"></a>file:///docs/api-reference.md
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#lab04-mcp-resources-__codelineno-4-3"></a>file:///config/database.json
</span></code></pre></div>
<h4 id="lab04-mcp-resources-database-resources">Database Resources<a class="headerlink" href="#lab04-mcp-resources-database-resources" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab04-mcp-resources-__codelineno-5-1"></a>db://users/123/profile
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab04-mcp-resources-__codelineno-5-2"></a>db://products/category/electronics
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#lab04-mcp-resources-__codelineno-5-3"></a>db://orders/recent?limit=10
</span></code></pre></div>
<h4 id="lab04-mcp-resources-api-documentation">API Documentation<a class="headerlink" href="#lab04-mcp-resources-api-documentation" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab04-mcp-resources-__codelineno-6-1"></a>api://petstore/v1/swagger.json
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab04-mcp-resources-__codelineno-6-2"></a>api://github/repos/microsoft/vscode/issues
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#lab04-mcp-resources-__codelineno-6-3"></a>api://weather/current/london
</span></code></pre></div>
<h4 id="lab04-mcp-resources-configuration-resources">Configuration Resources<a class="headerlink" href="#lab04-mcp-resources-configuration-resources" title="Permanent link">&para;</a></h4>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab04-mcp-resources-__codelineno-7-1"></a>config://app/settings
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab04-mcp-resources-__codelineno-7-2"></a>config://database/connection
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#lab04-mcp-resources-__codelineno-7-3"></a>config://logging/level
</span></code></pre></div>
<h3 id="lab04-mcp-resources-uri-design-best-practices">URI Design Best Practices<a class="headerlink" href="#lab04-mcp-resources-uri-design-best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Use descriptive paths</strong>: <code>users/active</code> vs <code>u/a</code></li>
<li><strong>Include identifiers</strong>: <code>orders/123</code> vs <code>current-order</code></li>
<li><strong>Support hierarchies</strong>: <code>docs/api/v1/endpoints</code></li>
<li><strong>Use query parameters moderately</strong>: Prefer path segments</li>
<li><strong>Be consistent</strong>: Same patterns for similar resources</li>
</ol>
<hr />
<h2 id="lab04-mcp-resources-implementing-static-resources">Implementing Static Resources<a class="headerlink" href="#lab04-mcp-resources-implementing-static-resources" title="Permanent link">&para;</a></h2>
<p>Static resources represent fixed data that doesn&rsquo;t change or changes infrequently. They&rsquo;re perfect for documentation, configuration files, and reference data.</p>
<h3 id="lab04-mcp-resources-complete-static-resource-server">Complete Static Resource Server<a class="headerlink" href="#lab04-mcp-resources-complete-static-resource-server" title="Permanent link">&para;</a></h3>
<p>Here&rsquo;s a complete MCP server that exposes static resources:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab04-mcp-resources-__codelineno-8-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#lab04-mcp-resources-__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#lab04-mcp-resources-__codelineno-8-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#lab04-mcp-resources-__codelineno-8-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#lab04-mcp-resources-__codelineno-8-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#lab04-mcp-resources-__codelineno-8-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#lab04-mcp-resources-__codelineno-8-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#lab04-mcp-resources-__codelineno-8-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#lab04-mcp-resources-__codelineno-8-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#lab04-mcp-resources-__codelineno-8-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#lab04-mcp-resources-__codelineno-8-11"></a>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#lab04-mcp-resources-__codelineno-8-12"></a><span class="cm">/**</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#lab04-mcp-resources-__codelineno-8-13"></a><span class="cm"> * MCP Server exposing static file resources</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#lab04-mcp-resources-__codelineno-8-14"></a><span class="cm"> */</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#lab04-mcp-resources-__codelineno-8-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">StaticResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#lab04-mcp-resources-__codelineno-8-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#lab04-mcp-resources-__codelineno-8-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">resourceRoot</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#lab04-mcp-resources-__codelineno-8-18"></a>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#lab04-mcp-resources-__codelineno-8-19"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">resourceRoot</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./resources&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#lab04-mcp-resources-__codelineno-8-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">resourceRoot</span><span class="p">);</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#lab04-mcp-resources-__codelineno-8-21"></a>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#lab04-mcp-resources-__codelineno-8-22"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#lab04-mcp-resources-__codelineno-8-23"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#lab04-mcp-resources-__codelineno-8-24"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;static-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#lab04-mcp-resources-__codelineno-8-25"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#lab04-mcp-resources-__codelineno-8-26"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#lab04-mcp-resources-__codelineno-8-27"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#lab04-mcp-resources-__codelineno-8-28"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#lab04-mcp-resources-__codelineno-8-29"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#lab04-mcp-resources-__codelineno-8-30"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#lab04-mcp-resources-__codelineno-8-31"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#lab04-mcp-resources-__codelineno-8-32"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#lab04-mcp-resources-__codelineno-8-33"></a>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#lab04-mcp-resources-__codelineno-8-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#lab04-mcp-resources-__codelineno-8-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-8-36"><a id="__codelineno-8-36" name="__codelineno-8-36" href="#lab04-mcp-resources-__codelineno-8-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-37"><a id="__codelineno-8-37" name="__codelineno-8-37" href="#lab04-mcp-resources-__codelineno-8-37"></a>
</span><span id="__span-8-38"><a id="__codelineno-8-38" name="__codelineno-8-38" href="#lab04-mcp-resources-__codelineno-8-38"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-39"><a id="__codelineno-8-39" name="__codelineno-8-39" href="#lab04-mcp-resources-__codelineno-8-39"></a><span class="w">    </span><span class="c1">// List available resources</span>
</span><span id="__span-8-40"><a id="__codelineno-8-40" name="__codelineno-8-40" href="#lab04-mcp-resources-__codelineno-8-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-41"><a id="__codelineno-8-41" name="__codelineno-8-41" href="#lab04-mcp-resources-__codelineno-8-41"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">discoverResources</span><span class="p">();</span>
</span><span id="__span-8-42"><a id="__codelineno-8-42" name="__codelineno-8-42" href="#lab04-mcp-resources-__codelineno-8-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-43"><a id="__codelineno-8-43" name="__codelineno-8-43" href="#lab04-mcp-resources-__codelineno-8-43"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-44"><a id="__codelineno-8-44" name="__codelineno-8-44" href="#lab04-mcp-resources-__codelineno-8-44"></a>
</span><span id="__span-8-45"><a id="__codelineno-8-45" name="__codelineno-8-45" href="#lab04-mcp-resources-__codelineno-8-45"></a><span class="w">    </span><span class="c1">// Read specific resource</span>
</span><span id="__span-8-46"><a id="__codelineno-8-46" name="__codelineno-8-46" href="#lab04-mcp-resources-__codelineno-8-46"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-47"><a id="__codelineno-8-47" name="__codelineno-8-47" href="#lab04-mcp-resources-__codelineno-8-47"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-8-48"><a id="__codelineno-8-48" name="__codelineno-8-48" href="#lab04-mcp-resources-__codelineno-8-48"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-8-49"><a id="__codelineno-8-49" name="__codelineno-8-49" href="#lab04-mcp-resources-__codelineno-8-49"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-8-50"><a id="__codelineno-8-50" name="__codelineno-8-50" href="#lab04-mcp-resources-__codelineno-8-50"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-51"><a id="__codelineno-8-51" name="__codelineno-8-51" href="#lab04-mcp-resources-__codelineno-8-51"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-52"><a id="__codelineno-8-52" name="__codelineno-8-52" href="#lab04-mcp-resources-__codelineno-8-52"></a>
</span><span id="__span-8-53"><a id="__codelineno-8-53" name="__codelineno-8-53" href="#lab04-mcp-resources-__codelineno-8-53"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">discoverResources</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-54"><a id="__codelineno-8-54" name="__codelineno-8-54" href="#lab04-mcp-resources-__codelineno-8-54"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-8-55"><a id="__codelineno-8-55" name="__codelineno-8-55" href="#lab04-mcp-resources-__codelineno-8-55"></a>
</span><span id="__span-8-56"><a id="__codelineno-8-56" name="__codelineno-8-56" href="#lab04-mcp-resources-__codelineno-8-56"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-57"><a id="__codelineno-8-57" name="__codelineno-8-57" href="#lab04-mcp-resources-__codelineno-8-57"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">);</span>
</span><span id="__span-8-58"><a id="__codelineno-8-58" name="__codelineno-8-58" href="#lab04-mcp-resources-__codelineno-8-58"></a>
</span><span id="__span-8-59"><a id="__codelineno-8-59" name="__codelineno-8-59" href="#lab04-mcp-resources-__codelineno-8-59"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-60"><a id="__codelineno-8-60" name="__codelineno-8-60" href="#lab04-mcp-resources-__codelineno-8-60"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-8-61"><a id="__codelineno-8-61" name="__codelineno-8-61" href="#lab04-mcp-resources-__codelineno-8-61"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`file:///</span><span class="si">${</span><span class="nx">relativePath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-8-62"><a id="__codelineno-8-62" name="__codelineno-8-62" href="#lab04-mcp-resources-__codelineno-8-62"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-8-63"><a id="__codelineno-8-63" name="__codelineno-8-63" href="#lab04-mcp-resources-__codelineno-8-63"></a>
</span><span id="__span-8-64"><a id="__codelineno-8-64" name="__codelineno-8-64" href="#lab04-mcp-resources-__codelineno-8-64"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-8-65"><a id="__codelineno-8-65" name="__codelineno-8-65" href="#lab04-mcp-resources-__codelineno-8-65"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-8-66"><a id="__codelineno-8-66" name="__codelineno-8-66" href="#lab04-mcp-resources-__codelineno-8-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">path.basename</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span>
</span><span id="__span-8-67"><a id="__codelineno-8-67" name="__codelineno-8-67" href="#lab04-mcp-resources-__codelineno-8-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Static file: </span><span class="si">${</span><span class="nx">relativePath</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-8-68"><a id="__codelineno-8-68" name="__codelineno-8-68" href="#lab04-mcp-resources-__codelineno-8-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-8-69"><a id="__codelineno-8-69" name="__codelineno-8-69" href="#lab04-mcp-resources-__codelineno-8-69"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-8-70"><a id="__codelineno-8-70" name="__codelineno-8-70" href="#lab04-mcp-resources-__codelineno-8-70"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-71"><a id="__codelineno-8-71" name="__codelineno-8-71" href="#lab04-mcp-resources-__codelineno-8-71"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-72"><a id="__codelineno-8-72" name="__codelineno-8-72" href="#lab04-mcp-resources-__codelineno-8-72"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error discovering resources:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-73"><a id="__codelineno-8-73" name="__codelineno-8-73" href="#lab04-mcp-resources-__codelineno-8-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-74"><a id="__codelineno-8-74" name="__codelineno-8-74" href="#lab04-mcp-resources-__codelineno-8-74"></a>
</span><span id="__span-8-75"><a id="__codelineno-8-75" name="__codelineno-8-75" href="#lab04-mcp-resources-__codelineno-8-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">resources</span><span class="p">;</span>
</span><span id="__span-8-76"><a id="__codelineno-8-76" name="__codelineno-8-76" href="#lab04-mcp-resources-__codelineno-8-76"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-77"><a id="__codelineno-8-77" name="__codelineno-8-77" href="#lab04-mcp-resources-__codelineno-8-77"></a>
</span><span id="__span-8-78"><a id="__codelineno-8-78" name="__codelineno-8-78" href="#lab04-mcp-resources-__codelineno-8-78"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-79"><a id="__codelineno-8-79" name="__codelineno-8-79" href="#lab04-mcp-resources-__codelineno-8-79"></a><span class="w">    </span><span class="c1">// Validate URI format</span>
</span><span id="__span-8-80"><a id="__codelineno-8-80" name="__codelineno-8-80" href="#lab04-mcp-resources-__codelineno-8-80"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-81"><a id="__codelineno-8-81" name="__codelineno-8-81" href="#lab04-mcp-resources-__codelineno-8-81"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid URI format: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-8-82"><a id="__codelineno-8-82" name="__codelineno-8-82" href="#lab04-mcp-resources-__codelineno-8-82"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-83"><a id="__codelineno-8-83" name="__codelineno-8-83" href="#lab04-mcp-resources-__codelineno-8-83"></a>
</span><span id="__span-8-84"><a id="__codelineno-8-84" name="__codelineno-8-84" href="#lab04-mcp-resources-__codelineno-8-84"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-8-85"><a id="__codelineno-8-85" name="__codelineno-8-85" href="#lab04-mcp-resources-__codelineno-8-85"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">,</span><span class="w"> </span><span class="nx">relativePath</span><span class="p">);</span>
</span><span id="__span-8-86"><a id="__codelineno-8-86" name="__codelineno-8-86" href="#lab04-mcp-resources-__codelineno-8-86"></a>
</span><span id="__span-8-87"><a id="__codelineno-8-87" name="__codelineno-8-87" href="#lab04-mcp-resources-__codelineno-8-87"></a><span class="w">    </span><span class="c1">// Security: Prevent directory traversal</span>
</span><span id="__span-8-88"><a id="__codelineno-8-88" name="__codelineno-8-88" href="#lab04-mcp-resources-__codelineno-8-88"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-8-89"><a id="__codelineno-8-89" name="__codelineno-8-89" href="#lab04-mcp-resources-__codelineno-8-89"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-90"><a id="__codelineno-8-90" name="__codelineno-8-90" href="#lab04-mcp-resources-__codelineno-8-90"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Access denied: path outside resource root&#39;</span><span class="p">);</span>
</span><span id="__span-8-91"><a id="__codelineno-8-91" name="__codelineno-8-91" href="#lab04-mcp-resources-__codelineno-8-91"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-92"><a id="__codelineno-8-92" name="__codelineno-8-92" href="#lab04-mcp-resources-__codelineno-8-92"></a>
</span><span id="__span-8-93"><a id="__codelineno-8-93" name="__codelineno-8-93" href="#lab04-mcp-resources-__codelineno-8-93"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-94"><a id="__codelineno-8-94" name="__codelineno-8-94" href="#lab04-mcp-resources-__codelineno-8-94"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
</span><span id="__span-8-95"><a id="__codelineno-8-95" name="__codelineno-8-95" href="#lab04-mcp-resources-__codelineno-8-95"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-8-96"><a id="__codelineno-8-96" name="__codelineno-8-96" href="#lab04-mcp-resources-__codelineno-8-96"></a>
</span><span id="__span-8-97"><a id="__codelineno-8-97" name="__codelineno-8-97" href="#lab04-mcp-resources-__codelineno-8-97"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-98"><a id="__codelineno-8-98" name="__codelineno-8-98" href="#lab04-mcp-resources-__codelineno-8-98"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-8-99"><a id="__codelineno-8-99" name="__codelineno-8-99" href="#lab04-mcp-resources-__codelineno-8-99"></a><span class="w">        </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-8-100"><a id="__codelineno-8-100" name="__codelineno-8-100" href="#lab04-mcp-resources-__codelineno-8-100"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
</span><span id="__span-8-101"><a id="__codelineno-8-101" name="__codelineno-8-101" href="#lab04-mcp-resources-__codelineno-8-101"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-8-102"><a id="__codelineno-8-102" name="__codelineno-8-102" href="#lab04-mcp-resources-__codelineno-8-102"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-103"><a id="__codelineno-8-103" name="__codelineno-8-103" href="#lab04-mcp-resources-__codelineno-8-103"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to read resource: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-8-104"><a id="__codelineno-8-104" name="__codelineno-8-104" href="#lab04-mcp-resources-__codelineno-8-104"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-105"><a id="__codelineno-8-105" name="__codelineno-8-105" href="#lab04-mcp-resources-__codelineno-8-105"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-106"><a id="__codelineno-8-106" name="__codelineno-8-106" href="#lab04-mcp-resources-__codelineno-8-106"></a>
</span><span id="__span-8-107"><a id="__codelineno-8-107" name="__codelineno-8-107" href="#lab04-mcp-resources-__codelineno-8-107"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">dir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-108"><a id="__codelineno-8-108" name="__codelineno-8-108" href="#lab04-mcp-resources-__codelineno-8-108"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-8-109"><a id="__codelineno-8-109" name="__codelineno-8-109" href="#lab04-mcp-resources-__codelineno-8-109"></a>
</span><span id="__span-8-110"><a id="__codelineno-8-110" name="__codelineno-8-110" href="#lab04-mcp-resources-__codelineno-8-110"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-111"><a id="__codelineno-8-111" name="__codelineno-8-111" href="#lab04-mcp-resources-__codelineno-8-111"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">withFileTypes</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-8-112"><a id="__codelineno-8-112" name="__codelineno-8-112" href="#lab04-mcp-resources-__codelineno-8-112"></a>
</span><span id="__span-8-113"><a id="__codelineno-8-113" name="__codelineno-8-113" href="#lab04-mcp-resources-__codelineno-8-113"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-114"><a id="__codelineno-8-114" name="__codelineno-8-114" href="#lab04-mcp-resources-__codelineno-8-114"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-8-115"><a id="__codelineno-8-115" name="__codelineno-8-115" href="#lab04-mcp-resources-__codelineno-8-115"></a>
</span><span id="__span-8-116"><a id="__codelineno-8-116" name="__codelineno-8-116" href="#lab04-mcp-resources-__codelineno-8-116"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-117"><a id="__codelineno-8-117" name="__codelineno-8-117" href="#lab04-mcp-resources-__codelineno-8-117"></a><span class="w">          </span><span class="c1">// Skip hidden directories and node_modules</span>
</span><span id="__span-8-118"><a id="__codelineno-8-118" name="__codelineno-8-118" href="#lab04-mcp-resources-__codelineno-8-118"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;node_modules&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-119"><a id="__codelineno-8-119" name="__codelineno-8-119" href="#lab04-mcp-resources-__codelineno-8-119"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">));</span>
</span><span id="__span-8-120"><a id="__codelineno-8-120" name="__codelineno-8-120" href="#lab04-mcp-resources-__codelineno-8-120"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-8-121"><a id="__codelineno-8-121" name="__codelineno-8-121" href="#lab04-mcp-resources-__codelineno-8-121"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-122"><a id="__codelineno-8-122" name="__codelineno-8-122" href="#lab04-mcp-resources-__codelineno-8-122"></a><span class="w">          </span><span class="c1">// Only include certain file types</span>
</span><span id="__span-8-123"><a id="__codelineno-8-123" name="__codelineno-8-123" href="#lab04-mcp-resources-__codelineno-8-123"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-8-124"><a id="__codelineno-8-124" name="__codelineno-8-124" href="#lab04-mcp-resources-__codelineno-8-124"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">([</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.yaml&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.yml&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.js&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.ts&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.css&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.html&#39;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-125"><a id="__codelineno-8-125" name="__codelineno-8-125" href="#lab04-mcp-resources-__codelineno-8-125"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">);</span>
</span><span id="__span-8-126"><a id="__codelineno-8-126" name="__codelineno-8-126" href="#lab04-mcp-resources-__codelineno-8-126"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-8-127"><a id="__codelineno-8-127" name="__codelineno-8-127" href="#lab04-mcp-resources-__codelineno-8-127"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-8-128"><a id="__codelineno-8-128" name="__codelineno-8-128" href="#lab04-mcp-resources-__codelineno-8-128"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-8-129"><a id="__codelineno-8-129" name="__codelineno-8-129" href="#lab04-mcp-resources-__codelineno-8-129"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-130"><a id="__codelineno-8-130" name="__codelineno-8-130" href="#lab04-mcp-resources-__codelineno-8-130"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error walking directory </span><span class="si">${</span><span class="nx">dir</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-131"><a id="__codelineno-8-131" name="__codelineno-8-131" href="#lab04-mcp-resources-__codelineno-8-131"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-8-132"><a id="__codelineno-8-132" name="__codelineno-8-132" href="#lab04-mcp-resources-__codelineno-8-132"></a>
</span><span id="__span-8-133"><a id="__codelineno-8-133" name="__codelineno-8-133" href="#lab04-mcp-resources-__codelineno-8-133"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">files</span><span class="p">;</span>
</span><span id="__span-8-134"><a id="__codelineno-8-134" name="__codelineno-8-134" href="#lab04-mcp-resources-__codelineno-8-134"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-135"><a id="__codelineno-8-135" name="__codelineno-8-135" href="#lab04-mcp-resources-__codelineno-8-135"></a>
</span><span id="__span-8-136"><a id="__codelineno-8-136" name="__codelineno-8-136" href="#lab04-mcp-resources-__codelineno-8-136"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-137"><a id="__codelineno-8-137" name="__codelineno-8-137" href="#lab04-mcp-resources-__codelineno-8-137"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-8-138"><a id="__codelineno-8-138" name="__codelineno-8-138" href="#lab04-mcp-resources-__codelineno-8-138"></a>
</span><span id="__span-8-139"><a id="__codelineno-8-139" name="__codelineno-8-139" href="#lab04-mcp-resources-__codelineno-8-139"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-140"><a id="__codelineno-8-140" name="__codelineno-8-140" href="#lab04-mcp-resources-__codelineno-8-140"></a><span class="w">      </span><span class="s1">&#39;.md&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/markdown&#39;</span><span class="p">,</span>
</span><span id="__span-8-141"><a id="__codelineno-8-141" name="__codelineno-8-141" href="#lab04-mcp-resources-__codelineno-8-141"></a><span class="w">      </span><span class="s1">&#39;.txt&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
</span><span id="__span-8-142"><a id="__codelineno-8-142" name="__codelineno-8-142" href="#lab04-mcp-resources-__codelineno-8-142"></a><span class="w">      </span><span class="s1">&#39;.json&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-8-143"><a id="__codelineno-8-143" name="__codelineno-8-143" href="#lab04-mcp-resources-__codelineno-8-143"></a><span class="w">      </span><span class="s1">&#39;.yaml&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/yaml&#39;</span><span class="p">,</span>
</span><span id="__span-8-144"><a id="__codelineno-8-144" name="__codelineno-8-144" href="#lab04-mcp-resources-__codelineno-8-144"></a><span class="w">      </span><span class="s1">&#39;.yml&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/yaml&#39;</span><span class="p">,</span>
</span><span id="__span-8-145"><a id="__codelineno-8-145" name="__codelineno-8-145" href="#lab04-mcp-resources-__codelineno-8-145"></a><span class="w">      </span><span class="s1">&#39;.js&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/javascript&#39;</span><span class="p">,</span>
</span><span id="__span-8-146"><a id="__codelineno-8-146" name="__codelineno-8-146" href="#lab04-mcp-resources-__codelineno-8-146"></a><span class="w">      </span><span class="s1">&#39;.ts&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/typescript&#39;</span><span class="p">,</span>
</span><span id="__span-8-147"><a id="__codelineno-8-147" name="__codelineno-8-147" href="#lab04-mcp-resources-__codelineno-8-147"></a><span class="w">      </span><span class="s1">&#39;.css&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/css&#39;</span><span class="p">,</span>
</span><span id="__span-8-148"><a id="__codelineno-8-148" name="__codelineno-8-148" href="#lab04-mcp-resources-__codelineno-8-148"></a><span class="w">      </span><span class="s1">&#39;.html&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/html&#39;</span><span class="p">,</span>
</span><span id="__span-8-149"><a id="__codelineno-8-149" name="__codelineno-8-149" href="#lab04-mcp-resources-__codelineno-8-149"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-8-150"><a id="__codelineno-8-150" name="__codelineno-8-150" href="#lab04-mcp-resources-__codelineno-8-150"></a>
</span><span id="__span-8-151"><a id="__codelineno-8-151" name="__codelineno-8-151" href="#lab04-mcp-resources-__codelineno-8-151"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="p">[</span><span class="nx">ext</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">;</span>
</span><span id="__span-8-152"><a id="__codelineno-8-152" name="__codelineno-8-152" href="#lab04-mcp-resources-__codelineno-8-152"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-153"><a id="__codelineno-8-153" name="__codelineno-8-153" href="#lab04-mcp-resources-__codelineno-8-153"></a>
</span><span id="__span-8-154"><a id="__codelineno-8-154" name="__codelineno-8-154" href="#lab04-mcp-resources-__codelineno-8-154"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-155"><a id="__codelineno-8-155" name="__codelineno-8-155" href="#lab04-mcp-resources-__codelineno-8-155"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-156"><a id="__codelineno-8-156" name="__codelineno-8-156" href="#lab04-mcp-resources-__codelineno-8-156"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-157"><a id="__codelineno-8-157" name="__codelineno-8-157" href="#lab04-mcp-resources-__codelineno-8-157"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-8-158"><a id="__codelineno-8-158" name="__codelineno-8-158" href="#lab04-mcp-resources-__codelineno-8-158"></a>
</span><span id="__span-8-159"><a id="__codelineno-8-159" name="__codelineno-8-159" href="#lab04-mcp-resources-__codelineno-8-159"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-160"><a id="__codelineno-8-160" name="__codelineno-8-160" href="#lab04-mcp-resources-__codelineno-8-160"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-8-161"><a id="__codelineno-8-161" name="__codelineno-8-161" href="#lab04-mcp-resources-__codelineno-8-161"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-8-162"><a id="__codelineno-8-162" name="__codelineno-8-162" href="#lab04-mcp-resources-__codelineno-8-162"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-8-163"><a id="__codelineno-8-163" name="__codelineno-8-163" href="#lab04-mcp-resources-__codelineno-8-163"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-164"><a id="__codelineno-8-164" name="__codelineno-8-164" href="#lab04-mcp-resources-__codelineno-8-164"></a>
</span><span id="__span-8-165"><a id="__codelineno-8-165" name="__codelineno-8-165" href="#lab04-mcp-resources-__codelineno-8-165"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-166"><a id="__codelineno-8-166" name="__codelineno-8-166" href="#lab04-mcp-resources-__codelineno-8-166"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-8-167"><a id="__codelineno-8-167" name="__codelineno-8-167" href="#lab04-mcp-resources-__codelineno-8-167"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-8-168"><a id="__codelineno-8-168" name="__codelineno-8-168" href="#lab04-mcp-resources-__codelineno-8-168"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Static Resource Server running on stdio (root: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">resourceRoot</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-8-169"><a id="__codelineno-8-169" name="__codelineno-8-169" href="#lab04-mcp-resources-__codelineno-8-169"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-8-170"><a id="__codelineno-8-170" name="__codelineno-8-170" href="#lab04-mcp-resources-__codelineno-8-170"></a><span class="p">}</span>
</span><span id="__span-8-171"><a id="__codelineno-8-171" name="__codelineno-8-171" href="#lab04-mcp-resources-__codelineno-8-171"></a>
</span><span id="__span-8-172"><a id="__codelineno-8-172" name="__codelineno-8-172" href="#lab04-mcp-resources-__codelineno-8-172"></a><span class="c1">// Main entry point</span>
</span><span id="__span-8-173"><a id="__codelineno-8-173" name="__codelineno-8-173" href="#lab04-mcp-resources-__codelineno-8-173"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-174"><a id="__codelineno-8-174" name="__codelineno-8-174" href="#lab04-mcp-resources-__codelineno-8-174"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StaticResourceServer</span><span class="p">();</span>
</span><span id="__span-8-175"><a id="__codelineno-8-175" name="__codelineno-8-175" href="#lab04-mcp-resources-__codelineno-8-175"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-8-176"><a id="__codelineno-8-176" name="__codelineno-8-176" href="#lab04-mcp-resources-__codelineno-8-176"></a><span class="p">}</span>
</span><span id="__span-8-177"><a id="__codelineno-8-177" name="__codelineno-8-177" href="#lab04-mcp-resources-__codelineno-8-177"></a>
</span><span id="__span-8-178"><a id="__codelineno-8-178" name="__codelineno-8-178" href="#lab04-mcp-resources-__codelineno-8-178"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-179"><a id="__codelineno-8-179" name="__codelineno-8-179" href="#lab04-mcp-resources-__codelineno-8-179"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-8-180"><a id="__codelineno-8-180" name="__codelineno-8-180" href="#lab04-mcp-resources-__codelineno-8-180"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-8-181"><a id="__codelineno-8-181" name="__codelineno-8-181" href="#lab04-mcp-resources-__codelineno-8-181"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-testing-static-resources">Testing Static Resources<a class="headerlink" href="#lab04-mcp-resources-testing-static-resources" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Create Test Resources</strong></p>
<p>First, let&rsquo;s create some test files that our static resource server can expose. These files will simulate a typical project structure with documentation, configuration, and general project files.</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab04-mcp-resources-__codelineno-9-1"></a><span class="c1"># Create the directory structure</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#lab04-mcp-resources-__codelineno-9-2"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>resources/docs<span class="w"> </span>resources/config
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#lab04-mcp-resources-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#lab04-mcp-resources-__codelineno-9-4"></a><span class="c1"># Create a markdown documentation file</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#lab04-mcp-resources-__codelineno-9-5"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# API Documentation\n\nThis is the API docs.&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>resources/docs/api.md
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#lab04-mcp-resources-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#lab04-mcp-resources-__codelineno-9-7"></a><span class="c1"># Create a JSON configuration file</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#lab04-mcp-resources-__codelineno-9-8"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;version&quot;: &quot;1.0.0&quot;, &quot;env&quot;: &quot;development&quot;}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>resources/config/settings.json
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#lab04-mcp-resources-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#lab04-mcp-resources-__codelineno-9-10"></a><span class="c1"># Create a plain text README file</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#lab04-mcp-resources-__codelineno-9-11"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Welcome to our project!&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>resources/README.txt
</span></code></pre></div>
<p><strong>What this creates:</strong></p>
<ul>
<li><code>resources/docs/api.md</code> - A markdown file with API documentation</li>
<li><code>resources/config/settings.json</code> - A JSON configuration file with version and environment info</li>
<li><code>resources/README.txt</code> - A plain text file with project information</li>
</ul>
<p><br></p>
<p><strong>Step 2: Start the Server</strong></p>
<p>Now start your MCP server using the MCP Inspector. </p>
<p>This will launch both your server and the testing interface:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab04-mcp-resources-__codelineno-10-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>What to expect:</strong></p>
<ul>
<li>The MCP Inspector window should open in your browser</li>
<li>Your server will start and connect via <code>stdio</code> transport</li>
<li>You should see connection confirmation in the terminal</li>
<li>The inspector interface will show tabs for Resources, Tools, etc.</li>
</ul>
<p><br></p>
<p><strong>Step 3: Test Resource Discovery</strong></p>
<p>In the MCP Inspector, navigate to the <strong>Resources</strong> tab to see what resources your server is exposing.</p>
<ul>
<li>
<p>The MCP Inspector should show resources like:</p>
<ul>
<li><code>file:///docs/api.md</code> - Your API documentation file</li>
<li><code>file:///config/settings.json</code> - Your configuration file</li>
<li><code>file:///README.txt</code> - Your project README</li>
</ul>
</li>
</ul>
<p><strong>What to verify:</strong></p>
<ul>
<li>All three resources should be listed</li>
<li>Each resource should have a descriptive name and description</li>
<li>MIME types should be correctly detected (text/markdown, application/json, text/plain)</li>
<li>URIs should follow the <code>file://</code> scheme with proper paths</li>
</ul>
<p><br></p>
<p><strong>Step 4: Test Resource Reading</strong></p>
<p>Click on each resource in the list to read its content and verify proper handling.</p>
<ul>
<li>
<p>Click on <code>file:///docs/api.md</code>:</p>
<ul>
<li>Should display: &ldquo;# API Documentation\n\nThis is the API docs.&rdquo;</li>
<li>MIME type should be: text/markdown</li>
</ul>
</li>
<li>
<p>Click on <code>file:///config/settings.json</code>:</p>
<ul>
<li>Should display: {&ldquo;version&rdquo;: &ldquo;1.0.0&rdquo;, &ldquo;env&rdquo;: &ldquo;development&rdquo;}</li>
<li>MIME type should be: application/json</li>
</ul>
</li>
<li>
<p>Click on <code>file:///README.txt</code>:</p>
<ul>
<li>Should display: &ldquo;Welcome to our project!&rdquo;</li>
<li>MIME type should be: text/plain</li>
</ul>
</li>
</ul>
<p><strong>Error Testing:</strong></p>
<ul>
<li>Try reading a non-existent resource like <code>file:///does-not-exist.txt</code></li>
<li>Should show an appropriate error message</li>
<li>Verify the server handles invalid URIs gracefully</li>
</ul>
<p><strong>What to learn:</strong></p>
<ul>
<li>Resources provide direct access to file content</li>
<li>MIME types help clients handle different content types</li>
<li>Error handling is important for robust resource servers</li>
<li>The inspector provides a complete testing environment</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-implementing-dynamic-resources">Implementing Dynamic Resources<a class="headerlink" href="#lab04-mcp-resources-implementing-dynamic-resources" title="Permanent link">&para;</a></h2>
<p>Dynamic resources generate content on-demand based on parameters or current state. They&rsquo;re useful for live data, computed views, and parameterized access.</p>
<h3 id="lab04-mcp-resources-resource-templates">Resource Templates<a class="headerlink" href="#lab04-mcp-resources-resource-templates" title="Permanent link">&para;</a></h3>
<p>Resource templates allow parameterized URIs using <code>{parameter}</code> syntax:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab04-mcp-resources-__codelineno-11-1"></a><span class="c1">// Template definition</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab04-mcp-resources-__codelineno-11-2"></a><span class="p">{</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#lab04-mcp-resources-__codelineno-11-3"></a><span class="w">  </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://users/{userId}/profile&quot;</span><span class="p">,</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#lab04-mcp-resources-__codelineno-11-4"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User Profile&quot;</span><span class="p">,</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#lab04-mcp-resources-__codelineno-11-5"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Profile data for a specific user&quot;</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#lab04-mcp-resources-__codelineno-11-6"></a><span class="w">  </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#lab04-mcp-resources-__codelineno-11-7"></a><span class="p">}</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#lab04-mcp-resources-__codelineno-11-8"></a>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#lab04-mcp-resources-__codelineno-11-9"></a><span class="c1">// Generated URIs</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#lab04-mcp-resources-__codelineno-11-10"></a><span class="s2">&quot;db://users/123/profile&quot;</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#lab04-mcp-resources-__codelineno-11-11"></a><span class="s2">&quot;db://users/456/profile&quot;</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-complete-dynamic-resource-server">Complete Dynamic Resource Server<a class="headerlink" href="#lab04-mcp-resources-complete-dynamic-resource-server" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab04-mcp-resources-__codelineno-12-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#lab04-mcp-resources-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#lab04-mcp-resources-__codelineno-12-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#lab04-mcp-resources-__codelineno-12-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#lab04-mcp-resources-__codelineno-12-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#lab04-mcp-resources-__codelineno-12-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#lab04-mcp-resources-__codelineno-12-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#lab04-mcp-resources-__codelineno-12-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#lab04-mcp-resources-__codelineno-12-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#lab04-mcp-resources-__codelineno-12-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#lab04-mcp-resources-__codelineno-12-11"></a>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#lab04-mcp-resources-__codelineno-12-12"></a><span class="cm">/**</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#lab04-mcp-resources-__codelineno-12-13"></a><span class="cm"> * MCP Server with dynamic resources and templates</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#lab04-mcp-resources-__codelineno-12-14"></a><span class="cm"> */</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#lab04-mcp-resources-__codelineno-12-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">DynamicResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#lab04-mcp-resources-__codelineno-12-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#lab04-mcp-resources-__codelineno-12-17"></a>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#lab04-mcp-resources-__codelineno-12-18"></a><span class="w">  </span><span class="c1">// Mock data store</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#lab04-mcp-resources-__codelineno-12-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">users</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#lab04-mcp-resources-__codelineno-12-20"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Alice Johnson&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;alice@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;admin&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#lab04-mcp-resources-__codelineno-12-21"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Bob Smith&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;bob@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#lab04-mcp-resources-__codelineno-12-22"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Charlie Brown&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">email</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;charlie@example.com&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#lab04-mcp-resources-__codelineno-12-23"></a><span class="w">  </span><span class="p">];</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#lab04-mcp-resources-__codelineno-12-24"></a>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#lab04-mcp-resources-__codelineno-12-25"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">products</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#lab04-mcp-resources-__codelineno-12-26"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Laptop&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">999.99</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Electronics&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#lab04-mcp-resources-__codelineno-12-27"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">2</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Book&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">19.99</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Education&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#lab04-mcp-resources-__codelineno-12-28"></a><span class="w">    </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">3</span><span class="p">,</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Coffee Mug&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">price</span><span class="o">:</span><span class="w"> </span><span class="kt">12.50</span><span class="p">,</span><span class="w"> </span><span class="nx">category</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Kitchen&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#lab04-mcp-resources-__codelineno-12-29"></a><span class="w">  </span><span class="p">];</span>
</span><span id="__span-12-30"><a id="__codelineno-12-30" name="__codelineno-12-30" href="#lab04-mcp-resources-__codelineno-12-30"></a>
</span><span id="__span-12-31"><a id="__codelineno-12-31" name="__codelineno-12-31" href="#lab04-mcp-resources-__codelineno-12-31"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-32"><a id="__codelineno-12-32" name="__codelineno-12-32" href="#lab04-mcp-resources-__codelineno-12-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-12-33"><a id="__codelineno-12-33" name="__codelineno-12-33" href="#lab04-mcp-resources-__codelineno-12-33"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-34"><a id="__codelineno-12-34" name="__codelineno-12-34" href="#lab04-mcp-resources-__codelineno-12-34"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dynamic-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-12-35"><a id="__codelineno-12-35" name="__codelineno-12-35" href="#lab04-mcp-resources-__codelineno-12-35"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-12-36"><a id="__codelineno-12-36" name="__codelineno-12-36" href="#lab04-mcp-resources-__codelineno-12-36"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-12-37"><a id="__codelineno-12-37" name="__codelineno-12-37" href="#lab04-mcp-resources-__codelineno-12-37"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-12-38"><a id="__codelineno-12-38" name="__codelineno-12-38" href="#lab04-mcp-resources-__codelineno-12-38"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-39"><a id="__codelineno-12-39" name="__codelineno-12-39" href="#lab04-mcp-resources-__codelineno-12-39"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-12-40"><a id="__codelineno-12-40" name="__codelineno-12-40" href="#lab04-mcp-resources-__codelineno-12-40"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-41"><a id="__codelineno-12-41" name="__codelineno-12-41" href="#lab04-mcp-resources-__codelineno-12-41"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-42"><a id="__codelineno-12-42" name="__codelineno-12-42" href="#lab04-mcp-resources-__codelineno-12-42"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-12-43"><a id="__codelineno-12-43" name="__codelineno-12-43" href="#lab04-mcp-resources-__codelineno-12-43"></a>
</span><span id="__span-12-44"><a id="__codelineno-12-44" name="__codelineno-12-44" href="#lab04-mcp-resources-__codelineno-12-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-12-45"><a id="__codelineno-12-45" name="__codelineno-12-45" href="#lab04-mcp-resources-__codelineno-12-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-12-46"><a id="__codelineno-12-46" name="__codelineno-12-46" href="#lab04-mcp-resources-__codelineno-12-46"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-47"><a id="__codelineno-12-47" name="__codelineno-12-47" href="#lab04-mcp-resources-__codelineno-12-47"></a>
</span><span id="__span-12-48"><a id="__codelineno-12-48" name="__codelineno-12-48" href="#lab04-mcp-resources-__codelineno-12-48"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-49"><a id="__codelineno-12-49" name="__codelineno-12-49" href="#lab04-mcp-resources-__codelineno-12-49"></a><span class="w">    </span><span class="c1">// List resource templates</span>
</span><span id="__span-12-50"><a id="__codelineno-12-50" name="__codelineno-12-50" href="#lab04-mcp-resources-__codelineno-12-50"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-51"><a id="__codelineno-12-51" name="__codelineno-12-51" href="#lab04-mcp-resources-__codelineno-12-51"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-12-52"><a id="__codelineno-12-52" name="__codelineno-12-52" href="#lab04-mcp-resources-__codelineno-12-52"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-53"><a id="__codelineno-12-53" name="__codelineno-12-53" href="#lab04-mcp-resources-__codelineno-12-53"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://users/{userId}/profile&quot;</span><span class="p">,</span>
</span><span id="__span-12-54"><a id="__codelineno-12-54" name="__codelineno-12-54" href="#lab04-mcp-resources-__codelineno-12-54"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User Profile&quot;</span><span class="p">,</span>
</span><span id="__span-12-55"><a id="__codelineno-12-55" name="__codelineno-12-55" href="#lab04-mcp-resources-__codelineno-12-55"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Profile information for a specific user&quot;</span><span class="p">,</span>
</span><span id="__span-12-56"><a id="__codelineno-12-56" name="__codelineno-12-56" href="#lab04-mcp-resources-__codelineno-12-56"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-57"><a id="__codelineno-12-57" name="__codelineno-12-57" href="#lab04-mcp-resources-__codelineno-12-57"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-58"><a id="__codelineno-12-58" name="__codelineno-12-58" href="#lab04-mcp-resources-__codelineno-12-58"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-59"><a id="__codelineno-12-59" name="__codelineno-12-59" href="#lab04-mcp-resources-__codelineno-12-59"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://products/{productId}/details&quot;</span><span class="p">,</span>
</span><span id="__span-12-60"><a id="__codelineno-12-60" name="__codelineno-12-60" href="#lab04-mcp-resources-__codelineno-12-60"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Product Details&quot;</span><span class="p">,</span>
</span><span id="__span-12-61"><a id="__codelineno-12-61" name="__codelineno-12-61" href="#lab04-mcp-resources-__codelineno-12-61"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Detailed information about a product&quot;</span><span class="p">,</span>
</span><span id="__span-12-62"><a id="__codelineno-12-62" name="__codelineno-12-62" href="#lab04-mcp-resources-__codelineno-12-62"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-63"><a id="__codelineno-12-63" name="__codelineno-12-63" href="#lab04-mcp-resources-__codelineno-12-63"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-64"><a id="__codelineno-12-64" name="__codelineno-12-64" href="#lab04-mcp-resources-__codelineno-12-64"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-12-65"><a id="__codelineno-12-65" name="__codelineno-12-65" href="#lab04-mcp-resources-__codelineno-12-65"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://stats/{category}/summary&quot;</span><span class="p">,</span>
</span><span id="__span-12-66"><a id="__codelineno-12-66" name="__codelineno-12-66" href="#lab04-mcp-resources-__codelineno-12-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Category Statistics&quot;</span><span class="p">,</span>
</span><span id="__span-12-67"><a id="__codelineno-12-67" name="__codelineno-12-67" href="#lab04-mcp-resources-__codelineno-12-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Statistical summary for a product category&quot;</span><span class="p">,</span>
</span><span id="__span-12-68"><a id="__codelineno-12-68" name="__codelineno-12-68" href="#lab04-mcp-resources-__codelineno-12-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-69"><a id="__codelineno-12-69" name="__codelineno-12-69" href="#lab04-mcp-resources-__codelineno-12-69"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-12-70"><a id="__codelineno-12-70" name="__codelineno-12-70" href="#lab04-mcp-resources-__codelineno-12-70"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-12-71"><a id="__codelineno-12-71" name="__codelineno-12-71" href="#lab04-mcp-resources-__codelineno-12-71"></a>
</span><span id="__span-12-72"><a id="__codelineno-12-72" name="__codelineno-12-72" href="#lab04-mcp-resources-__codelineno-12-72"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-73"><a id="__codelineno-12-73" name="__codelineno-12-73" href="#lab04-mcp-resources-__codelineno-12-73"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-74"><a id="__codelineno-12-74" name="__codelineno-12-74" href="#lab04-mcp-resources-__codelineno-12-74"></a>
</span><span id="__span-12-75"><a id="__codelineno-12-75" name="__codelineno-12-75" href="#lab04-mcp-resources-__codelineno-12-75"></a><span class="w">    </span><span class="c1">// List available resources (dynamic)</span>
</span><span id="__span-12-76"><a id="__codelineno-12-76" name="__codelineno-12-76" href="#lab04-mcp-resources-__codelineno-12-76"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-77"><a id="__codelineno-12-77" name="__codelineno-12-77" href="#lab04-mcp-resources-__codelineno-12-77"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-12-78"><a id="__codelineno-12-78" name="__codelineno-12-78" href="#lab04-mcp-resources-__codelineno-12-78"></a>
</span><span id="__span-12-79"><a id="__codelineno-12-79" name="__codelineno-12-79" href="#lab04-mcp-resources-__codelineno-12-79"></a><span class="w">      </span><span class="c1">// Add user resources</span>
</span><span id="__span-12-80"><a id="__codelineno-12-80" name="__codelineno-12-80" href="#lab04-mcp-resources-__codelineno-12-80"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-81"><a id="__codelineno-12-81" name="__codelineno-12-81" href="#lab04-mcp-resources-__codelineno-12-81"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-82"><a id="__codelineno-12-82" name="__codelineno-12-82" href="#lab04-mcp-resources-__codelineno-12-82"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://users/</span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/profile`</span><span class="p">,</span>
</span><span id="__span-12-83"><a id="__codelineno-12-83" name="__codelineno-12-83" href="#lab04-mcp-resources-__codelineno-12-83"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`User: </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-84"><a id="__codelineno-12-84" name="__codelineno-12-84" href="#lab04-mcp-resources-__codelineno-12-84"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Profile for </span><span class="si">${</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-85"><a id="__codelineno-12-85" name="__codelineno-12-85" href="#lab04-mcp-resources-__codelineno-12-85"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-86"><a id="__codelineno-12-86" name="__codelineno-12-86" href="#lab04-mcp-resources-__codelineno-12-86"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-87"><a id="__codelineno-12-87" name="__codelineno-12-87" href="#lab04-mcp-resources-__codelineno-12-87"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-88"><a id="__codelineno-12-88" name="__codelineno-12-88" href="#lab04-mcp-resources-__codelineno-12-88"></a>
</span><span id="__span-12-89"><a id="__codelineno-12-89" name="__codelineno-12-89" href="#lab04-mcp-resources-__codelineno-12-89"></a><span class="w">      </span><span class="c1">// Add product resources</span>
</span><span id="__span-12-90"><a id="__codelineno-12-90" name="__codelineno-12-90" href="#lab04-mcp-resources-__codelineno-12-90"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-91"><a id="__codelineno-12-91" name="__codelineno-12-91" href="#lab04-mcp-resources-__codelineno-12-91"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-92"><a id="__codelineno-12-92" name="__codelineno-12-92" href="#lab04-mcp-resources-__codelineno-12-92"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://products/</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">/details`</span><span class="p">,</span>
</span><span id="__span-12-93"><a id="__codelineno-12-93" name="__codelineno-12-93" href="#lab04-mcp-resources-__codelineno-12-93"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`Product: </span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-94"><a id="__codelineno-12-94" name="__codelineno-12-94" href="#lab04-mcp-resources-__codelineno-12-94"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">category</span><span class="si">}</span><span class="sb"> - $</span><span class="si">${</span><span class="nx">product</span><span class="p">.</span><span class="nx">price</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-95"><a id="__codelineno-12-95" name="__codelineno-12-95" href="#lab04-mcp-resources-__codelineno-12-95"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-96"><a id="__codelineno-12-96" name="__codelineno-12-96" href="#lab04-mcp-resources-__codelineno-12-96"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-97"><a id="__codelineno-12-97" name="__codelineno-12-97" href="#lab04-mcp-resources-__codelineno-12-97"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-98"><a id="__codelineno-12-98" name="__codelineno-12-98" href="#lab04-mcp-resources-__codelineno-12-98"></a>
</span><span id="__span-12-99"><a id="__codelineno-12-99" name="__codelineno-12-99" href="#lab04-mcp-resources-__codelineno-12-99"></a><span class="w">      </span><span class="c1">// Add category stats</span>
</span><span id="__span-12-100"><a id="__codelineno-12-100" name="__codelineno-12-100" href="#lab04-mcp-resources-__codelineno-12-100"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">categories</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[...</span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">category</span><span class="p">))];</span>
</span><span id="__span-12-101"><a id="__codelineno-12-101" name="__codelineno-12-101" href="#lab04-mcp-resources-__codelineno-12-101"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">category</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">categories</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-102"><a id="__codelineno-12-102" name="__codelineno-12-102" href="#lab04-mcp-resources-__codelineno-12-102"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-12-103"><a id="__codelineno-12-103" name="__codelineno-12-103" href="#lab04-mcp-resources-__codelineno-12-103"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://stats/</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">/summary`</span><span class="p">,</span>
</span><span id="__span-12-104"><a id="__codelineno-12-104" name="__codelineno-12-104" href="#lab04-mcp-resources-__codelineno-12-104"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb"> Statistics`</span><span class="p">,</span>
</span><span id="__span-12-105"><a id="__codelineno-12-105" name="__codelineno-12-105" href="#lab04-mcp-resources-__codelineno-12-105"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Summary statistics for </span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-12-106"><a id="__codelineno-12-106" name="__codelineno-12-106" href="#lab04-mcp-resources-__codelineno-12-106"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-107"><a id="__codelineno-12-107" name="__codelineno-12-107" href="#lab04-mcp-resources-__codelineno-12-107"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-12-108"><a id="__codelineno-12-108" name="__codelineno-12-108" href="#lab04-mcp-resources-__codelineno-12-108"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-109"><a id="__codelineno-12-109" name="__codelineno-12-109" href="#lab04-mcp-resources-__codelineno-12-109"></a>
</span><span id="__span-12-110"><a id="__codelineno-12-110" name="__codelineno-12-110" href="#lab04-mcp-resources-__codelineno-12-110"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-111"><a id="__codelineno-12-111" name="__codelineno-12-111" href="#lab04-mcp-resources-__codelineno-12-111"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-112"><a id="__codelineno-12-112" name="__codelineno-12-112" href="#lab04-mcp-resources-__codelineno-12-112"></a>
</span><span id="__span-12-113"><a id="__codelineno-12-113" name="__codelineno-12-113" href="#lab04-mcp-resources-__codelineno-12-113"></a><span class="w">    </span><span class="c1">// Read specific resource</span>
</span><span id="__span-12-114"><a id="__codelineno-12-114" name="__codelineno-12-114" href="#lab04-mcp-resources-__codelineno-12-114"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-115"><a id="__codelineno-12-115" name="__codelineno-12-115" href="#lab04-mcp-resources-__codelineno-12-115"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-12-116"><a id="__codelineno-12-116" name="__codelineno-12-116" href="#lab04-mcp-resources-__codelineno-12-116"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generateResourceContent</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-12-117"><a id="__codelineno-12-117" name="__codelineno-12-117" href="#lab04-mcp-resources-__codelineno-12-117"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-12-118"><a id="__codelineno-12-118" name="__codelineno-12-118" href="#lab04-mcp-resources-__codelineno-12-118"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-119"><a id="__codelineno-12-119" name="__codelineno-12-119" href="#lab04-mcp-resources-__codelineno-12-119"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-120"><a id="__codelineno-12-120" name="__codelineno-12-120" href="#lab04-mcp-resources-__codelineno-12-120"></a>
</span><span id="__span-12-121"><a id="__codelineno-12-121" name="__codelineno-12-121" href="#lab04-mcp-resources-__codelineno-12-121"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">generateResourceContent</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-122"><a id="__codelineno-12-122" name="__codelineno-12-122" href="#lab04-mcp-resources-__codelineno-12-122"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span id="__span-12-123"><a id="__codelineno-12-123" name="__codelineno-12-123" href="#lab04-mcp-resources-__codelineno-12-123"></a>
</span><span id="__span-12-124"><a id="__codelineno-12-124" name="__codelineno-12-124" href="#lab04-mcp-resources-__codelineno-12-124"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mf">0</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;db:&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">]</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-125"><a id="__codelineno-12-125" name="__codelineno-12-125" href="#lab04-mcp-resources-__codelineno-12-125"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="kr">type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">2</span><span class="p">];</span>
</span><span id="__span-12-126"><a id="__codelineno-12-126" name="__codelineno-12-126" href="#lab04-mcp-resources-__codelineno-12-126"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">3</span><span class="p">];</span>
</span><span id="__span-12-127"><a id="__codelineno-12-127" name="__codelineno-12-127" href="#lab04-mcp-resources-__codelineno-12-127"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">4</span><span class="p">];</span>
</span><span id="__span-12-128"><a id="__codelineno-12-128" name="__codelineno-12-128" href="#lab04-mcp-resources-__codelineno-12-128"></a>
</span><span id="__span-12-129"><a id="__codelineno-12-129" name="__codelineno-12-129" href="#lab04-mcp-resources-__codelineno-12-129"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="kr">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-130"><a id="__codelineno-12-130" name="__codelineno-12-130" href="#lab04-mcp-resources-__codelineno-12-130"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;users&#39;</span><span class="o">:</span>
</span><span id="__span-12-131"><a id="__codelineno-12-131" name="__codelineno-12-131" href="#lab04-mcp-resources-__codelineno-12-131"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;profile&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-132"><a id="__codelineno-12-132" name="__codelineno-12-132" href="#lab04-mcp-resources-__codelineno-12-132"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">user</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">users</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">u</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">u</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
</span><span id="__span-12-133"><a id="__codelineno-12-133" name="__codelineno-12-133" href="#lab04-mcp-resources-__codelineno-12-133"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`User </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">);</span>
</span><span id="__span-12-134"><a id="__codelineno-12-134" name="__codelineno-12-134" href="#lab04-mcp-resources-__codelineno-12-134"></a>
</span><span id="__span-12-135"><a id="__codelineno-12-135" name="__codelineno-12-135" href="#lab04-mcp-resources-__codelineno-12-135"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-136"><a id="__codelineno-12-136" name="__codelineno-12-136" href="#lab04-mcp-resources-__codelineno-12-136"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-137"><a id="__codelineno-12-137" name="__codelineno-12-137" href="#lab04-mcp-resources-__codelineno-12-137"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-138"><a id="__codelineno-12-138" name="__codelineno-12-138" href="#lab04-mcp-resources-__codelineno-12-138"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-12-139"><a id="__codelineno-12-139" name="__codelineno-12-139" href="#lab04-mcp-resources-__codelineno-12-139"></a><span class="w">                </span><span class="nx">user</span><span class="p">,</span>
</span><span id="__span-12-140"><a id="__codelineno-12-140" name="__codelineno-12-140" href="#lab04-mcp-resources-__codelineno-12-140"></a><span class="w">                </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-141"><a id="__codelineno-12-141" name="__codelineno-12-141" href="#lab04-mcp-resources-__codelineno-12-141"></a><span class="w">                  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-142"><a id="__codelineno-12-142" name="__codelineno-12-142" href="#lab04-mcp-resources-__codelineno-12-142"></a><span class="w">                  </span><span class="nx">source</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dynamic-resource-server&quot;</span>
</span><span id="__span-12-143"><a id="__codelineno-12-143" name="__codelineno-12-143" href="#lab04-mcp-resources-__codelineno-12-143"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-144"><a id="__codelineno-12-144" name="__codelineno-12-144" href="#lab04-mcp-resources-__codelineno-12-144"></a><span class="w">              </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-145"><a id="__codelineno-12-145" name="__codelineno-12-145" href="#lab04-mcp-resources-__codelineno-12-145"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-146"><a id="__codelineno-12-146" name="__codelineno-12-146" href="#lab04-mcp-resources-__codelineno-12-146"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-147"><a id="__codelineno-12-147" name="__codelineno-12-147" href="#lab04-mcp-resources-__codelineno-12-147"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-148"><a id="__codelineno-12-148" name="__codelineno-12-148" href="#lab04-mcp-resources-__codelineno-12-148"></a>
</span><span id="__span-12-149"><a id="__codelineno-12-149" name="__codelineno-12-149" href="#lab04-mcp-resources-__codelineno-12-149"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;products&#39;</span><span class="o">:</span>
</span><span id="__span-12-150"><a id="__codelineno-12-150" name="__codelineno-12-150" href="#lab04-mcp-resources-__codelineno-12-150"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;details&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-151"><a id="__codelineno-12-151" name="__codelineno-12-151" href="#lab04-mcp-resources-__codelineno-12-151"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">product</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">id</span><span class="p">));</span>
</span><span id="__span-12-152"><a id="__codelineno-12-152" name="__codelineno-12-152" href="#lab04-mcp-resources-__codelineno-12-152"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">product</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Product </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb"> not found`</span><span class="p">);</span>
</span><span id="__span-12-153"><a id="__codelineno-12-153" name="__codelineno-12-153" href="#lab04-mcp-resources-__codelineno-12-153"></a>
</span><span id="__span-12-154"><a id="__codelineno-12-154" name="__codelineno-12-154" href="#lab04-mcp-resources-__codelineno-12-154"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-155"><a id="__codelineno-12-155" name="__codelineno-12-155" href="#lab04-mcp-resources-__codelineno-12-155"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-156"><a id="__codelineno-12-156" name="__codelineno-12-156" href="#lab04-mcp-resources-__codelineno-12-156"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-157"><a id="__codelineno-12-157" name="__codelineno-12-157" href="#lab04-mcp-resources-__codelineno-12-157"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-12-158"><a id="__codelineno-12-158" name="__codelineno-12-158" href="#lab04-mcp-resources-__codelineno-12-158"></a><span class="w">                </span><span class="nx">product</span><span class="p">,</span>
</span><span id="__span-12-159"><a id="__codelineno-12-159" name="__codelineno-12-159" href="#lab04-mcp-resources-__codelineno-12-159"></a><span class="w">                </span><span class="nx">metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-160"><a id="__codelineno-12-160" name="__codelineno-12-160" href="#lab04-mcp-resources-__codelineno-12-160"></a><span class="w">                  </span><span class="nx">lastUpdated</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-161"><a id="__codelineno-12-161" name="__codelineno-12-161" href="#lab04-mcp-resources-__codelineno-12-161"></a><span class="w">                  </span><span class="nx">inStock</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.random</span><span class="p">()</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.3</span><span class="w"> </span><span class="c1">// Simulate stock status</span>
</span><span id="__span-12-162"><a id="__codelineno-12-162" name="__codelineno-12-162" href="#lab04-mcp-resources-__codelineno-12-162"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-12-163"><a id="__codelineno-12-163" name="__codelineno-12-163" href="#lab04-mcp-resources-__codelineno-12-163"></a><span class="w">              </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-164"><a id="__codelineno-12-164" name="__codelineno-12-164" href="#lab04-mcp-resources-__codelineno-12-164"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-165"><a id="__codelineno-12-165" name="__codelineno-12-165" href="#lab04-mcp-resources-__codelineno-12-165"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-166"><a id="__codelineno-12-166" name="__codelineno-12-166" href="#lab04-mcp-resources-__codelineno-12-166"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-167"><a id="__codelineno-12-167" name="__codelineno-12-167" href="#lab04-mcp-resources-__codelineno-12-167"></a>
</span><span id="__span-12-168"><a id="__codelineno-12-168" name="__codelineno-12-168" href="#lab04-mcp-resources-__codelineno-12-168"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;stats&#39;</span><span class="o">:</span>
</span><span id="__span-12-169"><a id="__codelineno-12-169" name="__codelineno-12-169" href="#lab04-mcp-resources-__codelineno-12-169"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;summary&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-170"><a id="__codelineno-12-170" name="__codelineno-12-170" href="#lab04-mcp-resources-__codelineno-12-170"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">category</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">id</span><span class="p">;</span>
</span><span id="__span-12-171"><a id="__codelineno-12-171" name="__codelineno-12-171" href="#lab04-mcp-resources-__codelineno-12-171"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">categoryProducts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">products</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">category</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">category</span><span class="p">);</span>
</span><span id="__span-12-172"><a id="__codelineno-12-172" name="__codelineno-12-172" href="#lab04-mcp-resources-__codelineno-12-172"></a>
</span><span id="__span-12-173"><a id="__codelineno-12-173" name="__codelineno-12-173" href="#lab04-mcp-resources-__codelineno-12-173"></a><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-174"><a id="__codelineno-12-174" name="__codelineno-12-174" href="#lab04-mcp-resources-__codelineno-12-174"></a><span class="w">              </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Category &#39;</span><span class="si">${</span><span class="nx">category</span><span class="si">}</span><span class="sb">&#39; not found`</span><span class="p">);</span>
</span><span id="__span-12-175"><a id="__codelineno-12-175" name="__codelineno-12-175" href="#lab04-mcp-resources-__codelineno-12-175"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-12-176"><a id="__codelineno-12-176" name="__codelineno-12-176" href="#lab04-mcp-resources-__codelineno-12-176"></a>
</span><span id="__span-12-177"><a id="__codelineno-12-177" name="__codelineno-12-177" href="#lab04-mcp-resources-__codelineno-12-177"></a><span class="w">            </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-178"><a id="__codelineno-12-178" name="__codelineno-12-178" href="#lab04-mcp-resources-__codelineno-12-178"></a><span class="w">              </span><span class="nx">category</span><span class="p">,</span>
</span><span id="__span-12-179"><a id="__codelineno-12-179" name="__codelineno-12-179" href="#lab04-mcp-resources-__codelineno-12-179"></a><span class="w">              </span><span class="nx">totalProducts</span><span class="o">:</span><span class="w"> </span><span class="kt">categoryProducts.length</span><span class="p">,</span>
</span><span id="__span-12-180"><a id="__codelineno-12-180" name="__codelineno-12-180" href="#lab04-mcp-resources-__codelineno-12-180"></a><span class="w">              </span><span class="nx">averagePrice</span><span class="o">:</span><span class="w"> </span><span class="kt">categoryProducts.reduce</span><span class="p">((</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">p</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">,</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
</span><span id="__span-12-181"><a id="__codelineno-12-181" name="__codelineno-12-181" href="#lab04-mcp-resources-__codelineno-12-181"></a><span class="w">              </span><span class="nx">priceRange</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-182"><a id="__codelineno-12-182" name="__codelineno-12-182" href="#lab04-mcp-resources-__codelineno-12-182"></a><span class="w">                </span><span class="nx">min</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.min</span><span class="p">(...</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">)),</span>
</span><span id="__span-12-183"><a id="__codelineno-12-183" name="__codelineno-12-183" href="#lab04-mcp-resources-__codelineno-12-183"></a><span class="w">                </span><span class="nx">max</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.max</span><span class="p">(...</span><span class="nx">categoryProducts</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">price</span><span class="p">)),</span>
</span><span id="__span-12-184"><a id="__codelineno-12-184" name="__codelineno-12-184" href="#lab04-mcp-resources-__codelineno-12-184"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-12-185"><a id="__codelineno-12-185" name="__codelineno-12-185" href="#lab04-mcp-resources-__codelineno-12-185"></a><span class="w">              </span><span class="nx">generatedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-12-186"><a id="__codelineno-12-186" name="__codelineno-12-186" href="#lab04-mcp-resources-__codelineno-12-186"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-187"><a id="__codelineno-12-187" name="__codelineno-12-187" href="#lab04-mcp-resources-__codelineno-12-187"></a>
</span><span id="__span-12-188"><a id="__codelineno-12-188" name="__codelineno-12-188" href="#lab04-mcp-resources-__codelineno-12-188"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-189"><a id="__codelineno-12-189" name="__codelineno-12-189" href="#lab04-mcp-resources-__codelineno-12-189"></a><span class="w">              </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-12-190"><a id="__codelineno-12-190" name="__codelineno-12-190" href="#lab04-mcp-resources-__codelineno-12-190"></a><span class="w">              </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-12-191"><a id="__codelineno-12-191" name="__codelineno-12-191" href="#lab04-mcp-resources-__codelineno-12-191"></a><span class="w">              </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">stats</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-12-192"><a id="__codelineno-12-192" name="__codelineno-12-192" href="#lab04-mcp-resources-__codelineno-12-192"></a><span class="w">            </span><span class="p">};</span>
</span><span id="__span-12-193"><a id="__codelineno-12-193" name="__codelineno-12-193" href="#lab04-mcp-resources-__codelineno-12-193"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-12-194"><a id="__codelineno-12-194" name="__codelineno-12-194" href="#lab04-mcp-resources-__codelineno-12-194"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
</span><span id="__span-12-195"><a id="__codelineno-12-195" name="__codelineno-12-195" href="#lab04-mcp-resources-__codelineno-12-195"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-12-196"><a id="__codelineno-12-196" name="__codelineno-12-196" href="#lab04-mcp-resources-__codelineno-12-196"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-12-197"><a id="__codelineno-12-197" name="__codelineno-12-197" href="#lab04-mcp-resources-__codelineno-12-197"></a>
</span><span id="__span-12-198"><a id="__codelineno-12-198" name="__codelineno-12-198" href="#lab04-mcp-resources-__codelineno-12-198"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown resource URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-12-199"><a id="__codelineno-12-199" name="__codelineno-12-199" href="#lab04-mcp-resources-__codelineno-12-199"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-200"><a id="__codelineno-12-200" name="__codelineno-12-200" href="#lab04-mcp-resources-__codelineno-12-200"></a>
</span><span id="__span-12-201"><a id="__codelineno-12-201" name="__codelineno-12-201" href="#lab04-mcp-resources-__codelineno-12-201"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-202"><a id="__codelineno-12-202" name="__codelineno-12-202" href="#lab04-mcp-resources-__codelineno-12-202"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-203"><a id="__codelineno-12-203" name="__codelineno-12-203" href="#lab04-mcp-resources-__codelineno-12-203"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-12-204"><a id="__codelineno-12-204" name="__codelineno-12-204" href="#lab04-mcp-resources-__codelineno-12-204"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-12-205"><a id="__codelineno-12-205" name="__codelineno-12-205" href="#lab04-mcp-resources-__codelineno-12-205"></a>
</span><span id="__span-12-206"><a id="__codelineno-12-206" name="__codelineno-12-206" href="#lab04-mcp-resources-__codelineno-12-206"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-207"><a id="__codelineno-12-207" name="__codelineno-12-207" href="#lab04-mcp-resources-__codelineno-12-207"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-12-208"><a id="__codelineno-12-208" name="__codelineno-12-208" href="#lab04-mcp-resources-__codelineno-12-208"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-12-209"><a id="__codelineno-12-209" name="__codelineno-12-209" href="#lab04-mcp-resources-__codelineno-12-209"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-12-210"><a id="__codelineno-12-210" name="__codelineno-12-210" href="#lab04-mcp-resources-__codelineno-12-210"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-211"><a id="__codelineno-12-211" name="__codelineno-12-211" href="#lab04-mcp-resources-__codelineno-12-211"></a>
</span><span id="__span-12-212"><a id="__codelineno-12-212" name="__codelineno-12-212" href="#lab04-mcp-resources-__codelineno-12-212"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-213"><a id="__codelineno-12-213" name="__codelineno-12-213" href="#lab04-mcp-resources-__codelineno-12-213"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-12-214"><a id="__codelineno-12-214" name="__codelineno-12-214" href="#lab04-mcp-resources-__codelineno-12-214"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-12-215"><a id="__codelineno-12-215" name="__codelineno-12-215" href="#lab04-mcp-resources-__codelineno-12-215"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Dynamic Resource Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-12-216"><a id="__codelineno-12-216" name="__codelineno-12-216" href="#lab04-mcp-resources-__codelineno-12-216"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-217"><a id="__codelineno-12-217" name="__codelineno-12-217" href="#lab04-mcp-resources-__codelineno-12-217"></a><span class="p">}</span>
</span><span id="__span-12-218"><a id="__codelineno-12-218" name="__codelineno-12-218" href="#lab04-mcp-resources-__codelineno-12-218"></a>
</span><span id="__span-12-219"><a id="__codelineno-12-219" name="__codelineno-12-219" href="#lab04-mcp-resources-__codelineno-12-219"></a><span class="c1">// Main entry point</span>
</span><span id="__span-12-220"><a id="__codelineno-12-220" name="__codelineno-12-220" href="#lab04-mcp-resources-__codelineno-12-220"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-221"><a id="__codelineno-12-221" name="__codelineno-12-221" href="#lab04-mcp-resources-__codelineno-12-221"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DynamicResourceServer</span><span class="p">();</span>
</span><span id="__span-12-222"><a id="__codelineno-12-222" name="__codelineno-12-222" href="#lab04-mcp-resources-__codelineno-12-222"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-12-223"><a id="__codelineno-12-223" name="__codelineno-12-223" href="#lab04-mcp-resources-__codelineno-12-223"></a><span class="p">}</span>
</span><span id="__span-12-224"><a id="__codelineno-12-224" name="__codelineno-12-224" href="#lab04-mcp-resources-__codelineno-12-224"></a>
</span><span id="__span-12-225"><a id="__codelineno-12-225" name="__codelineno-12-225" href="#lab04-mcp-resources-__codelineno-12-225"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-226"><a id="__codelineno-12-226" name="__codelineno-12-226" href="#lab04-mcp-resources-__codelineno-12-226"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-12-227"><a id="__codelineno-12-227" name="__codelineno-12-227" href="#lab04-mcp-resources-__codelineno-12-227"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-12-228"><a id="__codelineno-12-228" name="__codelineno-12-228" href="#lab04-mcp-resources-__codelineno-12-228"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-testing-dynamic-resources">Testing Dynamic Resources<a class="headerlink" href="#lab04-mcp-resources-testing-dynamic-resources" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Start the Server</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab04-mcp-resources-__codelineno-13-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Step 2: Test Resource Templates</strong></p>
<ul>
<li>Check that templates are listed: <code>db://users/{userId}/profile</code>, etc.</li>
</ul>
<p><strong>Step 3: Test Resource Discovery</strong></p>
<ul>
<li>Should show individual resources for users, products, and categories</li>
</ul>
<p><strong>Step 4: Test Resource Reading</strong></p>
<ul>
<li>Try <code>db://users/1/profile</code> - should return user data</li>
<li>Try <code>db://products/2/details</code> - should return product data</li>
<li>Try <code>db://stats/Electronics/summary</code> - should return category stats</li>
<li>Test invalid URIs to verify error handling</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-resource-subscriptions-for-live-updates">Resource Subscriptions for Live Updates<a class="headerlink" href="#lab04-mcp-resources-resource-subscriptions-for-live-updates" title="Permanent link">&para;</a></h2>
<p>Resource subscriptions enable real-time updates when resource content changes. This is essential for live data, monitoring dashboards, and collaborative environments.</p>
<h3 id="lab04-mcp-resources-subscription-implementation">Subscription Implementation<a class="headerlink" href="#lab04-mcp-resources-subscription-implementation" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab04-mcp-resources-__codelineno-14-1"></a><span class="c1">// Enable subscriptions in server capabilities</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#lab04-mcp-resources-__codelineno-14-2"></a><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#lab04-mcp-resources-__codelineno-14-3"></a><span class="w">  </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#lab04-mcp-resources-__codelineno-14-4"></a><span class="w">    </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#lab04-mcp-resources-__codelineno-14-5"></a><span class="w">      </span><span class="nx">subscribe</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w">  </span><span class="c1">// Enable subscription support</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#lab04-mcp-resources-__codelineno-14-6"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#lab04-mcp-resources-__codelineno-14-7"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#lab04-mcp-resources-__codelineno-14-8"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-complete-subscription-server">Complete Subscription Server<a class="headerlink" href="#lab04-mcp-resources-complete-subscription-server" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab04-mcp-resources-__codelineno-15-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab04-mcp-resources-__codelineno-15-2"></a>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#lab04-mcp-resources-__codelineno-15-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#lab04-mcp-resources-__codelineno-15-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#lab04-mcp-resources-__codelineno-15-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#lab04-mcp-resources-__codelineno-15-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#lab04-mcp-resources-__codelineno-15-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#lab04-mcp-resources-__codelineno-15-8"></a><span class="w">  </span><span class="nx">SubscribeRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#lab04-mcp-resources-__codelineno-15-9"></a><span class="w">  </span><span class="nx">UnsubscribeRequestSchema</span><span class="p">,</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#lab04-mcp-resources-__codelineno-15-10"></a><span class="w">  </span><span class="nx">ResourceUpdatedNotificationSchema</span><span class="p">,</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#lab04-mcp-resources-__codelineno-15-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#lab04-mcp-resources-__codelineno-15-12"></a>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#lab04-mcp-resources-__codelineno-15-13"></a><span class="cm">/**</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#lab04-mcp-resources-__codelineno-15-14"></a><span class="cm"> * MCP Server with resource subscriptions for live updates</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#lab04-mcp-resources-__codelineno-15-15"></a><span class="cm"> */</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#lab04-mcp-resources-__codelineno-15-16"></a><span class="kd">class</span><span class="w"> </span><span class="nx">SubscriptionResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#lab04-mcp-resources-__codelineno-15-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#lab04-mcp-resources-__codelineno-15-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">subscribers</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nb">Set</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span><span class="w"> </span><span class="c1">// uri -&gt; sessionIds</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#lab04-mcp-resources-__codelineno-15-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">updateInterval</span><span class="o">:</span><span class="w"> </span><span class="kt">NodeJS.Timeout</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#lab04-mcp-resources-__codelineno-15-20"></a>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#lab04-mcp-resources-__codelineno-15-21"></a><span class="w">  </span><span class="c1">// Simulated live data</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#lab04-mcp-resources-__codelineno-15-22"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">metrics</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#lab04-mcp-resources-__codelineno-15-23"></a><span class="w">    </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="kt">42</span><span class="p">,</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#lab04-mcp-resources-__codelineno-15-24"></a><span class="w">    </span><span class="nx">serverLoad</span><span class="o">:</span><span class="w"> </span><span class="kt">0.65</span><span class="p">,</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#lab04-mcp-resources-__codelineno-15-25"></a><span class="w">    </span><span class="nx">responseTime</span><span class="o">:</span><span class="w"> </span><span class="kt">120</span><span class="p">,</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#lab04-mcp-resources-__codelineno-15-26"></a><span class="w">    </span><span class="nx">errorRate</span><span class="o">:</span><span class="w"> </span><span class="kt">0.02</span><span class="p">,</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#lab04-mcp-resources-__codelineno-15-27"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#lab04-mcp-resources-__codelineno-15-28"></a>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#lab04-mcp-resources-__codelineno-15-29"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#lab04-mcp-resources-__codelineno-15-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#lab04-mcp-resources-__codelineno-15-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#lab04-mcp-resources-__codelineno-15-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;subscription-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#lab04-mcp-resources-__codelineno-15-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#lab04-mcp-resources-__codelineno-15-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#lab04-mcp-resources-__codelineno-15-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#lab04-mcp-resources-__codelineno-15-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#lab04-mcp-resources-__codelineno-15-37"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#lab04-mcp-resources-__codelineno-15-38"></a><span class="w">            </span><span class="nx">subscribe</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#lab04-mcp-resources-__codelineno-15-39"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#lab04-mcp-resources-__codelineno-15-40"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#lab04-mcp-resources-__codelineno-15-41"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#lab04-mcp-resources-__codelineno-15-42"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#lab04-mcp-resources-__codelineno-15-43"></a>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#lab04-mcp-resources-__codelineno-15-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#lab04-mcp-resources-__codelineno-15-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#lab04-mcp-resources-__codelineno-15-46"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">startMetricsSimulation</span><span class="p">();</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#lab04-mcp-resources-__codelineno-15-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#lab04-mcp-resources-__codelineno-15-48"></a>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#lab04-mcp-resources-__codelineno-15-49"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#lab04-mcp-resources-__codelineno-15-50"></a><span class="w">    </span><span class="c1">// List resources</span>
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#lab04-mcp-resources-__codelineno-15-51"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#lab04-mcp-resources-__codelineno-15-52"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#lab04-mcp-resources-__codelineno-15-53"></a><span class="w">        </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#lab04-mcp-resources-__codelineno-15-54"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55" href="#lab04-mcp-resources-__codelineno-15-55"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metrics://server/active-users&quot;</span><span class="p">,</span>
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56" href="#lab04-mcp-resources-__codelineno-15-56"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Active Users&quot;</span><span class="p">,</span>
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57" href="#lab04-mcp-resources-__codelineno-15-57"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Current number of active users&quot;</span><span class="p">,</span>
</span><span id="__span-15-58"><a id="__codelineno-15-58" name="__codelineno-15-58" href="#lab04-mcp-resources-__codelineno-15-58"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-15-59"><a id="__codelineno-15-59" name="__codelineno-15-59" href="#lab04-mcp-resources-__codelineno-15-59"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-60"><a id="__codelineno-15-60" name="__codelineno-15-60" href="#lab04-mcp-resources-__codelineno-15-60"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-61"><a id="__codelineno-15-61" name="__codelineno-15-61" href="#lab04-mcp-resources-__codelineno-15-61"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metrics://server/load&quot;</span><span class="p">,</span>
</span><span id="__span-15-62"><a id="__codelineno-15-62" name="__codelineno-15-62" href="#lab04-mcp-resources-__codelineno-15-62"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Server Load&quot;</span><span class="p">,</span>
</span><span id="__span-15-63"><a id="__codelineno-15-63" name="__codelineno-15-63" href="#lab04-mcp-resources-__codelineno-15-63"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Current server load percentage&quot;</span><span class="p">,</span>
</span><span id="__span-15-64"><a id="__codelineno-15-64" name="__codelineno-15-64" href="#lab04-mcp-resources-__codelineno-15-64"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-15-65"><a id="__codelineno-15-65" name="__codelineno-15-65" href="#lab04-mcp-resources-__codelineno-15-65"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-66"><a id="__codelineno-15-66" name="__codelineno-15-66" href="#lab04-mcp-resources-__codelineno-15-66"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-67"><a id="__codelineno-15-67" name="__codelineno-15-67" href="#lab04-mcp-resources-__codelineno-15-67"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metrics://server/response-time&quot;</span><span class="p">,</span>
</span><span id="__span-15-68"><a id="__codelineno-15-68" name="__codelineno-15-68" href="#lab04-mcp-resources-__codelineno-15-68"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Response Time&quot;</span><span class="p">,</span>
</span><span id="__span-15-69"><a id="__codelineno-15-69" name="__codelineno-15-69" href="#lab04-mcp-resources-__codelineno-15-69"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Average response time in milliseconds&quot;</span><span class="p">,</span>
</span><span id="__span-15-70"><a id="__codelineno-15-70" name="__codelineno-15-70" href="#lab04-mcp-resources-__codelineno-15-70"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-15-71"><a id="__codelineno-15-71" name="__codelineno-15-71" href="#lab04-mcp-resources-__codelineno-15-71"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-72"><a id="__codelineno-15-72" name="__codelineno-15-72" href="#lab04-mcp-resources-__codelineno-15-72"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-15-73"><a id="__codelineno-15-73" name="__codelineno-15-73" href="#lab04-mcp-resources-__codelineno-15-73"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;metrics://server/error-rate&quot;</span><span class="p">,</span>
</span><span id="__span-15-74"><a id="__codelineno-15-74" name="__codelineno-15-74" href="#lab04-mcp-resources-__codelineno-15-74"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Error Rate&quot;</span><span class="p">,</span>
</span><span id="__span-15-75"><a id="__codelineno-15-75" name="__codelineno-15-75" href="#lab04-mcp-resources-__codelineno-15-75"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Current error rate percentage&quot;</span><span class="p">,</span>
</span><span id="__span-15-76"><a id="__codelineno-15-76" name="__codelineno-15-76" href="#lab04-mcp-resources-__codelineno-15-76"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-15-77"><a id="__codelineno-15-77" name="__codelineno-15-77" href="#lab04-mcp-resources-__codelineno-15-77"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-15-78"><a id="__codelineno-15-78" name="__codelineno-15-78" href="#lab04-mcp-resources-__codelineno-15-78"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-15-79"><a id="__codelineno-15-79" name="__codelineno-15-79" href="#lab04-mcp-resources-__codelineno-15-79"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-15-80"><a id="__codelineno-15-80" name="__codelineno-15-80" href="#lab04-mcp-resources-__codelineno-15-80"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-81"><a id="__codelineno-15-81" name="__codelineno-15-81" href="#lab04-mcp-resources-__codelineno-15-81"></a>
</span><span id="__span-15-82"><a id="__codelineno-15-82" name="__codelineno-15-82" href="#lab04-mcp-resources-__codelineno-15-82"></a><span class="w">    </span><span class="c1">// Read resource</span>
</span><span id="__span-15-83"><a id="__codelineno-15-83" name="__codelineno-15-83" href="#lab04-mcp-resources-__codelineno-15-83"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-84"><a id="__codelineno-15-84" name="__codelineno-15-84" href="#lab04-mcp-resources-__codelineno-15-84"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-85"><a id="__codelineno-15-85" name="__codelineno-15-85" href="#lab04-mcp-resources-__codelineno-15-85"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMetricContent</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-15-86"><a id="__codelineno-15-86" name="__codelineno-15-86" href="#lab04-mcp-resources-__codelineno-15-86"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-15-87"><a id="__codelineno-15-87" name="__codelineno-15-87" href="#lab04-mcp-resources-__codelineno-15-87"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-88"><a id="__codelineno-15-88" name="__codelineno-15-88" href="#lab04-mcp-resources-__codelineno-15-88"></a>
</span><span id="__span-15-89"><a id="__codelineno-15-89" name="__codelineno-15-89" href="#lab04-mcp-resources-__codelineno-15-89"></a><span class="w">    </span><span class="c1">// Subscribe to resource updates</span>
</span><span id="__span-15-90"><a id="__codelineno-15-90" name="__codelineno-15-90" href="#lab04-mcp-resources-__codelineno-15-90"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">SubscribeRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-91"><a id="__codelineno-15-91" name="__codelineno-15-91" href="#lab04-mcp-resources-__codelineno-15-91"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-92"><a id="__codelineno-15-92" name="__codelineno-15-92" href="#lab04-mcp-resources-__codelineno-15-92"></a>
</span><span id="__span-15-93"><a id="__codelineno-15-93" name="__codelineno-15-93" href="#lab04-mcp-resources-__codelineno-15-93"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-94"><a id="__codelineno-15-94" name="__codelineno-15-94" href="#lab04-mcp-resources-__codelineno-15-94"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Set</span><span class="p">());</span>
</span><span id="__span-15-95"><a id="__codelineno-15-95" name="__codelineno-15-95" href="#lab04-mcp-resources-__codelineno-15-95"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-96"><a id="__codelineno-15-96" name="__codelineno-15-96" href="#lab04-mcp-resources-__codelineno-15-96"></a>
</span><span id="__span-15-97"><a id="__codelineno-15-97" name="__codelineno-15-97" href="#lab04-mcp-resources-__codelineno-15-97"></a><span class="w">      </span><span class="c1">// In a real implementation, you&#39;d get the session ID from the request</span>
</span><span id="__span-15-98"><a id="__codelineno-15-98" name="__codelineno-15-98" href="#lab04-mcp-resources-__codelineno-15-98"></a><span class="w">      </span><span class="c1">// For this example, we&#39;ll use a mock session ID</span>
</span><span id="__span-15-99"><a id="__codelineno-15-99" name="__codelineno-15-99" href="#lab04-mcp-resources-__codelineno-15-99"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mock-session&quot;</span><span class="p">;</span>
</span><span id="__span-15-100"><a id="__codelineno-15-100" name="__codelineno-15-100" href="#lab04-mcp-resources-__codelineno-15-100"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
</span><span id="__span-15-101"><a id="__codelineno-15-101" name="__codelineno-15-101" href="#lab04-mcp-resources-__codelineno-15-101"></a>
</span><span id="__span-15-102"><a id="__codelineno-15-102" name="__codelineno-15-102" href="#lab04-mcp-resources-__codelineno-15-102"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Subscribed to </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> (session: </span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-15-103"><a id="__codelineno-15-103" name="__codelineno-15-103" href="#lab04-mcp-resources-__codelineno-15-103"></a>
</span><span id="__span-15-104"><a id="__codelineno-15-104" name="__codelineno-15-104" href="#lab04-mcp-resources-__codelineno-15-104"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-15-105"><a id="__codelineno-15-105" name="__codelineno-15-105" href="#lab04-mcp-resources-__codelineno-15-105"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-106"><a id="__codelineno-15-106" name="__codelineno-15-106" href="#lab04-mcp-resources-__codelineno-15-106"></a>
</span><span id="__span-15-107"><a id="__codelineno-15-107" name="__codelineno-15-107" href="#lab04-mcp-resources-__codelineno-15-107"></a><span class="w">    </span><span class="c1">// Unsubscribe from resource updates</span>
</span><span id="__span-15-108"><a id="__codelineno-15-108" name="__codelineno-15-108" href="#lab04-mcp-resources-__codelineno-15-108"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">UnsubscribeRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-109"><a id="__codelineno-15-109" name="__codelineno-15-109" href="#lab04-mcp-resources-__codelineno-15-109"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-15-110"><a id="__codelineno-15-110" name="__codelineno-15-110" href="#lab04-mcp-resources-__codelineno-15-110"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">sessionId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;mock-session&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Would come from request in real implementation</span>
</span><span id="__span-15-111"><a id="__codelineno-15-111" name="__codelineno-15-111" href="#lab04-mcp-resources-__codelineno-15-111"></a>
</span><span id="__span-15-112"><a id="__codelineno-15-112" name="__codelineno-15-112" href="#lab04-mcp-resources-__codelineno-15-112"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-113"><a id="__codelineno-15-113" name="__codelineno-15-113" href="#lab04-mcp-resources-__codelineno-15-113"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">sessionId</span><span class="p">);</span>
</span><span id="__span-15-114"><a id="__codelineno-15-114" name="__codelineno-15-114" href="#lab04-mcp-resources-__codelineno-15-114"></a>
</span><span id="__span-15-115"><a id="__codelineno-15-115" name="__codelineno-15-115" href="#lab04-mcp-resources-__codelineno-15-115"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span><span class="o">!</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-116"><a id="__codelineno-15-116" name="__codelineno-15-116" href="#lab04-mcp-resources-__codelineno-15-116"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-15-117"><a id="__codelineno-15-117" name="__codelineno-15-117" href="#lab04-mcp-resources-__codelineno-15-117"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-15-118"><a id="__codelineno-15-118" name="__codelineno-15-118" href="#lab04-mcp-resources-__codelineno-15-118"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-119"><a id="__codelineno-15-119" name="__codelineno-15-119" href="#lab04-mcp-resources-__codelineno-15-119"></a>
</span><span id="__span-15-120"><a id="__codelineno-15-120" name="__codelineno-15-120" href="#lab04-mcp-resources-__codelineno-15-120"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Unsubscribed from </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> (session: </span><span class="si">${</span><span class="nx">sessionId</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-15-121"><a id="__codelineno-15-121" name="__codelineno-15-121" href="#lab04-mcp-resources-__codelineno-15-121"></a>
</span><span id="__span-15-122"><a id="__codelineno-15-122" name="__codelineno-15-122" href="#lab04-mcp-resources-__codelineno-15-122"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
</span><span id="__span-15-123"><a id="__codelineno-15-123" name="__codelineno-15-123" href="#lab04-mcp-resources-__codelineno-15-123"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-124"><a id="__codelineno-15-124" name="__codelineno-15-124" href="#lab04-mcp-resources-__codelineno-15-124"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-125"><a id="__codelineno-15-125" name="__codelineno-15-125" href="#lab04-mcp-resources-__codelineno-15-125"></a>
</span><span id="__span-15-126"><a id="__codelineno-15-126" name="__codelineno-15-126" href="#lab04-mcp-resources-__codelineno-15-126"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMetricContent</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-127"><a id="__codelineno-15-127" name="__codelineno-15-127" href="#lab04-mcp-resources-__codelineno-15-127"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">metricName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">).</span><span class="nx">pop</span><span class="p">();</span>
</span><span id="__span-15-128"><a id="__codelineno-15-128" name="__codelineno-15-128" href="#lab04-mcp-resources-__codelineno-15-128"></a>
</span><span id="__span-15-129"><a id="__codelineno-15-129" name="__codelineno-15-129" href="#lab04-mcp-resources-__codelineno-15-129"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">metricName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="o">!</span><span class="p">(</span><span class="nx">metricName</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-130"><a id="__codelineno-15-130" name="__codelineno-15-130" href="#lab04-mcp-resources-__codelineno-15-130"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown metric: </span><span class="si">${</span><span class="nx">metricName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-15-131"><a id="__codelineno-15-131" name="__codelineno-15-131" href="#lab04-mcp-resources-__codelineno-15-131"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-132"><a id="__codelineno-15-132" name="__codelineno-15-132" href="#lab04-mcp-resources-__codelineno-15-132"></a>
</span><span id="__span-15-133"><a id="__codelineno-15-133" name="__codelineno-15-133" href="#lab04-mcp-resources-__codelineno-15-133"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">)[</span><span class="nx">metricName</span><span class="p">];</span>
</span><span id="__span-15-134"><a id="__codelineno-15-134" name="__codelineno-15-134" href="#lab04-mcp-resources-__codelineno-15-134"></a>
</span><span id="__span-15-135"><a id="__codelineno-15-135" name="__codelineno-15-135" href="#lab04-mcp-resources-__codelineno-15-135"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-136"><a id="__codelineno-15-136" name="__codelineno-15-136" href="#lab04-mcp-resources-__codelineno-15-136"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-15-137"><a id="__codelineno-15-137" name="__codelineno-15-137" href="#lab04-mcp-resources-__codelineno-15-137"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-15-138"><a id="__codelineno-15-138" name="__codelineno-15-138" href="#lab04-mcp-resources-__codelineno-15-138"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-15-139"><a id="__codelineno-15-139" name="__codelineno-15-139" href="#lab04-mcp-resources-__codelineno-15-139"></a><span class="w">        </span><span class="nx">metric</span><span class="o">:</span><span class="w"> </span><span class="kt">metricName</span><span class="p">,</span>
</span><span id="__span-15-140"><a id="__codelineno-15-140" name="__codelineno-15-140" href="#lab04-mcp-resources-__codelineno-15-140"></a><span class="w">        </span><span class="nx">value</span><span class="p">,</span>
</span><span id="__span-15-141"><a id="__codelineno-15-141" name="__codelineno-15-141" href="#lab04-mcp-resources-__codelineno-15-141"></a><span class="w">        </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-15-142"><a id="__codelineno-15-142" name="__codelineno-15-142" href="#lab04-mcp-resources-__codelineno-15-142"></a><span class="w">        </span><span class="nx">unit</span><span class="o">:</span><span class="w"> </span><span class="kt">this.getMetricUnit</span><span class="p">(</span><span class="nx">metricName</span><span class="p">),</span>
</span><span id="__span-15-143"><a id="__codelineno-15-143" name="__codelineno-15-143" href="#lab04-mcp-resources-__codelineno-15-143"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-15-144"><a id="__codelineno-15-144" name="__codelineno-15-144" href="#lab04-mcp-resources-__codelineno-15-144"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-145"><a id="__codelineno-15-145" name="__codelineno-15-145" href="#lab04-mcp-resources-__codelineno-15-145"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-146"><a id="__codelineno-15-146" name="__codelineno-15-146" href="#lab04-mcp-resources-__codelineno-15-146"></a>
</span><span id="__span-15-147"><a id="__codelineno-15-147" name="__codelineno-15-147" href="#lab04-mcp-resources-__codelineno-15-147"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMetricUnit</span><span class="p">(</span><span class="nx">metricName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-148"><a id="__codelineno-15-148" name="__codelineno-15-148" href="#lab04-mcp-resources-__codelineno-15-148"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">units</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-149"><a id="__codelineno-15-149" name="__codelineno-15-149" href="#lab04-mcp-resources-__codelineno-15-149"></a><span class="w">      </span><span class="nx">activeUsers</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;users&quot;</span><span class="p">,</span>
</span><span id="__span-15-150"><a id="__codelineno-15-150" name="__codelineno-15-150" href="#lab04-mcp-resources-__codelineno-15-150"></a><span class="w">      </span><span class="nx">serverLoad</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;percentage&quot;</span><span class="p">,</span>
</span><span id="__span-15-151"><a id="__codelineno-15-151" name="__codelineno-15-151" href="#lab04-mcp-resources-__codelineno-15-151"></a><span class="w">      </span><span class="nx">responseTime</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;milliseconds&quot;</span><span class="p">,</span>
</span><span id="__span-15-152"><a id="__codelineno-15-152" name="__codelineno-15-152" href="#lab04-mcp-resources-__codelineno-15-152"></a><span class="w">      </span><span class="nx">errorRate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;percentage&quot;</span><span class="p">,</span>
</span><span id="__span-15-153"><a id="__codelineno-15-153" name="__codelineno-15-153" href="#lab04-mcp-resources-__codelineno-15-153"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-154"><a id="__codelineno-15-154" name="__codelineno-15-154" href="#lab04-mcp-resources-__codelineno-15-154"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">units</span><span class="p">[</span><span class="nx">metricName</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;unit&quot;</span><span class="p">;</span>
</span><span id="__span-15-155"><a id="__codelineno-15-155" name="__codelineno-15-155" href="#lab04-mcp-resources-__codelineno-15-155"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-156"><a id="__codelineno-15-156" name="__codelineno-15-156" href="#lab04-mcp-resources-__codelineno-15-156"></a>
</span><span id="__span-15-157"><a id="__codelineno-15-157" name="__codelineno-15-157" href="#lab04-mcp-resources-__codelineno-15-157"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">startMetricsSimulation</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-158"><a id="__codelineno-15-158" name="__codelineno-15-158" href="#lab04-mcp-resources-__codelineno-15-158"></a><span class="w">    </span><span class="c1">// Simulate changing metrics every 5 seconds</span>
</span><span id="__span-15-159"><a id="__codelineno-15-159" name="__codelineno-15-159" href="#lab04-mcp-resources-__codelineno-15-159"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-160"><a id="__codelineno-15-160" name="__codelineno-15-160" href="#lab04-mcp-resources-__codelineno-15-160"></a><span class="w">      </span><span class="c1">// Randomly update metrics</span>
</span><span id="__span-15-161"><a id="__codelineno-15-161" name="__codelineno-15-161" href="#lab04-mcp-resources-__codelineno-15-161"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span>
</span><span id="__span-15-162"><a id="__codelineno-15-162" name="__codelineno-15-162" href="#lab04-mcp-resources-__codelineno-15-162"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">activeUsers</span><span class="p">);</span>
</span><span id="__span-15-163"><a id="__codelineno-15-163" name="__codelineno-15-163" href="#lab04-mcp-resources-__codelineno-15-163"></a>
</span><span id="__span-15-164"><a id="__codelineno-15-164" name="__codelineno-15-164" href="#lab04-mcp-resources-__codelineno-15-164"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">serverLoad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.3</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0.3 to 0.8</span>
</span><span id="__span-15-165"><a id="__codelineno-15-165" name="__codelineno-15-165" href="#lab04-mcp-resources-__codelineno-15-165"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">responseTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">100</span><span class="p">;</span><span class="w"> </span><span class="c1">// 100-200ms</span>
</span><span id="__span-15-166"><a id="__codelineno-15-166" name="__codelineno-15-166" href="#lab04-mcp-resources-__codelineno-15-166"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">metrics</span><span class="p">.</span><span class="nx">errorRate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">0.05</span><span class="p">;</span><span class="w"> </span><span class="c1">// 0-5%</span>
</span><span id="__span-15-167"><a id="__codelineno-15-167" name="__codelineno-15-167" href="#lab04-mcp-resources-__codelineno-15-167"></a>
</span><span id="__span-15-168"><a id="__codelineno-15-168" name="__codelineno-15-168" href="#lab04-mcp-resources-__codelineno-15-168"></a><span class="w">      </span><span class="c1">// Notify subscribers of updates</span>
</span><span id="__span-15-169"><a id="__codelineno-15-169" name="__codelineno-15-169" href="#lab04-mcp-resources-__codelineno-15-169"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">notifySubscribers</span><span class="p">();</span>
</span><span id="__span-15-170"><a id="__codelineno-15-170" name="__codelineno-15-170" href="#lab04-mcp-resources-__codelineno-15-170"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5000</span><span class="p">);</span>
</span><span id="__span-15-171"><a id="__codelineno-15-171" name="__codelineno-15-171" href="#lab04-mcp-resources-__codelineno-15-171"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-172"><a id="__codelineno-15-172" name="__codelineno-15-172" href="#lab04-mcp-resources-__codelineno-15-172"></a>
</span><span id="__span-15-173"><a id="__codelineno-15-173" name="__codelineno-15-173" href="#lab04-mcp-resources-__codelineno-15-173"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">notifySubscribers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-174"><a id="__codelineno-15-174" name="__codelineno-15-174" href="#lab04-mcp-resources-__codelineno-15-174"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">sessionIds</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">subscribers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-175"><a id="__codelineno-15-175" name="__codelineno-15-175" href="#lab04-mcp-resources-__codelineno-15-175"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">sessionIds</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-176"><a id="__codelineno-15-176" name="__codelineno-15-176" href="#lab04-mcp-resources-__codelineno-15-176"></a><span class="w">        </span><span class="c1">// Send notification to all subscribers of this resource</span>
</span><span id="__span-15-177"><a id="__codelineno-15-177" name="__codelineno-15-177" href="#lab04-mcp-resources-__codelineno-15-177"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">notification</span><span class="p">(</span><span class="nx">ResourceUpdatedNotificationSchema</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-178"><a id="__codelineno-15-178" name="__codelineno-15-178" href="#lab04-mcp-resources-__codelineno-15-178"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-15-179"><a id="__codelineno-15-179" name="__codelineno-15-179" href="#lab04-mcp-resources-__codelineno-15-179"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-15-180"><a id="__codelineno-15-180" name="__codelineno-15-180" href="#lab04-mcp-resources-__codelineno-15-180"></a>
</span><span id="__span-15-181"><a id="__codelineno-15-181" name="__codelineno-15-181" href="#lab04-mcp-resources-__codelineno-15-181"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Notified </span><span class="si">${</span><span class="nx">sessionIds</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> subscribers of </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb"> update`</span><span class="p">);</span>
</span><span id="__span-15-182"><a id="__codelineno-15-182" name="__codelineno-15-182" href="#lab04-mcp-resources-__codelineno-15-182"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-183"><a id="__codelineno-15-183" name="__codelineno-15-183" href="#lab04-mcp-resources-__codelineno-15-183"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-184"><a id="__codelineno-15-184" name="__codelineno-15-184" href="#lab04-mcp-resources-__codelineno-15-184"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-185"><a id="__codelineno-15-185" name="__codelineno-15-185" href="#lab04-mcp-resources-__codelineno-15-185"></a>
</span><span id="__span-15-186"><a id="__codelineno-15-186" name="__codelineno-15-186" href="#lab04-mcp-resources-__codelineno-15-186"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-187"><a id="__codelineno-15-187" name="__codelineno-15-187" href="#lab04-mcp-resources-__codelineno-15-187"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-188"><a id="__codelineno-15-188" name="__codelineno-15-188" href="#lab04-mcp-resources-__codelineno-15-188"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-189"><a id="__codelineno-15-189" name="__codelineno-15-189" href="#lab04-mcp-resources-__codelineno-15-189"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-15-190"><a id="__codelineno-15-190" name="__codelineno-15-190" href="#lab04-mcp-resources-__codelineno-15-190"></a>
</span><span id="__span-15-191"><a id="__codelineno-15-191" name="__codelineno-15-191" href="#lab04-mcp-resources-__codelineno-15-191"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-192"><a id="__codelineno-15-192" name="__codelineno-15-192" href="#lab04-mcp-resources-__codelineno-15-192"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-193"><a id="__codelineno-15-193" name="__codelineno-15-193" href="#lab04-mcp-resources-__codelineno-15-193"></a><span class="w">        </span><span class="nx">clearInterval</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">updateInterval</span><span class="p">);</span>
</span><span id="__span-15-194"><a id="__codelineno-15-194" name="__codelineno-15-194" href="#lab04-mcp-resources-__codelineno-15-194"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-195"><a id="__codelineno-15-195" name="__codelineno-15-195" href="#lab04-mcp-resources-__codelineno-15-195"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-15-196"><a id="__codelineno-15-196" name="__codelineno-15-196" href="#lab04-mcp-resources-__codelineno-15-196"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-15-197"><a id="__codelineno-15-197" name="__codelineno-15-197" href="#lab04-mcp-resources-__codelineno-15-197"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-198"><a id="__codelineno-15-198" name="__codelineno-15-198" href="#lab04-mcp-resources-__codelineno-15-198"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-199"><a id="__codelineno-15-199" name="__codelineno-15-199" href="#lab04-mcp-resources-__codelineno-15-199"></a>
</span><span id="__span-15-200"><a id="__codelineno-15-200" name="__codelineno-15-200" href="#lab04-mcp-resources-__codelineno-15-200"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-201"><a id="__codelineno-15-201" name="__codelineno-15-201" href="#lab04-mcp-resources-__codelineno-15-201"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-15-202"><a id="__codelineno-15-202" name="__codelineno-15-202" href="#lab04-mcp-resources-__codelineno-15-202"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-15-203"><a id="__codelineno-15-203" name="__codelineno-15-203" href="#lab04-mcp-resources-__codelineno-15-203"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Subscription Resource Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-15-204"><a id="__codelineno-15-204" name="__codelineno-15-204" href="#lab04-mcp-resources-__codelineno-15-204"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-205"><a id="__codelineno-15-205" name="__codelineno-15-205" href="#lab04-mcp-resources-__codelineno-15-205"></a><span class="p">}</span>
</span><span id="__span-15-206"><a id="__codelineno-15-206" name="__codelineno-15-206" href="#lab04-mcp-resources-__codelineno-15-206"></a>
</span><span id="__span-15-207"><a id="__codelineno-15-207" name="__codelineno-15-207" href="#lab04-mcp-resources-__codelineno-15-207"></a><span class="c1">// Main entry point</span>
</span><span id="__span-15-208"><a id="__codelineno-15-208" name="__codelineno-15-208" href="#lab04-mcp-resources-__codelineno-15-208"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-209"><a id="__codelineno-15-209" name="__codelineno-15-209" href="#lab04-mcp-resources-__codelineno-15-209"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">SubscriptionResourceServer</span><span class="p">();</span>
</span><span id="__span-15-210"><a id="__codelineno-15-210" name="__codelineno-15-210" href="#lab04-mcp-resources-__codelineno-15-210"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-15-211"><a id="__codelineno-15-211" name="__codelineno-15-211" href="#lab04-mcp-resources-__codelineno-15-211"></a><span class="p">}</span>
</span><span id="__span-15-212"><a id="__codelineno-15-212" name="__codelineno-15-212" href="#lab04-mcp-resources-__codelineno-15-212"></a>
</span><span id="__span-15-213"><a id="__codelineno-15-213" name="__codelineno-15-213" href="#lab04-mcp-resources-__codelineno-15-213"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-214"><a id="__codelineno-15-214" name="__codelineno-15-214" href="#lab04-mcp-resources-__codelineno-15-214"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-215"><a id="__codelineno-15-215" name="__codelineno-15-215" href="#lab04-mcp-resources-__codelineno-15-215"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-15-216"><a id="__codelineno-15-216" name="__codelineno-15-216" href="#lab04-mcp-resources-__codelineno-15-216"></a><span class="p">});</span>
</span></code></pre></div>
<h3 id="lab04-mcp-resources-testing-subscriptions">Testing Subscriptions<a class="headerlink" href="#lab04-mcp-resources-testing-subscriptions" title="Permanent link">&para;</a></h3>
<p><strong>Step 1: Start the Server</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab04-mcp-resources-__codelineno-16-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Step 2: Test Basic Resource Reading</strong></p>
<ul>
<li>Read metrics like <code>metrics://server/active-users</code></li>
<li>Verify they return current values</li>
</ul>
<p><strong>Step 3: Test Subscriptions</strong></p>
<ul>
<li>
<p>Subscribe to a metric resource:</p>
<ul>
<li>In the MCP Inspector Resources tab, find a metric resource (e.g., <code>metrics://server/active-users</code>)</li>
<li>Click the &ldquo;Subscribe&rdquo; button next to the resource</li>
<li>You should see a confirmation that subscription was successful</li>
</ul>
</li>
<li>
<p>Watch the MCP Inspector for update notifications every 5 seconds:</p>
<ul>
<li>Keep the Resources tab open</li>
<li>Look for notification messages in the inspector interface</li>
<li>The metric values should update automatically every 5 seconds</li>
<li>You can also check the console/logs for subscription update messages</li>
</ul>
</li>
<li>
<p>Unsubscribe and verify notifications stop:</p>
<ul>
<li>Click the &ldquo;Unsubscribe&rdquo; button for the same resource</li>
<li>Confirm that update notifications cease</li>
<li>The metric values should stop updating in the interface</li>
</ul>
</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-security-and-access-control">Security and Access Control<a class="headerlink" href="#lab04-mcp-resources-security-and-access-control" title="Permanent link">&para;</a></h2>
<p>Resource security is critical, especially when exposing sensitive data or system information.</p>
<h3 id="lab04-mcp-resources-access-control-patterns">Access Control Patterns<a class="headerlink" href="#lab04-mcp-resources-access-control-patterns" title="Permanent link">&para;</a></h3>
<h4 id="lab04-mcp-resources-1-path-based-authorization">1. Path-Based Authorization<a class="headerlink" href="#lab04-mcp-resources-1-path-based-authorization" title="Permanent link">&para;</a></h4>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab04-mcp-resources-__codelineno-17-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">checkResourceAccess</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">userId?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#lab04-mcp-resources-__codelineno-17-2"></a><span class="w">  </span><span class="c1">// Allow access to own profile</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#lab04-mcp-resources-__codelineno-17-3"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="sb">`users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">/`</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#lab04-mcp-resources-__codelineno-17-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#lab04-mcp-resources-__codelineno-17-5"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#lab04-mcp-resources-__codelineno-17-6"></a>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#lab04-mcp-resources-__codelineno-17-7"></a><span class="w">  </span><span class="c1">// Restrict admin resources</span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#lab04-mcp-resources-__codelineno-17-8"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">isAdmin</span><span class="p">(</span><span class="nx">userId</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#lab04-mcp-resources-__codelineno-17-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#lab04-mcp-resources-__codelineno-17-10"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#lab04-mcp-resources-__codelineno-17-11"></a>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#lab04-mcp-resources-__codelineno-17-12"></a><span class="w">  </span><span class="c1">// Public resources</span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#lab04-mcp-resources-__codelineno-17-13"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;public/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#lab04-mcp-resources-__codelineno-17-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-17-15"><a id="__codelineno-17-15" name="__codelineno-17-15" href="#lab04-mcp-resources-__codelineno-17-15"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-17-16"><a id="__codelineno-17-16" name="__codelineno-17-16" href="#lab04-mcp-resources-__codelineno-17-16"></a>
</span><span id="__span-17-17"><a id="__codelineno-17-17" name="__codelineno-17-17" href="#lab04-mcp-resources-__codelineno-17-17"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-17-18"><a id="__codelineno-17-18" name="__codelineno-17-18" href="#lab04-mcp-resources-__codelineno-17-18"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>How it works:</strong> This method checks if a user has permission to access a resource based on the URI path. It grants access to user-specific resources (like their own profile), restricts admin-only resources unless the user has admin privileges, allows public resources for everyone, and denies access by default for any other paths.</p>
<p><br></p>
<h4 id="lab04-mcp-resources-2-content-filtering">2. Content Filtering<a class="headerlink" href="#lab04-mcp-resources-2-content-filtering" title="Permanent link">&para;</a></h4>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab04-mcp-resources-__codelineno-18-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">filterSensitiveContent</span><span class="p">(</span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">,</span><span class="w"> </span><span class="nx">userRole</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#lab04-mcp-resources-__codelineno-18-2"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">userRole</span><span class="w"> </span><span class="o">!==</span><span class="w"> </span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#lab04-mcp-resources-__codelineno-18-3"></a><span class="w">    </span><span class="c1">// Remove sensitive fields for non-admin users</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#lab04-mcp-resources-__codelineno-18-4"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">password</span><span class="p">,</span><span class="w"> </span><span class="nx">ssn</span><span class="p">,</span><span class="w"> </span><span class="p">...</span><span class="nx">filtered</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#lab04-mcp-resources-__codelineno-18-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">filtered</span><span class="p">;</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#lab04-mcp-resources-__codelineno-18-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#lab04-mcp-resources-__codelineno-18-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#lab04-mcp-resources-__codelineno-18-8"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>How it works:</strong> This function removes sensitive information from resource content based on user roles. For non-admin users, it uses object destructuring to exclude sensitive fields like passwords and social security numbers, returning a filtered version of the data. Admin users see the complete, unfiltered content.</p>
<p><br></p>
<h4 id="lab04-mcp-resources-3-rate-limiting">3. Rate Limiting<a class="headerlink" href="#lab04-mcp-resources-3-rate-limiting" title="Permanent link">&para;</a></h4>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab04-mcp-resources-__codelineno-19-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">rateLimiter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">();</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab04-mcp-resources-__codelineno-19-2"></a>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#lab04-mcp-resources-__codelineno-19-3"></a><span class="k">private</span><span class="w"> </span><span class="nx">checkRateLimit</span><span class="p">(</span><span class="nx">identifier</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRequests</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#lab04-mcp-resources-__codelineno-19-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#lab04-mcp-resources-__codelineno-19-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 minute</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#lab04-mcp-resources-__codelineno-19-6"></a>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#lab04-mcp-resources-__codelineno-19-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimiter</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">identifier</span><span class="p">);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#lab04-mcp-resources-__codelineno-19-8"></a>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#lab04-mcp-resources-__codelineno-19-9"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">resetTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#lab04-mcp-resources-__codelineno-19-10"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimiter</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">identifier</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">now</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#lab04-mcp-resources-__codelineno-19-11"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#lab04-mcp-resources-__codelineno-19-12"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#lab04-mcp-resources-__codelineno-19-13"></a>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#lab04-mcp-resources-__codelineno-19-14"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="nx">maxRequests</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#lab04-mcp-resources-__codelineno-19-15"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#lab04-mcp-resources-__codelineno-19-16"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#lab04-mcp-resources-__codelineno-19-17"></a>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#lab04-mcp-resources-__codelineno-19-18"></a><span class="w">  </span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#lab04-mcp-resources-__codelineno-19-19"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#lab04-mcp-resources-__codelineno-19-20"></a><span class="p">}</span>
</span></code></pre></div>
<p><strong>How it works:</strong> This implements a sliding window rate limiter using a Map to track request counts per identifier (like user ID or IP address). It allows up to <code>maxRequests</code> (default 100) within a 1-minute window. When the limit is exceeded, it returns false to block the request. The window resets automatically after the time period expires.</p>
<hr />
<h2 id="lab04-mcp-resources-combining-resources-with-tools">Combining Resources with Tools<a class="headerlink" href="#lab04-mcp-resources-combining-resources-with-tools" title="Permanent link">&para;</a></h2>
<p><strong>The most powerful MCP servers combine resources and tools to provide a comprehensive functionality!</strong></p>
<h3 id="lab04-mcp-resources-complete-hybrid-server">Complete Hybrid Server<a class="headerlink" href="#lab04-mcp-resources-complete-hybrid-server" title="Permanent link">&para;</a></h3>
<p>The following example demonstrates a server that combines both resources and tools, showing how they work together to provide comprehensive functionality. </p>
<p>The server maintains a document store that can be both read as resources and modified through tools.</p>
<div class="language-typescript highlight"><span class="filename">Hybrid Server Class</span><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab04-mcp-resources-__codelineno-20-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#lab04-mcp-resources-__codelineno-20-2"></a>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#lab04-mcp-resources-__codelineno-20-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#lab04-mcp-resources-__codelineno-20-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#lab04-mcp-resources-__codelineno-20-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#lab04-mcp-resources-__codelineno-20-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#lab04-mcp-resources-__codelineno-20-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#lab04-mcp-resources-__codelineno-20-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#lab04-mcp-resources-__codelineno-20-9"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#lab04-mcp-resources-__codelineno-20-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#lab04-mcp-resources-__codelineno-20-11"></a>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#lab04-mcp-resources-__codelineno-20-12"></a><span class="cm">/**</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#lab04-mcp-resources-__codelineno-20-13"></a><span class="cm"> * MCP Server combining resources and tools</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#lab04-mcp-resources-__codelineno-20-14"></a><span class="cm"> */</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#lab04-mcp-resources-__codelineno-20-15"></a><span class="kd">class</span><span class="w"> </span><span class="nx">HybridServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#lab04-mcp-resources-__codelineno-20-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#lab04-mcp-resources-__codelineno-20-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">documents</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#lab04-mcp-resources-__codelineno-20-18"></a>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#lab04-mcp-resources-__codelineno-20-19"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#lab04-mcp-resources-__codelineno-20-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#lab04-mcp-resources-__codelineno-20-21"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#lab04-mcp-resources-__codelineno-20-22"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hybrid-server&quot;</span><span class="p">,</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#lab04-mcp-resources-__codelineno-20-23"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#lab04-mcp-resources-__codelineno-20-24"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#lab04-mcp-resources-__codelineno-20-25"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#lab04-mcp-resources-__codelineno-20-26"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#lab04-mcp-resources-__codelineno-20-27"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w">  </span><span class="c1">// Enable resource capabilities</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#lab04-mcp-resources-__codelineno-20-28"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span><span class="w">      </span><span class="c1">// Enable tool capabilities</span>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#lab04-mcp-resources-__codelineno-20-29"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#lab04-mcp-resources-__codelineno-20-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#lab04-mcp-resources-__codelineno-20-31"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#lab04-mcp-resources-__codelineno-20-32"></a>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#lab04-mcp-resources-__codelineno-20-33"></a><span class="w">    </span><span class="c1">// Initialize some sample documents</span>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#lab04-mcp-resources-__codelineno-20-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#lab04-mcp-resources-__codelineno-20-35"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;doc1&quot;</span><span class="p">,</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#lab04-mcp-resources-__codelineno-20-36"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Getting Started Guide&quot;</span><span class="p">,</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#lab04-mcp-resources-__codelineno-20-37"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;This is a comprehensive guide to getting started...&quot;</span><span class="p">,</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#lab04-mcp-resources-__codelineno-20-38"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;tutorial&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;beginner&quot;</span><span class="p">],</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#lab04-mcp-resources-__codelineno-20-39"></a><span class="w">      </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#lab04-mcp-resources-__codelineno-20-40"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#lab04-mcp-resources-__codelineno-20-41"></a>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#lab04-mcp-resources-__codelineno-20-42"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#lab04-mcp-resources-__codelineno-20-43"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#lab04-mcp-resources-__codelineno-20-44"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Key setup points:</strong></p>
<ul>
<li>The server declares both <code>resources: {}</code> and <code>tools: {}</code> capabilities</li>
<li>A Map is used to store documents in memory</li>
<li>Sample data is initialized to demonstrate functionality</li>
</ul>
<p><br></p>
<div class="language-typescript highlight"><span class="filename">Setup Handlers Method</span><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab04-mcp-resources-__codelineno-21-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#lab04-mcp-resources-__codelineno-21-2"></a><span class="w">    </span><span class="c1">// Resource handlers - provide read-only access to documents</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#lab04-mcp-resources-__codelineno-21-3"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#lab04-mcp-resources-__codelineno-21-4"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">entries</span><span class="p">()).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#lab04-mcp-resources-__codelineno-21-5"></a><span class="w">        </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`docs://documents/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#lab04-mcp-resources-__codelineno-21-6"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#lab04-mcp-resources-__codelineno-21-7"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#lab04-mcp-resources-__codelineno-21-8"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#lab04-mcp-resources-__codelineno-21-9"></a><span class="w">      </span><span class="p">}));</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#lab04-mcp-resources-__codelineno-21-10"></a>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#lab04-mcp-resources-__codelineno-21-11"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#lab04-mcp-resources-__codelineno-21-12"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#lab04-mcp-resources-__codelineno-21-13"></a>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#lab04-mcp-resources-__codelineno-21-14"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#lab04-mcp-resources-__codelineno-21-15"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-21-16"><a id="__codelineno-21-16" name="__codelineno-21-16" href="#lab04-mcp-resources-__codelineno-21-16"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readDocument</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-21-17"><a id="__codelineno-21-17" name="__codelineno-21-17" href="#lab04-mcp-resources-__codelineno-21-17"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-21-18"><a id="__codelineno-21-18" name="__codelineno-21-18" href="#lab04-mcp-resources-__codelineno-21-18"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-19"><a id="__codelineno-21-19" name="__codelineno-21-19" href="#lab04-mcp-resources-__codelineno-21-19"></a>
</span><span id="__span-21-20"><a id="__codelineno-21-20" name="__codelineno-21-20" href="#lab04-mcp-resources-__codelineno-21-20"></a><span class="w">    </span><span class="c1">// Tool handlers - provide write operations for documents</span>
</span><span id="__span-21-21"><a id="__codelineno-21-21" name="__codelineno-21-21" href="#lab04-mcp-resources-__codelineno-21-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-22"><a id="__codelineno-21-22" name="__codelineno-21-22" href="#lab04-mcp-resources-__codelineno-21-22"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-23"><a id="__codelineno-21-23" name="__codelineno-21-23" href="#lab04-mcp-resources-__codelineno-21-23"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-21-24"><a id="__codelineno-21-24" name="__codelineno-21-24" href="#lab04-mcp-resources-__codelineno-21-24"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-25"><a id="__codelineno-21-25" name="__codelineno-21-25" href="#lab04-mcp-resources-__codelineno-21-25"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;create_document&quot;</span><span class="p">,</span>
</span><span id="__span-21-26"><a id="__codelineno-21-26" name="__codelineno-21-26" href="#lab04-mcp-resources-__codelineno-21-26"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Create a new document&quot;</span><span class="p">,</span>
</span><span id="__span-21-27"><a id="__codelineno-21-27" name="__codelineno-21-27" href="#lab04-mcp-resources-__codelineno-21-27"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-28"><a id="__codelineno-21-28" name="__codelineno-21-28" href="#lab04-mcp-resources-__codelineno-21-28"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-21-29"><a id="__codelineno-21-29" name="__codelineno-21-29" href="#lab04-mcp-resources-__codelineno-21-29"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-30"><a id="__codelineno-21-30" name="__codelineno-21-30" href="#lab04-mcp-resources-__codelineno-21-30"></a><span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-31"><a id="__codelineno-21-31" name="__codelineno-21-31" href="#lab04-mcp-resources-__codelineno-21-31"></a><span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-32"><a id="__codelineno-21-32" name="__codelineno-21-32" href="#lab04-mcp-resources-__codelineno-21-32"></a><span class="w">                </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-33"><a id="__codelineno-21-33" name="__codelineno-21-33" href="#lab04-mcp-resources-__codelineno-21-33"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-21-34"><a id="__codelineno-21-34" name="__codelineno-21-34" href="#lab04-mcp-resources-__codelineno-21-34"></a><span class="w">                  </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-35"><a id="__codelineno-21-35" name="__codelineno-21-35" href="#lab04-mcp-resources-__codelineno-21-35"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-21-36"><a id="__codelineno-21-36" name="__codelineno-21-36" href="#lab04-mcp-resources-__codelineno-21-36"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-21-37"><a id="__codelineno-21-37" name="__codelineno-21-37" href="#lab04-mcp-resources-__codelineno-21-37"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-38"><a id="__codelineno-21-38" name="__codelineno-21-38" href="#lab04-mcp-resources-__codelineno-21-38"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;content&quot;</span><span class="p">],</span>
</span><span id="__span-21-39"><a id="__codelineno-21-39" name="__codelineno-21-39" href="#lab04-mcp-resources-__codelineno-21-39"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-40"><a id="__codelineno-21-40" name="__codelineno-21-40" href="#lab04-mcp-resources-__codelineno-21-40"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-41"><a id="__codelineno-21-41" name="__codelineno-21-41" href="#lab04-mcp-resources-__codelineno-21-41"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-42"><a id="__codelineno-21-42" name="__codelineno-21-42" href="#lab04-mcp-resources-__codelineno-21-42"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;search_documents&quot;</span><span class="p">,</span>
</span><span id="__span-21-43"><a id="__codelineno-21-43" name="__codelineno-21-43" href="#lab04-mcp-resources-__codelineno-21-43"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search documents by content or tags&quot;</span><span class="p">,</span>
</span><span id="__span-21-44"><a id="__codelineno-21-44" name="__codelineno-21-44" href="#lab04-mcp-resources-__codelineno-21-44"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-45"><a id="__codelineno-21-45" name="__codelineno-21-45" href="#lab04-mcp-resources-__codelineno-21-45"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-21-46"><a id="__codelineno-21-46" name="__codelineno-21-46" href="#lab04-mcp-resources-__codelineno-21-46"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-47"><a id="__codelineno-21-47" name="__codelineno-21-47" href="#lab04-mcp-resources-__codelineno-21-47"></a><span class="w">                </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-48"><a id="__codelineno-21-48" name="__codelineno-21-48" href="#lab04-mcp-resources-__codelineno-21-48"></a><span class="w">                </span><span class="nx">tag</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-49"><a id="__codelineno-21-49" name="__codelineno-21-49" href="#lab04-mcp-resources-__codelineno-21-49"></a><span class="w">                </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">10</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-50"><a id="__codelineno-21-50" name="__codelineno-21-50" href="#lab04-mcp-resources-__codelineno-21-50"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-51"><a id="__codelineno-21-51" name="__codelineno-21-51" href="#lab04-mcp-resources-__codelineno-21-51"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-52"><a id="__codelineno-21-52" name="__codelineno-21-52" href="#lab04-mcp-resources-__codelineno-21-52"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-53"><a id="__codelineno-21-53" name="__codelineno-21-53" href="#lab04-mcp-resources-__codelineno-21-53"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-21-54"><a id="__codelineno-21-54" name="__codelineno-21-54" href="#lab04-mcp-resources-__codelineno-21-54"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;update_document&quot;</span><span class="p">,</span>
</span><span id="__span-21-55"><a id="__codelineno-21-55" name="__codelineno-21-55" href="#lab04-mcp-resources-__codelineno-21-55"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Update an existing document&quot;</span><span class="p">,</span>
</span><span id="__span-21-56"><a id="__codelineno-21-56" name="__codelineno-21-56" href="#lab04-mcp-resources-__codelineno-21-56"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-57"><a id="__codelineno-21-57" name="__codelineno-21-57" href="#lab04-mcp-resources-__codelineno-21-57"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-21-58"><a id="__codelineno-21-58" name="__codelineno-21-58" href="#lab04-mcp-resources-__codelineno-21-58"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-59"><a id="__codelineno-21-59" name="__codelineno-21-59" href="#lab04-mcp-resources-__codelineno-21-59"></a><span class="w">                </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-60"><a id="__codelineno-21-60" name="__codelineno-21-60" href="#lab04-mcp-resources-__codelineno-21-60"></a><span class="w">                </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-61"><a id="__codelineno-21-61" name="__codelineno-21-61" href="#lab04-mcp-resources-__codelineno-21-61"></a><span class="w">                </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-62"><a id="__codelineno-21-62" name="__codelineno-21-62" href="#lab04-mcp-resources-__codelineno-21-62"></a><span class="w">                </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-21-63"><a id="__codelineno-21-63" name="__codelineno-21-63" href="#lab04-mcp-resources-__codelineno-21-63"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-21-64"><a id="__codelineno-21-64" name="__codelineno-21-64" href="#lab04-mcp-resources-__codelineno-21-64"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
</span><span id="__span-21-65"><a id="__codelineno-21-65" name="__codelineno-21-65" href="#lab04-mcp-resources-__codelineno-21-65"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-21-66"><a id="__codelineno-21-66" name="__codelineno-21-66" href="#lab04-mcp-resources-__codelineno-21-66"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-21-67"><a id="__codelineno-21-67" name="__codelineno-21-67" href="#lab04-mcp-resources-__codelineno-21-67"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-21-68"><a id="__codelineno-21-68" name="__codelineno-21-68" href="#lab04-mcp-resources-__codelineno-21-68"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-21-69"><a id="__codelineno-21-69" name="__codelineno-21-69" href="#lab04-mcp-resources-__codelineno-21-69"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-70"><a id="__codelineno-21-70" name="__codelineno-21-70" href="#lab04-mcp-resources-__codelineno-21-70"></a>
</span><span id="__span-21-71"><a id="__codelineno-21-71" name="__codelineno-21-71" href="#lab04-mcp-resources-__codelineno-21-71"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-72"><a id="__codelineno-21-72" name="__codelineno-21-72" href="#lab04-mcp-resources-__codelineno-21-72"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-21-73"><a id="__codelineno-21-73" name="__codelineno-21-73" href="#lab04-mcp-resources-__codelineno-21-73"></a>
</span><span id="__span-21-74"><a id="__codelineno-21-74" name="__codelineno-21-74" href="#lab04-mcp-resources-__codelineno-21-74"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-75"><a id="__codelineno-21-75" name="__codelineno-21-75" href="#lab04-mcp-resources-__codelineno-21-75"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;create_document&quot;</span><span class="o">:</span>
</span><span id="__span-21-76"><a id="__codelineno-21-76" name="__codelineno-21-76" href="#lab04-mcp-resources-__codelineno-21-76"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-77"><a id="__codelineno-21-77" name="__codelineno-21-77" href="#lab04-mcp-resources-__codelineno-21-77"></a>
</span><span id="__span-21-78"><a id="__codelineno-21-78" name="__codelineno-21-78" href="#lab04-mcp-resources-__codelineno-21-78"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;search_documents&quot;</span><span class="o">:</span>
</span><span id="__span-21-79"><a id="__codelineno-21-79" name="__codelineno-21-79" href="#lab04-mcp-resources-__codelineno-21-79"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">searchDocuments</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-80"><a id="__codelineno-21-80" name="__codelineno-21-80" href="#lab04-mcp-resources-__codelineno-21-80"></a>
</span><span id="__span-21-81"><a id="__codelineno-21-81" name="__codelineno-21-81" href="#lab04-mcp-resources-__codelineno-21-81"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;update_document&quot;</span><span class="o">:</span>
</span><span id="__span-21-82"><a id="__codelineno-21-82" name="__codelineno-21-82" href="#lab04-mcp-resources-__codelineno-21-82"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">updateDocument</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-21-83"><a id="__codelineno-21-83" name="__codelineno-21-83" href="#lab04-mcp-resources-__codelineno-21-83"></a>
</span><span id="__span-21-84"><a id="__codelineno-21-84" name="__codelineno-21-84" href="#lab04-mcp-resources-__codelineno-21-84"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-21-85"><a id="__codelineno-21-85" name="__codelineno-21-85" href="#lab04-mcp-resources-__codelineno-21-85"></a><span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-21-86"><a id="__codelineno-21-86" name="__codelineno-21-86" href="#lab04-mcp-resources-__codelineno-21-86"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-21-87"><a id="__codelineno-21-87" name="__codelineno-21-87" href="#lab04-mcp-resources-__codelineno-21-87"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-21-88"><a id="__codelineno-21-88" name="__codelineno-21-88" href="#lab04-mcp-resources-__codelineno-21-88"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Resource vs Tool handlers:</strong></p>
<ul>
<li><strong>Resources</strong> expose existing documents for reading (<code>docs://documents/{id}</code>)</li>
<li><strong>Tools</strong> provide operations to create, search, and update documents</li>
<li>Resources are passive (read-only), tools are active (perform actions)</li>
</ul>
<p><br></p>
<div class="language-typescript highlight"><span class="filename">Read Document Method</span><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab04-mcp-resources-__codelineno-22-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readDocument</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#lab04-mcp-resources-__codelineno-22-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^docs:\/\/documents\/(.+)$/</span><span class="p">);</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#lab04-mcp-resources-__codelineno-22-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid document URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#lab04-mcp-resources-__codelineno-22-4"></a>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#lab04-mcp-resources-__codelineno-22-5"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#lab04-mcp-resources-__codelineno-22-6"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#lab04-mcp-resources-__codelineno-22-7"></a>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#lab04-mcp-resources-__codelineno-22-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Document not found: </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#lab04-mcp-resources-__codelineno-22-9"></a>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#lab04-mcp-resources-__codelineno-22-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#lab04-mcp-resources-__codelineno-22-11"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#lab04-mcp-resources-__codelineno-22-12"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#lab04-mcp-resources-__codelineno-22-13"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#lab04-mcp-resources-__codelineno-22-14"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#lab04-mcp-resources-__codelineno-22-15"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Resource reading:</strong> Parses the URI to extract the document ID, retrieves the document from the Map, and returns it as JSON content.</p>
<p><br></p>
<div class="language-typescript highlight"><span class="filename">Create Document Method</span><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab04-mcp-resources-__codelineno-23-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">createDocument</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab04-mcp-resources-__codelineno-23-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`doc</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#lab04-mcp-resources-__codelineno-23-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#lab04-mcp-resources-__codelineno-23-4"></a><span class="w">      </span><span class="nx">id</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#lab04-mcp-resources-__codelineno-23-5"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">args.title</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#lab04-mcp-resources-__codelineno-23-6"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">args.content</span><span class="p">,</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#lab04-mcp-resources-__codelineno-23-7"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="kt">args.tags</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#lab04-mcp-resources-__codelineno-23-8"></a><span class="w">      </span><span class="nx">created</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#lab04-mcp-resources-__codelineno-23-9"></a><span class="w">      </span><span class="nx">modified</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#lab04-mcp-resources-__codelineno-23-10"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#lab04-mcp-resources-__codelineno-23-11"></a>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#lab04-mcp-resources-__codelineno-23-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">);</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#lab04-mcp-resources-__codelineno-23-13"></a>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#lab04-mcp-resources-__codelineno-23-14"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#lab04-mcp-resources-__codelineno-23-15"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#lab04-mcp-resources-__codelineno-23-16"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#lab04-mcp-resources-__codelineno-23-17"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#lab04-mcp-resources-__codelineno-23-18"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document created successfully!\n\nID: </span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">\nTitle: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">\nURI: docs://documents/</span><span class="si">${</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#lab04-mcp-resources-__codelineno-23-19"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#lab04-mcp-resources-__codelineno-23-20"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#lab04-mcp-resources-__codelineno-23-21"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#lab04-mcp-resources-__codelineno-23-22"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Tool implementation:</strong> Creates a new document with a timestamp-based ID, stores it in the Map, and returns success information including the new document&rsquo;s URI.</p>
<p><br></p>
<div class="language-typescript highlight"><span class="filename">Search Documents Method</span><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab04-mcp-resources-__codelineno-24-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">searchDocuments</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#lab04-mcp-resources-__codelineno-24-2"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">values</span><span class="p">());</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#lab04-mcp-resources-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#lab04-mcp-resources-__codelineno-24-4"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#lab04-mcp-resources-__codelineno-24-5"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#lab04-mcp-resources-__codelineno-24-6"></a><span class="w">      </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#lab04-mcp-resources-__codelineno-24-7"></a><span class="w">        </span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#lab04-mcp-resources-__codelineno-24-8"></a><span class="w">        </span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">includes</span><span class="p">(</span><span class="nx">query</span><span class="p">)</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#lab04-mcp-resources-__codelineno-24-9"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#lab04-mcp-resources-__codelineno-24-10"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#lab04-mcp-resources-__codelineno-24-11"></a>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#lab04-mcp-resources-__codelineno-24-12"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#lab04-mcp-resources-__codelineno-24-13"></a><span class="w">      </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tag</span><span class="p">));</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#lab04-mcp-resources-__codelineno-24-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#lab04-mcp-resources-__codelineno-24-15"></a>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#lab04-mcp-resources-__codelineno-24-16"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">limit</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">10</span><span class="p">;</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#lab04-mcp-resources-__codelineno-24-17"></a><span class="w">    </span><span class="nx">results</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">);</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#lab04-mcp-resources-__codelineno-24-18"></a>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#lab04-mcp-resources-__codelineno-24-19"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">formatted</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">results</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#lab04-mcp-resources-__codelineno-24-20"></a><span class="w">      </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.id</span><span class="p">,</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#lab04-mcp-resources-__codelineno-24-21"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#lab04-mcp-resources-__codelineno-24-22"></a><span class="w">      </span><span class="nx">tags</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.tags</span><span class="p">,</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#lab04-mcp-resources-__codelineno-24-23"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`docs://documents/</span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#lab04-mcp-resources-__codelineno-24-24"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#lab04-mcp-resources-__codelineno-24-25"></a>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#lab04-mcp-resources-__codelineno-24-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#lab04-mcp-resources-__codelineno-24-27"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#lab04-mcp-resources-__codelineno-24-28"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#lab04-mcp-resources-__codelineno-24-29"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#lab04-mcp-resources-__codelineno-24-30"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Found </span><span class="si">${</span><span class="nx">results</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> documents:\n\n</span><span class="si">${</span><span class="nx">formatted</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">doc</span><span class="w"> </span><span class="p">=&gt;</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#lab04-mcp-resources-__codelineno-24-31"></a><span class="w">            </span><span class="sb">`üìÑ </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">)\n   URI: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#lab04-mcp-resources-__codelineno-24-32"></a><span class="w">          </span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n\n&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#lab04-mcp-resources-__codelineno-24-33"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#lab04-mcp-resources-__codelineno-24-34"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#lab04-mcp-resources-__codelineno-24-35"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#lab04-mcp-resources-__codelineno-24-36"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Search tool:</strong> Filters documents by query string or tag, limits results, and returns formatted text output with document URIs for easy access.</p>
<p><br></p>
<div class="language-typescript highlight"><span class="filename">Update Document Method</span><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab04-mcp-resources-__codelineno-25-1"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">updateDocument</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab04-mcp-resources-__codelineno-25-2"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">doc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#lab04-mcp-resources-__codelineno-25-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">doc</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Document not found: </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#lab04-mcp-resources-__codelineno-25-4"></a>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#lab04-mcp-resources-__codelineno-25-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">title</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">title</span><span class="p">;</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#lab04-mcp-resources-__codelineno-25-6"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#lab04-mcp-resources-__codelineno-25-7"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">tags</span><span class="p">)</span><span class="w"> </span><span class="nx">doc</span><span class="p">.</span><span class="nx">tags</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">tags</span><span class="p">;</span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#lab04-mcp-resources-__codelineno-25-8"></a><span class="w">    </span><span class="nx">doc</span><span class="p">.</span><span class="nx">modified</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#lab04-mcp-resources-__codelineno-25-9"></a>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#lab04-mcp-resources-__codelineno-25-10"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#lab04-mcp-resources-__codelineno-25-11"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#lab04-mcp-resources-__codelineno-25-12"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#lab04-mcp-resources-__codelineno-25-13"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#lab04-mcp-resources-__codelineno-25-14"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Document updated successfully!\n\nID: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">\nTitle: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">\nModified: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">modified</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#lab04-mcp-resources-__codelineno-25-15"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#lab04-mcp-resources-__codelineno-25-16"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#lab04-mcp-resources-__codelineno-25-17"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#lab04-mcp-resources-__codelineno-25-18"></a><span class="w">  </span><span class="p">}</span>
</span></code></pre></div>
<p><strong>Update tool:</strong> Modifies existing document fields and updates the modification timestamp, providing feedback about the changes made.</p>
<p><br></p>
<p><strong>How resources and tools complement each other:</strong></p>
<ul>
<li><strong>Resources</strong> provide passive access: LLMs can read documents at <code>docs://documents/{id}</code></li>
<li><strong>Tools</strong> enable active operations: LLMs can create, search, and update documents</li>
<li><strong>Integration</strong>: Tools can reference resources in their responses (e.g., &ldquo;Read the new document at docs://documents/123&rdquo;)</li>
<li><strong>Workflow</strong>: Create documents with tools, then read them as resources for context</li>
</ul>
<hr />
<h2 id="lab04-mcp-resources-hands-on-exercises">Hands-On Exercises<a class="headerlink" href="#lab04-mcp-resources-hands-on-exercises" title="Permanent link">&para;</a></h2>
<h3 id="lab04-mcp-resources-exercise-1-file-system-resource-server">Exercise 1: File System Resource Server<a class="headerlink" href="#lab04-mcp-resources-exercise-1-file-system-resource-server" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Exposes a directory as MCP resources</li>
<li>Supports different file types (text, JSON, Markdown)</li>
<li>Implements proper security (no directory traversal)</li>
<li>Includes file metadata (size, modified date)</li>
</ul>
<details>
<summary>üí° Solution: File System Resource Server</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab04-mcp-resources-__codelineno-26-1"></a><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#lab04-mcp-resources-__codelineno-26-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;create_file_resource_server&quot;</span><span class="p">,</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#lab04-mcp-resources-__codelineno-26-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Create an MCP server that exposes a directory as resources&quot;</span><span class="p">,</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#lab04-mcp-resources-__codelineno-26-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#lab04-mcp-resources-__codelineno-26-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#lab04-mcp-resources-__codelineno-26-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#lab04-mcp-resources-__codelineno-26-7"></a><span class="w">      </span><span class="nx">directory</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#lab04-mcp-resources-__codelineno-26-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#lab04-mcp-resources-__codelineno-26-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Directory path to expose as resources&quot;</span><span class="p">,</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#lab04-mcp-resources-__codelineno-26-10"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;./files&quot;</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#lab04-mcp-resources-__codelineno-26-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#lab04-mcp-resources-__codelineno-26-12"></a><span class="w">      </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#lab04-mcp-resources-__codelineno-26-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#lab04-mcp-resources-__codelineno-26-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;File extensions to include&quot;</span><span class="p">,</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#lab04-mcp-resources-__codelineno-26-15"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#lab04-mcp-resources-__codelineno-26-16"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;.md&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.txt&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.json&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.yaml&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;.yml&quot;</span><span class="p">]</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#lab04-mcp-resources-__codelineno-26-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#lab04-mcp-resources-__codelineno-26-18"></a><span class="w">      </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#lab04-mcp-resources-__codelineno-26-19"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#lab04-mcp-resources-__codelineno-26-20"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum file size in bytes&quot;</span><span class="p">,</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#lab04-mcp-resources-__codelineno-26-21"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1048576</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#lab04-mcp-resources-__codelineno-26-22"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#lab04-mcp-resources-__codelineno-26-23"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#lab04-mcp-resources-__codelineno-26-24"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;directory&quot;</span><span class="p">]</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#lab04-mcp-resources-__codelineno-26-25"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#lab04-mcp-resources-__codelineno-26-26"></a><span class="p">}</span>
</span></code></pre></div>

Implementation:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab04-mcp-resources-__codelineno-27-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab04-mcp-resources-__codelineno-27-2"></a>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#lab04-mcp-resources-__codelineno-27-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#lab04-mcp-resources-__codelineno-27-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#lab04-mcp-resources-__codelineno-27-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#lab04-mcp-resources-__codelineno-27-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#lab04-mcp-resources-__codelineno-27-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#lab04-mcp-resources-__codelineno-27-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#lab04-mcp-resources-__codelineno-27-9"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#lab04-mcp-resources-__codelineno-27-10"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#lab04-mcp-resources-__codelineno-27-11"></a>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#lab04-mcp-resources-__codelineno-27-12"></a><span class="kd">class</span><span class="w"> </span><span class="nx">FileSystemResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#lab04-mcp-resources-__codelineno-27-13"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#lab04-mcp-resources-__codelineno-27-14"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">rootDir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#lab04-mcp-resources-__codelineno-27-15"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#lab04-mcp-resources-__codelineno-27-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#lab04-mcp-resources-__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#lab04-mcp-resources-__codelineno-27-18"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">rootDir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./files&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;.md&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.txt&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.json&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.yaml&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;.yml&#39;</span><span class="p">],</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1048576</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#lab04-mcp-resources-__codelineno-27-19"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">rootDir</span><span class="p">);</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#lab04-mcp-resources-__codelineno-27-20"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allowedExtensions</span><span class="p">;</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#lab04-mcp-resources-__codelineno-27-21"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxFileSize</span><span class="p">;</span>
</span><span id="__span-27-22"><a id="__codelineno-27-22" name="__codelineno-27-22" href="#lab04-mcp-resources-__codelineno-27-22"></a>
</span><span id="__span-27-23"><a id="__codelineno-27-23" name="__codelineno-27-23" href="#lab04-mcp-resources-__codelineno-27-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-27-24"><a id="__codelineno-27-24" name="__codelineno-27-24" href="#lab04-mcp-resources-__codelineno-27-24"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-27-25"><a id="__codelineno-27-25" name="__codelineno-27-25" href="#lab04-mcp-resources-__codelineno-27-25"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;filesystem-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-27-26"><a id="__codelineno-27-26" name="__codelineno-27-26" href="#lab04-mcp-resources-__codelineno-27-26"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-27-27"><a id="__codelineno-27-27" name="__codelineno-27-27" href="#lab04-mcp-resources-__codelineno-27-27"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-27-28"><a id="__codelineno-27-28" name="__codelineno-27-28" href="#lab04-mcp-resources-__codelineno-27-28"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-27-29"><a id="__codelineno-27-29" name="__codelineno-27-29" href="#lab04-mcp-resources-__codelineno-27-29"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-30"><a id="__codelineno-27-30" name="__codelineno-27-30" href="#lab04-mcp-resources-__codelineno-27-30"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-27-31"><a id="__codelineno-27-31" name="__codelineno-27-31" href="#lab04-mcp-resources-__codelineno-27-31"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-27-32"><a id="__codelineno-27-32" name="__codelineno-27-32" href="#lab04-mcp-resources-__codelineno-27-32"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-33"><a id="__codelineno-27-33" name="__codelineno-27-33" href="#lab04-mcp-resources-__codelineno-27-33"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-27-34"><a id="__codelineno-27-34" name="__codelineno-27-34" href="#lab04-mcp-resources-__codelineno-27-34"></a>
</span><span id="__span-27-35"><a id="__codelineno-27-35" name="__codelineno-27-35" href="#lab04-mcp-resources-__codelineno-27-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-27-36"><a id="__codelineno-27-36" name="__codelineno-27-36" href="#lab04-mcp-resources-__codelineno-27-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-27-37"><a id="__codelineno-27-37" name="__codelineno-27-37" href="#lab04-mcp-resources-__codelineno-27-37"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-38"><a id="__codelineno-27-38" name="__codelineno-27-38" href="#lab04-mcp-resources-__codelineno-27-38"></a>
</span><span id="__span-27-39"><a id="__codelineno-27-39" name="__codelineno-27-39" href="#lab04-mcp-resources-__codelineno-27-39"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-40"><a id="__codelineno-27-40" name="__codelineno-27-40" href="#lab04-mcp-resources-__codelineno-27-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-41"><a id="__codelineno-27-41" name="__codelineno-27-41" href="#lab04-mcp-resources-__codelineno-27-41"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">discoverFiles</span><span class="p">();</span>
</span><span id="__span-27-42"><a id="__codelineno-27-42" name="__codelineno-27-42" href="#lab04-mcp-resources-__codelineno-27-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-27-43"><a id="__codelineno-27-43" name="__codelineno-27-43" href="#lab04-mcp-resources-__codelineno-27-43"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-44"><a id="__codelineno-27-44" name="__codelineno-27-44" href="#lab04-mcp-resources-__codelineno-27-44"></a>
</span><span id="__span-27-45"><a id="__codelineno-27-45" name="__codelineno-27-45" href="#lab04-mcp-resources-__codelineno-27-45"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-46"><a id="__codelineno-27-46" name="__codelineno-27-46" href="#lab04-mcp-resources-__codelineno-27-46"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-27-47"><a id="__codelineno-27-47" name="__codelineno-27-47" href="#lab04-mcp-resources-__codelineno-27-47"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-27-48"><a id="__codelineno-27-48" name="__codelineno-27-48" href="#lab04-mcp-resources-__codelineno-27-48"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-27-49"><a id="__codelineno-27-49" name="__codelineno-27-49" href="#lab04-mcp-resources-__codelineno-27-49"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-50"><a id="__codelineno-27-50" name="__codelineno-27-50" href="#lab04-mcp-resources-__codelineno-27-50"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-51"><a id="__codelineno-27-51" name="__codelineno-27-51" href="#lab04-mcp-resources-__codelineno-27-51"></a>
</span><span id="__span-27-52"><a id="__codelineno-27-52" name="__codelineno-27-52" href="#lab04-mcp-resources-__codelineno-27-52"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">discoverFiles</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-53"><a id="__codelineno-27-53" name="__codelineno-27-53" href="#lab04-mcp-resources-__codelineno-27-53"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-27-54"><a id="__codelineno-27-54" name="__codelineno-27-54" href="#lab04-mcp-resources-__codelineno-27-54"></a>
</span><span id="__span-27-55"><a id="__codelineno-27-55" name="__codelineno-27-55" href="#lab04-mcp-resources-__codelineno-27-55"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-56"><a id="__codelineno-27-56" name="__codelineno-27-56" href="#lab04-mcp-resources-__codelineno-27-56"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">);</span>
</span><span id="__span-27-57"><a id="__codelineno-27-57" name="__codelineno-27-57" href="#lab04-mcp-resources-__codelineno-27-57"></a>
</span><span id="__span-27-58"><a id="__codelineno-27-58" name="__codelineno-27-58" href="#lab04-mcp-resources-__codelineno-27-58"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">file</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">files</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-59"><a id="__codelineno-27-59" name="__codelineno-27-59" href="#lab04-mcp-resources-__codelineno-27-59"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">,</span><span class="w"> </span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-60"><a id="__codelineno-27-60" name="__codelineno-27-60" href="#lab04-mcp-resources-__codelineno-27-60"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`file:///</span><span class="si">${</span><span class="nx">relativePath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-61"><a id="__codelineno-27-61" name="__codelineno-27-61" href="#lab04-mcp-resources-__codelineno-27-61"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-62"><a id="__codelineno-27-62" name="__codelineno-27-62" href="#lab04-mcp-resources-__codelineno-27-62"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span><span id="__span-27-63"><a id="__codelineno-27-63" name="__codelineno-27-63" href="#lab04-mcp-resources-__codelineno-27-63"></a>
</span><span id="__span-27-64"><a id="__codelineno-27-64" name="__codelineno-27-64" href="#lab04-mcp-resources-__codelineno-27-64"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-27-65"><a id="__codelineno-27-65" name="__codelineno-27-65" href="#lab04-mcp-resources-__codelineno-27-65"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-27-66"><a id="__codelineno-27-66" name="__codelineno-27-66" href="#lab04-mcp-resources-__codelineno-27-66"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">path.basename</span><span class="p">(</span><span class="nx">file</span><span class="p">),</span>
</span><span id="__span-27-67"><a id="__codelineno-27-67" name="__codelineno-27-67" href="#lab04-mcp-resources-__codelineno-27-67"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`File: </span><span class="si">${</span><span class="nx">relativePath</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">formatFileSize</span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="p">)</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
</span><span id="__span-27-68"><a id="__codelineno-27-68" name="__codelineno-27-68" href="#lab04-mcp-resources-__codelineno-27-68"></a><span class="w">          </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-27-69"><a id="__codelineno-27-69" name="__codelineno-27-69" href="#lab04-mcp-resources-__codelineno-27-69"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-27-70"><a id="__codelineno-27-70" name="__codelineno-27-70" href="#lab04-mcp-resources-__codelineno-27-70"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-71"><a id="__codelineno-27-71" name="__codelineno-27-71" href="#lab04-mcp-resources-__codelineno-27-71"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-72"><a id="__codelineno-27-72" name="__codelineno-27-72" href="#lab04-mcp-resources-__codelineno-27-72"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error discovering files:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-73"><a id="__codelineno-27-73" name="__codelineno-27-73" href="#lab04-mcp-resources-__codelineno-27-73"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-74"><a id="__codelineno-27-74" name="__codelineno-27-74" href="#lab04-mcp-resources-__codelineno-27-74"></a>
</span><span id="__span-27-75"><a id="__codelineno-27-75" name="__codelineno-27-75" href="#lab04-mcp-resources-__codelineno-27-75"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">resources</span><span class="p">;</span>
</span><span id="__span-27-76"><a id="__codelineno-27-76" name="__codelineno-27-76" href="#lab04-mcp-resources-__codelineno-27-76"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-77"><a id="__codelineno-27-77" name="__codelineno-27-77" href="#lab04-mcp-resources-__codelineno-27-77"></a>
</span><span id="__span-27-78"><a id="__codelineno-27-78" name="__codelineno-27-78" href="#lab04-mcp-resources-__codelineno-27-78"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readFile</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-79"><a id="__codelineno-27-79" name="__codelineno-27-79" href="#lab04-mcp-resources-__codelineno-27-79"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-80"><a id="__codelineno-27-80" name="__codelineno-27-80" href="#lab04-mcp-resources-__codelineno-27-80"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid URI format: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-81"><a id="__codelineno-27-81" name="__codelineno-27-81" href="#lab04-mcp-resources-__codelineno-27-81"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-82"><a id="__codelineno-27-82" name="__codelineno-27-82" href="#lab04-mcp-resources-__codelineno-27-82"></a>
</span><span id="__span-27-83"><a id="__codelineno-27-83" name="__codelineno-27-83" href="#lab04-mcp-resources-__codelineno-27-83"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">relativePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;file:///&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-27-84"><a id="__codelineno-27-84" name="__codelineno-27-84" href="#lab04-mcp-resources-__codelineno-27-84"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">,</span><span class="w"> </span><span class="nx">relativePath</span><span class="p">);</span>
</span><span id="__span-27-85"><a id="__codelineno-27-85" name="__codelineno-27-85" href="#lab04-mcp-resources-__codelineno-27-85"></a>
</span><span id="__span-27-86"><a id="__codelineno-27-86" name="__codelineno-27-86" href="#lab04-mcp-resources-__codelineno-27-86"></a><span class="w">    </span><span class="c1">// Security: Prevent directory traversal</span>
</span><span id="__span-27-87"><a id="__codelineno-27-87" name="__codelineno-27-87" href="#lab04-mcp-resources-__codelineno-27-87"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">resolvedPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-88"><a id="__codelineno-27-88" name="__codelineno-27-88" href="#lab04-mcp-resources-__codelineno-27-88"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">resolvedPath</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-89"><a id="__codelineno-27-89" name="__codelineno-27-89" href="#lab04-mcp-resources-__codelineno-27-89"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Access denied: path outside allowed directory&#39;</span><span class="p">);</span>
</span><span id="__span-27-90"><a id="__codelineno-27-90" name="__codelineno-27-90" href="#lab04-mcp-resources-__codelineno-27-90"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-91"><a id="__codelineno-27-91" name="__codelineno-27-91" href="#lab04-mcp-resources-__codelineno-27-91"></a>
</span><span id="__span-27-92"><a id="__codelineno-27-92" name="__codelineno-27-92" href="#lab04-mcp-resources-__codelineno-27-92"></a><span class="w">    </span><span class="c1">// Check if file extension is allowed</span>
</span><span id="__span-27-93"><a id="__codelineno-27-93" name="__codelineno-27-93" href="#lab04-mcp-resources-__codelineno-27-93"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-94"><a id="__codelineno-27-94" name="__codelineno-27-94" href="#lab04-mcp-resources-__codelineno-27-94"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-95"><a id="__codelineno-27-95" name="__codelineno-27-95" href="#lab04-mcp-resources-__codelineno-27-95"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File type not allowed: </span><span class="si">${</span><span class="nx">ext</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-96"><a id="__codelineno-27-96" name="__codelineno-27-96" href="#lab04-mcp-resources-__codelineno-27-96"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-97"><a id="__codelineno-27-97" name="__codelineno-27-97" href="#lab04-mcp-resources-__codelineno-27-97"></a>
</span><span id="__span-27-98"><a id="__codelineno-27-98" name="__codelineno-27-98" href="#lab04-mcp-resources-__codelineno-27-98"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-99"><a id="__codelineno-27-99" name="__codelineno-27-99" href="#lab04-mcp-resources-__codelineno-27-99"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">stats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">stat</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-100"><a id="__codelineno-27-100" name="__codelineno-27-100" href="#lab04-mcp-resources-__codelineno-27-100"></a>
</span><span id="__span-27-101"><a id="__codelineno-27-101" name="__codelineno-27-101" href="#lab04-mcp-resources-__codelineno-27-101"></a><span class="w">      </span><span class="c1">// Check file size</span>
</span><span id="__span-27-102"><a id="__codelineno-27-102" name="__codelineno-27-102" href="#lab04-mcp-resources-__codelineno-27-102"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-103"><a id="__codelineno-27-103" name="__codelineno-27-103" href="#lab04-mcp-resources-__codelineno-27-103"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`File too large: </span><span class="si">${</span><span class="nx">stats</span><span class="p">.</span><span class="nx">size</span><span class="si">}</span><span class="sb"> bytes (max: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">maxFileSize</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-27-104"><a id="__codelineno-27-104" name="__codelineno-27-104" href="#lab04-mcp-resources-__codelineno-27-104"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-105"><a id="__codelineno-27-105" name="__codelineno-27-105" href="#lab04-mcp-resources-__codelineno-27-105"></a>
</span><span id="__span-27-106"><a id="__codelineno-27-106" name="__codelineno-27-106" href="#lab04-mcp-resources-__codelineno-27-106"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filePath</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;utf8&#39;</span><span class="p">);</span>
</span><span id="__span-27-107"><a id="__codelineno-27-107" name="__codelineno-27-107" href="#lab04-mcp-resources-__codelineno-27-107"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="p">);</span>
</span><span id="__span-27-108"><a id="__codelineno-27-108" name="__codelineno-27-108" href="#lab04-mcp-resources-__codelineno-27-108"></a>
</span><span id="__span-27-109"><a id="__codelineno-27-109" name="__codelineno-27-109" href="#lab04-mcp-resources-__codelineno-27-109"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-110"><a id="__codelineno-27-110" name="__codelineno-27-110" href="#lab04-mcp-resources-__codelineno-27-110"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-27-111"><a id="__codelineno-27-111" name="__codelineno-27-111" href="#lab04-mcp-resources-__codelineno-27-111"></a><span class="w">        </span><span class="nx">mimeType</span><span class="p">,</span>
</span><span id="__span-27-112"><a id="__codelineno-27-112" name="__codelineno-27-112" href="#lab04-mcp-resources-__codelineno-27-112"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">content</span><span class="p">,</span>
</span><span id="__span-27-113"><a id="__codelineno-27-113" name="__codelineno-27-113" href="#lab04-mcp-resources-__codelineno-27-113"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-27-114"><a id="__codelineno-27-114" name="__codelineno-27-114" href="#lab04-mcp-resources-__codelineno-27-114"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-115"><a id="__codelineno-27-115" name="__codelineno-27-115" href="#lab04-mcp-resources-__codelineno-27-115"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to read file: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-27-116"><a id="__codelineno-27-116" name="__codelineno-27-116" href="#lab04-mcp-resources-__codelineno-27-116"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-117"><a id="__codelineno-27-117" name="__codelineno-27-117" href="#lab04-mcp-resources-__codelineno-27-117"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-118"><a id="__codelineno-27-118" name="__codelineno-27-118" href="#lab04-mcp-resources-__codelineno-27-118"></a>
</span><span id="__span-27-119"><a id="__codelineno-27-119" name="__codelineno-27-119" href="#lab04-mcp-resources-__codelineno-27-119"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">dir</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-120"><a id="__codelineno-27-120" name="__codelineno-27-120" href="#lab04-mcp-resources-__codelineno-27-120"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">files</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-27-121"><a id="__codelineno-27-121" name="__codelineno-27-121" href="#lab04-mcp-resources-__codelineno-27-121"></a>
</span><span id="__span-27-122"><a id="__codelineno-27-122" name="__codelineno-27-122" href="#lab04-mcp-resources-__codelineno-27-122"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-123"><a id="__codelineno-27-123" name="__codelineno-27-123" href="#lab04-mcp-resources-__codelineno-27-123"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">entries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">readdir</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">withFileTypes</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-27-124"><a id="__codelineno-27-124" name="__codelineno-27-124" href="#lab04-mcp-resources-__codelineno-27-124"></a>
</span><span id="__span-27-125"><a id="__codelineno-27-125" name="__codelineno-27-125" href="#lab04-mcp-resources-__codelineno-27-125"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">entry</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">entries</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-126"><a id="__codelineno-27-126" name="__codelineno-27-126" href="#lab04-mcp-resources-__codelineno-27-126"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">fullPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">dir</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-27-127"><a id="__codelineno-27-127" name="__codelineno-27-127" href="#lab04-mcp-resources-__codelineno-27-127"></a>
</span><span id="__span-27-128"><a id="__codelineno-27-128" name="__codelineno-27-128" href="#lab04-mcp-resources-__codelineno-27-128"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isDirectory</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-129"><a id="__codelineno-27-129" name="__codelineno-27-129" href="#lab04-mcp-resources-__codelineno-27-129"></a><span class="w">          </span><span class="c1">// Skip hidden directories</span>
</span><span id="__span-27-130"><a id="__codelineno-27-130" name="__codelineno-27-130" href="#lab04-mcp-resources-__codelineno-27-130"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-131"><a id="__codelineno-27-131" name="__codelineno-27-131" href="#lab04-mcp-resources-__codelineno-27-131"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">walkDirectory</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">));</span>
</span><span id="__span-27-132"><a id="__codelineno-27-132" name="__codelineno-27-132" href="#lab04-mcp-resources-__codelineno-27-132"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-27-133"><a id="__codelineno-27-133" name="__codelineno-27-133" href="#lab04-mcp-resources-__codelineno-27-133"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">isFile</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-134"><a id="__codelineno-27-134" name="__codelineno-27-134" href="#lab04-mcp-resources-__codelineno-27-134"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">name</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-135"><a id="__codelineno-27-135" name="__codelineno-27-135" href="#lab04-mcp-resources-__codelineno-27-135"></a><span class="w">          </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedExtensions</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">ext</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-136"><a id="__codelineno-27-136" name="__codelineno-27-136" href="#lab04-mcp-resources-__codelineno-27-136"></a><span class="w">            </span><span class="nx">files</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fullPath</span><span class="p">);</span>
</span><span id="__span-27-137"><a id="__codelineno-27-137" name="__codelineno-27-137" href="#lab04-mcp-resources-__codelineno-27-137"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-27-138"><a id="__codelineno-27-138" name="__codelineno-27-138" href="#lab04-mcp-resources-__codelineno-27-138"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-27-139"><a id="__codelineno-27-139" name="__codelineno-27-139" href="#lab04-mcp-resources-__codelineno-27-139"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-27-140"><a id="__codelineno-27-140" name="__codelineno-27-140" href="#lab04-mcp-resources-__codelineno-27-140"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-141"><a id="__codelineno-27-141" name="__codelineno-27-141" href="#lab04-mcp-resources-__codelineno-27-141"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Error walking directory </span><span class="si">${</span><span class="nx">dir</span><span class="si">}</span><span class="sb">:`</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-142"><a id="__codelineno-27-142" name="__codelineno-27-142" href="#lab04-mcp-resources-__codelineno-27-142"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-143"><a id="__codelineno-27-143" name="__codelineno-27-143" href="#lab04-mcp-resources-__codelineno-27-143"></a>
</span><span id="__span-27-144"><a id="__codelineno-27-144" name="__codelineno-27-144" href="#lab04-mcp-resources-__codelineno-27-144"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">files</span><span class="p">;</span>
</span><span id="__span-27-145"><a id="__codelineno-27-145" name="__codelineno-27-145" href="#lab04-mcp-resources-__codelineno-27-145"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-146"><a id="__codelineno-27-146" name="__codelineno-27-146" href="#lab04-mcp-resources-__codelineno-27-146"></a>
</span><span id="__span-27-147"><a id="__codelineno-27-147" name="__codelineno-27-147" href="#lab04-mcp-resources-__codelineno-27-147"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getMimeType</span><span class="p">(</span><span class="nx">filePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-148"><a id="__codelineno-27-148" name="__codelineno-27-148" href="#lab04-mcp-resources-__codelineno-27-148"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">ext</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">extname</span><span class="p">(</span><span class="nx">filePath</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">();</span>
</span><span id="__span-27-149"><a id="__codelineno-27-149" name="__codelineno-27-149" href="#lab04-mcp-resources-__codelineno-27-149"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-150"><a id="__codelineno-27-150" name="__codelineno-27-150" href="#lab04-mcp-resources-__codelineno-27-150"></a><span class="w">      </span><span class="s1">&#39;.md&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/markdown&#39;</span><span class="p">,</span>
</span><span id="__span-27-151"><a id="__codelineno-27-151" name="__codelineno-27-151" href="#lab04-mcp-resources-__codelineno-27-151"></a><span class="w">      </span><span class="s1">&#39;.txt&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">,</span>
</span><span id="__span-27-152"><a id="__codelineno-27-152" name="__codelineno-27-152" href="#lab04-mcp-resources-__codelineno-27-152"></a><span class="w">      </span><span class="s1">&#39;.json&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
</span><span id="__span-27-153"><a id="__codelineno-27-153" name="__codelineno-27-153" href="#lab04-mcp-resources-__codelineno-27-153"></a><span class="w">      </span><span class="s1">&#39;.yaml&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/yaml&#39;</span><span class="p">,</span>
</span><span id="__span-27-154"><a id="__codelineno-27-154" name="__codelineno-27-154" href="#lab04-mcp-resources-__codelineno-27-154"></a><span class="w">      </span><span class="s1">&#39;.yml&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;application/yaml&#39;</span><span class="p">,</span>
</span><span id="__span-27-155"><a id="__codelineno-27-155" name="__codelineno-27-155" href="#lab04-mcp-resources-__codelineno-27-155"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-27-156"><a id="__codelineno-27-156" name="__codelineno-27-156" href="#lab04-mcp-resources-__codelineno-27-156"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">mimeTypes</span><span class="p">[</span><span class="nx">ext</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;text/plain&#39;</span><span class="p">;</span>
</span><span id="__span-27-157"><a id="__codelineno-27-157" name="__codelineno-27-157" href="#lab04-mcp-resources-__codelineno-27-157"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-158"><a id="__codelineno-27-158" name="__codelineno-27-158" href="#lab04-mcp-resources-__codelineno-27-158"></a>
</span><span id="__span-27-159"><a id="__codelineno-27-159" name="__codelineno-27-159" href="#lab04-mcp-resources-__codelineno-27-159"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">formatFileSize</span><span class="p">(</span><span class="nx">bytes</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-160"><a id="__codelineno-27-160" name="__codelineno-27-160" href="#lab04-mcp-resources-__codelineno-27-160"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">units</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;KB&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;MB&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;GB&#39;</span><span class="p">];</span>
</span><span id="__span-27-161"><a id="__codelineno-27-161" name="__codelineno-27-161" href="#lab04-mcp-resources-__codelineno-27-161"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">bytes</span><span class="p">;</span>
</span><span id="__span-27-162"><a id="__codelineno-27-162" name="__codelineno-27-162" href="#lab04-mcp-resources-__codelineno-27-162"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">unitIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-27-163"><a id="__codelineno-27-163" name="__codelineno-27-163" href="#lab04-mcp-resources-__codelineno-27-163"></a>
</span><span id="__span-27-164"><a id="__codelineno-27-164" name="__codelineno-27-164" href="#lab04-mcp-resources-__codelineno-27-164"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nx">size</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">1024</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">unitIndex</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="nx">units</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">1</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-165"><a id="__codelineno-27-165" name="__codelineno-27-165" href="#lab04-mcp-resources-__codelineno-27-165"></a><span class="w">      </span><span class="nx">size</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mf">1024</span><span class="p">;</span>
</span><span id="__span-27-166"><a id="__codelineno-27-166" name="__codelineno-27-166" href="#lab04-mcp-resources-__codelineno-27-166"></a><span class="w">      </span><span class="nx">unitIndex</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-27-167"><a id="__codelineno-27-167" name="__codelineno-27-167" href="#lab04-mcp-resources-__codelineno-27-167"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-27-168"><a id="__codelineno-27-168" name="__codelineno-27-168" href="#lab04-mcp-resources-__codelineno-27-168"></a>
</span><span id="__span-27-169"><a id="__codelineno-27-169" name="__codelineno-27-169" href="#lab04-mcp-resources-__codelineno-27-169"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">size</span><span class="p">.</span><span class="nx">toFixed</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">units</span><span class="p">[</span><span class="nx">unitIndex</span><span class="p">]</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-170"><a id="__codelineno-27-170" name="__codelineno-27-170" href="#lab04-mcp-resources-__codelineno-27-170"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-171"><a id="__codelineno-27-171" name="__codelineno-27-171" href="#lab04-mcp-resources-__codelineno-27-171"></a>
</span><span id="__span-27-172"><a id="__codelineno-27-172" name="__codelineno-27-172" href="#lab04-mcp-resources-__codelineno-27-172"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-173"><a id="__codelineno-27-173" name="__codelineno-27-173" href="#lab04-mcp-resources-__codelineno-27-173"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-174"><a id="__codelineno-27-174" name="__codelineno-27-174" href="#lab04-mcp-resources-__codelineno-27-174"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-175"><a id="__codelineno-27-175" name="__codelineno-27-175" href="#lab04-mcp-resources-__codelineno-27-175"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-27-176"><a id="__codelineno-27-176" name="__codelineno-27-176" href="#lab04-mcp-resources-__codelineno-27-176"></a>
</span><span id="__span-27-177"><a id="__codelineno-27-177" name="__codelineno-27-177" href="#lab04-mcp-resources-__codelineno-27-177"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-178"><a id="__codelineno-27-178" name="__codelineno-27-178" href="#lab04-mcp-resources-__codelineno-27-178"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-27-179"><a id="__codelineno-27-179" name="__codelineno-27-179" href="#lab04-mcp-resources-__codelineno-27-179"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-27-180"><a id="__codelineno-27-180" name="__codelineno-27-180" href="#lab04-mcp-resources-__codelineno-27-180"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-27-181"><a id="__codelineno-27-181" name="__codelineno-27-181" href="#lab04-mcp-resources-__codelineno-27-181"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-182"><a id="__codelineno-27-182" name="__codelineno-27-182" href="#lab04-mcp-resources-__codelineno-27-182"></a>
</span><span id="__span-27-183"><a id="__codelineno-27-183" name="__codelineno-27-183" href="#lab04-mcp-resources-__codelineno-27-183"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-184"><a id="__codelineno-27-184" name="__codelineno-27-184" href="#lab04-mcp-resources-__codelineno-27-184"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-27-185"><a id="__codelineno-27-185" name="__codelineno-27-185" href="#lab04-mcp-resources-__codelineno-27-185"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-27-186"><a id="__codelineno-27-186" name="__codelineno-27-186" href="#lab04-mcp-resources-__codelineno-27-186"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`File System Resource Server running (root: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">rootDir</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-27-187"><a id="__codelineno-27-187" name="__codelineno-27-187" href="#lab04-mcp-resources-__codelineno-27-187"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-27-188"><a id="__codelineno-27-188" name="__codelineno-27-188" href="#lab04-mcp-resources-__codelineno-27-188"></a><span class="p">}</span>
</span><span id="__span-27-189"><a id="__codelineno-27-189" name="__codelineno-27-189" href="#lab04-mcp-resources-__codelineno-27-189"></a>
</span><span id="__span-27-190"><a id="__codelineno-27-190" name="__codelineno-27-190" href="#lab04-mcp-resources-__codelineno-27-190"></a><span class="c1">// Main entry point</span>
</span><span id="__span-27-191"><a id="__codelineno-27-191" name="__codelineno-27-191" href="#lab04-mcp-resources-__codelineno-27-191"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-192"><a id="__codelineno-27-192" name="__codelineno-27-192" href="#lab04-mcp-resources-__codelineno-27-192"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">FileSystemResourceServer</span><span class="p">();</span>
</span><span id="__span-27-193"><a id="__codelineno-27-193" name="__codelineno-27-193" href="#lab04-mcp-resources-__codelineno-27-193"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-27-194"><a id="__codelineno-27-194" name="__codelineno-27-194" href="#lab04-mcp-resources-__codelineno-27-194"></a><span class="p">}</span>
</span><span id="__span-27-195"><a id="__codelineno-27-195" name="__codelineno-27-195" href="#lab04-mcp-resources-__codelineno-27-195"></a>
</span><span id="__span-27-196"><a id="__codelineno-27-196" name="__codelineno-27-196" href="#lab04-mcp-resources-__codelineno-27-196"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-197"><a id="__codelineno-27-197" name="__codelineno-27-197" href="#lab04-mcp-resources-__codelineno-27-197"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-27-198"><a id="__codelineno-27-198" name="__codelineno-27-198" href="#lab04-mcp-resources-__codelineno-27-198"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-27-199"><a id="__codelineno-27-199" name="__codelineno-27-199" href="#lab04-mcp-resources-__codelineno-27-199"></a><span class="p">});</span>
</span></code></pre></div>

Testing - Create test files and test the server:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab04-mcp-resources-__codelineno-28-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>files/docs<span class="w"> </span>files/data
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#lab04-mcp-resources-__codelineno-28-2"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;# API Documentation&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>files/docs/api.md
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#lab04-mcp-resources-__codelineno-28-3"></a><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;{&quot;version&quot;: &quot;1.0.0&quot;}&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>files/data/config.json
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#lab04-mcp-resources-__codelineno-28-4"></a><span class="nb">echo</span><span class="w"> </span><span class="s2">&quot;Simple text file&quot;</span><span class="w"> </span>&gt;<span class="w"> </span>files/docs/notes.txt
</span></code></pre></div>

Test with MCP Inspector to verify file discovery and reading.

</details>

<h3 id="lab04-mcp-resources-exercise-2-rest-api-resource-server">Exercise 2: REST API Resource Server<a class="headerlink" href="#lab04-mcp-resources-exercise-2-rest-api-resource-server" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Exposes REST API endpoints as resources</li>
<li>Supports query parameters in URIs</li>
<li>Handles authentication and rate limiting</li>
<li>Caches responses appropriately</li>
</ul>
<details>
<summary>üí° Solution: REST API Resource Server</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab04-mcp-resources-__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#lab04-mcp-resources-__codelineno-29-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;create_api_resource_server&quot;</span><span class="p">,</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#lab04-mcp-resources-__codelineno-29-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Create an MCP server that exposes REST API endpoints as resources&quot;</span><span class="p">,</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#lab04-mcp-resources-__codelineno-29-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#lab04-mcp-resources-__codelineno-29-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#lab04-mcp-resources-__codelineno-29-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#lab04-mcp-resources-__codelineno-29-7"></a><span class="w">      </span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#lab04-mcp-resources-__codelineno-29-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#lab04-mcp-resources-__codelineno-29-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Base URL of the API to expose&quot;</span><span class="p">,</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#lab04-mcp-resources-__codelineno-29-10"></a><span class="w">        </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;uri&quot;</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#lab04-mcp-resources-__codelineno-29-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#lab04-mcp-resources-__codelineno-29-12"></a><span class="w">      </span><span class="nx">apiKey</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#lab04-mcp-resources-__codelineno-29-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#lab04-mcp-resources-__codelineno-29-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API key for authentication&quot;</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#lab04-mcp-resources-__codelineno-29-15"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#lab04-mcp-resources-__codelineno-29-16"></a><span class="w">      </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#lab04-mcp-resources-__codelineno-29-17"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#lab04-mcp-resources-__codelineno-29-18"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Enable response caching&quot;</span><span class="p">,</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#lab04-mcp-resources-__codelineno-29-19"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#lab04-mcp-resources-__codelineno-29-20"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#lab04-mcp-resources-__codelineno-29-21"></a><span class="w">      </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#lab04-mcp-resources-__codelineno-29-22"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#lab04-mcp-resources-__codelineno-29-23"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Cache TTL in seconds&quot;</span><span class="p">,</span>
</span><span id="__span-29-24"><a id="__codelineno-29-24" name="__codelineno-29-24" href="#lab04-mcp-resources-__codelineno-29-24"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">300</span>
</span><span id="__span-29-25"><a id="__codelineno-29-25" name="__codelineno-29-25" href="#lab04-mcp-resources-__codelineno-29-25"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-26"><a id="__codelineno-29-26" name="__codelineno-29-26" href="#lab04-mcp-resources-__codelineno-29-26"></a><span class="w">      </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-27"><a id="__codelineno-29-27" name="__codelineno-29-27" href="#lab04-mcp-resources-__codelineno-29-27"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-29-28"><a id="__codelineno-29-28" name="__codelineno-29-28" href="#lab04-mcp-resources-__codelineno-29-28"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Requests per minute limit&quot;</span><span class="p">,</span>
</span><span id="__span-29-29"><a id="__codelineno-29-29" name="__codelineno-29-29" href="#lab04-mcp-resources-__codelineno-29-29"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">60</span>
</span><span id="__span-29-30"><a id="__codelineno-29-30" name="__codelineno-29-30" href="#lab04-mcp-resources-__codelineno-29-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-29-31"><a id="__codelineno-29-31" name="__codelineno-29-31" href="#lab04-mcp-resources-__codelineno-29-31"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-32"><a id="__codelineno-29-32" name="__codelineno-29-32" href="#lab04-mcp-resources-__codelineno-29-32"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;baseUrl&quot;</span><span class="p">]</span>
</span><span id="__span-29-33"><a id="__codelineno-29-33" name="__codelineno-29-33" href="#lab04-mcp-resources-__codelineno-29-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-34"><a id="__codelineno-29-34" name="__codelineno-29-34" href="#lab04-mcp-resources-__codelineno-29-34"></a><span class="p">}</span>
</span></code></pre></div>

Implementation

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab04-mcp-resources-__codelineno-30-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#lab04-mcp-resources-__codelineno-30-2"></a>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#lab04-mcp-resources-__codelineno-30-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#lab04-mcp-resources-__codelineno-30-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#lab04-mcp-resources-__codelineno-30-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#lab04-mcp-resources-__codelineno-30-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#lab04-mcp-resources-__codelineno-30-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#lab04-mcp-resources-__codelineno-30-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#lab04-mcp-resources-__codelineno-30-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#lab04-mcp-resources-__codelineno-30-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-30-11"><a id="__codelineno-30-11" name="__codelineno-30-11" href="#lab04-mcp-resources-__codelineno-30-11"></a><span class="k">import</span><span class="w"> </span><span class="nx">axios</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">AxiosResponse</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;axios&#39;</span><span class="p">;</span>
</span><span id="__span-30-12"><a id="__codelineno-30-12" name="__codelineno-30-12" href="#lab04-mcp-resources-__codelineno-30-12"></a>
</span><span id="__span-30-13"><a id="__codelineno-30-13" name="__codelineno-30-13" href="#lab04-mcp-resources-__codelineno-30-13"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">CacheEntry</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-14"><a id="__codelineno-30-14" name="__codelineno-30-14" href="#lab04-mcp-resources-__codelineno-30-14"></a><span class="w">  </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span>
</span><span id="__span-30-15"><a id="__codelineno-30-15" name="__codelineno-30-15" href="#lab04-mcp-resources-__codelineno-30-15"></a><span class="w">  </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-16"><a id="__codelineno-30-16" name="__codelineno-30-16" href="#lab04-mcp-resources-__codelineno-30-16"></a><span class="w">  </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-17"><a id="__codelineno-30-17" name="__codelineno-30-17" href="#lab04-mcp-resources-__codelineno-30-17"></a><span class="p">}</span>
</span><span id="__span-30-18"><a id="__codelineno-30-18" name="__codelineno-30-18" href="#lab04-mcp-resources-__codelineno-30-18"></a>
</span><span id="__span-30-19"><a id="__codelineno-30-19" name="__codelineno-30-19" href="#lab04-mcp-resources-__codelineno-30-19"></a><span class="kd">class</span><span class="w"> </span><span class="nx">APIResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-20"><a id="__codelineno-30-20" name="__codelineno-30-20" href="#lab04-mcp-resources-__codelineno-30-20"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-30-21"><a id="__codelineno-30-21" name="__codelineno-30-21" href="#lab04-mcp-resources-__codelineno-30-21"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-30-22"><a id="__codelineno-30-22" name="__codelineno-30-22" href="#lab04-mcp-resources-__codelineno-30-22"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-30-23"><a id="__codelineno-30-23" name="__codelineno-30-23" href="#lab04-mcp-resources-__codelineno-30-23"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cache</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">CacheEntry</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-30-24"><a id="__codelineno-30-24" name="__codelineno-30-24" href="#lab04-mcp-resources-__codelineno-30-24"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
</span><span id="__span-30-25"><a id="__codelineno-30-25" name="__codelineno-30-25" href="#lab04-mcp-resources-__codelineno-30-25"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-26"><a id="__codelineno-30-26" name="__codelineno-30-26" href="#lab04-mcp-resources-__codelineno-30-26"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-30-27"><a id="__codelineno-30-27" name="__codelineno-30-27" href="#lab04-mcp-resources-__codelineno-30-27"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">requestCounts</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-30-28"><a id="__codelineno-30-28" name="__codelineno-30-28" href="#lab04-mcp-resources-__codelineno-30-28"></a>
</span><span id="__span-30-29"><a id="__codelineno-30-29" name="__codelineno-30-29" href="#lab04-mcp-resources-__codelineno-30-29"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">baseUrl</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">apiKey?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">300</span><span class="p">,</span><span class="w"> </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-30"><a id="__codelineno-30-30" name="__codelineno-30-30" href="#lab04-mcp-resources-__codelineno-30-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">baseUrl</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">);</span><span class="w"> </span><span class="c1">// Remove trailing slash</span>
</span><span id="__span-30-31"><a id="__codelineno-30-31" name="__codelineno-30-31" href="#lab04-mcp-resources-__codelineno-30-31"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">apiKey</span><span class="p">;</span>
</span><span id="__span-30-32"><a id="__codelineno-30-32" name="__codelineno-30-32" href="#lab04-mcp-resources-__codelineno-30-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cacheEnabled</span><span class="p">;</span>
</span><span id="__span-30-33"><a id="__codelineno-30-33" name="__codelineno-30-33" href="#lab04-mcp-resources-__codelineno-30-33"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cacheTTL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cacheTTL</span><span class="p">;</span>
</span><span id="__span-30-34"><a id="__codelineno-30-34" name="__codelineno-30-34" href="#lab04-mcp-resources-__codelineno-30-34"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">rateLimit</span><span class="p">;</span>
</span><span id="__span-30-35"><a id="__codelineno-30-35" name="__codelineno-30-35" href="#lab04-mcp-resources-__codelineno-30-35"></a>
</span><span id="__span-30-36"><a id="__codelineno-30-36" name="__codelineno-30-36" href="#lab04-mcp-resources-__codelineno-30-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-30-37"><a id="__codelineno-30-37" name="__codelineno-30-37" href="#lab04-mcp-resources-__codelineno-30-37"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-30-38"><a id="__codelineno-30-38" name="__codelineno-30-38" href="#lab04-mcp-resources-__codelineno-30-38"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-30-39"><a id="__codelineno-30-39" name="__codelineno-30-39" href="#lab04-mcp-resources-__codelineno-30-39"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-30-40"><a id="__codelineno-30-40" name="__codelineno-30-40" href="#lab04-mcp-resources-__codelineno-30-40"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-30-41"><a id="__codelineno-30-41" name="__codelineno-30-41" href="#lab04-mcp-resources-__codelineno-30-41"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-30-42"><a id="__codelineno-30-42" name="__codelineno-30-42" href="#lab04-mcp-resources-__codelineno-30-42"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-43"><a id="__codelineno-30-43" name="__codelineno-30-43" href="#lab04-mcp-resources-__codelineno-30-43"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-30-44"><a id="__codelineno-30-44" name="__codelineno-30-44" href="#lab04-mcp-resources-__codelineno-30-44"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-45"><a id="__codelineno-30-45" name="__codelineno-30-45" href="#lab04-mcp-resources-__codelineno-30-45"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-46"><a id="__codelineno-30-46" name="__codelineno-30-46" href="#lab04-mcp-resources-__codelineno-30-46"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-30-47"><a id="__codelineno-30-47" name="__codelineno-30-47" href="#lab04-mcp-resources-__codelineno-30-47"></a>
</span><span id="__span-30-48"><a id="__codelineno-30-48" name="__codelineno-30-48" href="#lab04-mcp-resources-__codelineno-30-48"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-30-49"><a id="__codelineno-30-49" name="__codelineno-30-49" href="#lab04-mcp-resources-__codelineno-30-49"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-30-50"><a id="__codelineno-30-50" name="__codelineno-30-50" href="#lab04-mcp-resources-__codelineno-30-50"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">startCacheCleanup</span><span class="p">();</span>
</span><span id="__span-30-51"><a id="__codelineno-30-51" name="__codelineno-30-51" href="#lab04-mcp-resources-__codelineno-30-51"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-52"><a id="__codelineno-30-52" name="__codelineno-30-52" href="#lab04-mcp-resources-__codelineno-30-52"></a>
</span><span id="__span-30-53"><a id="__codelineno-30-53" name="__codelineno-30-53" href="#lab04-mcp-resources-__codelineno-30-53"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-54"><a id="__codelineno-30-54" name="__codelineno-30-54" href="#lab04-mcp-resources-__codelineno-30-54"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-55"><a id="__codelineno-30-55" name="__codelineno-30-55" href="#lab04-mcp-resources-__codelineno-30-55"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-56"><a id="__codelineno-30-56" name="__codelineno-30-56" href="#lab04-mcp-resources-__codelineno-30-56"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-57"><a id="__codelineno-30-57" name="__codelineno-30-57" href="#lab04-mcp-resources-__codelineno-30-57"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://users/{userId}&quot;</span><span class="p">,</span>
</span><span id="__span-30-58"><a id="__codelineno-30-58" name="__codelineno-30-58" href="#lab04-mcp-resources-__codelineno-30-58"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User Profile&quot;</span><span class="p">,</span>
</span><span id="__span-30-59"><a id="__codelineno-30-59" name="__codelineno-30-59" href="#lab04-mcp-resources-__codelineno-30-59"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;User profile data from API&quot;</span><span class="p">,</span>
</span><span id="__span-30-60"><a id="__codelineno-30-60" name="__codelineno-30-60" href="#lab04-mcp-resources-__codelineno-30-60"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-61"><a id="__codelineno-30-61" name="__codelineno-30-61" href="#lab04-mcp-resources-__codelineno-30-61"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-62"><a id="__codelineno-30-62" name="__codelineno-30-62" href="#lab04-mcp-resources-__codelineno-30-62"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-63"><a id="__codelineno-30-63" name="__codelineno-30-63" href="#lab04-mcp-resources-__codelineno-30-63"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://posts/{postId}&quot;</span><span class="p">,</span>
</span><span id="__span-30-64"><a id="__codelineno-30-64" name="__codelineno-30-64" href="#lab04-mcp-resources-__codelineno-30-64"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Post Details&quot;</span><span class="p">,</span>
</span><span id="__span-30-65"><a id="__codelineno-30-65" name="__codelineno-30-65" href="#lab04-mcp-resources-__codelineno-30-65"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Post details from API&quot;</span><span class="p">,</span>
</span><span id="__span-30-66"><a id="__codelineno-30-66" name="__codelineno-30-66" href="#lab04-mcp-resources-__codelineno-30-66"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-67"><a id="__codelineno-30-67" name="__codelineno-30-67" href="#lab04-mcp-resources-__codelineno-30-67"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-68"><a id="__codelineno-30-68" name="__codelineno-30-68" href="#lab04-mcp-resources-__codelineno-30-68"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-69"><a id="__codelineno-30-69" name="__codelineno-30-69" href="#lab04-mcp-resources-__codelineno-30-69"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://search?q={query}&amp;type={type}&quot;</span><span class="p">,</span>
</span><span id="__span-30-70"><a id="__codelineno-30-70" name="__codelineno-30-70" href="#lab04-mcp-resources-__codelineno-30-70"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search Results&quot;</span><span class="p">,</span>
</span><span id="__span-30-71"><a id="__codelineno-30-71" name="__codelineno-30-71" href="#lab04-mcp-resources-__codelineno-30-71"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Search API results&quot;</span><span class="p">,</span>
</span><span id="__span-30-72"><a id="__codelineno-30-72" name="__codelineno-30-72" href="#lab04-mcp-resources-__codelineno-30-72"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-73"><a id="__codelineno-30-73" name="__codelineno-30-73" href="#lab04-mcp-resources-__codelineno-30-73"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-74"><a id="__codelineno-30-74" name="__codelineno-30-74" href="#lab04-mcp-resources-__codelineno-30-74"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-30-75"><a id="__codelineno-30-75" name="__codelineno-30-75" href="#lab04-mcp-resources-__codelineno-30-75"></a>
</span><span id="__span-30-76"><a id="__codelineno-30-76" name="__codelineno-30-76" href="#lab04-mcp-resources-__codelineno-30-76"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-77"><a id="__codelineno-30-77" name="__codelineno-30-77" href="#lab04-mcp-resources-__codelineno-30-77"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-78"><a id="__codelineno-30-78" name="__codelineno-30-78" href="#lab04-mcp-resources-__codelineno-30-78"></a>
</span><span id="__span-30-79"><a id="__codelineno-30-79" name="__codelineno-30-79" href="#lab04-mcp-resources-__codelineno-30-79"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-80"><a id="__codelineno-30-80" name="__codelineno-30-80" href="#lab04-mcp-resources-__codelineno-30-80"></a><span class="w">      </span><span class="c1">// For demonstration, we&#39;ll provide some example resources</span>
</span><span id="__span-30-81"><a id="__codelineno-30-81" name="__codelineno-30-81" href="#lab04-mcp-resources-__codelineno-30-81"></a><span class="w">      </span><span class="c1">// In a real implementation, you might fetch these from the API</span>
</span><span id="__span-30-82"><a id="__codelineno-30-82" name="__codelineno-30-82" href="#lab04-mcp-resources-__codelineno-30-82"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-30-83"><a id="__codelineno-30-83" name="__codelineno-30-83" href="#lab04-mcp-resources-__codelineno-30-83"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-84"><a id="__codelineno-30-84" name="__codelineno-30-84" href="#lab04-mcp-resources-__codelineno-30-84"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://status&quot;</span><span class="p">,</span>
</span><span id="__span-30-85"><a id="__codelineno-30-85" name="__codelineno-30-85" href="#lab04-mcp-resources-__codelineno-30-85"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API Status&quot;</span><span class="p">,</span>
</span><span id="__span-30-86"><a id="__codelineno-30-86" name="__codelineno-30-86" href="#lab04-mcp-resources-__codelineno-30-86"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Current API status and health&quot;</span><span class="p">,</span>
</span><span id="__span-30-87"><a id="__codelineno-30-87" name="__codelineno-30-87" href="#lab04-mcp-resources-__codelineno-30-87"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-88"><a id="__codelineno-30-88" name="__codelineno-30-88" href="#lab04-mcp-resources-__codelineno-30-88"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-89"><a id="__codelineno-30-89" name="__codelineno-30-89" href="#lab04-mcp-resources-__codelineno-30-89"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-30-90"><a id="__codelineno-30-90" name="__codelineno-30-90" href="#lab04-mcp-resources-__codelineno-30-90"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://info&quot;</span><span class="p">,</span>
</span><span id="__span-30-91"><a id="__codelineno-30-91" name="__codelineno-30-91" href="#lab04-mcp-resources-__codelineno-30-91"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API Information&quot;</span><span class="p">,</span>
</span><span id="__span-30-92"><a id="__codelineno-30-92" name="__codelineno-30-92" href="#lab04-mcp-resources-__codelineno-30-92"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API metadata and capabilities&quot;</span><span class="p">,</span>
</span><span id="__span-30-93"><a id="__codelineno-30-93" name="__codelineno-30-93" href="#lab04-mcp-resources-__codelineno-30-93"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-94"><a id="__codelineno-30-94" name="__codelineno-30-94" href="#lab04-mcp-resources-__codelineno-30-94"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-30-95"><a id="__codelineno-30-95" name="__codelineno-30-95" href="#lab04-mcp-resources-__codelineno-30-95"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-30-96"><a id="__codelineno-30-96" name="__codelineno-30-96" href="#lab04-mcp-resources-__codelineno-30-96"></a>
</span><span id="__span-30-97"><a id="__codelineno-30-97" name="__codelineno-30-97" href="#lab04-mcp-resources-__codelineno-30-97"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-98"><a id="__codelineno-30-98" name="__codelineno-30-98" href="#lab04-mcp-resources-__codelineno-30-98"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-99"><a id="__codelineno-30-99" name="__codelineno-30-99" href="#lab04-mcp-resources-__codelineno-30-99"></a>
</span><span id="__span-30-100"><a id="__codelineno-30-100" name="__codelineno-30-100" href="#lab04-mcp-resources-__codelineno-30-100"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-101"><a id="__codelineno-30-101" name="__codelineno-30-101" href="#lab04-mcp-resources-__codelineno-30-101"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-30-102"><a id="__codelineno-30-102" name="__codelineno-30-102" href="#lab04-mcp-resources-__codelineno-30-102"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">fetchAPIResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-103"><a id="__codelineno-30-103" name="__codelineno-30-103" href="#lab04-mcp-resources-__codelineno-30-103"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-30-104"><a id="__codelineno-30-104" name="__codelineno-30-104" href="#lab04-mcp-resources-__codelineno-30-104"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-105"><a id="__codelineno-30-105" name="__codelineno-30-105" href="#lab04-mcp-resources-__codelineno-30-105"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-106"><a id="__codelineno-30-106" name="__codelineno-30-106" href="#lab04-mcp-resources-__codelineno-30-106"></a>
</span><span id="__span-30-107"><a id="__codelineno-30-107" name="__codelineno-30-107" href="#lab04-mcp-resources-__codelineno-30-107"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">fetchAPIResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-108"><a id="__codelineno-30-108" name="__codelineno-30-108" href="#lab04-mcp-resources-__codelineno-30-108"></a><span class="w">    </span><span class="c1">// Check rate limit</span>
</span><span id="__span-30-109"><a id="__codelineno-30-109" name="__codelineno-30-109" href="#lab04-mcp-resources-__codelineno-30-109"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">checkRateLimit</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-110"><a id="__codelineno-30-110" name="__codelineno-30-110" href="#lab04-mcp-resources-__codelineno-30-110"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Rate limit exceeded. Please try again later.&quot;</span><span class="p">);</span>
</span><span id="__span-30-111"><a id="__codelineno-30-111" name="__codelineno-30-111" href="#lab04-mcp-resources-__codelineno-30-111"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-112"><a id="__codelineno-30-112" name="__codelineno-30-112" href="#lab04-mcp-resources-__codelineno-30-112"></a>
</span><span id="__span-30-113"><a id="__codelineno-30-113" name="__codelineno-30-113" href="#lab04-mcp-resources-__codelineno-30-113"></a><span class="w">    </span><span class="c1">// Check cache first</span>
</span><span id="__span-30-114"><a id="__codelineno-30-114" name="__codelineno-30-114" href="#lab04-mcp-resources-__codelineno-30-114"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-115"><a id="__codelineno-30-115" name="__codelineno-30-115" href="#lab04-mcp-resources-__codelineno-30-115"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getCached</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-116"><a id="__codelineno-30-116" name="__codelineno-30-116" href="#lab04-mcp-resources-__codelineno-30-116"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-117"><a id="__codelineno-30-117" name="__codelineno-30-117" href="#lab04-mcp-resources-__codelineno-30-117"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-118"><a id="__codelineno-30-118" name="__codelineno-30-118" href="#lab04-mcp-resources-__codelineno-30-118"></a><span class="w">          </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-30-119"><a id="__codelineno-30-119" name="__codelineno-30-119" href="#lab04-mcp-resources-__codelineno-30-119"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-120"><a id="__codelineno-30-120" name="__codelineno-30-120" href="#lab04-mcp-resources-__codelineno-30-120"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-30-121"><a id="__codelineno-30-121" name="__codelineno-30-121" href="#lab04-mcp-resources-__codelineno-30-121"></a><span class="w">            </span><span class="p">...</span><span class="nx">cached</span><span class="p">,</span>
</span><span id="__span-30-122"><a id="__codelineno-30-122" name="__codelineno-30-122" href="#lab04-mcp-resources-__codelineno-30-122"></a><span class="w">            </span><span class="nx">cached</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-30-123"><a id="__codelineno-30-123" name="__codelineno-30-123" href="#lab04-mcp-resources-__codelineno-30-123"></a><span class="w">            </span><span class="nx">cacheAge</span><span class="o">:</span><span class="w"> </span><span class="kt">Math.floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">_cacheTimestamp</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="p">),</span>
</span><span id="__span-30-124"><a id="__codelineno-30-124" name="__codelineno-30-124" href="#lab04-mcp-resources-__codelineno-30-124"></a><span class="w">          </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-30-125"><a id="__codelineno-30-125" name="__codelineno-30-125" href="#lab04-mcp-resources-__codelineno-30-125"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-30-126"><a id="__codelineno-30-126" name="__codelineno-30-126" href="#lab04-mcp-resources-__codelineno-30-126"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-127"><a id="__codelineno-30-127" name="__codelineno-30-127" href="#lab04-mcp-resources-__codelineno-30-127"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-128"><a id="__codelineno-30-128" name="__codelineno-30-128" href="#lab04-mcp-resources-__codelineno-30-128"></a>
</span><span id="__span-30-129"><a id="__codelineno-30-129" name="__codelineno-30-129" href="#lab04-mcp-resources-__codelineno-30-129"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-130"><a id="__codelineno-30-130" name="__codelineno-30-130" href="#lab04-mcp-resources-__codelineno-30-130"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">apiPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">uriToAPIPath</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-131"><a id="__codelineno-30-131" name="__codelineno-30-131" href="#lab04-mcp-resources-__codelineno-30-131"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}${</span><span class="nx">apiPath</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-132"><a id="__codelineno-30-132" name="__codelineno-30-132" href="#lab04-mcp-resources-__codelineno-30-132"></a>
</span><span id="__span-30-133"><a id="__codelineno-30-133" name="__codelineno-30-133" href="#lab04-mcp-resources-__codelineno-30-133"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">headers</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-134"><a id="__codelineno-30-134" name="__codelineno-30-134" href="#lab04-mcp-resources-__codelineno-30-134"></a><span class="w">        </span><span class="s1">&#39;User-Agent&#39;</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;MCP-API-Resource-Server/1.0&#39;</span><span class="p">,</span>
</span><span id="__span-30-135"><a id="__codelineno-30-135" name="__codelineno-30-135" href="#lab04-mcp-resources-__codelineno-30-135"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-136"><a id="__codelineno-30-136" name="__codelineno-30-136" href="#lab04-mcp-resources-__codelineno-30-136"></a>
</span><span id="__span-30-137"><a id="__codelineno-30-137" name="__codelineno-30-137" href="#lab04-mcp-resources-__codelineno-30-137"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-138"><a id="__codelineno-30-138" name="__codelineno-30-138" href="#lab04-mcp-resources-__codelineno-30-138"></a><span class="w">        </span><span class="nx">headers</span><span class="p">[</span><span class="s1">&#39;Authorization&#39;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`Bearer </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-139"><a id="__codelineno-30-139" name="__codelineno-30-139" href="#lab04-mcp-resources-__codelineno-30-139"></a><span class="w">        </span><span class="c1">// Or: headers[&#39;X-API-Key&#39;] = this.apiKey;</span>
</span><span id="__span-30-140"><a id="__codelineno-30-140" name="__codelineno-30-140" href="#lab04-mcp-resources-__codelineno-30-140"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-141"><a id="__codelineno-30-141" name="__codelineno-30-141" href="#lab04-mcp-resources-__codelineno-30-141"></a>
</span><span id="__span-30-142"><a id="__codelineno-30-142" name="__codelineno-30-142" href="#lab04-mcp-resources-__codelineno-30-142"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="o">:</span><span class="w"> </span><span class="kt">AxiosResponse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-143"><a id="__codelineno-30-143" name="__codelineno-30-143" href="#lab04-mcp-resources-__codelineno-30-143"></a><span class="w">        </span><span class="nx">headers</span><span class="p">,</span>
</span><span id="__span-30-144"><a id="__codelineno-30-144" name="__codelineno-30-144" href="#lab04-mcp-resources-__codelineno-30-144"></a><span class="w">        </span><span class="nx">timeout</span><span class="o">:</span><span class="w"> </span><span class="kt">10000</span><span class="p">,</span>
</span><span id="__span-30-145"><a id="__codelineno-30-145" name="__codelineno-30-145" href="#lab04-mcp-resources-__codelineno-30-145"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-30-146"><a id="__codelineno-30-146" name="__codelineno-30-146" href="#lab04-mcp-resources-__codelineno-30-146"></a>
</span><span id="__span-30-147"><a id="__codelineno-30-147" name="__codelineno-30-147" href="#lab04-mcp-resources-__codelineno-30-147"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-148"><a id="__codelineno-30-148" name="__codelineno-30-148" href="#lab04-mcp-resources-__codelineno-30-148"></a><span class="w">        </span><span class="p">...</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
</span><span id="__span-30-149"><a id="__codelineno-30-149" name="__codelineno-30-149" href="#lab04-mcp-resources-__codelineno-30-149"></a><span class="w">        </span><span class="nx">_metadata</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-150"><a id="__codelineno-30-150" name="__codelineno-30-150" href="#lab04-mcp-resources-__codelineno-30-150"></a><span class="w">          </span><span class="nx">statusCode</span><span class="o">:</span><span class="w"> </span><span class="kt">response.status</span><span class="p">,</span>
</span><span id="__span-30-151"><a id="__codelineno-30-151" name="__codelineno-30-151" href="#lab04-mcp-resources-__codelineno-30-151"></a><span class="w">          </span><span class="nx">url</span><span class="o">:</span><span class="w"> </span><span class="kt">url</span><span class="p">,</span>
</span><span id="__span-30-152"><a id="__codelineno-30-152" name="__codelineno-30-152" href="#lab04-mcp-resources-__codelineno-30-152"></a><span class="w">          </span><span class="nx">fetchedAt</span><span class="o">:</span><span class="w"> </span><span class="kt">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">(),</span>
</span><span id="__span-30-153"><a id="__codelineno-30-153" name="__codelineno-30-153" href="#lab04-mcp-resources-__codelineno-30-153"></a><span class="w">          </span><span class="nx">contentType</span><span class="o">:</span><span class="w"> </span><span class="kt">response.headers</span><span class="p">[</span><span class="s1">&#39;content-type&#39;</span><span class="p">],</span>
</span><span id="__span-30-154"><a id="__codelineno-30-154" name="__codelineno-30-154" href="#lab04-mcp-resources-__codelineno-30-154"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-155"><a id="__codelineno-30-155" name="__codelineno-30-155" href="#lab04-mcp-resources-__codelineno-30-155"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-156"><a id="__codelineno-30-156" name="__codelineno-30-156" href="#lab04-mcp-resources-__codelineno-30-156"></a>
</span><span id="__span-30-157"><a id="__codelineno-30-157" name="__codelineno-30-157" href="#lab04-mcp-resources-__codelineno-30-157"></a><span class="w">      </span><span class="c1">// Cache the response</span>
</span><span id="__span-30-158"><a id="__codelineno-30-158" name="__codelineno-30-158" href="#lab04-mcp-resources-__codelineno-30-158"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheEnabled</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-159"><a id="__codelineno-30-159" name="__codelineno-30-159" href="#lab04-mcp-resources-__codelineno-30-159"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">setCache</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">);</span>
</span><span id="__span-30-160"><a id="__codelineno-30-160" name="__codelineno-30-160" href="#lab04-mcp-resources-__codelineno-30-160"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-161"><a id="__codelineno-30-161" name="__codelineno-30-161" href="#lab04-mcp-resources-__codelineno-30-161"></a>
</span><span id="__span-30-162"><a id="__codelineno-30-162" name="__codelineno-30-162" href="#lab04-mcp-resources-__codelineno-30-162"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-163"><a id="__codelineno-30-163" name="__codelineno-30-163" href="#lab04-mcp-resources-__codelineno-30-163"></a><span class="w">        </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-30-164"><a id="__codelineno-30-164" name="__codelineno-30-164" href="#lab04-mcp-resources-__codelineno-30-164"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-30-165"><a id="__codelineno-30-165" name="__codelineno-30-165" href="#lab04-mcp-resources-__codelineno-30-165"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-30-166"><a id="__codelineno-30-166" name="__codelineno-30-166" href="#lab04-mcp-resources-__codelineno-30-166"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-30-167"><a id="__codelineno-30-167" name="__codelineno-30-167" href="#lab04-mcp-resources-__codelineno-30-167"></a>
</span><span id="__span-30-168"><a id="__codelineno-30-168" name="__codelineno-30-168" href="#lab04-mcp-resources-__codelineno-30-168"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-169"><a id="__codelineno-30-169" name="__codelineno-30-169" href="#lab04-mcp-resources-__codelineno-30-169"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">axios</span><span class="p">.</span><span class="nx">isAxiosError</span><span class="p">(</span><span class="nx">error</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-170"><a id="__codelineno-30-170" name="__codelineno-30-170" href="#lab04-mcp-resources-__codelineno-30-170"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-171"><a id="__codelineno-30-171" name="__codelineno-30-171" href="#lab04-mcp-resources-__codelineno-30-171"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`API Error </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">status</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="p">.</span><span class="nx">statusText</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-172"><a id="__codelineno-30-172" name="__codelineno-30-172" href="#lab04-mcp-resources-__codelineno-30-172"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">code</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;ECONNREFUSED&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-173"><a id="__codelineno-30-173" name="__codelineno-30-173" href="#lab04-mcp-resources-__codelineno-30-173"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Cannot connect to API: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-174"><a id="__codelineno-30-174" name="__codelineno-30-174" href="#lab04-mcp-resources-__codelineno-30-174"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-175"><a id="__codelineno-30-175" name="__codelineno-30-175" href="#lab04-mcp-resources-__codelineno-30-175"></a><span class="w">          </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Network error: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-176"><a id="__codelineno-30-176" name="__codelineno-30-176" href="#lab04-mcp-resources-__codelineno-30-176"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-177"><a id="__codelineno-30-177" name="__codelineno-30-177" href="#lab04-mcp-resources-__codelineno-30-177"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-178"><a id="__codelineno-30-178" name="__codelineno-30-178" href="#lab04-mcp-resources-__codelineno-30-178"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Failed to fetch API resource: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-179"><a id="__codelineno-30-179" name="__codelineno-30-179" href="#lab04-mcp-resources-__codelineno-30-179"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-180"><a id="__codelineno-30-180" name="__codelineno-30-180" href="#lab04-mcp-resources-__codelineno-30-180"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-181"><a id="__codelineno-30-181" name="__codelineno-30-181" href="#lab04-mcp-resources-__codelineno-30-181"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-182"><a id="__codelineno-30-182" name="__codelineno-30-182" href="#lab04-mcp-resources-__codelineno-30-182"></a>
</span><span id="__span-30-183"><a id="__codelineno-30-183" name="__codelineno-30-183" href="#lab04-mcp-resources-__codelineno-30-183"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">uriToAPIPath</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-184"><a id="__codelineno-30-184" name="__codelineno-30-184" href="#lab04-mcp-resources-__codelineno-30-184"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;api://&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-185"><a id="__codelineno-30-185" name="__codelineno-30-185" href="#lab04-mcp-resources-__codelineno-30-185"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid API URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-30-186"><a id="__codelineno-30-186" name="__codelineno-30-186" href="#lab04-mcp-resources-__codelineno-30-186"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-187"><a id="__codelineno-30-187" name="__codelineno-30-187" href="#lab04-mcp-resources-__codelineno-30-187"></a>
</span><span id="__span-30-188"><a id="__codelineno-30-188" name="__codelineno-30-188" href="#lab04-mcp-resources-__codelineno-30-188"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;api://&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-189"><a id="__codelineno-30-189" name="__codelineno-30-189" href="#lab04-mcp-resources-__codelineno-30-189"></a>
</span><span id="__span-30-190"><a id="__codelineno-30-190" name="__codelineno-30-190" href="#lab04-mcp-resources-__codelineno-30-190"></a><span class="w">    </span><span class="c1">// Handle special cases</span>
</span><span id="__span-30-191"><a id="__codelineno-30-191" name="__codelineno-30-191" href="#lab04-mcp-resources-__codelineno-30-191"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;status&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;/status&#39;</span><span class="p">;</span>
</span><span id="__span-30-192"><a id="__codelineno-30-192" name="__codelineno-30-192" href="#lab04-mcp-resources-__codelineno-30-192"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="s1">&#39;/info&#39;</span><span class="p">;</span>
</span><span id="__span-30-193"><a id="__codelineno-30-193" name="__codelineno-30-193" href="#lab04-mcp-resources-__codelineno-30-193"></a>
</span><span id="__span-30-194"><a id="__codelineno-30-194" name="__codelineno-30-194" href="#lab04-mcp-resources-__codelineno-30-194"></a><span class="w">    </span><span class="c1">// Handle template URIs</span>
</span><span id="__span-30-195"><a id="__codelineno-30-195" name="__codelineno-30-195" href="#lab04-mcp-resources-__codelineno-30-195"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;users/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-196"><a id="__codelineno-30-196" name="__codelineno-30-196" href="#lab04-mcp-resources-__codelineno-30-196"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">userId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;users/&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-197"><a id="__codelineno-30-197" name="__codelineno-30-197" href="#lab04-mcp-resources-__codelineno-30-197"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/users/</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-198"><a id="__codelineno-30-198" name="__codelineno-30-198" href="#lab04-mcp-resources-__codelineno-30-198"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-199"><a id="__codelineno-30-199" name="__codelineno-30-199" href="#lab04-mcp-resources-__codelineno-30-199"></a>
</span><span id="__span-30-200"><a id="__codelineno-30-200" name="__codelineno-30-200" href="#lab04-mcp-resources-__codelineno-30-200"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;posts/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-201"><a id="__codelineno-30-201" name="__codelineno-30-201" href="#lab04-mcp-resources-__codelineno-30-201"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">postId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;posts/&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-202"><a id="__codelineno-30-202" name="__codelineno-30-202" href="#lab04-mcp-resources-__codelineno-30-202"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/posts/</span><span class="si">${</span><span class="nx">postId</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-203"><a id="__codelineno-30-203" name="__codelineno-30-203" href="#lab04-mcp-resources-__codelineno-30-203"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-204"><a id="__codelineno-30-204" name="__codelineno-30-204" href="#lab04-mcp-resources-__codelineno-30-204"></a>
</span><span id="__span-30-205"><a id="__codelineno-30-205" name="__codelineno-30-205" href="#lab04-mcp-resources-__codelineno-30-205"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;search?&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-206"><a id="__codelineno-30-206" name="__codelineno-30-206" href="#lab04-mcp-resources-__codelineno-30-206"></a><span class="w">      </span><span class="c1">// Convert query parameters</span>
</span><span id="__span-30-207"><a id="__codelineno-30-207" name="__codelineno-30-207" href="#lab04-mcp-resources-__codelineno-30-207"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">queryString</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;search?&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-30-208"><a id="__codelineno-30-208" name="__codelineno-30-208" href="#lab04-mcp-resources-__codelineno-30-208"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="sb">`/search?</span><span class="si">${</span><span class="nx">queryString</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-209"><a id="__codelineno-30-209" name="__codelineno-30-209" href="#lab04-mcp-resources-__codelineno-30-209"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-210"><a id="__codelineno-30-210" name="__codelineno-30-210" href="#lab04-mcp-resources-__codelineno-30-210"></a>
</span><span id="__span-30-211"><a id="__codelineno-30-211" name="__codelineno-30-211" href="#lab04-mcp-resources-__codelineno-30-211"></a><span class="w">    </span><span class="c1">// Default: use path as-is</span>
</span><span id="__span-30-212"><a id="__codelineno-30-212" name="__codelineno-30-212" href="#lab04-mcp-resources-__codelineno-30-212"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`/</span><span class="si">${</span><span class="nx">path</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-30-213"><a id="__codelineno-30-213" name="__codelineno-30-213" href="#lab04-mcp-resources-__codelineno-30-213"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-214"><a id="__codelineno-30-214" name="__codelineno-30-214" href="#lab04-mcp-resources-__codelineno-30-214"></a>
</span><span id="__span-30-215"><a id="__codelineno-30-215" name="__codelineno-30-215" href="#lab04-mcp-resources-__codelineno-30-215"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">checkRateLimit</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-216"><a id="__codelineno-30-216" name="__codelineno-30-216" href="#lab04-mcp-resources-__codelineno-30-216"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-30-217"><a id="__codelineno-30-217" name="__codelineno-30-217" href="#lab04-mcp-resources-__codelineno-30-217"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">60000</span><span class="p">;</span><span class="w"> </span><span class="c1">// 1 minute</span>
</span><span id="__span-30-218"><a id="__codelineno-30-218" name="__codelineno-30-218" href="#lab04-mcp-resources-__codelineno-30-218"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;global&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">// In a real app, use user/session ID</span>
</span><span id="__span-30-219"><a id="__codelineno-30-219" name="__codelineno-30-219" href="#lab04-mcp-resources-__codelineno-30-219"></a>
</span><span id="__span-30-220"><a id="__codelineno-30-220" name="__codelineno-30-220" href="#lab04-mcp-resources-__codelineno-30-220"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">record</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">requestCounts</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-30-221"><a id="__codelineno-30-221" name="__codelineno-30-221" href="#lab04-mcp-resources-__codelineno-30-221"></a>
</span><span id="__span-30-222"><a id="__codelineno-30-222" name="__codelineno-30-222" href="#lab04-mcp-resources-__codelineno-30-222"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">record</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">record</span><span class="p">.</span><span class="nx">resetTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-223"><a id="__codelineno-30-223" name="__codelineno-30-223" href="#lab04-mcp-resources-__codelineno-30-223"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">requestCounts</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">1</span><span class="p">,</span><span class="w"> </span><span class="nx">resetTime</span><span class="o">:</span><span class="w"> </span><span class="kt">now</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">windowMs</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-30-224"><a id="__codelineno-30-224" name="__codelineno-30-224" href="#lab04-mcp-resources-__codelineno-30-224"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-30-225"><a id="__codelineno-30-225" name="__codelineno-30-225" href="#lab04-mcp-resources-__codelineno-30-225"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-226"><a id="__codelineno-30-226" name="__codelineno-30-226" href="#lab04-mcp-resources-__codelineno-30-226"></a>
</span><span id="__span-30-227"><a id="__codelineno-30-227" name="__codelineno-30-227" href="#lab04-mcp-resources-__codelineno-30-227"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-228"><a id="__codelineno-30-228" name="__codelineno-30-228" href="#lab04-mcp-resources-__codelineno-30-228"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">false</span><span class="p">;</span>
</span><span id="__span-30-229"><a id="__codelineno-30-229" name="__codelineno-30-229" href="#lab04-mcp-resources-__codelineno-30-229"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-230"><a id="__codelineno-30-230" name="__codelineno-30-230" href="#lab04-mcp-resources-__codelineno-30-230"></a>
</span><span id="__span-30-231"><a id="__codelineno-30-231" name="__codelineno-30-231" href="#lab04-mcp-resources-__codelineno-30-231"></a><span class="w">    </span><span class="nx">record</span><span class="p">.</span><span class="nx">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-30-232"><a id="__codelineno-30-232" name="__codelineno-30-232" href="#lab04-mcp-resources-__codelineno-30-232"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="kc">true</span><span class="p">;</span>
</span><span id="__span-30-233"><a id="__codelineno-30-233" name="__codelineno-30-233" href="#lab04-mcp-resources-__codelineno-30-233"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-234"><a id="__codelineno-30-234" name="__codelineno-30-234" href="#lab04-mcp-resources-__codelineno-30-234"></a>
</span><span id="__span-30-235"><a id="__codelineno-30-235" name="__codelineno-30-235" href="#lab04-mcp-resources-__codelineno-30-235"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getCached</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-236"><a id="__codelineno-30-236" name="__codelineno-30-236" href="#lab04-mcp-resources-__codelineno-30-236"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">cached</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-237"><a id="__codelineno-30-237" name="__codelineno-30-237" href="#lab04-mcp-resources-__codelineno-30-237"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">cached</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-30-238"><a id="__codelineno-30-238" name="__codelineno-30-238" href="#lab04-mcp-resources-__codelineno-30-238"></a>
</span><span id="__span-30-239"><a id="__codelineno-30-239" name="__codelineno-30-239" href="#lab04-mcp-resources-__codelineno-30-239"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">ttl</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-240"><a id="__codelineno-30-240" name="__codelineno-30-240" href="#lab04-mcp-resources-__codelineno-30-240"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-241"><a id="__codelineno-30-241" name="__codelineno-30-241" href="#lab04-mcp-resources-__codelineno-30-241"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-30-242"><a id="__codelineno-30-242" name="__codelineno-30-242" href="#lab04-mcp-resources-__codelineno-30-242"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-30-243"><a id="__codelineno-30-243" name="__codelineno-30-243" href="#lab04-mcp-resources-__codelineno-30-243"></a>
</span><span id="__span-30-244"><a id="__codelineno-30-244" name="__codelineno-30-244" href="#lab04-mcp-resources-__codelineno-30-244"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">cached</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>
</span><span id="__span-30-245"><a id="__codelineno-30-245" name="__codelineno-30-245" href="#lab04-mcp-resources-__codelineno-30-245"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-246"><a id="__codelineno-30-246" name="__codelineno-30-246" href="#lab04-mcp-resources-__codelineno-30-246"></a>
</span><span id="__span-30-247"><a id="__codelineno-30-247" name="__codelineno-30-247" href="#lab04-mcp-resources-__codelineno-30-247"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setCache</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-248"><a id="__codelineno-30-248" name="__codelineno-30-248" href="#lab04-mcp-resources-__codelineno-30-248"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-249"><a id="__codelineno-30-249" name="__codelineno-30-249" href="#lab04-mcp-resources-__codelineno-30-249"></a><span class="w">      </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">...</span><span class="nx">data</span><span class="p">,</span><span class="w"> </span><span class="nx">_cacheTimestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-30-250"><a id="__codelineno-30-250" name="__codelineno-30-250" href="#lab04-mcp-resources-__codelineno-30-250"></a><span class="w">      </span><span class="nx">timestamp</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">(),</span>
</span><span id="__span-30-251"><a id="__codelineno-30-251" name="__codelineno-30-251" href="#lab04-mcp-resources-__codelineno-30-251"></a><span class="w">      </span><span class="nx">ttl</span><span class="o">:</span><span class="w"> </span><span class="kt">this.cacheTTL</span><span class="p">,</span>
</span><span id="__span-30-252"><a id="__codelineno-30-252" name="__codelineno-30-252" href="#lab04-mcp-resources-__codelineno-30-252"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-253"><a id="__codelineno-30-253" name="__codelineno-30-253" href="#lab04-mcp-resources-__codelineno-30-253"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-254"><a id="__codelineno-30-254" name="__codelineno-30-254" href="#lab04-mcp-resources-__codelineno-30-254"></a>
</span><span id="__span-30-255"><a id="__codelineno-30-255" name="__codelineno-30-255" href="#lab04-mcp-resources-__codelineno-30-255"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">startCacheCleanup</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-256"><a id="__codelineno-30-256" name="__codelineno-30-256" href="#lab04-mcp-resources-__codelineno-30-256"></a><span class="w">    </span><span class="c1">// Clean up expired cache entries every 5 minutes</span>
</span><span id="__span-30-257"><a id="__codelineno-30-257" name="__codelineno-30-257" href="#lab04-mcp-resources-__codelineno-30-257"></a><span class="w">    </span><span class="nx">setInterval</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-258"><a id="__codelineno-30-258" name="__codelineno-30-258" href="#lab04-mcp-resources-__codelineno-30-258"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-30-259"><a id="__codelineno-30-259" name="__codelineno-30-259" href="#lab04-mcp-resources-__codelineno-30-259"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">uri</span><span class="p">,</span><span class="w"> </span><span class="nx">entry</span><span class="p">]</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-260"><a id="__codelineno-30-260" name="__codelineno-30-260" href="#lab04-mcp-resources-__codelineno-30-260"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">now</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">timestamp</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="nx">entry</span><span class="p">.</span><span class="nx">ttl</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-261"><a id="__codelineno-30-261" name="__codelineno-30-261" href="#lab04-mcp-resources-__codelineno-30-261"></a><span class="w">          </span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-30-262"><a id="__codelineno-30-262" name="__codelineno-30-262" href="#lab04-mcp-resources-__codelineno-30-262"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-30-263"><a id="__codelineno-30-263" name="__codelineno-30-263" href="#lab04-mcp-resources-__codelineno-30-263"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-30-264"><a id="__codelineno-30-264" name="__codelineno-30-264" href="#lab04-mcp-resources-__codelineno-30-264"></a><span class="w">    </span><span class="p">},</span><span class="w"> </span><span class="mf">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">60</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1000</span><span class="p">);</span>
</span><span id="__span-30-265"><a id="__codelineno-30-265" name="__codelineno-30-265" href="#lab04-mcp-resources-__codelineno-30-265"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-266"><a id="__codelineno-30-266" name="__codelineno-30-266" href="#lab04-mcp-resources-__codelineno-30-266"></a>
</span><span id="__span-30-267"><a id="__codelineno-30-267" name="__codelineno-30-267" href="#lab04-mcp-resources-__codelineno-30-267"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-268"><a id="__codelineno-30-268" name="__codelineno-30-268" href="#lab04-mcp-resources-__codelineno-30-268"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-269"><a id="__codelineno-30-269" name="__codelineno-30-269" href="#lab04-mcp-resources-__codelineno-30-269"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-30-270"><a id="__codelineno-30-270" name="__codelineno-30-270" href="#lab04-mcp-resources-__codelineno-30-270"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-30-271"><a id="__codelineno-30-271" name="__codelineno-30-271" href="#lab04-mcp-resources-__codelineno-30-271"></a>
</span><span id="__span-30-272"><a id="__codelineno-30-272" name="__codelineno-30-272" href="#lab04-mcp-resources-__codelineno-30-272"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-273"><a id="__codelineno-30-273" name="__codelineno-30-273" href="#lab04-mcp-resources-__codelineno-30-273"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-30-274"><a id="__codelineno-30-274" name="__codelineno-30-274" href="#lab04-mcp-resources-__codelineno-30-274"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-30-275"><a id="__codelineno-30-275" name="__codelineno-30-275" href="#lab04-mcp-resources-__codelineno-30-275"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-30-276"><a id="__codelineno-30-276" name="__codelineno-30-276" href="#lab04-mcp-resources-__codelineno-30-276"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-277"><a id="__codelineno-30-277" name="__codelineno-30-277" href="#lab04-mcp-resources-__codelineno-30-277"></a>
</span><span id="__span-30-278"><a id="__codelineno-30-278" name="__codelineno-30-278" href="#lab04-mcp-resources-__codelineno-30-278"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-279"><a id="__codelineno-30-279" name="__codelineno-30-279" href="#lab04-mcp-resources-__codelineno-30-279"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-30-280"><a id="__codelineno-30-280" name="__codelineno-30-280" href="#lab04-mcp-resources-__codelineno-30-280"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-30-281"><a id="__codelineno-30-281" name="__codelineno-30-281" href="#lab04-mcp-resources-__codelineno-30-281"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`API Resource Server running (API: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">baseUrl</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-30-282"><a id="__codelineno-30-282" name="__codelineno-30-282" href="#lab04-mcp-resources-__codelineno-30-282"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-30-283"><a id="__codelineno-30-283" name="__codelineno-30-283" href="#lab04-mcp-resources-__codelineno-30-283"></a><span class="p">}</span>
</span><span id="__span-30-284"><a id="__codelineno-30-284" name="__codelineno-30-284" href="#lab04-mcp-resources-__codelineno-30-284"></a>
</span><span id="__span-30-285"><a id="__codelineno-30-285" name="__codelineno-30-285" href="#lab04-mcp-resources-__codelineno-30-285"></a><span class="c1">// Main entry point</span>
</span><span id="__span-30-286"><a id="__codelineno-30-286" name="__codelineno-30-286" href="#lab04-mcp-resources-__codelineno-30-286"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-287"><a id="__codelineno-30-287" name="__codelineno-30-287" href="#lab04-mcp-resources-__codelineno-30-287"></a><span class="w">  </span><span class="c1">// Example: JSONPlaceholder API</span>
</span><span id="__span-30-288"><a id="__codelineno-30-288" name="__codelineno-30-288" href="#lab04-mcp-resources-__codelineno-30-288"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">APIResourceServer</span><span class="p">(</span><span class="s1">&#39;https://jsonplaceholder.typicode.com&#39;</span><span class="p">);</span>
</span><span id="__span-30-289"><a id="__codelineno-30-289" name="__codelineno-30-289" href="#lab04-mcp-resources-__codelineno-30-289"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-30-290"><a id="__codelineno-30-290" name="__codelineno-30-290" href="#lab04-mcp-resources-__codelineno-30-290"></a><span class="p">}</span>
</span><span id="__span-30-291"><a id="__codelineno-30-291" name="__codelineno-30-291" href="#lab04-mcp-resources-__codelineno-30-291"></a>
</span><span id="__span-30-292"><a id="__codelineno-30-292" name="__codelineno-30-292" href="#lab04-mcp-resources-__codelineno-30-292"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-30-293"><a id="__codelineno-30-293" name="__codelineno-30-293" href="#lab04-mcp-resources-__codelineno-30-293"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-30-294"><a id="__codelineno-30-294" name="__codelineno-30-294" href="#lab04-mcp-resources-__codelineno-30-294"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-30-295"><a id="__codelineno-30-295" name="__codelineno-30-295" href="#lab04-mcp-resources-__codelineno-30-295"></a><span class="p">});</span>
</span></code></pre></div>

Testing - Test the server with the JSONPlaceholder API:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab04-mcp-resources-__codelineno-31-1"></a><span class="c1"># Start the server</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#lab04-mcp-resources-__codelineno-31-2"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>

Test these resources in the MCP Inspector:

<div class="language-javascript highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab04-mcp-resources-__codelineno-32-1"></a><span class="c1">// API status</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#lab04-mcp-resources-__codelineno-32-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://status&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#lab04-mcp-resources-__codelineno-32-3"></a>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#lab04-mcp-resources-__codelineno-32-4"></a><span class="c1">// API info</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#lab04-mcp-resources-__codelineno-32-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://info&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#lab04-mcp-resources-__codelineno-32-6"></a>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#lab04-mcp-resources-__codelineno-32-7"></a><span class="c1">// User profiles (using templates)</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#lab04-mcp-resources-__codelineno-32-8"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://users/1&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#lab04-mcp-resources-__codelineno-32-9"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://users/2&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#lab04-mcp-resources-__codelineno-32-10"></a>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#lab04-mcp-resources-__codelineno-32-11"></a><span class="c1">// Posts</span>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#lab04-mcp-resources-__codelineno-32-12"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://posts/1&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#lab04-mcp-resources-__codelineno-32-13"></a>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#lab04-mcp-resources-__codelineno-32-14"></a><span class="c1">// Search (if supported by API)</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#lab04-mcp-resources-__codelineno-32-15"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;api://search?q=lorem&amp;type=post&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>

</details>

<h3 id="lab04-mcp-resources-exercise-3-database-resource-server">Exercise 3: Database Resource Server<a class="headerlink" href="#lab04-mcp-resources-exercise-3-database-resource-server" title="Permanent link">&para;</a></h3>
<p>Create a tool that:</p>
<ul>
<li>Exposes database tables as resources</li>
<li>Supports parameterized queries via URI templates</li>
<li>Implements read-only access for security</li>
<li>Provides metadata about table schemas</li>
</ul>
<details>
<summary>üí° Solution: Database Resource Server</summary>

Tool Schema - Add this to your tools array:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab04-mcp-resources-__codelineno-33-1"></a><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab04-mcp-resources-__codelineno-33-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;create_database_resource_server&quot;</span><span class="p">,</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#lab04-mcp-resources-__codelineno-33-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Create an MCP server that exposes database tables as resources&quot;</span><span class="p">,</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#lab04-mcp-resources-__codelineno-33-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#lab04-mcp-resources-__codelineno-33-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#lab04-mcp-resources-__codelineno-33-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#lab04-mcp-resources-__codelineno-33-7"></a><span class="w">      </span><span class="nx">databasePath</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#lab04-mcp-resources-__codelineno-33-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#lab04-mcp-resources-__codelineno-33-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Path to SQLite database file&quot;</span><span class="p">,</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#lab04-mcp-resources-__codelineno-33-10"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;./data.db&quot;</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#lab04-mcp-resources-__codelineno-33-11"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#lab04-mcp-resources-__codelineno-33-12"></a><span class="w">      </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#lab04-mcp-resources-__codelineno-33-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;array&quot;</span><span class="p">,</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#lab04-mcp-resources-__codelineno-33-14"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Tables to expose as resources&quot;</span><span class="p">,</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#lab04-mcp-resources-__codelineno-33-15"></a><span class="w">        </span><span class="nx">items</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#lab04-mcp-resources-__codelineno-33-16"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#lab04-mcp-resources-__codelineno-33-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#lab04-mcp-resources-__codelineno-33-18"></a><span class="w">      </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#lab04-mcp-resources-__codelineno-33-19"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#lab04-mcp-resources-__codelineno-33-20"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Enforce read-only access&quot;</span><span class="p">,</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#lab04-mcp-resources-__codelineno-33-21"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#lab04-mcp-resources-__codelineno-33-22"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#lab04-mcp-resources-__codelineno-33-23"></a><span class="w">      </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#lab04-mcp-resources-__codelineno-33-24"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#lab04-mcp-resources-__codelineno-33-25"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Maximum rows to return per query&quot;</span><span class="p">,</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#lab04-mcp-resources-__codelineno-33-26"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">1000</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#lab04-mcp-resources-__codelineno-33-27"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#lab04-mcp-resources-__codelineno-33-28"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-33-29"><a id="__codelineno-33-29" name="__codelineno-33-29" href="#lab04-mcp-resources-__codelineno-33-29"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;databasePath&quot;</span><span class="p">]</span>
</span><span id="__span-33-30"><a id="__codelineno-33-30" name="__codelineno-33-30" href="#lab04-mcp-resources-__codelineno-33-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-31"><a id="__codelineno-33-31" name="__codelineno-33-31" href="#lab04-mcp-resources-__codelineno-33-31"></a><span class="p">}</span>
</span></code></pre></div>

Implementation

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab04-mcp-resources-__codelineno-34-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#lab04-mcp-resources-__codelineno-34-2"></a>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#lab04-mcp-resources-__codelineno-34-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#lab04-mcp-resources-__codelineno-34-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#lab04-mcp-resources-__codelineno-34-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#lab04-mcp-resources-__codelineno-34-6"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-7"><a id="__codelineno-34-7" name="__codelineno-34-7" href="#lab04-mcp-resources-__codelineno-34-7"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-8"><a id="__codelineno-34-8" name="__codelineno-34-8" href="#lab04-mcp-resources-__codelineno-34-8"></a><span class="w">  </span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span>
</span><span id="__span-34-9"><a id="__codelineno-34-9" name="__codelineno-34-9" href="#lab04-mcp-resources-__codelineno-34-9"></a><span class="w">  </span><span class="nx">ResourceTemplate</span><span class="p">,</span>
</span><span id="__span-34-10"><a id="__codelineno-34-10" name="__codelineno-34-10" href="#lab04-mcp-resources-__codelineno-34-10"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-34-11"><a id="__codelineno-34-11" name="__codelineno-34-11" href="#lab04-mcp-resources-__codelineno-34-11"></a><span class="k">import</span><span class="w"> </span><span class="nx">Database</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;better-sqlite3&#39;</span><span class="p">;</span>
</span><span id="__span-34-12"><a id="__codelineno-34-12" name="__codelineno-34-12" href="#lab04-mcp-resources-__codelineno-34-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">fs</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;fs/promises&#39;</span><span class="p">;</span>
</span><span id="__span-34-13"><a id="__codelineno-34-13" name="__codelineno-34-13" href="#lab04-mcp-resources-__codelineno-34-13"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;path&#39;</span><span class="p">;</span>
</span><span id="__span-34-14"><a id="__codelineno-34-14" name="__codelineno-34-14" href="#lab04-mcp-resources-__codelineno-34-14"></a>
</span><span id="__span-34-15"><a id="__codelineno-34-15" name="__codelineno-34-15" href="#lab04-mcp-resources-__codelineno-34-15"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">TableInfo</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-16"><a id="__codelineno-34-16" name="__codelineno-34-16" href="#lab04-mcp-resources-__codelineno-34-16"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-17"><a id="__codelineno-34-17" name="__codelineno-34-17" href="#lab04-mcp-resources-__codelineno-34-17"></a><span class="w">  </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">Array</span><span class="o">&lt;</span><span class="p">{</span>
</span><span id="__span-34-18"><a id="__codelineno-34-18" name="__codelineno-34-18" href="#lab04-mcp-resources-__codelineno-34-18"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-19"><a id="__codelineno-34-19" name="__codelineno-34-19" href="#lab04-mcp-resources-__codelineno-34-19"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-20"><a id="__codelineno-34-20" name="__codelineno-34-20" href="#lab04-mcp-resources-__codelineno-34-20"></a><span class="w">    </span><span class="nx">notnull</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-21"><a id="__codelineno-34-21" name="__codelineno-34-21" href="#lab04-mcp-resources-__codelineno-34-21"></a><span class="w">    </span><span class="nx">pk</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-22"><a id="__codelineno-34-22" name="__codelineno-34-22" href="#lab04-mcp-resources-__codelineno-34-22"></a><span class="w">  </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-34-23"><a id="__codelineno-34-23" name="__codelineno-34-23" href="#lab04-mcp-resources-__codelineno-34-23"></a><span class="w">  </span><span class="nx">rowCount</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-24"><a id="__codelineno-34-24" name="__codelineno-34-24" href="#lab04-mcp-resources-__codelineno-34-24"></a><span class="p">}</span>
</span><span id="__span-34-25"><a id="__codelineno-34-25" name="__codelineno-34-25" href="#lab04-mcp-resources-__codelineno-34-25"></a>
</span><span id="__span-34-26"><a id="__codelineno-34-26" name="__codelineno-34-26" href="#lab04-mcp-resources-__codelineno-34-26"></a><span class="kd">class</span><span class="w"> </span><span class="nx">DatabaseResourceServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-27"><a id="__codelineno-34-27" name="__codelineno-34-27" href="#lab04-mcp-resources-__codelineno-34-27"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-34-28"><a id="__codelineno-34-28" name="__codelineno-34-28" href="#lab04-mcp-resources-__codelineno-34-28"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">dbPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-34-29"><a id="__codelineno-34-29" name="__codelineno-34-29" href="#lab04-mcp-resources-__codelineno-34-29"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[];</span>
</span><span id="__span-34-30"><a id="__codelineno-34-30" name="__codelineno-34-30" href="#lab04-mcp-resources-__codelineno-34-30"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span>
</span><span id="__span-34-31"><a id="__codelineno-34-31" name="__codelineno-34-31" href="#lab04-mcp-resources-__codelineno-34-31"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-34-32"><a id="__codelineno-34-32" name="__codelineno-34-32" href="#lab04-mcp-resources-__codelineno-34-32"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">db</span><span class="o">:</span><span class="w"> </span><span class="kt">Database.Database</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="kc">null</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">null</span><span class="p">;</span>
</span><span id="__span-34-33"><a id="__codelineno-34-33" name="__codelineno-34-33" href="#lab04-mcp-resources-__codelineno-34-33"></a>
</span><span id="__span-34-34"><a id="__codelineno-34-34" name="__codelineno-34-34" href="#lab04-mcp-resources-__codelineno-34-34"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">dbPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;./data.db&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[],</span><span class="w"> </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w"> </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1000</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-35"><a id="__codelineno-34-35" name="__codelineno-34-35" href="#lab04-mcp-resources-__codelineno-34-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">dbPath</span><span class="p">);</span>
</span><span id="__span-34-36"><a id="__codelineno-34-36" name="__codelineno-34-36" href="#lab04-mcp-resources-__codelineno-34-36"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">allowedTables</span><span class="p">;</span>
</span><span id="__span-34-37"><a id="__codelineno-34-37" name="__codelineno-34-37" href="#lab04-mcp-resources-__codelineno-34-37"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">readOnly</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readOnly</span><span class="p">;</span>
</span><span id="__span-34-38"><a id="__codelineno-34-38" name="__codelineno-34-38" href="#lab04-mcp-resources-__codelineno-34-38"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">maxRows</span><span class="p">;</span>
</span><span id="__span-34-39"><a id="__codelineno-34-39" name="__codelineno-34-39" href="#lab04-mcp-resources-__codelineno-34-39"></a>
</span><span id="__span-34-40"><a id="__codelineno-34-40" name="__codelineno-34-40" href="#lab04-mcp-resources-__codelineno-34-40"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-34-41"><a id="__codelineno-34-41" name="__codelineno-34-41" href="#lab04-mcp-resources-__codelineno-34-41"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-34-42"><a id="__codelineno-34-42" name="__codelineno-34-42" href="#lab04-mcp-resources-__codelineno-34-42"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;database-resource-server&quot;</span><span class="p">,</span>
</span><span id="__span-34-43"><a id="__codelineno-34-43" name="__codelineno-34-43" href="#lab04-mcp-resources-__codelineno-34-43"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-34-44"><a id="__codelineno-34-44" name="__codelineno-34-44" href="#lab04-mcp-resources-__codelineno-34-44"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-34-45"><a id="__codelineno-34-45" name="__codelineno-34-45" href="#lab04-mcp-resources-__codelineno-34-45"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-34-46"><a id="__codelineno-34-46" name="__codelineno-34-46" href="#lab04-mcp-resources-__codelineno-34-46"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-47"><a id="__codelineno-34-47" name="__codelineno-34-47" href="#lab04-mcp-resources-__codelineno-34-47"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-34-48"><a id="__codelineno-34-48" name="__codelineno-34-48" href="#lab04-mcp-resources-__codelineno-34-48"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-49"><a id="__codelineno-34-49" name="__codelineno-34-49" href="#lab04-mcp-resources-__codelineno-34-49"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-50"><a id="__codelineno-34-50" name="__codelineno-34-50" href="#lab04-mcp-resources-__codelineno-34-50"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-34-51"><a id="__codelineno-34-51" name="__codelineno-34-51" href="#lab04-mcp-resources-__codelineno-34-51"></a>
</span><span id="__span-34-52"><a id="__codelineno-34-52" name="__codelineno-34-52" href="#lab04-mcp-resources-__codelineno-34-52"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-34-53"><a id="__codelineno-34-53" name="__codelineno-34-53" href="#lab04-mcp-resources-__codelineno-34-53"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-34-54"><a id="__codelineno-34-54" name="__codelineno-34-54" href="#lab04-mcp-resources-__codelineno-34-54"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-55"><a id="__codelineno-34-55" name="__codelineno-34-55" href="#lab04-mcp-resources-__codelineno-34-55"></a>
</span><span id="__span-34-56"><a id="__codelineno-34-56" name="__codelineno-34-56" href="#lab04-mcp-resources-__codelineno-34-56"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-57"><a id="__codelineno-34-57" name="__codelineno-34-57" href="#lab04-mcp-resources-__codelineno-34-57"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourceTemplatesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-58"><a id="__codelineno-34-58" name="__codelineno-34-58" href="#lab04-mcp-resources-__codelineno-34-58"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">templates</span><span class="o">:</span><span class="w"> </span><span class="kt">ResourceTemplate</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-34-59"><a id="__codelineno-34-59" name="__codelineno-34-59" href="#lab04-mcp-resources-__codelineno-34-59"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-60"><a id="__codelineno-34-60" name="__codelineno-34-60" href="#lab04-mcp-resources-__codelineno-34-60"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/{tableName}/schema&quot;</span><span class="p">,</span>
</span><span id="__span-34-61"><a id="__codelineno-34-61" name="__codelineno-34-61" href="#lab04-mcp-resources-__codelineno-34-61"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Table Schema&quot;</span><span class="p">,</span>
</span><span id="__span-34-62"><a id="__codelineno-34-62" name="__codelineno-34-62" href="#lab04-mcp-resources-__codelineno-34-62"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Schema information for a database table&quot;</span><span class="p">,</span>
</span><span id="__span-34-63"><a id="__codelineno-34-63" name="__codelineno-34-63" href="#lab04-mcp-resources-__codelineno-34-63"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-64"><a id="__codelineno-34-64" name="__codelineno-34-64" href="#lab04-mcp-resources-__codelineno-34-64"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-65"><a id="__codelineno-34-65" name="__codelineno-34-65" href="#lab04-mcp-resources-__codelineno-34-65"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-66"><a id="__codelineno-34-66" name="__codelineno-34-66" href="#lab04-mcp-resources-__codelineno-34-66"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/{tableName}/data?limit={limit}&amp;offset={offset}&quot;</span><span class="p">,</span>
</span><span id="__span-34-67"><a id="__codelineno-34-67" name="__codelineno-34-67" href="#lab04-mcp-resources-__codelineno-34-67"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Table Data&quot;</span><span class="p">,</span>
</span><span id="__span-34-68"><a id="__codelineno-34-68" name="__codelineno-34-68" href="#lab04-mcp-resources-__codelineno-34-68"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Data from a database table with pagination&quot;</span><span class="p">,</span>
</span><span id="__span-34-69"><a id="__codelineno-34-69" name="__codelineno-34-69" href="#lab04-mcp-resources-__codelineno-34-69"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-70"><a id="__codelineno-34-70" name="__codelineno-34-70" href="#lab04-mcp-resources-__codelineno-34-70"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-71"><a id="__codelineno-34-71" name="__codelineno-34-71" href="#lab04-mcp-resources-__codelineno-34-71"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-72"><a id="__codelineno-34-72" name="__codelineno-34-72" href="#lab04-mcp-resources-__codelineno-34-72"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/{tableName}/records/{id}&quot;</span><span class="p">,</span>
</span><span id="__span-34-73"><a id="__codelineno-34-73" name="__codelineno-34-73" href="#lab04-mcp-resources-__codelineno-34-73"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Table Record&quot;</span><span class="p">,</span>
</span><span id="__span-34-74"><a id="__codelineno-34-74" name="__codelineno-34-74" href="#lab04-mcp-resources-__codelineno-34-74"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Specific record from a database table&quot;</span><span class="p">,</span>
</span><span id="__span-34-75"><a id="__codelineno-34-75" name="__codelineno-34-75" href="#lab04-mcp-resources-__codelineno-34-75"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-76"><a id="__codelineno-34-76" name="__codelineno-34-76" href="#lab04-mcp-resources-__codelineno-34-76"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-77"><a id="__codelineno-34-77" name="__codelineno-34-77" href="#lab04-mcp-resources-__codelineno-34-77"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-34-78"><a id="__codelineno-34-78" name="__codelineno-34-78" href="#lab04-mcp-resources-__codelineno-34-78"></a><span class="w">          </span><span class="nx">uriTemplate</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://query?sql={sql}&amp;params={params}&quot;</span><span class="p">,</span>
</span><span id="__span-34-79"><a id="__codelineno-34-79" name="__codelineno-34-79" href="#lab04-mcp-resources-__codelineno-34-79"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Custom Query&quot;</span><span class="p">,</span>
</span><span id="__span-34-80"><a id="__codelineno-34-80" name="__codelineno-34-80" href="#lab04-mcp-resources-__codelineno-34-80"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Execute a custom SELECT query&quot;</span><span class="p">,</span>
</span><span id="__span-34-81"><a id="__codelineno-34-81" name="__codelineno-34-81" href="#lab04-mcp-resources-__codelineno-34-81"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-82"><a id="__codelineno-34-82" name="__codelineno-34-82" href="#lab04-mcp-resources-__codelineno-34-82"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-83"><a id="__codelineno-34-83" name="__codelineno-34-83" href="#lab04-mcp-resources-__codelineno-34-83"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-34-84"><a id="__codelineno-34-84" name="__codelineno-34-84" href="#lab04-mcp-resources-__codelineno-34-84"></a>
</span><span id="__span-34-85"><a id="__codelineno-34-85" name="__codelineno-34-85" href="#lab04-mcp-resources-__codelineno-34-85"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resourceTemplates</span><span class="o">:</span><span class="w"> </span><span class="kt">templates</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-86"><a id="__codelineno-34-86" name="__codelineno-34-86" href="#lab04-mcp-resources-__codelineno-34-86"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-87"><a id="__codelineno-34-87" name="__codelineno-34-87" href="#lab04-mcp-resources-__codelineno-34-87"></a>
</span><span id="__span-34-88"><a id="__codelineno-34-88" name="__codelineno-34-88" href="#lab04-mcp-resources-__codelineno-34-88"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-89"><a id="__codelineno-34-89" name="__codelineno-34-89" href="#lab04-mcp-resources-__codelineno-34-89"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-90"><a id="__codelineno-34-90" name="__codelineno-34-90" href="#lab04-mcp-resources-__codelineno-34-90"></a>
</span><span id="__span-34-91"><a id="__codelineno-34-91" name="__codelineno-34-91" href="#lab04-mcp-resources-__codelineno-34-91"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-92"><a id="__codelineno-34-92" name="__codelineno-34-92" href="#lab04-mcp-resources-__codelineno-34-92"></a><span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ensureDatabase</span><span class="p">();</span>
</span><span id="__span-34-93"><a id="__codelineno-34-93" name="__codelineno-34-93" href="#lab04-mcp-resources-__codelineno-34-93"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-94"><a id="__codelineno-34-94" name="__codelineno-34-94" href="#lab04-mcp-resources-__codelineno-34-94"></a>
</span><span id="__span-34-95"><a id="__codelineno-34-95" name="__codelineno-34-95" href="#lab04-mcp-resources-__codelineno-34-95"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">tables</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-96"><a id="__codelineno-34-96" name="__codelineno-34-96" href="#lab04-mcp-resources-__codelineno-34-96"></a><span class="w">          </span><span class="c1">// Table schema resource</span>
</span><span id="__span-34-97"><a id="__codelineno-34-97" name="__codelineno-34-97" href="#lab04-mcp-resources-__codelineno-34-97"></a><span class="w">          </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-98"><a id="__codelineno-34-98" name="__codelineno-34-98" href="#lab04-mcp-resources-__codelineno-34-98"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/schema`</span><span class="p">,</span>
</span><span id="__span-34-99"><a id="__codelineno-34-99" name="__codelineno-34-99" href="#lab04-mcp-resources-__codelineno-34-99"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> Schema`</span><span class="p">,</span>
</span><span id="__span-34-100"><a id="__codelineno-34-100" name="__codelineno-34-100" href="#lab04-mcp-resources-__codelineno-34-100"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Schema for table </span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">columns</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb"> columns)`</span><span class="p">,</span>
</span><span id="__span-34-101"><a id="__codelineno-34-101" name="__codelineno-34-101" href="#lab04-mcp-resources-__codelineno-34-101"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-102"><a id="__codelineno-34-102" name="__codelineno-34-102" href="#lab04-mcp-resources-__codelineno-34-102"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-34-103"><a id="__codelineno-34-103" name="__codelineno-34-103" href="#lab04-mcp-resources-__codelineno-34-103"></a>
</span><span id="__span-34-104"><a id="__codelineno-34-104" name="__codelineno-34-104" href="#lab04-mcp-resources-__codelineno-34-104"></a><span class="w">          </span><span class="c1">// Table data resource</span>
</span><span id="__span-34-105"><a id="__codelineno-34-105" name="__codelineno-34-105" href="#lab04-mcp-resources-__codelineno-34-105"></a><span class="w">          </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-106"><a id="__codelineno-34-106" name="__codelineno-34-106" href="#lab04-mcp-resources-__codelineno-34-106"></a><span class="w">            </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/data?limit=100`</span><span class="p">,</span>
</span><span id="__span-34-107"><a id="__codelineno-34-107" name="__codelineno-34-107" href="#lab04-mcp-resources-__codelineno-34-107"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> Data`</span><span class="p">,</span>
</span><span id="__span-34-108"><a id="__codelineno-34-108" name="__codelineno-34-108" href="#lab04-mcp-resources-__codelineno-34-108"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Data from table </span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">rowCount</span><span class="si">}</span><span class="sb"> rows)`</span><span class="p">,</span>
</span><span id="__span-34-109"><a id="__codelineno-34-109" name="__codelineno-34-109" href="#lab04-mcp-resources-__codelineno-34-109"></a><span class="w">            </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-110"><a id="__codelineno-34-110" name="__codelineno-34-110" href="#lab04-mcp-resources-__codelineno-34-110"></a><span class="w">          </span><span class="p">});</span>
</span><span id="__span-34-111"><a id="__codelineno-34-111" name="__codelineno-34-111" href="#lab04-mcp-resources-__codelineno-34-111"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-34-112"><a id="__codelineno-34-112" name="__codelineno-34-112" href="#lab04-mcp-resources-__codelineno-34-112"></a>
</span><span id="__span-34-113"><a id="__codelineno-34-113" name="__codelineno-34-113" href="#lab04-mcp-resources-__codelineno-34-113"></a><span class="w">        </span><span class="c1">// Database info resource</span>
</span><span id="__span-34-114"><a id="__codelineno-34-114" name="__codelineno-34-114" href="#lab04-mcp-resources-__codelineno-34-114"></a><span class="w">        </span><span class="nx">resources</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-115"><a id="__codelineno-34-115" name="__codelineno-34-115" href="#lab04-mcp-resources-__codelineno-34-115"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://info&quot;</span><span class="p">,</span>
</span><span id="__span-34-116"><a id="__codelineno-34-116" name="__codelineno-34-116" href="#lab04-mcp-resources-__codelineno-34-116"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Database Info&quot;</span><span class="p">,</span>
</span><span id="__span-34-117"><a id="__codelineno-34-117" name="__codelineno-34-117" href="#lab04-mcp-resources-__codelineno-34-117"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Database metadata and statistics&quot;</span><span class="p">,</span>
</span><span id="__span-34-118"><a id="__codelineno-34-118" name="__codelineno-34-118" href="#lab04-mcp-resources-__codelineno-34-118"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-119"><a id="__codelineno-34-119" name="__codelineno-34-119" href="#lab04-mcp-resources-__codelineno-34-119"></a><span class="w">        </span><span class="p">});</span>
</span><span id="__span-34-120"><a id="__codelineno-34-120" name="__codelineno-34-120" href="#lab04-mcp-resources-__codelineno-34-120"></a>
</span><span id="__span-34-121"><a id="__codelineno-34-121" name="__codelineno-34-121" href="#lab04-mcp-resources-__codelineno-34-121"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-122"><a id="__codelineno-34-122" name="__codelineno-34-122" href="#lab04-mcp-resources-__codelineno-34-122"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Error listing resources:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-123"><a id="__codelineno-34-123" name="__codelineno-34-123" href="#lab04-mcp-resources-__codelineno-34-123"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-124"><a id="__codelineno-34-124" name="__codelineno-34-124" href="#lab04-mcp-resources-__codelineno-34-124"></a>
</span><span id="__span-34-125"><a id="__codelineno-34-125" name="__codelineno-34-125" href="#lab04-mcp-resources-__codelineno-34-125"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-126"><a id="__codelineno-34-126" name="__codelineno-34-126" href="#lab04-mcp-resources-__codelineno-34-126"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-127"><a id="__codelineno-34-127" name="__codelineno-34-127" href="#lab04-mcp-resources-__codelineno-34-127"></a>
</span><span id="__span-34-128"><a id="__codelineno-34-128" name="__codelineno-34-128" href="#lab04-mcp-resources-__codelineno-34-128"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-129"><a id="__codelineno-34-129" name="__codelineno-34-129" href="#lab04-mcp-resources-__codelineno-34-129"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-34-130"><a id="__codelineno-34-130" name="__codelineno-34-130" href="#lab04-mcp-resources-__codelineno-34-130"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readDatabaseResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-34-131"><a id="__codelineno-34-131" name="__codelineno-34-131" href="#lab04-mcp-resources-__codelineno-34-131"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-34-132"><a id="__codelineno-34-132" name="__codelineno-34-132" href="#lab04-mcp-resources-__codelineno-34-132"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-133"><a id="__codelineno-34-133" name="__codelineno-34-133" href="#lab04-mcp-resources-__codelineno-34-133"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-134"><a id="__codelineno-34-134" name="__codelineno-34-134" href="#lab04-mcp-resources-__codelineno-34-134"></a>
</span><span id="__span-34-135"><a id="__codelineno-34-135" name="__codelineno-34-135" href="#lab04-mcp-resources-__codelineno-34-135"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">ensureDatabase</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-136"><a id="__codelineno-34-136" name="__codelineno-34-136" href="#lab04-mcp-resources-__codelineno-34-136"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="p">;</span>
</span><span id="__span-34-137"><a id="__codelineno-34-137" name="__codelineno-34-137" href="#lab04-mcp-resources-__codelineno-34-137"></a>
</span><span id="__span-34-138"><a id="__codelineno-34-138" name="__codelineno-34-138" href="#lab04-mcp-resources-__codelineno-34-138"></a><span class="w">    </span><span class="c1">// Check if database file exists</span>
</span><span id="__span-34-139"><a id="__codelineno-34-139" name="__codelineno-34-139" href="#lab04-mcp-resources-__codelineno-34-139"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-140"><a id="__codelineno-34-140" name="__codelineno-34-140" href="#lab04-mcp-resources-__codelineno-34-140"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">access</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="nx">fs</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">R_OK</span><span class="p">);</span>
</span><span id="__span-34-141"><a id="__codelineno-34-141" name="__codelineno-34-141" href="#lab04-mcp-resources-__codelineno-34-141"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-142"><a id="__codelineno-34-142" name="__codelineno-34-142" href="#lab04-mcp-resources-__codelineno-34-142"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Database file not found: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-143"><a id="__codelineno-34-143" name="__codelineno-34-143" href="#lab04-mcp-resources-__codelineno-34-143"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-144"><a id="__codelineno-34-144" name="__codelineno-34-144" href="#lab04-mcp-resources-__codelineno-34-144"></a>
</span><span id="__span-34-145"><a id="__codelineno-34-145" name="__codelineno-34-145" href="#lab04-mcp-resources-__codelineno-34-145"></a><span class="w">    </span><span class="c1">// Open database in read-only mode if specified</span>
</span><span id="__span-34-146"><a id="__codelineno-34-146" name="__codelineno-34-146" href="#lab04-mcp-resources-__codelineno-34-146"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Database</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">readonly</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readOnly</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-34-147"><a id="__codelineno-34-147" name="__codelineno-34-147" href="#lab04-mcp-resources-__codelineno-34-147"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-148"><a id="__codelineno-34-148" name="__codelineno-34-148" href="#lab04-mcp-resources-__codelineno-34-148"></a>
</span><span id="__span-34-149"><a id="__codelineno-34-149" name="__codelineno-34-149" href="#lab04-mcp-resources-__codelineno-34-149"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableInfo</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">TableInfo</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-150"><a id="__codelineno-34-150" name="__codelineno-34-150" href="#lab04-mcp-resources-__codelineno-34-150"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-151"><a id="__codelineno-34-151" name="__codelineno-34-151" href="#lab04-mcp-resources-__codelineno-34-151"></a>
</span><span id="__span-34-152"><a id="__codelineno-34-152" name="__codelineno-34-152" href="#lab04-mcp-resources-__codelineno-34-152"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="o">:</span><span class="w"> </span><span class="kt">TableInfo</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-153"><a id="__codelineno-34-153" name="__codelineno-34-153" href="#lab04-mcp-resources-__codelineno-34-153"></a>
</span><span id="__span-34-154"><a id="__codelineno-34-154" name="__codelineno-34-154" href="#lab04-mcp-resources-__codelineno-34-154"></a><span class="w">    </span><span class="c1">// Get all tables</span>
</span><span id="__span-34-155"><a id="__codelineno-34-155" name="__codelineno-34-155" href="#lab04-mcp-resources-__codelineno-34-155"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tableNames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-156"><a id="__codelineno-34-156" name="__codelineno-34-156" href="#lab04-mcp-resources-__codelineno-34-156"></a><span class="sb">      SELECT name FROM sqlite_master </span>
</span><span id="__span-34-157"><a id="__codelineno-34-157" name="__codelineno-34-157" href="#lab04-mcp-resources-__codelineno-34-157"></a><span class="sb">      WHERE type=&#39;table&#39; AND name NOT LIKE &#39;sqlite_%&#39;</span>
</span><span id="__span-34-158"><a id="__codelineno-34-158" name="__codelineno-34-158" href="#lab04-mcp-resources-__codelineno-34-158"></a><span class="sb">    `</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nb">Array</span><span class="o">&lt;</span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="o">&gt;</span><span class="p">;</span>
</span><span id="__span-34-159"><a id="__codelineno-34-159" name="__codelineno-34-159" href="#lab04-mcp-resources-__codelineno-34-159"></a>
</span><span id="__span-34-160"><a id="__codelineno-34-160" name="__codelineno-34-160" href="#lab04-mcp-resources-__codelineno-34-160"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">tableNames</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-161"><a id="__codelineno-34-161" name="__codelineno-34-161" href="#lab04-mcp-resources-__codelineno-34-161"></a><span class="w">      </span><span class="c1">// Check if table is allowed</span>
</span><span id="__span-34-162"><a id="__codelineno-34-162" name="__codelineno-34-162" href="#lab04-mcp-resources-__codelineno-34-162"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-163"><a id="__codelineno-34-163" name="__codelineno-34-163" href="#lab04-mcp-resources-__codelineno-34-163"></a><span class="w">        </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-34-164"><a id="__codelineno-34-164" name="__codelineno-34-164" href="#lab04-mcp-resources-__codelineno-34-164"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-165"><a id="__codelineno-34-165" name="__codelineno-34-165" href="#lab04-mcp-resources-__codelineno-34-165"></a>
</span><span id="__span-34-166"><a id="__codelineno-34-166" name="__codelineno-34-166" href="#lab04-mcp-resources-__codelineno-34-166"></a><span class="w">      </span><span class="c1">// Get column info</span>
</span><span id="__span-34-167"><a id="__codelineno-34-167" name="__codelineno-34-167" href="#lab04-mcp-resources-__codelineno-34-167"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`PRAGMA table_info(</span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">)`</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-168"><a id="__codelineno-34-168" name="__codelineno-34-168" href="#lab04-mcp-resources-__codelineno-34-168"></a>
</span><span id="__span-34-169"><a id="__codelineno-34-169" name="__codelineno-34-169" href="#lab04-mcp-resources-__codelineno-34-169"></a><span class="w">      </span><span class="c1">// Get row count</span>
</span><span id="__span-34-170"><a id="__codelineno-34-170" name="__codelineno-34-170" href="#lab04-mcp-resources-__codelineno-34-170"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">rowCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`SELECT COUNT(*) as count FROM </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">).</span><span class="nx">count</span><span class="p">;</span>
</span><span id="__span-34-171"><a id="__codelineno-34-171" name="__codelineno-34-171" href="#lab04-mcp-resources-__codelineno-34-171"></a>
</span><span id="__span-34-172"><a id="__codelineno-34-172" name="__codelineno-34-172" href="#lab04-mcp-resources-__codelineno-34-172"></a><span class="w">      </span><span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-34-173"><a id="__codelineno-34-173" name="__codelineno-34-173" href="#lab04-mcp-resources-__codelineno-34-173"></a><span class="w">        </span><span class="nx">name</span><span class="p">,</span>
</span><span id="__span-34-174"><a id="__codelineno-34-174" name="__codelineno-34-174" href="#lab04-mcp-resources-__codelineno-34-174"></a><span class="w">        </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">columns.map</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-34-175"><a id="__codelineno-34-175" name="__codelineno-34-175" href="#lab04-mcp-resources-__codelineno-34-175"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">col.name</span><span class="p">,</span>
</span><span id="__span-34-176"><a id="__codelineno-34-176" name="__codelineno-34-176" href="#lab04-mcp-resources-__codelineno-34-176"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-34-177"><a id="__codelineno-34-177" name="__codelineno-34-177" href="#lab04-mcp-resources-__codelineno-34-177"></a><span class="w">          </span><span class="nx">notnull</span><span class="o">:</span><span class="w"> </span><span class="kt">col.notnull</span><span class="p">,</span>
</span><span id="__span-34-178"><a id="__codelineno-34-178" name="__codelineno-34-178" href="#lab04-mcp-resources-__codelineno-34-178"></a><span class="w">          </span><span class="nx">pk</span><span class="o">:</span><span class="w"> </span><span class="kt">col.pk</span><span class="p">,</span>
</span><span id="__span-34-179"><a id="__codelineno-34-179" name="__codelineno-34-179" href="#lab04-mcp-resources-__codelineno-34-179"></a><span class="w">        </span><span class="p">})),</span>
</span><span id="__span-34-180"><a id="__codelineno-34-180" name="__codelineno-34-180" href="#lab04-mcp-resources-__codelineno-34-180"></a><span class="w">        </span><span class="nx">rowCount</span><span class="p">,</span>
</span><span id="__span-34-181"><a id="__codelineno-34-181" name="__codelineno-34-181" href="#lab04-mcp-resources-__codelineno-34-181"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-34-182"><a id="__codelineno-34-182" name="__codelineno-34-182" href="#lab04-mcp-resources-__codelineno-34-182"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-183"><a id="__codelineno-34-183" name="__codelineno-34-183" href="#lab04-mcp-resources-__codelineno-34-183"></a>
</span><span id="__span-34-184"><a id="__codelineno-34-184" name="__codelineno-34-184" href="#lab04-mcp-resources-__codelineno-34-184"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">tables</span><span class="p">;</span>
</span><span id="__span-34-185"><a id="__codelineno-34-185" name="__codelineno-34-185" href="#lab04-mcp-resources-__codelineno-34-185"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-186"><a id="__codelineno-34-186" name="__codelineno-34-186" href="#lab04-mcp-resources-__codelineno-34-186"></a>
</span><span id="__span-34-187"><a id="__codelineno-34-187" name="__codelineno-34-187" href="#lab04-mcp-resources-__codelineno-34-187"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readDatabaseResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-188"><a id="__codelineno-34-188" name="__codelineno-34-188" href="#lab04-mcp-resources-__codelineno-34-188"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">ensureDatabase</span><span class="p">();</span>
</span><span id="__span-34-189"><a id="__codelineno-34-189" name="__codelineno-34-189" href="#lab04-mcp-resources-__codelineno-34-189"></a>
</span><span id="__span-34-190"><a id="__codelineno-34-190" name="__codelineno-34-190" href="#lab04-mcp-resources-__codelineno-34-190"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;db://&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-191"><a id="__codelineno-34-191" name="__codelineno-34-191" href="#lab04-mcp-resources-__codelineno-34-191"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid database URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-192"><a id="__codelineno-34-192" name="__codelineno-34-192" href="#lab04-mcp-resources-__codelineno-34-192"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-193"><a id="__codelineno-34-193" name="__codelineno-34-193" href="#lab04-mcp-resources-__codelineno-34-193"></a>
</span><span id="__span-34-194"><a id="__codelineno-34-194" name="__codelineno-34-194" href="#lab04-mcp-resources-__codelineno-34-194"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;db://&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</span><span id="__span-34-195"><a id="__codelineno-34-195" name="__codelineno-34-195" href="#lab04-mcp-resources-__codelineno-34-195"></a>
</span><span id="__span-34-196"><a id="__codelineno-34-196" name="__codelineno-34-196" href="#lab04-mcp-resources-__codelineno-34-196"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;info&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-197"><a id="__codelineno-34-197" name="__codelineno-34-197" href="#lab04-mcp-resources-__codelineno-34-197"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getDatabaseInfo</span><span class="p">();</span>
</span><span id="__span-34-198"><a id="__codelineno-34-198" name="__codelineno-34-198" href="#lab04-mcp-resources-__codelineno-34-198"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-199"><a id="__codelineno-34-199" name="__codelineno-34-199" href="#lab04-mcp-resources-__codelineno-34-199"></a>
</span><span id="__span-34-200"><a id="__codelineno-34-200" name="__codelineno-34-200" href="#lab04-mcp-resources-__codelineno-34-200"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;tables/&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-201"><a id="__codelineno-34-201" name="__codelineno-34-201" href="#lab04-mcp-resources-__codelineno-34-201"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readTableResource</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;tables/&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
</span><span id="__span-34-202"><a id="__codelineno-34-202" name="__codelineno-34-202" href="#lab04-mcp-resources-__codelineno-34-202"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-203"><a id="__codelineno-34-203" name="__codelineno-34-203" href="#lab04-mcp-resources-__codelineno-34-203"></a>
</span><span id="__span-34-204"><a id="__codelineno-34-204" name="__codelineno-34-204" href="#lab04-mcp-resources-__codelineno-34-204"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;query?&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-205"><a id="__codelineno-34-205" name="__codelineno-34-205" href="#lab04-mcp-resources-__codelineno-34-205"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">executeCustomQuery</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="s1">&#39;query?&#39;</span><span class="p">.</span><span class="nx">length</span><span class="p">));</span>
</span><span id="__span-34-206"><a id="__codelineno-34-206" name="__codelineno-34-206" href="#lab04-mcp-resources-__codelineno-34-206"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-207"><a id="__codelineno-34-207" name="__codelineno-34-207" href="#lab04-mcp-resources-__codelineno-34-207"></a>
</span><span id="__span-34-208"><a id="__codelineno-34-208" name="__codelineno-34-208" href="#lab04-mcp-resources-__codelineno-34-208"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown database resource: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-209"><a id="__codelineno-34-209" name="__codelineno-34-209" href="#lab04-mcp-resources-__codelineno-34-209"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-210"><a id="__codelineno-34-210" name="__codelineno-34-210" href="#lab04-mcp-resources-__codelineno-34-210"></a>
</span><span id="__span-34-211"><a id="__codelineno-34-211" name="__codelineno-34-211" href="#lab04-mcp-resources-__codelineno-34-211"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getDatabaseInfo</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-212"><a id="__codelineno-34-212" name="__codelineno-34-212" href="#lab04-mcp-resources-__codelineno-34-212"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-213"><a id="__codelineno-34-213" name="__codelineno-34-213" href="#lab04-mcp-resources-__codelineno-34-213"></a>
</span><span id="__span-34-214"><a id="__codelineno-34-214" name="__codelineno-34-214" href="#lab04-mcp-resources-__codelineno-34-214"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-215"><a id="__codelineno-34-215" name="__codelineno-34-215" href="#lab04-mcp-resources-__codelineno-34-215"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">dbStats</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-216"><a id="__codelineno-34-216" name="__codelineno-34-216" href="#lab04-mcp-resources-__codelineno-34-216"></a><span class="sb">      SELECT </span>
</span><span id="__span-34-217"><a id="__codelineno-34-217" name="__codelineno-34-217" href="#lab04-mcp-resources-__codelineno-34-217"></a><span class="sb">        COUNT(*) as tableCount,</span>
</span><span id="__span-34-218"><a id="__codelineno-34-218" name="__codelineno-34-218" href="#lab04-mcp-resources-__codelineno-34-218"></a><span class="sb">        SUM(</span>
</span><span id="__span-34-219"><a id="__codelineno-34-219" name="__codelineno-34-219" href="#lab04-mcp-resources-__codelineno-34-219"></a><span class="sb">          (SELECT COUNT(*) FROM sqlite_master WHERE type=&#39;index&#39;) +</span>
</span><span id="__span-34-220"><a id="__codelineno-34-220" name="__codelineno-34-220" href="#lab04-mcp-resources-__codelineno-34-220"></a><span class="sb">          (SELECT COUNT(*) FROM pragma_table_info(name))</span>
</span><span id="__span-34-221"><a id="__codelineno-34-221" name="__codelineno-34-221" href="#lab04-mcp-resources-__codelineno-34-221"></a><span class="sb">        ) as totalColumns</span>
</span><span id="__span-34-222"><a id="__codelineno-34-222" name="__codelineno-34-222" href="#lab04-mcp-resources-__codelineno-34-222"></a><span class="sb">      FROM sqlite_master </span>
</span><span id="__span-34-223"><a id="__codelineno-34-223" name="__codelineno-34-223" href="#lab04-mcp-resources-__codelineno-34-223"></a><span class="sb">      WHERE type=&#39;table&#39; AND name NOT LIKE &#39;sqlite_%&#39;</span>
</span><span id="__span-34-224"><a id="__codelineno-34-224" name="__codelineno-34-224" href="#lab04-mcp-resources-__codelineno-34-224"></a><span class="sb">    `</span><span class="p">).</span><span class="nx">get</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">;</span>
</span><span id="__span-34-225"><a id="__codelineno-34-225" name="__codelineno-34-225" href="#lab04-mcp-resources-__codelineno-34-225"></a>
</span><span id="__span-34-226"><a id="__codelineno-34-226" name="__codelineno-34-226" href="#lab04-mcp-resources-__codelineno-34-226"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-227"><a id="__codelineno-34-227" name="__codelineno-34-227" href="#lab04-mcp-resources-__codelineno-34-227"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://info&quot;</span><span class="p">,</span>
</span><span id="__span-34-228"><a id="__codelineno-34-228" name="__codelineno-34-228" href="#lab04-mcp-resources-__codelineno-34-228"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-229"><a id="__codelineno-34-229" name="__codelineno-34-229" href="#lab04-mcp-resources-__codelineno-34-229"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-230"><a id="__codelineno-34-230" name="__codelineno-34-230" href="#lab04-mcp-resources-__codelineno-34-230"></a><span class="w">        </span><span class="nx">database</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-231"><a id="__codelineno-34-231" name="__codelineno-34-231" href="#lab04-mcp-resources-__codelineno-34-231"></a><span class="w">          </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="kt">this.dbPath</span><span class="p">,</span>
</span><span id="__span-34-232"><a id="__codelineno-34-232" name="__codelineno-34-232" href="#lab04-mcp-resources-__codelineno-34-232"></a><span class="w">          </span><span class="nx">readOnly</span><span class="o">:</span><span class="w"> </span><span class="kt">this.readOnly</span><span class="p">,</span>
</span><span id="__span-34-233"><a id="__codelineno-34-233" name="__codelineno-34-233" href="#lab04-mcp-resources-__codelineno-34-233"></a><span class="w">          </span><span class="nx">tableCount</span><span class="o">:</span><span class="w"> </span><span class="kt">dbStats.tableCount</span><span class="p">,</span>
</span><span id="__span-34-234"><a id="__codelineno-34-234" name="__codelineno-34-234" href="#lab04-mcp-resources-__codelineno-34-234"></a><span class="w">          </span><span class="nx">totalColumns</span><span class="o">:</span><span class="w"> </span><span class="kt">dbStats.totalColumns</span><span class="p">,</span>
</span><span id="__span-34-235"><a id="__codelineno-34-235" name="__codelineno-34-235" href="#lab04-mcp-resources-__codelineno-34-235"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-236"><a id="__codelineno-34-236" name="__codelineno-34-236" href="#lab04-mcp-resources-__codelineno-34-236"></a><span class="w">        </span><span class="nx">tables</span><span class="o">:</span><span class="w"> </span><span class="kt">tables.map</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-34-237"><a id="__codelineno-34-237" name="__codelineno-34-237" href="#lab04-mcp-resources-__codelineno-34-237"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">t.name</span><span class="p">,</span>
</span><span id="__span-34-238"><a id="__codelineno-34-238" name="__codelineno-34-238" href="#lab04-mcp-resources-__codelineno-34-238"></a><span class="w">          </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">t.columns.length</span><span class="p">,</span>
</span><span id="__span-34-239"><a id="__codelineno-34-239" name="__codelineno-34-239" href="#lab04-mcp-resources-__codelineno-34-239"></a><span class="w">          </span><span class="nx">rows</span><span class="o">:</span><span class="w"> </span><span class="kt">t.rowCount</span><span class="p">,</span>
</span><span id="__span-34-240"><a id="__codelineno-34-240" name="__codelineno-34-240" href="#lab04-mcp-resources-__codelineno-34-240"></a><span class="w">          </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="kt">t.columns.find</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">pk</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
</span><span id="__span-34-241"><a id="__codelineno-34-241" name="__codelineno-34-241" href="#lab04-mcp-resources-__codelineno-34-241"></a><span class="w">        </span><span class="p">})),</span>
</span><span id="__span-34-242"><a id="__codelineno-34-242" name="__codelineno-34-242" href="#lab04-mcp-resources-__codelineno-34-242"></a><span class="w">        </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-243"><a id="__codelineno-34-243" name="__codelineno-34-243" href="#lab04-mcp-resources-__codelineno-34-243"></a><span class="w">          </span><span class="nx">maxRows</span><span class="o">:</span><span class="w"> </span><span class="kt">this.maxRows</span><span class="p">,</span>
</span><span id="__span-34-244"><a id="__codelineno-34-244" name="__codelineno-34-244" href="#lab04-mcp-resources-__codelineno-34-244"></a><span class="w">          </span><span class="nx">allowedTables</span><span class="o">:</span><span class="w"> </span><span class="kt">this.allowedTables.length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span><span id="__span-34-245"><a id="__codelineno-34-245" name="__codelineno-34-245" href="#lab04-mcp-resources-__codelineno-34-245"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-246"><a id="__codelineno-34-246" name="__codelineno-34-246" href="#lab04-mcp-resources-__codelineno-34-246"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-247"><a id="__codelineno-34-247" name="__codelineno-34-247" href="#lab04-mcp-resources-__codelineno-34-247"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-248"><a id="__codelineno-34-248" name="__codelineno-34-248" href="#lab04-mcp-resources-__codelineno-34-248"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-249"><a id="__codelineno-34-249" name="__codelineno-34-249" href="#lab04-mcp-resources-__codelineno-34-249"></a>
</span><span id="__span-34-250"><a id="__codelineno-34-250" name="__codelineno-34-250" href="#lab04-mcp-resources-__codelineno-34-250"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readTableResource</span><span class="p">(</span><span class="nx">tablePath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-251"><a id="__codelineno-34-251" name="__codelineno-34-251" href="#lab04-mcp-resources-__codelineno-34-251"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-252"><a id="__codelineno-34-252" name="__codelineno-34-252" href="#lab04-mcp-resources-__codelineno-34-252"></a>
</span><span id="__span-34-253"><a id="__codelineno-34-253" name="__codelineno-34-253" href="#lab04-mcp-resources-__codelineno-34-253"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">parts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tablePath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
</span><span id="__span-34-254"><a id="__codelineno-34-254" name="__codelineno-34-254" href="#lab04-mcp-resources-__codelineno-34-254"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">0</span><span class="p">];</span>
</span><span id="__span-34-255"><a id="__codelineno-34-255" name="__codelineno-34-255" href="#lab04-mcp-resources-__codelineno-34-255"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">action</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-34-256"><a id="__codelineno-34-256" name="__codelineno-34-256" href="#lab04-mcp-resources-__codelineno-34-256"></a>
</span><span id="__span-34-257"><a id="__codelineno-34-257" name="__codelineno-34-257" href="#lab04-mcp-resources-__codelineno-34-257"></a><span class="w">    </span><span class="c1">// Validate table access</span>
</span><span id="__span-34-258"><a id="__codelineno-34-258" name="__codelineno-34-258" href="#lab04-mcp-resources-__codelineno-34-258"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">length</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">allowedTables</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">tableName</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-259"><a id="__codelineno-34-259" name="__codelineno-34-259" href="#lab04-mcp-resources-__codelineno-34-259"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Access denied to table: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-260"><a id="__codelineno-34-260" name="__codelineno-34-260" href="#lab04-mcp-resources-__codelineno-34-260"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-261"><a id="__codelineno-34-261" name="__codelineno-34-261" href="#lab04-mcp-resources-__codelineno-34-261"></a>
</span><span id="__span-34-262"><a id="__codelineno-34-262" name="__codelineno-34-262" href="#lab04-mcp-resources-__codelineno-34-262"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-263"><a id="__codelineno-34-263" name="__codelineno-34-263" href="#lab04-mcp-resources-__codelineno-34-263"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;schema&#39;</span><span class="o">:</span>
</span><span id="__span-34-264"><a id="__codelineno-34-264" name="__codelineno-34-264" href="#lab04-mcp-resources-__codelineno-34-264"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableSchema</span><span class="p">(</span><span class="nx">tableName</span><span class="p">);</span>
</span><span id="__span-34-265"><a id="__codelineno-34-265" name="__codelineno-34-265" href="#lab04-mcp-resources-__codelineno-34-265"></a>
</span><span id="__span-34-266"><a id="__codelineno-34-266" name="__codelineno-34-266" href="#lab04-mcp-resources-__codelineno-34-266"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;data&#39;</span><span class="o">:</span>
</span><span id="__span-34-267"><a id="__codelineno-34-267" name="__codelineno-34-267" href="#lab04-mcp-resources-__codelineno-34-267"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tablePath</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-268"><a id="__codelineno-34-268" name="__codelineno-34-268" href="#lab04-mcp-resources-__codelineno-34-268"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">limit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;limit&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;100&#39;</span><span class="p">);</span>
</span><span id="__span-34-269"><a id="__codelineno-34-269" name="__codelineno-34-269" href="#lab04-mcp-resources-__codelineno-34-269"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">);</span>
</span><span id="__span-34-270"><a id="__codelineno-34-270" name="__codelineno-34-270" href="#lab04-mcp-resources-__codelineno-34-270"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableData</span><span class="p">(</span><span class="nx">tableName</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">);</span>
</span><span id="__span-34-271"><a id="__codelineno-34-271" name="__codelineno-34-271" href="#lab04-mcp-resources-__codelineno-34-271"></a>
</span><span id="__span-34-272"><a id="__codelineno-34-272" name="__codelineno-34-272" href="#lab04-mcp-resources-__codelineno-34-272"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;records&#39;</span><span class="o">:</span>
</span><span id="__span-34-273"><a id="__codelineno-34-273" name="__codelineno-34-273" href="#lab04-mcp-resources-__codelineno-34-273"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">recordId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">parts</span><span class="p">[</span><span class="mf">2</span><span class="p">];</span>
</span><span id="__span-34-274"><a id="__codelineno-34-274" name="__codelineno-34-274" href="#lab04-mcp-resources-__codelineno-34-274"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableRecord</span><span class="p">(</span><span class="nx">tableName</span><span class="p">,</span><span class="w"> </span><span class="nx">recordId</span><span class="p">);</span>
</span><span id="__span-34-275"><a id="__codelineno-34-275" name="__codelineno-34-275" href="#lab04-mcp-resources-__codelineno-34-275"></a>
</span><span id="__span-34-276"><a id="__codelineno-34-276" name="__codelineno-34-276" href="#lab04-mcp-resources-__codelineno-34-276"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-34-277"><a id="__codelineno-34-277" name="__codelineno-34-277" href="#lab04-mcp-resources-__codelineno-34-277"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown table action: </span><span class="si">${</span><span class="nx">action</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-278"><a id="__codelineno-34-278" name="__codelineno-34-278" href="#lab04-mcp-resources-__codelineno-34-278"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-279"><a id="__codelineno-34-279" name="__codelineno-34-279" href="#lab04-mcp-resources-__codelineno-34-279"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-280"><a id="__codelineno-34-280" name="__codelineno-34-280" href="#lab04-mcp-resources-__codelineno-34-280"></a>
</span><span id="__span-34-281"><a id="__codelineno-34-281" name="__codelineno-34-281" href="#lab04-mcp-resources-__codelineno-34-281"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableSchema</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-282"><a id="__codelineno-34-282" name="__codelineno-34-282" href="#lab04-mcp-resources-__codelineno-34-282"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-283"><a id="__codelineno-34-283" name="__codelineno-34-283" href="#lab04-mcp-resources-__codelineno-34-283"></a>
</span><span id="__span-34-284"><a id="__codelineno-34-284" name="__codelineno-34-284" href="#lab04-mcp-resources-__codelineno-34-284"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">tables</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getTableInfo</span><span class="p">();</span>
</span><span id="__span-34-285"><a id="__codelineno-34-285" name="__codelineno-34-285" href="#lab04-mcp-resources-__codelineno-34-285"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">tables</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">t</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">t</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">tableName</span><span class="p">);</span>
</span><span id="__span-34-286"><a id="__codelineno-34-286" name="__codelineno-34-286" href="#lab04-mcp-resources-__codelineno-34-286"></a>
</span><span id="__span-34-287"><a id="__codelineno-34-287" name="__codelineno-34-287" href="#lab04-mcp-resources-__codelineno-34-287"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">table</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-288"><a id="__codelineno-34-288" name="__codelineno-34-288" href="#lab04-mcp-resources-__codelineno-34-288"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Table not found: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-289"><a id="__codelineno-34-289" name="__codelineno-34-289" href="#lab04-mcp-resources-__codelineno-34-289"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-290"><a id="__codelineno-34-290" name="__codelineno-34-290" href="#lab04-mcp-resources-__codelineno-34-290"></a>
</span><span id="__span-34-291"><a id="__codelineno-34-291" name="__codelineno-34-291" href="#lab04-mcp-resources-__codelineno-34-291"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-292"><a id="__codelineno-34-292" name="__codelineno-34-292" href="#lab04-mcp-resources-__codelineno-34-292"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/schema`</span><span class="p">,</span>
</span><span id="__span-34-293"><a id="__codelineno-34-293" name="__codelineno-34-293" href="#lab04-mcp-resources-__codelineno-34-293"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-294"><a id="__codelineno-34-294" name="__codelineno-34-294" href="#lab04-mcp-resources-__codelineno-34-294"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-295"><a id="__codelineno-34-295" name="__codelineno-34-295" href="#lab04-mcp-resources-__codelineno-34-295"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-296"><a id="__codelineno-34-296" name="__codelineno-34-296" href="#lab04-mcp-resources-__codelineno-34-296"></a><span class="w">        </span><span class="nx">columns</span><span class="o">:</span><span class="w"> </span><span class="kt">table.columns</span><span class="p">,</span>
</span><span id="__span-34-297"><a id="__codelineno-34-297" name="__codelineno-34-297" href="#lab04-mcp-resources-__codelineno-34-297"></a><span class="w">        </span><span class="nx">rowCount</span><span class="o">:</span><span class="w"> </span><span class="kt">table.rowCount</span><span class="p">,</span>
</span><span id="__span-34-298"><a id="__codelineno-34-298" name="__codelineno-34-298" href="#lab04-mcp-resources-__codelineno-34-298"></a><span class="w">        </span><span class="nx">indexes</span><span class="o">:</span><span class="w"> </span><span class="kt">this.getTableIndexes</span><span class="p">(</span><span class="nx">tableName</span><span class="p">),</span>
</span><span id="__span-34-299"><a id="__codelineno-34-299" name="__codelineno-34-299" href="#lab04-mcp-resources-__codelineno-34-299"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-300"><a id="__codelineno-34-300" name="__codelineno-34-300" href="#lab04-mcp-resources-__codelineno-34-300"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-301"><a id="__codelineno-34-301" name="__codelineno-34-301" href="#lab04-mcp-resources-__codelineno-34-301"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-302"><a id="__codelineno-34-302" name="__codelineno-34-302" href="#lab04-mcp-resources-__codelineno-34-302"></a>
</span><span id="__span-34-303"><a id="__codelineno-34-303" name="__codelineno-34-303" href="#lab04-mcp-resources-__codelineno-34-303"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableData</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-304"><a id="__codelineno-34-304" name="__codelineno-34-304" href="#lab04-mcp-resources-__codelineno-34-304"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-305"><a id="__codelineno-34-305" name="__codelineno-34-305" href="#lab04-mcp-resources-__codelineno-34-305"></a>
</span><span id="__span-34-306"><a id="__codelineno-34-306" name="__codelineno-34-306" href="#lab04-mcp-resources-__codelineno-34-306"></a><span class="w">    </span><span class="c1">// Validate limits</span>
</span><span id="__span-34-307"><a id="__codelineno-34-307" name="__codelineno-34-307" href="#lab04-mcp-resources-__codelineno-34-307"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">actualLimit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">limit</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="p">);</span>
</span><span id="__span-34-308"><a id="__codelineno-34-308" name="__codelineno-34-308" href="#lab04-mcp-resources-__codelineno-34-308"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">actualOffset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">offset</span><span class="p">);</span>
</span><span id="__span-34-309"><a id="__codelineno-34-309" name="__codelineno-34-309" href="#lab04-mcp-resources-__codelineno-34-309"></a>
</span><span id="__span-34-310"><a id="__codelineno-34-310" name="__codelineno-34-310" href="#lab04-mcp-resources-__codelineno-34-310"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb"> LIMIT ? OFFSET ?`</span><span class="p">;</span>
</span><span id="__span-34-311"><a id="__codelineno-34-311" name="__codelineno-34-311" href="#lab04-mcp-resources-__codelineno-34-311"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nx">all</span><span class="p">(</span><span class="nx">actualLimit</span><span class="p">,</span><span class="w"> </span><span class="nx">actualOffset</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-312"><a id="__codelineno-34-312" name="__codelineno-34-312" href="#lab04-mcp-resources-__codelineno-34-312"></a>
</span><span id="__span-34-313"><a id="__codelineno-34-313" name="__codelineno-34-313" href="#lab04-mcp-resources-__codelineno-34-313"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-314"><a id="__codelineno-34-314" name="__codelineno-34-314" href="#lab04-mcp-resources-__codelineno-34-314"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/data?limit=</span><span class="si">${</span><span class="nx">actualLimit</span><span class="si">}</span><span class="sb">&amp;offset=</span><span class="si">${</span><span class="nx">actualOffset</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-315"><a id="__codelineno-34-315" name="__codelineno-34-315" href="#lab04-mcp-resources-__codelineno-34-315"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-316"><a id="__codelineno-34-316" name="__codelineno-34-316" href="#lab04-mcp-resources-__codelineno-34-316"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-317"><a id="__codelineno-34-317" name="__codelineno-34-317" href="#lab04-mcp-resources-__codelineno-34-317"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-318"><a id="__codelineno-34-318" name="__codelineno-34-318" href="#lab04-mcp-resources-__codelineno-34-318"></a><span class="w">        </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-319"><a id="__codelineno-34-319" name="__codelineno-34-319" href="#lab04-mcp-resources-__codelineno-34-319"></a><span class="w">          </span><span class="nx">limit</span><span class="o">:</span><span class="w"> </span><span class="kt">actualLimit</span><span class="p">,</span>
</span><span id="__span-34-320"><a id="__codelineno-34-320" name="__codelineno-34-320" href="#lab04-mcp-resources-__codelineno-34-320"></a><span class="w">          </span><span class="nx">offset</span><span class="o">:</span><span class="w"> </span><span class="kt">actualOffset</span><span class="p">,</span>
</span><span id="__span-34-321"><a id="__codelineno-34-321" name="__codelineno-34-321" href="#lab04-mcp-resources-__codelineno-34-321"></a><span class="w">          </span><span class="nx">totalRows</span><span class="o">:</span><span class="w"> </span><span class="kt">rows.length</span><span class="p">,</span>
</span><span id="__span-34-322"><a id="__codelineno-34-322" name="__codelineno-34-322" href="#lab04-mcp-resources-__codelineno-34-322"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-323"><a id="__codelineno-34-323" name="__codelineno-34-323" href="#lab04-mcp-resources-__codelineno-34-323"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">rows</span><span class="p">,</span>
</span><span id="__span-34-324"><a id="__codelineno-34-324" name="__codelineno-34-324" href="#lab04-mcp-resources-__codelineno-34-324"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-325"><a id="__codelineno-34-325" name="__codelineno-34-325" href="#lab04-mcp-resources-__codelineno-34-325"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-326"><a id="__codelineno-34-326" name="__codelineno-34-326" href="#lab04-mcp-resources-__codelineno-34-326"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-327"><a id="__codelineno-34-327" name="__codelineno-34-327" href="#lab04-mcp-resources-__codelineno-34-327"></a>
</span><span id="__span-34-328"><a id="__codelineno-34-328" name="__codelineno-34-328" href="#lab04-mcp-resources-__codelineno-34-328"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableRecord</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">recordId</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-329"><a id="__codelineno-34-329" name="__codelineno-34-329" href="#lab04-mcp-resources-__codelineno-34-329"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-330"><a id="__codelineno-34-330" name="__codelineno-34-330" href="#lab04-mcp-resources-__codelineno-34-330"></a>
</span><span id="__span-34-331"><a id="__codelineno-34-331" name="__codelineno-34-331" href="#lab04-mcp-resources-__codelineno-34-331"></a><span class="w">    </span><span class="c1">// Get primary key column</span>
</span><span id="__span-34-332"><a id="__codelineno-34-332" name="__codelineno-34-332" href="#lab04-mcp-resources-__codelineno-34-332"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">columns</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`PRAGMA table_info(</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">)`</span><span class="p">).</span><span class="nx">all</span><span class="p">()</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-333"><a id="__codelineno-34-333" name="__codelineno-34-333" href="#lab04-mcp-resources-__codelineno-34-333"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pkColumn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">columns</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">col</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">col</span><span class="p">.</span><span class="nx">pk</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-34-334"><a id="__codelineno-34-334" name="__codelineno-34-334" href="#lab04-mcp-resources-__codelineno-34-334"></a>
</span><span id="__span-34-335"><a id="__codelineno-34-335" name="__codelineno-34-335" href="#lab04-mcp-resources-__codelineno-34-335"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pkColumn</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-336"><a id="__codelineno-34-336" name="__codelineno-34-336" href="#lab04-mcp-resources-__codelineno-34-336"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`No primary key found for table: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-337"><a id="__codelineno-34-337" name="__codelineno-34-337" href="#lab04-mcp-resources-__codelineno-34-337"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-338"><a id="__codelineno-34-338" name="__codelineno-34-338" href="#lab04-mcp-resources-__codelineno-34-338"></a>
</span><span id="__span-34-339"><a id="__codelineno-34-339" name="__codelineno-34-339" href="#lab04-mcp-resources-__codelineno-34-339"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`SELECT * FROM </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb"> WHERE </span><span class="si">${</span><span class="nx">pkColumn</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> = ?`</span><span class="p">;</span>
</span><span id="__span-34-340"><a id="__codelineno-34-340" name="__codelineno-34-340" href="#lab04-mcp-resources-__codelineno-34-340"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">row</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">query</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="nx">recordId</span><span class="p">);</span>
</span><span id="__span-34-341"><a id="__codelineno-34-341" name="__codelineno-34-341" href="#lab04-mcp-resources-__codelineno-34-341"></a>
</span><span id="__span-34-342"><a id="__codelineno-34-342" name="__codelineno-34-342" href="#lab04-mcp-resources-__codelineno-34-342"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">row</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-343"><a id="__codelineno-34-343" name="__codelineno-34-343" href="#lab04-mcp-resources-__codelineno-34-343"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Record not found: </span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">.</span><span class="si">${</span><span class="nx">pkColumn</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> = </span><span class="si">${</span><span class="nx">recordId</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-344"><a id="__codelineno-34-344" name="__codelineno-34-344" href="#lab04-mcp-resources-__codelineno-34-344"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-345"><a id="__codelineno-34-345" name="__codelineno-34-345" href="#lab04-mcp-resources-__codelineno-34-345"></a>
</span><span id="__span-34-346"><a id="__codelineno-34-346" name="__codelineno-34-346" href="#lab04-mcp-resources-__codelineno-34-346"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-347"><a id="__codelineno-34-347" name="__codelineno-34-347" href="#lab04-mcp-resources-__codelineno-34-347"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://tables/</span><span class="si">${</span><span class="nx">tableName</span><span class="si">}</span><span class="sb">/records/</span><span class="si">${</span><span class="nx">recordId</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-348"><a id="__codelineno-34-348" name="__codelineno-34-348" href="#lab04-mcp-resources-__codelineno-34-348"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-349"><a id="__codelineno-34-349" name="__codelineno-34-349" href="#lab04-mcp-resources-__codelineno-34-349"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-350"><a id="__codelineno-34-350" name="__codelineno-34-350" href="#lab04-mcp-resources-__codelineno-34-350"></a><span class="w">        </span><span class="nx">table</span><span class="o">:</span><span class="w"> </span><span class="kt">tableName</span><span class="p">,</span>
</span><span id="__span-34-351"><a id="__codelineno-34-351" name="__codelineno-34-351" href="#lab04-mcp-resources-__codelineno-34-351"></a><span class="w">        </span><span class="nx">primaryKey</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-352"><a id="__codelineno-34-352" name="__codelineno-34-352" href="#lab04-mcp-resources-__codelineno-34-352"></a><span class="w">          </span><span class="nx">column</span><span class="o">:</span><span class="w"> </span><span class="kt">pkColumn.name</span><span class="p">,</span>
</span><span id="__span-34-353"><a id="__codelineno-34-353" name="__codelineno-34-353" href="#lab04-mcp-resources-__codelineno-34-353"></a><span class="w">          </span><span class="nx">value</span><span class="o">:</span><span class="w"> </span><span class="kt">recordId</span><span class="p">,</span>
</span><span id="__span-34-354"><a id="__codelineno-34-354" name="__codelineno-34-354" href="#lab04-mcp-resources-__codelineno-34-354"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-34-355"><a id="__codelineno-34-355" name="__codelineno-34-355" href="#lab04-mcp-resources-__codelineno-34-355"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">row</span><span class="p">,</span>
</span><span id="__span-34-356"><a id="__codelineno-34-356" name="__codelineno-34-356" href="#lab04-mcp-resources-__codelineno-34-356"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-357"><a id="__codelineno-34-357" name="__codelineno-34-357" href="#lab04-mcp-resources-__codelineno-34-357"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-358"><a id="__codelineno-34-358" name="__codelineno-34-358" href="#lab04-mcp-resources-__codelineno-34-358"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-359"><a id="__codelineno-34-359" name="__codelineno-34-359" href="#lab04-mcp-resources-__codelineno-34-359"></a>
</span><span id="__span-34-360"><a id="__codelineno-34-360" name="__codelineno-34-360" href="#lab04-mcp-resources-__codelineno-34-360"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">executeCustomQuery</span><span class="p">(</span><span class="nx">queryString</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-361"><a id="__codelineno-34-361" name="__codelineno-34-361" href="#lab04-mcp-resources-__codelineno-34-361"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Database not initialized&#39;</span><span class="p">);</span>
</span><span id="__span-34-362"><a id="__codelineno-34-362" name="__codelineno-34-362" href="#lab04-mcp-resources-__codelineno-34-362"></a>
</span><span id="__span-34-363"><a id="__codelineno-34-363" name="__codelineno-34-363" href="#lab04-mcp-resources-__codelineno-34-363"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">URL</span><span class="p">(</span><span class="sb">`db://query?</span><span class="si">${</span><span class="nx">queryString</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-34-364"><a id="__codelineno-34-364" name="__codelineno-34-364" href="#lab04-mcp-resources-__codelineno-34-364"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">sql</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;sql&#39;</span><span class="p">);</span>
</span><span id="__span-34-365"><a id="__codelineno-34-365" name="__codelineno-34-365" href="#lab04-mcp-resources-__codelineno-34-365"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">url</span><span class="p">.</span><span class="nx">searchParams</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;params&#39;</span><span class="p">);</span>
</span><span id="__span-34-366"><a id="__codelineno-34-366" name="__codelineno-34-366" href="#lab04-mcp-resources-__codelineno-34-366"></a>
</span><span id="__span-34-367"><a id="__codelineno-34-367" name="__codelineno-34-367" href="#lab04-mcp-resources-__codelineno-34-367"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">sql</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-368"><a id="__codelineno-34-368" name="__codelineno-34-368" href="#lab04-mcp-resources-__codelineno-34-368"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;SQL parameter required for custom query&#39;</span><span class="p">);</span>
</span><span id="__span-34-369"><a id="__codelineno-34-369" name="__codelineno-34-369" href="#lab04-mcp-resources-__codelineno-34-369"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-370"><a id="__codelineno-34-370" name="__codelineno-34-370" href="#lab04-mcp-resources-__codelineno-34-370"></a>
</span><span id="__span-34-371"><a id="__codelineno-34-371" name="__codelineno-34-371" href="#lab04-mcp-resources-__codelineno-34-371"></a><span class="w">    </span><span class="c1">// Security: Only allow SELECT queries</span>
</span><span id="__span-34-372"><a id="__codelineno-34-372" name="__codelineno-34-372" href="#lab04-mcp-resources-__codelineno-34-372"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">sql</span><span class="p">.</span><span class="nx">trim</span><span class="p">().</span><span class="nx">toUpperCase</span><span class="p">().</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;SELECT&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-373"><a id="__codelineno-34-373" name="__codelineno-34-373" href="#lab04-mcp-resources-__codelineno-34-373"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Only SELECT queries are allowed for security&#39;</span><span class="p">);</span>
</span><span id="__span-34-374"><a id="__codelineno-34-374" name="__codelineno-34-374" href="#lab04-mcp-resources-__codelineno-34-374"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-375"><a id="__codelineno-34-375" name="__codelineno-34-375" href="#lab04-mcp-resources-__codelineno-34-375"></a>
</span><span id="__span-34-376"><a id="__codelineno-34-376" name="__codelineno-34-376" href="#lab04-mcp-resources-__codelineno-34-376"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">queryParams</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-377"><a id="__codelineno-34-377" name="__codelineno-34-377" href="#lab04-mcp-resources-__codelineno-34-377"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">params</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-378"><a id="__codelineno-34-378" name="__codelineno-34-378" href="#lab04-mcp-resources-__codelineno-34-378"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-379"><a id="__codelineno-34-379" name="__codelineno-34-379" href="#lab04-mcp-resources-__codelineno-34-379"></a><span class="w">        </span><span class="nx">queryParams</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">params</span><span class="p">);</span>
</span><span id="__span-34-380"><a id="__codelineno-34-380" name="__codelineno-34-380" href="#lab04-mcp-resources-__codelineno-34-380"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-381"><a id="__codelineno-34-381" name="__codelineno-34-381" href="#lab04-mcp-resources-__codelineno-34-381"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Invalid params JSON&#39;</span><span class="p">);</span>
</span><span id="__span-34-382"><a id="__codelineno-34-382" name="__codelineno-34-382" href="#lab04-mcp-resources-__codelineno-34-382"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-383"><a id="__codelineno-34-383" name="__codelineno-34-383" href="#lab04-mcp-resources-__codelineno-34-383"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-384"><a id="__codelineno-34-384" name="__codelineno-34-384" href="#lab04-mcp-resources-__codelineno-34-384"></a>
</span><span id="__span-34-385"><a id="__codelineno-34-385" name="__codelineno-34-385" href="#lab04-mcp-resources-__codelineno-34-385"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">stmt</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="nx">sql</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s1">&#39; LIMIT ?&#39;</span><span class="p">);</span>
</span><span id="__span-34-386"><a id="__codelineno-34-386" name="__codelineno-34-386" href="#lab04-mcp-resources-__codelineno-34-386"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">rows</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">stmt</span><span class="p">.</span><span class="nx">all</span><span class="p">(...</span><span class="nx">queryParams</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">maxRows</span><span class="p">);</span>
</span><span id="__span-34-387"><a id="__codelineno-34-387" name="__codelineno-34-387" href="#lab04-mcp-resources-__codelineno-34-387"></a>
</span><span id="__span-34-388"><a id="__codelineno-34-388" name="__codelineno-34-388" href="#lab04-mcp-resources-__codelineno-34-388"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-389"><a id="__codelineno-34-389" name="__codelineno-34-389" href="#lab04-mcp-resources-__codelineno-34-389"></a><span class="w">      </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`db://query?sql=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">sql</span><span class="p">)</span><span class="si">}</span><span class="sb">&amp;params=</span><span class="si">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">queryParams</span><span class="p">))</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-34-390"><a id="__codelineno-34-390" name="__codelineno-34-390" href="#lab04-mcp-resources-__codelineno-34-390"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
</span><span id="__span-34-391"><a id="__codelineno-34-391" name="__codelineno-34-391" href="#lab04-mcp-resources-__codelineno-34-391"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-34-392"><a id="__codelineno-34-392" name="__codelineno-34-392" href="#lab04-mcp-resources-__codelineno-34-392"></a><span class="w">        </span><span class="nx">query</span><span class="o">:</span><span class="w"> </span><span class="kt">sql</span><span class="p">,</span>
</span><span id="__span-34-393"><a id="__codelineno-34-393" name="__codelineno-34-393" href="#lab04-mcp-resources-__codelineno-34-393"></a><span class="w">        </span><span class="nx">parameters</span><span class="o">:</span><span class="w"> </span><span class="kt">queryParams</span><span class="p">,</span>
</span><span id="__span-34-394"><a id="__codelineno-34-394" name="__codelineno-34-394" href="#lab04-mcp-resources-__codelineno-34-394"></a><span class="w">        </span><span class="nx">resultCount</span><span class="o">:</span><span class="w"> </span><span class="kt">rows.length</span><span class="p">,</span>
</span><span id="__span-34-395"><a id="__codelineno-34-395" name="__codelineno-34-395" href="#lab04-mcp-resources-__codelineno-34-395"></a><span class="w">        </span><span class="nx">data</span><span class="o">:</span><span class="w"> </span><span class="kt">rows</span><span class="p">,</span>
</span><span id="__span-34-396"><a id="__codelineno-34-396" name="__codelineno-34-396" href="#lab04-mcp-resources-__codelineno-34-396"></a><span class="w">      </span><span class="p">},</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">),</span>
</span><span id="__span-34-397"><a id="__codelineno-34-397" name="__codelineno-34-397" href="#lab04-mcp-resources-__codelineno-34-397"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-398"><a id="__codelineno-34-398" name="__codelineno-34-398" href="#lab04-mcp-resources-__codelineno-34-398"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-399"><a id="__codelineno-34-399" name="__codelineno-34-399" href="#lab04-mcp-resources-__codelineno-34-399"></a>
</span><span id="__span-34-400"><a id="__codelineno-34-400" name="__codelineno-34-400" href="#lab04-mcp-resources-__codelineno-34-400"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getTableIndexes</span><span class="p">(</span><span class="nx">tableName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-401"><a id="__codelineno-34-401" name="__codelineno-34-401" href="#lab04-mcp-resources-__codelineno-34-401"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-402"><a id="__codelineno-34-402" name="__codelineno-34-402" href="#lab04-mcp-resources-__codelineno-34-402"></a>
</span><span id="__span-34-403"><a id="__codelineno-34-403" name="__codelineno-34-403" href="#lab04-mcp-resources-__codelineno-34-403"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-404"><a id="__codelineno-34-404" name="__codelineno-34-404" href="#lab04-mcp-resources-__codelineno-34-404"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">prepare</span><span class="p">(</span><span class="sb">`</span>
</span><span id="__span-34-405"><a id="__codelineno-34-405" name="__codelineno-34-405" href="#lab04-mcp-resources-__codelineno-34-405"></a><span class="sb">        SELECT name, sql </span>
</span><span id="__span-34-406"><a id="__codelineno-34-406" name="__codelineno-34-406" href="#lab04-mcp-resources-__codelineno-34-406"></a><span class="sb">        FROM sqlite_master </span>
</span><span id="__span-34-407"><a id="__codelineno-34-407" name="__codelineno-34-407" href="#lab04-mcp-resources-__codelineno-34-407"></a><span class="sb">        WHERE type=&#39;index&#39; AND tbl_name=?</span>
</span><span id="__span-34-408"><a id="__codelineno-34-408" name="__codelineno-34-408" href="#lab04-mcp-resources-__codelineno-34-408"></a><span class="sb">      `</span><span class="p">).</span><span class="nx">all</span><span class="p">(</span><span class="nx">tableName</span><span class="p">)</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">any</span><span class="p">[];</span>
</span><span id="__span-34-409"><a id="__codelineno-34-409" name="__codelineno-34-409" href="#lab04-mcp-resources-__codelineno-34-409"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-410"><a id="__codelineno-34-410" name="__codelineno-34-410" href="#lab04-mcp-resources-__codelineno-34-410"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-34-411"><a id="__codelineno-34-411" name="__codelineno-34-411" href="#lab04-mcp-resources-__codelineno-34-411"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-34-412"><a id="__codelineno-34-412" name="__codelineno-34-412" href="#lab04-mcp-resources-__codelineno-34-412"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-413"><a id="__codelineno-34-413" name="__codelineno-34-413" href="#lab04-mcp-resources-__codelineno-34-413"></a>
</span><span id="__span-34-414"><a id="__codelineno-34-414" name="__codelineno-34-414" href="#lab04-mcp-resources-__codelineno-34-414"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-415"><a id="__codelineno-34-415" name="__codelineno-34-415" href="#lab04-mcp-resources-__codelineno-34-415"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-416"><a id="__codelineno-34-416" name="__codelineno-34-416" href="#lab04-mcp-resources-__codelineno-34-416"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-417"><a id="__codelineno-34-417" name="__codelineno-34-417" href="#lab04-mcp-resources-__codelineno-34-417"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-34-418"><a id="__codelineno-34-418" name="__codelineno-34-418" href="#lab04-mcp-resources-__codelineno-34-418"></a>
</span><span id="__span-34-419"><a id="__codelineno-34-419" name="__codelineno-34-419" href="#lab04-mcp-resources-__codelineno-34-419"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-420"><a id="__codelineno-34-420" name="__codelineno-34-420" href="#lab04-mcp-resources-__codelineno-34-420"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-421"><a id="__codelineno-34-421" name="__codelineno-34-421" href="#lab04-mcp-resources-__codelineno-34-421"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">db</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-34-422"><a id="__codelineno-34-422" name="__codelineno-34-422" href="#lab04-mcp-resources-__codelineno-34-422"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-34-423"><a id="__codelineno-34-423" name="__codelineno-34-423" href="#lab04-mcp-resources-__codelineno-34-423"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-34-424"><a id="__codelineno-34-424" name="__codelineno-34-424" href="#lab04-mcp-resources-__codelineno-34-424"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-34-425"><a id="__codelineno-34-425" name="__codelineno-34-425" href="#lab04-mcp-resources-__codelineno-34-425"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-34-426"><a id="__codelineno-34-426" name="__codelineno-34-426" href="#lab04-mcp-resources-__codelineno-34-426"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-427"><a id="__codelineno-34-427" name="__codelineno-34-427" href="#lab04-mcp-resources-__codelineno-34-427"></a>
</span><span id="__span-34-428"><a id="__codelineno-34-428" name="__codelineno-34-428" href="#lab04-mcp-resources-__codelineno-34-428"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-429"><a id="__codelineno-34-429" name="__codelineno-34-429" href="#lab04-mcp-resources-__codelineno-34-429"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-34-430"><a id="__codelineno-34-430" name="__codelineno-34-430" href="#lab04-mcp-resources-__codelineno-34-430"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-34-431"><a id="__codelineno-34-431" name="__codelineno-34-431" href="#lab04-mcp-resources-__codelineno-34-431"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="sb">`Database Resource Server running (DB: </span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">dbPath</span><span class="si">}</span><span class="sb">)`</span><span class="p">);</span>
</span><span id="__span-34-432"><a id="__codelineno-34-432" name="__codelineno-34-432" href="#lab04-mcp-resources-__codelineno-34-432"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-34-433"><a id="__codelineno-34-433" name="__codelineno-34-433" href="#lab04-mcp-resources-__codelineno-34-433"></a><span class="p">}</span>
</span><span id="__span-34-434"><a id="__codelineno-34-434" name="__codelineno-34-434" href="#lab04-mcp-resources-__codelineno-34-434"></a>
</span><span id="__span-34-435"><a id="__codelineno-34-435" name="__codelineno-34-435" href="#lab04-mcp-resources-__codelineno-34-435"></a><span class="c1">// Main entry point</span>
</span><span id="__span-34-436"><a id="__codelineno-34-436" name="__codelineno-34-436" href="#lab04-mcp-resources-__codelineno-34-436"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-437"><a id="__codelineno-34-437" name="__codelineno-34-437" href="#lab04-mcp-resources-__codelineno-34-437"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">DatabaseResourceServer</span><span class="p">();</span>
</span><span id="__span-34-438"><a id="__codelineno-34-438" name="__codelineno-34-438" href="#lab04-mcp-resources-__codelineno-34-438"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-34-439"><a id="__codelineno-34-439" name="__codelineno-34-439" href="#lab04-mcp-resources-__codelineno-34-439"></a><span class="p">}</span>
</span><span id="__span-34-440"><a id="__codelineno-34-440" name="__codelineno-34-440" href="#lab04-mcp-resources-__codelineno-34-440"></a>
</span><span id="__span-34-441"><a id="__codelineno-34-441" name="__codelineno-34-441" href="#lab04-mcp-resources-__codelineno-34-441"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-34-442"><a id="__codelineno-34-442" name="__codelineno-34-442" href="#lab04-mcp-resources-__codelineno-34-442"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-34-443"><a id="__codelineno-34-443" name="__codelineno-34-443" href="#lab04-mcp-resources-__codelineno-34-443"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-34-444"><a id="__codelineno-34-444" name="__codelineno-34-444" href="#lab04-mcp-resources-__codelineno-34-444"></a><span class="p">});</span>
</span></code></pre></div>

Testing - First, create a test database:

<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab04-mcp-resources-__codelineno-35-1"></a>sqlite3<span class="w"> </span>test.db<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab04-mcp-resources-__codelineno-35-2"></a><span class="s">CREATE TABLE users (</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#lab04-mcp-resources-__codelineno-35-3"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#lab04-mcp-resources-__codelineno-35-4"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#lab04-mcp-resources-__codelineno-35-5"></a><span class="s">  email TEXT UNIQUE,</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#lab04-mcp-resources-__codelineno-35-6"></a><span class="s">  age INTEGER,</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#lab04-mcp-resources-__codelineno-35-7"></a><span class="s">  created_at DATETIME DEFAULT CURRENT_TIMESTAMP</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#lab04-mcp-resources-__codelineno-35-8"></a><span class="s">);</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#lab04-mcp-resources-__codelineno-35-9"></a>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#lab04-mcp-resources-__codelineno-35-10"></a><span class="s">CREATE TABLE products (</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#lab04-mcp-resources-__codelineno-35-11"></a><span class="s">  id INTEGER PRIMARY KEY,</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#lab04-mcp-resources-__codelineno-35-12"></a><span class="s">  name TEXT NOT NULL,</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#lab04-mcp-resources-__codelineno-35-13"></a><span class="s">  price REAL,</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#lab04-mcp-resources-__codelineno-35-14"></a><span class="s">  category TEXT,</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#lab04-mcp-resources-__codelineno-35-15"></a><span class="s">  in_stock BOOLEAN DEFAULT 1</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#lab04-mcp-resources-__codelineno-35-16"></a><span class="s">);</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#lab04-mcp-resources-__codelineno-35-17"></a>
</span><span id="__span-35-18"><a id="__codelineno-35-18" name="__codelineno-35-18" href="#lab04-mcp-resources-__codelineno-35-18"></a><span class="s">INSERT INTO users (name, email, age) VALUES </span>
</span><span id="__span-35-19"><a id="__codelineno-35-19" name="__codelineno-35-19" href="#lab04-mcp-resources-__codelineno-35-19"></a><span class="s">  (&#39;Alice Johnson&#39;, &#39;alice@example.com&#39;, 28),</span>
</span><span id="__span-35-20"><a id="__codelineno-35-20" name="__codelineno-35-20" href="#lab04-mcp-resources-__codelineno-35-20"></a><span class="s">  (&#39;Bob Smith&#39;, &#39;bob@example.com&#39;, 34);</span>
</span><span id="__span-35-21"><a id="__codelineno-35-21" name="__codelineno-35-21" href="#lab04-mcp-resources-__codelineno-35-21"></a>
</span><span id="__span-35-22"><a id="__codelineno-35-22" name="__codelineno-35-22" href="#lab04-mcp-resources-__codelineno-35-22"></a><span class="s">INSERT INTO products (name, price, category, in_stock) VALUES </span>
</span><span id="__span-35-23"><a id="__codelineno-35-23" name="__codelineno-35-23" href="#lab04-mcp-resources-__codelineno-35-23"></a><span class="s">  (&#39;Laptop&#39;, 999.99, &#39;Electronics&#39;, 1),</span>
</span><span id="__span-35-24"><a id="__codelineno-35-24" name="__codelineno-35-24" href="#lab04-mcp-resources-__codelineno-35-24"></a><span class="s">  (&#39;Book&#39;, 19.99, &#39;Education&#39;, 1);</span>
</span><span id="__span-35-25"><a id="__codelineno-35-25" name="__codelineno-35-25" href="#lab04-mcp-resources-__codelineno-35-25"></a>
</span><span id="__span-35-26"><a id="__codelineno-35-26" name="__codelineno-35-26" href="#lab04-mcp-resources-__codelineno-35-26"></a><span class="s">.quit</span>
</span><span id="__span-35-27"><a id="__codelineno-35-27" name="__codelineno-35-27" href="#lab04-mcp-resources-__codelineno-35-27"></a><span class="s">EOF</span>
</span></code></pre></div>

Test the server:

<div class="language-javascript highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#lab04-mcp-resources-__codelineno-36-1"></a><span class="c1">// Database info</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#lab04-mcp-resources-__codelineno-36-2"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://info&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#lab04-mcp-resources-__codelineno-36-3"></a>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#lab04-mcp-resources-__codelineno-36-4"></a><span class="c1">// Table schemas</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#lab04-mcp-resources-__codelineno-36-5"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/users/schema&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#lab04-mcp-resources-__codelineno-36-6"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/products/schema&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#lab04-mcp-resources-__codelineno-36-7"></a>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#lab04-mcp-resources-__codelineno-36-8"></a><span class="c1">// Table data</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#lab04-mcp-resources-__codelineno-36-9"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/users/data?limit=10&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#lab04-mcp-resources-__codelineno-36-10"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/products/data?limit=10&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-11"><a id="__codelineno-36-11" name="__codelineno-36-11" href="#lab04-mcp-resources-__codelineno-36-11"></a>
</span><span id="__span-36-12"><a id="__codelineno-36-12" name="__codelineno-36-12" href="#lab04-mcp-resources-__codelineno-36-12"></a><span class="c1">// Specific records</span>
</span><span id="__span-36-13"><a id="__codelineno-36-13" name="__codelineno-36-13" href="#lab04-mcp-resources-__codelineno-36-13"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/users/records/1&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-14"><a id="__codelineno-36-14" name="__codelineno-36-14" href="#lab04-mcp-resources-__codelineno-36-14"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://tables/products/records/2&quot;</span><span class="w"> </span><span class="p">}</span>
</span><span id="__span-36-15"><a id="__codelineno-36-15" name="__codelineno-36-15" href="#lab04-mcp-resources-__codelineno-36-15"></a>
</span><span id="__span-36-16"><a id="__codelineno-36-16" name="__codelineno-36-16" href="#lab04-mcp-resources-__codelineno-36-16"></a><span class="c1">// Custom query</span>
</span><span id="__span-36-17"><a id="__codelineno-36-17" name="__codelineno-36-17" href="#lab04-mcp-resources-__codelineno-36-17"></a><span class="p">{</span><span class="w"> </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;db://query?sql=SELECT * FROM users WHERE age &gt; ?&amp;params=[25]&quot;</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>

</details>

<hr />
<h2 id="lab04-mcp-resources-key-takeaways">Key Takeaways<a class="headerlink" href="#lab04-mcp-resources-key-takeaways" title="Permanent link">&para;</a></h2>
<p>‚úÖ <strong>Resources</strong> provide passive data access for LLMs</p>
<p>‚úÖ <strong>Tools</strong> perform active operations with side effects</p>
<p>‚úÖ <strong>URI schemes</strong> should be hierarchical and descriptive</p>
<p>‚úÖ <strong>Templates</strong> enable parameterized resource access</p>
<p>‚úÖ <strong>Subscriptions</strong> support real-time data updates</p>
<p>‚úÖ <strong>Security</strong> is critical for resource access control</p>
<p>‚úÖ <strong>Caching</strong> improves performance for static resources</p>
<p>‚úÖ <strong>Hybrid servers</strong> combine resources and tools effectively</p>
<hr />
<h2 id="lab04-mcp-resources-next-steps">Next Steps<a class="headerlink" href="#lab04-mcp-resources-next-steps" title="Permanent link">&para;</a></h2>
<p>In <a href="#lab05-mcp-prompts"><strong>Lab 5</strong></a>, you&rsquo;ll complete your MCP mastery by learning about Prompts:</p>
<ul>
<li>Creating reusable prompt templates</li>
<li>Embedding resources in prompts</li>
<li>Supporting prompt arguments</li>
<li>Building complete, production-ready MCP servers</li>
</ul>
<hr />
<p><strong>Ready to add prompts to your MCP toolkit? Continue to <a href="#lab05-mcp-prompts">Lab 5!</a></strong></p></section><section class="print-page" id="lab05-mcp-prompts" heading-number="3.7"><h1 id="lab05-mcp-prompts-lab-5-mcp-prompts-and-integration">Lab 5: MCP Prompts and Integration<a class="headerlink" href="#lab05-mcp-prompts-lab-5-mcp-prompts-and-integration" title="Permanent link">&para;</a></h1>
<h2 id="lab05-mcp-prompts-overview">Overview<a class="headerlink" href="#lab05-mcp-prompts-overview" title="Permanent link">&para;</a></h2>
<p>Congratulations on reaching the final lab!</p>
<p>As you have already mastered tools and resources, now it&rsquo;s time to complete your MCP expertise with <strong>Prompts</strong>.</p>
<p>Prompts are reusable templates that help users and LLMs perform common tasks consistently and effectively. They can embed resources, accept arguments, and create structured workflows that combine the best of human expertise with AI capabilities.</p>
<p>In this lab, you&rsquo;ll learn how to create sophisticated prompt templates, integrate them with resources and tools, and build complete, production-ready MCP servers that showcase all three capabilities working together.</p>
<hr />
<h2 id="lab05-mcp-prompts-learning-objectives">Learning Objectives<a class="headerlink" href="#lab05-mcp-prompts-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Understand the role of prompts in MCP ecosystems</li>
<li>Create static and dynamic prompt templates</li>
<li>Embed resources and arguments in prompts</li>
<li>Implement prompt handlers with proper validation</li>
<li>Build complete MCP servers combining all capabilities</li>
<li>Apply production best practices for deployment</li>
<li>Debug and troubleshoot complex MCP integrations</li>
<li>Create reusable prompt libraries for common tasks</li>
</ul>
<hr />
<h2 id="lab05-mcp-prompts-prerequisites">Prerequisites<a class="headerlink" href="#lab05-mcp-prompts-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Completed <a href="#lab04-mcp-resources">Lab 4 - Implementing MCP Resources</a></li>
<li>Understanding of prompt engineering concepts</li>
<li>Familiarity with template systems and variable substitution</li>
<li>Experience with complex application architecture</li>
</ul>
<hr />
<h2 id="lab05-mcp-prompts-what-makes-prompts-special">What Makes Prompts Special?<a class="headerlink" href="#lab05-mcp-prompts-what-makes-prompts-special" title="Permanent link">&para;</a></h2>
<p>Prompts in MCP are more than just text templates - they&rsquo;re <strong>structured, reusable AI workflows</strong> that:</p>
<ul>
<li><strong>Standardize</strong> common tasks across different users and contexts</li>
<li><strong>Combine expertise</strong> from domain specialists with AI capabilities</li>
<li><strong>Integrate resources</strong> to provide rich context automatically</li>
<li><strong>Accept parameters</strong> to customize behavior dynamically</li>
<li><strong>Create consistency</strong> in AI interactions and outputs</li>
</ul>
<h3 id="lab05-mcp-prompts-when-to-use-prompts-vs-tools">When to Use Prompts vs. Tools<a class="headerlink" href="#lab05-mcp-prompts-when-to-use-prompts-vs-tools" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Use Case</th>
<th>Use Prompt</th>
<th>Use Tool</th>
<th>Why</th>
</tr>
</thead>
<tbody>
<tr>
<td>Code review</td>
<td>‚úÖ Prompt</td>
<td>‚ùå Tool</td>
<td>Needs structured guidance and context</td>
</tr>
<tr>
<td>Data analysis</td>
<td>‚úÖ Prompt</td>
<td>‚ùå Tool</td>
<td>Requires analytical reasoning framework</td>
</tr>
<tr>
<td>Content writing</td>
<td>‚úÖ Prompt</td>
<td>‚ùå Tool</td>
<td>Benefits from style guides and examples</td>
</tr>
<tr>
<td>API calls</td>
<td>‚ùå Prompt</td>
<td>‚úÖ Tool</td>
<td>Direct action with predictable results</td>
</tr>
<tr>
<td>Calculations</td>
<td>‚ùå Prompt</td>
<td>‚úÖ Tool</td>
<td>Mathematical precision required</td>
</tr>
<tr>
<td>Research synthesis</td>
<td>‚úÖ Prompt</td>
<td>‚ùå Tool</td>
<td>Complex reasoning and integration needed</td>
</tr>
</tbody>
</table>
<h3 id="lab05-mcp-prompts-prompt-architecture">Prompt Architecture<a class="headerlink" href="#lab05-mcp-prompts-prompt-architecture" title="Permanent link">&para;</a></h3>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab05-mcp-prompts-__codelineno-0-1"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">Prompt</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab05-mcp-prompts-__codelineno-0-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">              </span><span class="c1">// Unique identifier</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab05-mcp-prompts-__codelineno-0-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// What the prompt does</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab05-mcp-prompts-__codelineno-0-4"></a><span class="w">  </span><span class="nx">arguments?</span><span class="o">:</span><span class="w"> </span><span class="kt">Argument</span><span class="p">[];</span><span class="w">    </span><span class="c1">// Optional parameters</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab05-mcp-prompts-__codelineno-0-5"></a><span class="w">  </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="kt">Message</span><span class="p">[];</span><span class="w">       </span><span class="c1">// The actual prompt content</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab05-mcp-prompts-__codelineno-0-6"></a><span class="p">}</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab05-mcp-prompts-__codelineno-0-7"></a>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab05-mcp-prompts-__codelineno-0-8"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">Argument</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#lab05-mcp-prompts-__codelineno-0-9"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">              </span><span class="c1">// Parameter name</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#lab05-mcp-prompts-__codelineno-0-10"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span><span class="w">       </span><span class="c1">// What it controls</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#lab05-mcp-prompts-__codelineno-0-11"></a><span class="w">  </span><span class="nx">required?</span><span class="o">:</span><span class="w"> </span><span class="kt">boolean</span><span class="p">;</span><span class="w">        </span><span class="c1">// Is it mandatory?</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#lab05-mcp-prompts-__codelineno-0-12"></a><span class="p">}</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#lab05-mcp-prompts-__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#lab05-mcp-prompts-__codelineno-0-14"></a><span class="kd">interface</span><span class="w"> </span><span class="nx">Message</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#lab05-mcp-prompts-__codelineno-0-15"></a><span class="w">  </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="s2">&quot;assistant&quot;</span><span class="p">;</span><span class="w"> </span><span class="c1">// Who says this</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#lab05-mcp-prompts-__codelineno-0-16"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="kt">Content</span><span class="p">;</span><span class="w">          </span><span class="c1">// The message content</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#lab05-mcp-prompts-__codelineno-0-17"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h2 id="lab05-mcp-prompts-project-setup">Project Setup<a class="headerlink" href="#lab05-mcp-prompts-project-setup" title="Permanent link">&para;</a></h2>
<h3 id="lab05-mcp-prompts-step-1-create-your-project">Step 1: Create Your Project<a class="headerlink" href="#lab05-mcp-prompts-step-1-create-your-project" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s start by creating a new MCP server project for prompts:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab05-mcp-prompts-__codelineno-1-1"></a>mkdir<span class="w"> </span>my-mcp-prompts-server<span class="w">  </span><span class="c1"># &lt;-- next to the directory created in previous labs</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab05-mcp-prompts-__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>my-mcp-prompts-server
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab05-mcp-prompts-__codelineno-1-3"></a>npm<span class="w"> </span>init<span class="w"> </span>-y
</span></code></pre></div>
<h3 id="lab05-mcp-prompts-step-2-install-dependencies">Step 2: Install Dependencies<a class="headerlink" href="#lab05-mcp-prompts-step-2-install-dependencies" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab05-mcp-prompts-__codelineno-2-1"></a><span class="c1"># Core MCP SDK</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab05-mcp-prompts-__codelineno-2-2"></a>npm<span class="w"> </span>install<span class="w"> </span>@modelcontextprotocol/sdk
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab05-mcp-prompts-__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab05-mcp-prompts-__codelineno-2-4"></a><span class="c1"># TypeScript and development tools</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab05-mcp-prompts-__codelineno-2-5"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>typescript<span class="w"> </span>@types/node<span class="w"> </span>tsx
</span></code></pre></div>
<h3 id="lab05-mcp-prompts-step-3-configure-typescript">Step 3: Configure TypeScript<a class="headerlink" href="#lab05-mcp-prompts-step-3-configure-typescript" title="Permanent link">&para;</a></h3>
<p>Create a <code>tsconfig.json</code> file with the following content inside the <code>my-mcp-prompts-server</code> directory you have just created:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab05-mcp-prompts-__codelineno-3-1"></a><span class="p">{</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#lab05-mcp-prompts-__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#lab05-mcp-prompts-__codelineno-3-3"></a><span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES2022&quot;</span><span class="p">,</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#lab05-mcp-prompts-__codelineno-3-4"></a><span class="w">    </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node16&quot;</span><span class="p">,</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#lab05-mcp-prompts-__codelineno-3-5"></a><span class="w">    </span><span class="nt">&quot;moduleResolution&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Node16&quot;</span><span class="p">,</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#lab05-mcp-prompts-__codelineno-3-6"></a><span class="w">    </span><span class="nt">&quot;outDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./dist&quot;</span><span class="p">,</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#lab05-mcp-prompts-__codelineno-3-7"></a><span class="w">    </span><span class="nt">&quot;rootDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./src&quot;</span><span class="p">,</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#lab05-mcp-prompts-__codelineno-3-8"></a><span class="w">    </span><span class="nt">&quot;strict&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#lab05-mcp-prompts-__codelineno-3-9"></a><span class="w">    </span><span class="nt">&quot;esModuleInterop&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#lab05-mcp-prompts-__codelineno-3-10"></a><span class="w">    </span><span class="nt">&quot;skipLibCheck&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#lab05-mcp-prompts-__codelineno-3-11"></a><span class="w">    </span><span class="nt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#lab05-mcp-prompts-__codelineno-3-12"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#lab05-mcp-prompts-__codelineno-3-13"></a><span class="w">  </span><span class="nt">&quot;include&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src/**/*&quot;</span><span class="p">],</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#lab05-mcp-prompts-__codelineno-3-14"></a><span class="w">  </span><span class="nt">&quot;exclude&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node_modules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dist&quot;</span><span class="p">]</span>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#lab05-mcp-prompts-__codelineno-3-15"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="lab05-mcp-prompts-step-4-create-project-structure">Step 4: Create Project Structure<a class="headerlink" href="#lab05-mcp-prompts-step-4-create-project-structure" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab05-mcp-prompts-__codelineno-4-1"></a>mkdir<span class="w"> </span>src<span class="w">     </span><span class="c1"># &lt;-- inside &quot;my-mcp-prompts-server&quot; directory</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#lab05-mcp-prompts-__codelineno-4-2"></a>touch<span class="w"> </span>src/index.ts<span class="w">   </span><span class="c1"># and leave it empty for now</span>
</span></code></pre></div>
<hr />
<h2 id="lab05-mcp-prompts-creating-your-first-prompt-server">Creating Your First Prompt Server<a class="headerlink" href="#lab05-mcp-prompts-creating-your-first-prompt-server" title="Permanent link">&para;</a></h2>
<h3 id="lab05-mcp-prompts-step-1-basic-server-setup">Step 1: Basic Server Setup<a class="headerlink" href="#lab05-mcp-prompts-step-1-basic-server-setup" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s create a basic MCP server that exposes prompts. Paste the following inside <code>src/index.ts</code>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab05-mcp-prompts-__codelineno-5-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab05-mcp-prompts-__codelineno-5-2"></a>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#lab05-mcp-prompts-__codelineno-5-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#lab05-mcp-prompts-__codelineno-5-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#lab05-mcp-prompts-__codelineno-5-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#lab05-mcp-prompts-__codelineno-5-6"></a><span class="w">  </span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#lab05-mcp-prompts-__codelineno-5-7"></a><span class="w">  </span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#lab05-mcp-prompts-__codelineno-5-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#lab05-mcp-prompts-__codelineno-5-9"></a>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#lab05-mcp-prompts-__codelineno-5-10"></a><span class="kd">class</span><span class="w"> </span><span class="nx">PromptServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#lab05-mcp-prompts-__codelineno-5-11"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#lab05-mcp-prompts-__codelineno-5-12"></a>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#lab05-mcp-prompts-__codelineno-5-13"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#lab05-mcp-prompts-__codelineno-5-14"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#lab05-mcp-prompts-__codelineno-5-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#lab05-mcp-prompts-__codelineno-5-16"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;mcp-prompts-server&quot;</span><span class="p">,</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#lab05-mcp-prompts-__codelineno-5-17"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#lab05-mcp-prompts-__codelineno-5-18"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#lab05-mcp-prompts-__codelineno-5-19"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#lab05-mcp-prompts-__codelineno-5-20"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#lab05-mcp-prompts-__codelineno-5-21"></a><span class="w">          </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#lab05-mcp-prompts-__codelineno-5-22"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#lab05-mcp-prompts-__codelineno-5-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#lab05-mcp-prompts-__codelineno-5-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#lab05-mcp-prompts-__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#lab05-mcp-prompts-__codelineno-5-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#lab05-mcp-prompts-__codelineno-5-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#lab05-mcp-prompts-__codelineno-5-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#lab05-mcp-prompts-__codelineno-5-29"></a>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#lab05-mcp-prompts-__codelineno-5-30"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#lab05-mcp-prompts-__codelineno-5-31"></a><span class="w">    </span><span class="c1">// List available prompts</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#lab05-mcp-prompts-__codelineno-5-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#lab05-mcp-prompts-__codelineno-5-33"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#lab05-mcp-prompts-__codelineno-5-34"></a><span class="w">        </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#lab05-mcp-prompts-__codelineno-5-35"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#lab05-mcp-prompts-__codelineno-5-36"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello-prompt&quot;</span><span class="p">,</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#lab05-mcp-prompts-__codelineno-5-37"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A simple greeting prompt&quot;</span><span class="p">,</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#lab05-mcp-prompts-__codelineno-5-38"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#lab05-mcp-prompts-__codelineno-5-39"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#lab05-mcp-prompts-__codelineno-5-40"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="p">,</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#lab05-mcp-prompts-__codelineno-5-41"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Comprehensive code review with best practices&quot;</span><span class="p">,</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#lab05-mcp-prompts-__codelineno-5-42"></a><span class="w">            </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#lab05-mcp-prompts-__codelineno-5-43"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#lab05-mcp-prompts-__codelineno-5-44"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#lab05-mcp-prompts-__codelineno-5-45"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Programming language (e.g., typescript, python)&quot;</span><span class="p">,</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#lab05-mcp-prompts-__codelineno-5-46"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#lab05-mcp-prompts-__codelineno-5-47"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#lab05-mcp-prompts-__codelineno-5-48"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#lab05-mcp-prompts-__codelineno-5-49"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#lab05-mcp-prompts-__codelineno-5-50"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#lab05-mcp-prompts-__codelineno-5-51"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#lab05-mcp-prompts-__codelineno-5-52"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#lab05-mcp-prompts-__codelineno-5-53"></a>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#lab05-mcp-prompts-__codelineno-5-54"></a><span class="w">    </span><span class="c1">// Get specific prompt</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#lab05-mcp-prompts-__codelineno-5-55"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#lab05-mcp-prompts-__codelineno-5-56"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#lab05-mcp-prompts-__codelineno-5-57"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#lab05-mcp-prompts-__codelineno-5-58"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#lab05-mcp-prompts-__codelineno-5-59"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#lab05-mcp-prompts-__codelineno-5-60"></a>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#lab05-mcp-prompts-__codelineno-5-61"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#lab05-mcp-prompts-__codelineno-5-62"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#lab05-mcp-prompts-__codelineno-5-63"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;hello-prompt&quot;</span><span class="o">:</span>
</span><span id="__span-5-64"><a id="__codelineno-5-64" name="__codelineno-5-64" href="#lab05-mcp-prompts-__codelineno-5-64"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-65"><a id="__codelineno-5-65" name="__codelineno-5-65" href="#lab05-mcp-prompts-__codelineno-5-65"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A simple greeting prompt&quot;</span><span class="p">,</span>
</span><span id="__span-5-66"><a id="__codelineno-5-66" name="__codelineno-5-66" href="#lab05-mcp-prompts-__codelineno-5-66"></a><span class="w">          </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-67"><a id="__codelineno-5-67" name="__codelineno-5-67" href="#lab05-mcp-prompts-__codelineno-5-67"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-68"><a id="__codelineno-5-68" name="__codelineno-5-68" href="#lab05-mcp-prompts-__codelineno-5-68"></a><span class="w">              </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-5-69"><a id="__codelineno-5-69" name="__codelineno-5-69" href="#lab05-mcp-prompts-__codelineno-5-69"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-70"><a id="__codelineno-5-70" name="__codelineno-5-70" href="#lab05-mcp-prompts-__codelineno-5-70"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-5-71"><a id="__codelineno-5-71" name="__codelineno-5-71" href="#lab05-mcp-prompts-__codelineno-5-71"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hello! Please introduce yourself and explain what you can help me with today.&quot;</span><span class="p">,</span>
</span><span id="__span-5-72"><a id="__codelineno-5-72" name="__codelineno-5-72" href="#lab05-mcp-prompts-__codelineno-5-72"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-5-73"><a id="__codelineno-5-73" name="__codelineno-5-73" href="#lab05-mcp-prompts-__codelineno-5-73"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-74"><a id="__codelineno-5-74" name="__codelineno-5-74" href="#lab05-mcp-prompts-__codelineno-5-74"></a><span class="w">          </span><span class="p">],</span>
</span><span id="__span-5-75"><a id="__codelineno-5-75" name="__codelineno-5-75" href="#lab05-mcp-prompts-__codelineno-5-75"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-5-76"><a id="__codelineno-5-76" name="__codelineno-5-76" href="#lab05-mcp-prompts-__codelineno-5-76"></a>
</span><span id="__span-5-77"><a id="__codelineno-5-77" name="__codelineno-5-77" href="#lab05-mcp-prompts-__codelineno-5-77"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="o">:</span>
</span><span id="__span-5-78"><a id="__codelineno-5-78" name="__codelineno-5-78" href="#lab05-mcp-prompts-__codelineno-5-78"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;typescript&quot;</span><span class="p">;</span>
</span><span id="__span-5-79"><a id="__codelineno-5-79" name="__codelineno-5-79" href="#lab05-mcp-prompts-__codelineno-5-79"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-80"><a id="__codelineno-5-80" name="__codelineno-5-80" href="#lab05-mcp-prompts-__codelineno-5-80"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Code review for </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-5-81"><a id="__codelineno-5-81" name="__codelineno-5-81" href="#lab05-mcp-prompts-__codelineno-5-81"></a><span class="w">          </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-5-82"><a id="__codelineno-5-82" name="__codelineno-5-82" href="#lab05-mcp-prompts-__codelineno-5-82"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-5-83"><a id="__codelineno-5-83" name="__codelineno-5-83" href="#lab05-mcp-prompts-__codelineno-5-83"></a><span class="w">              </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-5-84"><a id="__codelineno-5-84" name="__codelineno-5-84" href="#lab05-mcp-prompts-__codelineno-5-84"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-85"><a id="__codelineno-5-85" name="__codelineno-5-85" href="#lab05-mcp-prompts-__codelineno-5-85"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-5-86"><a id="__codelineno-5-86" name="__codelineno-5-86" href="#lab05-mcp-prompts-__codelineno-5-86"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Please perform a comprehensive code review of the following </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> code. Focus on:</span>
</span><span id="__span-5-87"><a id="__codelineno-5-87" name="__codelineno-5-87" href="#lab05-mcp-prompts-__codelineno-5-87"></a>
</span><span id="__span-5-88"><a id="__codelineno-5-88" name="__codelineno-5-88" href="#lab05-mcp-prompts-__codelineno-5-88"></a><span class="sb">## Code Quality &amp; Best Practices</span>
</span><span id="__span-5-89"><a id="__codelineno-5-89" name="__codelineno-5-89" href="#lab05-mcp-prompts-__codelineno-5-89"></a><span class="sb">- **Readability**: Is the code easy to understand?</span>
</span><span id="__span-5-90"><a id="__codelineno-5-90" name="__codelineno-5-90" href="#lab05-mcp-prompts-__codelineno-5-90"></a><span class="sb">- **Maintainability**: How easy will this be to modify later?</span>
</span><span id="__span-5-91"><a id="__codelineno-5-91" name="__codelineno-5-91" href="#lab05-mcp-prompts-__codelineno-5-91"></a><span class="sb">- **Performance**: Are there any obvious performance issues?</span>
</span><span id="__span-5-92"><a id="__codelineno-5-92" name="__codelineno-5-92" href="#lab05-mcp-prompts-__codelineno-5-92"></a><span class="sb">- **Error Handling**: Are errors handled appropriately?</span>
</span><span id="__span-5-93"><a id="__codelineno-5-93" name="__codelineno-5-93" href="#lab05-mcp-prompts-__codelineno-5-93"></a>
</span><span id="__span-5-94"><a id="__codelineno-5-94" name="__codelineno-5-94" href="#lab05-mcp-prompts-__codelineno-5-94"></a><span class="sb">## </span><span class="si">${</span><span class="nx">language</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">-Specific Checks</span>
</span><span id="__span-5-95"><a id="__codelineno-5-95" name="__codelineno-5-95" href="#lab05-mcp-prompts-__codelineno-5-95"></a><span class="sb">- Follow </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> conventions and best practices</span>
</span><span id="__span-5-96"><a id="__codelineno-5-96" name="__codelineno-5-96" href="#lab05-mcp-prompts-__codelineno-5-96"></a><span class="sb">- Use appropriate design patterns</span>
</span><span id="__span-5-97"><a id="__codelineno-5-97" name="__codelineno-5-97" href="#lab05-mcp-prompts-__codelineno-5-97"></a><span class="sb">- Ensure proper type safety (if applicable)</span>
</span><span id="__span-5-98"><a id="__codelineno-5-98" name="__codelineno-5-98" href="#lab05-mcp-prompts-__codelineno-5-98"></a>
</span><span id="__span-5-99"><a id="__codelineno-5-99" name="__codelineno-5-99" href="#lab05-mcp-prompts-__codelineno-5-99"></a><span class="sb">Please provide specific, actionable feedback with examples where possible.`</span><span class="p">,</span>
</span><span id="__span-5-100"><a id="__codelineno-5-100" name="__codelineno-5-100" href="#lab05-mcp-prompts-__codelineno-5-100"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-5-101"><a id="__codelineno-5-101" name="__codelineno-5-101" href="#lab05-mcp-prompts-__codelineno-5-101"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-5-102"><a id="__codelineno-5-102" name="__codelineno-5-102" href="#lab05-mcp-prompts-__codelineno-5-102"></a><span class="w">          </span><span class="p">],</span>
</span><span id="__span-5-103"><a id="__codelineno-5-103" name="__codelineno-5-103" href="#lab05-mcp-prompts-__codelineno-5-103"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-5-104"><a id="__codelineno-5-104" name="__codelineno-5-104" href="#lab05-mcp-prompts-__codelineno-5-104"></a>
</span><span id="__span-5-105"><a id="__codelineno-5-105" name="__codelineno-5-105" href="#lab05-mcp-prompts-__codelineno-5-105"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-5-106"><a id="__codelineno-5-106" name="__codelineno-5-106" href="#lab05-mcp-prompts-__codelineno-5-106"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown prompt: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-5-107"><a id="__codelineno-5-107" name="__codelineno-5-107" href="#lab05-mcp-prompts-__codelineno-5-107"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-5-108"><a id="__codelineno-5-108" name="__codelineno-5-108" href="#lab05-mcp-prompts-__codelineno-5-108"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-109"><a id="__codelineno-5-109" name="__codelineno-5-109" href="#lab05-mcp-prompts-__codelineno-5-109"></a>
</span><span id="__span-5-110"><a id="__codelineno-5-110" name="__codelineno-5-110" href="#lab05-mcp-prompts-__codelineno-5-110"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-111"><a id="__codelineno-5-111" name="__codelineno-5-111" href="#lab05-mcp-prompts-__codelineno-5-111"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-112"><a id="__codelineno-5-112" name="__codelineno-5-112" href="#lab05-mcp-prompts-__codelineno-5-112"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-5-113"><a id="__codelineno-5-113" name="__codelineno-5-113" href="#lab05-mcp-prompts-__codelineno-5-113"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-5-114"><a id="__codelineno-5-114" name="__codelineno-5-114" href="#lab05-mcp-prompts-__codelineno-5-114"></a>
</span><span id="__span-5-115"><a id="__codelineno-5-115" name="__codelineno-5-115" href="#lab05-mcp-prompts-__codelineno-5-115"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-116"><a id="__codelineno-5-116" name="__codelineno-5-116" href="#lab05-mcp-prompts-__codelineno-5-116"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-5-117"><a id="__codelineno-5-117" name="__codelineno-5-117" href="#lab05-mcp-prompts-__codelineno-5-117"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-5-118"><a id="__codelineno-5-118" name="__codelineno-5-118" href="#lab05-mcp-prompts-__codelineno-5-118"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-5-119"><a id="__codelineno-5-119" name="__codelineno-5-119" href="#lab05-mcp-prompts-__codelineno-5-119"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-120"><a id="__codelineno-5-120" name="__codelineno-5-120" href="#lab05-mcp-prompts-__codelineno-5-120"></a>
</span><span id="__span-5-121"><a id="__codelineno-5-121" name="__codelineno-5-121" href="#lab05-mcp-prompts-__codelineno-5-121"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-122"><a id="__codelineno-5-122" name="__codelineno-5-122" href="#lab05-mcp-prompts-__codelineno-5-122"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-5-123"><a id="__codelineno-5-123" name="__codelineno-5-123" href="#lab05-mcp-prompts-__codelineno-5-123"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-5-124"><a id="__codelineno-5-124" name="__codelineno-5-124" href="#lab05-mcp-prompts-__codelineno-5-124"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Prompt Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-5-125"><a id="__codelineno-5-125" name="__codelineno-5-125" href="#lab05-mcp-prompts-__codelineno-5-125"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-126"><a id="__codelineno-5-126" name="__codelineno-5-126" href="#lab05-mcp-prompts-__codelineno-5-126"></a><span class="p">}</span>
</span><span id="__span-5-127"><a id="__codelineno-5-127" name="__codelineno-5-127" href="#lab05-mcp-prompts-__codelineno-5-127"></a>
</span><span id="__span-5-128"><a id="__codelineno-5-128" name="__codelineno-5-128" href="#lab05-mcp-prompts-__codelineno-5-128"></a><span class="c1">// Main entry point</span>
</span><span id="__span-5-129"><a id="__codelineno-5-129" name="__codelineno-5-129" href="#lab05-mcp-prompts-__codelineno-5-129"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-130"><a id="__codelineno-5-130" name="__codelineno-5-130" href="#lab05-mcp-prompts-__codelineno-5-130"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PromptServer</span><span class="p">();</span>
</span><span id="__span-5-131"><a id="__codelineno-5-131" name="__codelineno-5-131" href="#lab05-mcp-prompts-__codelineno-5-131"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-5-132"><a id="__codelineno-5-132" name="__codelineno-5-132" href="#lab05-mcp-prompts-__codelineno-5-132"></a><span class="p">}</span>
</span><span id="__span-5-133"><a id="__codelineno-5-133" name="__codelineno-5-133" href="#lab05-mcp-prompts-__codelineno-5-133"></a>
</span><span id="__span-5-134"><a id="__codelineno-5-134" name="__codelineno-5-134" href="#lab05-mcp-prompts-__codelineno-5-134"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-135"><a id="__codelineno-5-135" name="__codelineno-5-135" href="#lab05-mcp-prompts-__codelineno-5-135"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-5-136"><a id="__codelineno-5-136" name="__codelineno-5-136" href="#lab05-mcp-prompts-__codelineno-5-136"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-5-137"><a id="__codelineno-5-137" name="__codelineno-5-137" href="#lab05-mcp-prompts-__codelineno-5-137"></a><span class="p">});</span>
</span></code></pre></div>
<hr />
<h3 id="lab05-mcp-prompts-step-2-test-your-server">Step 2: Test Your Server<a class="headerlink" href="#lab05-mcp-prompts-step-2-test-your-server" title="Permanent link">&para;</a></h3>
<p><strong>Build and run the server:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab05-mcp-prompts-__codelineno-6-1"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab05-mcp-prompts-__codelineno-6-2"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>dist/index.js
</span></code></pre></div>
<p>The MCP Inspector will launch a web interface.</p>
<p><br></p>
<p><strong>Test the prompts in the MCP Inspector UI:</strong></p>
<ol>
<li>
<p><strong>List prompts</strong>: Click the &ldquo;Prompts&rdquo; tab, then click &ldquo;List Prompts&rdquo; to see your two prompts (&ldquo;hello-prompt&rdquo; and &ldquo;code-review&rdquo;).</p>
</li>
<li>
<p><strong>Get hello-prompt</strong>: In the same section, select &ldquo;Get Prompt&rdquo;, enter &ldquo;hello-prompt&rdquo; as the name, and submit to see the greeting prompt content.</p>
</li>
<li>
<p><strong>Get code-review</strong>: Select &ldquo;Get Prompt&rdquo;, enter &ldquo;code-review&rdquo; as the name, and optionally provide arguments like {&ldquo;language&rdquo;: &ldquo;typescript&rdquo;} in the arguments field, then submit to see the code review prompt.</p>
</li>
</ol>
<hr />
<h3 id="lab05-mcp-prompts-step-3-adding-arguments-and-validation">Step 3: Adding Arguments and Validation<a class="headerlink" href="#lab05-mcp-prompts-step-3-adding-arguments-and-validation" title="Permanent link">&para;</a></h3>
<p>Let&rsquo;s enhance our server with better argument handling. Update your existing <code>src/index.ts</code> file to add more arguments to the code-review prompt and include helper methods for dynamic content generation.</p>
<p><strong>Update the code-review prompt definition in the <code>ListPromptsRequestSchema</code> handler:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab05-mcp-prompts-__codelineno-7-1"></a><span class="c1">// Update the code-review prompt definition</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab05-mcp-prompts-__codelineno-7-2"></a><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#lab05-mcp-prompts-__codelineno-7-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#lab05-mcp-prompts-__codelineno-7-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Comprehensive code review with best practices&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#lab05-mcp-prompts-__codelineno-7-5"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#lab05-mcp-prompts-__codelineno-7-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#lab05-mcp-prompts-__codelineno-7-7"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#lab05-mcp-prompts-__codelineno-7-8"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Programming language (e.g., typescript, python, java)&quot;</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#lab05-mcp-prompts-__codelineno-7-9"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#lab05-mcp-prompts-__codelineno-7-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#lab05-mcp-prompts-__codelineno-7-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#lab05-mcp-prompts-__codelineno-7-12"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;complexity&quot;</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#lab05-mcp-prompts-__codelineno-7-13"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Code complexity level (beginner, intermediate, advanced)&quot;</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#lab05-mcp-prompts-__codelineno-7-14"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#lab05-mcp-prompts-__codelineno-7-15"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#lab05-mcp-prompts-__codelineno-7-16"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#lab05-mcp-prompts-__codelineno-7-17"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;focus&quot;</span><span class="p">,</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#lab05-mcp-prompts-__codelineno-7-18"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Review focus areas (comma-separated: quality,security,performance)&quot;</span><span class="p">,</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#lab05-mcp-prompts-__codelineno-7-19"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#lab05-mcp-prompts-__codelineno-7-20"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#lab05-mcp-prompts-__codelineno-7-21"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#lab05-mcp-prompts-__codelineno-7-22"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Update the prompt generation:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab05-mcp-prompts-__codelineno-8-1"></a><span class="k">case</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="o">:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#lab05-mcp-prompts-__codelineno-8-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;typescript&quot;</span><span class="p">;</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#lab05-mcp-prompts-__codelineno-8-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">complexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">complexity</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;intermediate&quot;</span><span class="p">;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#lab05-mcp-prompts-__codelineno-8-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">focus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">focus</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;quality&quot;</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#lab05-mcp-prompts-__codelineno-8-5"></a>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#lab05-mcp-prompts-__codelineno-8-6"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#lab05-mcp-prompts-__codelineno-8-7"></a><span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Code review for </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">complexity</span><span class="si">}</span><span class="sb"> level, focus: </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#lab05-mcp-prompts-__codelineno-8-8"></a><span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#lab05-mcp-prompts-__codelineno-8-9"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#lab05-mcp-prompts-__codelineno-8-10"></a><span class="w">        </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#lab05-mcp-prompts-__codelineno-8-11"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#lab05-mcp-prompts-__codelineno-8-12"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#lab05-mcp-prompts-__codelineno-8-13"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Please perform a comprehensive code review of the following </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> code.</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#lab05-mcp-prompts-__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#lab05-mcp-prompts-__codelineno-8-15"></a><span class="sb">**Complexity Level:** </span><span class="si">${</span><span class="nx">complexity</span><span class="si">}</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#lab05-mcp-prompts-__codelineno-8-16"></a><span class="sb">**Focus Areas:** </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#lab05-mcp-prompts-__codelineno-8-17"></a>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#lab05-mcp-prompts-__codelineno-8-18"></a><span class="sb">## Review Guidelines</span>
</span><span id="__span-8-19"><a id="__codelineno-8-19" name="__codelineno-8-19" href="#lab05-mcp-prompts-__codelineno-8-19"></a>
</span><span id="__span-8-20"><a id="__codelineno-8-20" name="__codelineno-8-20" href="#lab05-mcp-prompts-__codelineno-8-20"></a><span class="sb">### Code Quality &amp; Best Practices</span>
</span><span id="__span-8-21"><a id="__codelineno-8-21" name="__codelineno-8-21" href="#lab05-mcp-prompts-__codelineno-8-21"></a><span class="sb">- **Readability**: Is the code easy to understand?</span>
</span><span id="__span-8-22"><a id="__codelineno-8-22" name="__codelineno-8-22" href="#lab05-mcp-prompts-__codelineno-8-22"></a><span class="sb">- **Maintainability**: How easy will this be to modify later?</span>
</span><span id="__span-8-23"><a id="__codelineno-8-23" name="__codelineno-8-23" href="#lab05-mcp-prompts-__codelineno-8-23"></a><span class="sb">- **Performance**: Are there any obvious performance issues?</span>
</span><span id="__span-8-24"><a id="__codelineno-8-24" name="__codelineno-8-24" href="#lab05-mcp-prompts-__codelineno-8-24"></a>
</span><span id="__span-8-25"><a id="__codelineno-8-25" name="__codelineno-8-25" href="#lab05-mcp-prompts-__codelineno-8-25"></a><span class="sb">### </span><span class="si">${</span><span class="nx">complexity</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">complexity</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="si">}</span><span class="sb"> Level Expectations</span>
</span><span id="__span-8-26"><a id="__codelineno-8-26" name="__codelineno-8-26" href="#lab05-mcp-prompts-__codelineno-8-26"></a><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getComplexityExpectations</span><span class="p">(</span><span class="nx">complexity</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-8-27"><a id="__codelineno-8-27" name="__codelineno-8-27" href="#lab05-mcp-prompts-__codelineno-8-27"></a>
</span><span id="__span-8-28"><a id="__codelineno-8-28" name="__codelineno-8-28" href="#lab05-mcp-prompts-__codelineno-8-28"></a><span class="sb">### Focus Area: </span><span class="si">${</span><span class="nx">focus</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span>
</span><span id="__span-8-29"><a id="__codelineno-8-29" name="__codelineno-8-29" href="#lab05-mcp-prompts-__codelineno-8-29"></a><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getFocusAreaGuidance</span><span class="p">(</span><span class="nx">focus</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-8-30"><a id="__codelineno-8-30" name="__codelineno-8-30" href="#lab05-mcp-prompts-__codelineno-8-30"></a>
</span><span id="__span-8-31"><a id="__codelineno-8-31" name="__codelineno-8-31" href="#lab05-mcp-prompts-__codelineno-8-31"></a><span class="sb">Please provide specific, actionable feedback with examples where possible.`</span><span class="p">,</span>
</span><span id="__span-8-32"><a id="__codelineno-8-32" name="__codelineno-8-32" href="#lab05-mcp-prompts-__codelineno-8-32"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-8-33"><a id="__codelineno-8-33" name="__codelineno-8-33" href="#lab05-mcp-prompts-__codelineno-8-33"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-8-34"><a id="__codelineno-8-34" name="__codelineno-8-34" href="#lab05-mcp-prompts-__codelineno-8-34"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-8-35"><a id="__codelineno-8-35" name="__codelineno-8-35" href="#lab05-mcp-prompts-__codelineno-8-35"></a><span class="w">  </span><span class="p">};</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add helper methods:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab05-mcp-prompts-__codelineno-9-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">getComplexityExpectations</span><span class="p">(</span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#lab05-mcp-prompts-__codelineno-9-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">expectations</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#lab05-mcp-prompts-__codelineno-9-3"></a><span class="w">    </span><span class="nx">beginner</span><span class="o">:</span><span class="w"> </span><span class="sb">`- Clear, self-documenting code\n- Basic error handling\n- Simple, understandable logic`</span><span class="p">,</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#lab05-mcp-prompts-__codelineno-9-4"></a><span class="w">    </span><span class="nx">intermediate</span><span class="o">:</span><span class="w"> </span><span class="sb">`- Good separation of concerns\n- Comprehensive error handling\n- Appropriate design patterns\n- Unit test coverage`</span><span class="p">,</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#lab05-mcp-prompts-__codelineno-9-5"></a><span class="w">    </span><span class="nx">advanced</span><span class="o">:</span><span class="w"> </span><span class="sb">`- High performance and scalability\n- Complex architectural patterns\n- Extensive testing (unit, integration, e2e)\n- Advanced optimization techniques`</span><span class="p">,</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#lab05-mcp-prompts-__codelineno-9-6"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#lab05-mcp-prompts-__codelineno-9-7"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">expectations</span><span class="p">[</span><span class="nx">level</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;- Standard coding practices&quot;</span><span class="p">;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#lab05-mcp-prompts-__codelineno-9-8"></a><span class="p">}</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#lab05-mcp-prompts-__codelineno-9-9"></a>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#lab05-mcp-prompts-__codelineno-9-10"></a><span class="k">private</span><span class="w"> </span><span class="nx">getFocusAreaGuidance</span><span class="p">(</span><span class="nx">focus</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#lab05-mcp-prompts-__codelineno-9-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">guidance</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#lab05-mcp-prompts-__codelineno-9-12"></a><span class="w">    </span><span class="nx">quality</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Code Quality Focus:**</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#lab05-mcp-prompts-__codelineno-9-13"></a><span class="sb">- Code readability and maintainability</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#lab05-mcp-prompts-__codelineno-9-14"></a><span class="sb">- Consistent naming conventions</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#lab05-mcp-prompts-__codelineno-9-15"></a><span class="sb">- Proper code organization</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#lab05-mcp-prompts-__codelineno-9-16"></a><span class="sb">- Documentation quality`</span><span class="p">,</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#lab05-mcp-prompts-__codelineno-9-17"></a><span class="w">    </span><span class="nx">security</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Security Focus:**</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#lab05-mcp-prompts-__codelineno-9-18"></a><span class="sb">- Input validation and sanitization</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#lab05-mcp-prompts-__codelineno-9-19"></a><span class="sb">- Authentication and authorization</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#lab05-mcp-prompts-__codelineno-9-20"></a><span class="sb">- Data protection practices</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#lab05-mcp-prompts-__codelineno-9-21"></a><span class="sb">- Common vulnerability patterns`</span><span class="p">,</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#lab05-mcp-prompts-__codelineno-9-22"></a><span class="w">    </span><span class="nx">performance</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Performance Focus:**</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#lab05-mcp-prompts-__codelineno-9-23"></a><span class="sb">- Algorithm efficiency</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#lab05-mcp-prompts-__codelineno-9-24"></a><span class="sb">- Memory usage optimization</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#lab05-mcp-prompts-__codelineno-9-25"></a><span class="sb">- Database query optimization</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#lab05-mcp-prompts-__codelineno-9-26"></a><span class="sb">- Caching strategies`</span><span class="p">,</span>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#lab05-mcp-prompts-__codelineno-9-27"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#lab05-mcp-prompts-__codelineno-9-28"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">guidance</span><span class="p">[</span><span class="nx">focus</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;- General best practices&quot;</span><span class="p">;</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#lab05-mcp-prompts-__codelineno-9-29"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p>Here&rsquo;s the complete updated <code>src/index.ts</code> with all the above enhancements, just for review purposes:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab05-mcp-prompts-__codelineno-10-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#lab05-mcp-prompts-__codelineno-10-2"></a>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#lab05-mcp-prompts-__codelineno-10-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#lab05-mcp-prompts-__codelineno-10-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#lab05-mcp-prompts-__codelineno-10-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#lab05-mcp-prompts-__codelineno-10-6"></a><span class="w">  </span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#lab05-mcp-prompts-__codelineno-10-7"></a><span class="w">  </span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#lab05-mcp-prompts-__codelineno-10-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#lab05-mcp-prompts-__codelineno-10-9"></a>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#lab05-mcp-prompts-__codelineno-10-10"></a><span class="kd">class</span><span class="w"> </span><span class="nx">PromptServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#lab05-mcp-prompts-__codelineno-10-11"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#lab05-mcp-prompts-__codelineno-10-12"></a>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#lab05-mcp-prompts-__codelineno-10-13"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#lab05-mcp-prompts-__codelineno-10-14"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#lab05-mcp-prompts-__codelineno-10-15"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#lab05-mcp-prompts-__codelineno-10-16"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;mcp-prompts-server&quot;</span><span class="p">,</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#lab05-mcp-prompts-__codelineno-10-17"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#lab05-mcp-prompts-__codelineno-10-18"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#lab05-mcp-prompts-__codelineno-10-19"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#lab05-mcp-prompts-__codelineno-10-20"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#lab05-mcp-prompts-__codelineno-10-21"></a><span class="w">          </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#lab05-mcp-prompts-__codelineno-10-22"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#lab05-mcp-prompts-__codelineno-10-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#lab05-mcp-prompts-__codelineno-10-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#lab05-mcp-prompts-__codelineno-10-25"></a>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#lab05-mcp-prompts-__codelineno-10-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#lab05-mcp-prompts-__codelineno-10-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#lab05-mcp-prompts-__codelineno-10-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#lab05-mcp-prompts-__codelineno-10-29"></a>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#lab05-mcp-prompts-__codelineno-10-30"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#lab05-mcp-prompts-__codelineno-10-31"></a><span class="w">    </span><span class="c1">// List available prompts</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#lab05-mcp-prompts-__codelineno-10-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#lab05-mcp-prompts-__codelineno-10-33"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#lab05-mcp-prompts-__codelineno-10-34"></a><span class="w">        </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#lab05-mcp-prompts-__codelineno-10-35"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#lab05-mcp-prompts-__codelineno-10-36"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello-prompt&quot;</span><span class="p">,</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#lab05-mcp-prompts-__codelineno-10-37"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A simple greeting prompt&quot;</span><span class="p">,</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#lab05-mcp-prompts-__codelineno-10-38"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#lab05-mcp-prompts-__codelineno-10-39"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#lab05-mcp-prompts-__codelineno-10-40"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="p">,</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#lab05-mcp-prompts-__codelineno-10-41"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Comprehensive code review with best practices&quot;</span><span class="p">,</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#lab05-mcp-prompts-__codelineno-10-42"></a><span class="w">            </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#lab05-mcp-prompts-__codelineno-10-43"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#lab05-mcp-prompts-__codelineno-10-44"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#lab05-mcp-prompts-__codelineno-10-45"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Programming language (e.g., typescript, python, java)&quot;</span><span class="p">,</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#lab05-mcp-prompts-__codelineno-10-46"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#lab05-mcp-prompts-__codelineno-10-47"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#lab05-mcp-prompts-__codelineno-10-48"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-10-49"><a id="__codelineno-10-49" name="__codelineno-10-49" href="#lab05-mcp-prompts-__codelineno-10-49"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;complexity&quot;</span><span class="p">,</span>
</span><span id="__span-10-50"><a id="__codelineno-10-50" name="__codelineno-10-50" href="#lab05-mcp-prompts-__codelineno-10-50"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Code complexity level (beginner, intermediate, advanced)&quot;</span><span class="p">,</span>
</span><span id="__span-10-51"><a id="__codelineno-10-51" name="__codelineno-10-51" href="#lab05-mcp-prompts-__codelineno-10-51"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-10-52"><a id="__codelineno-10-52" name="__codelineno-10-52" href="#lab05-mcp-prompts-__codelineno-10-52"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-10-53"><a id="__codelineno-10-53" name="__codelineno-10-53" href="#lab05-mcp-prompts-__codelineno-10-53"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-10-54"><a id="__codelineno-10-54" name="__codelineno-10-54" href="#lab05-mcp-prompts-__codelineno-10-54"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;focus&quot;</span><span class="p">,</span>
</span><span id="__span-10-55"><a id="__codelineno-10-55" name="__codelineno-10-55" href="#lab05-mcp-prompts-__codelineno-10-55"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Review focus areas (comma-separated: quality,security,performance)&quot;</span><span class="p">,</span>
</span><span id="__span-10-56"><a id="__codelineno-10-56" name="__codelineno-10-56" href="#lab05-mcp-prompts-__codelineno-10-56"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-10-57"><a id="__codelineno-10-57" name="__codelineno-10-57" href="#lab05-mcp-prompts-__codelineno-10-57"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-10-58"><a id="__codelineno-10-58" name="__codelineno-10-58" href="#lab05-mcp-prompts-__codelineno-10-58"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-10-59"><a id="__codelineno-10-59" name="__codelineno-10-59" href="#lab05-mcp-prompts-__codelineno-10-59"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-10-60"><a id="__codelineno-10-60" name="__codelineno-10-60" href="#lab05-mcp-prompts-__codelineno-10-60"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-10-61"><a id="__codelineno-10-61" name="__codelineno-10-61" href="#lab05-mcp-prompts-__codelineno-10-61"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-10-62"><a id="__codelineno-10-62" name="__codelineno-10-62" href="#lab05-mcp-prompts-__codelineno-10-62"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-10-63"><a id="__codelineno-10-63" name="__codelineno-10-63" href="#lab05-mcp-prompts-__codelineno-10-63"></a>
</span><span id="__span-10-64"><a id="__codelineno-10-64" name="__codelineno-10-64" href="#lab05-mcp-prompts-__codelineno-10-64"></a><span class="w">    </span><span class="c1">// Get specific prompt</span>
</span><span id="__span-10-65"><a id="__codelineno-10-65" name="__codelineno-10-65" href="#lab05-mcp-prompts-__codelineno-10-65"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-66"><a id="__codelineno-10-66" name="__codelineno-10-66" href="#lab05-mcp-prompts-__codelineno-10-66"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-10-67"><a id="__codelineno-10-67" name="__codelineno-10-67" href="#lab05-mcp-prompts-__codelineno-10-67"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-10-68"><a id="__codelineno-10-68" name="__codelineno-10-68" href="#lab05-mcp-prompts-__codelineno-10-68"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-10-69"><a id="__codelineno-10-69" name="__codelineno-10-69" href="#lab05-mcp-prompts-__codelineno-10-69"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-70"><a id="__codelineno-10-70" name="__codelineno-10-70" href="#lab05-mcp-prompts-__codelineno-10-70"></a>
</span><span id="__span-10-71"><a id="__codelineno-10-71" name="__codelineno-10-71" href="#lab05-mcp-prompts-__codelineno-10-71"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-72"><a id="__codelineno-10-72" name="__codelineno-10-72" href="#lab05-mcp-prompts-__codelineno-10-72"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-73"><a id="__codelineno-10-73" name="__codelineno-10-73" href="#lab05-mcp-prompts-__codelineno-10-73"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;hello-prompt&quot;</span><span class="o">:</span>
</span><span id="__span-10-74"><a id="__codelineno-10-74" name="__codelineno-10-74" href="#lab05-mcp-prompts-__codelineno-10-74"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-75"><a id="__codelineno-10-75" name="__codelineno-10-75" href="#lab05-mcp-prompts-__codelineno-10-75"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;A simple greeting prompt&quot;</span><span class="p">,</span>
</span><span id="__span-10-76"><a id="__codelineno-10-76" name="__codelineno-10-76" href="#lab05-mcp-prompts-__codelineno-10-76"></a><span class="w">          </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-77"><a id="__codelineno-10-77" name="__codelineno-10-77" href="#lab05-mcp-prompts-__codelineno-10-77"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-10-78"><a id="__codelineno-10-78" name="__codelineno-10-78" href="#lab05-mcp-prompts-__codelineno-10-78"></a><span class="w">              </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-10-79"><a id="__codelineno-10-79" name="__codelineno-10-79" href="#lab05-mcp-prompts-__codelineno-10-79"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-80"><a id="__codelineno-10-80" name="__codelineno-10-80" href="#lab05-mcp-prompts-__codelineno-10-80"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-10-81"><a id="__codelineno-10-81" name="__codelineno-10-81" href="#lab05-mcp-prompts-__codelineno-10-81"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Hello! Please introduce yourself and explain what you can help me with today.&quot;</span><span class="p">,</span>
</span><span id="__span-10-82"><a id="__codelineno-10-82" name="__codelineno-10-82" href="#lab05-mcp-prompts-__codelineno-10-82"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-10-83"><a id="__codelineno-10-83" name="__codelineno-10-83" href="#lab05-mcp-prompts-__codelineno-10-83"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-10-84"><a id="__codelineno-10-84" name="__codelineno-10-84" href="#lab05-mcp-prompts-__codelineno-10-84"></a><span class="w">          </span><span class="p">],</span>
</span><span id="__span-10-85"><a id="__codelineno-10-85" name="__codelineno-10-85" href="#lab05-mcp-prompts-__codelineno-10-85"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-10-86"><a id="__codelineno-10-86" name="__codelineno-10-86" href="#lab05-mcp-prompts-__codelineno-10-86"></a>
</span><span id="__span-10-87"><a id="__codelineno-10-87" name="__codelineno-10-87" href="#lab05-mcp-prompts-__codelineno-10-87"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="o">:</span>
</span><span id="__span-10-88"><a id="__codelineno-10-88" name="__codelineno-10-88" href="#lab05-mcp-prompts-__codelineno-10-88"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;typescript&quot;</span><span class="p">;</span>
</span><span id="__span-10-89"><a id="__codelineno-10-89" name="__codelineno-10-89" href="#lab05-mcp-prompts-__codelineno-10-89"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">complexity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">complexity</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;intermediate&quot;</span><span class="p">;</span>
</span><span id="__span-10-90"><a id="__codelineno-10-90" name="__codelineno-10-90" href="#lab05-mcp-prompts-__codelineno-10-90"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">focus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">focus</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;quality&quot;</span><span class="p">;</span>
</span><span id="__span-10-91"><a id="__codelineno-10-91" name="__codelineno-10-91" href="#lab05-mcp-prompts-__codelineno-10-91"></a>
</span><span id="__span-10-92"><a id="__codelineno-10-92" name="__codelineno-10-92" href="#lab05-mcp-prompts-__codelineno-10-92"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-93"><a id="__codelineno-10-93" name="__codelineno-10-93" href="#lab05-mcp-prompts-__codelineno-10-93"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Code review for </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> (</span><span class="si">${</span><span class="nx">complexity</span><span class="si">}</span><span class="sb"> level, focus: </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span><span class="sb">)`</span><span class="p">,</span>
</span><span id="__span-10-94"><a id="__codelineno-10-94" name="__codelineno-10-94" href="#lab05-mcp-prompts-__codelineno-10-94"></a><span class="w">          </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-95"><a id="__codelineno-10-95" name="__codelineno-10-95" href="#lab05-mcp-prompts-__codelineno-10-95"></a><span class="w">            </span><span class="p">{</span>
</span><span id="__span-10-96"><a id="__codelineno-10-96" name="__codelineno-10-96" href="#lab05-mcp-prompts-__codelineno-10-96"></a><span class="w">              </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-10-97"><a id="__codelineno-10-97" name="__codelineno-10-97" href="#lab05-mcp-prompts-__codelineno-10-97"></a><span class="w">              </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-98"><a id="__codelineno-10-98" name="__codelineno-10-98" href="#lab05-mcp-prompts-__codelineno-10-98"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-10-99"><a id="__codelineno-10-99" name="__codelineno-10-99" href="#lab05-mcp-prompts-__codelineno-10-99"></a><span class="w">                </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Please perform a comprehensive code review of the following </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> code.</span>
</span><span id="__span-10-100"><a id="__codelineno-10-100" name="__codelineno-10-100" href="#lab05-mcp-prompts-__codelineno-10-100"></a>
</span><span id="__span-10-101"><a id="__codelineno-10-101" name="__codelineno-10-101" href="#lab05-mcp-prompts-__codelineno-10-101"></a><span class="sb">**Complexity Level:** </span><span class="si">${</span><span class="nx">complexity</span><span class="si">}</span>
</span><span id="__span-10-102"><a id="__codelineno-10-102" name="__codelineno-10-102" href="#lab05-mcp-prompts-__codelineno-10-102"></a><span class="sb">**Focus Areas:** </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span>
</span><span id="__span-10-103"><a id="__codelineno-10-103" name="__codelineno-10-103" href="#lab05-mcp-prompts-__codelineno-10-103"></a>
</span><span id="__span-10-104"><a id="__codelineno-10-104" name="__codelineno-10-104" href="#lab05-mcp-prompts-__codelineno-10-104"></a><span class="sb">## Review Guidelines</span>
</span><span id="__span-10-105"><a id="__codelineno-10-105" name="__codelineno-10-105" href="#lab05-mcp-prompts-__codelineno-10-105"></a>
</span><span id="__span-10-106"><a id="__codelineno-10-106" name="__codelineno-10-106" href="#lab05-mcp-prompts-__codelineno-10-106"></a><span class="sb">### Code Quality &amp; Best Practices</span>
</span><span id="__span-10-107"><a id="__codelineno-10-107" name="__codelineno-10-107" href="#lab05-mcp-prompts-__codelineno-10-107"></a><span class="sb">- **Readability**: Is the code easy to understand?</span>
</span><span id="__span-10-108"><a id="__codelineno-10-108" name="__codelineno-10-108" href="#lab05-mcp-prompts-__codelineno-10-108"></a><span class="sb">- **Maintainability**: How easy will this be to modify later?</span>
</span><span id="__span-10-109"><a id="__codelineno-10-109" name="__codelineno-10-109" href="#lab05-mcp-prompts-__codelineno-10-109"></a><span class="sb">- **Performance**: Are there any obvious performance issues?</span>
</span><span id="__span-10-110"><a id="__codelineno-10-110" name="__codelineno-10-110" href="#lab05-mcp-prompts-__codelineno-10-110"></a>
</span><span id="__span-10-111"><a id="__codelineno-10-111" name="__codelineno-10-111" href="#lab05-mcp-prompts-__codelineno-10-111"></a><span class="sb">### </span><span class="si">${</span><span class="nx">complexity</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">complexity</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="si">}</span><span class="sb"> Level Expectations</span>
</span><span id="__span-10-112"><a id="__codelineno-10-112" name="__codelineno-10-112" href="#lab05-mcp-prompts-__codelineno-10-112"></a><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getComplexityExpectations</span><span class="p">(</span><span class="nx">complexity</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-10-113"><a id="__codelineno-10-113" name="__codelineno-10-113" href="#lab05-mcp-prompts-__codelineno-10-113"></a>
</span><span id="__span-10-114"><a id="__codelineno-10-114" name="__codelineno-10-114" href="#lab05-mcp-prompts-__codelineno-10-114"></a><span class="sb">### Focus Area: </span><span class="si">${</span><span class="nx">focus</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span>
</span><span id="__span-10-115"><a id="__codelineno-10-115" name="__codelineno-10-115" href="#lab05-mcp-prompts-__codelineno-10-115"></a><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getFocusAreaGuidance</span><span class="p">(</span><span class="nx">focus</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-10-116"><a id="__codelineno-10-116" name="__codelineno-10-116" href="#lab05-mcp-prompts-__codelineno-10-116"></a>
</span><span id="__span-10-117"><a id="__codelineno-10-117" name="__codelineno-10-117" href="#lab05-mcp-prompts-__codelineno-10-117"></a><span class="sb">Please provide specific, actionable feedback with examples where possible.`</span><span class="p">,</span>
</span><span id="__span-10-118"><a id="__codelineno-10-118" name="__codelineno-10-118" href="#lab05-mcp-prompts-__codelineno-10-118"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-10-119"><a id="__codelineno-10-119" name="__codelineno-10-119" href="#lab05-mcp-prompts-__codelineno-10-119"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-10-120"><a id="__codelineno-10-120" name="__codelineno-10-120" href="#lab05-mcp-prompts-__codelineno-10-120"></a><span class="w">          </span><span class="p">],</span>
</span><span id="__span-10-121"><a id="__codelineno-10-121" name="__codelineno-10-121" href="#lab05-mcp-prompts-__codelineno-10-121"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-10-122"><a id="__codelineno-10-122" name="__codelineno-10-122" href="#lab05-mcp-prompts-__codelineno-10-122"></a>
</span><span id="__span-10-123"><a id="__codelineno-10-123" name="__codelineno-10-123" href="#lab05-mcp-prompts-__codelineno-10-123"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-10-124"><a id="__codelineno-10-124" name="__codelineno-10-124" href="#lab05-mcp-prompts-__codelineno-10-124"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown prompt: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-125"><a id="__codelineno-10-125" name="__codelineno-10-125" href="#lab05-mcp-prompts-__codelineno-10-125"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-126"><a id="__codelineno-10-126" name="__codelineno-10-126" href="#lab05-mcp-prompts-__codelineno-10-126"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-127"><a id="__codelineno-10-127" name="__codelineno-10-127" href="#lab05-mcp-prompts-__codelineno-10-127"></a>
</span><span id="__span-10-128"><a id="__codelineno-10-128" name="__codelineno-10-128" href="#lab05-mcp-prompts-__codelineno-10-128"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getComplexityExpectations</span><span class="p">(</span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-129"><a id="__codelineno-10-129" name="__codelineno-10-129" href="#lab05-mcp-prompts-__codelineno-10-129"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">expectations</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-130"><a id="__codelineno-10-130" name="__codelineno-10-130" href="#lab05-mcp-prompts-__codelineno-10-130"></a><span class="w">      </span><span class="nx">beginner</span><span class="o">:</span><span class="w"> </span><span class="sb">`- Clear, self-documenting code\n- Basic error handling\n- Simple, understandable logic`</span><span class="p">,</span>
</span><span id="__span-10-131"><a id="__codelineno-10-131" name="__codelineno-10-131" href="#lab05-mcp-prompts-__codelineno-10-131"></a><span class="w">      </span><span class="nx">intermediate</span><span class="o">:</span><span class="w"> </span><span class="sb">`- Good separation of concerns\n- Comprehensive error handling\n- Appropriate design patterns\n- Unit test coverage`</span><span class="p">,</span>
</span><span id="__span-10-132"><a id="__codelineno-10-132" name="__codelineno-10-132" href="#lab05-mcp-prompts-__codelineno-10-132"></a><span class="w">      </span><span class="nx">advanced</span><span class="o">:</span><span class="w"> </span><span class="sb">`- High performance and scalability\n- Complex architectural patterns\n- Extensive testing (unit, integration, e2e)\n- Advanced optimization techniques`</span><span class="p">,</span>
</span><span id="__span-10-133"><a id="__codelineno-10-133" name="__codelineno-10-133" href="#lab05-mcp-prompts-__codelineno-10-133"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-10-134"><a id="__codelineno-10-134" name="__codelineno-10-134" href="#lab05-mcp-prompts-__codelineno-10-134"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">expectations</span><span class="p">[</span><span class="nx">level</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;- Standard coding practices&quot;</span><span class="p">;</span>
</span><span id="__span-10-135"><a id="__codelineno-10-135" name="__codelineno-10-135" href="#lab05-mcp-prompts-__codelineno-10-135"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-136"><a id="__codelineno-10-136" name="__codelineno-10-136" href="#lab05-mcp-prompts-__codelineno-10-136"></a>
</span><span id="__span-10-137"><a id="__codelineno-10-137" name="__codelineno-10-137" href="#lab05-mcp-prompts-__codelineno-10-137"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">getFocusAreaGuidance</span><span class="p">(</span><span class="nx">focus</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-138"><a id="__codelineno-10-138" name="__codelineno-10-138" href="#lab05-mcp-prompts-__codelineno-10-138"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">guidance</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-139"><a id="__codelineno-10-139" name="__codelineno-10-139" href="#lab05-mcp-prompts-__codelineno-10-139"></a><span class="w">      </span><span class="nx">quality</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Code Quality Focus:**</span>
</span><span id="__span-10-140"><a id="__codelineno-10-140" name="__codelineno-10-140" href="#lab05-mcp-prompts-__codelineno-10-140"></a><span class="sb">- Code readability and maintainability</span>
</span><span id="__span-10-141"><a id="__codelineno-10-141" name="__codelineno-10-141" href="#lab05-mcp-prompts-__codelineno-10-141"></a><span class="sb">- Consistent naming conventions</span>
</span><span id="__span-10-142"><a id="__codelineno-10-142" name="__codelineno-10-142" href="#lab05-mcp-prompts-__codelineno-10-142"></a><span class="sb">- Proper code organization</span>
</span><span id="__span-10-143"><a id="__codelineno-10-143" name="__codelineno-10-143" href="#lab05-mcp-prompts-__codelineno-10-143"></a><span class="sb">- Documentation quality`</span><span class="p">,</span>
</span><span id="__span-10-144"><a id="__codelineno-10-144" name="__codelineno-10-144" href="#lab05-mcp-prompts-__codelineno-10-144"></a><span class="w">      </span><span class="nx">security</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Security Focus:**</span>
</span><span id="__span-10-145"><a id="__codelineno-10-145" name="__codelineno-10-145" href="#lab05-mcp-prompts-__codelineno-10-145"></a><span class="sb">- Input validation and sanitization</span>
</span><span id="__span-10-146"><a id="__codelineno-10-146" name="__codelineno-10-146" href="#lab05-mcp-prompts-__codelineno-10-146"></a><span class="sb">- Authentication and authorization</span>
</span><span id="__span-10-147"><a id="__codelineno-10-147" name="__codelineno-10-147" href="#lab05-mcp-prompts-__codelineno-10-147"></a><span class="sb">- Data protection practices</span>
</span><span id="__span-10-148"><a id="__codelineno-10-148" name="__codelineno-10-148" href="#lab05-mcp-prompts-__codelineno-10-148"></a><span class="sb">- Common vulnerability patterns`</span><span class="p">,</span>
</span><span id="__span-10-149"><a id="__codelineno-10-149" name="__codelineno-10-149" href="#lab05-mcp-prompts-__codelineno-10-149"></a><span class="w">      </span><span class="nx">performance</span><span class="o">:</span><span class="w"> </span><span class="sb">`**Performance Focus:**</span>
</span><span id="__span-10-150"><a id="__codelineno-10-150" name="__codelineno-10-150" href="#lab05-mcp-prompts-__codelineno-10-150"></a><span class="sb">- Algorithm efficiency</span>
</span><span id="__span-10-151"><a id="__codelineno-10-151" name="__codelineno-10-151" href="#lab05-mcp-prompts-__codelineno-10-151"></a><span class="sb">- Memory usage optimization</span>
</span><span id="__span-10-152"><a id="__codelineno-10-152" name="__codelineno-10-152" href="#lab05-mcp-prompts-__codelineno-10-152"></a><span class="sb">- Database query optimization</span>
</span><span id="__span-10-153"><a id="__codelineno-10-153" name="__codelineno-10-153" href="#lab05-mcp-prompts-__codelineno-10-153"></a><span class="sb">- Caching strategies`</span><span class="p">,</span>
</span><span id="__span-10-154"><a id="__codelineno-10-154" name="__codelineno-10-154" href="#lab05-mcp-prompts-__codelineno-10-154"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-10-155"><a id="__codelineno-10-155" name="__codelineno-10-155" href="#lab05-mcp-prompts-__codelineno-10-155"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">guidance</span><span class="p">[</span><span class="nx">focus</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;- General best practices&quot;</span><span class="p">;</span>
</span><span id="__span-10-156"><a id="__codelineno-10-156" name="__codelineno-10-156" href="#lab05-mcp-prompts-__codelineno-10-156"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-157"><a id="__codelineno-10-157" name="__codelineno-10-157" href="#lab05-mcp-prompts-__codelineno-10-157"></a>
</span><span id="__span-10-158"><a id="__codelineno-10-158" name="__codelineno-10-158" href="#lab05-mcp-prompts-__codelineno-10-158"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-159"><a id="__codelineno-10-159" name="__codelineno-10-159" href="#lab05-mcp-prompts-__codelineno-10-159"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-160"><a id="__codelineno-10-160" name="__codelineno-10-160" href="#lab05-mcp-prompts-__codelineno-10-160"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-161"><a id="__codelineno-10-161" name="__codelineno-10-161" href="#lab05-mcp-prompts-__codelineno-10-161"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-10-162"><a id="__codelineno-10-162" name="__codelineno-10-162" href="#lab05-mcp-prompts-__codelineno-10-162"></a>
</span><span id="__span-10-163"><a id="__codelineno-10-163" name="__codelineno-10-163" href="#lab05-mcp-prompts-__codelineno-10-163"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-164"><a id="__codelineno-10-164" name="__codelineno-10-164" href="#lab05-mcp-prompts-__codelineno-10-164"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-10-165"><a id="__codelineno-10-165" name="__codelineno-10-165" href="#lab05-mcp-prompts-__codelineno-10-165"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-10-166"><a id="__codelineno-10-166" name="__codelineno-10-166" href="#lab05-mcp-prompts-__codelineno-10-166"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-10-167"><a id="__codelineno-10-167" name="__codelineno-10-167" href="#lab05-mcp-prompts-__codelineno-10-167"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-168"><a id="__codelineno-10-168" name="__codelineno-10-168" href="#lab05-mcp-prompts-__codelineno-10-168"></a>
</span><span id="__span-10-169"><a id="__codelineno-10-169" name="__codelineno-10-169" href="#lab05-mcp-prompts-__codelineno-10-169"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-170"><a id="__codelineno-10-170" name="__codelineno-10-170" href="#lab05-mcp-prompts-__codelineno-10-170"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-10-171"><a id="__codelineno-10-171" name="__codelineno-10-171" href="#lab05-mcp-prompts-__codelineno-10-171"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-10-172"><a id="__codelineno-10-172" name="__codelineno-10-172" href="#lab05-mcp-prompts-__codelineno-10-172"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Prompt Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-10-173"><a id="__codelineno-10-173" name="__codelineno-10-173" href="#lab05-mcp-prompts-__codelineno-10-173"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-174"><a id="__codelineno-10-174" name="__codelineno-10-174" href="#lab05-mcp-prompts-__codelineno-10-174"></a><span class="p">}</span>
</span><span id="__span-10-175"><a id="__codelineno-10-175" name="__codelineno-10-175" href="#lab05-mcp-prompts-__codelineno-10-175"></a>
</span><span id="__span-10-176"><a id="__codelineno-10-176" name="__codelineno-10-176" href="#lab05-mcp-prompts-__codelineno-10-176"></a><span class="c1">// Main entry point</span>
</span><span id="__span-10-177"><a id="__codelineno-10-177" name="__codelineno-10-177" href="#lab05-mcp-prompts-__codelineno-10-177"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-178"><a id="__codelineno-10-178" name="__codelineno-10-178" href="#lab05-mcp-prompts-__codelineno-10-178"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">PromptServer</span><span class="p">();</span>
</span><span id="__span-10-179"><a id="__codelineno-10-179" name="__codelineno-10-179" href="#lab05-mcp-prompts-__codelineno-10-179"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">start</span><span class="p">();</span>
</span><span id="__span-10-180"><a id="__codelineno-10-180" name="__codelineno-10-180" href="#lab05-mcp-prompts-__codelineno-10-180"></a><span class="p">}</span>
</span><span id="__span-10-181"><a id="__codelineno-10-181" name="__codelineno-10-181" href="#lab05-mcp-prompts-__codelineno-10-181"></a>
</span><span id="__span-10-182"><a id="__codelineno-10-182" name="__codelineno-10-182" href="#lab05-mcp-prompts-__codelineno-10-182"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-183"><a id="__codelineno-10-183" name="__codelineno-10-183" href="#lab05-mcp-prompts-__codelineno-10-183"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Fatal error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-184"><a id="__codelineno-10-184" name="__codelineno-10-184" href="#lab05-mcp-prompts-__codelineno-10-184"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-10-185"><a id="__codelineno-10-185" name="__codelineno-10-185" href="#lab05-mcp-prompts-__codelineno-10-185"></a><span class="p">});</span>
</span></code></pre></div>
<p><br></p>
<h4 id="lab05-mcp-prompts-test-enhanced-prompts">Test Enhanced Prompts<a class="headerlink" href="#lab05-mcp-prompts-test-enhanced-prompts" title="Permanent link">&para;</a></h4>
<p><strong>Test with different arguments:</strong></p>
<ol>
<li>
<p><strong>Basic code review</strong> (with default values):
   <div class="language-javascript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab05-mcp-prompts-__codelineno-11-1"></a><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">language</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;typescript&quot;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span>
</span></code></pre></div>
   Expected: Returns a prompt with intermediate complexity and quality focus.</p>
</li>
<li>
<p><strong>Advanced code review with focus</strong>:
   <div class="language-javascript highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab05-mcp-prompts-__codelineno-12-1"></a><span class="p">{</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#lab05-mcp-prompts-__codelineno-12-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-review&quot;</span><span class="p">,</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#lab05-mcp-prompts-__codelineno-12-3"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#lab05-mcp-prompts-__codelineno-12-4"></a><span class="w">    </span><span class="nx">language</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#lab05-mcp-prompts-__codelineno-12-5"></a><span class="w">    </span><span class="nx">complexity</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#lab05-mcp-prompts-__codelineno-12-6"></a><span class="w">    </span><span class="nx">focus</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;security&quot;</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#lab05-mcp-prompts-__codelineno-12-7"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#lab05-mcp-prompts-__codelineno-12-8"></a><span class="p">}</span>
</span></code></pre></div>
   Expected: Returns a prompt with advanced complexity expectations and security focus guidance.</p>
</li>
</ol>
<p><strong>How to test in MCP Inspector:</strong></p>
<ol>
<li>
<p><strong>Start the server:</strong>
   <div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab05-mcp-prompts-__codelineno-13-1"></a><span class="nb">cd</span><span class="w"> </span>my-mcp-prompts-server
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#lab05-mcp-prompts-__codelineno-13-2"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#lab05-mcp-prompts-__codelineno-13-3"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>dist/index.js
</span></code></pre></div></p>
</li>
<li>
<p><strong>Inside MCP Inspector UI, navigate to Prompts:</strong></p>
<ul>
<li>Click on the &ldquo;Prompts&rdquo; tab in the Inspector interface</li>
</ul>
</li>
<li>
<p><strong>Test List Prompts:</strong></p>
<ul>
<li>Click &ldquo;List Prompts&rdquo; button</li>
<li>Verify you see &ldquo;hello-prompt&rdquo; and &ldquo;code-review&rdquo; with the updated arguments</li>
</ul>
</li>
<li>
<p><strong>Test Get Prompt - Basic:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo; from the dropdown or click the button</li>
<li>Enter <code>code-review</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter: <code>{"language": "typescript"}</code></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the response includes intermediate complexity and quality focus</li>
</ul>
</li>
<li>
<p><strong>Test Get Prompt - Advanced:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo; again</li>
<li>Enter <code>code-review</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter:
    <div class="language-json highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab05-mcp-prompts-__codelineno-14-1"></a><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#lab05-mcp-prompts-__codelineno-14-2"></a><span class="w">  </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#lab05-mcp-prompts-__codelineno-14-3"></a><span class="w">  </span><span class="nt">&quot;complexity&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;advanced&quot;</span><span class="p">,</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#lab05-mcp-prompts-__codelineno-14-4"></a><span class="w">  </span><span class="nt">&quot;focus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;security&quot;</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#lab05-mcp-prompts-__codelineno-14-5"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Verify the prompt content includes advanced expectations and security guidance</li>
</ul>
</li>
<li>
<p><strong>Test without arguments:</strong></p>
<ul>
<li>Try <code>code-review</code> with no arguments</li>
<li>Should use defaults: typescript, intermediate, quality</li>
</ul>
</li>
</ol>
<p><strong>Expected Results:</strong></p>
<ul>
<li>The prompt description should reflect the arguments (e.g., &ldquo;Code review for python (advanced level, focus: security)&rdquo;)</li>
<li>The prompt content should include the appropriate complexity expectations and focus area guidance</li>
<li>Helper methods should dynamically insert the correct text based on arguments</li>
</ul>
<hr />
<h2 id="lab05-mcp-prompts-integrating-resources-with-prompts">Integrating Resources with Prompts<a class="headerlink" href="#lab05-mcp-prompts-integrating-resources-with-prompts" title="Permanent link">&para;</a></h2>
<p>Prompts become more powerful when integrated with resources! </p>
<p>This allows prompts to dynamically include contextual information from your knowledge base, documentation, or data sources, creating richer and more informed AI interactions.</p>
<h3 id="lab05-mcp-prompts-step-1-add-resource-support">Step 1: Add Resource Support<a class="headerlink" href="#lab05-mcp-prompts-step-1-add-resource-support" title="Permanent link">&para;</a></h3>
<p><strong>Create a new project for the resource-prompt server:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab05-mcp-prompts-__codelineno-15-1"></a><span class="c1"># Create new directory next to your previous server</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab05-mcp-prompts-__codelineno-15-2"></a>mkdir<span class="w"> </span>my-resource-prompt-server<span class="w">  </span><span class="c1"># &lt;-- next to the directory created previously</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#lab05-mcp-prompts-__codelineno-15-3"></a><span class="nb">cd</span><span class="w"> </span>my-resource-prompt-server
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#lab05-mcp-prompts-__codelineno-15-4"></a>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#lab05-mcp-prompts-__codelineno-15-5"></a><span class="c1"># Initialize and install dependencies</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#lab05-mcp-prompts-__codelineno-15-6"></a>npm<span class="w"> </span>init<span class="w"> </span>-y
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#lab05-mcp-prompts-__codelineno-15-7"></a>npm<span class="w"> </span>install<span class="w"> </span>@modelcontextprotocol/sdk
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#lab05-mcp-prompts-__codelineno-15-8"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>typescript<span class="w"> </span>@types/node<span class="w"> </span>tsx
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#lab05-mcp-prompts-__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#lab05-mcp-prompts-__codelineno-15-10"></a><span class="c1"># Create TypeScript config (same as before)</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#lab05-mcp-prompts-__codelineno-15-11"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>tsconfig.json<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#lab05-mcp-prompts-__codelineno-15-12"></a><span class="s">{</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#lab05-mcp-prompts-__codelineno-15-13"></a><span class="s">  &quot;compilerOptions&quot;: {</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#lab05-mcp-prompts-__codelineno-15-14"></a><span class="s">    &quot;target&quot;: &quot;ES2022&quot;,</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#lab05-mcp-prompts-__codelineno-15-15"></a><span class="s">    &quot;module&quot;: &quot;Node16&quot;,</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#lab05-mcp-prompts-__codelineno-15-16"></a><span class="s">    &quot;moduleResolution&quot;: &quot;Node16&quot;,</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#lab05-mcp-prompts-__codelineno-15-17"></a><span class="s">    &quot;outDir&quot;: &quot;./dist&quot;,</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#lab05-mcp-prompts-__codelineno-15-18"></a><span class="s">    &quot;rootDir&quot;: &quot;./src&quot;,</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#lab05-mcp-prompts-__codelineno-15-19"></a><span class="s">    &quot;strict&quot;: true,</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#lab05-mcp-prompts-__codelineno-15-20"></a><span class="s">    &quot;esModuleInterop&quot;: true,</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#lab05-mcp-prompts-__codelineno-15-21"></a><span class="s">    &quot;skipLibCheck&quot;: true,</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#lab05-mcp-prompts-__codelineno-15-22"></a><span class="s">    &quot;forceConsistentCasingInFileNames&quot;: true</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#lab05-mcp-prompts-__codelineno-15-23"></a><span class="s">  },</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#lab05-mcp-prompts-__codelineno-15-24"></a><span class="s">  &quot;include&quot;: [&quot;src/**/*&quot;],</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#lab05-mcp-prompts-__codelineno-15-25"></a><span class="s">  &quot;exclude&quot;: [&quot;node_modules&quot;, &quot;dist&quot;]</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#lab05-mcp-prompts-__codelineno-15-26"></a><span class="s">}</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#lab05-mcp-prompts-__codelineno-15-27"></a><span class="s">EOF</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#lab05-mcp-prompts-__codelineno-15-28"></a>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#lab05-mcp-prompts-__codelineno-15-29"></a><span class="c1"># Create directory structure</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#lab05-mcp-prompts-__codelineno-15-30"></a>mkdir<span class="w"> </span>src<span class="w"> </span><span class="c1"># &lt;-- inside &quot;my-resource-prompt-server&quot; directory</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Now create the server file <code>src/index.ts</code> with the following content that combines prompts with resources:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab05-mcp-prompts-__codelineno-16-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#lab05-mcp-prompts-__codelineno-16-2"></a><span class="w">  </span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#lab05-mcp-prompts-__codelineno-16-3"></a><span class="w">  </span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#lab05-mcp-prompts-__codelineno-16-4"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#lab05-mcp-prompts-__codelineno-16-5"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#lab05-mcp-prompts-__codelineno-16-6"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#lab05-mcp-prompts-__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#lab05-mcp-prompts-__codelineno-16-8"></a><span class="kd">class</span><span class="w"> </span><span class="nx">ResourcePromptServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#lab05-mcp-prompts-__codelineno-16-9"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#lab05-mcp-prompts-__codelineno-16-10"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">knowledgeBase</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#lab05-mcp-prompts-__codelineno-16-11"></a>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#lab05-mcp-prompts-__codelineno-16-12"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#lab05-mcp-prompts-__codelineno-16-13"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#lab05-mcp-prompts-__codelineno-16-14"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#lab05-mcp-prompts-__codelineno-16-15"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;resource-prompt-server&quot;</span><span class="p">,</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#lab05-mcp-prompts-__codelineno-16-16"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#lab05-mcp-prompts-__codelineno-16-17"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#lab05-mcp-prompts-__codelineno-16-18"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#lab05-mcp-prompts-__codelineno-16-19"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#lab05-mcp-prompts-__codelineno-16-20"></a><span class="w">          </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#lab05-mcp-prompts-__codelineno-16-21"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#lab05-mcp-prompts-__codelineno-16-22"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#lab05-mcp-prompts-__codelineno-16-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#lab05-mcp-prompts-__codelineno-16-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#lab05-mcp-prompts-__codelineno-16-25"></a>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#lab05-mcp-prompts-__codelineno-16-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">initializeKnowledgeBase</span><span class="p">();</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#lab05-mcp-prompts-__codelineno-16-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#lab05-mcp-prompts-__codelineno-16-28"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#lab05-mcp-prompts-__codelineno-16-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#lab05-mcp-prompts-__codelineno-16-30"></a>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#lab05-mcp-prompts-__codelineno-16-31"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">initializeKnowledgeBase</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#lab05-mcp-prompts-__codelineno-16-32"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;best-practices&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#lab05-mcp-prompts-__codelineno-16-33"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Development Best Practices&quot;</span><span class="p">,</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#lab05-mcp-prompts-__codelineno-16-34"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#lab05-mcp-prompts-__codelineno-16-35"></a><span class="sb">## Code Quality</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#lab05-mcp-prompts-__codelineno-16-36"></a><span class="sb">- Write self-documenting code</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#lab05-mcp-prompts-__codelineno-16-37"></a><span class="sb">- Use meaningful variable names</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#lab05-mcp-prompts-__codelineno-16-38"></a><span class="sb">- Keep functions small and focused</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#lab05-mcp-prompts-__codelineno-16-39"></a>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#lab05-mcp-prompts-__codelineno-16-40"></a><span class="sb">## Testing</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#lab05-mcp-prompts-__codelineno-16-41"></a><span class="sb">- Write unit tests for all functions</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#lab05-mcp-prompts-__codelineno-16-42"></a><span class="sb">- Include integration tests</span>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#lab05-mcp-prompts-__codelineno-16-43"></a><span class="sb">- Test edge cases and error conditions</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#lab05-mcp-prompts-__codelineno-16-44"></a><span class="sb">      `</span><span class="p">,</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#lab05-mcp-prompts-__codelineno-16-45"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#lab05-mcp-prompts-__codelineno-16-46"></a>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#lab05-mcp-prompts-__codelineno-16-47"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;security-guidelines&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#lab05-mcp-prompts-__codelineno-16-48"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Security Guidelines&quot;</span><span class="p">,</span>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#lab05-mcp-prompts-__codelineno-16-49"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#lab05-mcp-prompts-__codelineno-16-50"></a><span class="sb">## Input Validation</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#lab05-mcp-prompts-__codelineno-16-51"></a><span class="sb">- Validate all user inputs</span>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#lab05-mcp-prompts-__codelineno-16-52"></a><span class="sb">- Use parameterized queries</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#lab05-mcp-prompts-__codelineno-16-53"></a><span class="sb">- Sanitize HTML content</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#lab05-mcp-prompts-__codelineno-16-54"></a>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#lab05-mcp-prompts-__codelineno-16-55"></a><span class="sb">## Authentication</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#lab05-mcp-prompts-__codelineno-16-56"></a><span class="sb">- Use strong password policies</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#lab05-mcp-prompts-__codelineno-16-57"></a><span class="sb">- Implement multi-factor authentication</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#lab05-mcp-prompts-__codelineno-16-58"></a><span class="sb">      `</span><span class="p">,</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#lab05-mcp-prompts-__codelineno-16-59"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#lab05-mcp-prompts-__codelineno-16-60"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#lab05-mcp-prompts-__codelineno-16-61"></a>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#lab05-mcp-prompts-__codelineno-16-62"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#lab05-mcp-prompts-__codelineno-16-63"></a><span class="w">    </span><span class="c1">// Resource handlers</span>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#lab05-mcp-prompts-__codelineno-16-64"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#lab05-mcp-prompts-__codelineno-16-65"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">entries</span><span class="p">()).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#lab05-mcp-prompts-__codelineno-16-66"></a><span class="w">        </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`kb://articles/</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#lab05-mcp-prompts-__codelineno-16-67"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#lab05-mcp-prompts-__codelineno-16-68"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Knowledge base: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#lab05-mcp-prompts-__codelineno-16-69"></a><span class="w">        </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="__span-16-70"><a id="__codelineno-16-70" name="__codelineno-16-70" href="#lab05-mcp-prompts-__codelineno-16-70"></a><span class="w">      </span><span class="p">}));</span>
</span><span id="__span-16-71"><a id="__codelineno-16-71" name="__codelineno-16-71" href="#lab05-mcp-prompts-__codelineno-16-71"></a>
</span><span id="__span-16-72"><a id="__codelineno-16-72" name="__codelineno-16-72" href="#lab05-mcp-prompts-__codelineno-16-72"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-16-73"><a id="__codelineno-16-73" name="__codelineno-16-73" href="#lab05-mcp-prompts-__codelineno-16-73"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-74"><a id="__codelineno-16-74" name="__codelineno-16-74" href="#lab05-mcp-prompts-__codelineno-16-74"></a>
</span><span id="__span-16-75"><a id="__codelineno-16-75" name="__codelineno-16-75" href="#lab05-mcp-prompts-__codelineno-16-75"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-76"><a id="__codelineno-16-76" name="__codelineno-16-76" href="#lab05-mcp-prompts-__codelineno-16-76"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-16-77"><a id="__codelineno-16-77" name="__codelineno-16-77" href="#lab05-mcp-prompts-__codelineno-16-77"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readKnowledgeBase</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-16-78"><a id="__codelineno-16-78" name="__codelineno-16-78" href="#lab05-mcp-prompts-__codelineno-16-78"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-16-79"><a id="__codelineno-16-79" name="__codelineno-16-79" href="#lab05-mcp-prompts-__codelineno-16-79"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-80"><a id="__codelineno-16-80" name="__codelineno-16-80" href="#lab05-mcp-prompts-__codelineno-16-80"></a>
</span><span id="__span-16-81"><a id="__codelineno-16-81" name="__codelineno-16-81" href="#lab05-mcp-prompts-__codelineno-16-81"></a><span class="w">    </span><span class="c1">// Prompt handlers</span>
</span><span id="__span-16-82"><a id="__codelineno-16-82" name="__codelineno-16-82" href="#lab05-mcp-prompts-__codelineno-16-82"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-83"><a id="__codelineno-16-83" name="__codelineno-16-83" href="#lab05-mcp-prompts-__codelineno-16-83"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-84"><a id="__codelineno-16-84" name="__codelineno-16-84" href="#lab05-mcp-prompts-__codelineno-16-84"></a><span class="w">        </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-85"><a id="__codelineno-16-85" name="__codelineno-16-85" href="#lab05-mcp-prompts-__codelineno-16-85"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-16-86"><a id="__codelineno-16-86" name="__codelineno-16-86" href="#lab05-mcp-prompts-__codelineno-16-86"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;contextual-code-review&quot;</span><span class="p">,</span>
</span><span id="__span-16-87"><a id="__codelineno-16-87" name="__codelineno-16-87" href="#lab05-mcp-prompts-__codelineno-16-87"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Code review with integrated best practices&quot;</span><span class="p">,</span>
</span><span id="__span-16-88"><a id="__codelineno-16-88" name="__codelineno-16-88" href="#lab05-mcp-prompts-__codelineno-16-88"></a><span class="w">            </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-89"><a id="__codelineno-16-89" name="__codelineno-16-89" href="#lab05-mcp-prompts-__codelineno-16-89"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-16-90"><a id="__codelineno-16-90" name="__codelineno-16-90" href="#lab05-mcp-prompts-__codelineno-16-90"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;language&quot;</span><span class="p">,</span>
</span><span id="__span-16-91"><a id="__codelineno-16-91" name="__codelineno-16-91" href="#lab05-mcp-prompts-__codelineno-16-91"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Programming language&quot;</span><span class="p">,</span>
</span><span id="__span-16-92"><a id="__codelineno-16-92" name="__codelineno-16-92" href="#lab05-mcp-prompts-__codelineno-16-92"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-16-93"><a id="__codelineno-16-93" name="__codelineno-16-93" href="#lab05-mcp-prompts-__codelineno-16-93"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-16-94"><a id="__codelineno-16-94" name="__codelineno-16-94" href="#lab05-mcp-prompts-__codelineno-16-94"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-16-95"><a id="__codelineno-16-95" name="__codelineno-16-95" href="#lab05-mcp-prompts-__codelineno-16-95"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;focusAreas&quot;</span><span class="p">,</span>
</span><span id="__span-16-96"><a id="__codelineno-16-96" name="__codelineno-16-96" href="#lab05-mcp-prompts-__codelineno-16-96"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Focus areas (comma-separated)&quot;</span><span class="p">,</span>
</span><span id="__span-16-97"><a id="__codelineno-16-97" name="__codelineno-16-97" href="#lab05-mcp-prompts-__codelineno-16-97"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-16-98"><a id="__codelineno-16-98" name="__codelineno-16-98" href="#lab05-mcp-prompts-__codelineno-16-98"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-16-99"><a id="__codelineno-16-99" name="__codelineno-16-99" href="#lab05-mcp-prompts-__codelineno-16-99"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-16-100"><a id="__codelineno-16-100" name="__codelineno-16-100" href="#lab05-mcp-prompts-__codelineno-16-100"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-16-101"><a id="__codelineno-16-101" name="__codelineno-16-101" href="#lab05-mcp-prompts-__codelineno-16-101"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-16-102"><a id="__codelineno-16-102" name="__codelineno-16-102" href="#lab05-mcp-prompts-__codelineno-16-102"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-16-103"><a id="__codelineno-16-103" name="__codelineno-16-103" href="#lab05-mcp-prompts-__codelineno-16-103"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-104"><a id="__codelineno-16-104" name="__codelineno-16-104" href="#lab05-mcp-prompts-__codelineno-16-104"></a>
</span><span id="__span-16-105"><a id="__codelineno-16-105" name="__codelineno-16-105" href="#lab05-mcp-prompts-__codelineno-16-105"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-106"><a id="__codelineno-16-106" name="__codelineno-16-106" href="#lab05-mcp-prompts-__codelineno-16-106"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-16-107"><a id="__codelineno-16-107" name="__codelineno-16-107" href="#lab05-mcp-prompts-__codelineno-16-107"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-16-108"><a id="__codelineno-16-108" name="__codelineno-16-108" href="#lab05-mcp-prompts-__codelineno-16-108"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-109"><a id="__codelineno-16-109" name="__codelineno-16-109" href="#lab05-mcp-prompts-__codelineno-16-109"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-110"><a id="__codelineno-16-110" name="__codelineno-16-110" href="#lab05-mcp-prompts-__codelineno-16-110"></a>
</span><span id="__span-16-111"><a id="__codelineno-16-111" name="__codelineno-16-111" href="#lab05-mcp-prompts-__codelineno-16-111"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readKnowledgeBase</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-112"><a id="__codelineno-16-112" name="__codelineno-16-112" href="#lab05-mcp-prompts-__codelineno-16-112"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^kb:\/\/articles\/(.+)$/</span><span class="p">);</span>
</span><span id="__span-16-113"><a id="__codelineno-16-113" name="__codelineno-16-113" href="#lab05-mcp-prompts-__codelineno-16-113"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid knowledge base URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-16-114"><a id="__codelineno-16-114" name="__codelineno-16-114" href="#lab05-mcp-prompts-__codelineno-16-114"></a>
</span><span id="__span-16-115"><a id="__codelineno-16-115" name="__codelineno-16-115" href="#lab05-mcp-prompts-__codelineno-16-115"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-16-116"><a id="__codelineno-16-116" name="__codelineno-16-116" href="#lab05-mcp-prompts-__codelineno-16-116"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">article</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-16-117"><a id="__codelineno-16-117" name="__codelineno-16-117" href="#lab05-mcp-prompts-__codelineno-16-117"></a>
</span><span id="__span-16-118"><a id="__codelineno-16-118" name="__codelineno-16-118" href="#lab05-mcp-prompts-__codelineno-16-118"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">article</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Article not found: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-16-119"><a id="__codelineno-16-119" name="__codelineno-16-119" href="#lab05-mcp-prompts-__codelineno-16-119"></a>
</span><span id="__span-16-120"><a id="__codelineno-16-120" name="__codelineno-16-120" href="#lab05-mcp-prompts-__codelineno-16-120"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-121"><a id="__codelineno-16-121" name="__codelineno-16-121" href="#lab05-mcp-prompts-__codelineno-16-121"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-16-122"><a id="__codelineno-16-122" name="__codelineno-16-122" href="#lab05-mcp-prompts-__codelineno-16-122"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="__span-16-123"><a id="__codelineno-16-123" name="__codelineno-16-123" href="#lab05-mcp-prompts-__codelineno-16-123"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">article.content</span><span class="p">,</span>
</span><span id="__span-16-124"><a id="__codelineno-16-124" name="__codelineno-16-124" href="#lab05-mcp-prompts-__codelineno-16-124"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-125"><a id="__codelineno-16-125" name="__codelineno-16-125" href="#lab05-mcp-prompts-__codelineno-16-125"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-126"><a id="__codelineno-16-126" name="__codelineno-16-126" href="#lab05-mcp-prompts-__codelineno-16-126"></a>
</span><span id="__span-16-127"><a id="__codelineno-16-127" name="__codelineno-16-127" href="#lab05-mcp-prompts-__codelineno-16-127"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">generatePrompt</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-128"><a id="__codelineno-16-128" name="__codelineno-16-128" href="#lab05-mcp-prompts-__codelineno-16-128"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-129"><a id="__codelineno-16-129" name="__codelineno-16-129" href="#lab05-mcp-prompts-__codelineno-16-129"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;contextual-code-review&quot;</span><span class="o">:</span>
</span><span id="__span-16-130"><a id="__codelineno-16-130" name="__codelineno-16-130" href="#lab05-mcp-prompts-__codelineno-16-130"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createContextualCodeReviewPrompt</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-16-131"><a id="__codelineno-16-131" name="__codelineno-16-131" href="#lab05-mcp-prompts-__codelineno-16-131"></a>
</span><span id="__span-16-132"><a id="__codelineno-16-132" name="__codelineno-16-132" href="#lab05-mcp-prompts-__codelineno-16-132"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-16-133"><a id="__codelineno-16-133" name="__codelineno-16-133" href="#lab05-mcp-prompts-__codelineno-16-133"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown prompt: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-16-134"><a id="__codelineno-16-134" name="__codelineno-16-134" href="#lab05-mcp-prompts-__codelineno-16-134"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-135"><a id="__codelineno-16-135" name="__codelineno-16-135" href="#lab05-mcp-prompts-__codelineno-16-135"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-136"><a id="__codelineno-16-136" name="__codelineno-16-136" href="#lab05-mcp-prompts-__codelineno-16-136"></a>
</span><span id="__span-16-137"><a id="__codelineno-16-137" name="__codelineno-16-137" href="#lab05-mcp-prompts-__codelineno-16-137"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">createContextualCodeReviewPrompt</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-138"><a id="__codelineno-16-138" name="__codelineno-16-138" href="#lab05-mcp-prompts-__codelineno-16-138"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">language</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;typescript&quot;</span><span class="p">;</span>
</span><span id="__span-16-139"><a id="__codelineno-16-139" name="__codelineno-16-139" href="#lab05-mcp-prompts-__codelineno-16-139"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">focusAreas</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">focusAreas</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">focusAreas</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">s</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">s</span><span class="p">.</span><span class="nx">trim</span><span class="p">())</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">];</span>
</span><span id="__span-16-140"><a id="__codelineno-16-140" name="__codelineno-16-140" href="#lab05-mcp-prompts-__codelineno-16-140"></a>
</span><span id="__span-16-141"><a id="__codelineno-16-141" name="__codelineno-16-141" href="#lab05-mcp-prompts-__codelineno-16-141"></a><span class="w">    </span><span class="c1">// Fetch relevant knowledge base articles</span>
</span><span id="__span-16-142"><a id="__codelineno-16-142" name="__codelineno-16-142" href="#lab05-mcp-prompts-__codelineno-16-142"></a><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="nx">contextContent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span id="__span-16-143"><a id="__codelineno-16-143" name="__codelineno-16-143" href="#lab05-mcp-prompts-__codelineno-16-143"></a>
</span><span id="__span-16-144"><a id="__codelineno-16-144" name="__codelineno-16-144" href="#lab05-mcp-prompts-__codelineno-16-144"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">focusAreas</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;quality&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-145"><a id="__codelineno-16-145" name="__codelineno-16-145" href="#lab05-mcp-prompts-__codelineno-16-145"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">bestPractices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;best-practices&quot;</span><span class="p">);</span>
</span><span id="__span-16-146"><a id="__codelineno-16-146" name="__codelineno-16-146" href="#lab05-mcp-prompts-__codelineno-16-146"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">bestPractices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-147"><a id="__codelineno-16-147" name="__codelineno-16-147" href="#lab05-mcp-prompts-__codelineno-16-147"></a><span class="w">        </span><span class="nx">contextContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`\n## Development Best Practices\n</span><span class="si">${</span><span class="nx">bestPractices</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-16-148"><a id="__codelineno-16-148" name="__codelineno-16-148" href="#lab05-mcp-prompts-__codelineno-16-148"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-149"><a id="__codelineno-16-149" name="__codelineno-16-149" href="#lab05-mcp-prompts-__codelineno-16-149"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-150"><a id="__codelineno-16-150" name="__codelineno-16-150" href="#lab05-mcp-prompts-__codelineno-16-150"></a>
</span><span id="__span-16-151"><a id="__codelineno-16-151" name="__codelineno-16-151" href="#lab05-mcp-prompts-__codelineno-16-151"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">focusAreas</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s2">&quot;security&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-152"><a id="__codelineno-16-152" name="__codelineno-16-152" href="#lab05-mcp-prompts-__codelineno-16-152"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">securityGuidelines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;security-guidelines&quot;</span><span class="p">);</span>
</span><span id="__span-16-153"><a id="__codelineno-16-153" name="__codelineno-16-153" href="#lab05-mcp-prompts-__codelineno-16-153"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">securityGuidelines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-154"><a id="__codelineno-16-154" name="__codelineno-16-154" href="#lab05-mcp-prompts-__codelineno-16-154"></a><span class="w">        </span><span class="nx">contextContent</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="sb">`\n## Security Guidelines\n</span><span class="si">${</span><span class="nx">securityGuidelines</span><span class="p">.</span><span class="nx">content</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-16-155"><a id="__codelineno-16-155" name="__codelineno-16-155" href="#lab05-mcp-prompts-__codelineno-16-155"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-156"><a id="__codelineno-16-156" name="__codelineno-16-156" href="#lab05-mcp-prompts-__codelineno-16-156"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-157"><a id="__codelineno-16-157" name="__codelineno-16-157" href="#lab05-mcp-prompts-__codelineno-16-157"></a>
</span><span id="__span-16-158"><a id="__codelineno-16-158" name="__codelineno-16-158" href="#lab05-mcp-prompts-__codelineno-16-158"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-159"><a id="__codelineno-16-159" name="__codelineno-16-159" href="#lab05-mcp-prompts-__codelineno-16-159"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Contextual code review for </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> with focus on: </span><span class="si">${</span><span class="nx">focusAreas</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-16-160"><a id="__codelineno-16-160" name="__codelineno-16-160" href="#lab05-mcp-prompts-__codelineno-16-160"></a><span class="w">      </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-161"><a id="__codelineno-16-161" name="__codelineno-16-161" href="#lab05-mcp-prompts-__codelineno-16-161"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-162"><a id="__codelineno-16-162" name="__codelineno-16-162" href="#lab05-mcp-prompts-__codelineno-16-162"></a><span class="w">          </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-16-163"><a id="__codelineno-16-163" name="__codelineno-16-163" href="#lab05-mcp-prompts-__codelineno-16-163"></a><span class="w">          </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-164"><a id="__codelineno-16-164" name="__codelineno-16-164" href="#lab05-mcp-prompts-__codelineno-16-164"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-16-165"><a id="__codelineno-16-165" name="__codelineno-16-165" href="#lab05-mcp-prompts-__codelineno-16-165"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Please perform a comprehensive code review of the following </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb"> code. Use the integrated knowledge base context to provide informed recommendations.</span>
</span><span id="__span-16-166"><a id="__codelineno-16-166" name="__codelineno-16-166" href="#lab05-mcp-prompts-__codelineno-16-166"></a>
</span><span id="__span-16-167"><a id="__codelineno-16-167" name="__codelineno-16-167" href="#lab05-mcp-prompts-__codelineno-16-167"></a><span class="sb">## Review Context</span>
</span><span id="__span-16-168"><a id="__codelineno-16-168" name="__codelineno-16-168" href="#lab05-mcp-prompts-__codelineno-16-168"></a><span class="si">${</span><span class="nx">contextContent</span><span class="si">}</span>
</span><span id="__span-16-169"><a id="__codelineno-16-169" name="__codelineno-16-169" href="#lab05-mcp-prompts-__codelineno-16-169"></a>
</span><span id="__span-16-170"><a id="__codelineno-16-170" name="__codelineno-16-170" href="#lab05-mcp-prompts-__codelineno-16-170"></a><span class="sb">## Code to Review</span>
</span><span id="__span-16-171"><a id="__codelineno-16-171" name="__codelineno-16-171" href="#lab05-mcp-prompts-__codelineno-16-171"></a><span class="sb">[Insert code here]</span>
</span><span id="__span-16-172"><a id="__codelineno-16-172" name="__codelineno-16-172" href="#lab05-mcp-prompts-__codelineno-16-172"></a>
</span><span id="__span-16-173"><a id="__codelineno-16-173" name="__codelineno-16-173" href="#lab05-mcp-prompts-__codelineno-16-173"></a><span class="sb">## Review Focus Areas</span>
</span><span id="__span-16-174"><a id="__codelineno-16-174" name="__codelineno-16-174" href="#lab05-mcp-prompts-__codelineno-16-174"></a><span class="si">${</span><span class="nx">focusAreas</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">area</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="sb">`- **</span><span class="si">${</span><span class="nx">area</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mf">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">area</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="si">}</span><span class="sb">**: Apply relevant guidelines from the context above`</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-16-175"><a id="__codelineno-16-175" name="__codelineno-16-175" href="#lab05-mcp-prompts-__codelineno-16-175"></a>
</span><span id="__span-16-176"><a id="__codelineno-16-176" name="__codelineno-16-176" href="#lab05-mcp-prompts-__codelineno-16-176"></a><span class="sb">## Review Structure</span>
</span><span id="__span-16-177"><a id="__codelineno-16-177" name="__codelineno-16-177" href="#lab05-mcp-prompts-__codelineno-16-177"></a><span class="sb">1. **Summary**: Overall assessment and key findings</span>
</span><span id="__span-16-178"><a id="__codelineno-16-178" name="__codelineno-16-178" href="#lab05-mcp-prompts-__codelineno-16-178"></a><span class="sb">2. **Strengths**: What the code does well</span>
</span><span id="__span-16-179"><a id="__codelineno-16-179" name="__codelineno-16-179" href="#lab05-mcp-prompts-__codelineno-16-179"></a><span class="sb">3. **Areas for Improvement**: Specific recommendations with context references</span>
</span><span id="__span-16-180"><a id="__codelineno-16-180" name="__codelineno-16-180" href="#lab05-mcp-prompts-__codelineno-16-180"></a><span class="sb">4. **Action Items**: Prioritized list of recommended changes</span>
</span><span id="__span-16-181"><a id="__codelineno-16-181" name="__codelineno-16-181" href="#lab05-mcp-prompts-__codelineno-16-181"></a>
</span><span id="__span-16-182"><a id="__codelineno-16-182" name="__codelineno-16-182" href="#lab05-mcp-prompts-__codelineno-16-182"></a><span class="sb">Please reference specific guidelines from the provided context and explain how they apply to this code.`</span><span class="p">,</span>
</span><span id="__span-16-183"><a id="__codelineno-16-183" name="__codelineno-16-183" href="#lab05-mcp-prompts-__codelineno-16-183"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-16-184"><a id="__codelineno-16-184" name="__codelineno-16-184" href="#lab05-mcp-prompts-__codelineno-16-184"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-185"><a id="__codelineno-16-185" name="__codelineno-16-185" href="#lab05-mcp-prompts-__codelineno-16-185"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-16-186"><a id="__codelineno-16-186" name="__codelineno-16-186" href="#lab05-mcp-prompts-__codelineno-16-186"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-187"><a id="__codelineno-16-187" name="__codelineno-16-187" href="#lab05-mcp-prompts-__codelineno-16-187"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-188"><a id="__codelineno-16-188" name="__codelineno-16-188" href="#lab05-mcp-prompts-__codelineno-16-188"></a>
</span><span id="__span-16-189"><a id="__codelineno-16-189" name="__codelineno-16-189" href="#lab05-mcp-prompts-__codelineno-16-189"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-190"><a id="__codelineno-16-190" name="__codelineno-16-190" href="#lab05-mcp-prompts-__codelineno-16-190"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-191"><a id="__codelineno-16-191" name="__codelineno-16-191" href="#lab05-mcp-prompts-__codelineno-16-191"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-16-192"><a id="__codelineno-16-192" name="__codelineno-16-192" href="#lab05-mcp-prompts-__codelineno-16-192"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-193"><a id="__codelineno-16-193" name="__codelineno-16-193" href="#lab05-mcp-prompts-__codelineno-16-193"></a>
</span><span id="__span-16-194"><a id="__codelineno-16-194" name="__codelineno-16-194" href="#lab05-mcp-prompts-__codelineno-16-194"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-195"><a id="__codelineno-16-195" name="__codelineno-16-195" href="#lab05-mcp-prompts-__codelineno-16-195"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-16-196"><a id="__codelineno-16-196" name="__codelineno-16-196" href="#lab05-mcp-prompts-__codelineno-16-196"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-16-197"><a id="__codelineno-16-197" name="__codelineno-16-197" href="#lab05-mcp-prompts-__codelineno-16-197"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-198"><a id="__codelineno-16-198" name="__codelineno-16-198" href="#lab05-mcp-prompts-__codelineno-16-198"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-199"><a id="__codelineno-16-199" name="__codelineno-16-199" href="#lab05-mcp-prompts-__codelineno-16-199"></a>
</span><span id="__span-16-200"><a id="__codelineno-16-200" name="__codelineno-16-200" href="#lab05-mcp-prompts-__codelineno-16-200"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-201"><a id="__codelineno-16-201" name="__codelineno-16-201" href="#lab05-mcp-prompts-__codelineno-16-201"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-16-202"><a id="__codelineno-16-202" name="__codelineno-16-202" href="#lab05-mcp-prompts-__codelineno-16-202"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-16-203"><a id="__codelineno-16-203" name="__codelineno-16-203" href="#lab05-mcp-prompts-__codelineno-16-203"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Resource-Prompt Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-16-204"><a id="__codelineno-16-204" name="__codelineno-16-204" href="#lab05-mcp-prompts-__codelineno-16-204"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-205"><a id="__codelineno-16-205" name="__codelineno-16-205" href="#lab05-mcp-prompts-__codelineno-16-205"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="lab05-mcp-prompts-step-2-test-resource-integration">Step 2: Test Resource Integration<a class="headerlink" href="#lab05-mcp-prompts-step-2-test-resource-integration" title="Permanent link">&para;</a></h3>
<p><strong>Build and run the resource-prompt server:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab05-mcp-prompts-__codelineno-17-1"></a><span class="nb">cd</span><span class="w"> </span>my-resource-prompt-server
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#lab05-mcp-prompts-__codelineno-17-2"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#lab05-mcp-prompts-__codelineno-17-3"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>dist/index.js
</span></code></pre></div>
<p><strong>Test the enhanced server inside the MCP Inspector UI:</strong></p>
<ol>
<li>
<p><strong>Navigate to Resources tab:</strong></p>
<ul>
<li>Click on the &ldquo;Resources&rdquo; tab</li>
</ul>
</li>
<li>
<p><strong>List resources:</strong></p>
<ul>
<li>Click &ldquo;List Resources&rdquo; button</li>
<li>Verify you see the knowledge base articles (&ldquo;Development Best Practices&rdquo; and &ldquo;Security Guidelines&rdquo;)</li>
</ul>
</li>
<li>
<p><strong>Read a resource:</strong></p>
<ul>
<li>Select &ldquo;Read Resource&rdquo; from the dropdown</li>
<li>Enter <code>kb://articles/best-practices</code> in the &ldquo;URI&rdquo; field</li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the response includes the full content of the best practices article</li>
</ul>
</li>
<li>
<p><strong>Read another resource:</strong></p>
<ul>
<li>Select &ldquo;Read Resource&rdquo; again</li>
<li>Enter <code>kb://articles/security-guidelines</code> in the &ldquo;URI&rdquo; field</li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Verify the security guidelines content is returned</li>
</ul>
</li>
<li>
<p><strong>Navigate to Prompts tab:</strong></p>
<ul>
<li>Click on the &ldquo;Prompts&rdquo; tab</li>
</ul>
</li>
<li>
<p><strong>List prompts:</strong></p>
<ul>
<li>Click &ldquo;List Prompts&rdquo; button</li>
<li>Verify you see the &ldquo;contextual-code-review&rdquo; prompt with its arguments</li>
</ul>
</li>
<li>
<p><strong>Get contextual prompt - Basic:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo;</li>
<li>Enter <code>contextual-code-review</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter: <code>{"language": "typescript"}</code></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the prompt content includes the best practices from the knowledge base</li>
</ul>
</li>
<li>
<p><strong>Get contextual prompt - With focus areas:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo; again</li>
<li>Enter <code>contextual-code-review</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter:
    <div class="language-json highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab05-mcp-prompts-__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#lab05-mcp-prompts-__codelineno-18-2"></a><span class="w">  </span><span class="nt">&quot;language&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#lab05-mcp-prompts-__codelineno-18-3"></a><span class="w">  </span><span class="nt">&quot;focusAreas&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;quality,security&quot;</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#lab05-mcp-prompts-__codelineno-18-4"></a><span class="p">}</span>
</span></code></pre></div></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Verify the prompt includes both best practices and security guidelines from the knowledge base</li>
</ul>
</li>
</ol>
<p><br></p>
<p><strong>Expected Results:</strong></p>
<ul>
<li>Resources should list the knowledge base articles with proper URIs and descriptions</li>
<li>Reading resources should return the full markdown content of each article</li>
<li>Prompts should dynamically include relevant knowledge base content based on the focus areas argument</li>
<li>The contextual prompt should reference specific guidelines from the integrated resources</li>
</ul>
<hr />
<h2 id="lab05-mcp-prompts-complete-mcp-server-integration">Complete MCP Server Integration<a class="headerlink" href="#lab05-mcp-prompts-complete-mcp-server-integration" title="Permanent link">&para;</a></h2>
<p>Complete MCP server integration combines all three core capabilities - tools, resources, and prompts - into a single server that can perform complex operations and provide rich, contextual AI interactions.</p>
<h3 id="lab05-mcp-prompts-step-1-combine-all-capabilities">Step 1: Combine All Capabilities<a class="headerlink" href="#lab05-mcp-prompts-step-1-combine-all-capabilities" title="Permanent link">&para;</a></h3>
<p><strong>Create a new project for the complete MCP server:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab05-mcp-prompts-__codelineno-19-1"></a><span class="c1"># Create new directory next to your previous servers</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab05-mcp-prompts-__codelineno-19-2"></a>mkdir<span class="w"> </span>my-complete-mcp-server
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#lab05-mcp-prompts-__codelineno-19-3"></a><span class="nb">cd</span><span class="w"> </span>my-complete-mcp-server
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#lab05-mcp-prompts-__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#lab05-mcp-prompts-__codelineno-19-5"></a><span class="c1"># Initialize and install dependencies</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#lab05-mcp-prompts-__codelineno-19-6"></a>npm<span class="w"> </span>init<span class="w"> </span>-y
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#lab05-mcp-prompts-__codelineno-19-7"></a>npm<span class="w"> </span>install<span class="w"> </span>@modelcontextprotocol/sdk
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#lab05-mcp-prompts-__codelineno-19-8"></a>npm<span class="w"> </span>install<span class="w"> </span>-D<span class="w"> </span>typescript<span class="w"> </span>@types/node<span class="w"> </span>tsx
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#lab05-mcp-prompts-__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#lab05-mcp-prompts-__codelineno-19-10"></a><span class="c1"># Create TypeScript config (same as before)</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#lab05-mcp-prompts-__codelineno-19-11"></a>cat<span class="w"> </span>&gt;<span class="w"> </span>tsconfig.json<span class="w"> </span><span class="s">&lt;&lt; &#39;EOF&#39;</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#lab05-mcp-prompts-__codelineno-19-12"></a><span class="s">{</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#lab05-mcp-prompts-__codelineno-19-13"></a><span class="s">  &quot;compilerOptions&quot;: {</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#lab05-mcp-prompts-__codelineno-19-14"></a><span class="s">    &quot;target&quot;: &quot;ES2022&quot;,</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#lab05-mcp-prompts-__codelineno-19-15"></a><span class="s">    &quot;module&quot;: &quot;Node16&quot;,</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#lab05-mcp-prompts-__codelineno-19-16"></a><span class="s">    &quot;moduleResolution&quot;: &quot;Node16&quot;,</span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#lab05-mcp-prompts-__codelineno-19-17"></a><span class="s">    &quot;outDir&quot;: &quot;./dist&quot;,</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#lab05-mcp-prompts-__codelineno-19-18"></a><span class="s">    &quot;rootDir&quot;: &quot;./src&quot;,</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#lab05-mcp-prompts-__codelineno-19-19"></a><span class="s">    &quot;strict&quot;: true,</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#lab05-mcp-prompts-__codelineno-19-20"></a><span class="s">    &quot;esModuleInterop&quot;: true,</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#lab05-mcp-prompts-__codelineno-19-21"></a><span class="s">    &quot;skipLibCheck&quot;: true,</span>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#lab05-mcp-prompts-__codelineno-19-22"></a><span class="s">    &quot;forceConsistentCasingInFileNames&quot;: true</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#lab05-mcp-prompts-__codelineno-19-23"></a><span class="s">  },</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#lab05-mcp-prompts-__codelineno-19-24"></a><span class="s">  &quot;include&quot;: [&quot;src/**/*&quot;],</span>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#lab05-mcp-prompts-__codelineno-19-25"></a><span class="s">  &quot;exclude&quot;: [&quot;node_modules&quot;, &quot;dist&quot;]</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#lab05-mcp-prompts-__codelineno-19-26"></a><span class="s">}</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#lab05-mcp-prompts-__codelineno-19-27"></a><span class="s">EOF</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#lab05-mcp-prompts-__codelineno-19-28"></a>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#lab05-mcp-prompts-__codelineno-19-29"></a><span class="c1"># Create directory structure</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#lab05-mcp-prompts-__codelineno-19-30"></a>mkdir<span class="w"> </span>src
</span></code></pre></div>
<p><br></p>
<p><strong>Now create the server file <code>src/index.ts</code>, that combines tools, resources, and prompts, with the following content:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab05-mcp-prompts-__codelineno-20-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#lab05-mcp-prompts-__codelineno-20-2"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#lab05-mcp-prompts-__codelineno-20-3"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#lab05-mcp-prompts-__codelineno-20-4"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#lab05-mcp-prompts-__codelineno-20-5"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#lab05-mcp-prompts-__codelineno-20-6"></a><span class="w">  </span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#lab05-mcp-prompts-__codelineno-20-7"></a><span class="w">  </span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#lab05-mcp-prompts-__codelineno-20-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#lab05-mcp-prompts-__codelineno-20-9"></a>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#lab05-mcp-prompts-__codelineno-20-10"></a><span class="kd">class</span><span class="w"> </span><span class="nx">CompleteMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#lab05-mcp-prompts-__codelineno-20-11"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#lab05-mcp-prompts-__codelineno-20-12"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">knowledgeBase</span><span class="o">:</span><span class="w"> </span><span class="kt">Map</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Map</span><span class="p">();</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#lab05-mcp-prompts-__codelineno-20-13"></a>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#lab05-mcp-prompts-__codelineno-20-14"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#lab05-mcp-prompts-__codelineno-20-15"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#lab05-mcp-prompts-__codelineno-20-16"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#lab05-mcp-prompts-__codelineno-20-17"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;complete-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#lab05-mcp-prompts-__codelineno-20-18"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#lab05-mcp-prompts-__codelineno-20-19"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#lab05-mcp-prompts-__codelineno-20-20"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#lab05-mcp-prompts-__codelineno-20-21"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#lab05-mcp-prompts-__codelineno-20-22"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#lab05-mcp-prompts-__codelineno-20-23"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-20-24"><a id="__codelineno-20-24" name="__codelineno-20-24" href="#lab05-mcp-prompts-__codelineno-20-24"></a><span class="w">          </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-20-25"><a id="__codelineno-20-25" name="__codelineno-20-25" href="#lab05-mcp-prompts-__codelineno-20-25"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-26"><a id="__codelineno-20-26" name="__codelineno-20-26" href="#lab05-mcp-prompts-__codelineno-20-26"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-27"><a id="__codelineno-20-27" name="__codelineno-20-27" href="#lab05-mcp-prompts-__codelineno-20-27"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-20-28"><a id="__codelineno-20-28" name="__codelineno-20-28" href="#lab05-mcp-prompts-__codelineno-20-28"></a>
</span><span id="__span-20-29"><a id="__codelineno-20-29" name="__codelineno-20-29" href="#lab05-mcp-prompts-__codelineno-20-29"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">initializeKnowledgeBase</span><span class="p">();</span>
</span><span id="__span-20-30"><a id="__codelineno-20-30" name="__codelineno-20-30" href="#lab05-mcp-prompts-__codelineno-20-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-20-31"><a id="__codelineno-20-31" name="__codelineno-20-31" href="#lab05-mcp-prompts-__codelineno-20-31"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-20-32"><a id="__codelineno-20-32" name="__codelineno-20-32" href="#lab05-mcp-prompts-__codelineno-20-32"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-33"><a id="__codelineno-20-33" name="__codelineno-20-33" href="#lab05-mcp-prompts-__codelineno-20-33"></a>
</span><span id="__span-20-34"><a id="__codelineno-20-34" name="__codelineno-20-34" href="#lab05-mcp-prompts-__codelineno-20-34"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">initializeKnowledgeBase</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-35"><a id="__codelineno-20-35" name="__codelineno-20-35" href="#lab05-mcp-prompts-__codelineno-20-35"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;development-workflow&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-36"><a id="__codelineno-20-36" name="__codelineno-20-36" href="#lab05-mcp-prompts-__codelineno-20-36"></a><span class="w">      </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Complete Development Workflow&quot;</span><span class="p">,</span>
</span><span id="__span-20-37"><a id="__codelineno-20-37" name="__codelineno-20-37" href="#lab05-mcp-prompts-__codelineno-20-37"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-20-38"><a id="__codelineno-20-38" name="__codelineno-20-38" href="#lab05-mcp-prompts-__codelineno-20-38"></a><span class="sb">## Development Process</span>
</span><span id="__span-20-39"><a id="__codelineno-20-39" name="__codelineno-20-39" href="#lab05-mcp-prompts-__codelineno-20-39"></a><span class="sb">1. Requirements gathering and analysis</span>
</span><span id="__span-20-40"><a id="__codelineno-20-40" name="__codelineno-20-40" href="#lab05-mcp-prompts-__codelineno-20-40"></a><span class="sb">2. System design and architecture</span>
</span><span id="__span-20-41"><a id="__codelineno-20-41" name="__codelineno-20-41" href="#lab05-mcp-prompts-__codelineno-20-41"></a><span class="sb">3. Implementation with best practices</span>
</span><span id="__span-20-42"><a id="__codelineno-20-42" name="__codelineno-20-42" href="#lab05-mcp-prompts-__codelineno-20-42"></a><span class="sb">4. Code review and quality assurance</span>
</span><span id="__span-20-43"><a id="__codelineno-20-43" name="__codelineno-20-43" href="#lab05-mcp-prompts-__codelineno-20-43"></a><span class="sb">5. Testing and validation</span>
</span><span id="__span-20-44"><a id="__codelineno-20-44" name="__codelineno-20-44" href="#lab05-mcp-prompts-__codelineno-20-44"></a><span class="sb">6. Deployment and monitoring</span>
</span><span id="__span-20-45"><a id="__codelineno-20-45" name="__codelineno-20-45" href="#lab05-mcp-prompts-__codelineno-20-45"></a><span class="sb">7. Maintenance and updates</span>
</span><span id="__span-20-46"><a id="__codelineno-20-46" name="__codelineno-20-46" href="#lab05-mcp-prompts-__codelineno-20-46"></a><span class="sb">      `</span><span class="p">,</span>
</span><span id="__span-20-47"><a id="__codelineno-20-47" name="__codelineno-20-47" href="#lab05-mcp-prompts-__codelineno-20-47"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-48"><a id="__codelineno-20-48" name="__codelineno-20-48" href="#lab05-mcp-prompts-__codelineno-20-48"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-49"><a id="__codelineno-20-49" name="__codelineno-20-49" href="#lab05-mcp-prompts-__codelineno-20-49"></a>
</span><span id="__span-20-50"><a id="__codelineno-20-50" name="__codelineno-20-50" href="#lab05-mcp-prompts-__codelineno-20-50"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-51"><a id="__codelineno-20-51" name="__codelineno-20-51" href="#lab05-mcp-prompts-__codelineno-20-51"></a><span class="w">    </span><span class="c1">// Tool handlers</span>
</span><span id="__span-20-52"><a id="__codelineno-20-52" name="__codelineno-20-52" href="#lab05-mcp-prompts-__codelineno-20-52"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-53"><a id="__codelineno-20-53" name="__codelineno-20-53" href="#lab05-mcp-prompts-__codelineno-20-53"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-54"><a id="__codelineno-20-54" name="__codelineno-20-54" href="#lab05-mcp-prompts-__codelineno-20-54"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-55"><a id="__codelineno-20-55" name="__codelineno-20-55" href="#lab05-mcp-prompts-__codelineno-20-55"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-20-56"><a id="__codelineno-20-56" name="__codelineno-20-56" href="#lab05-mcp-prompts-__codelineno-20-56"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;analyze_codebase&quot;</span><span class="p">,</span>
</span><span id="__span-20-57"><a id="__codelineno-20-57" name="__codelineno-20-57" href="#lab05-mcp-prompts-__codelineno-20-57"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analyze codebase structure and provide insights&quot;</span><span class="p">,</span>
</span><span id="__span-20-58"><a id="__codelineno-20-58" name="__codelineno-20-58" href="#lab05-mcp-prompts-__codelineno-20-58"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-59"><a id="__codelineno-20-59" name="__codelineno-20-59" href="#lab05-mcp-prompts-__codelineno-20-59"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-20-60"><a id="__codelineno-20-60" name="__codelineno-20-60" href="#lab05-mcp-prompts-__codelineno-20-60"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-61"><a id="__codelineno-20-61" name="__codelineno-20-61" href="#lab05-mcp-prompts-__codelineno-20-61"></a><span class="w">                </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Path to analyze&quot;</span><span class="w"> </span><span class="p">},</span>
</span><span id="__span-20-62"><a id="__codelineno-20-62" name="__codelineno-20-62" href="#lab05-mcp-prompts-__codelineno-20-62"></a><span class="w">                </span><span class="nx">analysisType</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-63"><a id="__codelineno-20-63" name="__codelineno-20-63" href="#lab05-mcp-prompts-__codelineno-20-63"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-20-64"><a id="__codelineno-20-64" name="__codelineno-20-64" href="#lab05-mcp-prompts-__codelineno-20-64"></a><span class="w">                  </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;complexity&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dependencies&quot;</span><span class="p">],</span>
</span><span id="__span-20-65"><a id="__codelineno-20-65" name="__codelineno-20-65" href="#lab05-mcp-prompts-__codelineno-20-65"></a><span class="w">                  </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;structure&quot;</span>
</span><span id="__span-20-66"><a id="__codelineno-20-66" name="__codelineno-20-66" href="#lab05-mcp-prompts-__codelineno-20-66"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-20-67"><a id="__codelineno-20-67" name="__codelineno-20-67" href="#lab05-mcp-prompts-__codelineno-20-67"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-20-68"><a id="__codelineno-20-68" name="__codelineno-20-68" href="#lab05-mcp-prompts-__codelineno-20-68"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;path&quot;</span><span class="p">],</span>
</span><span id="__span-20-69"><a id="__codelineno-20-69" name="__codelineno-20-69" href="#lab05-mcp-prompts-__codelineno-20-69"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-20-70"><a id="__codelineno-20-70" name="__codelineno-20-70" href="#lab05-mcp-prompts-__codelineno-20-70"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-71"><a id="__codelineno-20-71" name="__codelineno-20-71" href="#lab05-mcp-prompts-__codelineno-20-71"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-20-72"><a id="__codelineno-20-72" name="__codelineno-20-72" href="#lab05-mcp-prompts-__codelineno-20-72"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-20-73"><a id="__codelineno-20-73" name="__codelineno-20-73" href="#lab05-mcp-prompts-__codelineno-20-73"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-74"><a id="__codelineno-20-74" name="__codelineno-20-74" href="#lab05-mcp-prompts-__codelineno-20-74"></a>
</span><span id="__span-20-75"><a id="__codelineno-20-75" name="__codelineno-20-75" href="#lab05-mcp-prompts-__codelineno-20-75"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-76"><a id="__codelineno-20-76" name="__codelineno-20-76" href="#lab05-mcp-prompts-__codelineno-20-76"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-20-77"><a id="__codelineno-20-77" name="__codelineno-20-77" href="#lab05-mcp-prompts-__codelineno-20-77"></a>
</span><span id="__span-20-78"><a id="__codelineno-20-78" name="__codelineno-20-78" href="#lab05-mcp-prompts-__codelineno-20-78"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-79"><a id="__codelineno-20-79" name="__codelineno-20-79" href="#lab05-mcp-prompts-__codelineno-20-79"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;analyze_codebase&quot;</span><span class="o">:</span>
</span><span id="__span-20-80"><a id="__codelineno-20-80" name="__codelineno-20-80" href="#lab05-mcp-prompts-__codelineno-20-80"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeCodebase</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-20-81"><a id="__codelineno-20-81" name="__codelineno-20-81" href="#lab05-mcp-prompts-__codelineno-20-81"></a>
</span><span id="__span-20-82"><a id="__codelineno-20-82" name="__codelineno-20-82" href="#lab05-mcp-prompts-__codelineno-20-82"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-20-83"><a id="__codelineno-20-83" name="__codelineno-20-83" href="#lab05-mcp-prompts-__codelineno-20-83"></a><span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-84"><a id="__codelineno-20-84" name="__codelineno-20-84" href="#lab05-mcp-prompts-__codelineno-20-84"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-20-85"><a id="__codelineno-20-85" name="__codelineno-20-85" href="#lab05-mcp-prompts-__codelineno-20-85"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-86"><a id="__codelineno-20-86" name="__codelineno-20-86" href="#lab05-mcp-prompts-__codelineno-20-86"></a>
</span><span id="__span-20-87"><a id="__codelineno-20-87" name="__codelineno-20-87" href="#lab05-mcp-prompts-__codelineno-20-87"></a><span class="w">    </span><span class="c1">// Resource handlers</span>
</span><span id="__span-20-88"><a id="__codelineno-20-88" name="__codelineno-20-88" href="#lab05-mcp-prompts-__codelineno-20-88"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-89"><a id="__codelineno-20-89" name="__codelineno-20-89" href="#lab05-mcp-prompts-__codelineno-20-89"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-90"><a id="__codelineno-20-90" name="__codelineno-20-90" href="#lab05-mcp-prompts-__codelineno-20-90"></a><span class="w">        </span><span class="p">...</span><span class="nb">Array</span><span class="p">.</span><span class="kr">from</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">entries</span><span class="p">()).</span><span class="nx">map</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">doc</span><span class="p">])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-20-91"><a id="__codelineno-20-91" name="__codelineno-20-91" href="#lab05-mcp-prompts-__codelineno-20-91"></a><span class="w">          </span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="sb">`kb://articles/</span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-20-92"><a id="__codelineno-20-92" name="__codelineno-20-92" href="#lab05-mcp-prompts-__codelineno-20-92"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">doc.title</span><span class="p">,</span>
</span><span id="__span-20-93"><a id="__codelineno-20-93" name="__codelineno-20-93" href="#lab05-mcp-prompts-__codelineno-20-93"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Knowledge: </span><span class="si">${</span><span class="nx">doc</span><span class="p">.</span><span class="nx">title</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-20-94"><a id="__codelineno-20-94" name="__codelineno-20-94" href="#lab05-mcp-prompts-__codelineno-20-94"></a><span class="w">          </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="__span-20-95"><a id="__codelineno-20-95" name="__codelineno-20-95" href="#lab05-mcp-prompts-__codelineno-20-95"></a><span class="w">        </span><span class="p">})),</span>
</span><span id="__span-20-96"><a id="__codelineno-20-96" name="__codelineno-20-96" href="#lab05-mcp-prompts-__codelineno-20-96"></a><span class="w">      </span><span class="p">];</span>
</span><span id="__span-20-97"><a id="__codelineno-20-97" name="__codelineno-20-97" href="#lab05-mcp-prompts-__codelineno-20-97"></a>
</span><span id="__span-20-98"><a id="__codelineno-20-98" name="__codelineno-20-98" href="#lab05-mcp-prompts-__codelineno-20-98"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">resources</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-20-99"><a id="__codelineno-20-99" name="__codelineno-20-99" href="#lab05-mcp-prompts-__codelineno-20-99"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-100"><a id="__codelineno-20-100" name="__codelineno-20-100" href="#lab05-mcp-prompts-__codelineno-20-100"></a>
</span><span id="__span-20-101"><a id="__codelineno-20-101" name="__codelineno-20-101" href="#lab05-mcp-prompts-__codelineno-20-101"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-102"><a id="__codelineno-20-102" name="__codelineno-20-102" href="#lab05-mcp-prompts-__codelineno-20-102"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">uri</span><span class="p">;</span>
</span><span id="__span-20-103"><a id="__codelineno-20-103" name="__codelineno-20-103" href="#lab05-mcp-prompts-__codelineno-20-103"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-20-104"><a id="__codelineno-20-104" name="__codelineno-20-104" href="#lab05-mcp-prompts-__codelineno-20-104"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">contents</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="nx">content</span><span class="p">]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-20-105"><a id="__codelineno-20-105" name="__codelineno-20-105" href="#lab05-mcp-prompts-__codelineno-20-105"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-106"><a id="__codelineno-20-106" name="__codelineno-20-106" href="#lab05-mcp-prompts-__codelineno-20-106"></a>
</span><span id="__span-20-107"><a id="__codelineno-20-107" name="__codelineno-20-107" href="#lab05-mcp-prompts-__codelineno-20-107"></a><span class="w">    </span><span class="c1">// Prompt handlers</span>
</span><span id="__span-20-108"><a id="__codelineno-20-108" name="__codelineno-20-108" href="#lab05-mcp-prompts-__codelineno-20-108"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListPromptsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-109"><a id="__codelineno-20-109" name="__codelineno-20-109" href="#lab05-mcp-prompts-__codelineno-20-109"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-110"><a id="__codelineno-20-110" name="__codelineno-20-110" href="#lab05-mcp-prompts-__codelineno-20-110"></a><span class="w">        </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-111"><a id="__codelineno-20-111" name="__codelineno-20-111" href="#lab05-mcp-prompts-__codelineno-20-111"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-20-112"><a id="__codelineno-20-112" name="__codelineno-20-112" href="#lab05-mcp-prompts-__codelineno-20-112"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;full-development-workflow&quot;</span><span class="p">,</span>
</span><span id="__span-20-113"><a id="__codelineno-20-113" name="__codelineno-20-113" href="#lab05-mcp-prompts-__codelineno-20-113"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Complete development workflow with integrated resources&quot;</span><span class="p">,</span>
</span><span id="__span-20-114"><a id="__codelineno-20-114" name="__codelineno-20-114" href="#lab05-mcp-prompts-__codelineno-20-114"></a><span class="w">            </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-115"><a id="__codelineno-20-115" name="__codelineno-20-115" href="#lab05-mcp-prompts-__codelineno-20-115"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-20-116"><a id="__codelineno-20-116" name="__codelineno-20-116" href="#lab05-mcp-prompts-__codelineno-20-116"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;projectType&quot;</span><span class="p">,</span>
</span><span id="__span-20-117"><a id="__codelineno-20-117" name="__codelineno-20-117" href="#lab05-mcp-prompts-__codelineno-20-117"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Type of project (web, api, mobile)&quot;</span><span class="p">,</span>
</span><span id="__span-20-118"><a id="__codelineno-20-118" name="__codelineno-20-118" href="#lab05-mcp-prompts-__codelineno-20-118"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-20-119"><a id="__codelineno-20-119" name="__codelineno-20-119" href="#lab05-mcp-prompts-__codelineno-20-119"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-20-120"><a id="__codelineno-20-120" name="__codelineno-20-120" href="#lab05-mcp-prompts-__codelineno-20-120"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-20-121"><a id="__codelineno-20-121" name="__codelineno-20-121" href="#lab05-mcp-prompts-__codelineno-20-121"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-122"><a id="__codelineno-20-122" name="__codelineno-20-122" href="#lab05-mcp-prompts-__codelineno-20-122"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-20-123"><a id="__codelineno-20-123" name="__codelineno-20-123" href="#lab05-mcp-prompts-__codelineno-20-123"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;code-quality-assessment&quot;</span><span class="p">,</span>
</span><span id="__span-20-124"><a id="__codelineno-20-124" name="__codelineno-20-124" href="#lab05-mcp-prompts-__codelineno-20-124"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Comprehensive code quality assessment using all capabilities&quot;</span><span class="p">,</span>
</span><span id="__span-20-125"><a id="__codelineno-20-125" name="__codelineno-20-125" href="#lab05-mcp-prompts-__codelineno-20-125"></a><span class="w">            </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-126"><a id="__codelineno-20-126" name="__codelineno-20-126" href="#lab05-mcp-prompts-__codelineno-20-126"></a><span class="w">              </span><span class="p">{</span>
</span><span id="__span-20-127"><a id="__codelineno-20-127" name="__codelineno-20-127" href="#lab05-mcp-prompts-__codelineno-20-127"></a><span class="w">                </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;codeSample&quot;</span><span class="p">,</span>
</span><span id="__span-20-128"><a id="__codelineno-20-128" name="__codelineno-20-128" href="#lab05-mcp-prompts-__codelineno-20-128"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Code to assess&quot;</span><span class="p">,</span>
</span><span id="__span-20-129"><a id="__codelineno-20-129" name="__codelineno-20-129" href="#lab05-mcp-prompts-__codelineno-20-129"></a><span class="w">                </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-20-130"><a id="__codelineno-20-130" name="__codelineno-20-130" href="#lab05-mcp-prompts-__codelineno-20-130"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-20-131"><a id="__codelineno-20-131" name="__codelineno-20-131" href="#lab05-mcp-prompts-__codelineno-20-131"></a><span class="w">            </span><span class="p">],</span>
</span><span id="__span-20-132"><a id="__codelineno-20-132" name="__codelineno-20-132" href="#lab05-mcp-prompts-__codelineno-20-132"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-133"><a id="__codelineno-20-133" name="__codelineno-20-133" href="#lab05-mcp-prompts-__codelineno-20-133"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-20-134"><a id="__codelineno-20-134" name="__codelineno-20-134" href="#lab05-mcp-prompts-__codelineno-20-134"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-20-135"><a id="__codelineno-20-135" name="__codelineno-20-135" href="#lab05-mcp-prompts-__codelineno-20-135"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-136"><a id="__codelineno-20-136" name="__codelineno-20-136" href="#lab05-mcp-prompts-__codelineno-20-136"></a>
</span><span id="__span-20-137"><a id="__codelineno-20-137" name="__codelineno-20-137" href="#lab05-mcp-prompts-__codelineno-20-137"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">GetPromptRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-138"><a id="__codelineno-20-138" name="__codelineno-20-138" href="#lab05-mcp-prompts-__codelineno-20-138"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-20-139"><a id="__codelineno-20-139" name="__codelineno-20-139" href="#lab05-mcp-prompts-__codelineno-20-139"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">generateIntegratedPrompt</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-20-140"><a id="__codelineno-20-140" name="__codelineno-20-140" href="#lab05-mcp-prompts-__codelineno-20-140"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-141"><a id="__codelineno-20-141" name="__codelineno-20-141" href="#lab05-mcp-prompts-__codelineno-20-141"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-142"><a id="__codelineno-20-142" name="__codelineno-20-142" href="#lab05-mcp-prompts-__codelineno-20-142"></a>
</span><span id="__span-20-143"><a id="__codelineno-20-143" name="__codelineno-20-143" href="#lab05-mcp-prompts-__codelineno-20-143"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">analyzeCodebase</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-144"><a id="__codelineno-20-144" name="__codelineno-20-144" href="#lab05-mcp-prompts-__codelineno-20-144"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">targetPath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">path</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;./&quot;</span><span class="p">;</span>
</span><span id="__span-20-145"><a id="__codelineno-20-145" name="__codelineno-20-145" href="#lab05-mcp-prompts-__codelineno-20-145"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">analysisType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">analysisType</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;structure&quot;</span><span class="p">;</span>
</span><span id="__span-20-146"><a id="__codelineno-20-146" name="__codelineno-20-146" href="#lab05-mcp-prompts-__codelineno-20-146"></a>
</span><span id="__span-20-147"><a id="__codelineno-20-147" name="__codelineno-20-147" href="#lab05-mcp-prompts-__codelineno-20-147"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-148"><a id="__codelineno-20-148" name="__codelineno-20-148" href="#lab05-mcp-prompts-__codelineno-20-148"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">analysis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">performCodeAnalysis</span><span class="p">(</span><span class="nx">targetPath</span><span class="p">,</span><span class="w"> </span><span class="nx">analysisType</span><span class="p">);</span>
</span><span id="__span-20-149"><a id="__codelineno-20-149" name="__codelineno-20-149" href="#lab05-mcp-prompts-__codelineno-20-149"></a>
</span><span id="__span-20-150"><a id="__codelineno-20-150" name="__codelineno-20-150" href="#lab05-mcp-prompts-__codelineno-20-150"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-151"><a id="__codelineno-20-151" name="__codelineno-20-151" href="#lab05-mcp-prompts-__codelineno-20-151"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-152"><a id="__codelineno-20-152" name="__codelineno-20-152" href="#lab05-mcp-prompts-__codelineno-20-152"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-20-153"><a id="__codelineno-20-153" name="__codelineno-20-153" href="#lab05-mcp-prompts-__codelineno-20-153"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-20-154"><a id="__codelineno-20-154" name="__codelineno-20-154" href="#lab05-mcp-prompts-__codelineno-20-154"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`## Codebase Analysis: </span><span class="si">${</span><span class="nx">analysisType</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">\n\n</span><span class="si">${</span><span class="nx">analysis</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-20-155"><a id="__codelineno-20-155" name="__codelineno-20-155" href="#lab05-mcp-prompts-__codelineno-20-155"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-156"><a id="__codelineno-20-156" name="__codelineno-20-156" href="#lab05-mcp-prompts-__codelineno-20-156"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-20-157"><a id="__codelineno-20-157" name="__codelineno-20-157" href="#lab05-mcp-prompts-__codelineno-20-157"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-20-158"><a id="__codelineno-20-158" name="__codelineno-20-158" href="#lab05-mcp-prompts-__codelineno-20-158"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-159"><a id="__codelineno-20-159" name="__codelineno-20-159" href="#lab05-mcp-prompts-__codelineno-20-159"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Codebase analysis failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-160"><a id="__codelineno-20-160" name="__codelineno-20-160" href="#lab05-mcp-prompts-__codelineno-20-160"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-161"><a id="__codelineno-20-161" name="__codelineno-20-161" href="#lab05-mcp-prompts-__codelineno-20-161"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-162"><a id="__codelineno-20-162" name="__codelineno-20-162" href="#lab05-mcp-prompts-__codelineno-20-162"></a>
</span><span id="__span-20-163"><a id="__codelineno-20-163" name="__codelineno-20-163" href="#lab05-mcp-prompts-__codelineno-20-163"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">performCodeAnalysis</span><span class="p">(</span><span class="nx">targetPath</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">analysisType</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-164"><a id="__codelineno-20-164" name="__codelineno-20-164" href="#lab05-mcp-prompts-__codelineno-20-164"></a><span class="w">    </span><span class="c1">// Simplified analysis - in real implementation, use proper code analysis tools</span>
</span><span id="__span-20-165"><a id="__codelineno-20-165" name="__codelineno-20-165" href="#lab05-mcp-prompts-__codelineno-20-165"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="sb">`### Analysis Results</span>
</span><span id="__span-20-166"><a id="__codelineno-20-166" name="__codelineno-20-166" href="#lab05-mcp-prompts-__codelineno-20-166"></a><span class="sb">- **Path**: </span><span class="si">${</span><span class="nx">targetPath</span><span class="si">}</span>
</span><span id="__span-20-167"><a id="__codelineno-20-167" name="__codelineno-20-167" href="#lab05-mcp-prompts-__codelineno-20-167"></a><span class="sb">- **Type**: </span><span class="si">${</span><span class="nx">analysisType</span><span class="si">}</span>
</span><span id="__span-20-168"><a id="__codelineno-20-168" name="__codelineno-20-168" href="#lab05-mcp-prompts-__codelineno-20-168"></a><span class="sb">- **Status**: Analysis completed successfully</span>
</span><span id="__span-20-169"><a id="__codelineno-20-169" name="__codelineno-20-169" href="#lab05-mcp-prompts-__codelineno-20-169"></a>
</span><span id="__span-20-170"><a id="__codelineno-20-170" name="__codelineno-20-170" href="#lab05-mcp-prompts-__codelineno-20-170"></a><span class="sb">### Recommendations</span>
</span><span id="__span-20-171"><a id="__codelineno-20-171" name="__codelineno-20-171" href="#lab05-mcp-prompts-__codelineno-20-171"></a><span class="sb">- Consider organizing files by feature</span>
</span><span id="__span-20-172"><a id="__codelineno-20-172" name="__codelineno-20-172" href="#lab05-mcp-prompts-__codelineno-20-172"></a><span class="sb">- Add proper documentation</span>
</span><span id="__span-20-173"><a id="__codelineno-20-173" name="__codelineno-20-173" href="#lab05-mcp-prompts-__codelineno-20-173"></a><span class="sb">- Implement consistent coding standards`</span><span class="p">;</span>
</span><span id="__span-20-174"><a id="__codelineno-20-174" name="__codelineno-20-174" href="#lab05-mcp-prompts-__codelineno-20-174"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-175"><a id="__codelineno-20-175" name="__codelineno-20-175" href="#lab05-mcp-prompts-__codelineno-20-175"></a>
</span><span id="__span-20-176"><a id="__codelineno-20-176" name="__codelineno-20-176" href="#lab05-mcp-prompts-__codelineno-20-176"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">readResource</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-177"><a id="__codelineno-20-177" name="__codelineno-20-177" href="#lab05-mcp-prompts-__codelineno-20-177"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s1">&#39;kb://&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-178"><a id="__codelineno-20-178" name="__codelineno-20-178" href="#lab05-mcp-prompts-__codelineno-20-178"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">readKnowledgeBase</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
</span><span id="__span-20-179"><a id="__codelineno-20-179" name="__codelineno-20-179" href="#lab05-mcp-prompts-__codelineno-20-179"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-180"><a id="__codelineno-20-180" name="__codelineno-20-180" href="#lab05-mcp-prompts-__codelineno-20-180"></a>
</span><span id="__span-20-181"><a id="__codelineno-20-181" name="__codelineno-20-181" href="#lab05-mcp-prompts-__codelineno-20-181"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown resource URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-182"><a id="__codelineno-20-182" name="__codelineno-20-182" href="#lab05-mcp-prompts-__codelineno-20-182"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-183"><a id="__codelineno-20-183" name="__codelineno-20-183" href="#lab05-mcp-prompts-__codelineno-20-183"></a>
</span><span id="__span-20-184"><a id="__codelineno-20-184" name="__codelineno-20-184" href="#lab05-mcp-prompts-__codelineno-20-184"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">readKnowledgeBase</span><span class="p">(</span><span class="nx">uri</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-185"><a id="__codelineno-20-185" name="__codelineno-20-185" href="#lab05-mcp-prompts-__codelineno-20-185"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">uri</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^kb:\/\/articles\/(.+)$/</span><span class="p">);</span>
</span><span id="__span-20-186"><a id="__codelineno-20-186" name="__codelineno-20-186" href="#lab05-mcp-prompts-__codelineno-20-186"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Invalid knowledge base URI: </span><span class="si">${</span><span class="nx">uri</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-187"><a id="__codelineno-20-187" name="__codelineno-20-187" href="#lab05-mcp-prompts-__codelineno-20-187"></a>
</span><span id="__span-20-188"><a id="__codelineno-20-188" name="__codelineno-20-188" href="#lab05-mcp-prompts-__codelineno-20-188"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">key</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">match</span><span class="p">[</span><span class="mf">1</span><span class="p">];</span>
</span><span id="__span-20-189"><a id="__codelineno-20-189" name="__codelineno-20-189" href="#lab05-mcp-prompts-__codelineno-20-189"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">article</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
</span><span id="__span-20-190"><a id="__codelineno-20-190" name="__codelineno-20-190" href="#lab05-mcp-prompts-__codelineno-20-190"></a>
</span><span id="__span-20-191"><a id="__codelineno-20-191" name="__codelineno-20-191" href="#lab05-mcp-prompts-__codelineno-20-191"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">article</span><span class="p">)</span><span class="w"> </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Article not found: </span><span class="si">${</span><span class="nx">key</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-192"><a id="__codelineno-20-192" name="__codelineno-20-192" href="#lab05-mcp-prompts-__codelineno-20-192"></a>
</span><span id="__span-20-193"><a id="__codelineno-20-193" name="__codelineno-20-193" href="#lab05-mcp-prompts-__codelineno-20-193"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-194"><a id="__codelineno-20-194" name="__codelineno-20-194" href="#lab05-mcp-prompts-__codelineno-20-194"></a><span class="w">      </span><span class="nx">uri</span><span class="p">,</span>
</span><span id="__span-20-195"><a id="__codelineno-20-195" name="__codelineno-20-195" href="#lab05-mcp-prompts-__codelineno-20-195"></a><span class="w">      </span><span class="nx">mimeType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text/markdown&quot;</span><span class="p">,</span>
</span><span id="__span-20-196"><a id="__codelineno-20-196" name="__codelineno-20-196" href="#lab05-mcp-prompts-__codelineno-20-196"></a><span class="w">      </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">article.content</span><span class="p">,</span>
</span><span id="__span-20-197"><a id="__codelineno-20-197" name="__codelineno-20-197" href="#lab05-mcp-prompts-__codelineno-20-197"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-198"><a id="__codelineno-20-198" name="__codelineno-20-198" href="#lab05-mcp-prompts-__codelineno-20-198"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-199"><a id="__codelineno-20-199" name="__codelineno-20-199" href="#lab05-mcp-prompts-__codelineno-20-199"></a>
</span><span id="__span-20-200"><a id="__codelineno-20-200" name="__codelineno-20-200" href="#lab05-mcp-prompts-__codelineno-20-200"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">generateIntegratedPrompt</span><span class="p">(</span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-201"><a id="__codelineno-20-201" name="__codelineno-20-201" href="#lab05-mcp-prompts-__codelineno-20-201"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-202"><a id="__codelineno-20-202" name="__codelineno-20-202" href="#lab05-mcp-prompts-__codelineno-20-202"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;full-development-workflow&quot;</span><span class="o">:</span>
</span><span id="__span-20-203"><a id="__codelineno-20-203" name="__codelineno-20-203" href="#lab05-mcp-prompts-__codelineno-20-203"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createFullWorkflowPrompt</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-20-204"><a id="__codelineno-20-204" name="__codelineno-20-204" href="#lab05-mcp-prompts-__codelineno-20-204"></a>
</span><span id="__span-20-205"><a id="__codelineno-20-205" name="__codelineno-20-205" href="#lab05-mcp-prompts-__codelineno-20-205"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;code-quality-assessment&quot;</span><span class="o">:</span>
</span><span id="__span-20-206"><a id="__codelineno-20-206" name="__codelineno-20-206" href="#lab05-mcp-prompts-__codelineno-20-206"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createQualityAssessmentPrompt</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-20-207"><a id="__codelineno-20-207" name="__codelineno-20-207" href="#lab05-mcp-prompts-__codelineno-20-207"></a>
</span><span id="__span-20-208"><a id="__codelineno-20-208" name="__codelineno-20-208" href="#lab05-mcp-prompts-__codelineno-20-208"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-20-209"><a id="__codelineno-20-209" name="__codelineno-20-209" href="#lab05-mcp-prompts-__codelineno-20-209"></a><span class="w">        </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown prompt: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-20-210"><a id="__codelineno-20-210" name="__codelineno-20-210" href="#lab05-mcp-prompts-__codelineno-20-210"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-211"><a id="__codelineno-20-211" name="__codelineno-20-211" href="#lab05-mcp-prompts-__codelineno-20-211"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-212"><a id="__codelineno-20-212" name="__codelineno-20-212" href="#lab05-mcp-prompts-__codelineno-20-212"></a>
</span><span id="__span-20-213"><a id="__codelineno-20-213" name="__codelineno-20-213" href="#lab05-mcp-prompts-__codelineno-20-213"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">createFullWorkflowPrompt</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-214"><a id="__codelineno-20-214" name="__codelineno-20-214" href="#lab05-mcp-prompts-__codelineno-20-214"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">projectType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">projectType</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;web&quot;</span><span class="p">;</span>
</span><span id="__span-20-215"><a id="__codelineno-20-215" name="__codelineno-20-215" href="#lab05-mcp-prompts-__codelineno-20-215"></a>
</span><span id="__span-20-216"><a id="__codelineno-20-216" name="__codelineno-20-216" href="#lab05-mcp-prompts-__codelineno-20-216"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">workflowDoc</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;development-workflow&quot;</span><span class="p">);</span>
</span><span id="__span-20-217"><a id="__codelineno-20-217" name="__codelineno-20-217" href="#lab05-mcp-prompts-__codelineno-20-217"></a>
</span><span id="__span-20-218"><a id="__codelineno-20-218" name="__codelineno-20-218" href="#lab05-mcp-prompts-__codelineno-20-218"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-219"><a id="__codelineno-20-219" name="__codelineno-20-219" href="#lab05-mcp-prompts-__codelineno-20-219"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Complete </span><span class="si">${</span><span class="nx">projectType</span><span class="si">}</span><span class="sb"> development workflow`</span><span class="p">,</span>
</span><span id="__span-20-220"><a id="__codelineno-20-220" name="__codelineno-20-220" href="#lab05-mcp-prompts-__codelineno-20-220"></a><span class="w">      </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-221"><a id="__codelineno-20-221" name="__codelineno-20-221" href="#lab05-mcp-prompts-__codelineno-20-221"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-20-222"><a id="__codelineno-20-222" name="__codelineno-20-222" href="#lab05-mcp-prompts-__codelineno-20-222"></a><span class="w">          </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-20-223"><a id="__codelineno-20-223" name="__codelineno-20-223" href="#lab05-mcp-prompts-__codelineno-20-223"></a><span class="w">          </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-224"><a id="__codelineno-20-224" name="__codelineno-20-224" href="#lab05-mcp-prompts-__codelineno-20-224"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-20-225"><a id="__codelineno-20-225" name="__codelineno-20-225" href="#lab05-mcp-prompts-__codelineno-20-225"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Guide me through a complete </span><span class="si">${</span><span class="nx">projectType</span><span class="si">}</span><span class="sb"> development project.</span>
</span><span id="__span-20-226"><a id="__codelineno-20-226" name="__codelineno-20-226" href="#lab05-mcp-prompts-__codelineno-20-226"></a>
</span><span id="__span-20-227"><a id="__codelineno-20-227" name="__codelineno-20-227" href="#lab05-mcp-prompts-__codelineno-20-227"></a><span class="sb">## Development Workflow Reference</span>
</span><span id="__span-20-228"><a id="__codelineno-20-228" name="__codelineno-20-228" href="#lab05-mcp-prompts-__codelineno-20-228"></a><span class="si">${</span><span class="nx">workflowDoc</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">workflowDoc</span><span class="p">.</span><span class="nx">content</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Standard development practices apply&quot;</span><span class="si">}</span>
</span><span id="__span-20-229"><a id="__codelineno-20-229" name="__codelineno-20-229" href="#lab05-mcp-prompts-__codelineno-20-229"></a>
</span><span id="__span-20-230"><a id="__codelineno-20-230" name="__codelineno-20-230" href="#lab05-mcp-prompts-__codelineno-20-230"></a><span class="sb">## Project Context</span>
</span><span id="__span-20-231"><a id="__codelineno-20-231" name="__codelineno-20-231" href="#lab05-mcp-prompts-__codelineno-20-231"></a><span class="sb">- **Type**: </span><span class="si">${</span><span class="nx">projectType</span><span class="si">}</span>
</span><span id="__span-20-232"><a id="__codelineno-20-232" name="__codelineno-20-232" href="#lab05-mcp-prompts-__codelineno-20-232"></a><span class="sb">- **Current Phase**: Planning</span>
</span><span id="__span-20-233"><a id="__codelineno-20-233" name="__codelineno-20-233" href="#lab05-mcp-prompts-__codelineno-20-233"></a>
</span><span id="__span-20-234"><a id="__codelineno-20-234" name="__codelineno-20-234" href="#lab05-mcp-prompts-__codelineno-20-234"></a><span class="sb">Please provide a comprehensive development plan with specific phases, deliverables, and best practices.`</span><span class="p">,</span>
</span><span id="__span-20-235"><a id="__codelineno-20-235" name="__codelineno-20-235" href="#lab05-mcp-prompts-__codelineno-20-235"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-236"><a id="__codelineno-20-236" name="__codelineno-20-236" href="#lab05-mcp-prompts-__codelineno-20-236"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-237"><a id="__codelineno-20-237" name="__codelineno-20-237" href="#lab05-mcp-prompts-__codelineno-20-237"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-20-238"><a id="__codelineno-20-238" name="__codelineno-20-238" href="#lab05-mcp-prompts-__codelineno-20-238"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-239"><a id="__codelineno-20-239" name="__codelineno-20-239" href="#lab05-mcp-prompts-__codelineno-20-239"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-240"><a id="__codelineno-20-240" name="__codelineno-20-240" href="#lab05-mcp-prompts-__codelineno-20-240"></a>
</span><span id="__span-20-241"><a id="__codelineno-20-241" name="__codelineno-20-241" href="#lab05-mcp-prompts-__codelineno-20-241"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">createQualityAssessmentPrompt</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">Record</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">any</span><span class="o">&gt;</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-242"><a id="__codelineno-20-242" name="__codelineno-20-242" href="#lab05-mcp-prompts-__codelineno-20-242"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">codeSample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">codeSample</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;[Insert code here]&quot;</span><span class="p">;</span>
</span><span id="__span-20-243"><a id="__codelineno-20-243" name="__codelineno-20-243" href="#lab05-mcp-prompts-__codelineno-20-243"></a>
</span><span id="__span-20-244"><a id="__codelineno-20-244" name="__codelineno-20-244" href="#lab05-mcp-prompts-__codelineno-20-244"></a><span class="w">    </span><span class="c1">// Use tools to analyze the code</span>
</span><span id="__span-20-245"><a id="__codelineno-20-245" name="__codelineno-20-245" href="#lab05-mcp-prompts-__codelineno-20-245"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">analysisResult</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeCodebase</span><span class="p">({</span><span class="w"> </span><span class="nx">path</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;./&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">analysisType</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;structure&quot;</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-20-246"><a id="__codelineno-20-246" name="__codelineno-20-246" href="#lab05-mcp-prompts-__codelineno-20-246"></a>
</span><span id="__span-20-247"><a id="__codelineno-20-247" name="__codelineno-20-247" href="#lab05-mcp-prompts-__codelineno-20-247"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-248"><a id="__codelineno-20-248" name="__codelineno-20-248" href="#lab05-mcp-prompts-__codelineno-20-248"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Comprehensive code quality assessment&quot;</span><span class="p">,</span>
</span><span id="__span-20-249"><a id="__codelineno-20-249" name="__codelineno-20-249" href="#lab05-mcp-prompts-__codelineno-20-249"></a><span class="w">      </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-20-250"><a id="__codelineno-20-250" name="__codelineno-20-250" href="#lab05-mcp-prompts-__codelineno-20-250"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-20-251"><a id="__codelineno-20-251" name="__codelineno-20-251" href="#lab05-mcp-prompts-__codelineno-20-251"></a><span class="w">          </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-20-252"><a id="__codelineno-20-252" name="__codelineno-20-252" href="#lab05-mcp-prompts-__codelineno-20-252"></a><span class="w">          </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-253"><a id="__codelineno-20-253" name="__codelineno-20-253" href="#lab05-mcp-prompts-__codelineno-20-253"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-20-254"><a id="__codelineno-20-254" name="__codelineno-20-254" href="#lab05-mcp-prompts-__codelineno-20-254"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Perform a comprehensive code quality assessment of the following code.</span>
</span><span id="__span-20-255"><a id="__codelineno-20-255" name="__codelineno-20-255" href="#lab05-mcp-prompts-__codelineno-20-255"></a>
</span><span id="__span-20-256"><a id="__codelineno-20-256" name="__codelineno-20-256" href="#lab05-mcp-prompts-__codelineno-20-256"></a><span class="sb">## Code to Assess</span>
</span><span id="__span-20-257"><a id="__codelineno-20-257" name="__codelineno-20-257" href="#lab05-mcp-prompts-__codelineno-20-257"></a><span class="sb">\`\`\`</span>
</span><span id="__span-20-258"><a id="__codelineno-20-258" name="__codelineno-20-258" href="#lab05-mcp-prompts-__codelineno-20-258"></a><span class="si">${</span><span class="nx">codeSample</span><span class="si">}</span>
</span><span id="__span-20-259"><a id="__codelineno-20-259" name="__codelineno-20-259" href="#lab05-mcp-prompts-__codelineno-20-259"></a><span class="sb">\`\`\`</span>
</span><span id="__span-20-260"><a id="__codelineno-20-260" name="__codelineno-20-260" href="#lab05-mcp-prompts-__codelineno-20-260"></a>
</span><span id="__span-20-261"><a id="__codelineno-20-261" name="__codelineno-20-261" href="#lab05-mcp-prompts-__codelineno-20-261"></a><span class="sb">## Automated Analysis Results</span>
</span><span id="__span-20-262"><a id="__codelineno-20-262" name="__codelineno-20-262" href="#lab05-mcp-prompts-__codelineno-20-262"></a><span class="si">${</span><span class="nx">analysisResult</span><span class="p">.</span><span class="nx">content</span><span class="p">[</span><span class="mf">0</span><span class="p">].</span><span class="nx">text</span><span class="si">}</span>
</span><span id="__span-20-263"><a id="__codelineno-20-263" name="__codelineno-20-263" href="#lab05-mcp-prompts-__codelineno-20-263"></a>
</span><span id="__span-20-264"><a id="__codelineno-20-264" name="__codelineno-20-264" href="#lab05-mcp-prompts-__codelineno-20-264"></a><span class="sb">## Assessment Framework</span>
</span><span id="__span-20-265"><a id="__codelineno-20-265" name="__codelineno-20-265" href="#lab05-mcp-prompts-__codelineno-20-265"></a>
</span><span id="__span-20-266"><a id="__codelineno-20-266" name="__codelineno-20-266" href="#lab05-mcp-prompts-__codelineno-20-266"></a><span class="sb">### 1. Code Quality Metrics</span>
</span><span id="__span-20-267"><a id="__codelineno-20-267" name="__codelineno-20-267" href="#lab05-mcp-prompts-__codelineno-20-267"></a><span class="sb">- **Readability**: Is the code easy to understand?</span>
</span><span id="__span-20-268"><a id="__codelineno-20-268" name="__codelineno-20-268" href="#lab05-mcp-prompts-__codelineno-20-268"></a><span class="sb">- **Maintainability**: How easy will this be to modify?</span>
</span><span id="__span-20-269"><a id="__codelineno-20-269" name="__codelineno-20-269" href="#lab05-mcp-prompts-__codelineno-20-269"></a><span class="sb">- **Performance**: Are there any obvious issues?</span>
</span><span id="__span-20-270"><a id="__codelineno-20-270" name="__codelineno-20-270" href="#lab05-mcp-prompts-__codelineno-20-270"></a>
</span><span id="__span-20-271"><a id="__codelineno-20-271" name="__codelineno-20-271" href="#lab05-mcp-prompts-__codelineno-20-271"></a><span class="sb">### 2. Best Practices</span>
</span><span id="__span-20-272"><a id="__codelineno-20-272" name="__codelineno-20-272" href="#lab05-mcp-prompts-__codelineno-20-272"></a><span class="sb">- Does it follow coding standards?</span>
</span><span id="__span-20-273"><a id="__codelineno-20-273" name="__codelineno-20-273" href="#lab05-mcp-prompts-__codelineno-20-273"></a><span class="sb">- Are there appropriate error handling?</span>
</span><span id="__span-20-274"><a id="__codelineno-20-274" name="__codelineno-20-274" href="#lab05-mcp-prompts-__codelineno-20-274"></a><span class="sb">- Is the code well-structured?</span>
</span><span id="__span-20-275"><a id="__codelineno-20-275" name="__codelineno-20-275" href="#lab05-mcp-prompts-__codelineno-20-275"></a>
</span><span id="__span-20-276"><a id="__codelineno-20-276" name="__codelineno-20-276" href="#lab05-mcp-prompts-__codelineno-20-276"></a><span class="sb">### 3. Recommendations</span>
</span><span id="__span-20-277"><a id="__codelineno-20-277" name="__codelineno-20-277" href="#lab05-mcp-prompts-__codelineno-20-277"></a><span class="sb">Provide specific, prioritized recommendations for improvement.</span>
</span><span id="__span-20-278"><a id="__codelineno-20-278" name="__codelineno-20-278" href="#lab05-mcp-prompts-__codelineno-20-278"></a>
</span><span id="__span-20-279"><a id="__codelineno-20-279" name="__codelineno-20-279" href="#lab05-mcp-prompts-__codelineno-20-279"></a><span class="sb">Please provide a thorough assessment.`</span><span class="p">,</span>
</span><span id="__span-20-280"><a id="__codelineno-20-280" name="__codelineno-20-280" href="#lab05-mcp-prompts-__codelineno-20-280"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-20-281"><a id="__codelineno-20-281" name="__codelineno-20-281" href="#lab05-mcp-prompts-__codelineno-20-281"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-20-282"><a id="__codelineno-20-282" name="__codelineno-20-282" href="#lab05-mcp-prompts-__codelineno-20-282"></a><span class="w">      </span><span class="p">],</span>
</span><span id="__span-20-283"><a id="__codelineno-20-283" name="__codelineno-20-283" href="#lab05-mcp-prompts-__codelineno-20-283"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-284"><a id="__codelineno-20-284" name="__codelineno-20-284" href="#lab05-mcp-prompts-__codelineno-20-284"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-285"><a id="__codelineno-20-285" name="__codelineno-20-285" href="#lab05-mcp-prompts-__codelineno-20-285"></a>
</span><span id="__span-20-286"><a id="__codelineno-20-286" name="__codelineno-20-286" href="#lab05-mcp-prompts-__codelineno-20-286"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-287"><a id="__codelineno-20-287" name="__codelineno-20-287" href="#lab05-mcp-prompts-__codelineno-20-287"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-288"><a id="__codelineno-20-288" name="__codelineno-20-288" href="#lab05-mcp-prompts-__codelineno-20-288"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;[MCP Error]&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-20-289"><a id="__codelineno-20-289" name="__codelineno-20-289" href="#lab05-mcp-prompts-__codelineno-20-289"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-20-290"><a id="__codelineno-20-290" name="__codelineno-20-290" href="#lab05-mcp-prompts-__codelineno-20-290"></a>
</span><span id="__span-20-291"><a id="__codelineno-20-291" name="__codelineno-20-291" href="#lab05-mcp-prompts-__codelineno-20-291"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGINT&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-292"><a id="__codelineno-20-292" name="__codelineno-20-292" href="#lab05-mcp-prompts-__codelineno-20-292"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-20-293"><a id="__codelineno-20-293" name="__codelineno-20-293" href="#lab05-mcp-prompts-__codelineno-20-293"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-20-294"><a id="__codelineno-20-294" name="__codelineno-20-294" href="#lab05-mcp-prompts-__codelineno-20-294"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-20-295"><a id="__codelineno-20-295" name="__codelineno-20-295" href="#lab05-mcp-prompts-__codelineno-20-295"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-296"><a id="__codelineno-20-296" name="__codelineno-20-296" href="#lab05-mcp-prompts-__codelineno-20-296"></a>
</span><span id="__span-20-297"><a id="__codelineno-20-297" name="__codelineno-20-297" href="#lab05-mcp-prompts-__codelineno-20-297"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-298"><a id="__codelineno-20-298" name="__codelineno-20-298" href="#lab05-mcp-prompts-__codelineno-20-298"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-20-299"><a id="__codelineno-20-299" name="__codelineno-20-299" href="#lab05-mcp-prompts-__codelineno-20-299"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-20-300"><a id="__codelineno-20-300" name="__codelineno-20-300" href="#lab05-mcp-prompts-__codelineno-20-300"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Complete MCP Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-20-301"><a id="__codelineno-20-301" name="__codelineno-20-301" href="#lab05-mcp-prompts-__codelineno-20-301"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-302"><a id="__codelineno-20-302" name="__codelineno-20-302" href="#lab05-mcp-prompts-__codelineno-20-302"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="lab05-mcp-prompts-step-2-test-complete-integration">Step 2: Test Complete Integration<a class="headerlink" href="#lab05-mcp-prompts-step-2-test-complete-integration" title="Permanent link">&para;</a></h3>
<p><strong>Build and run the complete MCP server:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab05-mcp-prompts-__codelineno-21-1"></a><span class="nb">cd</span><span class="w"> </span>my-complete-mcp-server
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#lab05-mcp-prompts-__codelineno-21-2"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#lab05-mcp-prompts-__codelineno-21-3"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node<span class="w"> </span>dist/index.js
</span></code></pre></div>
<p><strong>Test the complete integration inside the MCP Inspector UI:</strong></p>
<ol>
<li>
<p><strong>Navigate to Tools tab:</strong></p>
<ul>
<li>Click on the &ldquo;Tools&rdquo; tab</li>
</ul>
</li>
<li>
<p><strong>List tools:</strong></p>
<ul>
<li>Click &ldquo;List Tools&rdquo; button</li>
<li>Verify you see the &ldquo;analyze_codebase&rdquo; tool with its description and input schema</li>
</ul>
</li>
<li>
<p><strong>Call tool:</strong></p>
<ul>
<li>Select &ldquo;Call Tool&rdquo; from the dropdown</li>
<li>Enter <code>analyze_codebase</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter: <code>{"path": "./", "analysisType": "structure"}</code></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the response includes a codebase analysis with recommendations</li>
</ul>
</li>
<li>
<p><strong>Navigate to Resources tab:</strong></p>
<ul>
<li>Click on the &ldquo;Resources&rdquo; tab</li>
</ul>
</li>
<li>
<p><strong>List resources:</strong></p>
<ul>
<li>Click &ldquo;List Resources&rdquo; button</li>
<li>Verify you see the knowledge base article (&ldquo;Complete Development Workflow&rdquo;)</li>
</ul>
</li>
<li>
<p><strong>Read resource:</strong></p>
<ul>
<li>Select &ldquo;Read Resource&rdquo; from the dropdown</li>
<li>Enter <code>kb://articles/development-workflow</code> in the &ldquo;URI&rdquo; field</li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the response includes the full development workflow content</li>
</ul>
</li>
<li>
<p><strong>Navigate to Prompts tab:</strong></p>
<ul>
<li>Click on the &ldquo;Prompts&rdquo; tab</li>
</ul>
</li>
<li>
<p><strong>List prompts:</strong></p>
<ul>
<li>Click &ldquo;List Prompts&rdquo; button</li>
<li>Verify you see the &ldquo;full-development-workflow&rdquo; and &ldquo;code-quality-assessment&rdquo; prompts with their arguments</li>
</ul>
</li>
<li>
<p><strong>Get full development workflow prompt:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo;</li>
<li>Enter <code>full-development-workflow</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter: <code>{"projectType": "web"}</code></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Check that the prompt content includes the development workflow from the knowledge base</li>
</ul>
</li>
<li>
<p><strong>Get code quality assessment prompt:</strong></p>
<ul>
<li>Select &ldquo;Get Prompt&rdquo; again</li>
<li>Enter <code>code-quality-assessment</code> in the &ldquo;Name&rdquo; field</li>
<li>In the &ldquo;Arguments&rdquo; field, enter: <code>{"codeSample": "function test() { return true; }"}</code></li>
<li>Click &ldquo;Send Request&rdquo;</li>
<li>Verify the prompt includes automated analysis results and assessment framework</li>
</ul>
</li>
</ol>
<p><br></p>
<p><strong>Expected Results:</strong></p>
<ul>
<li>Tools should list the analysis tool with proper schema and description</li>
<li>Calling tools should return structured analysis results</li>
<li>Resources should list knowledge base articles with proper URIs</li>
<li>Reading resources should return the full markdown content</li>
<li>Prompts should list integrated prompts with their arguments</li>
<li>Getting prompts should dynamically include tool results and resource content</li>
<li>The complete integration should demonstrate all three capabilities working together seamlessly</li>
</ul>
<hr />
<h2 id="lab05-mcp-prompts-hands-on-exercises">Hands-On Exercises<a class="headerlink" href="#lab05-mcp-prompts-hands-on-exercises" title="Permanent link">&para;</a></h2>
<h3 id="lab05-mcp-prompts-exercise-1-custom-prompt-library">Exercise 1: Custom Prompt Library<a class="headerlink" href="#lab05-mcp-prompts-exercise-1-custom-prompt-library" title="Permanent link">&para;</a></h3>
<p><strong>Goal:</strong> Create a specialized prompt library for a specific domain.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Choose a domain (e.g., data science, DevOps, content writing)</li>
<li>Create 3-5 domain-specific prompts</li>
<li>Add appropriate arguments for customization</li>
<li>Include domain-specific resources</li>
<li>Test with the MCP Inspector</li>
</ol>
<p><strong>Requirements:</strong></p>
<ul>
<li>At least one prompt with required arguments</li>
<li>At least one prompt with optional arguments</li>
<li>Include resource integration</li>
<li>Proper error handling</li>
</ul>
<details>
<summary>Solution</summary>

Choose data science domain.<br><br>

Create 3 domain-specific prompts: data-exploration, model-training, visualization.<br><br>

Add arguments: dataset (required), focus (optional).<br><br>

Include domain-specific resources: data science best practices.<br><br>

Example code structure:<br><br>

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab05-mcp-prompts-__codelineno-22-1"></a><span class="c1">// In ListPromptsRequestSchema handler</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#lab05-mcp-prompts-__codelineno-22-2"></a><span class="p">{</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#lab05-mcp-prompts-__codelineno-22-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data-exploration&quot;</span><span class="p">,</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#lab05-mcp-prompts-__codelineno-22-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Guide for exploratory data analysis&quot;</span><span class="p">,</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#lab05-mcp-prompts-__codelineno-22-5"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#lab05-mcp-prompts-__codelineno-22-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#lab05-mcp-prompts-__codelineno-22-7"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#lab05-mcp-prompts-__codelineno-22-8"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Dataset description&quot;</span><span class="p">,</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#lab05-mcp-prompts-__codelineno-22-9"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#lab05-mcp-prompts-__codelineno-22-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#lab05-mcp-prompts-__codelineno-22-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#lab05-mcp-prompts-__codelineno-22-12"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;focus&quot;</span><span class="p">,</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#lab05-mcp-prompts-__codelineno-22-13"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analysis focus (distribution, correlation, outliers)&quot;</span><span class="p">,</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#lab05-mcp-prompts-__codelineno-22-14"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#lab05-mcp-prompts-__codelineno-22-15"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#lab05-mcp-prompts-__codelineno-22-16"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#lab05-mcp-prompts-__codelineno-22-17"></a><span class="p">},</span>
</span><span id="__span-22-18"><a id="__codelineno-22-18" name="__codelineno-22-18" href="#lab05-mcp-prompts-__codelineno-22-18"></a><span class="p">{</span>
</span><span id="__span-22-19"><a id="__codelineno-22-19" name="__codelineno-22-19" href="#lab05-mcp-prompts-__codelineno-22-19"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;model-training&quot;</span><span class="p">,</span>
</span><span id="__span-22-20"><a id="__codelineno-22-20" name="__codelineno-22-20" href="#lab05-mcp-prompts-__codelineno-22-20"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Guide for machine learning model training&quot;</span><span class="p">,</span>
</span><span id="__span-22-21"><a id="__codelineno-22-21" name="__codelineno-22-21" href="#lab05-mcp-prompts-__codelineno-22-21"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-22"><a id="__codelineno-22-22" name="__codelineno-22-22" href="#lab05-mcp-prompts-__codelineno-22-22"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-22-23"><a id="__codelineno-22-23" name="__codelineno-22-23" href="#lab05-mcp-prompts-__codelineno-22-23"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;algorithm&quot;</span><span class="p">,</span>
</span><span id="__span-22-24"><a id="__codelineno-22-24" name="__codelineno-22-24" href="#lab05-mcp-prompts-__codelineno-22-24"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;ML algorithm (linear, tree, neural)&quot;</span><span class="p">,</span>
</span><span id="__span-22-25"><a id="__codelineno-22-25" name="__codelineno-22-25" href="#lab05-mcp-prompts-__codelineno-22-25"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-22-26"><a id="__codelineno-22-26" name="__codelineno-22-26" href="#lab05-mcp-prompts-__codelineno-22-26"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-27"><a id="__codelineno-22-27" name="__codelineno-22-27" href="#lab05-mcp-prompts-__codelineno-22-27"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-22-28"><a id="__codelineno-22-28" name="__codelineno-22-28" href="#lab05-mcp-prompts-__codelineno-22-28"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
</span><span id="__span-22-29"><a id="__codelineno-22-29" name="__codelineno-22-29" href="#lab05-mcp-prompts-__codelineno-22-29"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Target variable&quot;</span><span class="p">,</span>
</span><span id="__span-22-30"><a id="__codelineno-22-30" name="__codelineno-22-30" href="#lab05-mcp-prompts-__codelineno-22-30"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-22-31"><a id="__codelineno-22-31" name="__codelineno-22-31" href="#lab05-mcp-prompts-__codelineno-22-31"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-32"><a id="__codelineno-22-32" name="__codelineno-22-32" href="#lab05-mcp-prompts-__codelineno-22-32"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-22-33"><a id="__codelineno-22-33" name="__codelineno-22-33" href="#lab05-mcp-prompts-__codelineno-22-33"></a><span class="p">},</span>
</span><span id="__span-22-34"><a id="__codelineno-22-34" name="__codelineno-22-34" href="#lab05-mcp-prompts-__codelineno-22-34"></a><span class="p">{</span>
</span><span id="__span-22-35"><a id="__codelineno-22-35" name="__codelineno-22-35" href="#lab05-mcp-prompts-__codelineno-22-35"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;data-visualization&quot;</span><span class="p">,</span>
</span><span id="__span-22-36"><a id="__codelineno-22-36" name="__codelineno-22-36" href="#lab05-mcp-prompts-__codelineno-22-36"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Guide for creating effective data visualizations&quot;</span><span class="p">,</span>
</span><span id="__span-22-37"><a id="__codelineno-22-37" name="__codelineno-22-37" href="#lab05-mcp-prompts-__codelineno-22-37"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-38"><a id="__codelineno-22-38" name="__codelineno-22-38" href="#lab05-mcp-prompts-__codelineno-22-38"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-22-39"><a id="__codelineno-22-39" name="__codelineno-22-39" href="#lab05-mcp-prompts-__codelineno-22-39"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;chartType&quot;</span><span class="p">,</span>
</span><span id="__span-22-40"><a id="__codelineno-22-40" name="__codelineno-22-40" href="#lab05-mcp-prompts-__codelineno-22-40"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Type of chart (bar, line, scatter)&quot;</span><span class="p">,</span>
</span><span id="__span-22-41"><a id="__codelineno-22-41" name="__codelineno-22-41" href="#lab05-mcp-prompts-__codelineno-22-41"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-22-42"><a id="__codelineno-22-42" name="__codelineno-22-42" href="#lab05-mcp-prompts-__codelineno-22-42"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-22-43"><a id="__codelineno-22-43" name="__codelineno-22-43" href="#lab05-mcp-prompts-__codelineno-22-43"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-22-44"><a id="__codelineno-22-44" name="__codelineno-22-44" href="#lab05-mcp-prompts-__codelineno-22-44"></a><span class="p">}</span>
</span><span id="__span-22-45"><a id="__codelineno-22-45" name="__codelineno-22-45" href="#lab05-mcp-prompts-__codelineno-22-45"></a>
</span><span id="__span-22-46"><a id="__codelineno-22-46" name="__codelineno-22-46" href="#lab05-mcp-prompts-__codelineno-22-46"></a><span class="c1">// In generatePrompt method</span>
</span><span id="__span-22-47"><a id="__codelineno-22-47" name="__codelineno-22-47" href="#lab05-mcp-prompts-__codelineno-22-47"></a><span class="k">case</span><span class="w"> </span><span class="s2">&quot;data-exploration&quot;</span><span class="o">:</span>
</span><span id="__span-22-48"><a id="__codelineno-22-48" name="__codelineno-22-48" href="#lab05-mcp-prompts-__codelineno-22-48"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">dataset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">dataset</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;dataset&quot;</span><span class="p">;</span>
</span><span id="__span-22-49"><a id="__codelineno-22-49" name="__codelineno-22-49" href="#lab05-mcp-prompts-__codelineno-22-49"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">focus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">focus</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;distribution&quot;</span><span class="p">;</span>
</span><span id="__span-22-50"><a id="__codelineno-22-50" name="__codelineno-22-50" href="#lab05-mcp-prompts-__codelineno-22-50"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-51"><a id="__codelineno-22-51" name="__codelineno-22-51" href="#lab05-mcp-prompts-__codelineno-22-51"></a><span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`Data exploration for </span><span class="si">${</span><span class="nx">dataset</span><span class="si">}</span><span class="sb"> focusing on </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-22-52"><a id="__codelineno-22-52" name="__codelineno-22-52" href="#lab05-mcp-prompts-__codelineno-22-52"></a><span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-22-53"><a id="__codelineno-22-53" name="__codelineno-22-53" href="#lab05-mcp-prompts-__codelineno-22-53"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-22-54"><a id="__codelineno-22-54" name="__codelineno-22-54" href="#lab05-mcp-prompts-__codelineno-22-54"></a><span class="w">        </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-22-55"><a id="__codelineno-22-55" name="__codelineno-22-55" href="#lab05-mcp-prompts-__codelineno-22-55"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-56"><a id="__codelineno-22-56" name="__codelineno-22-56" href="#lab05-mcp-prompts-__codelineno-22-56"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-22-57"><a id="__codelineno-22-57" name="__codelineno-22-57" href="#lab05-mcp-prompts-__codelineno-22-57"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Perform exploratory data analysis on the </span><span class="si">${</span><span class="nx">dataset</span><span class="si">}</span><span class="sb"> dataset.</span>
</span><span id="__span-22-58"><a id="__codelineno-22-58" name="__codelineno-22-58" href="#lab05-mcp-prompts-__codelineno-22-58"></a>
</span><span id="__span-22-59"><a id="__codelineno-22-59" name="__codelineno-22-59" href="#lab05-mcp-prompts-__codelineno-22-59"></a><span class="sb">Focus areas: </span><span class="si">${</span><span class="nx">focus</span><span class="si">}</span>
</span><span id="__span-22-60"><a id="__codelineno-22-60" name="__codelineno-22-60" href="#lab05-mcp-prompts-__codelineno-22-60"></a>
</span><span id="__span-22-61"><a id="__codelineno-22-61" name="__codelineno-22-61" href="#lab05-mcp-prompts-__codelineno-22-61"></a><span class="sb">Guidelines:</span>
</span><span id="__span-22-62"><a id="__codelineno-22-62" name="__codelineno-22-62" href="#lab05-mcp-prompts-__codelineno-22-62"></a><span class="sb">- Examine data structure and types</span>
</span><span id="__span-22-63"><a id="__codelineno-22-63" name="__codelineno-22-63" href="#lab05-mcp-prompts-__codelineno-22-63"></a><span class="sb">- Check for missing values and outliers</span>
</span><span id="__span-22-64"><a id="__codelineno-22-64" name="__codelineno-22-64" href="#lab05-mcp-prompts-__codelineno-22-64"></a><span class="sb">- Analyze distributions and correlations</span>
</span><span id="__span-22-65"><a id="__codelineno-22-65" name="__codelineno-22-65" href="#lab05-mcp-prompts-__codelineno-22-65"></a><span class="sb">- Generate summary statistics</span>
</span><span id="__span-22-66"><a id="__codelineno-22-66" name="__codelineno-22-66" href="#lab05-mcp-prompts-__codelineno-22-66"></a>
</span><span id="__span-22-67"><a id="__codelineno-22-67" name="__codelineno-22-67" href="#lab05-mcp-prompts-__codelineno-22-67"></a><span class="sb">Provide insights and recommendations.`</span><span class="p">,</span>
</span><span id="__span-22-68"><a id="__codelineno-22-68" name="__codelineno-22-68" href="#lab05-mcp-prompts-__codelineno-22-68"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-22-69"><a id="__codelineno-22-69" name="__codelineno-22-69" href="#lab05-mcp-prompts-__codelineno-22-69"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-22-70"><a id="__codelineno-22-70" name="__codelineno-22-70" href="#lab05-mcp-prompts-__codelineno-22-70"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-22-71"><a id="__codelineno-22-71" name="__codelineno-22-71" href="#lab05-mcp-prompts-__codelineno-22-71"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-22-72"><a id="__codelineno-22-72" name="__codelineno-22-72" href="#lab05-mcp-prompts-__codelineno-22-72"></a>
</span><span id="__span-22-73"><a id="__codelineno-22-73" name="__codelineno-22-73" href="#lab05-mcp-prompts-__codelineno-22-73"></a><span class="c1">// Add resources in initializeKnowledgeBase</span>
</span><span id="__span-22-74"><a id="__codelineno-22-74" name="__codelineno-22-74" href="#lab05-mcp-prompts-__codelineno-22-74"></a><span class="k">this</span><span class="p">.</span><span class="nx">knowledgeBase</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&quot;data-science-practices&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-22-75"><a id="__codelineno-22-75" name="__codelineno-22-75" href="#lab05-mcp-prompts-__codelineno-22-75"></a><span class="w">  </span><span class="nx">title</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Data Science Best Practices&quot;</span><span class="p">,</span>
</span><span id="__span-22-76"><a id="__codelineno-22-76" name="__codelineno-22-76" href="#lab05-mcp-prompts-__codelineno-22-76"></a><span class="w">  </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span>
</span><span id="__span-22-77"><a id="__codelineno-22-77" name="__codelineno-22-77" href="#lab05-mcp-prompts-__codelineno-22-77"></a><span class="sb">Data Quality</span>
</span><span id="__span-22-78"><a id="__codelineno-22-78" name="__codelineno-22-78" href="#lab05-mcp-prompts-__codelineno-22-78"></a><span class="sb">- Validate data integrity</span>
</span><span id="__span-22-79"><a id="__codelineno-22-79" name="__codelineno-22-79" href="#lab05-mcp-prompts-__codelineno-22-79"></a><span class="sb">- Handle missing values appropriately</span>
</span><span id="__span-22-80"><a id="__codelineno-22-80" name="__codelineno-22-80" href="#lab05-mcp-prompts-__codelineno-22-80"></a><span class="sb">- Check for data consistency</span>
</span><span id="__span-22-81"><a id="__codelineno-22-81" name="__codelineno-22-81" href="#lab05-mcp-prompts-__codelineno-22-81"></a>
</span><span id="__span-22-82"><a id="__codelineno-22-82" name="__codelineno-22-82" href="#lab05-mcp-prompts-__codelineno-22-82"></a><span class="sb">Analysis Process</span>
</span><span id="__span-22-83"><a id="__codelineno-22-83" name="__codelineno-22-83" href="#lab05-mcp-prompts-__codelineno-22-83"></a><span class="sb">- Start with descriptive statistics</span>
</span><span id="__span-22-84"><a id="__codelineno-22-84" name="__codelineno-22-84" href="#lab05-mcp-prompts-__codelineno-22-84"></a><span class="sb">- Use visualizations for insights</span>
</span><span id="__span-22-85"><a id="__codelineno-22-85" name="__codelineno-22-85" href="#lab05-mcp-prompts-__codelineno-22-85"></a><span class="sb">- Test hypotheses systematically</span>
</span><span id="__span-22-86"><a id="__codelineno-22-86" name="__codelineno-22-86" href="#lab05-mcp-prompts-__codelineno-22-86"></a><span class="sb">  `</span><span class="p">,</span>
</span><span id="__span-22-87"><a id="__codelineno-22-87" name="__codelineno-22-87" href="#lab05-mcp-prompts-__codelineno-22-87"></a><span class="p">});</span>
</span></code></pre></div>

Test with MCP Inspector by listing prompts, getting prompts with different arguments, and verifying resource integration.
</details>

<h3 id="lab05-mcp-prompts-exercise-2-multi-step-workflow-prompt">Exercise 2: Multi-Step Workflow Prompt<a class="headerlink" href="#lab05-mcp-prompts-exercise-2-multi-step-workflow-prompt" title="Permanent link">&para;</a></h3>
<p><strong>Goal:</strong> Create a prompt that guides users through complex, multi-step processes.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Design a multi-step workflow (e.g., code review ‚Üí testing ‚Üí deployment)</li>
<li>Create prompts for each step</li>
<li>Add logic to chain prompts together</li>
<li>Include progress tracking</li>
<li>Test the complete workflow</li>
</ol>
<p><strong>Requirements:</strong></p>
<ul>
<li>Clear step progression</li>
<li>State management between steps</li>
<li>Error handling and recovery</li>
<li>Progress indicators</li>
</ul>
<details>
<summary>Solution</summary>

Design a code review to deployment workflow with steps: review, testing, deployment.<br><br>

Create prompts for each step with currentStep argument.<br><br>

Add logic to chain prompts and track progress.<br><br>

Example code structure:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab05-mcp-prompts-__codelineno-23-1"></a><span class="c1">// In ListPromptsRequestSchema handler</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab05-mcp-prompts-__codelineno-23-2"></a><span class="p">{</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#lab05-mcp-prompts-__codelineno-23-3"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;workflow-step&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#lab05-mcp-prompts-__codelineno-23-4"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Multi-step development workflow guidance&quot;</span><span class="p">,</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#lab05-mcp-prompts-__codelineno-23-5"></a><span class="w">  </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#lab05-mcp-prompts-__codelineno-23-6"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#lab05-mcp-prompts-__codelineno-23-7"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;currentStep&quot;</span><span class="p">,</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#lab05-mcp-prompts-__codelineno-23-8"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Current workflow step (review, testing, deployment)&quot;</span><span class="p">,</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#lab05-mcp-prompts-__codelineno-23-9"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#lab05-mcp-prompts-__codelineno-23-10"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#lab05-mcp-prompts-__codelineno-23-11"></a><span class="w">    </span><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#lab05-mcp-prompts-__codelineno-23-12"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;projectType&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#lab05-mcp-prompts-__codelineno-23-13"></a><span class="w">      </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Type of project&quot;</span><span class="p">,</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#lab05-mcp-prompts-__codelineno-23-14"></a><span class="w">      </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span><span class="p">,</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#lab05-mcp-prompts-__codelineno-23-15"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#lab05-mcp-prompts-__codelineno-23-16"></a><span class="w">  </span><span class="p">],</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#lab05-mcp-prompts-__codelineno-23-17"></a><span class="p">}</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#lab05-mcp-prompts-__codelineno-23-18"></a>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#lab05-mcp-prompts-__codelineno-23-19"></a><span class="c1">// In generatePrompt method</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#lab05-mcp-prompts-__codelineno-23-20"></a><span class="k">case</span><span class="w"> </span><span class="s2">&quot;workflow-step&quot;</span><span class="o">:</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#lab05-mcp-prompts-__codelineno-23-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">step</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">currentStep</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;review&quot;</span><span class="p">;</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#lab05-mcp-prompts-__codelineno-23-22"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">projectType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">.</span><span class="nx">projectType</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;web&quot;</span><span class="p">;</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#lab05-mcp-prompts-__codelineno-23-23"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">workflowSteps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;review&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;testing&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;deployment&quot;</span><span class="p">];</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#lab05-mcp-prompts-__codelineno-23-24"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">currentIndex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">workflowSteps</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">step</span><span class="p">);</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#lab05-mcp-prompts-__codelineno-23-25"></a>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#lab05-mcp-prompts-__codelineno-23-26"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#lab05-mcp-prompts-__codelineno-23-27"></a><span class="w">    </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="sb">`</span><span class="si">${</span><span class="nx">projectType</span><span class="si">}</span><span class="sb"> development workflow - Step </span><span class="si">${</span><span class="nx">currentIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">step</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#lab05-mcp-prompts-__codelineno-23-28"></a><span class="w">    </span><span class="nx">messages</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#lab05-mcp-prompts-__codelineno-23-29"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#lab05-mcp-prompts-__codelineno-23-30"></a><span class="w">        </span><span class="nx">role</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#lab05-mcp-prompts-__codelineno-23-31"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#lab05-mcp-prompts-__codelineno-23-32"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#lab05-mcp-prompts-__codelineno-23-33"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Guide for </span><span class="si">${</span><span class="nx">projectType</span><span class="si">}</span><span class="sb"> project </span><span class="si">${</span><span class="nx">step</span><span class="si">}</span><span class="sb"> phase.</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#lab05-mcp-prompts-__codelineno-23-34"></a>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#lab05-mcp-prompts-__codelineno-23-35"></a><span class="sb">Progress: Step </span><span class="si">${</span><span class="nx">currentIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="si">}</span><span class="sb"> of </span><span class="si">${</span><span class="nx">workflowSteps</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#lab05-mcp-prompts-__codelineno-23-36"></a><span class="sb">Previous steps: </span><span class="si">${</span><span class="nx">workflowSteps</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="nx">currentIndex</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;None&#39;</span><span class="si">}</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#lab05-mcp-prompts-__codelineno-23-37"></a><span class="sb">Next steps: </span><span class="si">${</span><span class="nx">workflowSteps</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">currentIndex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;, &#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;Complete&#39;</span><span class="si">}</span>
</span><span id="__span-23-38"><a id="__codelineno-23-38" name="__codelineno-23-38" href="#lab05-mcp-prompts-__codelineno-23-38"></a>
</span><span id="__span-23-39"><a id="__codelineno-23-39" name="__codelineno-23-39" href="#lab05-mcp-prompts-__codelineno-23-39"></a><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">getStepGuidance</span><span class="p">(</span><span class="nx">step</span><span class="p">,</span><span class="w"> </span><span class="nx">projectType</span><span class="p">)</span><span class="si">}</span>
</span><span id="__span-23-40"><a id="__codelineno-23-40" name="__codelineno-23-40" href="#lab05-mcp-prompts-__codelineno-23-40"></a>
</span><span id="__span-23-41"><a id="__codelineno-23-41" name="__codelineno-23-41" href="#lab05-mcp-prompts-__codelineno-23-41"></a><span class="sb">Provide detailed guidance and check completion criteria before proceeding.`</span><span class="p">,</span>
</span><span id="__span-23-42"><a id="__codelineno-23-42" name="__codelineno-23-42" href="#lab05-mcp-prompts-__codelineno-23-42"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-23-43"><a id="__codelineno-23-43" name="__codelineno-23-43" href="#lab05-mcp-prompts-__codelineno-23-43"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-44"><a id="__codelineno-23-44" name="__codelineno-23-44" href="#lab05-mcp-prompts-__codelineno-23-44"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-23-45"><a id="__codelineno-23-45" name="__codelineno-23-45" href="#lab05-mcp-prompts-__codelineno-23-45"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-23-46"><a id="__codelineno-23-46" name="__codelineno-23-46" href="#lab05-mcp-prompts-__codelineno-23-46"></a>
</span><span id="__span-23-47"><a id="__codelineno-23-47" name="__codelineno-23-47" href="#lab05-mcp-prompts-__codelineno-23-47"></a><span class="c1">// Helper method</span>
</span><span id="__span-23-48"><a id="__codelineno-23-48" name="__codelineno-23-48" href="#lab05-mcp-prompts-__codelineno-23-48"></a><span class="k">private</span><span class="w"> </span><span class="nx">getStepGuidance</span><span class="p">(</span><span class="nx">step</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">projectType</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-49"><a id="__codelineno-23-49" name="__codelineno-23-49" href="#lab05-mcp-prompts-__codelineno-23-49"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">guidance</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="p">[</span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">]</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-50"><a id="__codelineno-23-50" name="__codelineno-23-50" href="#lab05-mcp-prompts-__codelineno-23-50"></a><span class="w">    </span><span class="nx">review</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-51"><a id="__codelineno-23-51" name="__codelineno-23-51" href="#lab05-mcp-prompts-__codelineno-23-51"></a><span class="w">      </span><span class="nx">web</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Code Review Guidelines:\n- Check code quality and standards\n- Verify security practices\n- Review performance considerations\n- Validate functionality&quot;</span><span class="p">,</span>
</span><span id="__span-23-52"><a id="__codelineno-23-52" name="__codelineno-23-52" href="#lab05-mcp-prompts-__codelineno-23-52"></a><span class="w">      </span><span class="nx">api</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API Review Guidelines:\n- Check endpoint design\n- Validate error handling\n- Review authentication\n- Test API contracts&quot;</span><span class="p">,</span>
</span><span id="__span-23-53"><a id="__codelineno-23-53" name="__codelineno-23-53" href="#lab05-mcp-prompts-__codelineno-23-53"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-54"><a id="__codelineno-23-54" name="__codelineno-23-54" href="#lab05-mcp-prompts-__codelineno-23-54"></a><span class="w">    </span><span class="nx">testing</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-55"><a id="__codelineno-23-55" name="__codelineno-23-55" href="#lab05-mcp-prompts-__codelineno-23-55"></a><span class="w">      </span><span class="nx">web</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Testing Guidelines:\n- Unit test coverage\n- Integration testing\n- User acceptance testing\n- Performance testing&quot;</span><span class="p">,</span>
</span><span id="__span-23-56"><a id="__codelineno-23-56" name="__codelineno-23-56" href="#lab05-mcp-prompts-__codelineno-23-56"></a><span class="w">      </span><span class="nx">api</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API Testing Guidelines:\n- Endpoint testing\n- Load testing\n- Security testing\n- Contract testing&quot;</span><span class="p">,</span>
</span><span id="__span-23-57"><a id="__codelineno-23-57" name="__codelineno-23-57" href="#lab05-mcp-prompts-__codelineno-23-57"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-58"><a id="__codelineno-23-58" name="__codelineno-23-58" href="#lab05-mcp-prompts-__codelineno-23-58"></a><span class="w">    </span><span class="nx">deployment</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-59"><a id="__codelineno-23-59" name="__codelineno-23-59" href="#lab05-mcp-prompts-__codelineno-23-59"></a><span class="w">      </span><span class="nx">web</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Deployment Guidelines:\n- Environment configuration\n- Database migrations\n- Rollback procedures\n- Monitoring setup&quot;</span><span class="p">,</span>
</span><span id="__span-23-60"><a id="__codelineno-23-60" name="__codelineno-23-60" href="#lab05-mcp-prompts-__codelineno-23-60"></a><span class="w">      </span><span class="nx">api</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;API Deployment Guidelines:\n- API gateway configuration\n- Version management\n- Documentation publishing\n- Client notifications&quot;</span><span class="p">,</span>
</span><span id="__span-23-61"><a id="__codelineno-23-61" name="__codelineno-23-61" href="#lab05-mcp-prompts-__codelineno-23-61"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-62"><a id="__codelineno-23-62" name="__codelineno-23-62" href="#lab05-mcp-prompts-__codelineno-23-62"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-23-63"><a id="__codelineno-23-63" name="__codelineno-23-63" href="#lab05-mcp-prompts-__codelineno-23-63"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">guidance</span><span class="p">[</span><span class="nx">step</span><span class="p">]</span><span class="o">?</span><span class="p">.[</span><span class="nx">projectType</span><span class="p">]</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;Follow standard practices for this step.&quot;</span><span class="p">;</span>
</span><span id="__span-23-64"><a id="__codelineno-23-64" name="__codelineno-23-64" href="#lab05-mcp-prompts-__codelineno-23-64"></a><span class="p">}</span>
</span></code></pre></div>

Test the workflow by calling the prompt with different currentStep values and verifying step progression and guidance.

</details>

<h3 id="lab05-mcp-prompts-exercise-3-production-ready-server">Exercise 3: Production-Ready Server<a class="headerlink" href="#lab05-mcp-prompts-exercise-3-production-ready-server" title="Permanent link">&para;</a></h3>
<p><strong>Goal:</strong> Create a production-ready MCP server with all capabilities.</p>
<p><strong>Steps:</strong></p>
<ol>
<li>Implement comprehensive error handling</li>
<li>Add logging and monitoring</li>
<li>Include health checks</li>
<li>Add configuration management</li>
<li>Implement rate limiting</li>
<li>Create deployment scripts</li>
</ol>
<p><strong>Requirements:</strong></p>
<ul>
<li>Structured logging</li>
<li>Health check endpoints</li>
<li>Configuration validation</li>
<li>Graceful shutdown</li>
<li>Performance monitoring</li>
</ul>
<details>
<summary>Solution</summary>

Implement comprehensive error handling, logging, health checks, configuration management, rate limiting, and deployment scripts.<br><br>

Example code structure:

<div class="language-typescript highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab05-mcp-prompts-__codelineno-24-1"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#lab05-mcp-prompts-__codelineno-24-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#lab05-mcp-prompts-__codelineno-24-3"></a>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#lab05-mcp-prompts-__codelineno-24-4"></a><span class="kd">class</span><span class="w"> </span><span class="nx">ProductionMCPServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#lab05-mcp-prompts-__codelineno-24-5"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#lab05-mcp-prompts-__codelineno-24-6"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">config</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">;</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#lab05-mcp-prompts-__codelineno-24-7"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">requestCount</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#lab05-mcp-prompts-__codelineno-24-8"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">startTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#lab05-mcp-prompts-__codelineno-24-9"></a>
</span><span id="__span-24-10"><a id="__codelineno-24-10" name="__codelineno-24-10" href="#lab05-mcp-prompts-__codelineno-24-10"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">(</span><span class="nx">configPath?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-11"><a id="__codelineno-24-11" name="__codelineno-24-11" href="#lab05-mcp-prompts-__codelineno-24-11"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">loadConfiguration</span><span class="p">(</span><span class="nx">configPath</span><span class="p">);</span>
</span><span id="__span-24-12"><a id="__codelineno-24-12" name="__codelineno-24-12" href="#lab05-mcp-prompts-__codelineno-24-12"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-24-13"><a id="__codelineno-24-13" name="__codelineno-24-13" href="#lab05-mcp-prompts-__codelineno-24-13"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-24-14"><a id="__codelineno-24-14" name="__codelineno-24-14" href="#lab05-mcp-prompts-__codelineno-24-14"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">this.config.name</span><span class="p">,</span>
</span><span id="__span-24-15"><a id="__codelineno-24-15" name="__codelineno-24-15" href="#lab05-mcp-prompts-__codelineno-24-15"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="kt">this.config.version</span><span class="p">,</span>
</span><span id="__span-24-16"><a id="__codelineno-24-16" name="__codelineno-24-16" href="#lab05-mcp-prompts-__codelineno-24-16"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-24-17"><a id="__codelineno-24-17" name="__codelineno-24-17" href="#lab05-mcp-prompts-__codelineno-24-17"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-24-18"><a id="__codelineno-24-18" name="__codelineno-24-18" href="#lab05-mcp-prompts-__codelineno-24-18"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-19"><a id="__codelineno-24-19" name="__codelineno-24-19" href="#lab05-mcp-prompts-__codelineno-24-19"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-24-20"><a id="__codelineno-24-20" name="__codelineno-24-20" href="#lab05-mcp-prompts-__codelineno-24-20"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-24-21"><a id="__codelineno-24-21" name="__codelineno-24-21" href="#lab05-mcp-prompts-__codelineno-24-21"></a><span class="w">          </span><span class="nx">prompts</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-24-22"><a id="__codelineno-24-22" name="__codelineno-24-22" href="#lab05-mcp-prompts-__codelineno-24-22"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-24-23"><a id="__codelineno-24-23" name="__codelineno-24-23" href="#lab05-mcp-prompts-__codelineno-24-23"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-24-24"><a id="__codelineno-24-24" name="__codelineno-24-24" href="#lab05-mcp-prompts-__codelineno-24-24"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-24-25"><a id="__codelineno-24-25" name="__codelineno-24-25" href="#lab05-mcp-prompts-__codelineno-24-25"></a>
</span><span id="__span-24-26"><a id="__codelineno-24-26" name="__codelineno-24-26" href="#lab05-mcp-prompts-__codelineno-24-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupLogging</span><span class="p">();</span>
</span><span id="__span-24-27"><a id="__codelineno-24-27" name="__codelineno-24-27" href="#lab05-mcp-prompts-__codelineno-24-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-24-28"><a id="__codelineno-24-28" name="__codelineno-24-28" href="#lab05-mcp-prompts-__codelineno-24-28"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupErrorHandling</span><span class="p">();</span>
</span><span id="__span-24-29"><a id="__codelineno-24-29" name="__codelineno-24-29" href="#lab05-mcp-prompts-__codelineno-24-29"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHealthChecks</span><span class="p">();</span>
</span><span id="__span-24-30"><a id="__codelineno-24-30" name="__codelineno-24-30" href="#lab05-mcp-prompts-__codelineno-24-30"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-31"><a id="__codelineno-24-31" name="__codelineno-24-31" href="#lab05-mcp-prompts-__codelineno-24-31"></a>
</span><span id="__span-24-32"><a id="__codelineno-24-32" name="__codelineno-24-32" href="#lab05-mcp-prompts-__codelineno-24-32"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">loadConfiguration</span><span class="p">(</span><span class="nx">configPath?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-33"><a id="__codelineno-24-33" name="__codelineno-24-33" href="#lab05-mcp-prompts-__codelineno-24-33"></a><span class="w">    </span><span class="c1">// Load from file or environment</span>
</span><span id="__span-24-34"><a id="__codelineno-24-34" name="__codelineno-24-34" href="#lab05-mcp-prompts-__codelineno-24-34"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-35"><a id="__codelineno-24-35" name="__codelineno-24-35" href="#lab05-mcp-prompts-__codelineno-24-35"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;production-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-24-36"><a id="__codelineno-24-36" name="__codelineno-24-36" href="#lab05-mcp-prompts-__codelineno-24-36"></a><span class="w">      </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-24-37"><a id="__codelineno-24-37" name="__codelineno-24-37" href="#lab05-mcp-prompts-__codelineno-24-37"></a><span class="w">      </span><span class="nx">port</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">3000</span><span class="p">,</span>
</span><span id="__span-24-38"><a id="__codelineno-24-38" name="__codelineno-24-38" href="#lab05-mcp-prompts-__codelineno-24-38"></a><span class="w">      </span><span class="nx">logLevel</span><span class="o">:</span><span class="w"> </span><span class="kt">process.env.LOG_LEVEL</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;info&quot;</span><span class="p">,</span>
</span><span id="__span-24-39"><a id="__codelineno-24-39" name="__codelineno-24-39" href="#lab05-mcp-prompts-__codelineno-24-39"></a><span class="w">      </span><span class="nx">rateLimit</span><span class="o">:</span><span class="w"> </span><span class="kt">parseInt</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">RATE_LIMIT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s2">&quot;100&quot;</span><span class="p">),</span>
</span><span id="__span-24-40"><a id="__codelineno-24-40" name="__codelineno-24-40" href="#lab05-mcp-prompts-__codelineno-24-40"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-41"><a id="__codelineno-24-41" name="__codelineno-24-41" href="#lab05-mcp-prompts-__codelineno-24-41"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-42"><a id="__codelineno-24-42" name="__codelineno-24-42" href="#lab05-mcp-prompts-__codelineno-24-42"></a>
</span><span id="__span-24-43"><a id="__codelineno-24-43" name="__codelineno-24-43" href="#lab05-mcp-prompts-__codelineno-24-43"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupLogging</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-44"><a id="__codelineno-24-44" name="__codelineno-24-44" href="#lab05-mcp-prompts-__codelineno-24-44"></a><span class="w">    </span><span class="c1">// Use a proper logging library in production</span>
</span><span id="__span-24-45"><a id="__codelineno-24-45" name="__codelineno-24-45" href="#lab05-mcp-prompts-__codelineno-24-45"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createLogger</span><span class="p">(</span><span class="s2">&quot;info&quot;</span><span class="p">);</span>
</span><span id="__span-24-46"><a id="__codelineno-24-46" name="__codelineno-24-46" href="#lab05-mcp-prompts-__codelineno-24-46"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">createLogger</span><span class="p">(</span><span class="s2">&quot;error&quot;</span><span class="p">);</span>
</span><span id="__span-24-47"><a id="__codelineno-24-47" name="__codelineno-24-47" href="#lab05-mcp-prompts-__codelineno-24-47"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-48"><a id="__codelineno-24-48" name="__codelineno-24-48" href="#lab05-mcp-prompts-__codelineno-24-48"></a>
</span><span id="__span-24-49"><a id="__codelineno-24-49" name="__codelineno-24-49" href="#lab05-mcp-prompts-__codelineno-24-49"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">createLogger</span><span class="p">(</span><span class="nx">level</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="nx">...args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-50"><a id="__codelineno-24-50" name="__codelineno-24-50" href="#lab05-mcp-prompts-__codelineno-24-50"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="nx">...args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[])</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-51"><a id="__codelineno-24-51" name="__codelineno-24-51" href="#lab05-mcp-prompts-__codelineno-24-51"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
</span><span id="__span-24-52"><a id="__codelineno-24-52" name="__codelineno-24-52" href="#lab05-mcp-prompts-__codelineno-24-52"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">stderr</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`[</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">] </span><span class="si">${</span><span class="nx">level</span><span class="p">.</span><span class="nx">toUpperCase</span><span class="p">()</span><span class="si">}</span><span class="sb">: </span><span class="si">${</span><span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-24-53"><a id="__codelineno-24-53" name="__codelineno-24-53" href="#lab05-mcp-prompts-__codelineno-24-53"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-54"><a id="__codelineno-24-54" name="__codelineno-24-54" href="#lab05-mcp-prompts-__codelineno-24-54"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-55"><a id="__codelineno-24-55" name="__codelineno-24-55" href="#lab05-mcp-prompts-__codelineno-24-55"></a>
</span><span id="__span-24-56"><a id="__codelineno-24-56" name="__codelineno-24-56" href="#lab05-mcp-prompts-__codelineno-24-56"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-57"><a id="__codelineno-24-57" name="__codelineno-24-57" href="#lab05-mcp-prompts-__codelineno-24-57"></a><span class="w">    </span><span class="c1">// Add rate limiting to handlers</span>
</span><span id="__span-24-58"><a id="__codelineno-24-58" name="__codelineno-24-58" href="#lab05-mcp-prompts-__codelineno-24-58"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">rateLimitedHandler</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-59"><a id="__codelineno-24-59" name="__codelineno-24-59" href="#lab05-mcp-prompts-__codelineno-24-59"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span><span class="w"> </span><span class="p">};</span>
</span><span id="__span-24-60"><a id="__codelineno-24-60" name="__codelineno-24-60" href="#lab05-mcp-prompts-__codelineno-24-60"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-24-61"><a id="__codelineno-24-61" name="__codelineno-24-61" href="#lab05-mcp-prompts-__codelineno-24-61"></a>
</span><span id="__span-24-62"><a id="__codelineno-24-62" name="__codelineno-24-62" href="#lab05-mcp-prompts-__codelineno-24-62"></a><span class="w">    </span><span class="c1">// Add other handlers similarly</span>
</span><span id="__span-24-63"><a id="__codelineno-24-63" name="__codelineno-24-63" href="#lab05-mcp-prompts-__codelineno-24-63"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-64"><a id="__codelineno-24-64" name="__codelineno-24-64" href="#lab05-mcp-prompts-__codelineno-24-64"></a>
</span><span id="__span-24-65"><a id="__codelineno-24-65" name="__codelineno-24-65" href="#lab05-mcp-prompts-__codelineno-24-65"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">rateLimitedHandler</span><span class="p">(</span><span class="nx">handler</span><span class="o">:</span><span class="w"> </span><span class="kt">Function</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Function</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-66"><a id="__codelineno-24-66" name="__codelineno-24-66" href="#lab05-mcp-prompts-__codelineno-24-66"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-67"><a id="__codelineno-24-67" name="__codelineno-24-67" href="#lab05-mcp-prompts-__codelineno-24-67"></a><span class="w">      </span><span class="k">this</span><span class="p">.</span><span class="nx">requestCount</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-24-68"><a id="__codelineno-24-68" name="__codelineno-24-68" href="#lab05-mcp-prompts-__codelineno-24-68"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">requestCount</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">rateLimit</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-69"><a id="__codelineno-24-69" name="__codelineno-24-69" href="#lab05-mcp-prompts-__codelineno-24-69"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Rate limit exceeded&quot;</span><span class="p">);</span>
</span><span id="__span-24-70"><a id="__codelineno-24-70" name="__codelineno-24-70" href="#lab05-mcp-prompts-__codelineno-24-70"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-24-71"><a id="__codelineno-24-71" name="__codelineno-24-71" href="#lab05-mcp-prompts-__codelineno-24-71"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">handler</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
</span><span id="__span-24-72"><a id="__codelineno-24-72" name="__codelineno-24-72" href="#lab05-mcp-prompts-__codelineno-24-72"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-73"><a id="__codelineno-24-73" name="__codelineno-24-73" href="#lab05-mcp-prompts-__codelineno-24-73"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-74"><a id="__codelineno-24-74" name="__codelineno-24-74" href="#lab05-mcp-prompts-__codelineno-24-74"></a>
</span><span id="__span-24-75"><a id="__codelineno-24-75" name="__codelineno-24-75" href="#lab05-mcp-prompts-__codelineno-24-75"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHealthChecks</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-76"><a id="__codelineno-24-76" name="__codelineno-24-76" href="#lab05-mcp-prompts-__codelineno-24-76"></a><span class="w">    </span><span class="c1">// Add health check endpoint (if using HTTP transport)</span>
</span><span id="__span-24-77"><a id="__codelineno-24-77" name="__codelineno-24-77" href="#lab05-mcp-prompts-__codelineno-24-77"></a><span class="w">    </span><span class="c1">// For stdio, we can add a special tool</span>
</span><span id="__span-24-78"><a id="__codelineno-24-78" name="__codelineno-24-78" href="#lab05-mcp-prompts-__codelineno-24-78"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-79"><a id="__codelineno-24-79" name="__codelineno-24-79" href="#lab05-mcp-prompts-__codelineno-24-79"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;health_check&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-80"><a id="__codelineno-24-80" name="__codelineno-24-80" href="#lab05-mcp-prompts-__codelineno-24-80"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-81"><a id="__codelineno-24-81" name="__codelineno-24-81" href="#lab05-mcp-prompts-__codelineno-24-81"></a><span class="w">          </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[{</span>
</span><span id="__span-24-82"><a id="__codelineno-24-82" name="__codelineno-24-82" href="#lab05-mcp-prompts-__codelineno-24-82"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-24-83"><a id="__codelineno-24-83" name="__codelineno-24-83" href="#lab05-mcp-prompts-__codelineno-24-83"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">({</span>
</span><span id="__span-24-84"><a id="__codelineno-24-84" name="__codelineno-24-84" href="#lab05-mcp-prompts-__codelineno-24-84"></a><span class="w">              </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;healthy&quot;</span><span class="p">,</span>
</span><span id="__span-24-85"><a id="__codelineno-24-85" name="__codelineno-24-85" href="#lab05-mcp-prompts-__codelineno-24-85"></a><span class="w">              </span><span class="nx">uptime</span><span class="o">:</span><span class="w"> </span><span class="kt">Date.now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">startTime</span><span class="p">,</span>
</span><span id="__span-24-86"><a id="__codelineno-24-86" name="__codelineno-24-86" href="#lab05-mcp-prompts-__codelineno-24-86"></a><span class="w">              </span><span class="nx">requestCount</span><span class="o">:</span><span class="w"> </span><span class="kt">this.requestCount</span><span class="p">,</span>
</span><span id="__span-24-87"><a id="__codelineno-24-87" name="__codelineno-24-87" href="#lab05-mcp-prompts-__codelineno-24-87"></a><span class="w">            </span><span class="p">}),</span>
</span><span id="__span-24-88"><a id="__codelineno-24-88" name="__codelineno-24-88" href="#lab05-mcp-prompts-__codelineno-24-88"></a><span class="w">          </span><span class="p">}],</span>
</span><span id="__span-24-89"><a id="__codelineno-24-89" name="__codelineno-24-89" href="#lab05-mcp-prompts-__codelineno-24-89"></a><span class="w">        </span><span class="p">};</span>
</span><span id="__span-24-90"><a id="__codelineno-24-90" name="__codelineno-24-90" href="#lab05-mcp-prompts-__codelineno-24-90"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-24-91"><a id="__codelineno-24-91" name="__codelineno-24-91" href="#lab05-mcp-prompts-__codelineno-24-91"></a><span class="w">      </span><span class="c1">// Handle other tools</span>
</span><span id="__span-24-92"><a id="__codelineno-24-92" name="__codelineno-24-92" href="#lab05-mcp-prompts-__codelineno-24-92"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-24-93"><a id="__codelineno-24-93" name="__codelineno-24-93" href="#lab05-mcp-prompts-__codelineno-24-93"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-94"><a id="__codelineno-24-94" name="__codelineno-24-94" href="#lab05-mcp-prompts-__codelineno-24-94"></a>
</span><span id="__span-24-95"><a id="__codelineno-24-95" name="__codelineno-24-95" href="#lab05-mcp-prompts-__codelineno-24-95"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupErrorHandling</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="ow">void</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-96"><a id="__codelineno-24-96" name="__codelineno-24-96" href="#lab05-mcp-prompts-__codelineno-24-96"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">onerror</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-97"><a id="__codelineno-24-97" name="__codelineno-24-97" href="#lab05-mcp-prompts-__codelineno-24-97"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Server error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-24-98"><a id="__codelineno-24-98" name="__codelineno-24-98" href="#lab05-mcp-prompts-__codelineno-24-98"></a><span class="w">      </span><span class="c1">// Send to monitoring service</span>
</span><span id="__span-24-99"><a id="__codelineno-24-99" name="__codelineno-24-99" href="#lab05-mcp-prompts-__codelineno-24-99"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-24-100"><a id="__codelineno-24-100" name="__codelineno-24-100" href="#lab05-mcp-prompts-__codelineno-24-100"></a>
</span><span id="__span-24-101"><a id="__codelineno-24-101" name="__codelineno-24-101" href="#lab05-mcp-prompts-__codelineno-24-101"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;SIGTERM&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-102"><a id="__codelineno-24-102" name="__codelineno-24-102" href="#lab05-mcp-prompts-__codelineno-24-102"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Received SIGTERM, shutting down gracefully&quot;</span><span class="p">);</span>
</span><span id="__span-24-103"><a id="__codelineno-24-103" name="__codelineno-24-103" href="#lab05-mcp-prompts-__codelineno-24-103"></a><span class="w">      </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span><span id="__span-24-104"><a id="__codelineno-24-104" name="__codelineno-24-104" href="#lab05-mcp-prompts-__codelineno-24-104"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">0</span><span class="p">);</span>
</span><span id="__span-24-105"><a id="__codelineno-24-105" name="__codelineno-24-105" href="#lab05-mcp-prompts-__codelineno-24-105"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-24-106"><a id="__codelineno-24-106" name="__codelineno-24-106" href="#lab05-mcp-prompts-__codelineno-24-106"></a>
</span><span id="__span-24-107"><a id="__codelineno-24-107" name="__codelineno-24-107" href="#lab05-mcp-prompts-__codelineno-24-107"></a><span class="w">    </span><span class="nx">process</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;uncaughtException&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-108"><a id="__codelineno-24-108" name="__codelineno-24-108" href="#lab05-mcp-prompts-__codelineno-24-108"></a><span class="w">      </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Uncaught exception:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-24-109"><a id="__codelineno-24-109" name="__codelineno-24-109" href="#lab05-mcp-prompts-__codelineno-24-109"></a><span class="w">      </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-24-110"><a id="__codelineno-24-110" name="__codelineno-24-110" href="#lab05-mcp-prompts-__codelineno-24-110"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-24-111"><a id="__codelineno-24-111" name="__codelineno-24-111" href="#lab05-mcp-prompts-__codelineno-24-111"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-112"><a id="__codelineno-24-112" name="__codelineno-24-112" href="#lab05-mcp-prompts-__codelineno-24-112"></a>
</span><span id="__span-24-113"><a id="__codelineno-24-113" name="__codelineno-24-113" href="#lab05-mcp-prompts-__codelineno-24-113"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">start</span><span class="p">()</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="ow">void</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-24-114"><a id="__codelineno-24-114" name="__codelineno-24-114" href="#lab05-mcp-prompts-__codelineno-24-114"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-24-115"><a id="__codelineno-24-115" name="__codelineno-24-115" href="#lab05-mcp-prompts-__codelineno-24-115"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-24-116"><a id="__codelineno-24-116" name="__codelineno-24-116" href="#lab05-mcp-prompts-__codelineno-24-116"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Production MCP Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-24-117"><a id="__codelineno-24-117" name="__codelineno-24-117" href="#lab05-mcp-prompts-__codelineno-24-117"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-24-118"><a id="__codelineno-24-118" name="__codelineno-24-118" href="#lab05-mcp-prompts-__codelineno-24-118"></a><span class="p">}</span>
</span><span id="__span-24-119"><a id="__codelineno-24-119" name="__codelineno-24-119" href="#lab05-mcp-prompts-__codelineno-24-119"></a>
</span><span id="__span-24-120"><a id="__codelineno-24-120" name="__codelineno-24-120" href="#lab05-mcp-prompts-__codelineno-24-120"></a><span class="c1">// Deployment script (deploy.sh)</span>
</span><span id="__span-24-121"><a id="__codelineno-24-121" name="__codelineno-24-121" href="#lab05-mcp-prompts-__codelineno-24-121"></a><span class="err">#</span><span class="o">!</span><span class="err">/bin/bash</span>
</span><span id="__span-24-122"><a id="__codelineno-24-122" name="__codelineno-24-122" href="#lab05-mcp-prompts-__codelineno-24-122"></a><span class="nx">npm</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">build</span>
</span><span id="__span-24-123"><a id="__codelineno-24-123" name="__codelineno-24-123" href="#lab05-mcp-prompts-__codelineno-24-123"></a><span class="nx">npm</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="nx">test</span>
</span><span id="__span-24-124"><a id="__codelineno-24-124" name="__codelineno-24-124" href="#lab05-mcp-prompts-__codelineno-24-124"></a><span class="nx">docker</span><span class="w"> </span><span class="nx">build</span><span class="w"> </span><span class="o">-</span><span class="nx">t</span><span class="w"> </span><span class="nx">mcp</span><span class="o">-</span><span class="nx">server</span><span class="w"> </span><span class="p">.</span>
</span><span id="__span-24-125"><a id="__codelineno-24-125" name="__codelineno-24-125" href="#lab05-mcp-prompts-__codelineno-24-125"></a><span class="nx">docker</span><span class="w"> </span><span class="nx">run</span><span class="w"> </span><span class="o">-</span><span class="nx">p</span><span class="w"> </span><span class="nx">3000</span><span class="o">:</span><span class="kt">3000</span><span class="w"> </span><span class="nx">mcp</span><span class="o">-</span><span class="nx">server</span>
</span></code></pre></div>

Test by running the server, checking logs, calling health check tool, and verifying graceful shutdown.

</details>

<hr />
<h2 id="lab05-mcp-prompts-key-takeaways">Key Takeaways<a class="headerlink" href="#lab05-mcp-prompts-key-takeaways" title="Permanent link">&para;</a></h2>
<p>‚úÖ <strong>Prompts</strong> create reusable AI workflows with structured guidance</p>
<p>‚úÖ <strong>Resource integration</strong> provides contextually rich prompt experiences</p>
<p>‚úÖ <strong>Arguments</strong> make prompts flexible and customizable</p>
<p>‚úÖ <strong>Complete servers</strong> combine tools, resources, and prompts effectively</p>
<p>‚úÖ <strong>Dynamic prompts</strong> adapt to current data and context</p>
<p>‚úÖ <strong>Production readiness</strong> requires comprehensive error handling and monitoring</p>
<p>‚úÖ <strong>Workflow orchestration</strong> enables complex, multi-step AI processes</p>
<p>‚úÖ <strong>Domain specialization</strong> creates powerful, focused AI capabilities</p>

<hr />
<h2 id="lab05-mcp-prompts-next-steps">Next Steps<a class="headerlink" href="#lab05-mcp-prompts-next-steps" title="Permanent link">&para;</a></h2>
<p>Congratulations! </p>
<p>You&rsquo;ve completed the comprehensive MCP learning series. </p>
<p>You now posses the knowledge and skills to:</p>
<p>‚úÖ <strong>Build</strong> complete MCP servers with all three capabilities</p>
<p>‚úÖ <strong>Create</strong> sophisticated AI workflows and integrations</p>
<p>‚úÖ <strong>Deploy</strong> production-ready MCP solutions</p>
<p>‚úÖ <strong>Contribute</strong> to the MCP ecosystem</p>

<hr />
<h2 id="lab05-mcp-prompts-whats-next">What&rsquo;s Next?<a class="headerlink" href="#lab05-mcp-prompts-whats-next" title="Permanent link">&para;</a></h2>
<h3 id="lab05-mcp-prompts-further-experimentation">Further experimentation<a class="headerlink" href="#lab05-mcp-prompts-further-experimentation" title="Permanent link">&para;</a></h3>
<p>Go ahead and experiment further with MCP un the <a href="#tasks">MCP Lab Tasks</a> section, filled with hands-on exercises to deepen your understanding of MCP capabilities.</p>
<h3 id="lab05-mcp-prompts-advanced-topics">Advanced Topics<a class="headerlink" href="#lab05-mcp-prompts-advanced-topics" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>MCP Extensions</strong>: Custom protocol extensions</li>
<li><strong>Multi-server Coordination</strong>: Server orchestration</li>
<li><strong>Performance Optimization</strong>: Scaling MCP servers</li>
<li><strong>Security Hardening</strong>: Advanced security patterns</li>
</ul>
<h3 id="lab05-mcp-prompts-real-world-applications">Real-World Applications<a class="headerlink" href="#lab05-mcp-prompts-real-world-applications" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Code Analysis Tools</strong>: Automated code review and improvement</li>
<li><strong>DevOps Automation</strong>: Infrastructure and deployment automation</li>
<li><strong>Data Science Workflows</strong>: AI-assisted data analysis</li>
<li><strong>Content Creation</strong>: AI-powered content generation pipelines</li>
</ul>
<h3 id="lab05-mcp-prompts-community-engagement">Community Engagement<a class="headerlink" href="#lab05-mcp-prompts-community-engagement" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Contribute to MCP</strong>: Join the open-source development</li>
<li><strong>Share Your Servers</strong>: Publish your MCP servers</li>
<li><strong>Build Integrations</strong>: Create MCP clients and tools</li>
<li><strong>Teach Others</strong>: Help grow the MCP community</li>
</ul>
<hr />
<p><strong>Your MCP journey has just begun!</strong> </p>
<p><strong>The protocol provides endless possibilities for AI-human collaboration.</strong></p>
<p><strong>Go forth and build amazing things!</strong></p></section><section class="print-page" id="lab06-k-agent" heading-number="3.8"><h1 id="lab06-k-agent-lab-6-k-agent-integration">Lab 6: K-Agent Integration<a class="headerlink" href="#lab06-k-agent-lab-6-k-agent-integration" title="Permanent link">&para;</a></h1>
<h2 id="lab06-k-agent-overview">Overview<a class="headerlink" href="#lab06-k-agent-overview" title="Permanent link">&para;</a></h2>
<p>Welcome to the advanced MCP lab!</p>
<p>Now that you&rsquo;ve mastered the fundamentals of MCP servers, tools, resources, and prompts, it&rsquo;s time to apply your knowledge to a real-world scenario: <strong>building and implementing a K-Agent</strong>.</p>
<p>A K-Agent is an MCP server specifically designed to interact with Kubernetes clusters. </p>
<p>In this lab, you&rsquo;ll build a focused K-Agent that communicates with a Kubernetes cluster and collects logs from all pods - a critical capability for monitoring, debugging, and operational intelligence.</p>
<p>This lab bridges the gap between MCP theory and practical Kubernetes operations, showing how MCP servers can enhance DevOps workflows and provide AI-powered insights into cluster health and application behavior.</p>
<hr />
<h2 id="lab06-k-agent-learning-objectives">Learning Objectives<a class="headerlink" href="#lab06-k-agent-learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this lab, you will:</p>
<ul>
<li>Understand the concept and value of K-Agents (Kubernetes MCP servers)</li>
<li>Use pre-configured Kubernetes cluster access</li>
<li>Build MCP tools for pod log collection</li>
<li>Implement error handling for cluster operations</li>
</ul>
<hr />
<h2 id="lab06-k-agent-prerequisites">Prerequisites<a class="headerlink" href="#lab06-k-agent-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>Completed <a href="#lab05-mcp-prompts">Lab 5 - MCP Prompts and Integration</a></li>
<li><strong>A running Kubernetes cluster</strong> (OrbStack, Docker Desktop, Minikube, kind, or remote cluster)</li>
<li><strong>kubectl installed and configured</strong> with access to your cluster (<code>kubectl cluster-info</code> should work)</li>
<li>Basic understanding of Kubernetes concepts (pods, namespaces, kubectl)</li>
<li>Familiarity with container orchestration principles</li>
<li>Understanding of log aggregation and monitoring concepts</li>
</ul>
<div class="admonition info">
<p class="admonition-title">Verify Kubernetes Setup</p>
<p>Before starting this lab, ensure your Kubernetes environment is ready:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#lab06-k-agent-__codelineno-0-1"></a><span class="c1"># Check cluster access</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#lab06-k-agent-__codelineno-0-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#lab06-k-agent-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#lab06-k-agent-__codelineno-0-4"></a><span class="c1"># Verify you can list pods</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#lab06-k-agent-__codelineno-0-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--all-namespaces
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#lab06-k-agent-__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#lab06-k-agent-__codelineno-0-7"></a><span class="c1"># Check your kubeconfig</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#lab06-k-agent-__codelineno-0-8"></a>kubectl<span class="w"> </span>config<span class="w"> </span>view
</span></code></pre></div></p>
</div>
<hr />
<h2 id="lab06-k-agent-what-is-a-k-agent">What is a K-Agent?<a class="headerlink" href="#lab06-k-agent-what-is-a-k-agent" title="Permanent link">&para;</a></h2>
<p>A <strong>K-Agent</strong> is an MCP server that specializes in Kubernetes operations. </p>
<p>Unlike generic MCP servers, K-Agents are designed specifically for:</p>
<ul>
<li><strong>Cluster Communication</strong>: Secure, authenticated access to Kubernetes APIs</li>
<li><strong>Operational Intelligence</strong>: Real-time insights into cluster health and performance</li>
<li><strong>Log Analytics</strong>: Collection and analysis of application and system logs</li>
<li><strong>Resource Management</strong>: Monitoring and managing Kubernetes resources</li>
<li><strong>Troubleshooting</strong>: Automated diagnosis of cluster and application issues</li>
</ul>
<hr />
<h3 id="lab06-k-agent-why-k-agents-matter">Why K-Agents Matter<a class="headerlink" href="#lab06-k-agent-why-k-agents-matter" title="Permanent link">&para;</a></h3>
<p>In modern DevOps environments, Kubernetes clusters generate enormous amounts of operational data. </p>
<p>K-Agents provide:</p>
<ul>
<li><strong>AI-Powered Monitoring</strong>: Intelligent analysis of logs and metrics</li>
<li><strong>Automated Troubleshooting</strong>: AI-assisted diagnosis of issues</li>
<li><strong>Operational Insights</strong>: Pattern recognition in cluster behavior</li>
<li><strong>Enhanced Observability</strong>: Structured access to distributed system data</li>
</ul>
<hr />
<h2 id="lab06-k-agent-lab-architecture">Lab Architecture<a class="headerlink" href="#lab06-k-agent-lab-architecture" title="Permanent link">&para;</a></h2>
<p>Your K-Agent will implement a focused set of capabilities:</p>
<pre class="mermaid"><code>graph TB
    subgraph "MCP Client (AI/Inspector)"
        Client[MCP Client]
    end

    subgraph "K-Agent MCP Server"
        Server[K-Agent Server]
        Tools[MCP Tools]
        K8sClient[Kubernetes Client]

        Server --&gt; Tools
        Tools --&gt; K8sClient
    end

    subgraph "Kubernetes Cluster"
        API[Kubernetes API]
        Pods[Pods]
        Logs[Container Logs]

        API --&gt; Pods
        Pods --&gt; Logs
    end

    Client --&gt;|"stdio/JSON-RPC"| Server
    K8sClient --&gt;|"REST API"| API

    Tools -.-&gt;|"list_pods"| API
    Tools -.-&gt;|"collect_pod_logs"| Logs

    style Server fill:#4CAF50
    style Tools fill:#2196F3
    style K8sClient fill:#FF9800
    style API fill:#9C27B0</code></pre>
<h3 id="lab06-k-agent-core-components">Core Components<a class="headerlink" href="#lab06-k-agent-core-components" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>Kubernetes Client Integration</strong></p>
<ul>
<li>Secure cluster authentication</li>
<li>API communication handling</li>
<li>Error management for cluster operations</li>
</ul>
</li>
<li>
<p><strong>Log Collection Tools</strong></p>
<ul>
<li>Pod discovery across namespaces</li>
<li>Log retrieval from all containers</li>
<li>Structured log formatting</li>
</ul>
</li>
<li>
<p><strong>Resource Management</strong></p>
<ul>
<li>Namespace enumeration</li>
<li>Pod status monitoring</li>
<li>Health check capabilities</li>
</ul>
</li>
</ol>
<hr />
<h2 id="lab06-k-agent-hands-on-exercise">Hands-On Exercise<a class="headerlink" href="#lab06-k-agent-hands-on-exercise" title="Permanent link">&para;</a></h2>
<h3 id="lab06-k-agent-step-1-project-setup">Step 1: Project Setup<a class="headerlink" href="#lab06-k-agent-step-1-project-setup" title="Permanent link">&para;</a></h3>
<p>Create a new MCP server project with Kubernetes dependencies:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#lab06-k-agent-__codelineno-1-1"></a><span class="c1"># Create project directory and navigate to it</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#lab06-k-agent-__codelineno-1-2"></a>mkdir<span class="w"> </span>k-agent-logs<span class="w">  </span><span class="c1"># &lt;-- Create this directory next to the previous labs directories</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#lab06-k-agent-__codelineno-1-3"></a><span class="nb">cd</span><span class="w"> </span>k-agent-logs
</span></code></pre></div>
<p><br></p>
<p>Create a new <code>package.json</code> file inside the <code>k-agent-logs</code> directory with the following content:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#lab06-k-agent-__codelineno-2-1"></a><span class="p">{</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#lab06-k-agent-__codelineno-2-2"></a><span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;k-agent-logs&quot;</span><span class="p">,</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#lab06-k-agent-__codelineno-2-3"></a><span class="w">  </span><span class="nt">&quot;version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#lab06-k-agent-__codelineno-2-4"></a><span class="w">  </span><span class="nt">&quot;description&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;K-Agent MCP server for Kubernetes log collection&quot;</span><span class="p">,</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#lab06-k-agent-__codelineno-2-5"></a><span class="w">  </span><span class="nt">&quot;main&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;dist/index.js&quot;</span><span class="p">,</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#lab06-k-agent-__codelineno-2-6"></a><span class="w">  </span><span class="nt">&quot;scripts&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#lab06-k-agent-__codelineno-2-7"></a><span class="w">    </span><span class="nt">&quot;build&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsc&quot;</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#lab06-k-agent-__codelineno-2-8"></a><span class="w">    </span><span class="nt">&quot;dev&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;tsx src/index.ts&quot;</span><span class="p">,</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#lab06-k-agent-__codelineno-2-9"></a><span class="w">    </span><span class="nt">&quot;start&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;node dist/index.js&quot;</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#lab06-k-agent-__codelineno-2-10"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#lab06-k-agent-__codelineno-2-11"></a><span class="w">  </span><span class="nt">&quot;keywords&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;kubernetes&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;mcp&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;logs&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;monitoring&quot;</span><span class="p">],</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#lab06-k-agent-__codelineno-2-12"></a><span class="w">  </span><span class="nt">&quot;author&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#lab06-k-agent-__codelineno-2-13"></a><span class="w">  </span><span class="nt">&quot;license&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ISC&quot;</span><span class="p">,</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#lab06-k-agent-__codelineno-2-14"></a><span class="w">  </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;commonjs&quot;</span><span class="p">,</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#lab06-k-agent-__codelineno-2-15"></a><span class="w">  </span><span class="nt">&quot;dependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#lab06-k-agent-__codelineno-2-16"></a><span class="w">    </span><span class="nt">&quot;@kubernetes/client-node&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^1.4.0&quot;</span><span class="p">,</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#lab06-k-agent-__codelineno-2-17"></a><span class="w">    </span><span class="nt">&quot;@modelcontextprotocol/sdk&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^1.25.2&quot;</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#lab06-k-agent-__codelineno-2-18"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#lab06-k-agent-__codelineno-2-19"></a><span class="w">  </span><span class="nt">&quot;devDependencies&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#lab06-k-agent-__codelineno-2-20"></a><span class="w">    </span><span class="nt">&quot;@types/node&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^25.0.3&quot;</span><span class="p">,</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#lab06-k-agent-__codelineno-2-21"></a><span class="w">    </span><span class="nt">&quot;tsx&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^4.21.0&quot;</span><span class="p">,</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#lab06-k-agent-__codelineno-2-22"></a><span class="w">    </span><span class="nt">&quot;typescript&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;^5.9.3&quot;</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#lab06-k-agent-__codelineno-2-23"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-2-24"><a id="__codelineno-2-24" name="__codelineno-2-24" href="#lab06-k-agent-__codelineno-2-24"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p>Run the following command to install the dependencies:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#lab06-k-agent-__codelineno-3-1"></a>npm<span class="w"> </span>install
</span></code></pre></div>
<p>This will create <code>node_modules/</code> and <code>package-lock.json</code> in your <code>k-agent-logs</code> directory.</p>
<hr />
<h3 id="lab06-k-agent-step-2-kubernetes-client-configuration-complete-server-setup">Step 2: Kubernetes Client Configuration &amp; Complete Server Setup<a class="headerlink" href="#lab06-k-agent-step-2-kubernetes-client-configuration-complete-server-setup" title="Permanent link">&para;</a></h3>
<p>Create an <code>src</code> directory, inside the <code>k-agent-logs</code> directory, and an empty file named <code>index.ts</code> inside it:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#lab06-k-agent-__codelineno-4-1"></a>mkdir<span class="w"> </span>-p<span class="w"> </span>src<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>touch<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><br></p>
<p>Create your complete K-Agent server by pasting the following code inside <code>src/index.ts</code>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#lab06-k-agent-__codelineno-5-1"></a><span class="c1">// Import MCP SDK components and Kubernetes client</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#lab06-k-agent-__codelineno-5-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#lab06-k-agent-__codelineno-5-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#lab06-k-agent-__codelineno-5-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#lab06-k-agent-__codelineno-5-5"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#lab06-k-agent-__codelineno-5-6"></a><span class="w">  </span><span class="nx">ErrorCode</span><span class="p">,</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#lab06-k-agent-__codelineno-5-7"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#lab06-k-agent-__codelineno-5-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#lab06-k-agent-__codelineno-5-9"></a><span class="w">  </span><span class="nx">McpError</span><span class="p">,</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#lab06-k-agent-__codelineno-5-10"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#lab06-k-agent-__codelineno-5-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#lab06-k-agent-__codelineno-5-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">k8s</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@kubernetes/client-node&#39;</span><span class="p">;</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#lab06-k-agent-__codelineno-5-13"></a>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#lab06-k-agent-__codelineno-5-14"></a><span class="kd">class</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#lab06-k-agent-__codelineno-5-15"></a><span class="w">  </span><span class="c1">// Store Kubernetes API clients (for talking to your cluster)</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#lab06-k-agent-__codelineno-5-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sConfig</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.KubeConfig</span><span class="p">;</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#lab06-k-agent-__codelineno-5-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sAppsApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.AppsV1Api</span><span class="p">;</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#lab06-k-agent-__codelineno-5-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sCoreApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.CoreV1Api</span><span class="p">;</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#lab06-k-agent-__codelineno-5-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#lab06-k-agent-__codelineno-5-20"></a>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#lab06-k-agent-__codelineno-5-21"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#lab06-k-agent-__codelineno-5-22"></a><span class="w">    </span><span class="c1">// Initialize connection to your Kubernetes cluster (uses ~/.kube/config)</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#lab06-k-agent-__codelineno-5-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">k8s</span><span class="p">.</span><span class="nx">KubeConfig</span><span class="p">();</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#lab06-k-agent-__codelineno-5-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">loadFromDefault</span><span class="p">();</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#lab06-k-agent-__codelineno-5-25"></a>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#lab06-k-agent-__codelineno-5-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sAppsApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">AppsV1Api</span><span class="p">);</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#lab06-k-agent-__codelineno-5-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">CoreV1Api</span><span class="p">);</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#lab06-k-agent-__codelineno-5-28"></a>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#lab06-k-agent-__codelineno-5-29"></a><span class="w">    </span><span class="c1">// Create MCP server that AI tools can connect to</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#lab06-k-agent-__codelineno-5-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#lab06-k-agent-__codelineno-5-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#lab06-k-agent-__codelineno-5-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;k-agent-logs&quot;</span><span class="p">,</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#lab06-k-agent-__codelineno-5-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#lab06-k-agent-__codelineno-5-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#lab06-k-agent-__codelineno-5-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#lab06-k-agent-__codelineno-5-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#lab06-k-agent-__codelineno-5-37"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#lab06-k-agent-__codelineno-5-38"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#lab06-k-agent-__codelineno-5-39"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#lab06-k-agent-__codelineno-5-40"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#lab06-k-agent-__codelineno-5-41"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#lab06-k-agent-__codelineno-5-42"></a>
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#lab06-k-agent-__codelineno-5-43"></a><span class="w">    </span><span class="c1">// Handle incoming MCP requests (you&#39;ll add tools here next)</span>
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#lab06-k-agent-__codelineno-5-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#lab06-k-agent-__codelineno-5-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#lab06-k-agent-__codelineno-5-46"></a>
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#lab06-k-agent-__codelineno-5-47"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#lab06-k-agent-__codelineno-5-48"></a><span class="w">    </span><span class="c1">// TODO: Implement MCP handlers</span>
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#lab06-k-agent-__codelineno-5-49"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#lab06-k-agent-__codelineno-5-50"></a>
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#lab06-k-agent-__codelineno-5-51"></a><span class="w">  </span><span class="c1">// Start the server and listen for connections</span>
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#lab06-k-agent-__codelineno-5-52"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#lab06-k-agent-__codelineno-5-53"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#lab06-k-agent-__codelineno-5-54"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#lab06-k-agent-__codelineno-5-55"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;K-Agent MCP server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#lab06-k-agent-__codelineno-5-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#lab06-k-agent-__codelineno-5-57"></a><span class="p">}</span>
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#lab06-k-agent-__codelineno-5-58"></a>
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#lab06-k-agent-__codelineno-5-59"></a><span class="c1">// Actually run the server</span>
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#lab06-k-agent-__codelineno-5-60"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="p">();</span>
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#lab06-k-agent-__codelineno-5-61"></a><span class="nx">server</span><span class="p">.</span><span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div>
<p><br></p>
<p>Create a file named <code>tsconfig.json</code> inside the <code>k-agent-logs</code> directory (not inside <code>src</code>): </p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#lab06-k-agent-__codelineno-6-1"></a><span class="nb">cd</span><span class="w"> </span>..<span class="w">  </span><span class="c1"># Go back to k-agent-logs directory</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#lab06-k-agent-__codelineno-6-2"></a>touch<span class="w"> </span>tsconfig.json
</span></code></pre></div>
<p><br></p>
<p>Paste the following content into <code>tsconfig.json</code>:</p>
<div class="language-json highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#lab06-k-agent-__codelineno-7-1"></a><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#lab06-k-agent-__codelineno-7-2"></a><span class="w">    </span><span class="nt">&quot;compilerOptions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#lab06-k-agent-__codelineno-7-3"></a><span class="w">    </span><span class="nt">&quot;target&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ES2022&quot;</span><span class="p">,</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#lab06-k-agent-__codelineno-7-4"></a><span class="w">    </span><span class="nt">&quot;module&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;commonjs&quot;</span><span class="p">,</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#lab06-k-agent-__codelineno-7-5"></a><span class="w">    </span><span class="nt">&quot;lib&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ES2022&quot;</span><span class="p">],</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#lab06-k-agent-__codelineno-7-6"></a><span class="w">    </span><span class="nt">&quot;outDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./dist&quot;</span><span class="p">,</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#lab06-k-agent-__codelineno-7-7"></a><span class="w">    </span><span class="nt">&quot;rootDir&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;./src&quot;</span><span class="p">,</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#lab06-k-agent-__codelineno-7-8"></a><span class="w">    </span><span class="nt">&quot;strict&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#lab06-k-agent-__codelineno-7-9"></a><span class="w">    </span><span class="nt">&quot;esModuleInterop&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#lab06-k-agent-__codelineno-7-10"></a><span class="w">    </span><span class="nt">&quot;skipLibCheck&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#lab06-k-agent-__codelineno-7-11"></a><span class="w">    </span><span class="nt">&quot;forceConsistentCasingInFileNames&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#lab06-k-agent-__codelineno-7-12"></a><span class="w">    </span><span class="nt">&quot;resolveJsonModule&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#lab06-k-agent-__codelineno-7-13"></a><span class="w">    </span><span class="nt">&quot;declaration&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#lab06-k-agent-__codelineno-7-14"></a><span class="w">    </span><span class="nt">&quot;declarationMap&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#lab06-k-agent-__codelineno-7-15"></a><span class="w">    </span><span class="nt">&quot;sourceMap&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#lab06-k-agent-__codelineno-7-16"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#lab06-k-agent-__codelineno-7-17"></a><span class="w">    </span><span class="nt">&quot;include&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;src/**/*&quot;</span><span class="p">],</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#lab06-k-agent-__codelineno-7-18"></a><span class="w">    </span><span class="nt">&quot;exclude&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;node_modules&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dist&quot;</span><span class="p">]</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#lab06-k-agent-__codelineno-7-19"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Test that it works:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#lab06-k-agent-__codelineno-8-1"></a>npm<span class="w"> </span>run<span class="w"> </span>dev
</span></code></pre></div>
<p>You should see: <code>K-Agent MCP server running on stdio</code></p>
<p><br></p>
<div class="admonition warning">
<p class="admonition-title">If you get errors:</p>
<ul>
<li><code>Missing script: "dev"</code> ‚Üí You didn&rsquo;t update package.json (go back to step 2)</li>
<li><code>Cannot find module</code> ‚Üí Make sure you&rsquo;re in the k-agent-logs directory</li>
<li>Other errors ‚Üí Check that src/index.ts has the correct code</li>
</ul>
</div>
<hr />
<h3 id="lab06-k-agent-step-3-pod-discovery-tool">Step 3: Pod Discovery Tool<a class="headerlink" href="#lab06-k-agent-step-3-pod-discovery-tool" title="Permanent link">&para;</a></h3>
<p>Implement pod enumeration across namespaces with the <code>list_pods</code> tool.</p>
<p><br></p>
<h4 id="lab06-k-agent-update-setuphandlers-method">Update setupHandlers() Method<a class="headerlink" href="#lab06-k-agent-update-setuphandlers-method" title="Permanent link">&para;</a></h4>
<p>Open your <code>src/index.ts</code> file and find the <code>setupHandlers()</code> method. Replace the entire method with the following code:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#lab06-k-agent-__codelineno-9-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#lab06-k-agent-__codelineno-9-2"></a><span class="w">  </span><span class="c1">// List available tools</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#lab06-k-agent-__codelineno-9-3"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#lab06-k-agent-__codelineno-9-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#lab06-k-agent-__codelineno-9-5"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#lab06-k-agent-__codelineno-9-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#lab06-k-agent-__codelineno-9-7"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="p">,</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#lab06-k-agent-__codelineno-9-8"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List all pods across namespaces with their status&quot;</span><span class="p">,</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#lab06-k-agent-__codelineno-9-9"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#lab06-k-agent-__codelineno-9-10"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#lab06-k-agent-__codelineno-9-11"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#lab06-k-agent-__codelineno-9-12"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#lab06-k-agent-__codelineno-9-13"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#lab06-k-agent-__codelineno-9-14"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by specific namespace&quot;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#lab06-k-agent-__codelineno-9-15"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#lab06-k-agent-__codelineno-9-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#lab06-k-agent-__codelineno-9-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#lab06-k-agent-__codelineno-9-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#lab06-k-agent-__codelineno-9-19"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20" href="#lab06-k-agent-__codelineno-9-20"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21" href="#lab06-k-agent-__codelineno-9-21"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22" href="#lab06-k-agent-__codelineno-9-22"></a>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23" href="#lab06-k-agent-__codelineno-9-23"></a><span class="w">  </span><span class="c1">// Handle tool calls</span>
</span><span id="__span-9-24"><a id="__codelineno-9-24" name="__codelineno-9-24" href="#lab06-k-agent-__codelineno-9-24"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-25"><a id="__codelineno-9-25" name="__codelineno-9-25" href="#lab06-k-agent-__codelineno-9-25"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-9-26"><a id="__codelineno-9-26" name="__codelineno-9-26" href="#lab06-k-agent-__codelineno-9-26"></a>
</span><span id="__span-9-27"><a id="__codelineno-9-27" name="__codelineno-9-27" href="#lab06-k-agent-__codelineno-9-27"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-28"><a id="__codelineno-9-28" name="__codelineno-9-28" href="#lab06-k-agent-__codelineno-9-28"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-29"><a id="__codelineno-9-29" name="__codelineno-9-29" href="#lab06-k-agent-__codelineno-9-29"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="o">:</span>
</span><span id="__span-9-30"><a id="__codelineno-9-30" name="__codelineno-9-30" href="#lab06-k-agent-__codelineno-9-30"></a><span class="w">          </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-9-31"><a id="__codelineno-9-31" name="__codelineno-9-31" href="#lab06-k-agent-__codelineno-9-31"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-9-32"><a id="__codelineno-9-32" name="__codelineno-9-32" href="#lab06-k-agent-__codelineno-9-32"></a><span class="w">          </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-9-33"><a id="__codelineno-9-33" name="__codelineno-9-33" href="#lab06-k-agent-__codelineno-9-33"></a><span class="w">            </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span>
</span><span id="__span-9-34"><a id="__codelineno-9-34" name="__codelineno-9-34" href="#lab06-k-agent-__codelineno-9-34"></a><span class="w">            </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-9-35"><a id="__codelineno-9-35" name="__codelineno-9-35" href="#lab06-k-agent-__codelineno-9-35"></a><span class="w">          </span><span class="p">);</span>
</span><span id="__span-9-36"><a id="__codelineno-9-36" name="__codelineno-9-36" href="#lab06-k-agent-__codelineno-9-36"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-9-37"><a id="__codelineno-9-37" name="__codelineno-9-37" href="#lab06-k-agent-__codelineno-9-37"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-9-38"><a id="__codelineno-9-38" name="__codelineno-9-38" href="#lab06-k-agent-__codelineno-9-38"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-9-39"><a id="__codelineno-9-39" name="__codelineno-9-39" href="#lab06-k-agent-__codelineno-9-39"></a><span class="w">        </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="ne">InternalError</span><span class="p">,</span>
</span><span id="__span-9-40"><a id="__codelineno-9-40" name="__codelineno-9-40" href="#lab06-k-agent-__codelineno-9-40"></a><span class="w">        </span><span class="sb">`Tool execution failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-9-41"><a id="__codelineno-9-41" name="__codelineno-9-41" href="#lab06-k-agent-__codelineno-9-41"></a><span class="w">      </span><span class="p">);</span>
</span><span id="__span-9-42"><a id="__codelineno-9-42" name="__codelineno-9-42" href="#lab06-k-agent-__codelineno-9-42"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-9-43"><a id="__codelineno-9-43" name="__codelineno-9-43" href="#lab06-k-agent-__codelineno-9-43"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-9-44"><a id="__codelineno-9-44" name="__codelineno-9-44" href="#lab06-k-agent-__codelineno-9-44"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<h4 id="lab06-k-agent-add-handler-methods">Add Handler Methods<a class="headerlink" href="#lab06-k-agent-add-handler-methods" title="Permanent link">&para;</a></h4>
<p>Below the <code>setupHandlers()</code> method, <strong>before the <code>async run()</code> method</strong>, add the following new methods:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#lab06-k-agent-__codelineno-10-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#lab06-k-agent-__codelineno-10-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">namespace</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#lab06-k-agent-__codelineno-10-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#lab06-k-agent-__codelineno-10-4"></a>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#lab06-k-agent-__codelineno-10-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#lab06-k-agent-__codelineno-10-6"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#lab06-k-agent-__codelineno-10-7"></a><span class="w">    </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#lab06-k-agent-__codelineno-10-8"></a><span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#lab06-k-agent-__codelineno-10-9"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#lab06-k-agent-__codelineno-10-10"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#lab06-k-agent-__codelineno-10-11"></a>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#lab06-k-agent-__codelineno-10-12"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#lab06-k-agent-__codelineno-10-13"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#lab06-k-agent-__codelineno-10-14"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#lab06-k-agent-__codelineno-10-15"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#lab06-k-agent-__codelineno-10-16"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#lab06-k-agent-__codelineno-10-17"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#lab06-k-agent-__codelineno-10-18"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#lab06-k-agent-__codelineno-10-19"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#lab06-k-agent-__codelineno-10-20"></a><span class="p">}</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#lab06-k-agent-__codelineno-10-21"></a>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#lab06-k-agent-__codelineno-10-22"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#lab06-k-agent-__codelineno-10-23"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#lab06-k-agent-__codelineno-10-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#lab06-k-agent-__codelineno-10-25"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#lab06-k-agent-__codelineno-10-26"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#lab06-k-agent-__codelineno-10-27"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#lab06-k-agent-__codelineno-10-28"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">();</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#lab06-k-agent-__codelineno-10-29"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#lab06-k-agent-__codelineno-10-30"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#lab06-k-agent-__codelineno-10-31"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#lab06-k-agent-__codelineno-10-32"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#lab06-k-agent-__codelineno-10-33"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#lab06-k-agent-__codelineno-10-34"></a><span class="p">}</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#lab06-k-agent-__codelineno-10-35"></a>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#lab06-k-agent-__codelineno-10-36"></a><span class="k">private</span><span class="w"> </span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#lab06-k-agent-__codelineno-10-37"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">403</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#lab06-k-agent-__codelineno-10-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Access denied: Insufficient permissions to access Kubernetes resources&#39;</span><span class="p">);</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#lab06-k-agent-__codelineno-10-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#lab06-k-agent-__codelineno-10-40"></a>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#lab06-k-agent-__codelineno-10-41"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">404</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#lab06-k-agent-__codelineno-10-42"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Resource not found: The specified pod or namespace may not exist&#39;</span><span class="p">);</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#lab06-k-agent-__codelineno-10-43"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#lab06-k-agent-__codelineno-10-44"></a>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#lab06-k-agent-__codelineno-10-45"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Kubernetes operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#lab06-k-agent-__codelineno-10-46"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<div class="admonition success">
<p class="admonition-title">Complete <code>src/index.ts</code> After Step 3</p>
<p>Here&rsquo;s what your complete <code>src/index.ts</code> file should look like after completing Step 3:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#lab06-k-agent-__codelineno-11-1"></a><span class="c1">// Import MCP SDK components and Kubernetes client</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#lab06-k-agent-__codelineno-11-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#lab06-k-agent-__codelineno-11-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#lab06-k-agent-__codelineno-11-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#lab06-k-agent-__codelineno-11-5"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#lab06-k-agent-__codelineno-11-6"></a><span class="w">  </span><span class="nx">ErrorCode</span><span class="p">,</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#lab06-k-agent-__codelineno-11-7"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#lab06-k-agent-__codelineno-11-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#lab06-k-agent-__codelineno-11-9"></a><span class="w">  </span><span class="nx">McpError</span><span class="p">,</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#lab06-k-agent-__codelineno-11-10"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#lab06-k-agent-__codelineno-11-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#lab06-k-agent-__codelineno-11-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">k8s</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@kubernetes/client-node&#39;</span><span class="p">;</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#lab06-k-agent-__codelineno-11-13"></a>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#lab06-k-agent-__codelineno-11-14"></a><span class="kd">class</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#lab06-k-agent-__codelineno-11-15"></a><span class="w">  </span><span class="c1">// Store Kubernetes API clients (for talking to your cluster)</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#lab06-k-agent-__codelineno-11-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sConfig</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.KubeConfig</span><span class="p">;</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#lab06-k-agent-__codelineno-11-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sAppsApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.AppsV1Api</span><span class="p">;</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#lab06-k-agent-__codelineno-11-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sCoreApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.CoreV1Api</span><span class="p">;</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#lab06-k-agent-__codelineno-11-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#lab06-k-agent-__codelineno-11-20"></a>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#lab06-k-agent-__codelineno-11-21"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#lab06-k-agent-__codelineno-11-22"></a><span class="w">    </span><span class="c1">// Initialize connection to your Kubernetes cluster (uses ~/.kube/config)</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#lab06-k-agent-__codelineno-11-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">k8s</span><span class="p">.</span><span class="nx">KubeConfig</span><span class="p">();</span>
</span><span id="__span-11-24"><a id="__codelineno-11-24" name="__codelineno-11-24" href="#lab06-k-agent-__codelineno-11-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">loadFromDefault</span><span class="p">();</span>
</span><span id="__span-11-25"><a id="__codelineno-11-25" name="__codelineno-11-25" href="#lab06-k-agent-__codelineno-11-25"></a>
</span><span id="__span-11-26"><a id="__codelineno-11-26" name="__codelineno-11-26" href="#lab06-k-agent-__codelineno-11-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sAppsApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">AppsV1Api</span><span class="p">);</span>
</span><span id="__span-11-27"><a id="__codelineno-11-27" name="__codelineno-11-27" href="#lab06-k-agent-__codelineno-11-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">CoreV1Api</span><span class="p">);</span>
</span><span id="__span-11-28"><a id="__codelineno-11-28" name="__codelineno-11-28" href="#lab06-k-agent-__codelineno-11-28"></a>
</span><span id="__span-11-29"><a id="__codelineno-11-29" name="__codelineno-11-29" href="#lab06-k-agent-__codelineno-11-29"></a><span class="w">    </span><span class="c1">// Create MCP server that AI tools can connect to</span>
</span><span id="__span-11-30"><a id="__codelineno-11-30" name="__codelineno-11-30" href="#lab06-k-agent-__codelineno-11-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-11-31"><a id="__codelineno-11-31" name="__codelineno-11-31" href="#lab06-k-agent-__codelineno-11-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-11-32"><a id="__codelineno-11-32" name="__codelineno-11-32" href="#lab06-k-agent-__codelineno-11-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;k-agent-logs&quot;</span><span class="p">,</span>
</span><span id="__span-11-33"><a id="__codelineno-11-33" name="__codelineno-11-33" href="#lab06-k-agent-__codelineno-11-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-11-34"><a id="__codelineno-11-34" name="__codelineno-11-34" href="#lab06-k-agent-__codelineno-11-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-11-35"><a id="__codelineno-11-35" name="__codelineno-11-35" href="#lab06-k-agent-__codelineno-11-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-11-36"><a id="__codelineno-11-36" name="__codelineno-11-36" href="#lab06-k-agent-__codelineno-11-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-37"><a id="__codelineno-11-37" name="__codelineno-11-37" href="#lab06-k-agent-__codelineno-11-37"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-11-38"><a id="__codelineno-11-38" name="__codelineno-11-38" href="#lab06-k-agent-__codelineno-11-38"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-11-39"><a id="__codelineno-11-39" name="__codelineno-11-39" href="#lab06-k-agent-__codelineno-11-39"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-11-40"><a id="__codelineno-11-40" name="__codelineno-11-40" href="#lab06-k-agent-__codelineno-11-40"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-11-41"><a id="__codelineno-11-41" name="__codelineno-11-41" href="#lab06-k-agent-__codelineno-11-41"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-11-42"><a id="__codelineno-11-42" name="__codelineno-11-42" href="#lab06-k-agent-__codelineno-11-42"></a>
</span><span id="__span-11-43"><a id="__codelineno-11-43" name="__codelineno-11-43" href="#lab06-k-agent-__codelineno-11-43"></a><span class="w">    </span><span class="c1">// Handle incoming MCP requests</span>
</span><span id="__span-11-44"><a id="__codelineno-11-44" name="__codelineno-11-44" href="#lab06-k-agent-__codelineno-11-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-11-45"><a id="__codelineno-11-45" name="__codelineno-11-45" href="#lab06-k-agent-__codelineno-11-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-46"><a id="__codelineno-11-46" name="__codelineno-11-46" href="#lab06-k-agent-__codelineno-11-46"></a>
</span><span id="__span-11-47"><a id="__codelineno-11-47" name="__codelineno-11-47" href="#lab06-k-agent-__codelineno-11-47"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-48"><a id="__codelineno-11-48" name="__codelineno-11-48" href="#lab06-k-agent-__codelineno-11-48"></a><span class="w">    </span><span class="c1">// List available tools</span>
</span><span id="__span-11-49"><a id="__codelineno-11-49" name="__codelineno-11-49" href="#lab06-k-agent-__codelineno-11-49"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-50"><a id="__codelineno-11-50" name="__codelineno-11-50" href="#lab06-k-agent-__codelineno-11-50"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-51"><a id="__codelineno-11-51" name="__codelineno-11-51" href="#lab06-k-agent-__codelineno-11-51"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-52"><a id="__codelineno-11-52" name="__codelineno-11-52" href="#lab06-k-agent-__codelineno-11-52"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-11-53"><a id="__codelineno-11-53" name="__codelineno-11-53" href="#lab06-k-agent-__codelineno-11-53"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="p">,</span>
</span><span id="__span-11-54"><a id="__codelineno-11-54" name="__codelineno-11-54" href="#lab06-k-agent-__codelineno-11-54"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List all pods across namespaces with their status&quot;</span><span class="p">,</span>
</span><span id="__span-11-55"><a id="__codelineno-11-55" name="__codelineno-11-55" href="#lab06-k-agent-__codelineno-11-55"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-56"><a id="__codelineno-11-56" name="__codelineno-11-56" href="#lab06-k-agent-__codelineno-11-56"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-11-57"><a id="__codelineno-11-57" name="__codelineno-11-57" href="#lab06-k-agent-__codelineno-11-57"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-58"><a id="__codelineno-11-58" name="__codelineno-11-58" href="#lab06-k-agent-__codelineno-11-58"></a><span class="w">                </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-59"><a id="__codelineno-11-59" name="__codelineno-11-59" href="#lab06-k-agent-__codelineno-11-59"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-11-60"><a id="__codelineno-11-60" name="__codelineno-11-60" href="#lab06-k-agent-__codelineno-11-60"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by specific namespace&quot;</span>
</span><span id="__span-11-61"><a id="__codelineno-11-61" name="__codelineno-11-61" href="#lab06-k-agent-__codelineno-11-61"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-11-62"><a id="__codelineno-11-62" name="__codelineno-11-62" href="#lab06-k-agent-__codelineno-11-62"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-11-63"><a id="__codelineno-11-63" name="__codelineno-11-63" href="#lab06-k-agent-__codelineno-11-63"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-11-64"><a id="__codelineno-11-64" name="__codelineno-11-64" href="#lab06-k-agent-__codelineno-11-64"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-11-65"><a id="__codelineno-11-65" name="__codelineno-11-65" href="#lab06-k-agent-__codelineno-11-65"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-11-66"><a id="__codelineno-11-66" name="__codelineno-11-66" href="#lab06-k-agent-__codelineno-11-66"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-11-67"><a id="__codelineno-11-67" name="__codelineno-11-67" href="#lab06-k-agent-__codelineno-11-67"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-11-68"><a id="__codelineno-11-68" name="__codelineno-11-68" href="#lab06-k-agent-__codelineno-11-68"></a>
</span><span id="__span-11-69"><a id="__codelineno-11-69" name="__codelineno-11-69" href="#lab06-k-agent-__codelineno-11-69"></a><span class="w">    </span><span class="c1">// Handle tool calls</span>
</span><span id="__span-11-70"><a id="__codelineno-11-70" name="__codelineno-11-70" href="#lab06-k-agent-__codelineno-11-70"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-71"><a id="__codelineno-11-71" name="__codelineno-11-71" href="#lab06-k-agent-__codelineno-11-71"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-11-72"><a id="__codelineno-11-72" name="__codelineno-11-72" href="#lab06-k-agent-__codelineno-11-72"></a>
</span><span id="__span-11-73"><a id="__codelineno-11-73" name="__codelineno-11-73" href="#lab06-k-agent-__codelineno-11-73"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-74"><a id="__codelineno-11-74" name="__codelineno-11-74" href="#lab06-k-agent-__codelineno-11-74"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-75"><a id="__codelineno-11-75" name="__codelineno-11-75" href="#lab06-k-agent-__codelineno-11-75"></a><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="o">:</span>
</span><span id="__span-11-76"><a id="__codelineno-11-76" name="__codelineno-11-76" href="#lab06-k-agent-__codelineno-11-76"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-11-77"><a id="__codelineno-11-77" name="__codelineno-11-77" href="#lab06-k-agent-__codelineno-11-77"></a><span class="w">          </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-11-78"><a id="__codelineno-11-78" name="__codelineno-11-78" href="#lab06-k-agent-__codelineno-11-78"></a><span class="w">            </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-11-79"><a id="__codelineno-11-79" name="__codelineno-11-79" href="#lab06-k-agent-__codelineno-11-79"></a><span class="w">              </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span>
</span><span id="__span-11-80"><a id="__codelineno-11-80" name="__codelineno-11-80" href="#lab06-k-agent-__codelineno-11-80"></a><span class="w">              </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-11-81"><a id="__codelineno-11-81" name="__codelineno-11-81" href="#lab06-k-agent-__codelineno-11-81"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-11-82"><a id="__codelineno-11-82" name="__codelineno-11-82" href="#lab06-k-agent-__codelineno-11-82"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-83"><a id="__codelineno-11-83" name="__codelineno-11-83" href="#lab06-k-agent-__codelineno-11-83"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-84"><a id="__codelineno-11-84" name="__codelineno-11-84" href="#lab06-k-agent-__codelineno-11-84"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-11-85"><a id="__codelineno-11-85" name="__codelineno-11-85" href="#lab06-k-agent-__codelineno-11-85"></a><span class="w">          </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="ne">InternalError</span><span class="p">,</span>
</span><span id="__span-11-86"><a id="__codelineno-11-86" name="__codelineno-11-86" href="#lab06-k-agent-__codelineno-11-86"></a><span class="w">          </span><span class="sb">`Tool execution failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-11-87"><a id="__codelineno-11-87" name="__codelineno-11-87" href="#lab06-k-agent-__codelineno-11-87"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-11-88"><a id="__codelineno-11-88" name="__codelineno-11-88" href="#lab06-k-agent-__codelineno-11-88"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-11-89"><a id="__codelineno-11-89" name="__codelineno-11-89" href="#lab06-k-agent-__codelineno-11-89"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-11-90"><a id="__codelineno-11-90" name="__codelineno-11-90" href="#lab06-k-agent-__codelineno-11-90"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-91"><a id="__codelineno-11-91" name="__codelineno-11-91" href="#lab06-k-agent-__codelineno-11-91"></a>
</span><span id="__span-11-92"><a id="__codelineno-11-92" name="__codelineno-11-92" href="#lab06-k-agent-__codelineno-11-92"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-93"><a id="__codelineno-11-93" name="__codelineno-11-93" href="#lab06-k-agent-__codelineno-11-93"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">namespace</span><span class="p">;</span>
</span><span id="__span-11-94"><a id="__codelineno-11-94" name="__codelineno-11-94" href="#lab06-k-agent-__codelineno-11-94"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-11-95"><a id="__codelineno-11-95" name="__codelineno-11-95" href="#lab06-k-agent-__codelineno-11-95"></a>
</span><span id="__span-11-96"><a id="__codelineno-11-96" name="__codelineno-11-96" href="#lab06-k-agent-__codelineno-11-96"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-11-97"><a id="__codelineno-11-97" name="__codelineno-11-97" href="#lab06-k-agent-__codelineno-11-97"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-11-98"><a id="__codelineno-11-98" name="__codelineno-11-98" href="#lab06-k-agent-__codelineno-11-98"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-11-99"><a id="__codelineno-11-99" name="__codelineno-11-99" href="#lab06-k-agent-__codelineno-11-99"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-11-100"><a id="__codelineno-11-100" name="__codelineno-11-100" href="#lab06-k-agent-__codelineno-11-100"></a><span class="w">      </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-11-101"><a id="__codelineno-11-101" name="__codelineno-11-101" href="#lab06-k-agent-__codelineno-11-101"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-11-102"><a id="__codelineno-11-102" name="__codelineno-11-102" href="#lab06-k-agent-__codelineno-11-102"></a>
</span><span id="__span-11-103"><a id="__codelineno-11-103" name="__codelineno-11-103" href="#lab06-k-agent-__codelineno-11-103"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-104"><a id="__codelineno-11-104" name="__codelineno-11-104" href="#lab06-k-agent-__codelineno-11-104"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-11-105"><a id="__codelineno-11-105" name="__codelineno-11-105" href="#lab06-k-agent-__codelineno-11-105"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-11-106"><a id="__codelineno-11-106" name="__codelineno-11-106" href="#lab06-k-agent-__codelineno-11-106"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-11-107"><a id="__codelineno-11-107" name="__codelineno-11-107" href="#lab06-k-agent-__codelineno-11-107"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-11-108"><a id="__codelineno-11-108" name="__codelineno-11-108" href="#lab06-k-agent-__codelineno-11-108"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-11-109"><a id="__codelineno-11-109" name="__codelineno-11-109" href="#lab06-k-agent-__codelineno-11-109"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-11-110"><a id="__codelineno-11-110" name="__codelineno-11-110" href="#lab06-k-agent-__codelineno-11-110"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-11-111"><a id="__codelineno-11-111" name="__codelineno-11-111" href="#lab06-k-agent-__codelineno-11-111"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-112"><a id="__codelineno-11-112" name="__codelineno-11-112" href="#lab06-k-agent-__codelineno-11-112"></a>
</span><span id="__span-11-113"><a id="__codelineno-11-113" name="__codelineno-11-113" href="#lab06-k-agent-__codelineno-11-113"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-114"><a id="__codelineno-11-114" name="__codelineno-11-114" href="#lab06-k-agent-__codelineno-11-114"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-115"><a id="__codelineno-11-115" name="__codelineno-11-115" href="#lab06-k-agent-__codelineno-11-115"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-116"><a id="__codelineno-11-116" name="__codelineno-11-116" href="#lab06-k-agent-__codelineno-11-116"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-11-117"><a id="__codelineno-11-117" name="__codelineno-11-117" href="#lab06-k-agent-__codelineno-11-117"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-118"><a id="__codelineno-11-118" name="__codelineno-11-118" href="#lab06-k-agent-__codelineno-11-118"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-119"><a id="__codelineno-11-119" name="__codelineno-11-119" href="#lab06-k-agent-__codelineno-11-119"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">();</span>
</span><span id="__span-11-120"><a id="__codelineno-11-120" name="__codelineno-11-120" href="#lab06-k-agent-__codelineno-11-120"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-11-121"><a id="__codelineno-11-121" name="__codelineno-11-121" href="#lab06-k-agent-__codelineno-11-121"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-11-122"><a id="__codelineno-11-122" name="__codelineno-11-122" href="#lab06-k-agent-__codelineno-11-122"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-123"><a id="__codelineno-11-123" name="__codelineno-11-123" href="#lab06-k-agent-__codelineno-11-123"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-11-124"><a id="__codelineno-11-124" name="__codelineno-11-124" href="#lab06-k-agent-__codelineno-11-124"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-125"><a id="__codelineno-11-125" name="__codelineno-11-125" href="#lab06-k-agent-__codelineno-11-125"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-126"><a id="__codelineno-11-126" name="__codelineno-11-126" href="#lab06-k-agent-__codelineno-11-126"></a>
</span><span id="__span-11-127"><a id="__codelineno-11-127" name="__codelineno-11-127" href="#lab06-k-agent-__codelineno-11-127"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-128"><a id="__codelineno-11-128" name="__codelineno-11-128" href="#lab06-k-agent-__codelineno-11-128"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">403</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-129"><a id="__codelineno-11-129" name="__codelineno-11-129" href="#lab06-k-agent-__codelineno-11-129"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Access denied: Insufficient permissions to access Kubernetes resources&#39;</span><span class="p">);</span>
</span><span id="__span-11-130"><a id="__codelineno-11-130" name="__codelineno-11-130" href="#lab06-k-agent-__codelineno-11-130"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-131"><a id="__codelineno-11-131" name="__codelineno-11-131" href="#lab06-k-agent-__codelineno-11-131"></a>
</span><span id="__span-11-132"><a id="__codelineno-11-132" name="__codelineno-11-132" href="#lab06-k-agent-__codelineno-11-132"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">404</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-133"><a id="__codelineno-11-133" name="__codelineno-11-133" href="#lab06-k-agent-__codelineno-11-133"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Resource not found: The specified pod or namespace may not exist&#39;</span><span class="p">);</span>
</span><span id="__span-11-134"><a id="__codelineno-11-134" name="__codelineno-11-134" href="#lab06-k-agent-__codelineno-11-134"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-11-135"><a id="__codelineno-11-135" name="__codelineno-11-135" href="#lab06-k-agent-__codelineno-11-135"></a>
</span><span id="__span-11-136"><a id="__codelineno-11-136" name="__codelineno-11-136" href="#lab06-k-agent-__codelineno-11-136"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Kubernetes operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-11-137"><a id="__codelineno-11-137" name="__codelineno-11-137" href="#lab06-k-agent-__codelineno-11-137"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-138"><a id="__codelineno-11-138" name="__codelineno-11-138" href="#lab06-k-agent-__codelineno-11-138"></a>
</span><span id="__span-11-139"><a id="__codelineno-11-139" name="__codelineno-11-139" href="#lab06-k-agent-__codelineno-11-139"></a><span class="w">  </span><span class="c1">// Start the server and listen for connections</span>
</span><span id="__span-11-140"><a id="__codelineno-11-140" name="__codelineno-11-140" href="#lab06-k-agent-__codelineno-11-140"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-141"><a id="__codelineno-11-141" name="__codelineno-11-141" href="#lab06-k-agent-__codelineno-11-141"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-11-142"><a id="__codelineno-11-142" name="__codelineno-11-142" href="#lab06-k-agent-__codelineno-11-142"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-11-143"><a id="__codelineno-11-143" name="__codelineno-11-143" href="#lab06-k-agent-__codelineno-11-143"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;K-Agent MCP server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-11-144"><a id="__codelineno-11-144" name="__codelineno-11-144" href="#lab06-k-agent-__codelineno-11-144"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-11-145"><a id="__codelineno-11-145" name="__codelineno-11-145" href="#lab06-k-agent-__codelineno-11-145"></a><span class="p">}</span>
</span><span id="__span-11-146"><a id="__codelineno-11-146" name="__codelineno-11-146" href="#lab06-k-agent-__codelineno-11-146"></a>
</span><span id="__span-11-147"><a id="__codelineno-11-147" name="__codelineno-11-147" href="#lab06-k-agent-__codelineno-11-147"></a><span class="c1">// Actually run the server</span>
</span><span id="__span-11-148"><a id="__codelineno-11-148" name="__codelineno-11-148" href="#lab06-k-agent-__codelineno-11-148"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="p">();</span>
</span><span id="__span-11-149"><a id="__codelineno-11-149" name="__codelineno-11-149" href="#lab06-k-agent-__codelineno-11-149"></a><span class="nx">server</span><span class="p">.</span><span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div>
</div>
<p><br></p>
<h4 id="lab06-k-agent-test-pod-discovery">Test Pod Discovery<a class="headerlink" href="#lab06-k-agent-test-pod-discovery" title="Permanent link">&para;</a></h4>
<p>Test the pod listing functionality using the MCP Inspector by running:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#lab06-k-agent-__codelineno-12-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p>This will start the MCP Inspector connected to your K-Agent server and open a browser window.</p>
<p><strong>Inside the MCP Inspector UI browser window:</strong></p>
<ol>
<li>Click the <strong>&ldquo;Connect&rdquo;</strong> button</li>
<li>Click the <strong>&ldquo;Tools&rdquo;</strong> tab</li>
<li>Click <strong>&ldquo;List Tools&rdquo;</strong> - you&rsquo;ll see the <code>list_pods</code> tool</li>
<li>Click on <strong><code>list_pods</code></strong></li>
<li>Optionally enter a namespace name</li>
<li>Click <strong>&ldquo;Run Tool&rdquo;</strong> to test it</li>
</ol>
<p>You should see a JSON list of all pods with their status and container names.</p>
<hr />
<h3 id="lab06-k-agent-step-4-log-collection-tool">Step 4: Log Collection Tool<a class="headerlink" href="#lab06-k-agent-step-4-log-collection-tool" title="Permanent link">&para;</a></h3>
<p>Build the core log collection functionality with the <code>collect_pod_logs</code> tool.</p>
<p><br></p>
<h4 id="lab06-k-agent-add-collect_pod_logs-to-tools-array">Add collect_pod_logs to Tools Array<a class="headerlink" href="#lab06-k-agent-add-collect_pod_logs-to-tools-array" title="Permanent link">&para;</a></h4>
<p>In your <code>src/index.ts</code> file, locate the tools array inside <code>setupHandlers()</code> method. </p>
<p>Add the following second tool code to the array:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#lab06-k-agent-__codelineno-13-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#lab06-k-agent-__codelineno-13-2"></a><span class="w">  </span><span class="c1">// List available tools</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#lab06-k-agent-__codelineno-13-3"></a><span class="w">  </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#lab06-k-agent-__codelineno-13-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#lab06-k-agent-__codelineno-13-5"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#lab06-k-agent-__codelineno-13-6"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#lab06-k-agent-__codelineno-13-7"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="p">,</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#lab06-k-agent-__codelineno-13-8"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List all pods across namespaces with their status&quot;</span><span class="p">,</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#lab06-k-agent-__codelineno-13-9"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#lab06-k-agent-__codelineno-13-10"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#lab06-k-agent-__codelineno-13-11"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#lab06-k-agent-__codelineno-13-12"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#lab06-k-agent-__codelineno-13-13"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#lab06-k-agent-__codelineno-13-14"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by specific namespace&quot;</span>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#lab06-k-agent-__codelineno-13-15"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#lab06-k-agent-__codelineno-13-16"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#lab06-k-agent-__codelineno-13-17"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#lab06-k-agent-__codelineno-13-18"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-13-19"><a id="__codelineno-13-19" name="__codelineno-13-19" href="#lab06-k-agent-__codelineno-13-19"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-13-20"><a id="__codelineno-13-20" name="__codelineno-13-20" href="#lab06-k-agent-__codelineno-13-20"></a><span class="w">          </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;collect_pod_logs&quot;</span><span class="p">,</span>
</span><span id="__span-13-21"><a id="__codelineno-13-21" name="__codelineno-13-21" href="#lab06-k-agent-__codelineno-13-21"></a><span class="w">          </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Collect logs from all containers in specified pods&quot;</span><span class="p">,</span>
</span><span id="__span-13-22"><a id="__codelineno-13-22" name="__codelineno-13-22" href="#lab06-k-agent-__codelineno-13-22"></a><span class="w">          </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-23"><a id="__codelineno-13-23" name="__codelineno-13-23" href="#lab06-k-agent-__codelineno-13-23"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-13-24"><a id="__codelineno-13-24" name="__codelineno-13-24" href="#lab06-k-agent-__codelineno-13-24"></a><span class="w">            </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-25"><a id="__codelineno-13-25" name="__codelineno-13-25" href="#lab06-k-agent-__codelineno-13-25"></a><span class="w">              </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-26"><a id="__codelineno-13-26" name="__codelineno-13-26" href="#lab06-k-agent-__codelineno-13-26"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-13-27"><a id="__codelineno-13-27" name="__codelineno-13-27" href="#lab06-k-agent-__codelineno-13-27"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Namespace to collect logs from&quot;</span>
</span><span id="__span-13-28"><a id="__codelineno-13-28" name="__codelineno-13-28" href="#lab06-k-agent-__codelineno-13-28"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-13-29"><a id="__codelineno-13-29" name="__codelineno-13-29" href="#lab06-k-agent-__codelineno-13-29"></a><span class="w">              </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-30"><a id="__codelineno-13-30" name="__codelineno-13-30" href="#lab06-k-agent-__codelineno-13-30"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-13-31"><a id="__codelineno-13-31" name="__codelineno-13-31" href="#lab06-k-agent-__codelineno-13-31"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Specific pod name (optional - collects from all if not specified)&quot;</span>
</span><span id="__span-13-32"><a id="__codelineno-13-32" name="__codelineno-13-32" href="#lab06-k-agent-__codelineno-13-32"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-13-33"><a id="__codelineno-13-33" name="__codelineno-13-33" href="#lab06-k-agent-__codelineno-13-33"></a><span class="w">              </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-34"><a id="__codelineno-13-34" name="__codelineno-13-34" href="#lab06-k-agent-__codelineno-13-34"></a><span class="w">                </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-13-35"><a id="__codelineno-13-35" name="__codelineno-13-35" href="#lab06-k-agent-__codelineno-13-35"></a><span class="w">                </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Number of recent log lines to retrieve&quot;</span><span class="p">,</span>
</span><span id="__span-13-36"><a id="__codelineno-13-36" name="__codelineno-13-36" href="#lab06-k-agent-__codelineno-13-36"></a><span class="w">                </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-13-37"><a id="__codelineno-13-37" name="__codelineno-13-37" href="#lab06-k-agent-__codelineno-13-37"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-13-38"><a id="__codelineno-13-38" name="__codelineno-13-38" href="#lab06-k-agent-__codelineno-13-38"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-13-39"><a id="__codelineno-13-39" name="__codelineno-13-39" href="#lab06-k-agent-__codelineno-13-39"></a><span class="w">            </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
</span><span id="__span-13-40"><a id="__codelineno-13-40" name="__codelineno-13-40" href="#lab06-k-agent-__codelineno-13-40"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-13-41"><a id="__codelineno-13-41" name="__codelineno-13-41" href="#lab06-k-agent-__codelineno-13-41"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-13-42"><a id="__codelineno-13-42" name="__codelineno-13-42" href="#lab06-k-agent-__codelineno-13-42"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-13-43"><a id="__codelineno-13-43" name="__codelineno-13-43" href="#lab06-k-agent-__codelineno-13-43"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-13-44"><a id="__codelineno-13-44" name="__codelineno-13-44" href="#lab06-k-agent-__codelineno-13-44"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-13-45"><a id="__codelineno-13-45" name="__codelineno-13-45" href="#lab06-k-agent-__codelineno-13-45"></a><span class="w">  </span><span class="c1">// ... rest of setupHandlers</span>
</span><span id="__span-13-46"><a id="__codelineno-13-46" name="__codelineno-13-46" href="#lab06-k-agent-__codelineno-13-46"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<h4 id="lab06-k-agent-update-tool-handler-switch">Update Tool Handler Switch<a class="headerlink" href="#lab06-k-agent-update-tool-handler-switch" title="Permanent link">&para;</a></h4>
<p>In the same <code>setupHandlers()</code> method, locate the switch statement and add the following case for <code>collect_pod_logs</code>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#lab06-k-agent-__codelineno-14-1"></a><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#lab06-k-agent-__codelineno-14-2"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="o">:</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#lab06-k-agent-__codelineno-14-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#lab06-k-agent-__codelineno-14-4"></a><span class="w">  </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;collect_pod_logs&quot;</span><span class="o">:</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#lab06-k-agent-__codelineno-14-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#lab06-k-agent-__codelineno-14-6"></a><span class="w">  </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#lab06-k-agent-__codelineno-14-7"></a><span class="w">    </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#lab06-k-agent-__codelineno-14-8"></a><span class="w">      </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#lab06-k-agent-__codelineno-14-9"></a><span class="w">      </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#lab06-k-agent-__codelineno-14-10"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#lab06-k-agent-__codelineno-14-11"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<h4 id="lab06-k-agent-implement-log-collection-methods">Implement Log Collection Methods<a class="headerlink" href="#lab06-k-agent-implement-log-collection-methods" title="Permanent link">&para;</a></h4>
<p>Below your existing handler methods (after <code>handleK8sError()</code>), <strong>before the <code>async run()</code> method</strong>, add the following new methods:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#lab06-k-agent-__codelineno-15-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#lab06-k-agent-__codelineno-15-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#lab06-k-agent-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#lab06-k-agent-__codelineno-15-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#lab06-k-agent-__codelineno-15-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Namespace is required&quot;</span><span class="p">);</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#lab06-k-agent-__codelineno-15-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#lab06-k-agent-__codelineno-15-7"></a>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#lab06-k-agent-__codelineno-15-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#lab06-k-agent-__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#lab06-k-agent-__codelineno-15-10"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#lab06-k-agent-__codelineno-15-11"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#lab06-k-agent-__codelineno-15-12"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#lab06-k-agent-__codelineno-15-13"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#lab06-k-agent-__codelineno-15-14"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">logs</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#lab06-k-agent-__codelineno-15-15"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#lab06-k-agent-__codelineno-15-16"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#lab06-k-agent-__codelineno-15-17"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#lab06-k-agent-__codelineno-15-18"></a><span class="p">}</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#lab06-k-agent-__codelineno-15-19"></a>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#lab06-k-agent-__codelineno-15-20"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#lab06-k-agent-__codelineno-15-21"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">podName</span><span class="w"> </span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#lab06-k-agent-__codelineno-15-22"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">pods</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">podName</span><span class="p">))</span><span class="w"> </span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#lab06-k-agent-__codelineno-15-23"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#lab06-k-agent-__codelineno-15-24"></a>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#lab06-k-agent-__codelineno-15-25"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">allLogs</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#lab06-k-agent-__codelineno-15-26"></a>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#lab06-k-agent-__codelineno-15-27"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">pod</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#lab06-k-agent-__codelineno-15-28"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#lab06-k-agent-__codelineno-15-29"></a>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#lab06-k-agent-__codelineno-15-30"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">containers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">spec</span><span class="o">?</span><span class="p">.</span><span class="nx">containers</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#lab06-k-agent-__codelineno-15-31"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">containers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#lab06-k-agent-__codelineno-15-32"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#lab06-k-agent-__codelineno-15-33"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#lab06-k-agent-__codelineno-15-34"></a><span class="w">        </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\n</span><span class="si">${</span><span class="nx">logs</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-15-35"><a id="__codelineno-15-35" name="__codelineno-15-35" href="#lab06-k-agent-__codelineno-15-35"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-36"><a id="__codelineno-15-36" name="__codelineno-15-36" href="#lab06-k-agent-__codelineno-15-36"></a><span class="w">        </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\nError retrieving logs: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-15-37"><a id="__codelineno-15-37" name="__codelineno-15-37" href="#lab06-k-agent-__codelineno-15-37"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-15-38"><a id="__codelineno-15-38" name="__codelineno-15-38" href="#lab06-k-agent-__codelineno-15-38"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-39"><a id="__codelineno-15-39" name="__codelineno-15-39" href="#lab06-k-agent-__codelineno-15-39"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-40"><a id="__codelineno-15-40" name="__codelineno-15-40" href="#lab06-k-agent-__codelineno-15-40"></a>
</span><span id="__span-15-41"><a id="__codelineno-15-41" name="__codelineno-15-41" href="#lab06-k-agent-__codelineno-15-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span id="__span-15-42"><a id="__codelineno-15-42" name="__codelineno-15-42" href="#lab06-k-agent-__codelineno-15-42"></a><span class="p">}</span>
</span><span id="__span-15-43"><a id="__codelineno-15-43" name="__codelineno-15-43" href="#lab06-k-agent-__codelineno-15-43"></a>
</span><span id="__span-15-44"><a id="__codelineno-15-44" name="__codelineno-15-44" href="#lab06-k-agent-__codelineno-15-44"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">containerName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-45"><a id="__codelineno-15-45" name="__codelineno-15-45" href="#lab06-k-agent-__codelineno-15-45"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-46"><a id="__codelineno-15-46" name="__codelineno-15-46" href="#lab06-k-agent-__codelineno-15-46"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">readNamespacedPodLog</span><span class="p">({</span>
</span><span id="__span-15-47"><a id="__codelineno-15-47" name="__codelineno-15-47" href="#lab06-k-agent-__codelineno-15-47"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">podName</span><span class="p">,</span>
</span><span id="__span-15-48"><a id="__codelineno-15-48" name="__codelineno-15-48" href="#lab06-k-agent-__codelineno-15-48"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">namespace</span><span class="p">,</span>
</span><span id="__span-15-49"><a id="__codelineno-15-49" name="__codelineno-15-49" href="#lab06-k-agent-__codelineno-15-49"></a><span class="w">      </span><span class="nx">container</span><span class="o">:</span><span class="w"> </span><span class="kt">containerName</span><span class="p">,</span>
</span><span id="__span-15-50"><a id="__codelineno-15-50" name="__codelineno-15-50" href="#lab06-k-agent-__codelineno-15-50"></a><span class="w">      </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">tailLines</span><span class="p">,</span>
</span><span id="__span-15-51"><a id="__codelineno-15-51" name="__codelineno-15-51" href="#lab06-k-agent-__codelineno-15-51"></a><span class="w">      </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-15-52"><a id="__codelineno-15-52" name="__codelineno-15-52" href="#lab06-k-agent-__codelineno-15-52"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-15-53"><a id="__codelineno-15-53" name="__codelineno-15-53" href="#lab06-k-agent-__codelineno-15-53"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-15-54"><a id="__codelineno-15-54" name="__codelineno-15-54" href="#lab06-k-agent-__codelineno-15-54"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-55"><a id="__codelineno-15-55" name="__codelineno-15-55" href="#lab06-k-agent-__codelineno-15-55"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-15-56"><a id="__codelineno-15-56" name="__codelineno-15-56" href="#lab06-k-agent-__codelineno-15-56"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-15-57"><a id="__codelineno-15-57" name="__codelineno-15-57" href="#lab06-k-agent-__codelineno-15-57"></a><span class="p">}</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Complete <code>src/index.ts</code> After Step 4</p>
<p>Here&rsquo;s what your complete <code>src/index.ts</code> file should look like after completing Step 4:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#lab06-k-agent-__codelineno-16-1"></a><span class="c1">// Import MCP SDK components and Kubernetes client</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#lab06-k-agent-__codelineno-16-2"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#lab06-k-agent-__codelineno-16-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#lab06-k-agent-__codelineno-16-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#lab06-k-agent-__codelineno-16-5"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#lab06-k-agent-__codelineno-16-6"></a><span class="w">  </span><span class="nx">ErrorCode</span><span class="p">,</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#lab06-k-agent-__codelineno-16-7"></a><span class="w">  </span><span class="nx">ListResourcesRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#lab06-k-agent-__codelineno-16-8"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#lab06-k-agent-__codelineno-16-9"></a><span class="w">  </span><span class="nx">McpError</span><span class="p">,</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#lab06-k-agent-__codelineno-16-10"></a><span class="w">  </span><span class="nx">ReadResourceRequestSchema</span><span class="p">,</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#lab06-k-agent-__codelineno-16-11"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#lab06-k-agent-__codelineno-16-12"></a><span class="k">import</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="nx">k8s</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;@kubernetes/client-node&#39;</span><span class="p">;</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#lab06-k-agent-__codelineno-16-13"></a>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#lab06-k-agent-__codelineno-16-14"></a><span class="kd">class</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-15"><a id="__codelineno-16-15" name="__codelineno-16-15" href="#lab06-k-agent-__codelineno-16-15"></a><span class="w">  </span><span class="c1">// Store Kubernetes API clients (for talking to your cluster)</span>
</span><span id="__span-16-16"><a id="__codelineno-16-16" name="__codelineno-16-16" href="#lab06-k-agent-__codelineno-16-16"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sConfig</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.KubeConfig</span><span class="p">;</span>
</span><span id="__span-16-17"><a id="__codelineno-16-17" name="__codelineno-16-17" href="#lab06-k-agent-__codelineno-16-17"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sAppsApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.AppsV1Api</span><span class="p">;</span>
</span><span id="__span-16-18"><a id="__codelineno-16-18" name="__codelineno-16-18" href="#lab06-k-agent-__codelineno-16-18"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">k8sCoreApi</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.CoreV1Api</span><span class="p">;</span>
</span><span id="__span-16-19"><a id="__codelineno-16-19" name="__codelineno-16-19" href="#lab06-k-agent-__codelineno-16-19"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">server</span><span class="o">:</span><span class="w"> </span><span class="kt">Server</span><span class="p">;</span>
</span><span id="__span-16-20"><a id="__codelineno-16-20" name="__codelineno-16-20" href="#lab06-k-agent-__codelineno-16-20"></a>
</span><span id="__span-16-21"><a id="__codelineno-16-21" name="__codelineno-16-21" href="#lab06-k-agent-__codelineno-16-21"></a><span class="w">  </span><span class="kr">constructor</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-22"><a id="__codelineno-16-22" name="__codelineno-16-22" href="#lab06-k-agent-__codelineno-16-22"></a><span class="w">    </span><span class="c1">// Initialize connection to your Kubernetes cluster (uses ~/.kube/config)</span>
</span><span id="__span-16-23"><a id="__codelineno-16-23" name="__codelineno-16-23" href="#lab06-k-agent-__codelineno-16-23"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">k8s</span><span class="p">.</span><span class="nx">KubeConfig</span><span class="p">();</span>
</span><span id="__span-16-24"><a id="__codelineno-16-24" name="__codelineno-16-24" href="#lab06-k-agent-__codelineno-16-24"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">loadFromDefault</span><span class="p">();</span>
</span><span id="__span-16-25"><a id="__codelineno-16-25" name="__codelineno-16-25" href="#lab06-k-agent-__codelineno-16-25"></a>
</span><span id="__span-16-26"><a id="__codelineno-16-26" name="__codelineno-16-26" href="#lab06-k-agent-__codelineno-16-26"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sAppsApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">AppsV1Api</span><span class="p">);</span>
</span><span id="__span-16-27"><a id="__codelineno-16-27" name="__codelineno-16-27" href="#lab06-k-agent-__codelineno-16-27"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sConfig</span><span class="p">.</span><span class="nx">makeApiClient</span><span class="p">(</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">CoreV1Api</span><span class="p">);</span>
</span><span id="__span-16-28"><a id="__codelineno-16-28" name="__codelineno-16-28" href="#lab06-k-agent-__codelineno-16-28"></a>
</span><span id="__span-16-29"><a id="__codelineno-16-29" name="__codelineno-16-29" href="#lab06-k-agent-__codelineno-16-29"></a><span class="w">    </span><span class="c1">// Create MCP server that AI tools can connect to</span>
</span><span id="__span-16-30"><a id="__codelineno-16-30" name="__codelineno-16-30" href="#lab06-k-agent-__codelineno-16-30"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-16-31"><a id="__codelineno-16-31" name="__codelineno-16-31" href="#lab06-k-agent-__codelineno-16-31"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-16-32"><a id="__codelineno-16-32" name="__codelineno-16-32" href="#lab06-k-agent-__codelineno-16-32"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;k-agent-logs&quot;</span><span class="p">,</span>
</span><span id="__span-16-33"><a id="__codelineno-16-33" name="__codelineno-16-33" href="#lab06-k-agent-__codelineno-16-33"></a><span class="w">        </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-16-34"><a id="__codelineno-16-34" name="__codelineno-16-34" href="#lab06-k-agent-__codelineno-16-34"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-16-35"><a id="__codelineno-16-35" name="__codelineno-16-35" href="#lab06-k-agent-__codelineno-16-35"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-16-36"><a id="__codelineno-16-36" name="__codelineno-16-36" href="#lab06-k-agent-__codelineno-16-36"></a><span class="w">        </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-37"><a id="__codelineno-16-37" name="__codelineno-16-37" href="#lab06-k-agent-__codelineno-16-37"></a><span class="w">          </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-16-38"><a id="__codelineno-16-38" name="__codelineno-16-38" href="#lab06-k-agent-__codelineno-16-38"></a><span class="w">          </span><span class="nx">resources</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-16-39"><a id="__codelineno-16-39" name="__codelineno-16-39" href="#lab06-k-agent-__codelineno-16-39"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-16-40"><a id="__codelineno-16-40" name="__codelineno-16-40" href="#lab06-k-agent-__codelineno-16-40"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-41"><a id="__codelineno-16-41" name="__codelineno-16-41" href="#lab06-k-agent-__codelineno-16-41"></a><span class="w">    </span><span class="p">);</span>
</span><span id="__span-16-42"><a id="__codelineno-16-42" name="__codelineno-16-42" href="#lab06-k-agent-__codelineno-16-42"></a>
</span><span id="__span-16-43"><a id="__codelineno-16-43" name="__codelineno-16-43" href="#lab06-k-agent-__codelineno-16-43"></a><span class="w">    </span><span class="c1">// Handle incoming MCP requests</span>
</span><span id="__span-16-44"><a id="__codelineno-16-44" name="__codelineno-16-44" href="#lab06-k-agent-__codelineno-16-44"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">setupHandlers</span><span class="p">();</span>
</span><span id="__span-16-45"><a id="__codelineno-16-45" name="__codelineno-16-45" href="#lab06-k-agent-__codelineno-16-45"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-46"><a id="__codelineno-16-46" name="__codelineno-16-46" href="#lab06-k-agent-__codelineno-16-46"></a>
</span><span id="__span-16-47"><a id="__codelineno-16-47" name="__codelineno-16-47" href="#lab06-k-agent-__codelineno-16-47"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">setupHandlers</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-48"><a id="__codelineno-16-48" name="__codelineno-16-48" href="#lab06-k-agent-__codelineno-16-48"></a><span class="w">    </span><span class="c1">// List available tools</span>
</span><span id="__span-16-49"><a id="__codelineno-16-49" name="__codelineno-16-49" href="#lab06-k-agent-__codelineno-16-49"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-50"><a id="__codelineno-16-50" name="__codelineno-16-50" href="#lab06-k-agent-__codelineno-16-50"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-51"><a id="__codelineno-16-51" name="__codelineno-16-51" href="#lab06-k-agent-__codelineno-16-51"></a><span class="w">        </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-52"><a id="__codelineno-16-52" name="__codelineno-16-52" href="#lab06-k-agent-__codelineno-16-52"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-16-53"><a id="__codelineno-16-53" name="__codelineno-16-53" href="#lab06-k-agent-__codelineno-16-53"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="p">,</span>
</span><span id="__span-16-54"><a id="__codelineno-16-54" name="__codelineno-16-54" href="#lab06-k-agent-__codelineno-16-54"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List all pods across namespaces with their status&quot;</span><span class="p">,</span>
</span><span id="__span-16-55"><a id="__codelineno-16-55" name="__codelineno-16-55" href="#lab06-k-agent-__codelineno-16-55"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-56"><a id="__codelineno-16-56" name="__codelineno-16-56" href="#lab06-k-agent-__codelineno-16-56"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-16-57"><a id="__codelineno-16-57" name="__codelineno-16-57" href="#lab06-k-agent-__codelineno-16-57"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-58"><a id="__codelineno-16-58" name="__codelineno-16-58" href="#lab06-k-agent-__codelineno-16-58"></a><span class="w">                </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-59"><a id="__codelineno-16-59" name="__codelineno-16-59" href="#lab06-k-agent-__codelineno-16-59"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-16-60"><a id="__codelineno-16-60" name="__codelineno-16-60" href="#lab06-k-agent-__codelineno-16-60"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by specific namespace&quot;</span>
</span><span id="__span-16-61"><a id="__codelineno-16-61" name="__codelineno-16-61" href="#lab06-k-agent-__codelineno-16-61"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-16-62"><a id="__codelineno-16-62" name="__codelineno-16-62" href="#lab06-k-agent-__codelineno-16-62"></a><span class="w">              </span><span class="p">}</span>
</span><span id="__span-16-63"><a id="__codelineno-16-63" name="__codelineno-16-63" href="#lab06-k-agent-__codelineno-16-63"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-16-64"><a id="__codelineno-16-64" name="__codelineno-16-64" href="#lab06-k-agent-__codelineno-16-64"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-16-65"><a id="__codelineno-16-65" name="__codelineno-16-65" href="#lab06-k-agent-__codelineno-16-65"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-16-66"><a id="__codelineno-16-66" name="__codelineno-16-66" href="#lab06-k-agent-__codelineno-16-66"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;collect_pod_logs&quot;</span><span class="p">,</span>
</span><span id="__span-16-67"><a id="__codelineno-16-67" name="__codelineno-16-67" href="#lab06-k-agent-__codelineno-16-67"></a><span class="w">            </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Collect logs from all containers in specified pods&quot;</span><span class="p">,</span>
</span><span id="__span-16-68"><a id="__codelineno-16-68" name="__codelineno-16-68" href="#lab06-k-agent-__codelineno-16-68"></a><span class="w">            </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-69"><a id="__codelineno-16-69" name="__codelineno-16-69" href="#lab06-k-agent-__codelineno-16-69"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-16-70"><a id="__codelineno-16-70" name="__codelineno-16-70" href="#lab06-k-agent-__codelineno-16-70"></a><span class="w">              </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-71"><a id="__codelineno-16-71" name="__codelineno-16-71" href="#lab06-k-agent-__codelineno-16-71"></a><span class="w">                </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-72"><a id="__codelineno-16-72" name="__codelineno-16-72" href="#lab06-k-agent-__codelineno-16-72"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-16-73"><a id="__codelineno-16-73" name="__codelineno-16-73" href="#lab06-k-agent-__codelineno-16-73"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Namespace to collect logs from&quot;</span>
</span><span id="__span-16-74"><a id="__codelineno-16-74" name="__codelineno-16-74" href="#lab06-k-agent-__codelineno-16-74"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-16-75"><a id="__codelineno-16-75" name="__codelineno-16-75" href="#lab06-k-agent-__codelineno-16-75"></a><span class="w">                </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-76"><a id="__codelineno-16-76" name="__codelineno-16-76" href="#lab06-k-agent-__codelineno-16-76"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-16-77"><a id="__codelineno-16-77" name="__codelineno-16-77" href="#lab06-k-agent-__codelineno-16-77"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Specific pod name (optional - collects from all if not specified)&quot;</span>
</span><span id="__span-16-78"><a id="__codelineno-16-78" name="__codelineno-16-78" href="#lab06-k-agent-__codelineno-16-78"></a><span class="w">                </span><span class="p">},</span>
</span><span id="__span-16-79"><a id="__codelineno-16-79" name="__codelineno-16-79" href="#lab06-k-agent-__codelineno-16-79"></a><span class="w">                </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-80"><a id="__codelineno-16-80" name="__codelineno-16-80" href="#lab06-k-agent-__codelineno-16-80"></a><span class="w">                  </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-16-81"><a id="__codelineno-16-81" name="__codelineno-16-81" href="#lab06-k-agent-__codelineno-16-81"></a><span class="w">                  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Number of recent log lines to retrieve&quot;</span><span class="p">,</span>
</span><span id="__span-16-82"><a id="__codelineno-16-82" name="__codelineno-16-82" href="#lab06-k-agent-__codelineno-16-82"></a><span class="w">                  </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-16-83"><a id="__codelineno-16-83" name="__codelineno-16-83" href="#lab06-k-agent-__codelineno-16-83"></a><span class="w">                </span><span class="p">}</span>
</span><span id="__span-16-84"><a id="__codelineno-16-84" name="__codelineno-16-84" href="#lab06-k-agent-__codelineno-16-84"></a><span class="w">              </span><span class="p">},</span>
</span><span id="__span-16-85"><a id="__codelineno-16-85" name="__codelineno-16-85" href="#lab06-k-agent-__codelineno-16-85"></a><span class="w">              </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
</span><span id="__span-16-86"><a id="__codelineno-16-86" name="__codelineno-16-86" href="#lab06-k-agent-__codelineno-16-86"></a><span class="w">            </span><span class="p">}</span>
</span><span id="__span-16-87"><a id="__codelineno-16-87" name="__codelineno-16-87" href="#lab06-k-agent-__codelineno-16-87"></a><span class="w">          </span><span class="p">}</span>
</span><span id="__span-16-88"><a id="__codelineno-16-88" name="__codelineno-16-88" href="#lab06-k-agent-__codelineno-16-88"></a><span class="w">        </span><span class="p">]</span>
</span><span id="__span-16-89"><a id="__codelineno-16-89" name="__codelineno-16-89" href="#lab06-k-agent-__codelineno-16-89"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-16-90"><a id="__codelineno-16-90" name="__codelineno-16-90" href="#lab06-k-agent-__codelineno-16-90"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-91"><a id="__codelineno-16-91" name="__codelineno-16-91" href="#lab06-k-agent-__codelineno-16-91"></a>
</span><span id="__span-16-92"><a id="__codelineno-16-92" name="__codelineno-16-92" href="#lab06-k-agent-__codelineno-16-92"></a><span class="w">    </span><span class="c1">// Handle tool calls</span>
</span><span id="__span-16-93"><a id="__codelineno-16-93" name="__codelineno-16-93" href="#lab06-k-agent-__codelineno-16-93"></a><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-94"><a id="__codelineno-16-94" name="__codelineno-16-94" href="#lab06-k-agent-__codelineno-16-94"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-16-95"><a id="__codelineno-16-95" name="__codelineno-16-95" href="#lab06-k-agent-__codelineno-16-95"></a>
</span><span id="__span-16-96"><a id="__codelineno-16-96" name="__codelineno-16-96" href="#lab06-k-agent-__codelineno-16-96"></a><span class="w">      </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-97"><a id="__codelineno-16-97" name="__codelineno-16-97" href="#lab06-k-agent-__codelineno-16-97"></a><span class="w">        </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-98"><a id="__codelineno-16-98" name="__codelineno-16-98" href="#lab06-k-agent-__codelineno-16-98"></a><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="o">:</span>
</span><span id="__span-16-99"><a id="__codelineno-16-99" name="__codelineno-16-99" href="#lab06-k-agent-__codelineno-16-99"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-16-100"><a id="__codelineno-16-100" name="__codelineno-16-100" href="#lab06-k-agent-__codelineno-16-100"></a><span class="w">          </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;collect_pod_logs&quot;</span><span class="o">:</span>
</span><span id="__span-16-101"><a id="__codelineno-16-101" name="__codelineno-16-101" href="#lab06-k-agent-__codelineno-16-101"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span><span id="__span-16-102"><a id="__codelineno-16-102" name="__codelineno-16-102" href="#lab06-k-agent-__codelineno-16-102"></a><span class="w">          </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-16-103"><a id="__codelineno-16-103" name="__codelineno-16-103" href="#lab06-k-agent-__codelineno-16-103"></a><span class="w">            </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-16-104"><a id="__codelineno-16-104" name="__codelineno-16-104" href="#lab06-k-agent-__codelineno-16-104"></a><span class="w">              </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="nx">MethodNotFound</span><span class="p">,</span>
</span><span id="__span-16-105"><a id="__codelineno-16-105" name="__codelineno-16-105" href="#lab06-k-agent-__codelineno-16-105"></a><span class="w">              </span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-16-106"><a id="__codelineno-16-106" name="__codelineno-16-106" href="#lab06-k-agent-__codelineno-16-106"></a><span class="w">            </span><span class="p">);</span>
</span><span id="__span-16-107"><a id="__codelineno-16-107" name="__codelineno-16-107" href="#lab06-k-agent-__codelineno-16-107"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-108"><a id="__codelineno-16-108" name="__codelineno-16-108" href="#lab06-k-agent-__codelineno-16-108"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-109"><a id="__codelineno-16-109" name="__codelineno-16-109" href="#lab06-k-agent-__codelineno-16-109"></a><span class="w">        </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">McpError</span><span class="p">(</span>
</span><span id="__span-16-110"><a id="__codelineno-16-110" name="__codelineno-16-110" href="#lab06-k-agent-__codelineno-16-110"></a><span class="w">          </span><span class="nx">ErrorCode</span><span class="p">.</span><span class="ne">InternalError</span><span class="p">,</span>
</span><span id="__span-16-111"><a id="__codelineno-16-111" name="__codelineno-16-111" href="#lab06-k-agent-__codelineno-16-111"></a><span class="w">          </span><span class="sb">`Tool execution failed: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-16-112"><a id="__codelineno-16-112" name="__codelineno-16-112" href="#lab06-k-agent-__codelineno-16-112"></a><span class="w">        </span><span class="p">);</span>
</span><span id="__span-16-113"><a id="__codelineno-16-113" name="__codelineno-16-113" href="#lab06-k-agent-__codelineno-16-113"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-114"><a id="__codelineno-16-114" name="__codelineno-16-114" href="#lab06-k-agent-__codelineno-16-114"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-16-115"><a id="__codelineno-16-115" name="__codelineno-16-115" href="#lab06-k-agent-__codelineno-16-115"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-116"><a id="__codelineno-16-116" name="__codelineno-16-116" href="#lab06-k-agent-__codelineno-16-116"></a>
</span><span id="__span-16-117"><a id="__codelineno-16-117" name="__codelineno-16-117" href="#lab06-k-agent-__codelineno-16-117"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-118"><a id="__codelineno-16-118" name="__codelineno-16-118" href="#lab06-k-agent-__codelineno-16-118"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">namespace</span><span class="p">;</span>
</span><span id="__span-16-119"><a id="__codelineno-16-119" name="__codelineno-16-119" href="#lab06-k-agent-__codelineno-16-119"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-16-120"><a id="__codelineno-16-120" name="__codelineno-16-120" href="#lab06-k-agent-__codelineno-16-120"></a>
</span><span id="__span-16-121"><a id="__codelineno-16-121" name="__codelineno-16-121" href="#lab06-k-agent-__codelineno-16-121"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-16-122"><a id="__codelineno-16-122" name="__codelineno-16-122" href="#lab06-k-agent-__codelineno-16-122"></a><span class="w">      </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-16-123"><a id="__codelineno-16-123" name="__codelineno-16-123" href="#lab06-k-agent-__codelineno-16-123"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-16-124"><a id="__codelineno-16-124" name="__codelineno-16-124" href="#lab06-k-agent-__codelineno-16-124"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-16-125"><a id="__codelineno-16-125" name="__codelineno-16-125" href="#lab06-k-agent-__codelineno-16-125"></a><span class="w">      </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[]</span>
</span><span id="__span-16-126"><a id="__codelineno-16-126" name="__codelineno-16-126" href="#lab06-k-agent-__codelineno-16-126"></a><span class="w">    </span><span class="p">}));</span>
</span><span id="__span-16-127"><a id="__codelineno-16-127" name="__codelineno-16-127" href="#lab06-k-agent-__codelineno-16-127"></a>
</span><span id="__span-16-128"><a id="__codelineno-16-128" name="__codelineno-16-128" href="#lab06-k-agent-__codelineno-16-128"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-129"><a id="__codelineno-16-129" name="__codelineno-16-129" href="#lab06-k-agent-__codelineno-16-129"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-130"><a id="__codelineno-16-130" name="__codelineno-16-130" href="#lab06-k-agent-__codelineno-16-130"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-131"><a id="__codelineno-16-131" name="__codelineno-16-131" href="#lab06-k-agent-__codelineno-16-131"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-16-132"><a id="__codelineno-16-132" name="__codelineno-16-132" href="#lab06-k-agent-__codelineno-16-132"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-16-133"><a id="__codelineno-16-133" name="__codelineno-16-133" href="#lab06-k-agent-__codelineno-16-133"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-134"><a id="__codelineno-16-134" name="__codelineno-16-134" href="#lab06-k-agent-__codelineno-16-134"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-16-135"><a id="__codelineno-16-135" name="__codelineno-16-135" href="#lab06-k-agent-__codelineno-16-135"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-136"><a id="__codelineno-16-136" name="__codelineno-16-136" href="#lab06-k-agent-__codelineno-16-136"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-137"><a id="__codelineno-16-137" name="__codelineno-16-137" href="#lab06-k-agent-__codelineno-16-137"></a>
</span><span id="__span-16-138"><a id="__codelineno-16-138" name="__codelineno-16-138" href="#lab06-k-agent-__codelineno-16-138"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleCollectPodLogs</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-139"><a id="__codelineno-16-139" name="__codelineno-16-139" href="#lab06-k-agent-__codelineno-16-139"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-16-140"><a id="__codelineno-16-140" name="__codelineno-16-140" href="#lab06-k-agent-__codelineno-16-140"></a>
</span><span id="__span-16-141"><a id="__codelineno-16-141" name="__codelineno-16-141" href="#lab06-k-agent-__codelineno-16-141"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-142"><a id="__codelineno-16-142" name="__codelineno-16-142" href="#lab06-k-agent-__codelineno-16-142"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Namespace is required&quot;</span><span class="p">);</span>
</span><span id="__span-16-143"><a id="__codelineno-16-143" name="__codelineno-16-143" href="#lab06-k-agent-__codelineno-16-143"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-144"><a id="__codelineno-16-144" name="__codelineno-16-144" href="#lab06-k-agent-__codelineno-16-144"></a>
</span><span id="__span-16-145"><a id="__codelineno-16-145" name="__codelineno-16-145" href="#lab06-k-agent-__codelineno-16-145"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-16-146"><a id="__codelineno-16-146" name="__codelineno-16-146" href="#lab06-k-agent-__codelineno-16-146"></a>
</span><span id="__span-16-147"><a id="__codelineno-16-147" name="__codelineno-16-147" href="#lab06-k-agent-__codelineno-16-147"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-148"><a id="__codelineno-16-148" name="__codelineno-16-148" href="#lab06-k-agent-__codelineno-16-148"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-16-149"><a id="__codelineno-16-149" name="__codelineno-16-149" href="#lab06-k-agent-__codelineno-16-149"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-16-150"><a id="__codelineno-16-150" name="__codelineno-16-150" href="#lab06-k-agent-__codelineno-16-150"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-16-151"><a id="__codelineno-16-151" name="__codelineno-16-151" href="#lab06-k-agent-__codelineno-16-151"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">logs</span>
</span><span id="__span-16-152"><a id="__codelineno-16-152" name="__codelineno-16-152" href="#lab06-k-agent-__codelineno-16-152"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-153"><a id="__codelineno-16-153" name="__codelineno-16-153" href="#lab06-k-agent-__codelineno-16-153"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-16-154"><a id="__codelineno-16-154" name="__codelineno-16-154" href="#lab06-k-agent-__codelineno-16-154"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-16-155"><a id="__codelineno-16-155" name="__codelineno-16-155" href="#lab06-k-agent-__codelineno-16-155"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-156"><a id="__codelineno-16-156" name="__codelineno-16-156" href="#lab06-k-agent-__codelineno-16-156"></a>
</span><span id="__span-16-157"><a id="__codelineno-16-157" name="__codelineno-16-157" href="#lab06-k-agent-__codelineno-16-157"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-158"><a id="__codelineno-16-158" name="__codelineno-16-158" href="#lab06-k-agent-__codelineno-16-158"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">podName</span><span class="w"> </span>
</span><span id="__span-16-159"><a id="__codelineno-16-159" name="__codelineno-16-159" href="#lab06-k-agent-__codelineno-16-159"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">pods</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">podName</span><span class="p">))</span><span class="w"> </span>
</span><span id="__span-16-160"><a id="__codelineno-16-160" name="__codelineno-16-160" href="#lab06-k-agent-__codelineno-16-160"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-16-161"><a id="__codelineno-16-161" name="__codelineno-16-161" href="#lab06-k-agent-__codelineno-16-161"></a>
</span><span id="__span-16-162"><a id="__codelineno-16-162" name="__codelineno-16-162" href="#lab06-k-agent-__codelineno-16-162"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">allLogs</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-16-163"><a id="__codelineno-16-163" name="__codelineno-16-163" href="#lab06-k-agent-__codelineno-16-163"></a>
</span><span id="__span-16-164"><a id="__codelineno-16-164" name="__codelineno-16-164" href="#lab06-k-agent-__codelineno-16-164"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">pod</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-165"><a id="__codelineno-16-165" name="__codelineno-16-165" href="#lab06-k-agent-__codelineno-16-165"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-16-166"><a id="__codelineno-16-166" name="__codelineno-16-166" href="#lab06-k-agent-__codelineno-16-166"></a>
</span><span id="__span-16-167"><a id="__codelineno-16-167" name="__codelineno-16-167" href="#lab06-k-agent-__codelineno-16-167"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">containers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">spec</span><span class="o">?</span><span class="p">.</span><span class="nx">containers</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-16-168"><a id="__codelineno-16-168" name="__codelineno-16-168" href="#lab06-k-agent-__codelineno-16-168"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">container</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">containers</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-169"><a id="__codelineno-16-169" name="__codelineno-16-169" href="#lab06-k-agent-__codelineno-16-169"></a><span class="w">        </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-170"><a id="__codelineno-16-170" name="__codelineno-16-170" href="#lab06-k-agent-__codelineno-16-170"></a><span class="w">          </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-16-171"><a id="__codelineno-16-171" name="__codelineno-16-171" href="#lab06-k-agent-__codelineno-16-171"></a><span class="w">          </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\n</span><span class="si">${</span><span class="nx">logs</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-16-172"><a id="__codelineno-16-172" name="__codelineno-16-172" href="#lab06-k-agent-__codelineno-16-172"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-173"><a id="__codelineno-16-173" name="__codelineno-16-173" href="#lab06-k-agent-__codelineno-16-173"></a><span class="w">          </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="sb">`=== </span><span class="si">${</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">container</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb"> ===\nError retrieving logs: </span><span class="si">${</span><span class="nx">error</span><span class="w"> </span><span class="ow">instanceof</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="nx">error.message</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="kt">String</span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-16-174"><a id="__codelineno-16-174" name="__codelineno-16-174" href="#lab06-k-agent-__codelineno-16-174"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-16-175"><a id="__codelineno-16-175" name="__codelineno-16-175" href="#lab06-k-agent-__codelineno-16-175"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-176"><a id="__codelineno-16-176" name="__codelineno-16-176" href="#lab06-k-agent-__codelineno-16-176"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-177"><a id="__codelineno-16-177" name="__codelineno-16-177" href="#lab06-k-agent-__codelineno-16-177"></a>
</span><span id="__span-16-178"><a id="__codelineno-16-178" name="__codelineno-16-178" href="#lab06-k-agent-__codelineno-16-178"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">allLogs</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span id="__span-16-179"><a id="__codelineno-16-179" name="__codelineno-16-179" href="#lab06-k-agent-__codelineno-16-179"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-180"><a id="__codelineno-16-180" name="__codelineno-16-180" href="#lab06-k-agent-__codelineno-16-180"></a>
</span><span id="__span-16-181"><a id="__codelineno-16-181" name="__codelineno-16-181" href="#lab06-k-agent-__codelineno-16-181"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-182"><a id="__codelineno-16-182" name="__codelineno-16-182" href="#lab06-k-agent-__codelineno-16-182"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-183"><a id="__codelineno-16-183" name="__codelineno-16-183" href="#lab06-k-agent-__codelineno-16-183"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-184"><a id="__codelineno-16-184" name="__codelineno-16-184" href="#lab06-k-agent-__codelineno-16-184"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span><span class="w"> </span><span class="nx">namespace</span><span class="w"> </span><span class="p">});</span>
</span><span id="__span-16-185"><a id="__codelineno-16-185" name="__codelineno-16-185" href="#lab06-k-agent-__codelineno-16-185"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-16-186"><a id="__codelineno-16-186" name="__codelineno-16-186" href="#lab06-k-agent-__codelineno-16-186"></a><span class="w">      </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-187"><a id="__codelineno-16-187" name="__codelineno-16-187" href="#lab06-k-agent-__codelineno-16-187"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">();</span>
</span><span id="__span-16-188"><a id="__codelineno-16-188" name="__codelineno-16-188" href="#lab06-k-agent-__codelineno-16-188"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-16-189"><a id="__codelineno-16-189" name="__codelineno-16-189" href="#lab06-k-agent-__codelineno-16-189"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-16-190"><a id="__codelineno-16-190" name="__codelineno-16-190" href="#lab06-k-agent-__codelineno-16-190"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-191"><a id="__codelineno-16-191" name="__codelineno-16-191" href="#lab06-k-agent-__codelineno-16-191"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-16-192"><a id="__codelineno-16-192" name="__codelineno-16-192" href="#lab06-k-agent-__codelineno-16-192"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-193"><a id="__codelineno-16-193" name="__codelineno-16-193" href="#lab06-k-agent-__codelineno-16-193"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-194"><a id="__codelineno-16-194" name="__codelineno-16-194" href="#lab06-k-agent-__codelineno-16-194"></a>
</span><span id="__span-16-195"><a id="__codelineno-16-195" name="__codelineno-16-195" href="#lab06-k-agent-__codelineno-16-195"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">containerName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">number</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-196"><a id="__codelineno-16-196" name="__codelineno-16-196" href="#lab06-k-agent-__codelineno-16-196"></a><span class="w">    </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-197"><a id="__codelineno-16-197" name="__codelineno-16-197" href="#lab06-k-agent-__codelineno-16-197"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">readNamespacedPodLog</span><span class="p">({</span>
</span><span id="__span-16-198"><a id="__codelineno-16-198" name="__codelineno-16-198" href="#lab06-k-agent-__codelineno-16-198"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">podName</span><span class="p">,</span>
</span><span id="__span-16-199"><a id="__codelineno-16-199" name="__codelineno-16-199" href="#lab06-k-agent-__codelineno-16-199"></a><span class="w">        </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">namespace</span><span class="p">,</span>
</span><span id="__span-16-200"><a id="__codelineno-16-200" name="__codelineno-16-200" href="#lab06-k-agent-__codelineno-16-200"></a><span class="w">        </span><span class="nx">container</span><span class="o">:</span><span class="w"> </span><span class="kt">containerName</span><span class="p">,</span>
</span><span id="__span-16-201"><a id="__codelineno-16-201" name="__codelineno-16-201" href="#lab06-k-agent-__codelineno-16-201"></a><span class="w">        </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="kt">tailLines</span><span class="p">,</span>
</span><span id="__span-16-202"><a id="__codelineno-16-202" name="__codelineno-16-202" href="#lab06-k-agent-__codelineno-16-202"></a><span class="w">        </span><span class="nx">timestamps</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-16-203"><a id="__codelineno-16-203" name="__codelineno-16-203" href="#lab06-k-agent-__codelineno-16-203"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-16-204"><a id="__codelineno-16-204" name="__codelineno-16-204" href="#lab06-k-agent-__codelineno-16-204"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-16-205"><a id="__codelineno-16-205" name="__codelineno-16-205" href="#lab06-k-agent-__codelineno-16-205"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-206"><a id="__codelineno-16-206" name="__codelineno-16-206" href="#lab06-k-agent-__codelineno-16-206"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-16-207"><a id="__codelineno-16-207" name="__codelineno-16-207" href="#lab06-k-agent-__codelineno-16-207"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-208"><a id="__codelineno-16-208" name="__codelineno-16-208" href="#lab06-k-agent-__codelineno-16-208"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-209"><a id="__codelineno-16-209" name="__codelineno-16-209" href="#lab06-k-agent-__codelineno-16-209"></a>
</span><span id="__span-16-210"><a id="__codelineno-16-210" name="__codelineno-16-210" href="#lab06-k-agent-__codelineno-16-210"></a><span class="w">  </span><span class="k">private</span><span class="w"> </span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="ne">Error</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-211"><a id="__codelineno-16-211" name="__codelineno-16-211" href="#lab06-k-agent-__codelineno-16-211"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">403</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-212"><a id="__codelineno-16-212" name="__codelineno-16-212" href="#lab06-k-agent-__codelineno-16-212"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Access denied: Insufficient permissions to access Kubernetes resources&#39;</span><span class="p">);</span>
</span><span id="__span-16-213"><a id="__codelineno-16-213" name="__codelineno-16-213" href="#lab06-k-agent-__codelineno-16-213"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-214"><a id="__codelineno-16-214" name="__codelineno-16-214" href="#lab06-k-agent-__codelineno-16-214"></a>
</span><span id="__span-16-215"><a id="__codelineno-16-215" name="__codelineno-16-215" href="#lab06-k-agent-__codelineno-16-215"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">response</span><span class="o">?</span><span class="p">.</span><span class="nx">statusCode</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">404</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-216"><a id="__codelineno-16-216" name="__codelineno-16-216" href="#lab06-k-agent-__codelineno-16-216"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;Resource not found: The specified pod or namespace may not exist&#39;</span><span class="p">);</span>
</span><span id="__span-16-217"><a id="__codelineno-16-217" name="__codelineno-16-217" href="#lab06-k-agent-__codelineno-16-217"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-16-218"><a id="__codelineno-16-218" name="__codelineno-16-218" href="#lab06-k-agent-__codelineno-16-218"></a>
</span><span id="__span-16-219"><a id="__codelineno-16-219" name="__codelineno-16-219" href="#lab06-k-agent-__codelineno-16-219"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Kubernetes operation failed: </span><span class="si">${</span><span class="nx">error</span><span class="p">.</span><span class="nx">message</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-16-220"><a id="__codelineno-16-220" name="__codelineno-16-220" href="#lab06-k-agent-__codelineno-16-220"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-221"><a id="__codelineno-16-221" name="__codelineno-16-221" href="#lab06-k-agent-__codelineno-16-221"></a>
</span><span id="__span-16-222"><a id="__codelineno-16-222" name="__codelineno-16-222" href="#lab06-k-agent-__codelineno-16-222"></a><span class="w">  </span><span class="c1">// Start the server and listen for connections</span>
</span><span id="__span-16-223"><a id="__codelineno-16-223" name="__codelineno-16-223" href="#lab06-k-agent-__codelineno-16-223"></a><span class="w">  </span><span class="k">async</span><span class="w"> </span><span class="nx">run</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-224"><a id="__codelineno-16-224" name="__codelineno-16-224" href="#lab06-k-agent-__codelineno-16-224"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-16-225"><a id="__codelineno-16-225" name="__codelineno-16-225" href="#lab06-k-agent-__codelineno-16-225"></a><span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-16-226"><a id="__codelineno-16-226" name="__codelineno-16-226" href="#lab06-k-agent-__codelineno-16-226"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;K-Agent MCP server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-16-227"><a id="__codelineno-16-227" name="__codelineno-16-227" href="#lab06-k-agent-__codelineno-16-227"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-16-228"><a id="__codelineno-16-228" name="__codelineno-16-228" href="#lab06-k-agent-__codelineno-16-228"></a><span class="p">}</span>
</span><span id="__span-16-229"><a id="__codelineno-16-229" name="__codelineno-16-229" href="#lab06-k-agent-__codelineno-16-229"></a>
</span><span id="__span-16-230"><a id="__codelineno-16-230" name="__codelineno-16-230" href="#lab06-k-agent-__codelineno-16-230"></a><span class="c1">// Actually run the server</span>
</span><span id="__span-16-231"><a id="__codelineno-16-231" name="__codelineno-16-231" href="#lab06-k-agent-__codelineno-16-231"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">KAgentServer</span><span class="p">();</span>
</span><span id="__span-16-232"><a id="__codelineno-16-232" name="__codelineno-16-232" href="#lab06-k-agent-__codelineno-16-232"></a><span class="nx">server</span><span class="p">.</span><span class="nx">run</span><span class="p">().</span><span class="k">catch</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
</span></code></pre></div>
</div>
<p><br></p>
<h4 id="lab06-k-agent-test-log-collection">Test Log Collection<a class="headerlink" href="#lab06-k-agent-test-log-collection" title="Permanent link">&para;</a></h4>
<p>Test the log collection functionality with the MCP Inspector:</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#lab06-k-agent-__codelineno-17-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p>This will start the MCP Inspector connected to your K-Agent server and open a browser window.</p>
<p><strong>In the MCP Inspector UI browser window:</strong></p>
<ol>
<li>Click the <strong>&ldquo;Connect&rdquo;</strong> button</li>
<li>Click the <strong>&ldquo;Tools&rdquo;</strong> tab</li>
<li>Click <strong>&ldquo;List Tools&rdquo;</strong> - you&rsquo;ll see both <code>list_pods</code> and <code>collect_pod_logs</code></li>
<li>Click on <strong><code>collect_pod_logs</code></strong></li>
<li>In the <strong>namespace</strong> field, enter: <code>default</code></li>
<li>Click <strong>&ldquo;Run Tool&rdquo;</strong></li>
</ol>
<p>You should see logs from all pods in the default namespace, formatted with pod and container names.</p>
<hr />
<h2 id="lab06-k-agent-optional-extensions">Optional Extensions<a class="headerlink" href="#lab06-k-agent-optional-extensions" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Prerequisites</p>
<p>These exercises assume you have completed <strong>Steps 1-4</strong> and have a fully functional K-Agent server with <code>list_pods</code> and <code>collect_pod_logs</code> tools. These exercises extend the functionality beyond the core implementation.</p>
</div>
<hr />
<h3 id="lab06-k-agent-exercise-1-advanced-pod-filtering-and-sorting">Exercise 1: Advanced Pod Filtering and Sorting<a class="headerlink" href="#lab06-k-agent-exercise-1-advanced-pod-filtering-and-sorting" title="Permanent link">&para;</a></h3>
<p>Enhance the <code>list_pods</code> tool to support filtering by status, labels, and sorting by various criteria.</p>
<p><strong>Update the list_pods tool schema</strong> in your <code>setupHandlers()</code> method to include new parameters:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#lab06-k-agent-__codelineno-18-1"></a><span class="p">{</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#lab06-k-agent-__codelineno-18-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;list_pods&quot;</span><span class="p">,</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#lab06-k-agent-__codelineno-18-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;List all pods across namespaces with their status, with filtering and sorting options&quot;</span><span class="p">,</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#lab06-k-agent-__codelineno-18-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#lab06-k-agent-__codelineno-18-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#lab06-k-agent-__codelineno-18-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#lab06-k-agent-__codelineno-18-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#lab06-k-agent-__codelineno-18-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#lab06-k-agent-__codelineno-18-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by specific namespace&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#lab06-k-agent-__codelineno-18-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#lab06-k-agent-__codelineno-18-11"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#lab06-k-agent-__codelineno-18-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#lab06-k-agent-__codelineno-18-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by pod status (Running, Pending, Failed, etc.)&quot;</span><span class="p">,</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#lab06-k-agent-__codelineno-18-14"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;Running&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Pending&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Failed&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Succeeded&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;Unknown&quot;</span><span class="p">]</span>
</span><span id="__span-18-15"><a id="__codelineno-18-15" name="__codelineno-18-15" href="#lab06-k-agent-__codelineno-18-15"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-16"><a id="__codelineno-18-16" name="__codelineno-18-16" href="#lab06-k-agent-__codelineno-18-16"></a><span class="w">      </span><span class="nx">labelSelector</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-17"><a id="__codelineno-18-17" name="__codelineno-18-17" href="#lab06-k-agent-__codelineno-18-17"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-18-18"><a id="__codelineno-18-18" name="__codelineno-18-18" href="#lab06-k-agent-__codelineno-18-18"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Optional: Filter by label selector (e.g., &#39;app=nginx,env=prod&#39;)&quot;</span>
</span><span id="__span-18-19"><a id="__codelineno-18-19" name="__codelineno-18-19" href="#lab06-k-agent-__codelineno-18-19"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-18-20"><a id="__codelineno-18-20" name="__codelineno-18-20" href="#lab06-k-agent-__codelineno-18-20"></a><span class="w">      </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-18-21"><a id="__codelineno-18-21" name="__codelineno-18-21" href="#lab06-k-agent-__codelineno-18-21"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-18-22"><a id="__codelineno-18-22" name="__codelineno-18-22" href="#lab06-k-agent-__codelineno-18-22"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Sort results by field&quot;</span><span class="p">,</span>
</span><span id="__span-18-23"><a id="__codelineno-18-23" name="__codelineno-18-23" href="#lab06-k-agent-__codelineno-18-23"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;namespace&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;status&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;age&quot;</span><span class="p">],</span>
</span><span id="__span-18-24"><a id="__codelineno-18-24" name="__codelineno-18-24" href="#lab06-k-agent-__codelineno-18-24"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;name&quot;</span>
</span><span id="__span-18-25"><a id="__codelineno-18-25" name="__codelineno-18-25" href="#lab06-k-agent-__codelineno-18-25"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-18-26"><a id="__codelineno-18-26" name="__codelineno-18-26" href="#lab06-k-agent-__codelineno-18-26"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-18-27"><a id="__codelineno-18-27" name="__codelineno-18-27" href="#lab06-k-agent-__codelineno-18-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-18-28"><a id="__codelineno-18-28" name="__codelineno-18-28" href="#lab06-k-agent-__codelineno-18-28"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Update the handleListPods method</strong> to support the new parameters:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#lab06-k-agent-__codelineno-19-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleListPods</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#lab06-k-agent-__codelineno-19-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">status</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector</span><span class="p">,</span><span class="w"> </span><span class="nx">sortBy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#lab06-k-agent-__codelineno-19-3"></a><span class="w">  </span><span class="kd">let</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector</span><span class="p">);</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#lab06-k-agent-__codelineno-19-4"></a>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#lab06-k-agent-__codelineno-19-5"></a><span class="w">  </span><span class="c1">// Filter by status if specified</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#lab06-k-agent-__codelineno-19-6"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">status</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#lab06-k-agent-__codelineno-19-7"></a><span class="w">    </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#lab06-k-agent-__codelineno-19-8"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#lab06-k-agent-__codelineno-19-9"></a>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#lab06-k-agent-__codelineno-19-10"></a><span class="w">  </span><span class="c1">// Map to simplified format</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#lab06-k-agent-__codelineno-19-11"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">podList</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">pod</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-19-12"><a id="__codelineno-19-12" name="__codelineno-19-12" href="#lab06-k-agent-__codelineno-19-12"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.name</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-19-13"><a id="__codelineno-19-13" name="__codelineno-19-13" href="#lab06-k-agent-__codelineno-19-13"></a><span class="w">    </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.namespace</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-19-14"><a id="__codelineno-19-14" name="__codelineno-19-14" href="#lab06-k-agent-__codelineno-19-14"></a><span class="w">    </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.status?.phase</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;unknown&#39;</span><span class="p">,</span>
</span><span id="__span-19-15"><a id="__codelineno-19-15" name="__codelineno-19-15" href="#lab06-k-agent-__codelineno-19-15"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.spec?.containers?.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[],</span>
</span><span id="__span-19-16"><a id="__codelineno-19-16" name="__codelineno-19-16" href="#lab06-k-agent-__codelineno-19-16"></a><span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.creationTimestamp</span><span class="w"> </span>
</span><span id="__span-19-17"><a id="__codelineno-19-17" name="__codelineno-19-17" href="#lab06-k-agent-__codelineno-19-17"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">creationTimestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span>
</span><span id="__span-19-18"><a id="__codelineno-19-18" name="__codelineno-19-18" href="#lab06-k-agent-__codelineno-19-18"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-19-19"><a id="__codelineno-19-19" name="__codelineno-19-19" href="#lab06-k-agent-__codelineno-19-19"></a><span class="w">    </span><span class="nx">labels</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.labels</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">{}</span>
</span><span id="__span-19-20"><a id="__codelineno-19-20" name="__codelineno-19-20" href="#lab06-k-agent-__codelineno-19-20"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-19-21"><a id="__codelineno-19-21" name="__codelineno-19-21" href="#lab06-k-agent-__codelineno-19-21"></a>
</span><span id="__span-19-22"><a id="__codelineno-19-22" name="__codelineno-19-22" href="#lab06-k-agent-__codelineno-19-22"></a><span class="w">  </span><span class="c1">// Sort results</span>
</span><span id="__span-19-23"><a id="__codelineno-19-23" name="__codelineno-19-23" href="#lab06-k-agent-__codelineno-19-23"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">sortedPods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">sortPods</span><span class="p">(</span><span class="nx">podList</span><span class="p">,</span><span class="w"> </span><span class="nx">sortBy</span><span class="p">);</span>
</span><span id="__span-19-24"><a id="__codelineno-19-24" name="__codelineno-19-24" href="#lab06-k-agent-__codelineno-19-24"></a>
</span><span id="__span-19-25"><a id="__codelineno-19-25" name="__codelineno-19-25" href="#lab06-k-agent-__codelineno-19-25"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-19-26"><a id="__codelineno-19-26" name="__codelineno-19-26" href="#lab06-k-agent-__codelineno-19-26"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-19-27"><a id="__codelineno-19-27" name="__codelineno-19-27" href="#lab06-k-agent-__codelineno-19-27"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-19-28"><a id="__codelineno-19-28" name="__codelineno-19-28" href="#lab06-k-agent-__codelineno-19-28"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-19-29"><a id="__codelineno-19-29" name="__codelineno-19-29" href="#lab06-k-agent-__codelineno-19-29"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">sortedPods</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-19-30"><a id="__codelineno-19-30" name="__codelineno-19-30" href="#lab06-k-agent-__codelineno-19-30"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-19-31"><a id="__codelineno-19-31" name="__codelineno-19-31" href="#lab06-k-agent-__codelineno-19-31"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-19-32"><a id="__codelineno-19-32" name="__codelineno-19-32" href="#lab06-k-agent-__codelineno-19-32"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-19-33"><a id="__codelineno-19-33" name="__codelineno-19-33" href="#lab06-k-agent-__codelineno-19-33"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Update the getPods method</strong> to support label selectors:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#lab06-k-agent-__codelineno-20-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">labelSelector?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">k8s</span><span class="p">.</span><span class="nx">V1Pod</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#lab06-k-agent-__codelineno-20-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#lab06-k-agent-__codelineno-20-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#lab06-k-agent-__codelineno-20-4"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedPod</span><span class="p">({</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#lab06-k-agent-__codelineno-20-5"></a><span class="w">        </span><span class="nx">namespace</span><span class="p">,</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#lab06-k-agent-__codelineno-20-6"></a><span class="w">        </span><span class="nx">labelSelector</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#lab06-k-agent-__codelineno-20-7"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#lab06-k-agent-__codelineno-20-8"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#lab06-k-agent-__codelineno-20-9"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#lab06-k-agent-__codelineno-20-10"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listPodForAllNamespaces</span><span class="p">({</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#lab06-k-agent-__codelineno-20-11"></a><span class="w">        </span><span class="nx">labelSelector</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#lab06-k-agent-__codelineno-20-12"></a><span class="w">      </span><span class="p">});</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#lab06-k-agent-__codelineno-20-13"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#lab06-k-agent-__codelineno-20-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#lab06-k-agent-__codelineno-20-15"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#lab06-k-agent-__codelineno-20-16"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleK8sError</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#lab06-k-agent-__codelineno-20-17"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#lab06-k-agent-__codelineno-20-18"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add a sorting helper method</strong> after the <code>getPods</code> method:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#lab06-k-agent-__codelineno-21-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">sortPods</span><span class="p">(</span><span class="nx">pods</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">[],</span><span class="w"> </span><span class="nx">sortBy</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nx">any</span><span class="p">[]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#lab06-k-agent-__codelineno-21-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#lab06-k-agent-__codelineno-21-3"></a><span class="w">    </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">sortBy</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#lab06-k-agent-__codelineno-21-4"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;namespace&#39;</span><span class="o">:</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#lab06-k-agent-__codelineno-21-5"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">namespace</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#lab06-k-agent-__codelineno-21-6"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;status&#39;</span><span class="o">:</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#lab06-k-agent-__codelineno-21-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">status</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">status</span><span class="p">);</span>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#lab06-k-agent-__codelineno-21-8"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;age&#39;</span><span class="o">:</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#lab06-k-agent-__codelineno-21-9"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">age</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">age</span><span class="p">;</span><span class="w"> </span><span class="c1">// Newest first</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#lab06-k-agent-__codelineno-21-10"></a><span class="w">      </span><span class="k">case</span><span class="w"> </span><span class="s1">&#39;name&#39;</span><span class="o">:</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#lab06-k-agent-__codelineno-21-11"></a><span class="w">      </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#lab06-k-agent-__codelineno-21-12"></a><span class="w">        </span><span class="kt">return</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">name</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">b</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#lab06-k-agent-__codelineno-21-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#lab06-k-agent-__codelineno-21-14"></a><span class="w">  </span><span class="p">});</span>
</span><span id="__span-21-15"><a id="__codelineno-21-15" name="__codelineno-21-15" href="#lab06-k-agent-__codelineno-21-15"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Test the enhanced filtering:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#lab06-k-agent-__codelineno-22-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Try these test cases:</strong></p>
<ul>
<li>List only Running pods: Set <code>status</code> to &ldquo;Running&rdquo;</li>
<li>Filter by labels: Set <code>labelSelector</code> to &ldquo;app=nginx&rdquo;</li>
<li>Sort by age: Set <code>sortBy</code> to &ldquo;age&rdquo;</li>
<li>Combine filters: Use namespace + status + sortBy together</li>
</ul>
<hr />
<h3 id="lab06-k-agent-exercise-2-enhanced-log-analysis-with-search-and-export">Exercise 2: Enhanced Log Analysis with Search and Export<a class="headerlink" href="#lab06-k-agent-exercise-2-enhanced-log-analysis-with-search-and-export" title="Permanent link">&para;</a></h3>
<p>Extend the <code>collect_pod_logs</code> tool to support log searching, filtering by severity, and exporting logs to files.</p>
<p><strong>Add a new tool <code>analyze_logs</code></strong> to your tools array in <code>setupHandlers()</code>:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#lab06-k-agent-__codelineno-23-1"></a><span class="p">{</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#lab06-k-agent-__codelineno-23-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;analyze_logs&quot;</span><span class="p">,</span>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#lab06-k-agent-__codelineno-23-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Analyze and search through pod logs with filtering and export capabilities&quot;</span><span class="p">,</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#lab06-k-agent-__codelineno-23-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#lab06-k-agent-__codelineno-23-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#lab06-k-agent-__codelineno-23-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#lab06-k-agent-__codelineno-23-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#lab06-k-agent-__codelineno-23-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#lab06-k-agent-__codelineno-23-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Namespace to analyze logs from&quot;</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#lab06-k-agent-__codelineno-23-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#lab06-k-agent-__codelineno-23-11"></a><span class="w">      </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#lab06-k-agent-__codelineno-23-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-23-13"><a id="__codelineno-23-13" name="__codelineno-23-13" href="#lab06-k-agent-__codelineno-23-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Specific pod name (optional)&quot;</span>
</span><span id="__span-23-14"><a id="__codelineno-23-14" name="__codelineno-23-14" href="#lab06-k-agent-__codelineno-23-14"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-15"><a id="__codelineno-23-15" name="__codelineno-23-15" href="#lab06-k-agent-__codelineno-23-15"></a><span class="w">      </span><span class="nx">searchPattern</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-16"><a id="__codelineno-23-16" name="__codelineno-23-16" href="#lab06-k-agent-__codelineno-23-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-23-17"><a id="__codelineno-23-17" name="__codelineno-23-17" href="#lab06-k-agent-__codelineno-23-17"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Regex pattern to search for in logs&quot;</span>
</span><span id="__span-23-18"><a id="__codelineno-23-18" name="__codelineno-23-18" href="#lab06-k-agent-__codelineno-23-18"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-19"><a id="__codelineno-23-19" name="__codelineno-23-19" href="#lab06-k-agent-__codelineno-23-19"></a><span class="w">      </span><span class="nx">severityLevel</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-20"><a id="__codelineno-23-20" name="__codelineno-23-20" href="#lab06-k-agent-__codelineno-23-20"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-23-21"><a id="__codelineno-23-21" name="__codelineno-23-21" href="#lab06-k-agent-__codelineno-23-21"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Filter by log severity&quot;</span><span class="p">,</span>
</span><span id="__span-23-22"><a id="__codelineno-23-22" name="__codelineno-23-22" href="#lab06-k-agent-__codelineno-23-22"></a><span class="w">        </span><span class="kd">enum</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;ERROR&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;WARN&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;INFO&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;DEBUG&quot;</span><span class="p">]</span>
</span><span id="__span-23-23"><a id="__codelineno-23-23" name="__codelineno-23-23" href="#lab06-k-agent-__codelineno-23-23"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-24"><a id="__codelineno-23-24" name="__codelineno-23-24" href="#lab06-k-agent-__codelineno-23-24"></a><span class="w">      </span><span class="nx">tailLines</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-25"><a id="__codelineno-23-25" name="__codelineno-23-25" href="#lab06-k-agent-__codelineno-23-25"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-23-26"><a id="__codelineno-23-26" name="__codelineno-23-26" href="#lab06-k-agent-__codelineno-23-26"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Number of recent log lines to analyze&quot;</span><span class="p">,</span>
</span><span id="__span-23-27"><a id="__codelineno-23-27" name="__codelineno-23-27" href="#lab06-k-agent-__codelineno-23-27"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">100</span>
</span><span id="__span-23-28"><a id="__codelineno-23-28" name="__codelineno-23-28" href="#lab06-k-agent-__codelineno-23-28"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-23-29"><a id="__codelineno-23-29" name="__codelineno-23-29" href="#lab06-k-agent-__codelineno-23-29"></a><span class="w">      </span><span class="nx">exportToFile</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-23-30"><a id="__codelineno-23-30" name="__codelineno-23-30" href="#lab06-k-agent-__codelineno-23-30"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-23-31"><a id="__codelineno-23-31" name="__codelineno-23-31" href="#lab06-k-agent-__codelineno-23-31"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Export matching logs to a file&quot;</span><span class="p">,</span>
</span><span id="__span-23-32"><a id="__codelineno-23-32" name="__codelineno-23-32" href="#lab06-k-agent-__codelineno-23-32"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">false</span>
</span><span id="__span-23-33"><a id="__codelineno-23-33" name="__codelineno-23-33" href="#lab06-k-agent-__codelineno-23-33"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-23-34"><a id="__codelineno-23-34" name="__codelineno-23-34" href="#lab06-k-agent-__codelineno-23-34"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-23-35"><a id="__codelineno-23-35" name="__codelineno-23-35" href="#lab06-k-agent-__codelineno-23-35"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
</span><span id="__span-23-36"><a id="__codelineno-23-36" name="__codelineno-23-36" href="#lab06-k-agent-__codelineno-23-36"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-23-37"><a id="__codelineno-23-37" name="__codelineno-23-37" href="#lab06-k-agent-__codelineno-23-37"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the case to your switch statement:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#lab06-k-agent-__codelineno-24-1"></a><span class="k">case</span><span class="w"> </span><span class="s2">&quot;analyze_logs&quot;</span><span class="o">:</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#lab06-k-agent-__codelineno-24-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleAnalyzeLogs</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Implement the log analysis handler</strong> after your <code>handleCollectPodLogs</code> method:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#lab06-k-agent-__codelineno-25-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleAnalyzeLogs</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#lab06-k-agent-__codelineno-25-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="nx">exportToFile</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#lab06-k-agent-__codelineno-25-3"></a>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#lab06-k-agent-__codelineno-25-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#lab06-k-agent-__codelineno-25-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Namespace is required&quot;</span><span class="p">);</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#lab06-k-agent-__codelineno-25-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#lab06-k-agent-__codelineno-25-7"></a>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#lab06-k-agent-__codelineno-25-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">collectPodLogs</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">tailLines</span><span class="p">);</span>
</span><span id="__span-25-9"><a id="__codelineno-25-9" name="__codelineno-25-9" href="#lab06-k-agent-__codelineno-25-9"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">analyzedLogs</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzeLogs</span><span class="p">(</span><span class="nx">logs</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel</span><span class="p">);</span>
</span><span id="__span-25-10"><a id="__codelineno-25-10" name="__codelineno-25-10" href="#lab06-k-agent-__codelineno-25-10"></a>
</span><span id="__span-25-11"><a id="__codelineno-25-11" name="__codelineno-25-11" href="#lab06-k-agent-__codelineno-25-11"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">exportToFile</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-12"><a id="__codelineno-25-12" name="__codelineno-25-12" href="#lab06-k-agent-__codelineno-25-12"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">exportLogs</span><span class="p">(</span><span class="nx">analyzedLogs</span><span class="p">,</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">);</span>
</span><span id="__span-25-13"><a id="__codelineno-25-13" name="__codelineno-25-13" href="#lab06-k-agent-__codelineno-25-13"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-14"><a id="__codelineno-25-14" name="__codelineno-25-14" href="#lab06-k-agent-__codelineno-25-14"></a><span class="w">      </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-15"><a id="__codelineno-25-15" name="__codelineno-25-15" href="#lab06-k-agent-__codelineno-25-15"></a><span class="w">        </span><span class="p">{</span>
</span><span id="__span-25-16"><a id="__codelineno-25-16" name="__codelineno-25-16" href="#lab06-k-agent-__codelineno-25-16"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-25-17"><a id="__codelineno-25-17" name="__codelineno-25-17" href="#lab06-k-agent-__codelineno-25-17"></a><span class="w">          </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Analysis complete. </span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">totalLines</span><span class="si">}</span><span class="sb"> lines analyzed, </span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matchingLines</span><span class="si">}</span><span class="sb"> matches found.\nExported to: </span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb">\n\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-25-18"><a id="__codelineno-25-18" name="__codelineno-25-18" href="#lab06-k-agent-__codelineno-25-18"></a><span class="w">        </span><span class="p">}</span>
</span><span id="__span-25-19"><a id="__codelineno-25-19" name="__codelineno-25-19" href="#lab06-k-agent-__codelineno-25-19"></a><span class="w">      </span><span class="p">]</span>
</span><span id="__span-25-20"><a id="__codelineno-25-20" name="__codelineno-25-20" href="#lab06-k-agent-__codelineno-25-20"></a><span class="w">    </span><span class="p">};</span>
</span><span id="__span-25-21"><a id="__codelineno-25-21" name="__codelineno-25-21" href="#lab06-k-agent-__codelineno-25-21"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-25-22"><a id="__codelineno-25-22" name="__codelineno-25-22" href="#lab06-k-agent-__codelineno-25-22"></a>
</span><span id="__span-25-23"><a id="__codelineno-25-23" name="__codelineno-25-23" href="#lab06-k-agent-__codelineno-25-23"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-25-24"><a id="__codelineno-25-24" name="__codelineno-25-24" href="#lab06-k-agent-__codelineno-25-24"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-25-25"><a id="__codelineno-25-25" name="__codelineno-25-25" href="#lab06-k-agent-__codelineno-25-25"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-25-26"><a id="__codelineno-25-26" name="__codelineno-25-26" href="#lab06-k-agent-__codelineno-25-26"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-25-27"><a id="__codelineno-25-27" name="__codelineno-25-27" href="#lab06-k-agent-__codelineno-25-27"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Analysis Results:\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="si">}</span><span class="sb">\n\nMatching Logs:\n</span><span class="si">${</span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-25-28"><a id="__codelineno-25-28" name="__codelineno-25-28" href="#lab06-k-agent-__codelineno-25-28"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-25-29"><a id="__codelineno-25-29" name="__codelineno-25-29" href="#lab06-k-agent-__codelineno-25-29"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-25-30"><a id="__codelineno-25-30" name="__codelineno-25-30" href="#lab06-k-agent-__codelineno-25-30"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-25-31"><a id="__codelineno-25-31" name="__codelineno-25-31" href="#lab06-k-agent-__codelineno-25-31"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the log analysis helper method:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#lab06-k-agent-__codelineno-26-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">analyzeLogs</span><span class="p">(</span><span class="nx">logs</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">searchPattern?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">severityLevel?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-2"><a id="__codelineno-26-2" name="__codelineno-26-2" href="#lab06-k-agent-__codelineno-26-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">lines</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">logs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span id="__span-26-3"><a id="__codelineno-26-3" name="__codelineno-26-3" href="#lab06-k-agent-__codelineno-26-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">matches</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-4"><a id="__codelineno-26-4" name="__codelineno-26-4" href="#lab06-k-agent-__codelineno-26-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">errors</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-5"><a id="__codelineno-26-5" name="__codelineno-26-5" href="#lab06-k-agent-__codelineno-26-5"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">warnings</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">[]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-26-6"><a id="__codelineno-26-6" name="__codelineno-26-6" href="#lab06-k-agent-__codelineno-26-6"></a>
</span><span id="__span-26-7"><a id="__codelineno-26-7" name="__codelineno-26-7" href="#lab06-k-agent-__codelineno-26-7"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">line</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">lines</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-8"><a id="__codelineno-26-8" name="__codelineno-26-8" href="#lab06-k-agent-__codelineno-26-8"></a><span class="w">    </span><span class="c1">// Filter by severity if specified</span>
</span><span id="__span-26-9"><a id="__codelineno-26-9" name="__codelineno-26-9" href="#lab06-k-agent-__codelineno-26-9"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">severityLevel</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-10"><a id="__codelineno-26-10" name="__codelineno-26-10" href="#lab06-k-agent-__codelineno-26-10"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">severityLevel</span><span class="p">))</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-26-11"><a id="__codelineno-26-11" name="__codelineno-26-11" href="#lab06-k-agent-__codelineno-26-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-12"><a id="__codelineno-26-12" name="__codelineno-26-12" href="#lab06-k-agent-__codelineno-26-12"></a>
</span><span id="__span-26-13"><a id="__codelineno-26-13" name="__codelineno-26-13" href="#lab06-k-agent-__codelineno-26-13"></a><span class="w">    </span><span class="c1">// Search for pattern if specified</span>
</span><span id="__span-26-14"><a id="__codelineno-26-14" name="__codelineno-26-14" href="#lab06-k-agent-__codelineno-26-14"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">searchPattern</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-15"><a id="__codelineno-26-15" name="__codelineno-26-15" href="#lab06-k-agent-__codelineno-26-15"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">regex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">RegExp</span><span class="p">(</span><span class="nx">searchPattern</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;i&#39;</span><span class="p">);</span>
</span><span id="__span-26-16"><a id="__codelineno-26-16" name="__codelineno-26-16" href="#lab06-k-agent-__codelineno-26-16"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">regex</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">line</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-17"><a id="__codelineno-26-17" name="__codelineno-26-17" href="#lab06-k-agent-__codelineno-26-17"></a><span class="w">        </span><span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-18"><a id="__codelineno-26-18" name="__codelineno-26-18" href="#lab06-k-agent-__codelineno-26-18"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-26-19"><a id="__codelineno-26-19" name="__codelineno-26-19" href="#lab06-k-agent-__codelineno-26-19"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-20"><a id="__codelineno-26-20" name="__codelineno-26-20" href="#lab06-k-agent-__codelineno-26-20"></a><span class="w">      </span><span class="nx">matches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-21"><a id="__codelineno-26-21" name="__codelineno-26-21" href="#lab06-k-agent-__codelineno-26-21"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-22"><a id="__codelineno-26-22" name="__codelineno-26-22" href="#lab06-k-agent-__codelineno-26-22"></a>
</span><span id="__span-26-23"><a id="__codelineno-26-23" name="__codelineno-26-23" href="#lab06-k-agent-__codelineno-26-23"></a><span class="w">    </span><span class="c1">// Categorize by severity</span>
</span><span id="__span-26-24"><a id="__codelineno-26-24" name="__codelineno-26-24" href="#lab06-k-agent-__codelineno-26-24"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;ERROR&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-25"><a id="__codelineno-26-25" name="__codelineno-26-25" href="#lab06-k-agent-__codelineno-26-25"></a><span class="w">      </span><span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-26"><a id="__codelineno-26-26" name="__codelineno-26-26" href="#lab06-k-agent-__codelineno-26-26"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;WARN&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">line</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="s1">&#39;warning&#39;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-27"><a id="__codelineno-26-27" name="__codelineno-26-27" href="#lab06-k-agent-__codelineno-26-27"></a><span class="w">      </span><span class="nx">warnings</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line</span><span class="p">);</span>
</span><span id="__span-26-28"><a id="__codelineno-26-28" name="__codelineno-26-28" href="#lab06-k-agent-__codelineno-26-28"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-26-29"><a id="__codelineno-26-29" name="__codelineno-26-29" href="#lab06-k-agent-__codelineno-26-29"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-26-30"><a id="__codelineno-26-30" name="__codelineno-26-30" href="#lab06-k-agent-__codelineno-26-30"></a>
</span><span id="__span-26-31"><a id="__codelineno-26-31" name="__codelineno-26-31" href="#lab06-k-agent-__codelineno-26-31"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">summary</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-26-32"><a id="__codelineno-26-32" name="__codelineno-26-32" href="#lab06-k-agent-__codelineno-26-32"></a><span class="w">    </span><span class="sb">`Total Lines: </span><span class="si">${</span><span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-33"><a id="__codelineno-26-33" name="__codelineno-26-33" href="#lab06-k-agent-__codelineno-26-33"></a><span class="w">    </span><span class="sb">`Matching Lines: </span><span class="si">${</span><span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-34"><a id="__codelineno-26-34" name="__codelineno-26-34" href="#lab06-k-agent-__codelineno-26-34"></a><span class="w">    </span><span class="sb">`Errors Found: </span><span class="si">${</span><span class="nx">errors</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-35"><a id="__codelineno-26-35" name="__codelineno-26-35" href="#lab06-k-agent-__codelineno-26-35"></a><span class="w">    </span><span class="sb">`Warnings Found: </span><span class="si">${</span><span class="nx">warnings</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-26-36"><a id="__codelineno-26-36" name="__codelineno-26-36" href="#lab06-k-agent-__codelineno-26-36"></a><span class="w">    </span><span class="nx">searchPattern</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Search Pattern: </span><span class="si">${</span><span class="nx">searchPattern</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">,</span>
</span><span id="__span-26-37"><a id="__codelineno-26-37" name="__codelineno-26-37" href="#lab06-k-agent-__codelineno-26-37"></a><span class="w">    </span><span class="nx">severityLevel</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Severity Filter: </span><span class="si">${</span><span class="nx">severityLevel</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;&#39;</span>
</span><span id="__span-26-38"><a id="__codelineno-26-38" name="__codelineno-26-38" href="#lab06-k-agent-__codelineno-26-38"></a><span class="w">  </span><span class="p">].</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span id="__span-26-39"><a id="__codelineno-26-39" name="__codelineno-26-39" href="#lab06-k-agent-__codelineno-26-39"></a>
</span><span id="__span-26-40"><a id="__codelineno-26-40" name="__codelineno-26-40" href="#lab06-k-agent-__codelineno-26-40"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-26-41"><a id="__codelineno-26-41" name="__codelineno-26-41" href="#lab06-k-agent-__codelineno-26-41"></a><span class="w">    </span><span class="nx">totalLines</span><span class="o">:</span><span class="w"> </span><span class="kt">lines.length</span><span class="p">,</span>
</span><span id="__span-26-42"><a id="__codelineno-26-42" name="__codelineno-26-42" href="#lab06-k-agent-__codelineno-26-42"></a><span class="w">    </span><span class="nx">matchingLines</span><span class="o">:</span><span class="w"> </span><span class="kt">matches.length</span><span class="p">,</span>
</span><span id="__span-26-43"><a id="__codelineno-26-43" name="__codelineno-26-43" href="#lab06-k-agent-__codelineno-26-43"></a><span class="w">    </span><span class="nx">matches</span><span class="o">:</span><span class="w"> </span><span class="kt">matches.slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">100</span><span class="p">),</span><span class="w"> </span><span class="c1">// Limit to first 100 matches</span>
</span><span id="__span-26-44"><a id="__codelineno-26-44" name="__codelineno-26-44" href="#lab06-k-agent-__codelineno-26-44"></a><span class="w">    </span><span class="nx">errors</span><span class="p">,</span>
</span><span id="__span-26-45"><a id="__codelineno-26-45" name="__codelineno-26-45" href="#lab06-k-agent-__codelineno-26-45"></a><span class="w">    </span><span class="nx">warnings</span><span class="p">,</span>
</span><span id="__span-26-46"><a id="__codelineno-26-46" name="__codelineno-26-46" href="#lab06-k-agent-__codelineno-26-46"></a><span class="w">    </span><span class="nx">summary</span>
</span><span id="__span-26-47"><a id="__codelineno-26-47" name="__codelineno-26-47" href="#lab06-k-agent-__codelineno-26-47"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-26-48"><a id="__codelineno-26-48" name="__codelineno-26-48" href="#lab06-k-agent-__codelineno-26-48"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the export helper method</strong> (requires fs module - add <code>import * as fs from 'fs';</code> at the top):</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#lab06-k-agent-__codelineno-27-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">exportLogs</span><span class="p">(</span><span class="nx">analyzedLogs</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">,</span><span class="w"> </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName?</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="kt">string</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#lab06-k-agent-__codelineno-27-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/[:.]/g</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#lab06-k-agent-__codelineno-27-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`logs_</span><span class="si">${</span><span class="nx">namespace</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">podName</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;all&#39;</span><span class="si">}</span><span class="sb">_</span><span class="si">${</span><span class="nx">timestamp</span><span class="si">}</span><span class="sb">.txt`</span><span class="p">;</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#lab06-k-agent-__codelineno-27-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">filepath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sb">`/tmp/</span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#lab06-k-agent-__codelineno-27-5"></a>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#lab06-k-agent-__codelineno-27-6"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#lab06-k-agent-__codelineno-27-7"></a><span class="w">    </span><span class="sb">`Kubernetes Log Analysis Report`</span><span class="p">,</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#lab06-k-agent-__codelineno-27-8"></a><span class="w">    </span><span class="sb">`Generated: </span><span class="si">${</span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#lab06-k-agent-__codelineno-27-9"></a><span class="w">    </span><span class="sb">`Namespace: </span><span class="si">${</span><span class="nx">namespace</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#lab06-k-agent-__codelineno-27-10"></a><span class="w">    </span><span class="nx">podName</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Pod: </span><span class="si">${</span><span class="nx">podName</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;All Pods&#39;</span><span class="p">,</span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#lab06-k-agent-__codelineno-27-11"></a><span class="w">    </span><span class="sb">``</span><span class="p">,</span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#lab06-k-agent-__codelineno-27-12"></a><span class="w">    </span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">summary</span><span class="p">,</span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#lab06-k-agent-__codelineno-27-13"></a><span class="w">    </span><span class="sb">``</span><span class="p">,</span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#lab06-k-agent-__codelineno-27-14"></a><span class="w">    </span><span class="sb">`=== Matching Log Entries ===`</span><span class="p">,</span>
</span><span id="__span-27-15"><a id="__codelineno-27-15" name="__codelineno-27-15" href="#lab06-k-agent-__codelineno-27-15"></a><span class="w">    </span><span class="nx">analyzedLogs</span><span class="p">.</span><span class="nx">matches</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
</span><span id="__span-27-16"><a id="__codelineno-27-16" name="__codelineno-27-16" href="#lab06-k-agent-__codelineno-27-16"></a><span class="w">  </span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
</span><span id="__span-27-17"><a id="__codelineno-27-17" name="__codelineno-27-17" href="#lab06-k-agent-__codelineno-27-17"></a>
</span><span id="__span-27-18"><a id="__codelineno-27-18" name="__codelineno-27-18" href="#lab06-k-agent-__codelineno-27-18"></a><span class="w">  </span><span class="c1">// Note: In a real implementation, you&#39;d want to handle file system operations more carefully</span>
</span><span id="__span-27-19"><a id="__codelineno-27-19" name="__codelineno-27-19" href="#lab06-k-agent-__codelineno-27-19"></a><span class="w">  </span><span class="c1">// For this exercise, we&#39;ll just return the intended filename</span>
</span><span id="__span-27-20"><a id="__codelineno-27-20" name="__codelineno-27-20" href="#lab06-k-agent-__codelineno-27-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nx">filepath</span><span class="p">;</span>
</span><span id="__span-27-21"><a id="__codelineno-27-21" name="__codelineno-27-21" href="#lab06-k-agent-__codelineno-27-21"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Test the log analysis:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#lab06-k-agent-__codelineno-28-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Try these test cases:</strong></p>
<ul>
<li>Search for errors: Set <code>searchPattern</code> to &ldquo;error&rdquo; and <code>severityLevel</code> to &ldquo;ERROR&rdquo;</li>
<li>Find warnings: Set <code>severityLevel</code> to &ldquo;WARN&rdquo;</li>
<li>Export logs: Set <code>exportToFile</code> to true</li>
<li>Pattern matching: Set <code>searchPattern</code> to a specific error code or message</li>
</ul>
<hr />
<h3 id="lab06-k-agent-exercise-3-real-time-pod-monitoring">Exercise 3: Real-Time Pod Monitoring<a class="headerlink" href="#lab06-k-agent-exercise-3-real-time-pod-monitoring" title="Permanent link">&para;</a></h3>
<p>Create a new tool to monitor pod health and events in real-time, providing insights into pod lifecycle changes.</p>
<p><strong>Add the <code>monitor_pod_health</code> tool</strong> to your tools array:</p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#lab06-k-agent-__codelineno-29-1"></a><span class="p">{</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#lab06-k-agent-__codelineno-29-2"></a><span class="w">  </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;monitor_pod_health&quot;</span><span class="p">,</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#lab06-k-agent-__codelineno-29-3"></a><span class="w">  </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Monitor pod health, restart counts, and recent events&quot;</span><span class="p">,</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#lab06-k-agent-__codelineno-29-4"></a><span class="w">  </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#lab06-k-agent-__codelineno-29-5"></a><span class="w">    </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#lab06-k-agent-__codelineno-29-6"></a><span class="w">    </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#lab06-k-agent-__codelineno-29-7"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#lab06-k-agent-__codelineno-29-8"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#lab06-k-agent-__codelineno-29-9"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Namespace to monitor&quot;</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#lab06-k-agent-__codelineno-29-10"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#lab06-k-agent-__codelineno-29-11"></a><span class="w">      </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#lab06-k-agent-__codelineno-29-12"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#lab06-k-agent-__codelineno-29-13"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Specific pod to monitor (optional)&quot;</span>
</span><span id="__span-29-14"><a id="__codelineno-29-14" name="__codelineno-29-14" href="#lab06-k-agent-__codelineno-29-14"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-29-15"><a id="__codelineno-29-15" name="__codelineno-29-15" href="#lab06-k-agent-__codelineno-29-15"></a><span class="w">      </span><span class="nx">includeEvents</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-29-16"><a id="__codelineno-29-16" name="__codelineno-29-16" href="#lab06-k-agent-__codelineno-29-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;boolean&quot;</span><span class="p">,</span>
</span><span id="__span-29-17"><a id="__codelineno-29-17" name="__codelineno-29-17" href="#lab06-k-agent-__codelineno-29-17"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Include recent Kubernetes events&quot;</span><span class="p">,</span>
</span><span id="__span-29-18"><a id="__codelineno-29-18" name="__codelineno-29-18" href="#lab06-k-agent-__codelineno-29-18"></a><span class="w">        </span><span class="nx">default</span><span class="o">:</span><span class="w"> </span><span class="kt">true</span>
</span><span id="__span-29-19"><a id="__codelineno-29-19" name="__codelineno-29-19" href="#lab06-k-agent-__codelineno-29-19"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-29-20"><a id="__codelineno-29-20" name="__codelineno-29-20" href="#lab06-k-agent-__codelineno-29-20"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-29-21"><a id="__codelineno-29-21" name="__codelineno-29-21" href="#lab06-k-agent-__codelineno-29-21"></a><span class="w">    </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;namespace&quot;</span><span class="p">]</span>
</span><span id="__span-29-22"><a id="__codelineno-29-22" name="__codelineno-29-22" href="#lab06-k-agent-__codelineno-29-22"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-29-23"><a id="__codelineno-29-23" name="__codelineno-29-23" href="#lab06-k-agent-__codelineno-29-23"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the case to your switch statement:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#lab06-k-agent-__codelineno-30-1"></a><span class="k">case</span><span class="w"> </span><span class="s2">&quot;monitor_pod_health&quot;</span><span class="o">:</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#lab06-k-agent-__codelineno-30-2"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">handleMonitorPodHealth</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Implement the monitoring handler:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#lab06-k-agent-__codelineno-31-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">handleMonitorPodHealth</span><span class="p">(</span><span class="nx">args</span><span class="o">:</span><span class="w"> </span><span class="kt">any</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#lab06-k-agent-__codelineno-31-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="p">,</span><span class="w"> </span><span class="nx">includeEvents</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="p">;</span>
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#lab06-k-agent-__codelineno-31-3"></a>
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#lab06-k-agent-__codelineno-31-4"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">namespace</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-5"><a id="__codelineno-31-5" name="__codelineno-31-5" href="#lab06-k-agent-__codelineno-31-5"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s2">&quot;Namespace is required&quot;</span><span class="p">);</span>
</span><span id="__span-31-6"><a id="__codelineno-31-6" name="__codelineno-31-6" href="#lab06-k-agent-__codelineno-31-6"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-7"><a id="__codelineno-31-7" name="__codelineno-31-7" href="#lab06-k-agent-__codelineno-31-7"></a>
</span><span id="__span-31-8"><a id="__codelineno-31-8" name="__codelineno-31-8" href="#lab06-k-agent-__codelineno-31-8"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">pods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">podName</span><span class="w"> </span>
</span><span id="__span-31-9"><a id="__codelineno-31-9" name="__codelineno-31-9" href="#lab06-k-agent-__codelineno-31-9"></a><span class="w">    </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">pods</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">pods</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">p</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">p</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">podName</span><span class="p">))</span>
</span><span id="__span-31-10"><a id="__codelineno-31-10" name="__codelineno-31-10" href="#lab06-k-agent-__codelineno-31-10"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPods</span><span class="p">(</span><span class="nx">namespace</span><span class="p">);</span>
</span><span id="__span-31-11"><a id="__codelineno-31-11" name="__codelineno-31-11" href="#lab06-k-agent-__codelineno-31-11"></a>
</span><span id="__span-31-12"><a id="__codelineno-31-12" name="__codelineno-31-12" href="#lab06-k-agent-__codelineno-31-12"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">healthReports</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-31-13"><a id="__codelineno-31-13" name="__codelineno-31-13" href="#lab06-k-agent-__codelineno-31-13"></a>
</span><span id="__span-31-14"><a id="__codelineno-31-14" name="__codelineno-31-14" href="#lab06-k-agent-__codelineno-31-14"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">const</span><span class="w"> </span><span class="nx">pod</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="nx">pods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-15"><a id="__codelineno-31-15" name="__codelineno-31-15" href="#lab06-k-agent-__codelineno-31-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="k">continue</span><span class="p">;</span>
</span><span id="__span-31-16"><a id="__codelineno-31-16" name="__codelineno-31-16" href="#lab06-k-agent-__codelineno-31-16"></a>
</span><span id="__span-31-17"><a id="__codelineno-31-17" name="__codelineno-31-17" href="#lab06-k-agent-__codelineno-31-17"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">health</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">analyzePodHealth</span><span class="p">(</span><span class="nx">pod</span><span class="p">);</span>
</span><span id="__span-31-18"><a id="__codelineno-31-18" name="__codelineno-31-18" href="#lab06-k-agent-__codelineno-31-18"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">includeEvents</span><span class="w"> </span>
</span><span id="__span-31-19"><a id="__codelineno-31-19" name="__codelineno-31-19" href="#lab06-k-agent-__codelineno-31-19"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">getPodEvents</span><span class="p">(</span><span class="nx">namespace</span><span class="p">,</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span>
</span><span id="__span-31-20"><a id="__codelineno-31-20" name="__codelineno-31-20" href="#lab06-k-agent-__codelineno-31-20"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-31-21"><a id="__codelineno-31-21" name="__codelineno-31-21" href="#lab06-k-agent-__codelineno-31-21"></a>
</span><span id="__span-31-22"><a id="__codelineno-31-22" name="__codelineno-31-22" href="#lab06-k-agent-__codelineno-31-22"></a><span class="w">    </span><span class="nx">healthReports</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span><span id="__span-31-23"><a id="__codelineno-31-23" name="__codelineno-31-23" href="#lab06-k-agent-__codelineno-31-23"></a><span class="w">      </span><span class="nx">pod</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata.name</span><span class="p">,</span>
</span><span id="__span-31-24"><a id="__codelineno-31-24" name="__codelineno-31-24" href="#lab06-k-agent-__codelineno-31-24"></a><span class="w">      </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata.namespace</span><span class="p">,</span>
</span><span id="__span-31-25"><a id="__codelineno-31-25" name="__codelineno-31-25" href="#lab06-k-agent-__codelineno-31-25"></a><span class="w">      </span><span class="nx">health</span><span class="p">,</span>
</span><span id="__span-31-26"><a id="__codelineno-31-26" name="__codelineno-31-26" href="#lab06-k-agent-__codelineno-31-26"></a><span class="w">      </span><span class="nx">events</span>
</span><span id="__span-31-27"><a id="__codelineno-31-27" name="__codelineno-31-27" href="#lab06-k-agent-__codelineno-31-27"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-31-28"><a id="__codelineno-31-28" name="__codelineno-31-28" href="#lab06-k-agent-__codelineno-31-28"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-31-29"><a id="__codelineno-31-29" name="__codelineno-31-29" href="#lab06-k-agent-__codelineno-31-29"></a>
</span><span id="__span-31-30"><a id="__codelineno-31-30" name="__codelineno-31-30" href="#lab06-k-agent-__codelineno-31-30"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-31-31"><a id="__codelineno-31-31" name="__codelineno-31-31" href="#lab06-k-agent-__codelineno-31-31"></a><span class="w">    </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-31-32"><a id="__codelineno-31-32" name="__codelineno-31-32" href="#lab06-k-agent-__codelineno-31-32"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-31-33"><a id="__codelineno-31-33" name="__codelineno-31-33" href="#lab06-k-agent-__codelineno-31-33"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-31-34"><a id="__codelineno-31-34" name="__codelineno-31-34" href="#lab06-k-agent-__codelineno-31-34"></a><span class="w">        </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="kt">JSON.stringify</span><span class="p">(</span><span class="nx">healthReports</span><span class="p">,</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w"> </span><span class="mf">2</span><span class="p">)</span>
</span><span id="__span-31-35"><a id="__codelineno-31-35" name="__codelineno-31-35" href="#lab06-k-agent-__codelineno-31-35"></a><span class="w">      </span><span class="p">}</span>
</span><span id="__span-31-36"><a id="__codelineno-31-36" name="__codelineno-31-36" href="#lab06-k-agent-__codelineno-31-36"></a><span class="w">    </span><span class="p">]</span>
</span><span id="__span-31-37"><a id="__codelineno-31-37" name="__codelineno-31-37" href="#lab06-k-agent-__codelineno-31-37"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-31-38"><a id="__codelineno-31-38" name="__codelineno-31-38" href="#lab06-k-agent-__codelineno-31-38"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the health analysis method:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#lab06-k-agent-__codelineno-32-1"></a><span class="k">private</span><span class="w"> </span><span class="nx">analyzePodHealth</span><span class="p">(</span><span class="nx">pod</span><span class="o">:</span><span class="w"> </span><span class="kt">k8s.V1Pod</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#lab06-k-agent-__codelineno-32-2"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">pod</span><span class="p">.</span><span class="nx">status</span><span class="p">;</span>
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#lab06-k-agent-__codelineno-32-3"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">conditions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">conditions</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#lab06-k-agent-__codelineno-32-4"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">containerStatuses</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-32-5"><a id="__codelineno-32-5" name="__codelineno-32-5" href="#lab06-k-agent-__codelineno-32-5"></a>
</span><span id="__span-32-6"><a id="__codelineno-32-6" name="__codelineno-32-6" href="#lab06-k-agent-__codelineno-32-6"></a><span class="w">  </span><span class="c1">// Calculate restart counts</span>
</span><span id="__span-32-7"><a id="__codelineno-32-7" name="__codelineno-32-7" href="#lab06-k-agent-__codelineno-32-7"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="p">.</span><span class="nx">reduce</span><span class="p">(</span>
</span><span id="__span-32-8"><a id="__codelineno-32-8" name="__codelineno-32-8" href="#lab06-k-agent-__codelineno-32-8"></a><span class="w">    </span><span class="p">(</span><span class="nx">sum</span><span class="p">,</span><span class="w"> </span><span class="nx">cs</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">sum</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">(</span><span class="nx">cs</span><span class="p">.</span><span class="nx">restartCount</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">),</span><span class="w"> </span>
</span><span id="__span-32-9"><a id="__codelineno-32-9" name="__codelineno-32-9" href="#lab06-k-agent-__codelineno-32-9"></a><span class="w">    </span><span class="mf">0</span>
</span><span id="__span-32-10"><a id="__codelineno-32-10" name="__codelineno-32-10" href="#lab06-k-agent-__codelineno-32-10"></a><span class="w">  </span><span class="p">);</span>
</span><span id="__span-32-11"><a id="__codelineno-32-11" name="__codelineno-32-11" href="#lab06-k-agent-__codelineno-32-11"></a>
</span><span id="__span-32-12"><a id="__codelineno-32-12" name="__codelineno-32-12" href="#lab06-k-agent-__codelineno-32-12"></a><span class="w">  </span><span class="c1">// Check readiness</span>
</span><span id="__span-32-13"><a id="__codelineno-32-13" name="__codelineno-32-13" href="#lab06-k-agent-__codelineno-32-13"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">readyCondition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">conditions</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Ready&#39;</span><span class="p">);</span>
</span><span id="__span-32-14"><a id="__codelineno-32-14" name="__codelineno-32-14" href="#lab06-k-agent-__codelineno-32-14"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">isReady</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">readyCondition</span><span class="o">?</span><span class="p">.</span><span class="nx">status</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;True&#39;</span><span class="p">;</span>
</span><span id="__span-32-15"><a id="__codelineno-32-15" name="__codelineno-32-15" href="#lab06-k-agent-__codelineno-32-15"></a>
</span><span id="__span-32-16"><a id="__codelineno-32-16" name="__codelineno-32-16" href="#lab06-k-agent-__codelineno-32-16"></a><span class="w">  </span><span class="c1">// Check container states</span>
</span><span id="__span-32-17"><a id="__codelineno-32-17" name="__codelineno-32-17" href="#lab06-k-agent-__codelineno-32-17"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">containerHealth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">containerStatuses</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">cs</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-32-18"><a id="__codelineno-32-18" name="__codelineno-32-18" href="#lab06-k-agent-__codelineno-32-18"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.name</span><span class="p">,</span>
</span><span id="__span-32-19"><a id="__codelineno-32-19" name="__codelineno-32-19" href="#lab06-k-agent-__codelineno-32-19"></a><span class="w">    </span><span class="nx">ready</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.ready</span><span class="p">,</span>
</span><span id="__span-32-20"><a id="__codelineno-32-20" name="__codelineno-32-20" href="#lab06-k-agent-__codelineno-32-20"></a><span class="w">    </span><span class="nx">restartCount</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.restartCount</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-32-21"><a id="__codelineno-32-21" name="__codelineno-32-21" href="#lab06-k-agent-__codelineno-32-21"></a><span class="w">    </span><span class="nx">state</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.state?.running</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Running&#39;</span><span class="w"> </span>
</span><span id="__span-32-22"><a id="__codelineno-32-22" name="__codelineno-32-22" href="#lab06-k-agent-__codelineno-32-22"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="o">?</span><span class="p">.</span><span class="nx">waiting</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Waiting: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">waiting</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span><span class="w"> </span>
</span><span id="__span-32-23"><a id="__codelineno-32-23" name="__codelineno-32-23" href="#lab06-k-agent-__codelineno-32-23"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="o">?</span><span class="p">.</span><span class="nx">terminated</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="sb">`Terminated: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">state</span><span class="p">.</span><span class="nx">terminated</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-32-24"><a id="__codelineno-32-24" name="__codelineno-32-24" href="#lab06-k-agent-__codelineno-32-24"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="p">,</span>
</span><span id="__span-32-25"><a id="__codelineno-32-25" name="__codelineno-32-25" href="#lab06-k-agent-__codelineno-32-25"></a><span class="w">    </span><span class="nx">lastState</span><span class="o">:</span><span class="w"> </span><span class="kt">cs.lastState?.terminated</span><span class="w"> </span>
</span><span id="__span-32-26"><a id="__codelineno-32-26" name="__codelineno-32-26" href="#lab06-k-agent-__codelineno-32-26"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="sb">`Previously terminated: </span><span class="si">${</span><span class="nx">cs</span><span class="p">.</span><span class="nx">lastState</span><span class="p">.</span><span class="nx">terminated</span><span class="p">.</span><span class="nx">reason</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-32-27"><a id="__codelineno-32-27" name="__codelineno-32-27" href="#lab06-k-agent-__codelineno-32-27"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="kc">undefined</span>
</span><span id="__span-32-28"><a id="__codelineno-32-28" name="__codelineno-32-28" href="#lab06-k-agent-__codelineno-32-28"></a><span class="w">  </span><span class="p">}));</span>
</span><span id="__span-32-29"><a id="__codelineno-32-29" name="__codelineno-32-29" href="#lab06-k-agent-__codelineno-32-29"></a>
</span><span id="__span-32-30"><a id="__codelineno-32-30" name="__codelineno-32-30" href="#lab06-k-agent-__codelineno-32-30"></a><span class="w">  </span><span class="c1">// Overall health assessment</span>
</span><span id="__span-32-31"><a id="__codelineno-32-31" name="__codelineno-32-31" href="#lab06-k-agent-__codelineno-32-31"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">healthStatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>
</span><span id="__span-32-32"><a id="__codelineno-32-32" name="__codelineno-32-32" href="#lab06-k-agent-__codelineno-32-32"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Running&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">isReady</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Healthy&#39;</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-33"><a id="__codelineno-32-33" name="__codelineno-32-33" href="#lab06-k-agent-__codelineno-32-33"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Running&#39;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="nx">totalRestarts</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Unstable&#39;</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-34"><a id="__codelineno-32-34" name="__codelineno-32-34" href="#lab06-k-agent-__codelineno-32-34"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Pending&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Starting&#39;</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-35"><a id="__codelineno-32-35" name="__codelineno-32-35" href="#lab06-k-agent-__codelineno-32-35"></a><span class="w">    </span><span class="nx">status</span><span class="o">?</span><span class="p">.</span><span class="nx">phase</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;Failed&#39;</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="s1">&#39;Failed&#39;</span><span class="w"> </span><span class="o">:</span>
</span><span id="__span-32-36"><a id="__codelineno-32-36" name="__codelineno-32-36" href="#lab06-k-agent-__codelineno-32-36"></a><span class="w">    </span><span class="s1">&#39;Unknown&#39;</span><span class="p">;</span>
</span><span id="__span-32-37"><a id="__codelineno-32-37" name="__codelineno-32-37" href="#lab06-k-agent-__codelineno-32-37"></a>
</span><span id="__span-32-38"><a id="__codelineno-32-38" name="__codelineno-32-38" href="#lab06-k-agent-__codelineno-32-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-32-39"><a id="__codelineno-32-39" name="__codelineno-32-39" href="#lab06-k-agent-__codelineno-32-39"></a><span class="w">    </span><span class="nx">phase</span><span class="o">:</span><span class="w"> </span><span class="kt">status?.phase</span><span class="p">,</span>
</span><span id="__span-32-40"><a id="__codelineno-32-40" name="__codelineno-32-40" href="#lab06-k-agent-__codelineno-32-40"></a><span class="w">    </span><span class="nx">healthStatus</span><span class="p">,</span>
</span><span id="__span-32-41"><a id="__codelineno-32-41" name="__codelineno-32-41" href="#lab06-k-agent-__codelineno-32-41"></a><span class="w">    </span><span class="nx">isReady</span><span class="p">,</span>
</span><span id="__span-32-42"><a id="__codelineno-32-42" name="__codelineno-32-42" href="#lab06-k-agent-__codelineno-32-42"></a><span class="w">    </span><span class="nx">totalRestarts</span><span class="p">,</span>
</span><span id="__span-32-43"><a id="__codelineno-32-43" name="__codelineno-32-43" href="#lab06-k-agent-__codelineno-32-43"></a><span class="w">    </span><span class="nx">age</span><span class="o">:</span><span class="w"> </span><span class="kt">pod.metadata?.creationTimestamp</span><span class="w"> </span>
</span><span id="__span-32-44"><a id="__codelineno-32-44" name="__codelineno-32-44" href="#lab06-k-agent-__codelineno-32-44"></a><span class="w">      </span><span class="o">?</span><span class="w"> </span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nb">Date</span><span class="p">(</span><span class="nx">pod</span><span class="p">.</span><span class="nx">metadata</span><span class="p">.</span><span class="nx">creationTimestamp</span><span class="p">).</span><span class="nx">getTime</span><span class="p">())</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1000</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">60</span><span class="p">)</span>
</span><span id="__span-32-45"><a id="__codelineno-32-45" name="__codelineno-32-45" href="#lab06-k-agent-__codelineno-32-45"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="mf">0</span><span class="p">,</span>
</span><span id="__span-32-46"><a id="__codelineno-32-46" name="__codelineno-32-46" href="#lab06-k-agent-__codelineno-32-46"></a><span class="w">    </span><span class="nx">conditions</span><span class="o">:</span><span class="w"> </span><span class="kt">conditions.map</span><span class="p">(</span><span class="nx">c</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-32-47"><a id="__codelineno-32-47" name="__codelineno-32-47" href="#lab06-k-agent-__codelineno-32-47"></a><span class="w">      </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">c</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-32-48"><a id="__codelineno-32-48" name="__codelineno-32-48" href="#lab06-k-agent-__codelineno-32-48"></a><span class="w">      </span><span class="nx">status</span><span class="o">:</span><span class="w"> </span><span class="kt">c.status</span><span class="p">,</span>
</span><span id="__span-32-49"><a id="__codelineno-32-49" name="__codelineno-32-49" href="#lab06-k-agent-__codelineno-32-49"></a><span class="w">      </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="kt">c.reason</span><span class="p">,</span>
</span><span id="__span-32-50"><a id="__codelineno-32-50" name="__codelineno-32-50" href="#lab06-k-agent-__codelineno-32-50"></a><span class="w">      </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">c.message</span>
</span><span id="__span-32-51"><a id="__codelineno-32-51" name="__codelineno-32-51" href="#lab06-k-agent-__codelineno-32-51"></a><span class="w">    </span><span class="p">})),</span>
</span><span id="__span-32-52"><a id="__codelineno-32-52" name="__codelineno-32-52" href="#lab06-k-agent-__codelineno-32-52"></a><span class="w">    </span><span class="nx">containers</span><span class="o">:</span><span class="w"> </span><span class="kt">containerHealth</span>
</span><span id="__span-32-53"><a id="__codelineno-32-53" name="__codelineno-32-53" href="#lab06-k-agent-__codelineno-32-53"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-32-54"><a id="__codelineno-32-54" name="__codelineno-32-54" href="#lab06-k-agent-__codelineno-32-54"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Add the events retrieval method:</strong></p>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#lab06-k-agent-__codelineno-33-1"></a><span class="k">private</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="nx">getPodEvents</span><span class="p">(</span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="nx">podName</span><span class="o">:</span><span class="w"> </span><span class="kt">string</span><span class="p">)</span><span class="o">:</span><span class="w"> </span><span class="nb">Promise</span><span class="o">&lt;</span><span class="nx">any</span><span class="p">[]</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#lab06-k-agent-__codelineno-33-2"></a><span class="w">  </span><span class="k">try</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#lab06-k-agent-__codelineno-33-3"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">response</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">k8sCoreApi</span><span class="p">.</span><span class="nx">listNamespacedEvent</span><span class="p">({</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#lab06-k-agent-__codelineno-33-4"></a><span class="w">      </span><span class="nx">namespace</span><span class="p">,</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#lab06-k-agent-__codelineno-33-5"></a><span class="w">      </span><span class="nx">fieldSelector</span><span class="o">:</span><span class="w"> </span><span class="sb">`involvedObject.name=</span><span class="si">${</span><span class="nx">podName</span><span class="si">}</span><span class="sb">`</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#lab06-k-agent-__codelineno-33-6"></a><span class="w">    </span><span class="p">});</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#lab06-k-agent-__codelineno-33-7"></a>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#lab06-k-agent-__codelineno-33-8"></a><span class="w">    </span><span class="kd">const</span><span class="w"> </span><span class="nx">events</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">items</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="p">[])</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#lab06-k-agent-__codelineno-33-9"></a><span class="w">      </span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">a</span><span class="p">,</span><span class="w"> </span><span class="nx">b</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#lab06-k-agent-__codelineno-33-10"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeA</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">firstTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#lab06-k-agent-__codelineno-33-11"></a><span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">timeB</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">b</span><span class="p">.</span><span class="nx">firstTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">;</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#lab06-k-agent-__codelineno-33-12"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nx">timeB</span><span class="p">.</span><span class="nx">localeCompare</span><span class="p">(</span><span class="nx">timeA</span><span class="p">);</span>
</span><span id="__span-33-13"><a id="__codelineno-33-13" name="__codelineno-33-13" href="#lab06-k-agent-__codelineno-33-13"></a><span class="w">      </span><span class="p">})</span>
</span><span id="__span-33-14"><a id="__codelineno-33-14" name="__codelineno-33-14" href="#lab06-k-agent-__codelineno-33-14"></a><span class="w">      </span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="w"> </span><span class="mf">10</span><span class="p">)</span><span class="w"> </span><span class="c1">// Last 10 events</span>
</span><span id="__span-33-15"><a id="__codelineno-33-15" name="__codelineno-33-15" href="#lab06-k-agent-__codelineno-33-15"></a><span class="w">      </span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">event</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">({</span>
</span><span id="__span-33-16"><a id="__codelineno-33-16" name="__codelineno-33-16" href="#lab06-k-agent-__codelineno-33-16"></a><span class="w">        </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="kr">type</span><span class="p">,</span>
</span><span id="__span-33-17"><a id="__codelineno-33-17" name="__codelineno-33-17" href="#lab06-k-agent-__codelineno-33-17"></a><span class="w">        </span><span class="nx">reason</span><span class="o">:</span><span class="w"> </span><span class="kt">event.reason</span><span class="p">,</span>
</span><span id="__span-33-18"><a id="__codelineno-33-18" name="__codelineno-33-18" href="#lab06-k-agent-__codelineno-33-18"></a><span class="w">        </span><span class="nx">message</span><span class="o">:</span><span class="w"> </span><span class="kt">event.message</span><span class="p">,</span>
</span><span id="__span-33-19"><a id="__codelineno-33-19" name="__codelineno-33-19" href="#lab06-k-agent-__codelineno-33-19"></a><span class="w">        </span><span class="nx">count</span><span class="o">:</span><span class="w"> </span><span class="kt">event.count</span><span class="p">,</span>
</span><span id="__span-33-20"><a id="__codelineno-33-20" name="__codelineno-33-20" href="#lab06-k-agent-__codelineno-33-20"></a><span class="w">        </span><span class="nx">time</span><span class="o">:</span><span class="w"> </span><span class="kt">event.lastTimestamp</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="nx">event</span><span class="p">.</span><span class="nx">firstTimestamp</span>
</span><span id="__span-33-21"><a id="__codelineno-33-21" name="__codelineno-33-21" href="#lab06-k-agent-__codelineno-33-21"></a><span class="w">      </span><span class="p">}));</span>
</span><span id="__span-33-22"><a id="__codelineno-33-22" name="__codelineno-33-22" href="#lab06-k-agent-__codelineno-33-22"></a>
</span><span id="__span-33-23"><a id="__codelineno-33-23" name="__codelineno-33-23" href="#lab06-k-agent-__codelineno-33-23"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nx">events</span><span class="p">;</span>
</span><span id="__span-33-24"><a id="__codelineno-33-24" name="__codelineno-33-24" href="#lab06-k-agent-__codelineno-33-24"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-33-25"><a id="__codelineno-33-25" name="__codelineno-33-25" href="#lab06-k-agent-__codelineno-33-25"></a><span class="w">    </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s1">&#39;Failed to retrieve events:&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-33-26"><a id="__codelineno-33-26" name="__codelineno-33-26" href="#lab06-k-agent-__codelineno-33-26"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">[];</span>
</span><span id="__span-33-27"><a id="__codelineno-33-27" name="__codelineno-33-27" href="#lab06-k-agent-__codelineno-33-27"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-33-28"><a id="__codelineno-33-28" name="__codelineno-33-28" href="#lab06-k-agent-__codelineno-33-28"></a><span class="p">}</span>
</span></code></pre></div>
<p><br></p>
<p><strong>Test the monitoring functionality:</strong></p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#lab06-k-agent-__codelineno-34-1"></a>npx<span class="w"> </span>@modelcontextprotocol/inspector<span class="w"> </span>node_modules/.bin/tsx<span class="w"> </span>src/index.ts
</span></code></pre></div>
<p><strong>Try these test cases:</strong></p>
<ul>
<li>Monitor a specific pod: Set <code>namespace</code> and <code>podName</code></li>
<li>Check all pods in namespace: Set only <code>namespace</code></li>
<li>Include events: Set <code>includeEvents</code> to true</li>
<li>Look for unhealthy pods with high restart counts</li>
</ul>
<hr />
<div class="admonition tip">
<p class="admonition-title">Extension Ideas</p>
<p>Now that you have a robust K-Agent, consider these additional enhancements:</p>
<ul>
<li><strong>Resource Metrics</strong>: Add CPU/memory usage monitoring using the Metrics API</li>
<li><strong>Multi-Cluster Support</strong>: Extend to work with multiple Kubernetes clusters</li>
<li><strong>Alerting</strong>: Implement threshold-based alerts for restart counts or error rates</li>
<li><strong>Log Aggregation</strong>: Integrate with log aggregation systems like ELK or Loki</li>
<li><strong>Historical Analysis</strong>: Store and analyze trends over time</li>
<li><strong>Auto-Remediation</strong>: Add tools to automatically restart or scale problematic pods</li>
</ul>
</div>
<hr />
<h2 id="lab06-k-agent-troubleshooting">Troubleshooting<a class="headerlink" href="#lab06-k-agent-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="lab06-k-agent-common-issues">Common Issues<a class="headerlink" href="#lab06-k-agent-common-issues" title="Permanent link">&para;</a></h3>
<p><strong>&ldquo;Kubernetes configuration not found&rdquo;</strong>
- Ensure <code>kubectl</code> is installed and configured
- Check <code>~/.kube/config</code> exists and is readable</p>
<p><strong>&ldquo;Pod not found&rdquo; errors</strong>
- Confirm pod names and namespaces are correct
- Check pod status with <code>kubectl get pods</code></p>
<h3 id="lab06-k-agent-debug-commands">Debug Commands<a class="headerlink" href="#lab06-k-agent-debug-commands" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#lab06-k-agent-__codelineno-35-1"></a><span class="c1"># Check cluster access</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#lab06-k-agent-__codelineno-35-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#lab06-k-agent-__codelineno-35-3"></a>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#lab06-k-agent-__codelineno-35-4"></a><span class="c1"># Verify service account permissions</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#lab06-k-agent-__codelineno-35-5"></a>kubectl<span class="w"> </span>auth<span class="w"> </span>can-i<span class="w"> </span>list<span class="w"> </span>pods<span class="w"> </span>--as<span class="o">=</span>system:serviceaccount:default:k-agent-sa
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#lab06-k-agent-__codelineno-35-6"></a>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#lab06-k-agent-__codelineno-35-7"></a><span class="c1"># Check pod logs</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#lab06-k-agent-__codelineno-35-8"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>your-namespace<span class="w"> </span>your-pod-name
</span></code></pre></div>
<hr />
<h2 id="lab06-k-agent-key-takeaways">Key Takeaways<a class="headerlink" href="#lab06-k-agent-key-takeaways" title="Permanent link">&para;</a></h2>
<div class="admonition success">
<p class="admonition-title">What You Learned</p>
<ul>
<li><strong>K-Agent Architecture</strong>: Building specialized MCP servers for Kubernetes operations</li>
<li><strong>MCP Server Setup</strong>: Configuring TypeScript-based MCP servers with proper dependencies</li>
<li><strong>Kubernetes Client Integration</strong>: Using the @kubernetes/client-node library to interact with clusters</li>
<li><strong>Tool Implementation</strong>: Creating MCP tools for pod discovery and log collection</li>
<li><strong>Error Handling</strong>: Managing Kubernetes API errors and edge cases</li>
<li><strong>Testing with MCP Inspector</strong>: Using the Inspector to test and debug MCP tools</li>
</ul>
</div>
<p>Congratulations! You&rsquo;ve built a functional K-Agent with two core capabilities:</p>
<ul>
<li><strong>Pod Discovery</strong> - List all pods across namespaces with status information</li>
<li><strong>Log Collection</strong> - Retrieve logs from pod containers with timestamp support</li>
</ul>
<hr />
<h2 id="lab06-k-agent-whats-next">What&rsquo;s Next?<a class="headerlink" href="#lab06-k-agent-whats-next" title="Permanent link">&para;</a></h2>
<p>Your K-Agent provides a foundation for more advanced Kubernetes automation. </p>
<p>Consider exploring:</p>
<ul>
<li>Adding filtering, log analysis, and health monitoring</li>
<li>Integrating your K-Agent with other MCP clients</li>
<li>Adding more tools for resource management (deployments, services, configmaps)</li>
<li>Implementing resource watching for real-time cluster monitoring</li>
<li>Building custom tools specific to your set Kubernetes workflows</li>
</ul>
<hr />
<h2 id="lab06-k-agent-additional-resources">Additional Resources<a class="headerlink" href="#lab06-k-agent-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubernetes-api/">Kubernetes API Documentation</a></li>
<li><a href="https://github.com/modelcontextprotocol/sdk">MCP SDK Reference</a></li>
<li><a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Log Aggregation Patterns</a></content></li>
</ul></section></section>
                    <section class='print-page md-section' id='section-4' heading-number='4'>
                        <h1>Tasks<a class='headerlink' href='#section-4' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="tasks" heading-number="4.1"><h1 id="tasks-list-of-tasks">List of tasks<a class="headerlink" href="#tasks-list-of-tasks" title="Permanent link">&para;</a></h1></section><section class="print-page" id="tasks-000-setup-roocode-000-setup-roocode" heading-number="4.2"><h1 id="tasks-000-setup-roocode-000-setup-roocode-task-install-and-setup-roo-code">Task: Install and Setup Roo Code<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-task-install-and-setup-roo-code" title="Permanent link">&para;</a></h1>
<ul>
<li>This guide outlines the steps to install Roo Code (formerly Cline), configure it with custom instructions and MCP (Model Context Protocol), and demonstrates a usage example with a hypothetical &ldquo;Context7&rdquo; MCP server.</li>
</ul>
<hr />
<h2 id="tasks-000-setup-roocode-000-setup-roocode-1-install-roo-code">1. Install Roo Code<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-1-install-roo-code" title="Permanent link">&para;</a></h2>
<p>Roo Code is an autonomous coding agent extension for VS Code.</p>
<ol>
<li>Open <strong>VS Code</strong>.</li>
<li>Go to the <strong>Extensions</strong> view (Click the square icon on the sidebar or press <code>Cmd+Shift+X</code>).</li>
<li>Search for <strong>&ldquo;Roo Code&rdquo;</strong>.</li>
<li>Look for the extension published by <strong>RooVeterinaryInc</strong> (ID: <code>RooVeterinaryInc.roo-cline</code>).</li>
<li>Click <strong>Install</strong>.</li>
</ol>
<hr />
<h2 id="tasks-000-setup-roocode-000-setup-roocode-2-setup-roo-code">2. Setup Roo Code<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-2-setup-roo-code" title="Permanent link">&para;</a></h2>
<ol>
<li>Once installed, you need to configure Roo Code.</li>
<li>Open the <strong>Roo Code</strong> sidebar by clicking the Roo Code icon on the sidebar.</li>
<li>You will see the main Roo Code interface.</li>
<li>We will go over the key configuration options during the lecture.</li>
<li>
<p>Adding API Keys (Use exiting or create new keys as needed) <a href="#tasks-000-setup-roocode-000-setup-roocode-free api keys for google gemini">https://aistudio.google.com/api-keys</a></p>
<p><img src="../assets/images/RooCode/RooCode01.png" alt="Roo Code Sidebar" style="max-width:800px;"/></p>
<p><img src="../assets/images/RooCode/RooCode02.png" alt="Roo Code Sidebar" style="max-width:800px;"/></p>
</li>
</ol>
<hr />
<h2 id="tasks-000-setup-roocode-000-setup-roocode-3-configuring-roo-code-features">3. Configuring Roo Code Features<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-3-configuring-roo-code-features" title="Permanent link">&para;</a></h2>
<h3 id="tasks-000-setup-roocode-000-setup-roocode-create-profile">Create Profile<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-create-profile" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p class="admonition-title">Creating a Profile</p>
<ol>
<li>Open the <strong>Roo Code</strong> sidebar.</li>
<li>Click the <strong>Profile</strong> icon (user icon).</li>
<li>Click <strong>&ldquo;Create Profile&rdquo;</strong>.</li>
<li>Fill in your details and preferences.</li>
<li>Click <strong>&ldquo;Save Profile&rdquo;</strong>.</li>
<li>Your profile will help Roo Code tailor its responses to your coding style and preferences.</li>
<li>You can create multiple profiles for different projects or coding styles.</li>
<li>Switch between profiles as needed.</li>
</ol>
</div>
<h3 id="tasks-000-setup-roocode-000-setup-roocode-api-keys">API Keys<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-api-keys" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p class="admonition-title">Setting Up API Keys</p>
<ol>
<li>Open the <strong>Roo Code</strong> sidebar.</li>
<li>Click the <strong>Settings</strong> (gear icon).</li>
<li>Scroll to <strong>&ldquo;API Keys&rdquo;</strong>.</li>
<li>Enter your API keys for the models you want to use (e.g., OpenAI, Google Gemini).</li>
<li>Click <strong>&ldquo;Save&rdquo;</strong>.</li>
<li>Roo Code will use these keys to access the respective language models for code generation and assistance.</li>
</ol>
</div>
<h3 id="tasks-000-setup-roocode-000-setup-roocode-modes">Modes<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-modes" title="Permanent link">&para;</a></h3>
<div class="admonition success">
<p class="admonition-title">Setting Up Modes</p>
<ol>
<li>Open the <strong>Roo Code</strong> sidebar.</li>
<li>Click the <strong>Settings</strong> (gear icon).</li>
<li>Scroll to <strong>&ldquo;Default Mode&rdquo;</strong>.</li>
<li>Select your preferred default mode (e.g., Code, Architect, Ask).</li>
<li>Click <strong>&ldquo;Save&rdquo;</strong>.</li>
<li>This setting determines how Roo Code will approach tasks by default.</li>
</ol>
</div>
<hr />
<h3 id="tasks-000-setup-roocode-000-setup-roocode-4-advanced-configuration">4. Advanced Configuration<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-4-advanced-configuration" title="Permanent link">&para;</a></h3>
<h4 id="tasks-000-setup-roocode-000-setup-roocode-mcp-servers">MCP Servers<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-mcp-servers" title="Permanent link">&para;</a></h4>
<ul>
<li>MCP (Model Context Protocol) allows Roo Code to connect to external tools and data sources.</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Setting Up MCP Servers</p>
<ol>
<li>In the Roo Code sidebar, click the <strong>MCP</strong> icon (server icon) or go to <strong>Settings &gt; MCP Servers</strong>.</li>
<li>Click <strong>&ldquo;Edit MCP Settings&rdquo;</strong> (Global or Project).  </li>
<li>This will open a JSON file for the MCP settings.</li>
<li>Add your MCP servers to the <code>mcpServers</code> object.<ul>
<li>Each server configuration includes the command to start the server, arguments, and environment variables if needed.</li>
</ul>
</li>
<li>Save the file. </li>
<li>Roo Code will now be able to use these MCP servers for enhanced context and capabilities.</li>
</ol>
</div>
<hr />
<h3 id="tasks-000-setup-roocode-000-setup-roocode-additional-settings">Additional Settings<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-additional-settings" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>We will cover these in the lecture.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Setting</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><strong>Auto-Approve</strong></td>
<td style="text-align: left;">Automatically approve Roo Code&rsquo;s suggested changes.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Slash Commands</strong></td>
<td style="text-align: left;">Enable or disable slash commands for quick actions.</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Context</strong></td>
<td style="text-align: left;">Configure how much file context Roo Code uses when generating code (Tabs, limits etc.).</td>
</tr>
<tr>
<td style="text-align: left;"><strong>Prompts</strong></td>
<td style="text-align: left;">Customize prompt templates for different modes.</td>
</tr>
</tbody>
</table>
</li>
</ul>
<hr />
<h2 id="tasks-000-setup-roocode-000-setup-roocode-4-adding-custom-instructions">4. Adding Custom Instructions<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-4-adding-custom-instructions" title="Permanent link">&para;</a></h2>
<ul>
<li>Adding custom instructions to Roo Code is a powerful way to enforce coding standards, project context, or specific AI behaviors. </li>
<li>There are three primary ways to do this: Project-specific files, the UI (Prompts Tab), and Global configuration.</li>
</ul>
<h4 id="tasks-000-setup-roocode-000-setup-roocode-1-project-specific-instructions-recommended">1. Project-Specific Instructions (Recommended)<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-1-project-specific-instructions-recommended" title="Permanent link">&para;</a></h4>
<ul>
<li>This is the best way to ensure that any developer working on your specific project gets the same AI behavior.</li>
</ul>
<p><strong>Method A: The <code>.roo/rules/</code> Directory (Modern)</strong></p>
<ul>
<li>
<p>Roo Code now looks for a directory in your project root to load instructions.</p>
<div class="admonition success">
<p class="admonition-title">Setting Up Custom Rules</p>
<ul>
<li>Create a folder named <code>.roo/rules/</code> in your project&rsquo;s root directory.  </li>
<li>Roo Code will read all files in this directory and apply the instructions when working on the project.   </li>
<li>Example filenames: <br />
  <div class="language-markdown highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-0-1"></a>  coding-standards.md
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-0-2"></a>  project-context.md
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-0-3"></a>  api-guidelines.md
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-0-4"></a>  testing-instructions.md
</span></code></pre></div></li>
<li>Add any number of <code>.md</code> (Markdown) files in this directory.<br />
  <div class="language-markdown highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-1"></a>  your-project/
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-2"></a>  ‚îú‚îÄ‚îÄ .roo/
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-3"></a>  ‚îÇ   ‚îî‚îÄ‚îÄ rules/
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-4"></a>  ‚îÇ       ‚îú‚îÄ‚îÄ coding-standards.md
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-5"></a>  ‚îÇ       ‚îú‚îÄ‚îÄ project-context.md
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-6"></a>  ‚îÇ       ‚îî‚îÄ‚îÄ api-guidelines.md
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-7"></a>  ‚îî‚îÄ‚îÄ src/
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-8"></a>      ‚îî‚îÄ‚îÄ main.py
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-9"></a>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-1-10"></a>  # Each file can contain specific instructions or context for Roo Code.      
</span></code></pre></div></li>
<li>Example content for <code>coding-standards.md</code>:
    <div class="language-markdown highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-2-1"></a><span class="gh"># Coding Standards</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-2-2"></a><span class="k">-</span><span class="w"> </span>Follow PEP 8 for Python code.
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-2-3"></a><span class="k">-</span><span class="w"> </span>Use meaningful variable names.
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#tasks-000-setup-roocode-000-setup-roocode-__codelineno-2-4"></a><span class="k">-</span><span class="w"> </span>Write unit tests for all new features.
</span></code></pre></div></li>
<li>This method allows for easy version control and sharing of instructions with your team.</li>
<li>Roo Code will automatically pick up changes to these files.</li>
</ul>
</div>
</li>
</ul>
<hr />
<h4 id="tasks-000-setup-roocode-000-setup-roocode-2-using-the-prompts-tab-in-the-ui-globalquick-edits">2. Using the Prompts Tab in the UI (Global/Quick Edits)<a class="headerlink" href="#tasks-000-setup-roocode-000-setup-roocode-2-using-the-prompts-tab-in-the-ui-globalquick-edits" title="Permanent link">&para;</a></h4>
<ul>
<li>You can also add custom instructions directly through the Roo Code UI.</li>
<li>
<p>This method is less ideal for project-specific instructions but can be useful for quick adjustments.</p>
<div class="admonition success">
<p class="admonition-title">Adding Custom Prompts via UI</p>
<ul>
<li>Open the <strong>Roo Code</strong> sidebar.</li>
<li>Click on the <strong>Prompts</strong> tab.</li>
<li>Here, you can add or edit custom prompts for different modes.</li>
<li>Save your changes.</li>
</ul>
</div>
<ul>
<li>Roo Code will use these prompts when generating code.</li>
</ul>
</li>
</ul></section></section>
                    <section class='print-page md-section' id='section-5' heading-number='5'>
                        <h1>Resources<a class='headerlink' href='#section-5' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="resources-001-mcp-basics-001-mcp-basics-py" heading-number="5.1"><h1 id="resources-001-mcp-basics-001-mcp-basics-py-resources-001-mcp-basics-001-mcp-basics-py">001 - MCP Basics (PY)</h1><h3 id="mcp-basics-with-python">MCP Basics with Python<a class="headerlink" href="#resources-001-mcp-basics-001-mcp-basics-py-mcp-basics-with-python" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-3"></a><span class="c1"># Create server instance</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-4"></a><span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;kagent-mcp-server&quot;</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-5"></a>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-6"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-7"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-8"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a friendly greeting message&quot;&quot;&quot;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-9"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to K-Agent Labs.&quot;</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-11"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-12"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-13"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds two numbers together&quot;&quot;&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-14"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-15"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The sum of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-17"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-18"></a>    <span class="c1"># Initialize and run the server</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-19"></a>    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-21"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#resources-001-mcp-basics-001-mcp-basics-py-__codelineno-0-22"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></section><section class="print-page" id="resources-001-mcp-basics-002-mcp-basics-ts" heading-number="5.2"><h1 id="resources-001-mcp-basics-002-mcp-basics-ts-mcp-server-example-ts">MCP Server Example (TS)<a class="headerlink" href="#resources-001-mcp-basics-002-mcp-basics-ts-mcp-server-example-ts" title="Permanent link">&para;</a></h1>
<div class="language-typescript highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-1"></a><span class="ch">#!/usr/bin/env node</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-3"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">Server</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/index.js&quot;</span><span class="p">;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-4"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/server/stdio.js&quot;</span><span class="p">;</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-5"></a><span class="k">import</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-6"></a><span class="w">  </span><span class="nx">CallToolRequestSchema</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-7"></a><span class="w">  </span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-8"></a><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s2">&quot;@modelcontextprotocol/sdk/types.js&quot;</span><span class="p">;</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-10"></a><span class="cm">/**</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-11"></a><span class="cm"> * K-Agent MCP Server</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-12"></a><span class="cm"> * A simple Model Context Protocol server with example tools</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-13"></a><span class="cm"> */</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-15"></a><span class="c1">// Create server instance</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-16"></a><span class="kd">const</span><span class="w"> </span><span class="nx">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Server</span><span class="p">(</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-17"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-18"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;kagent-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-19"></a><span class="w">    </span><span class="nx">version</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;1.0.0&quot;</span><span class="p">,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-20"></a><span class="w">  </span><span class="p">},</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-21"></a><span class="w">  </span><span class="p">{</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-22"></a><span class="w">    </span><span class="nx">capabilities</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-23"></a><span class="w">      </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">{},</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-24"></a><span class="w">    </span><span class="p">},</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-25"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-26"></a><span class="p">);</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-28"></a><span class="c1">// List available tools</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-29"></a><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">ListToolsRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-30"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-31"></a><span class="w">    </span><span class="nx">tools</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-32"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-33"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="p">,</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-34"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Returns a friendly greeting message&quot;</span><span class="p">,</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-35"></a><span class="w">        </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-36"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-37"></a><span class="w">          </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-38"></a><span class="w">            </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-39"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;string&quot;</span><span class="p">,</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-40"></a><span class="w">              </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Name to greet&quot;</span><span class="p">,</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-41"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-42"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-43"></a><span class="w">          </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">],</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-44"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-45"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-46"></a><span class="w">      </span><span class="p">{</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-47"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="p">,</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-48"></a><span class="w">        </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Adds two numbers together&quot;</span><span class="p">,</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-49"></a><span class="w">        </span><span class="nx">inputSchema</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-50"></a><span class="w">          </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-51"></a><span class="w">          </span><span class="nx">properties</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-52"></a><span class="w">            </span><span class="nx">a</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-53"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-54"></a><span class="w">              </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;First number&quot;</span><span class="p">,</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-55"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-56"></a><span class="w">            </span><span class="nx">b</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-57"></a><span class="w">              </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;number&quot;</span><span class="p">,</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-58"></a><span class="w">              </span><span class="nx">description</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Second number&quot;</span><span class="p">,</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-59"></a><span class="w">            </span><span class="p">},</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-60"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-61"></a><span class="w">          </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s2">&quot;a&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;b&quot;</span><span class="p">],</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-62"></a><span class="w">        </span><span class="p">},</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-63"></a><span class="w">      </span><span class="p">},</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-64"></a><span class="w">    </span><span class="p">],</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-65"></a><span class="w">  </span><span class="p">};</span>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-66"></a><span class="p">});</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-67"></a>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-68"></a><span class="c1">// Handle tool calls</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-69"></a><span class="nx">server</span><span class="p">.</span><span class="nx">setRequestHandler</span><span class="p">(</span><span class="nx">CallToolRequestSchema</span><span class="p">,</span><span class="w"> </span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-70"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">name</span><span class="p">,</span><span class="w"> </span><span class="nx">arguments</span><span class="o">:</span><span class="w"> </span><span class="kt">args</span><span class="w"> </span><span class="p">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">request</span><span class="p">.</span><span class="nx">params</span><span class="p">;</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-71"></a>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-72"></a><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="nx">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-73"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;hello&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-74"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">nameArg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">name</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">string</span><span class="p">;</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-75"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-76"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-77"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-78"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-79"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`Hello, </span><span class="si">${</span><span class="nx">nameArg</span><span class="si">}</span><span class="sb">! Welcome to K-Agent Labs.`</span><span class="p">,</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-80"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-81"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-82"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-83"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-84"></a>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-85"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="s2">&quot;add&quot;</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-86"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">a</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-87"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">args</span><span class="o">?</span><span class="p">.</span><span class="nx">b</span><span class="w"> </span><span class="kr">as</span><span class="w"> </span><span class="kt">number</span><span class="p">;</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-88"></a><span class="w">      </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">b</span><span class="p">;</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-89"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-90"></a><span class="w">        </span><span class="nx">content</span><span class="o">:</span><span class="w"> </span><span class="p">[</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-91"></a><span class="w">          </span><span class="p">{</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-92"></a><span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-93"></a><span class="w">            </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="sb">`The sum of </span><span class="si">${</span><span class="nx">a</span><span class="si">}</span><span class="sb"> and </span><span class="si">${</span><span class="nx">b</span><span class="si">}</span><span class="sb"> is </span><span class="si">${</span><span class="nx">result</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-94"></a><span class="w">          </span><span class="p">},</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-95"></a><span class="w">        </span><span class="p">],</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-96"></a><span class="w">      </span><span class="p">};</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-97"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-98"></a>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-99"></a><span class="w">    </span><span class="nx">default</span><span class="o">:</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-100"></a><span class="w">      </span><span class="kt">throw</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="sb">`Unknown tool: </span><span class="si">${</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-101"></a><span class="w">  </span><span class="p">}</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-102"></a><span class="p">});</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-104"></a><span class="c1">// Start the server</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-105"></a><span class="k">async</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="nx">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-106"></a><span class="w">  </span><span class="kd">const</span><span class="w"> </span><span class="nx">transport</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">StdioServerTransport</span><span class="p">();</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-107"></a><span class="w">  </span><span class="k">await</span><span class="w"> </span><span class="nx">server</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">transport</span><span class="p">);</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-108"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;K-Agent MCP Server running on stdio&quot;</span><span class="p">);</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-109"></a><span class="p">}</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-111"></a><span class="nx">main</span><span class="p">().</span><span class="k">catch</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-112"></a><span class="w">  </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="s2">&quot;Server error:&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">error</span><span class="p">);</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-113"></a><span class="w">  </span><span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mf">1</span><span class="p">);</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#resources-001-mcp-basics-002-mcp-basics-ts-__codelineno-0-114"></a><span class="p">});</span>
</span></code></pre></div></section><section class="print-page" id="resources-001-mcp-basics-003-mcp-advanced-py" heading-number="5.3"><h1 id="resources-001-mcp-basics-003-mcp-advanced-py-resources-001-mcp-basics-003-mcp-advanced-py">003 - MCP Advanced (PY)</h1><h3 id="mcp-basics-with-python">MCP Basics with Python<a class="headerlink" href="#resources-001-mcp-basics-003-mcp-advanced-py-mcp-basics-with-python" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">mcp.server.fastmcp</span><span class="w"> </span><span class="kn">import</span> <span class="n">FastMCP</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.responses</span><span class="w"> </span><span class="kn">import</span> <span class="n">Response</span><span class="p">,</span> <span class="n">JSONResponse</span><span class="p">,</span> <span class="n">StreamingResponse</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">starlette.requests</span><span class="w"> </span><span class="kn">import</span> <span class="n">Request</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-4"></a><span class="kn">import</span><span class="w"> </span><span class="nn">types</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">httpx</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-6"></a><span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-7"></a><span class="kn">import</span><span class="w"> </span><span class="nn">asyncio</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-8"></a><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-9"></a><span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-10"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-11"></a>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-12"></a><span class="c1"># Ollama configuration</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-13"></a><span class="n">OLLAMA_BASE_URL</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:11434&quot;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-14"></a><span class="n">DEFAULT_MODEL</span> <span class="o">=</span> <span class="s2">&quot;codestral:latest&quot;</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-15"></a>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-16"></a><span class="c1"># Tool execution tracking</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-17"></a><span class="n">TOOL_EXECUTIONS</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-18"></a><span class="n">EXECUTION_COUNTER</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-19"></a>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-20"></a><span class="n">mcp</span> <span class="o">=</span> <span class="n">FastMCP</span><span class="p">(</span><span class="s2">&quot;kagent-mcp-server&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8889</span><span class="p">)</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-21"></a>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-22"></a><span class="c1"># Backwards-compat shim: some inspector tooling (fastmcp helpers)</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-23"></a><span class="c1"># expect a `_list_tools_mcp` coroutine on the server instance. Provide</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-24"></a><span class="c1"># a thin wrapper that forwards to the FastMCP `list_tools` implementation.</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-25"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_list_tools_mcp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-26"></a>    <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_tools</span><span class="p">()</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-27"></a>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-28"></a><span class="c1"># Bind the method to the instance</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-29"></a><span class="c1"># MCP need to access it as an instance method later</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-30"></a><span class="c1"># This will return list of ToolMetadata objects</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-31"></a><span class="n">mcp</span><span class="o">.</span><span class="n">_list_tools_mcp</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">MethodType</span><span class="p">(</span><span class="n">_list_tools_mcp</span><span class="p">,</span> <span class="n">mcp</span><span class="p">)</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-32"></a>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-33"></a><span class="c1"># Common CORS headers used by the inspector (browser-based)</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-34"></a><span class="n">HEADERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-35"></a>    <span class="s2">&quot;Access-Control-Allow-Origin&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-36"></a>    <span class="s2">&quot;Access-Control-Allow-Methods&quot;</span><span class="p">:</span> <span class="s2">&quot;GET,POST,OPTIONS&quot;</span><span class="p">,</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-37"></a>    <span class="s2">&quot;Access-Control-Allow-Headers&quot;</span><span class="p">:</span> <span class="s2">&quot;Content-Type,Authorization,X-Proxy-Token&quot;</span><span class="p">,</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-38"></a><span class="p">}</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-39"></a>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-40"></a><span class="c1"># Helper functions for tool execution</span>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-41"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-42"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the actual function for a tool by name&quot;&quot;&quot;</span>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-43"></a>    <span class="c1"># Build a mapping of tool names to functions</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-44"></a>    <span class="n">tool_map</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-45"></a>        <span class="s1">&#39;hello&#39;</span><span class="p">:</span> <span class="n">hello</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-46"></a>        <span class="s1">&#39;add&#39;</span><span class="p">:</span> <span class="n">add</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-47"></a>        <span class="s1">&#39;ollama_generate&#39;</span><span class="p">:</span> <span class="n">ollama_generate</span><span class="p">,</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-48"></a>        <span class="s1">&#39;ollama_chat&#39;</span><span class="p">:</span> <span class="n">ollama_chat</span><span class="p">,</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-49"></a>        <span class="s1">&#39;ollama_list_models&#39;</span><span class="p">:</span> <span class="n">ollama_list_models</span><span class="p">,</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-50"></a>        <span class="s1">&#39;code_review_prompt&#39;</span><span class="p">:</span> <span class="n">code_review_prompt</span><span class="p">,</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-51"></a>        <span class="s1">&#39;debug_prompt&#39;</span><span class="p">:</span> <span class="n">debug_prompt</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-52"></a>    <span class="p">}</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-53"></a>    <span class="k">return</span> <span class="n">tool_map</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-54"></a>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-55"></a><span class="k">def</span><span class="w"> </span><span class="nf">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-56"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate arguments against function signature&quot;&quot;&quot;</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-57"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-58"></a>        <span class="n">sig</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">signature</span><span class="p">(</span><span class="n">tool_func</span><span class="p">)</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-59"></a>        <span class="n">params</span> <span class="o">=</span> <span class="n">sig</span><span class="o">.</span><span class="n">parameters</span>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-60"></a>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-61"></a>        <span class="c1"># Check required arguments</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-62"></a>        <span class="k">for</span> <span class="n">param_name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-63"></a>            <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">default</span> <span class="o">==</span> <span class="n">inspect</span><span class="o">.</span><span class="n">Parameter</span><span class="o">.</span><span class="n">empty</span> <span class="ow">and</span> <span class="n">param_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-64"></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Missing required argument: </span><span class="si">{</span><span class="n">param_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-66"></a>        <span class="c1"># Check for unexpected arguments</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-67"></a>        <span class="k">for</span> <span class="n">arg_name</span> <span class="ow">in</span> <span class="n">arguments</span><span class="p">:</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-68"></a>            <span class="k">if</span> <span class="n">arg_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-69"></a>                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Unexpected argument: </span><span class="si">{</span><span class="n">arg_name</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-70"></a>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-71"></a>        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;Valid&quot;</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-72"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-73"></a>        <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Validation error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-74"></a>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-75"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-76"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Execute a tool and return the result&quot;&quot;&quot;</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-77"></a>    <span class="k">global</span> <span class="n">EXECUTION_COUNTER</span>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-78"></a>    <span class="n">execution_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;exec_</span><span class="si">{</span><span class="n">EXECUTION_COUNTER</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-79"></a>    <span class="n">EXECUTION_COUNTER</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-80"></a>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-81"></a>    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-82"></a>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-83"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-84"></a>        <span class="n">tool_func</span> <span class="o">=</span> <span class="n">get_tool_function</span><span class="p">(</span><span class="n">tool_name</span><span class="p">)</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-85"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_func</span><span class="p">:</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-86"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-87"></a>                <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-88"></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-89"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-90"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Tool &#39;</span><span class="si">{</span><span class="n">tool_name</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span><span class="p">,</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-91"></a>                <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-92"></a>            <span class="p">}</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-94"></a>        <span class="c1"># Validate arguments</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-95"></a>        <span class="n">valid</span><span class="p">,</span> <span class="n">message</span> <span class="o">=</span> <span class="n">validate_tool_arguments</span><span class="p">(</span><span class="n">tool_func</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-96"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">valid</span><span class="p">:</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-97"></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-98"></a>                <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-99"></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-100"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-101"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-102"></a>                <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="mi">0</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-103"></a>            <span class="p">}</span>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-104"></a>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-105"></a>        <span class="c1"># Execute the tool</span>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-106"></a>        <span class="k">if</span> <span class="n">inspect</span><span class="o">.</span><span class="n">iscoroutinefunction</span><span class="p">(</span><span class="n">tool_func</span><span class="p">):</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-107"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-108"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-109"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">tool_func</span><span class="p">(</span><span class="o">**</span><span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-110"></a>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-111"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-112"></a>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-113"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-114"></a>            <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-115"></a>            <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-116"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-117"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-118"></a>            <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">result</span><span class="p">,</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-119"></a>            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-120"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-121"></a>        <span class="p">}</span>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-122"></a>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-123"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-124"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-126"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-127"></a>        <span class="n">duration_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-128"></a>        <span class="n">execution_record</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-129"></a>            <span class="s2">&quot;execution_id&quot;</span><span class="p">:</span> <span class="n">execution_id</span><span class="p">,</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-130"></a>            <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-131"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="n">arguments</span><span class="p">,</span>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-132"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-133"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">),</span>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-134"></a>            <span class="s2">&quot;duration_ms&quot;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">duration_ms</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-135"></a>            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-136"></a>        <span class="p">}</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-137"></a>        <span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">execution_record</span>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-138"></a>        <span class="k">return</span> <span class="n">execution_record</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-139"></a>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-140"></a><span class="c1"># Example tool definitions</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-141"></a><span class="c1"># These will be automatically registered with the MCP server</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-142"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-143"></a><span class="k">def</span><span class="w"> </span><span class="nf">hello</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-144"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns a friendly greeting message&quot;&quot;&quot;</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-145"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Hello, </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">! Welcome to K-Agent Labs.&quot;</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-146"></a>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-147"></a><span class="c1"># Example tool that adds two numbers</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-148"></a><span class="c1"># Demonstrates handling of numeric inputs and outputs</span>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-149"></a><span class="c1"># This will become MCP tool available at /tools</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-150"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-151"></a><span class="k">def</span><span class="w"> </span><span class="nf">add</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-152"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Adds two numbers together&quot;&quot;&quot;</span>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-153"></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-154"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;The sum of </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> is </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-155"></a>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-156"></a><span class="c1"># Ollama integration tools</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-157"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-158"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_generate</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span> <span class="n">max_tokens</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-159"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate text using Ollama LLM&quot;&quot;&quot;</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-160"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-161"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-162"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-163"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/generate&quot;</span><span class="p">,</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-164"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-165"></a>                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-166"></a>                <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-167"></a>                <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-168"></a>                <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-169"></a>                    <span class="s2">&quot;num_predict&quot;</span><span class="p">:</span> <span class="n">max_tokens</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-170"></a>                <span class="p">}</span>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-171"></a>            <span class="p">},</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-172"></a>            <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-173"></a>        <span class="p">)</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-174"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-175"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-176"></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="s2">&quot;No response from model&quot;</span><span class="p">)</span>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-177"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-178"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-179"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-180"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error calling Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-181"></a>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-182"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-183"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_chat</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT_MODEL</span><span class="p">,</span> <span class="n">system</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-184"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Chat with Ollama LLM using chat API&quot;&quot;&quot;</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-185"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-186"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-187"></a>        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-188"></a>        <span class="k">if</span> <span class="n">system</span><span class="p">:</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-189"></a>            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;system&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">system</span><span class="p">})</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-190"></a>        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">})</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-191"></a>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-192"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-193"></a>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/chat&quot;</span><span class="p">,</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-194"></a>            <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-195"></a>                <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-196"></a>                <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-197"></a>                <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="kc">False</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-198"></a>            <span class="p">},</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-199"></a>            <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-200"></a>        <span class="p">)</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-201"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-202"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-203"></a>            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;content&quot;</span><span class="p">,</span> <span class="s2">&quot;No response&quot;</span><span class="p">)</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-204"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-205"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-206"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-207"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error calling Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-208"></a>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-209"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">tool</span><span class="p">()</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-210"></a><span class="k">def</span><span class="w"> </span><span class="nf">ollama_list_models</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-211"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;List available Ollama models&quot;&quot;&quot;</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-212"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-213"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-214"></a>        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/tags&quot;</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-215"></a>        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-216"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-217"></a>            <span class="n">models</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;models&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-218"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">models</span><span class="p">:</span>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-219"></a>                <span class="k">return</span> <span class="s2">&quot;No models available&quot;</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-220"></a>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-221"></a>            <span class="n">result</span> <span class="o">=</span> <span class="s2">&quot;Available Ollama models:</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-222"></a>            <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-223"></a>                <span class="n">name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-224"></a>                <span class="n">size</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">//</span> <span class="p">(</span><span class="mi">1024</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># Convert to GB</span>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-225"></a>                <span class="n">result</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;- </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2">GB)</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-226"></a>            <span class="k">return</span> <span class="n">result</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-227"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-228"></a>            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-229"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-230"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Error listing models: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-231"></a>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-232"></a><span class="c1"># Prompts - Reusable prompt templates</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-233"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">prompt</span><span class="p">()</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-234"></a><span class="k">def</span><span class="w"> </span><span class="nf">code_review_prompt</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;python&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-235"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a code review prompt for the given code&quot;&quot;&quot;</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-236"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Please review this </span><span class="si">{</span><span class="n">language</span><span class="si">}</span><span class="s2"> code and provide feedback:</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-237"></a>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-238"></a><span class="s2">---</span><span class="si">{</span><span class="n">language</span><span class="si">}</span>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-239"></a><span class="si">{</span><span class="n">code</span><span class="si">}</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-240"></a><span class="s2">---</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-241"></a>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-242"></a><span class="s2">Focus on:</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-243"></a><span class="s2">- Code quality and best practices</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-244"></a><span class="s2">- Potential bugs or issues</span>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-245"></a><span class="s2">- Performance improvements</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-246"></a><span class="s2">- Security concerns</span>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-247"></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-248"></a>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-249"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">prompt</span><span class="p">()</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-250"></a><span class="k">def</span><span class="w"> </span><span class="nf">debug_prompt</span><span class="p">(</span><span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code_context</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-251"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a debugging prompt&quot;&quot;&quot;</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-252"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Help me debug this error:</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-253"></a>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-254"></a><span class="s2">Error: </span><span class="si">{</span><span class="n">error_message</span><span class="si">}</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-255"></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-256"></a>    <span class="k">if</span> <span class="n">code_context</span><span class="p">:</span>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-257"></a>        <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Code context:</span><span class="se">\n</span><span class="s2">---</span><span class="se">\n</span><span class="si">{</span><span class="n">code_context</span><span class="si">}</span><span class="se">\n</span><span class="s2">---&quot;</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-258"></a>    <span class="k">return</span> <span class="n">prompt</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-259"></a>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-260"></a><span class="c1"># Resource to return the source code of this server</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-261"></a><span class="c1"># Useful for inspection and learning purposes</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-262"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;mcp://code&quot;</span><span class="p">)</span>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-263"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_code</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-264"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns the source code of this server&quot;&quot;&quot;</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-265"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-266"></a>        <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-267"></a>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-268"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">resource</span><span class="p">(</span><span class="s2">&quot;mcp://server-info&quot;</span><span class="p">)</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-269"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_server_info</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-270"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns information about this MCP server&quot;&quot;&quot;</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-271"></a>    <span class="k">return</span> <span class="s2">&quot;&quot;&quot;K-Agent MCP Server</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-272"></a>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-273"></a><span class="s2">Version: 0.1.0</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-274"></a><span class="s2">Capabilities:</span>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-275"></a><span class="s2">- Tools: hello, add</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-276"></a><span class="s2">- Prompts: code_review_prompt, debug_prompt</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-277"></a><span class="s2">- Resources: code, server-info</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-278"></a><span class="s2">- Sampling: LLM sampling support</span>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-279"></a><span class="s2">- Roots: File system access</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-280"></a><span class="s2">&quot;&quot;&quot;</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-281"></a>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-282"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-283"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">root_health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-284"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;MCP Server Running&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-285"></a>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-286"></a><span class="c1"># Health check endpoints</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-287"></a><span class="c1"># MCP manifest endpoint, negotiation, and tools listing</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-288"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/health&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-289"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">health_check</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-290"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="s2">&quot;MCP Server Running&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-291"></a>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-292"></a><span class="c1"># MCP Manifest endpoint as per MCP specification</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-293"></a><span class="c1"># Provides metadata about the MCP server</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-294"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/.well-known/mcp&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-295"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_manifest</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-296"></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:8889&quot;</span><span class="p">)</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-297"></a>    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s2">&quot;http&quot;</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-298"></a>    <span class="n">base</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-299"></a>    <span class="n">manifest</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-300"></a>        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;kagent-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-301"></a>        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-302"></a>        <span class="s2">&quot;base_url&quot;</span><span class="p">:</span> <span class="n">base</span><span class="p">,</span>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-303"></a>        <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-304"></a>        <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-305"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-306"></a>            <span class="s2">&quot;prompts&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-307"></a>            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-308"></a>            <span class="s2">&quot;sampling&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-309"></a>            <span class="s2">&quot;roots&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-310"></a>            <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="kc">True</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-311"></a>        <span class="p">},</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-312"></a>        <span class="s2">&quot;endpoints&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-313"></a>            <span class="s2">&quot;manifest&quot;</span><span class="p">:</span> <span class="s2">&quot;/.well-known/mcp&quot;</span><span class="p">,</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-314"></a>            <span class="s2">&quot;health&quot;</span><span class="p">:</span> <span class="s2">&quot;/health&quot;</span><span class="p">,</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-315"></a>            <span class="s2">&quot;ping&quot;</span><span class="p">:</span> <span class="s2">&quot;/ping&quot;</span><span class="p">,</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-316"></a>            <span class="s2">&quot;root&quot;</span><span class="p">:</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-317"></a>            <span class="s2">&quot;negotiate&quot;</span><span class="p">:</span> <span class="s2">&quot;/negotiate&quot;</span><span class="p">,</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-318"></a>            <span class="s2">&quot;metadata&quot;</span><span class="p">:</span> <span class="s2">&quot;/metadata&quot;</span><span class="p">,</span>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-319"></a>            <span class="s2">&quot;events&quot;</span><span class="p">:</span> <span class="s2">&quot;/mcp&quot;</span><span class="p">,</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-320"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="s2">&quot;/tools&quot;</span><span class="p">,</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-321"></a>            <span class="s2">&quot;tools_execute&quot;</span><span class="p">:</span> <span class="s2">&quot;/tools/execute&quot;</span><span class="p">,</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-322"></a>            <span class="s2">&quot;tools_batch&quot;</span><span class="p">:</span> <span class="s2">&quot;/tools/batch&quot;</span><span class="p">,</span>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-323"></a>            <span class="s2">&quot;tools_stream&quot;</span><span class="p">:</span> <span class="s2">&quot;/tools/stream&quot;</span><span class="p">,</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-324"></a>            <span class="s2">&quot;tools_history&quot;</span><span class="p">:</span> <span class="s2">&quot;/tools/history&quot;</span><span class="p">,</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-325"></a>            <span class="s2">&quot;prompts&quot;</span><span class="p">:</span> <span class="s2">&quot;/prompts&quot;</span><span class="p">,</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-326"></a>            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="s2">&quot;/resources&quot;</span><span class="p">,</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-327"></a>            <span class="s2">&quot;sampling&quot;</span><span class="p">:</span> <span class="s2">&quot;/sampling&quot;</span><span class="p">,</span>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-328"></a>            <span class="s2">&quot;roots&quot;</span><span class="p">:</span> <span class="s2">&quot;/roots&quot;</span><span class="p">,</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-329"></a>            <span class="s2">&quot;ollama_status&quot;</span><span class="p">:</span> <span class="s2">&quot;/ollama/status&quot;</span><span class="p">,</span>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-330"></a>        <span class="p">},</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-331"></a>    <span class="p">}</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-332"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">manifest</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-334"></a><span class="c1"># MCP Negotiation endpoint</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-335"></a><span class="c1"># Clients use this to negotiate connection parameters</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-336"></a><span class="c1"># Supports token-based authentication</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-337"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/negotiate&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-338"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">negotiate</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-339"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-340"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-341"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-342"></a>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-343"></a>    <span class="n">host</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;host&quot;</span><span class="p">,</span> <span class="s2">&quot;localhost:8889&quot;</span><span class="p">)</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-344"></a>    <span class="n">scheme</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">or</span> <span class="s2">&quot;http&quot;</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-345"></a>    <span class="n">mcp_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">scheme</span><span class="si">}</span><span class="s2">://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s2">/mcp&quot;</span>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-346"></a>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-347"></a>    <span class="c1"># Accept proxy token from query param, X-Proxy-Token header, or Authorization bearer</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-348"></a>    <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;token&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;x-proxy-token&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;X-Proxy-Token&quot;</span><span class="p">)</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-349"></a>    <span class="n">auth</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;authorization&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Authorization&quot;</span><span class="p">)</span>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-350"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">and</span> <span class="n">auth</span> <span class="ow">and</span> <span class="n">auth</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;bearer &quot;</span><span class="p">):</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-351"></a>        <span class="n">token</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-352"></a>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-353"></a>    <span class="n">response</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-354"></a>        <span class="s2">&quot;transport&quot;</span><span class="p">:</span> <span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-355"></a>        <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">mcp_url</span><span class="p">,</span>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-356"></a>    <span class="p">}</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-357"></a>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-358"></a>    <span class="c1"># Include token in response if provided</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-359"></a>    <span class="k">if</span> <span class="n">token</span><span class="p">:</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-360"></a>        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;proxy_token&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">token</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-361"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-362"></a>        <span class="c1"># When no token is provided, explicitly indicate no auth is required</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-363"></a>        <span class="c1"># This helps the Inspector understand it can connect without authentication</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-364"></a>        <span class="n">response</span><span class="p">[</span><span class="s2">&quot;requiresAuth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-365"></a>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-366"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-367"></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-368"></a><span class="c1"># Tools listing endpoint</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-369"></a><span class="c1"># Returns metadata about all registered tools</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-370"></a><span class="c1"># Used by inspectors to discover available tools</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-371"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-372"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tools_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-373"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-374"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-375"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-376"></a>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-377"></a>    <span class="c1"># Use the server&#39;s list_tools implementation so the inspector sees</span>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-378"></a>    <span class="c1"># the canonical, generated tool metadata instead of a hand-written list.</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-379"></a>    <span class="n">tools</span> <span class="o">=</span> <span class="k">await</span> <span class="n">mcp</span><span class="o">.</span><span class="n">_list_tools_mcp</span><span class="p">()</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-380"></a>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-381"></a>    <span class="n">serializable</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-382"></a>    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tools</span><span class="p">:</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-383"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-384"></a>            <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">model_dump</span><span class="p">())</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-385"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-386"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-387"></a>                <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">dict</span><span class="p">())</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-388"></a>            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-389"></a>                <span class="n">serializable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-390"></a>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-391"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="n">serializable</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-392"></a>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-393"></a><span class="c1"># Tool execution endpoint - Execute a single tool</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-394"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/execute&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-395"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-396"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-397"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-398"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-399"></a>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-400"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-401"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-402"></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool&quot;</span><span class="p">)</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-403"></a>        <span class="n">arguments</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-404"></a>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-405"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-406"></a>            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-407"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-408"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing &#39;tool&#39; field&quot;</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-409"></a>            <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-410"></a>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-411"></a>        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-412"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-413"></a>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-414"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-415"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-416"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-417"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-418"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-419"></a>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-420"></a><span class="c1"># Batch tool execution endpoint</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-421"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/batch&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-422"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_batch_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-423"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-424"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-425"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-426"></a>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-427"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-428"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-429"></a>        <span class="n">calls</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;calls&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-430"></a>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-431"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">calls</span><span class="p">:</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-432"></a>            <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-433"></a>                <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-434"></a>                <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing &#39;calls&#39; array&quot;</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-435"></a>            <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-436"></a>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-437"></a>        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-438"></a>        <span class="k">for</span> <span class="n">call</span> <span class="ow">in</span> <span class="n">calls</span><span class="p">:</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-439"></a>            <span class="n">tool_name</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool&quot;</span><span class="p">)</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-440"></a>            <span class="n">arguments</span> <span class="o">=</span> <span class="n">call</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-441"></a>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-442"></a>            <span class="k">if</span> <span class="n">tool_name</span><span class="p">:</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-443"></a>                <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-444"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-445"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-446"></a>                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-447"></a>                    <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-448"></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="s2">&quot;Missing tool name in call&quot;</span>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-449"></a>                <span class="p">})</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-450"></a>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-451"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-452"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-453"></a>            <span class="s2">&quot;results&quot;</span><span class="p">:</span> <span class="n">results</span><span class="p">,</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-454"></a>            <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-455"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-456"></a>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-457"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-458"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-459"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-460"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Batch execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-461"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-462"></a>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-463"></a><span class="c1"># Tool execution history endpoint</span>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-464"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/history&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-465"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_history</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-466"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-467"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-468"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-469"></a>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-470"></a>    <span class="n">limit</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">query_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;limit&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-471"></a>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-472"></a>    <span class="c1"># Get recent executions</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-473"></a>    <span class="n">executions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">TOOL_EXECUTIONS</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-474"></a>    <span class="n">executions</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;timestamp&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-475"></a>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-476"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-477"></a>        <span class="s2">&quot;executions&quot;</span><span class="p">:</span> <span class="n">executions</span><span class="p">[:</span><span class="n">limit</span><span class="p">],</span>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-478"></a>        <span class="s2">&quot;total&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">executions</span><span class="p">)</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-479"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-480"></a>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-481"></a><span class="c1"># Get specific execution details</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-482"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/execution/</span><span class="si">{execution_id}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-483"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_execution_detail</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-484"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-485"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-486"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-487"></a>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-488"></a>    <span class="n">execution_id</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">path_params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_id&quot;</span><span class="p">)</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-489"></a>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-490"></a>    <span class="k">if</span> <span class="n">execution_id</span> <span class="ow">in</span> <span class="n">TOOL_EXECUTIONS</span><span class="p">:</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-491"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">(</span><span class="n">TOOL_EXECUTIONS</span><span class="p">[</span><span class="n">execution_id</span><span class="p">],</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-492"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-493"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-494"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Execution &#39;</span><span class="si">{</span><span class="n">execution_id</span><span class="si">}</span><span class="s2">&#39; not found&quot;</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-495"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">404</span><span class="p">)</span>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-496"></a>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-497"></a><span class="c1"># Streaming tool execution</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-498"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/tools/stream&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-499"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">tool_stream_execute</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">):</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-500"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-501"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-502"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-503"></a>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-504"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-505"></a>        <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-506"></a>        <span class="n">tool_name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;tool&quot;</span><span class="p">)</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-507"></a>        <span class="n">arguments</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;arguments&quot;</span><span class="p">,</span> <span class="p">{})</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-508"></a>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-509"></a>        <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">generate_stream</span><span class="p">():</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-510"></a>            <span class="c1"># Send start event</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-511"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-512"></a>                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;start&quot;</span><span class="p">,</span>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-513"></a>                <span class="s2">&quot;tool&quot;</span><span class="p">:</span> <span class="n">tool_name</span><span class="p">,</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-514"></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-515"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-516"></a>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-517"></a>            <span class="c1"># Execute tool</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-518"></a>            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">execute_tool</span><span class="p">(</span><span class="n">tool_name</span><span class="p">,</span> <span class="n">arguments</span><span class="p">)</span>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-519"></a>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-520"></a>            <span class="c1"># Send result event</span>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-521"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-522"></a>                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;result&quot;</span><span class="p">,</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-523"></a>                <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">result</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-524"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-525"></a>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-526"></a>            <span class="c1"># Send end event</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-527"></a>            <span class="k">yield</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">({</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-528"></a>                <span class="s2">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;end&quot;</span><span class="p">,</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-529"></a>                <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-530"></a>            <span class="p">})</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-531"></a>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-532"></a>        <span class="k">return</span> <span class="n">StreamingResponse</span><span class="p">(</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-533"></a>            <span class="n">generate_stream</span><span class="p">(),</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-534"></a>            <span class="n">media_type</span><span class="o">=</span><span class="s2">&quot;application/x-ndjson&quot;</span><span class="p">,</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-535"></a>            <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-536"></a>        <span class="p">)</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-537"></a>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-538"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-539"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-540"></a>            <span class="s2">&quot;success&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-541"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Stream execution failed: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-542"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-543"></a>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-544"></a><span class="c1"># Prompts listing endpoint</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-545"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/prompts&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-546"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">prompts_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-547"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-548"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-549"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-550"></a>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-551"></a>    <span class="n">prompts</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-552"></a>        <span class="p">{</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-553"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;code_review_prompt&quot;</span><span class="p">,</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-554"></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Generate a code review prompt for the given code&quot;</span><span class="p">,</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-555"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-556"></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;code&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The code to review&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-557"></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;language&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Programming language&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-558"></a>            <span class="p">]</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-559"></a>        <span class="p">},</span>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-560"></a>        <span class="p">{</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-561"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;debug_prompt&quot;</span><span class="p">,</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-562"></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Generate a debugging prompt&quot;</span><span class="p">,</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-563"></a>            <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-564"></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;error_message&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;The error message&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-565"></a>                <span class="p">{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;code_context&quot;</span><span class="p">,</span> <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Relevant code context&quot;</span><span class="p">,</span> <span class="s2">&quot;required&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-566"></a>            <span class="p">]</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-567"></a>        <span class="p">}</span>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-568"></a>    <span class="p">]</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-569"></a>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-570"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;prompts&quot;</span><span class="p">:</span> <span class="n">prompts</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-571"></a>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-572"></a><span class="c1"># Resources listing endpoint</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-573"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/resources&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-574"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">resources_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-575"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-576"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-577"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-578"></a>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-579"></a>    <span class="n">resources</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-580"></a>        <span class="p">{</span>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-581"></a>            <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;mcp://code&quot;</span><span class="p">,</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-582"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Server Source Code&quot;</span><span class="p">,</span>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-583"></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Returns the source code of this server&quot;</span><span class="p">,</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-584"></a>            <span class="s2">&quot;mimeType&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-585"></a>        <span class="p">},</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-586"></a>        <span class="p">{</span>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-587"></a>            <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="s2">&quot;mcp://server-info&quot;</span><span class="p">,</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-588"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Server Information&quot;</span><span class="p">,</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-589"></a>            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="s2">&quot;Returns information about this MCP server&quot;</span><span class="p">,</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-590"></a>            <span class="s2">&quot;mimeType&quot;</span><span class="p">:</span> <span class="s2">&quot;text/plain&quot;</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-591"></a>        <span class="p">}</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-592"></a>    <span class="p">]</span>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-593"></a>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-594"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="n">resources</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-595"></a>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-596"></a><span class="c1"># Ping endpoint for connection health checks</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-597"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/ping&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-598"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ping</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-599"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-600"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-601"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-602"></a>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-603"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-604"></a>        <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;ok&quot;</span><span class="p">,</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-605"></a>        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="nb">__import__</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-606"></a>        <span class="s2">&quot;server&quot;</span><span class="p">:</span> <span class="s2">&quot;kagent-mcp-server&quot;</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-607"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-608"></a>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-609"></a><span class="c1"># Sampling endpoint - LLM sampling capability using Ollama</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-610"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/sampling&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-611"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sampling</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-612"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-613"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-614"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-615"></a>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-616"></a>    <span class="n">body</span> <span class="o">=</span> <span class="k">await</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">()</span> <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;POST&quot;</span> <span class="k">else</span> <span class="p">{}</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-617"></a>    <span class="n">prompt</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;prompt&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-618"></a>    <span class="n">max_tokens</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;maxTokens&quot;</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-619"></a>    <span class="n">model</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">DEFAULT_MODEL</span><span class="p">)</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-620"></a>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-621"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-622"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">60.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-623"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-624"></a>                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/generate&quot;</span><span class="p">,</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-625"></a>                <span class="n">json</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-626"></a>                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-627"></a>                    <span class="s2">&quot;prompt&quot;</span><span class="p">:</span> <span class="n">prompt</span><span class="p">,</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-628"></a>                    <span class="s2">&quot;stream&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-629"></a>                    <span class="s2">&quot;options&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-630"></a>                        <span class="s2">&quot;num_predict&quot;</span><span class="p">:</span> <span class="n">max_tokens</span>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-631"></a>                    <span class="p">}</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-632"></a>                <span class="p">}</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-633"></a>            <span class="p">)</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-634"></a>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-635"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-636"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-637"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-638"></a>                    <span class="s2">&quot;completion&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;response&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-639"></a>                    <span class="s2">&quot;stopReason&quot;</span><span class="p">:</span> <span class="s2">&quot;endTurn&quot;</span> <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;done&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;length&quot;</span><span class="p">,</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-640"></a>                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-641"></a>                    <span class="s2">&quot;context&quot;</span><span class="p">:</span> <span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-642"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-643"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-644"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-645"></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Ollama error: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-646"></a>                    <span class="s2">&quot;completion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-647"></a>                    <span class="s2">&quot;stopReason&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-648"></a>                    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-649"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-650"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-651"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-652"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Failed to connect to Ollama: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-653"></a>            <span class="s2">&quot;completion&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-654"></a>            <span class="s2">&quot;stopReason&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-655"></a>            <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-656"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-657"></a>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-658"></a><span class="c1"># Roots endpoint - File system roots</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-659"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/roots&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-660"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">roots_list</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-661"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-662"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-663"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-664"></a>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-665"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-666"></a>    <span class="n">roots</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-667"></a>        <span class="p">{</span>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-668"></a>            <span class="s2">&quot;uri&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;file://</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-669"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;Current Directory&quot;</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-670"></a>        <span class="p">}</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-671"></a>    <span class="p">]</span>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-672"></a>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-673"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span><span class="s2">&quot;roots&quot;</span><span class="p">:</span> <span class="n">roots</span><span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-674"></a>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-675"></a><span class="c1"># Ollama status endpoint</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-676"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/ollama/status&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-677"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">ollama_status</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-678"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-679"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-680"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-681"></a>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-682"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-683"></a>        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-684"></a>            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">OLLAMA_BASE_URL</span><span class="si">}</span><span class="s2">/api/tags&quot;</span><span class="p">)</span>
</span><span id="__span-0-685"><a id="__codelineno-0-685" name="__codelineno-0-685" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-685"></a>            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
</span><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-686"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-687"></a>                <span class="n">models</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;models&quot;</span><span class="p">,</span> <span class="p">[])</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-688"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-689"></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;connected&quot;</span><span class="p">,</span>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-690"></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-691"></a>                    <span class="s2">&quot;models_count&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">models</span><span class="p">),</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-692"></a>                    <span class="s2">&quot;models&quot;</span><span class="p">:</span> <span class="p">[{</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-693"></a>                        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">),</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-694"></a>                        <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;size&quot;</span><span class="p">),</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-695"></a>                        <span class="s2">&quot;modified&quot;</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modified_at&quot;</span><span class="p">)</span>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-696"></a>                    <span class="p">}</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models</span><span class="p">],</span>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-697"></a>                    <span class="s2">&quot;default_model&quot;</span><span class="p">:</span> <span class="n">DEFAULT_MODEL</span>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-698"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-699"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-700"></a>                <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-701"></a>                    <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-702"></a>                    <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-703"></a>                    <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;HTTP </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-704"></a>                <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-705"></a>    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-706"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-707"></a>            <span class="s2">&quot;status&quot;</span><span class="p">:</span> <span class="s2">&quot;disconnected&quot;</span><span class="p">,</span>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-708"></a>            <span class="s2">&quot;url&quot;</span><span class="p">:</span> <span class="n">OLLAMA_BASE_URL</span><span class="p">,</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-709"></a>            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-710"></a>        <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-711"></a>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-712"></a><span class="c1"># Server metadata endpoint</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-713"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/metadata&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-714"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JSONResponse</span><span class="p">:</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-715"></a>    <span class="c1"># Handle OPTIONS preflight</span>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-716"></a>    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;OPTIONS&quot;</span><span class="p">:</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-717"></a>        <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-718"></a>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-719"></a>    <span class="k">return</span> <span class="n">JSONResponse</span><span class="p">({</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-720"></a>        <span class="s2">&quot;serverInfo&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-721"></a>            <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;kagent-mcp-server&quot;</span><span class="p">,</span>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-722"></a>            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;0.1.0&quot;</span><span class="p">,</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-723"></a>            <span class="s2">&quot;protocolVersion&quot;</span><span class="p">:</span> <span class="s2">&quot;2024-11-05&quot;</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-724"></a>        <span class="p">},</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-725"></a>        <span class="s2">&quot;capabilities&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-726"></a>            <span class="s2">&quot;tools&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;listChanged&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-727"></a>            <span class="s2">&quot;prompts&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;listChanged&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-728"></a>            <span class="s2">&quot;resources&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;subscribe&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;listChanged&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">},</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-729"></a>            <span class="s2">&quot;logging&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-730"></a>            <span class="s2">&quot;sampling&quot;</span><span class="p">:</span> <span class="p">{},</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-731"></a>            <span class="s2">&quot;roots&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;listChanged&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">}</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-732"></a>        <span class="p">}</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-733"></a>    <span class="p">},</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-734"></a>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-735"></a><span class="c1"># Add CORS middleware to handle preflight requests for all endpoints</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-736"></a><span class="nd">@mcp</span><span class="o">.</span><span class="n">custom_route</span><span class="p">(</span><span class="s2">&quot;/mcp&quot;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;OPTIONS&quot;</span><span class="p">])</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-737"></a><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">mcp_options</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Response</span><span class="p">:</span>
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-738"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Handle CORS preflight for the MCP endpoint&quot;&quot;&quot;</span>
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-739"></a>    <span class="k">return</span> <span class="n">Response</span><span class="p">(</span><span class="n">status_code</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">HEADERS</span><span class="p">)</span>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-740"></a>
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-741"></a><span class="c1"># Main entry point to run the MCP server</span>
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-742"></a><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">():</span>
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-743"></a>    <span class="c1"># Start the MCP server with streamable-http transport</span>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-744"></a>    <span class="c1"># Mounted at /mcp path</span>
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-745"></a>    <span class="c1"># This will listen on port 8889 as configured above</span>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-746"></a>    <span class="n">mcp</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">transport</span><span class="o">=</span><span class="s2">&quot;streamable-http&quot;</span><span class="p">,</span> <span class="n">mount_path</span><span class="o">=</span><span class="s2">&quot;/mcp&quot;</span><span class="p">)</span>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-747"></a>
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-748"></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749" href="#resources-001-mcp-basics-003-mcp-advanced-py-__codelineno-0-749"></a>    <span class="n">main</span><span class="p">()</span>
</span></code></pre></div></section></section></div><style>.print-site-enumerate-headings #welcome > h1:before { content: '1 ' }

                .print-site-enumerate-headings #welcome h2:before { content: '1.' counter(counter-welcome-2) ' ' }
                .print-site-enumerate-headings #welcome h2 {  counter-reset: counter-welcome-3 ;  counter-increment: counter-welcome-2 }
            
                .print-site-enumerate-headings #welcome h3:before { content: '1.' counter(counter-welcome-2) '.' counter(counter-welcome-3) ' ' }
                .print-site-enumerate-headings #welcome h3 {  counter-increment: counter-welcome-3 }
            
.print-site-enumerate-headings #lab00-setup > h1:before { content: '2 ' }

                .print-site-enumerate-headings #lab00-setup h2:before { content: '2.' counter(counter-lab00-setup-2) ' ' }
                .print-site-enumerate-headings #lab00-setup h2 {  counter-reset: counter-lab00-setup-3 ;  counter-increment: counter-lab00-setup-2 }
            
                .print-site-enumerate-headings #lab00-setup h3:before { content: '2.' counter(counter-lab00-setup-2) '.' counter(counter-lab00-setup-3) ' ' }
                .print-site-enumerate-headings #lab00-setup h3 {  counter-increment: counter-lab00-setup-3 }
            
.print-site-enumerate-headings #section-3 > h1:before { content: '3 ' }
.print-site-enumerate-headings #labs > h1:before { content: '3.1 ' }

                .print-site-enumerate-headings #labs h2:before { content: '3.1.' counter(counter-labs-2) ' ' }
                .print-site-enumerate-headings #labs h2 {  counter-increment: counter-labs-2 }
            
.print-site-enumerate-headings #lab00-setup > h1:before { content: '3.2 ' }

                .print-site-enumerate-headings #lab00-setup h2:before { content: '3.2.' counter(counter-lab00-setup-2) ' ' }
                .print-site-enumerate-headings #lab00-setup h2 {  counter-increment: counter-lab00-setup-2 }
            
.print-site-enumerate-headings #lab01-mcp-fundamentals > h1:before { content: '3.3 ' }

                .print-site-enumerate-headings #lab01-mcp-fundamentals h2:before { content: '3.3.' counter(counter-lab01-mcp-fundamentals-2) ' ' }
                .print-site-enumerate-headings #lab01-mcp-fundamentals h2 {  counter-increment: counter-lab01-mcp-fundamentals-2 }
            
.print-site-enumerate-headings #lab02-first-mcp-server > h1:before { content: '3.4 ' }

                .print-site-enumerate-headings #lab02-first-mcp-server h2:before { content: '3.4.' counter(counter-lab02-first-mcp-server-2) ' ' }
                .print-site-enumerate-headings #lab02-first-mcp-server h2 {  counter-increment: counter-lab02-first-mcp-server-2 }
            
.print-site-enumerate-headings #lab03-mcp-tools > h1:before { content: '3.5 ' }

                .print-site-enumerate-headings #lab03-mcp-tools h2:before { content: '3.5.' counter(counter-lab03-mcp-tools-2) ' ' }
                .print-site-enumerate-headings #lab03-mcp-tools h2 {  counter-increment: counter-lab03-mcp-tools-2 }
            
.print-site-enumerate-headings #lab04-mcp-resources > h1:before { content: '3.6 ' }

                .print-site-enumerate-headings #lab04-mcp-resources h2:before { content: '3.6.' counter(counter-lab04-mcp-resources-2) ' ' }
                .print-site-enumerate-headings #lab04-mcp-resources h2 {  counter-increment: counter-lab04-mcp-resources-2 }
            
.print-site-enumerate-headings #lab05-mcp-prompts > h1:before { content: '3.7 ' }

                .print-site-enumerate-headings #lab05-mcp-prompts h2:before { content: '3.7.' counter(counter-lab05-mcp-prompts-2) ' ' }
                .print-site-enumerate-headings #lab05-mcp-prompts h2 {  counter-increment: counter-lab05-mcp-prompts-2 }
            
.print-site-enumerate-headings #lab06-k-agent > h1:before { content: '3.8 ' }

                .print-site-enumerate-headings #lab06-k-agent h2:before { content: '3.8.' counter(counter-lab06-k-agent-2) ' ' }
                .print-site-enumerate-headings #lab06-k-agent h2 {  counter-increment: counter-lab06-k-agent-2 }
            
.print-site-enumerate-headings #section-4 > h1:before { content: '4 ' }
.print-site-enumerate-headings #tasks > h1:before { content: '4.1 ' }

                .print-site-enumerate-headings #tasks h2:before { content: '4.1.' counter(counter-tasks-2) ' ' }
                .print-site-enumerate-headings #tasks h2 {  counter-increment: counter-tasks-2 }
            
.print-site-enumerate-headings #tasks-000-setup-roocode-000-setup-roocode > h1:before { content: '4.2 ' }

                .print-site-enumerate-headings #tasks-000-setup-roocode-000-setup-roocode h2:before { content: '4.2.' counter(counter-tasks-000-setup-roocode-000-setup-roocode-2) ' ' }
                .print-site-enumerate-headings #tasks-000-setup-roocode-000-setup-roocode h2 {  counter-increment: counter-tasks-000-setup-roocode-000-setup-roocode-2 }
            
.print-site-enumerate-headings #section-5 > h1:before { content: '5 ' }
.print-site-enumerate-headings #resources-001-mcp-basics-001-mcp-basics-py > h1:before { content: '5.1 ' }

                .print-site-enumerate-headings #resources-001-mcp-basics-001-mcp-basics-py h2:before { content: '5.1.' counter(counter-resources-001-mcp-basics-001-mcp-basics-py-2) ' ' }
                .print-site-enumerate-headings #resources-001-mcp-basics-001-mcp-basics-py h2 {  counter-increment: counter-resources-001-mcp-basics-001-mcp-basics-py-2 }
            
.print-site-enumerate-headings #resources-001-mcp-basics-002-mcp-basics-ts > h1:before { content: '5.2 ' }

                .print-site-enumerate-headings #resources-001-mcp-basics-002-mcp-basics-ts h2:before { content: '5.2.' counter(counter-resources-001-mcp-basics-002-mcp-basics-ts-2) ' ' }
                .print-site-enumerate-headings #resources-001-mcp-basics-002-mcp-basics-ts h2 {  counter-increment: counter-resources-001-mcp-basics-002-mcp-basics-ts-2 }
            
.print-site-enumerate-headings #resources-001-mcp-basics-003-mcp-advanced-py > h1:before { content: '5.3 ' }

                .print-site-enumerate-headings #resources-001-mcp-basics-003-mcp-advanced-py h2:before { content: '5.3.' counter(counter-resources-001-mcp-basics-003-mcp-advanced-py-2) ' ' }
                .print-site-enumerate-headings #resources-001-mcp-basics-003-mcp-advanced-py h2 {  counter-increment: counter-resources-001-mcp-basics-003-mcp-advanced-py-2 }
            </style>
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->


<!-- Source file information -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Footer -->
<footer class="md-footer">
  <div class="logo1"></div>
  <div class="logo2"></div>

  <!-- Link to previous and/or next page -->
  
    
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ¬©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a>
    </div>
  
  
</div>

      <!-- Social links -->
      
        
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/nirgeier/AI-K8S-MCP/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>
  </div>
</footer>

      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "/AI-K8S-MCP/", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", "navigation.tabs.sticky", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.integrate", "toc.sticky", "mermaid"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://buttons.github.io/buttons.js?v=1766553928"></script>
      
    
  </body>
</html>